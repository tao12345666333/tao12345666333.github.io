<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>源码编译MongoDB - MoeLove</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-1876963677156202",
    enable_page_level_ads: true
  });
</script>


<meta name="author" content="TaoBeier" />
  <meta name="description" content="上周放假正好有时间，编译安装了MongoDB，虽然MongoDB用了挺长时间的，但还是第一次用源码编译。在此做个备忘。因为已经完整编译安装过了，所以写起来的时候，就按照先知视角来写了～ 2333
 下载MongoDB源码 MongoDB的官网上是有已经编译好的二进制包的，这里选择clone MongoDB在github上的仓库
git clone https://github.com/mongodb/mongo &amp;amp;&amp;amp; cd mongo  在docs/building.md中是编译所需的依赖。 * A modern C&#43;&#43; compiler. One of the following is required. * GCC 4.8.2 or newer * Clang 3.4 (or Apple XCode 5.1.1 Clang) or newer * Visual Studio 2013 Update 2 or newer * Python 2.7 * SCons 2.3
我这台服务器是CentOS 6.5, 上面的gcc版本比较低，这里就先更新gcc咯.
gcc --version gcc (GCC) 4.4.7 20120313 (Red Hat 4.4.7-16) Copyright © 2010 Free Software Foundation, Inc." />

  <meta name="keywords" content="MoeLove, Linux, Docker, Kubernetes" />


<meta name="baidu-site-verification" content="jO2rMlnjJi" />
<meta name="google-site-verification" content="googlefe3fc086c62f7210.html" />


<meta name="generator" content="Hugo 0.46" />


<link rel="canonical" href="http://moelove.info/2015/09/13/%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91MongoDB/" />

<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">







<link href="/dist/even.min.css?v=3.2.0" rel="stylesheet">
<link href="/lib/fancybox/jquery.fancybox-3.1.20.min.css" rel="stylesheet">




<meta property="og:title" content="源码编译MongoDB" />
<meta property="og:description" content="上周放假正好有时间，编译安装了MongoDB，虽然MongoDB用了挺长时间的，但还是第一次用源码编译。在此做个备忘。因为已经完整编译安装过了，所以写起来的时候，就按照先知视角来写了～ 2333
 下载MongoDB源码 MongoDB的官网上是有已经编译好的二进制包的，这里选择clone MongoDB在github上的仓库
git clone https://github.com/mongodb/mongo &amp;&amp; cd mongo  在docs/building.md中是编译所需的依赖。 * A modern C&#43;&#43; compiler. One of the following is required. * GCC 4.8.2 or newer * Clang 3.4 (or Apple XCode 5.1.1 Clang) or newer * Visual Studio 2013 Update 2 or newer * Python 2.7 * SCons 2.3
我这台服务器是CentOS 6.5, 上面的gcc版本比较低，这里就先更新gcc咯.
gcc --version gcc (GCC) 4.4.7 20120313 (Red Hat 4.4.7-16) Copyright © 2010 Free Software Foundation, Inc." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://moelove.info/2015/09/13/%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91MongoDB/" />



<meta property="article:published_time" content="2015-09-13T21:28:43&#43;00:00"/>

<meta property="article:modified_time" content="2015-09-13T21:28:43&#43;00:00"/>











<meta itemprop="name" content="源码编译MongoDB">
<meta itemprop="description" content="上周放假正好有时间，编译安装了MongoDB，虽然MongoDB用了挺长时间的，但还是第一次用源码编译。在此做个备忘。因为已经完整编译安装过了，所以写起来的时候，就按照先知视角来写了～ 2333
 下载MongoDB源码 MongoDB的官网上是有已经编译好的二进制包的，这里选择clone MongoDB在github上的仓库
git clone https://github.com/mongodb/mongo &amp;&amp; cd mongo  在docs/building.md中是编译所需的依赖。 * A modern C&#43;&#43; compiler. One of the following is required. * GCC 4.8.2 or newer * Clang 3.4 (or Apple XCode 5.1.1 Clang) or newer * Visual Studio 2013 Update 2 or newer * Python 2.7 * SCons 2.3
我这台服务器是CentOS 6.5, 上面的gcc版本比较低，这里就先更新gcc咯.
gcc --version gcc (GCC) 4.4.7 20120313 (Red Hat 4.4.7-16) Copyright © 2010 Free Software Foundation, Inc.">


<meta itemprop="datePublished" content="2015-09-13T21:28:43&#43;00:00" />
<meta itemprop="dateModified" content="2015-09-13T21:28:43&#43;00:00" />
<meta itemprop="wordCount" content="471">



<meta itemprop="keywords" content="Linux,MongoDB," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="源码编译MongoDB"/>
<meta name="twitter:description" content="上周放假正好有时间，编译安装了MongoDB，虽然MongoDB用了挺长时间的，但还是第一次用源码编译。在此做个备忘。因为已经完整编译安装过了，所以写起来的时候，就按照先知视角来写了～ 2333
 下载MongoDB源码 MongoDB的官网上是有已经编译好的二进制包的，这里选择clone MongoDB在github上的仓库
git clone https://github.com/mongodb/mongo &amp;&amp; cd mongo  在docs/building.md中是编译所需的依赖。 * A modern C&#43;&#43; compiler. One of the following is required. * GCC 4.8.2 or newer * Clang 3.4 (or Apple XCode 5.1.1 Clang) or newer * Visual Studio 2013 Update 2 or newer * Python 2.7 * SCons 2.3
我这台服务器是CentOS 6.5, 上面的gcc版本比较低，这里就先更新gcc咯.
gcc --version gcc (GCC) 4.4.7 20120313 (Red Hat 4.4.7-16) Copyright © 2010 Free Software Foundation, Inc."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">MoeLove</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a><a href="/friends/">
        <li class="mobile-menu-item">Friends</li>
      </a><a href="/projects/">
        <li class="mobile-menu-item">Projects</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a>
  </ul>
</nav>
  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">MoeLove</a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/friends/">Friends</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/projects/">Projects</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li>
  </ul>
</nav>
    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">源码编译MongoDB</h1>

      <div class="post-meta">
        <span class="post-time"> 2015-09-13 </span>
        <div class="post-category">
            
              <a href="/categories/linux/"> Linux </a>
            
          </div>
        
        
      </div>
    </header>

    
    
<div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#下载mongodb源码">下载MongoDB源码</a></li>
<li><a href="#编译升级gcc">编译升级gcc</a></li>
<li><a href="#升级python">升级Python</a></li>
<li><a href="#安装scons">安装scons</a></li>
<li><a href="#编译安装mongodb">编译安装MongoDB</a></li>
</ul></li>
</ul>
</nav>
  </div>
</div>

    
    

    
    <div class="post-content">
      

<blockquote>
<p>上周放假正好有时间，编译安装了MongoDB，虽然MongoDB用了挺长时间的，但还是第一次用源码编译。在此做个备忘。因为已经完整编译安装过了，所以写起来的时候，就按照先知视角来写了～ 2333</p>
</blockquote>

<h2 id="下载mongodb源码">下载MongoDB源码</h2>

<p>MongoDB的<a href="https://www.mongodb.org/">官网</a>上是有已经编译好的二进制包的，这里选择clone <a href="https://github.com/mongodb/mongo">MongoDB在github上的仓库</a></p>

<pre><code>git clone https://github.com/mongodb/mongo &amp;&amp; cd mongo
</code></pre>

<p>在<code>docs/building.md</code>中是编译所需的依赖。
* A modern C++ compiler. One of the following is required.
    * GCC 4.8.2 or newer
    * Clang 3.4 (or Apple XCode 5.1.1 Clang) or newer
    * Visual Studio 2013 Update 2 or newer
* Python 2.7
* SCons 2.3</p>

<p>我这台服务器是CentOS 6.5, 上面的gcc版本比较低，这里就先更新gcc咯.</p>

<pre><code>gcc --version
gcc (GCC) 4.4.7 20120313 (Red Hat 4.4.7-16)                                
Copyright © 2010 Free Software Foundation, Inc.                            
本程序是自由软件；请参看源代码的版权声明。
本软件没有任何担保；             
包括没有适销性和某一专用目的下的适用性担保。
</code></pre>

<h2 id="编译升级gcc">编译升级gcc</h2>

<p>在gcc的<a href="https://gcc.gnu.org/">官网</a>找到<a href="https://gcc.gnu.org/install/download.html">下载页面</a>。使用<a href="https://gcc.gnu.org/svn.html">svn</a>或者通过<a href="https://gcc.gnu.org/mirrors.html">ftp镜像站</a>下载源码.
我使用了<a href="http://ftp.tsukuba.wide.ad.jp/software/gcc/">一个ftp镜像站</a>下载的<a href="http://ftp.tsukuba.wide.ad.jp/software/gcc/releases/gcc-5.2.0/gcc-5.2.0.tar.bz2">源码压缩包</a>。 然后进行解压和安装依赖。</p>

<pre><code>tar -xjf gcc-5.2.0.tar.bz2 &amp;&amp; cd gcc-5.2.0

./contrib/download_prerequisites(等待依赖完成)
</code></pre>

<p>之后编译</p>

<pre><code>cd .. &amp;&amp; mkdir gcc-build-5.2.0 &amp;&amp; cd gcc-build-5.2.0

# 编译

../gcc-5.2.0/configure --enable-checking=release --enable-languages=c,c++ --disable-multilib
</code></pre>

<p>输出：</p>

<pre><code>checking build system type... x86_64-unknown-linux-gnu
checking host system type... x86_64-unknown-linux-gnu
checking target system type... x86_64-unknown-linux-gnu
checking for a BSD-compatible install... /usr/bin/install -c
checking whether ln works... yes
checking whether ln -s works... yes
checking for a sed that does not truncate output... /bin/sed
checking for gawk... gawk
checking for libatomic support... yes
checking for libcilkrts support... yes
checking for libitm support... yes
checking for libsanitizer support... yes
checking for libvtv support... yes
checking for gcc... gcc
checking for C compiler default output file name... a.out
checking whether the C compiler works... yes
checking whether we are cross compiling... no
checking for suffix of executables... 
checking for suffix of object files... o
checking whether we are using the GNU C compiler... yes
checking whether gcc accepts -g... yes
checking for gcc option to accept ISO C89... none needed
checking for g++... g++
checking whether we are using the GNU C++ compiler... yes
checking whether g++ accepts -g... yes
checking whether g++ accepts -static-libstdc++ -static-libgcc... no
checking for gnatbind... no
checking for gnatmake... no
checking whether compiler driver understands Ada... no
checking how to compare bootstrapped objects... cmp --ignore-initial=16 $$f1 $$f2
checking for objdir... .libs
configure: WARNING: using in-tree ISL, disabling version check
</code></pre>

<p>一般情况下， 就这样gcc就可以编译完成了。 但是因为我这台机器是单核1G没有swap区， 所以我遇到了下面的问题：</p>

<pre><code># 排版有点错乱惹...

build/vec.o
build/min-insn-modes.o
build/gensupport.o
build/print-rtl.o
build/read-md.o
build/errors.o ../build-x86_64-unknown-linux-gnu/libiberty/libiberty.a
build/genattrtab ../../gcc-5.2.0/gcc/common.md ../../gcc-5.2.0/gcc/config/i
386/i386.md insn-conditions.md \
                -Atmp-attrtab.c -Dtmp-dfatab.c -Ltmp-latencytab.c
make[3]: *** [s-attrtab] 已杀死
make[3]: Leaving directory `/home/tao/gcc-build-5.0.2/gcc'
make[2]: *** [all-stage1-gcc] 错误 2
make[2]: Leaving directory `/home/tao/gcc-build-5.0.2'
make[1]: *** [stage1-bubble] 错误 2
make[1]: Leaving directory `/home/tao/gcc-build-5.0.2'
make: *** [all] 错误 2

</code></pre>

<p>大致查了下，是因为没有swap区的原因，根据<a href="http://stackoverflow.com/questions/18389612/make-exits-with-error-2-when-trying-to-install-gcc-4-8-1#">这篇</a> 得到的解决办法是：</p>

<pre><code>SWAP=/tmp/swap
dd if=/dev/zero of=$SWAP bs=1M count=500
mkswap $SWAP
sudo swapon $SWAP
</code></pre>

<p>之后就是gcc 的编译时间了， 这个时间可以去写写代码补个番啥的。这台机器只是平时拿来玩的，配置炒鸡低。编译gcc从17：20开始，一直到20：09停止。(期间我去补番啦 2333)</p>

<pre><code># 只会执行下面的命令
make
make install
# 切换gcc到新版本
update-alternatives --install /usr/bin/gcc gcc /usr/local/bin/gcc-5.0.2 66
# 我重新ssh登录后才看到更新生效的
gcc --version
gcc (GCC) 5.2.0
Copyright © 2015 Free Software Foundation, Inc.
本程序是自由软件；请参看源代码的版权声明。本软件没有任何担保；
包括没有适销性和某一专用目的下的适用性担保。
</code></pre>

<h2 id="升级python">升级Python</h2>

<p>CentOS上默认的Python对于之后要安装的scons来说，还是版本太低。再次上<a href="https://www.python.org">Python 官网</a> (官网真是个好地方2333)下载Python2.7的<a href="https://www.python.org/ftp/python/2.7.10/Python-2.7.10.tar.xz">源码</a>
编译过很多次了， 就只写主要的东西了</p>

<pre><code>xz -d python-2.7.10.tar.xz
tar -xvf python-2.7.10.tar &amp;&amp; cd python-2.7.10
# 对于这次编译MongoDB来说，一定需要安装的是bzip2依赖
yum install -y bzip2-devel
# 编译
./configure --prefix=/usr/local/python2.7
make
make install
# 更新
update-alternatives --install /usr/bin/python python /usr/local/bin/python 69
</code></pre>

<h2 id="安装scons">安装scons</h2>

<p>在<a href="http://www.scons.org/">官网</a>上找到<a href="http://iweb.dl.sourceforge.net/project/scons/scons/2.3.6/scons-2.3.6.tar.gz">源码包</a>直接安装</p>

<pre><code># 依赖解决
yum install pcre-devel python-devel
# 解压安装
tar -zxvf scons-2.3.6.tar.gz &amp;&amp; cd scons-2.3.6
python setup.py install
</code></pre>

<h2 id="编译安装mongodb">编译安装MongoDB</h2>

<p>最后的安装过程就不是这篇里面的重点了， 遇到的一个坑是：</p>

<pre><code>Initializer* _theGlobalInitializer = &amp;getGlobalInitializer();
</code></pre>

<p>有这样的报错信息。 查了一下，根据<a href="https://jira.mongodb.org/browse/SERVER-19353">这篇</a>只要在构建的时候，加上<code>--disable-warnings-as-errors</code>就可以解决了</p>

<pre><code>scons all --disable-warnings-as-errors
# 其他的设置可以查看scons的相关文档
</code></pre>

<p>本篇的重点是编译的过程，后续MongoDB配置部分抽空再写。全文完。</p>

    </div>

    
    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content">TaoBeier</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">2015-09-13</span>
  </p>
  
  <p class="copyright-item">
    <span class="item-title">许可协议</span>
    <span class="item-content"><a rel="license noopener" href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank">CC BY-SA 4.0</a></span>
  </p>
</div>

    
    
<div class="post-reward">
  <input type="checkbox" name="reward" id="reward" hidden />
  <label class="reward-button" for="reward">赞赏支持</label>
  <div class="qr-code">
    
    
      <label class="qr-code-image" for="reward">
        <img class="image" src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/wx_pay.jpg">
        <span>微信打赏</span>
      </label>
    
      <label class="qr-code-image" for="reward">
        <img class="image" src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/alipay.jpg">
        <span>支付宝打赏</span>
      </label>
  </div>
</div>

    <footer class="post-footer">
      <div class="post-tags">
          
          <a href="/tags/linux/">Linux</a>
          
          <a href="/tags/mongodb/">MongoDB</a>
          
        </div>

      
      <nav class="post-nav">
        
          <a class="prev" href="/2015/10/13/Open-Falcon%E7%9B%91%E6%8E%A7%E7%B3%BB%E7%BB%9F%E9%83%A8%E7%BD%B2/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Open-Falcon监控系统部署</span>
            <span class="prev-text nav-mobile">上一篇</span>
          </a>
        
          <a class="next" href="/2015/07/21/%E9%87%8D%E7%BD%AEGhost%E5%8D%9A%E5%AE%A2%E7%9A%84%E5%AF%86%E7%A0%81/">
            <span class="next-text nav-default">重置Ghost博客的密码</span>
            <span class="next-text nav-mobile">下一篇</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        
  

  <div id="gitalk-container"></div>
  <link rel="stylesheet" href="/lib/gitalk/gitalk-1.2.2.min.css">
    <script src="/lib/gitalk/gitalk-1.2.2.min.js"></script>
  <script type="text/javascript">
  var gitalk = new Gitalk({
    id: '2015-09-13 21:28:43 \x2b0000 UTC',
    title: '源码编译MongoDB',
    clientID: '28ec994671d937a5706c',
    clientSecret: '865a6e85566c503fff42a8762f65cbdd548f71fd',
    repo: 'tao12345666333.github.io',
    owner: 'tao12345666333',
    admin: ['tao12345666333'],
    body: decodeURI(location.href)
  });
  gitalk.render('gitalk-container');
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://github.com/gitalk/gitalk">comments powered by gitalk.</a></noscript>

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:zhangjintao9020@gmail.com" class="iconfont icon-email" title="email"></a>
      <a href="https://plus.google.com/111099802544541897352" class="iconfont icon-google" title="google"></a>
      <a href="https://github.com/tao12345666333" class="iconfont icon-github" title="github"></a>
      <a href="http://weibo.com/9020taobeier" class="iconfont icon-weibo" title="weibo"></a>
      <a href="https://www.zhihu.com/people/TaoBeier" class="iconfont icon-zhihu" title="zhihu"></a>
  <a href="http://moelove.info/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    由 <a class="hexo-link" href="https://gohugo.io">Hugo</a> 强力驱动
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    主题 - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    
      2013 - 
    2018
    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">TaoBeier</span>
  </span>
</div>
    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
<script src="/lib/highlight/highlight.pack.js?v=20171001"></script><script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox-3.1.20.min.js"></script>


<script type="text/javascript" src="/dist/even.min.js?v=3.2.0"></script>








</body>
</html>
