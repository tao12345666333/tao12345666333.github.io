<?xml version="1.0" encoding="utf-8"?><rss xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title>MoeLove</title><link>https://moelove.info/</link><description>Jintao Zhang's Blog MoeLove. Container, Docker, Go, Kubernetes, Python, Vim.</description><generator>Hugo 0.84.0-DEV https://gohugo.io/</generator><language>zh-CN</language><managingEditor>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</managingEditor><webMaster>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</webMaster><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><lastBuildDate>Tue, 21 Dec 2021 11:04:16 +0800</lastBuildDate><atom:link rel="self" type="application/rss+xml" href="https://moelove.info/rss.xml"/><item><title>å€å—å…³æ³¨çš„ Cilium Service Mesh åˆ°åº•æ€ä¹ˆç©ï¼Ÿ - ä¸Šæ‰‹å®è·µ</title><link>https://moelove.info/2021/12/21/%E5%80%8D%E5%8F%97%E5%85%B3%E6%B3%A8%E7%9A%84-Cilium-Service-Mesh-%E5%88%B0%E5%BA%95%E6%80%8E%E4%B9%88%E7%8E%A9-%E4%B8%8A%E6%89%8B%E5%AE%9E%E8%B7%B5/</link><guid isPermaLink="true">https://moelove.info/2021/12/21/%E5%80%8D%E5%8F%97%E5%85%B3%E6%B3%A8%E7%9A%84-Cilium-Service-Mesh-%E5%88%B0%E5%BA%95%E6%80%8E%E4%B9%88%E7%8E%A9-%E4%B8%8A%E6%89%8B%E5%AE%9E%E8%B7%B5/</guid><pubDate>Tue, 21 Dec 2021 02:30:17 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å¼ æ™‹æ¶›ã€‚&lt;/p>
&lt;p>Cilium æ˜¯ä¸€ä¸ªåŸºäº eBPF æŠ€æœ¯ï¼Œç”¨äºä¸ºå®¹å™¨å·¥ä½œè´Ÿè½½é—´æä¾›å®‰å…¨ä¸”å…·å¤‡å¯è§‚æµ‹æ€§çš„ç½‘ç»œè¿æ¥çš„å¼€æºè½¯ä»¶ã€‚&lt;/p>
&lt;p>å¦‚æœä½ å¯¹ Cilium è¿˜ä¸å¤ªäº†è§£ï¼Œå¯ä»¥å‚è€ƒæˆ‘ä¹‹å‰çš„ä¸¤ç¯‡æ–‡ç« ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://zhuanlan.zhihu.com/p/195759300">K8Sç”Ÿæ€å‘¨æŠ¥| Google é€‰æ‹© Cilium ä½œä¸º GKE ä¸‹ä¸€ä»£æ•°æ®é¢&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://zhuanlan.zhihu.com/p/213745089">Cilium ä¸Šæ‰‹å®è·µ&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>æœ€è¿‘&lt;a href="https://github.com/cilium/cilium/releases/tag/v1.11.0"> Cilium v1.11.0 æ­£å¼å‘å¸ƒäº†&lt;/a>ï¼Œå¢åŠ  Open Telemetry çš„æ”¯æŒä»¥åŠå…¶ä»–ä¸€äº›å¢å¼ºç‰¹æ€§ã€‚åŒæ—¶ï¼Œä¹Ÿå®£å¸ƒäº† Cilium Service Mesh çš„è®¡åˆ’ã€‚å½“å‰ Cilium Service Mesh æ­£å¤„äºæµ‹è¯•é˜¶æ®µï¼Œé¢„æœŸåœ¨ 2022 å¹´ä¼šåˆå¹¶åˆ° Cilium v1.12 ç‰ˆæœ¬ä¸­ã€‚&lt;/p>
&lt;p>Cilium Service Mesh ä¹Ÿå¸¦æ¥äº†ä¸€ä¸ªå…¨æ–°çš„æ¨¡å¼ã€‚&lt;/p>
&lt;p>Cilium ç›´æ¥é€šè¿‡ eBPF æŠ€æœ¯å®ç°çš„ Service Mesh ç›¸æ¯”æˆ‘ä»¬å¸¸è§„çš„ Istio/Linkerd ç­‰æ–¹æ¡ˆï¼Œæœ€æ˜¾è‘—çš„ç‰¹ç‚¹å°±æ˜¯å°† Sidecar proxy æ¨¡å‹æ›¿æ¢æˆäº† Kernel æ¨¡å‹ï¼Œ å¦‚ä¸‹å›¾ï¼š&lt;/p>
&lt;p>&lt;img src="https://s2.loli.net/2021/12/21/IkKCZvgOA5priP2.png" alt="img">&lt;/p>
&lt;p>ä¸å†éœ€è¦æ¯ä¸ªåº”ç”¨ç¨‹åºæ—è¾¹éƒ½æ”¾ç½®ä¸€ä¸ª Sidecar äº†ï¼Œç›´æ¥åœ¨æ¯å° Node ä¸Šæä¾›æ”¯æŒã€‚&lt;/p>
&lt;p>&lt;img src="https://s2.loli.net/2021/12/21/3gwSD2GXdcuBNKH.png" alt="img">&lt;/p>
&lt;p>æˆ‘åœ¨å‡ ä¸ªæœˆå‰å°±å·²ç»çŸ¥é“äº†è¿™ä¸ªæ¶ˆæ¯å¹¶ä¸”è¿›è¡Œäº†ä¸€äº›è®¨è®ºï¼Œæœ€è¿‘éšç€ isovalent çš„ä¸€ç¯‡æ–‡ç«  &lt;a href="https://isovalent.com/blog/post/2021-12-08-ebpf-servicemesh">How eBPF will solve Service Mesh - Goodbye Sidecars&lt;/a> ï¼ŒCilium Service Mesh ä¹Ÿæˆä¸ºäº†å¤§å®¶å…³æ³¨çš„ç„¦ç‚¹ã€‚&lt;/p>
&lt;p>æœ¬ç¯‡æˆ‘å¸¦ä½ å®é™…ä½“éªŒä¸‹ Cilium Service Meshã€‚&lt;/p>
&lt;h2 id="å®‰è£…éƒ¨ç½²">å®‰è£…éƒ¨ç½²&lt;/h2>
&lt;p>è¿™é‡Œæˆ‘ä½¿ç”¨ KIND ä½œä¸ºæµ‹è¯•ç¯å¢ƒï¼Œæˆ‘çš„å†…æ ¸ç‰ˆæœ¬æ˜¯ 5.15.8 ã€‚&lt;/p>
&lt;h3 id="å‡†å¤‡-kind-é›†ç¾¤">å‡†å¤‡ KIND é›†ç¾¤&lt;/h3>
&lt;p>å…³äº KIND å‘½ä»¤è¡Œå·¥å…·çš„å®‰è£…è¿™é‡Œå°±ä¸å†èµ˜è¿°äº†ï¼Œæ„Ÿå…´è¶£çš„å°ä¼™ä¼´å¯ä»¥å‚è€ƒæˆ‘ä¹‹å‰çš„æ–‡ç«  ã€Šä½¿ç”¨KINDæ­å»ºè‡ªå·±çš„æœ¬åœ° Kubernetes æµ‹è¯•ç¯å¢ƒã€‹ã€‚&lt;/p>
&lt;p>ä»¥ä¸‹æ˜¯æˆ‘åˆ›å»ºé›†ç¾¤ä½¿ç”¨çš„é…ç½®æ–‡ä»¶ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">kind.x-k8s.io/v1alpha4&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Cluster&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">nodes&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>- &lt;span class="nt">role&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">control-plane&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>- &lt;span class="nt">role&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">worker&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>- &lt;span class="nt">role&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">worker&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>- &lt;span class="nt">role&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">worker&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">networking&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">disableDefaultCNI&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åˆ›å»ºé›†ç¾¤ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">âœ cilium-mesh kind create cluster --config kind-config.yaml
Creating cluster &lt;span class="s2">&amp;#34;kind&amp;#34;&lt;/span> ...
âœ“ Ensuring node image &lt;span class="o">(&lt;/span>kindest/node:v1.22.4&lt;span class="o">)&lt;/span> ğŸ–¼
âœ“ Preparing nodes ğŸ“¦ ğŸ“¦ ğŸ“¦ ğŸ“¦
âœ“ Writing configuration ğŸ“œ
âœ“ Starting control-plane ğŸ•¹ï¸
âœ“ Installing StorageClass ğŸ’¾
âœ“ Joining worker nodes ğŸšœ
Set kubectl context to &lt;span class="s2">&amp;#34;kind-kind&amp;#34;&lt;/span>
You can now use your cluster with:
kubectl cluster-info --context kind-kind
Not sure what to &lt;span class="k">do&lt;/span> next? ğŸ˜… Check out https://kind.sigs.k8s.io/docs/user/quick-start/
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="å®‰è£…-cilium-cli">å®‰è£… Cilium CLI&lt;/h3>
&lt;p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ Cilium CLI å·¥å…·è¿›è¡Œ Cilium çš„éƒ¨ç½²ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">âœ cilium-mesh curl -L --remote-name-all https://github.com/cilium/cilium-cli/releases/latest/download/cilium-linux-amd64.tar.gz&lt;span class="se">\{&lt;/span>,.sha256sum&lt;span class="se">\}&lt;/span>
&lt;span class="o">[&lt;/span>1/2&lt;span class="o">]&lt;/span>: https://github.com/cilium/cilium-cli/releases/latest/download/cilium-linux-amd64.tar.gz --&amp;gt; cilium-linux-amd64.tar.gz
--_curl_--https://github.com/cilium/cilium-cli/releases/latest/download/cilium-linux-amd64.tar.gz
% Total % Received % Xferd Average Speed Time Time Time Current
Dload Upload Total Spent Left Speed
&lt;span class="m">100&lt;/span> &lt;span class="m">154&lt;/span> &lt;span class="m">100&lt;/span> &lt;span class="m">154&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="m">243&lt;/span> &lt;span class="m">0&lt;/span> --:--:-- --:--:-- --:--:-- &lt;span class="m">242&lt;/span>
&lt;span class="m">100&lt;/span> &lt;span class="m">664&lt;/span> &lt;span class="m">100&lt;/span> &lt;span class="m">664&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="m">579&lt;/span> &lt;span class="m">0&lt;/span> 0:00:01 0:00:01 --:--:-- &lt;span class="m">579&lt;/span>
&lt;span class="m">100&lt;/span> 14.6M &lt;span class="m">100&lt;/span> 14.6M &lt;span class="m">0&lt;/span> &lt;span class="m">0&lt;/span> 2928k &lt;span class="m">0&lt;/span> 0:00:05 0:00:05 --:--:-- 3910k
&lt;span class="o">[&lt;/span>2/2&lt;span class="o">]&lt;/span>: https://github.com/cilium/cilium-cli/releases/latest/download/cilium-linux-amd64.tar.gz.sha256sum --&amp;gt; cilium-linux-amd64.tar.gz.sha256sum
--_curl_--https://github.com/cilium/cilium-cli/releases/latest/download/cilium-linux-amd64.tar.gz.sha256sum
% Total % Received % Xferd Average Speed Time Time Time Current
Dload Upload Total Spent Left Speed
&lt;span class="m">100&lt;/span> &lt;span class="m">164&lt;/span> &lt;span class="m">100&lt;/span> &lt;span class="m">164&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="m">419&lt;/span> &lt;span class="m">0&lt;/span> --:--:-- --:--:-- --:--:-- &lt;span class="m">418&lt;/span>
&lt;span class="m">100&lt;/span> &lt;span class="m">674&lt;/span> &lt;span class="m">100&lt;/span> &lt;span class="m">674&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="m">861&lt;/span> &lt;span class="m">0&lt;/span> --:--:-- --:--:-- --:--:-- &lt;span class="m">861&lt;/span>
&lt;span class="m">100&lt;/span> &lt;span class="m">92&lt;/span> &lt;span class="m">100&lt;/span> &lt;span class="m">92&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="m">67&lt;/span> &lt;span class="m">0&lt;/span> 0:00:01 0:00:01 --:--:-- &lt;span class="m">0&lt;/span>
âœ cilium-mesh ls
cilium-linux-amd64.tar.gz cilium-linux-amd64.tar.gz.sha256sum kind-config.yaml
âœ cilium-mesh tar -zxvf cilium-linux-amd64.tar.gz
cilium
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="åŠ è½½é•œåƒ">åŠ è½½é•œåƒ&lt;/h3>
&lt;p>åœ¨éƒ¨ç½² Cilium çš„è¿‡ç¨‹ä¸­éœ€è¦ä¸€äº›é•œåƒï¼Œæˆ‘ä»¬å¯ä»¥æå‰ä¸‹è½½ååŠ è½½åˆ° KIND çš„ Node èŠ‚ç‚¹ä¸­ã€‚å¦‚æœä½ çš„ç½‘ç»œæ¯”è¾ƒé¡ºç•…ï¼Œ é‚£è¿™ä¸€æ­¥å¯ä»¥è·³è¿‡ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">âœ cilium-mesh &lt;span class="nv">ciliumMeshImage&lt;/span>&lt;span class="o">=(&lt;/span>&lt;span class="s2">&amp;#34;quay.io/cilium/cilium-service-mesh:v1.11.0-beta.1&amp;#34;&lt;/span> &lt;span class="s2">&amp;#34;quay.io/cilium/operator-generic-service-mesh:v1.11.0-beta.1&amp;#34;&lt;/span> &lt;span class="s2">&amp;#34;quay.io/cilium/hubble-relay-service-mesh:v1.11.0-beta.1&amp;#34;&lt;/span>&lt;span class="o">)&lt;/span>
âœ cilium-mesh &lt;span class="k">for&lt;/span> i in &lt;span class="si">${&lt;/span>&lt;span class="nv">ciliumMeshImage&lt;/span>&lt;span class="p">[@]&lt;/span>&lt;span class="si">}&lt;/span>
&lt;span class="k">do&lt;/span>
docker pull &lt;span class="nv">$i&lt;/span>
kind load docker-image &lt;span class="nv">$i&lt;/span>
&lt;span class="k">done&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="éƒ¨ç½²-cilium">éƒ¨ç½² cilium&lt;/h3>
&lt;p>æ¥ä¸‹æ¥æˆ‘ä»¬ç›´æ¥ä½¿ç”¨ Cilium CLI å®Œæˆéƒ¨ç½²ã€‚æ³¨æ„è¿™é‡Œçš„å‚æ•°ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">âœ cilium-mesh cilium install --version -service-mesh:v1.11.0-beta.1 --config enable-envoy-config&lt;span class="o">=&lt;/span>&lt;span class="nb">true&lt;/span> --kube-proxy-replacement&lt;span class="o">=&lt;/span>probe --agent-image&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;quay.io/cilium/cilium-service-mesh:v1.11.0-beta.1&amp;#39;&lt;/span> --operator-image&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;quay.io/cilium/operator-generic-service-mesh:v1.11.0-beta.1&amp;#39;&lt;/span> --datapath-mode&lt;span class="o">=&lt;/span>vxlan
ğŸ”® Auto-detected Kubernetes kind: kind
âœ¨ Running &lt;span class="s2">&amp;#34;kind&amp;#34;&lt;/span> validation checks
âœ… Detected kind version &lt;span class="s2">&amp;#34;0.12.0&amp;#34;&lt;/span>
â„¹ï¸ using Cilium version &lt;span class="s2">&amp;#34;-service-mesh:v1.11.0-beta.1&amp;#34;&lt;/span>
ğŸ”® Auto-detected cluster name: kind-kind
ğŸ”® Auto-detected IPAM mode: kubernetes
ğŸ”® Custom datapath mode: vxlan
ğŸ”‘ Found CA in secret cilium-ca
ğŸ”‘ Generating certificates &lt;span class="k">for&lt;/span> Hubble...
ğŸš€ Creating Service accounts...
ğŸš€ Creating Cluster roles...
ğŸš€ Creating ConfigMap &lt;span class="k">for&lt;/span> Cilium version 1.11.0...
â„¹ï¸ Manual overwrite in ConfigMap: enable-envoy-config&lt;span class="o">=&lt;/span>&lt;span class="nb">true&lt;/span>
ğŸš€ Creating Agent DaemonSet...
ğŸš€ Creating Operator Deployment...
âŒ› Waiting &lt;span class="k">for&lt;/span> Cilium to be installed and ready...
âœ… Cilium was successfully installed! Run &lt;span class="s1">&amp;#39;cilium status&amp;#39;&lt;/span> to view installation health
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="æŸ¥çœ‹çŠ¶æ€">æŸ¥çœ‹çŠ¶æ€&lt;/h3>
&lt;p>åœ¨å®‰è£…æˆåŠŸåï¼Œ å¯ä»¥é€šè¿‡ &lt;code>cilium status&lt;/code>å‘½ä»¤æ¥æŸ¥çœ‹å½“å‰ Cilium çš„éƒ¨ç½²æƒ…å†µã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">âœ cilium-mesh cilium status
/Â¯Â¯&lt;span class="se">\
&lt;/span>&lt;span class="se">&lt;/span> /Â¯Â¯&lt;span class="se">\_&lt;/span>_/Â¯Â¯&lt;span class="se">\ &lt;/span> Cilium: OK
&lt;span class="se">\_&lt;/span>_/Â¯Â¯&lt;span class="se">\_&lt;/span>_/ Operator: OK
/Â¯Â¯&lt;span class="se">\_&lt;/span>_/Â¯Â¯&lt;span class="se">\ &lt;/span> Hubble: disabled
&lt;span class="se">\_&lt;/span>_/Â¯Â¯&lt;span class="se">\_&lt;/span>_/ ClusterMesh: disabled
&lt;span class="se">\_&lt;/span>_/
Deployment cilium-operator Desired: 1, Ready: 1/1, Available: 1/1
DaemonSet cilium Desired: 4, Ready: 4/4, Available: 4/4
Containers: cilium Running: &lt;span class="m">4&lt;/span>
cilium-operator Running: &lt;span class="m">1&lt;/span>
Cluster Pods: 3/3 managed by Cilium
Image versions cilium quay.io/cilium/cilium-service-mesh:v1.11.0-beta.1: &lt;span class="m">4&lt;/span>
cilium-operator quay.io/cilium/operator-generic-service-mesh:v1.11.0-beta.1: &lt;span class="m">1&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>â€‹&lt;/p>
&lt;h3 id="å¯ç”¨-hubble">å¯ç”¨ Hubble&lt;/h3>
&lt;p>Hubble ä¸»è¦æ˜¯ç”¨æ¥æä¾›å¯è§‚æµ‹èƒ½åŠ›çš„ã€‚åœ¨å¯ç”¨å®ƒä¹‹å‰ï¼Œéœ€è¦å…ˆåŠ è½½ä¸€ä¸ªé•œåƒï¼Œå¦‚æœç½‘ç»œç•…é€šå¯ä»¥è·³è¿‡ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">docker.io/envoyproxy/envoy:v1.18.2@sha256:e8b37c1d75787dd1e712ff389b0d37337dc8a174a63bed9c34ba73359dc67da7
&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç„¶åä½¿ç”¨ Cilium CLI å¼€å¯ Hubble ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">âœ cilium-mesh cilium hubble &lt;span class="nb">enable&lt;/span> --relay-image&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;quay.io/cilium/hubble-relay-service-mesh:v1.11.0-beta.1&amp;#39;&lt;/span> --ui
ğŸ”‘ Found CA in secret cilium-ca
âœ¨ Patching ConfigMap cilium-config to &lt;span class="nb">enable&lt;/span> Hubble...
â™»ï¸ Restarted Cilium pods
âŒ› Waiting &lt;span class="k">for&lt;/span> Cilium to become ready before deploying other Hubble component&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span>...
ğŸ”‘ Generating certificates &lt;span class="k">for&lt;/span> Relay...
âœ¨ Deploying Relay from quay.io/cilium/hubble-relay-service-mesh:v1.11.0-beta.1...
âœ¨ Deploying Hubble UI from quay.io/cilium/hubble-ui:v0.8.3 and Hubble UI Backend from quay.io/cilium/hubble-ui-backend:v0.8.3...
âŒ› Waiting &lt;span class="k">for&lt;/span> Hubble to be installed...
/Â¯Â¯&lt;span class="se">\ &lt;/span>
/Â¯Â¯&lt;span class="se">\_&lt;/span>_/Â¯Â¯&lt;span class="se">\ &lt;/span> Cilium: OK
&lt;span class="se">\_&lt;/span>_/Â¯Â¯&lt;span class="se">\_&lt;/span>_/ Operator: OK
/Â¯Â¯&lt;span class="se">\_&lt;/span>_/Â¯Â¯&lt;span class="se">\ &lt;/span> Hubble: OK
&lt;span class="se">\_&lt;/span>_/Â¯Â¯&lt;span class="se">\_&lt;/span>_/ ClusterMesh: disabled
&lt;span class="se">\_&lt;/span>_/
DaemonSet cilium Desired: 4, Ready: 4/4, Available: 4/4
Deployment cilium-operator Desired: 1, Ready: 1/1, Available: 1/1
Deployment hubble-relay Desired: 1, Ready: 1/1, Available: 1/1
Deployment hubble-ui Desired: 1, Unavailable: 1/1
Containers: cilium Running: &lt;span class="m">4&lt;/span>
cilium-operator Running: &lt;span class="m">1&lt;/span>
hubble-relay Running: &lt;span class="m">1&lt;/span>
hubble-ui Running: &lt;span class="m">1&lt;/span>
Cluster Pods: 5/5 managed by Cilium
Image versions cilium quay.io/cilium/cilium-service-mesh:v1.11.0-beta.1: &lt;span class="m">4&lt;/span>
cilium-operator quay.io/cilium/operator-generic-service-mesh:v1.11.0-beta.1: &lt;span class="m">1&lt;/span>
hubble-relay quay.io/cilium/hubble-relay-service-mesh:v1.11.0-beta.1: &lt;span class="m">1&lt;/span>
hubble-ui quay.io/cilium/hubble-ui:v0.8.3: &lt;span class="m">1&lt;/span>
hubble-ui quay.io/cilium/hubble-ui-backend:v0.8.3: &lt;span class="m">1&lt;/span>
hubble-ui docker.io/envoyproxy/envoy:v1.18.2@sha256:e8b37c1d75787dd1e712ff389b0d37337dc8a174a63bed9c34ba73359dc67da7: &lt;span class="m">1&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="æµ‹è¯•-7-å±‚-ingress-æµé‡ç®¡ç†">æµ‹è¯• 7 å±‚ Ingress æµé‡ç®¡ç†&lt;/h2>
&lt;h3 id="å®‰è£…lb">å®‰è£…LB&lt;/h3>
&lt;p>è¿™é‡Œæˆ‘ä»¬å¯ä»¥ç»™ KIND é›†ç¾¤ä¸­å®‰è£… MetaLB ï¼Œä»¥ä¾¿äºæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ LoadBalancer ç±»å‹çš„ svc èµ„æºï¼ˆCilium ä¼šé»˜è®¤åˆ›å»ºä¸€ä¸ª LoadBalancer ç±»å‹çš„ svcï¼‰ã€‚å¦‚æœä¸å®‰è£… MetaLB ï¼Œé‚£ä¹Ÿå¯ä»¥ä½¿ç”¨ NodePort çš„æ–¹å¼æ¥è¿›è¡Œæ›¿ä»£ã€‚&lt;/p>
&lt;p>å…·ä½“è¿‡ç¨‹å°±ä¸ä¸€ä¸€ä»‹ç»äº†ï¼Œç›´æ¥æŒ‰ä¸‹è¿°æ“ä½œæ­¥éª¤æ‰§è¡Œå³å¯ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">âœ cilium-mesh kubectl apply -f https://raw.githubusercontent.com/metallb/metallb/master/manifests/namespace.yaml
namespace/metallb-system created
âœ cilium-mesh kubectl create secret generic -n metallb-system memberlist --from-literal&lt;span class="o">=&lt;/span>&lt;span class="nv">secretkey&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="k">$(&lt;/span>openssl rand -base64 128&lt;span class="k">)&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
secret/memberlist created
âœ cilium-mesh kubectl apply -f https://raw.githubusercontent.com/metallb/metallb/master/manifests/metallb.yaml
Warning: policy/v1beta1 PodSecurityPolicy is deprecated in v1.21+, unavailable in v1.25+
podsecuritypolicy.policy/controller created
podsecuritypolicy.policy/speaker created
serviceaccount/controller created
serviceaccount/speaker created
clusterrole.rbac.authorization.k8s.io/metallb-system:controller created
clusterrole.rbac.authorization.k8s.io/metallb-system:speaker created
role.rbac.authorization.k8s.io/config-watcher created
role.rbac.authorization.k8s.io/pod-lister created
role.rbac.authorization.k8s.io/controller created
clusterrolebinding.rbac.authorization.k8s.io/metallb-system:controller created
clusterrolebinding.rbac.authorization.k8s.io/metallb-system:speaker created
rolebinding.rbac.authorization.k8s.io/config-watcher created
rolebinding.rbac.authorization.k8s.io/pod-lister created
rolebinding.rbac.authorization.k8s.io/controller created
daemonset.apps/speaker created
deployment.apps/controller created
âœ cilium-mesh docker network inspect -f &lt;span class="s1">&amp;#39;{{.IPAM.Config}}&amp;#39;&lt;/span> kind
&lt;span class="o">[{&lt;/span>172.18.0.0/16 172.18.0.1 map&lt;span class="o">[]}&lt;/span> &lt;span class="o">{&lt;/span>fc00:f853:ccd:e793::/64 fc00:f853:ccd:e793::1 map&lt;span class="o">[]}]&lt;/span>
âœ cilium-mesh vim kind-lb-cm.yaml
âœ cilium-mesh cat kind-lb-cm.yaml
apiVersion: v1
kind: ConfigMap
metadata:
namespace: metallb-system
name: config
data:
config: &lt;span class="p">|&lt;/span>
address-pools:
- name: default
protocol: layer2
addresses:
- 172.18.255.200-172.18.255.250
âœ cilium-mesh kubectl apply -f kind-lb-cm.yaml
configmap/config created
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="åŠ è½½é•œåƒ-1">åŠ è½½é•œåƒ&lt;/h3>
&lt;p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ &lt;code>hashicorp/http-echo:0.2.3&lt;/code>ä½œä¸ºç¤ºä¾‹ç¨‹åºï¼Œå®ƒä»¬å¯ä»¥æŒ‰ç…§å¯åŠ¨å‚æ•°çš„ä¸åŒå“åº”ä¸åŒçš„å†…å®¹ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">âœ cilium-mesh docker pull hashicorp/http-echo:0.2.3
0.2.3: Pulling from hashicorp/http-echo
86399148984b: Pull &lt;span class="nb">complete&lt;/span>
Digest: sha256:ba27d460cd1f22a1a4331bdf74f4fccbc025552357e8a3249c40ae216275de96
Status: Downloaded newer image &lt;span class="k">for&lt;/span> hashicorp/http-echo:0.2.3
docker.io/hashicorp/http-echo:0.2.3
âœ cilium-mesh kind load docker-image hashicorp/http-echo:0.2.3
Image: &lt;span class="s2">&amp;#34;hashicorp/http-echo:0.2.3&amp;#34;&lt;/span> with ID &lt;span class="s2">&amp;#34;sha256:a6838e9a6ff6ab3624720a7bd36152dda540ce3987714398003e14780e61478a&amp;#34;&lt;/span> not yet present on node &lt;span class="s2">&amp;#34;kind-worker&amp;#34;&lt;/span>, loading...
Image: &lt;span class="s2">&amp;#34;hashicorp/http-echo:0.2.3&amp;#34;&lt;/span> with ID &lt;span class="s2">&amp;#34;sha256:a6838e9a6ff6ab3624720a7bd36152dda540ce3987714398003e14780e61478a&amp;#34;&lt;/span> not yet present on node &lt;span class="s2">&amp;#34;kind-worker2&amp;#34;&lt;/span>, loading...
Image: &lt;span class="s2">&amp;#34;hashicorp/http-echo:0.2.3&amp;#34;&lt;/span> with ID &lt;span class="s2">&amp;#34;sha256:a6838e9a6ff6ab3624720a7bd36152dda540ce3987714398003e14780e61478a&amp;#34;&lt;/span> not yet present on node &lt;span class="s2">&amp;#34;kind-control-plane&amp;#34;&lt;/span>, loading...
Image: &lt;span class="s2">&amp;#34;hashicorp/http-echo:0.2.3&amp;#34;&lt;/span> with ID &lt;span class="s2">&amp;#34;sha256:a6838e9a6ff6ab3624720a7bd36152dda540ce3987714398003e14780e61478a&amp;#34;&lt;/span> not yet present on node &lt;span class="s2">&amp;#34;kind-worker3&amp;#34;&lt;/span>, loading...
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="éƒ¨ç½²æµ‹è¯•æœåŠ¡">éƒ¨ç½²æµ‹è¯•æœåŠ¡&lt;/h3>
&lt;p>&lt;strong>æœ¬æ–‡ä¸­çš„æ‰€æœ‰é…ç½®æ–‡ä»¶å‡å¯åœ¨ &lt;a href="https://github.com/tao12345666333/practical-kubernetes/tree/main/cilium-mesh">https://github.com/tao12345666333/practical-kubernetes/tree/main/cilium-mesh&lt;/a> ä»£ç ä»“åº“ä¸­è·å–ã€‚&lt;/strong>&lt;/p>
&lt;p>æˆ‘ä»¬ä½¿ç”¨å¦‚ä¸‹é…ç½®è¿›è¡Œæµ‹è¯•æœåŠ¡çš„éƒ¨ç½²ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Pod&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">labels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">run&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">foo-app&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">foo-app&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">containers&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">image&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">hashicorp/http-echo:0.2.3&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">args&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="s2">&amp;#34;-text=foo&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">foo-app&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">ports&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">containerPort&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">5678&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">resources&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>{}&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">dnsPolicy&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ClusterFirst&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">restartPolicy&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Always&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">status&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>{}&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nn">---&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Service&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">labels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">run&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">foo-app&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">foo-app&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">ports&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">port&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">5678&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">protocol&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">TCP&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">targetPort&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">5678&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">selector&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">run&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">foo-app&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nn">---&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Pod&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">labels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">run&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">bar-app&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">bar-app&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">containers&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">image&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">hashicorp/http-echo:0.2.3&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">args&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="s2">&amp;#34;-text=bar&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">bar-app&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">ports&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">containerPort&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">5678&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">resources&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>{}&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">dnsPolicy&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ClusterFirst&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">restartPolicy&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Always&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nn">---&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Service&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">labels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">run&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">bar-app&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">bar-app&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">ports&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">port&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">5678&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">protocol&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">TCP&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">targetPort&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">5678&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">selector&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">run&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">bar-app&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ–°å»ºå¦‚ä¸‹çš„ Ingress èµ„æºæ–‡ä»¶ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">networking.k8s.io/v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Ingress&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">cilium-ingress&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">namespace&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">default&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">ingressClassName&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">cilium&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">rules&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">http&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">paths&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">backend&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">service&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">foo-app&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">port&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">number&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">5678&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">path&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/foo&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">pathType&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Prefix&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">backend&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">service&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">bar-app&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">port&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">number&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">5678&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">path&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/bar&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">pathType&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Prefix&lt;/span>&lt;span class="w">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åˆ›å»º Ingress èµ„æºï¼Œç„¶åå¯ä»¥çœ‹åˆ°äº§ç”Ÿäº†ä¸€ä¸ªæ–°çš„ LoadBalancer ç±»å‹çš„ svc ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">âœ cilium-mesh kubectl apply -f cilium-ingress.yaml
ingress.networking.k8s.io/cilium-ingress created
âœ cilium-mesh kubectl get svc
NAME TYPE CLUSTER-IP EXTERNAL-IP PORT&lt;span class="o">(&lt;/span>S&lt;span class="o">)&lt;/span> AGE
bar-app ClusterIP 10.96.229.141 &amp;lt;none&amp;gt; 5678/TCP 106s
cilium-ingress-cilium-ingress LoadBalancer 10.96.161.128 172.18.255.200 80:31643/TCP 4s
foo-app ClusterIP 10.96.166.212 &amp;lt;none&amp;gt; 5678/TCP 106s
kubernetes ClusterIP 10.96.0.1 &amp;lt;none&amp;gt; 443/TCP 81m
âœ cilium-mesh kubectl get ing
NAME CLASS HOSTS ADDRESS PORTS AGE
cilium-ingress cilium * 172.18.255.200 &lt;span class="m">80&lt;/span> 1m
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="æµ‹è¯•">æµ‹è¯•&lt;/h3>
&lt;p>ä½¿ç”¨ curl å‘½ä»¤è¿›è¡Œæµ‹è¯•è®¿é—®ï¼Œå‘ç°å¯ä»¥æŒ‰ç…§ Ingress èµ„æºä¸­çš„é…ç½®å¾—åˆ°æ­£ç¡®çš„å“åº”ã€‚æŸ¥çœ‹å“åº”å¤´ï¼Œæˆ‘ä»¬ä¼šå‘ç°è¿™é‡Œçš„ä»£ç†å®é™…ä¸Šè¿˜æ˜¯ä½¿ç”¨çš„ Envoy æ¥å®Œæˆçš„ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">âœ cilium-mesh curl 172.18.255.200
âœ cilium-mesh curl 172.18.255.200/foo
foo
âœ cilium-mesh curl 172.18.255.200/bar
bar
âœ cilium-mesh curl -I 172.18.255.200/bar
HTTP/1.1 &lt;span class="m">200&lt;/span> OK
Content-Length: &lt;span class="m">4&lt;/span>
Connection: keep-alive
Content-Type: text/plain&lt;span class="p">;&lt;/span> &lt;span class="nv">charset&lt;/span>&lt;span class="o">=&lt;/span>utf-8
Date: Sat, &lt;span class="m">18&lt;/span> Dec &lt;span class="m">2021&lt;/span> 06:02:56 GMT
Keep-Alive: &lt;span class="nv">timeout&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">4&lt;/span>
Proxy-Connection: keep-alive
Server: envoy
X-App-Name: http-echo
X-App-Version: 0.2.3
X-Envoy-Upstream-Service-Time: &lt;span class="m">0&lt;/span>
âœ cilium-mesh curl -I 172.18.255.200/foo
HTTP/1.1 &lt;span class="m">200&lt;/span> OK
Content-Length: &lt;span class="m">4&lt;/span>
Connection: keep-alive
Content-Type: text/plain&lt;span class="p">;&lt;/span> &lt;span class="nv">charset&lt;/span>&lt;span class="o">=&lt;/span>utf-8
Date: Sat, &lt;span class="m">18&lt;/span> Dec &lt;span class="m">2021&lt;/span> 06:03:01 GMT
Keep-Alive: &lt;span class="nv">timeout&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">4&lt;/span>
Proxy-Connection: keep-alive
Server: envoy
X-App-Name: http-echo
X-App-Version: 0.2.3
X-Envoy-Upstream-Service-Time: &lt;span class="m">0&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="æµ‹è¯•-ciliumenvoyconfig">æµ‹è¯• CiliumEnvoyConfig&lt;/h2>
&lt;p>åœ¨ä½¿ç”¨ä¸Šè¿°æ–¹å¼éƒ¨ç½² CIlium åï¼Œ å®ƒå…¶å®è¿˜å®‰è£…äº†ä¸€äº› CRD èµ„æºã€‚å…¶ä¸­æœ‰ä¸€ä¸ªæ˜¯ &lt;code>CiliumEnvoyConfig&lt;/code>ç”¨äºé…ç½®æœåŠ¡ä¹‹é—´ä»£ç†çš„ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">âœ cilium-mesh kubectl api-resources &lt;span class="p">|&lt;/span>grep cilium.io
ciliumclusterwidenetworkpolicies ccnp cilium.io/v2 &lt;span class="nb">false&lt;/span> CiliumClusterwideNetworkPolicy
ciliumendpoints cep,ciliumep cilium.io/v2 &lt;span class="nb">true&lt;/span> CiliumEndpoint
ciliumenvoyconfigs cec cilium.io/v2alpha1 &lt;span class="nb">false&lt;/span> CiliumEnvoyConfig
ciliumexternalworkloads cew cilium.io/v2 &lt;span class="nb">false&lt;/span> CiliumExternalWorkload
ciliumidentities ciliumid cilium.io/v2 &lt;span class="nb">false&lt;/span> CiliumIdentity
ciliumnetworkpolicies cnp,ciliumnp cilium.io/v2 &lt;span class="nb">true&lt;/span> CiliumNetworkPolicy
ciliumnodes cn,ciliumn cilium.io/v2 &lt;span class="nb">false&lt;/span> CiliumNode
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="éƒ¨ç½²æµ‹è¯•æœåŠ¡-1">éƒ¨ç½²æµ‹è¯•æœåŠ¡&lt;/h3>
&lt;p>å¯ä»¥å…ˆè¿›è¡Œ Hubble çš„ port-forward&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">âœ cilium-mesh cilium hubble port-forward
&lt;/code>&lt;/pre>&lt;/div>&lt;p>é»˜è®¤ä¼šç›‘å¬åˆ° 4245 ç«¯å£ä¸Šï¼Œå¦‚æœä¸æå‰æ‰§è¡Œæ­¤æ“ä½œå°±ä¼šå‡ºç°ä¸‹è¿°å†…å®¹&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">ğŸ”­ Enabling Hubble telescope...
âš ï¸ Unable to contact Hubble Relay, disabling Hubble telescope and flow validation: rpc error: &lt;span class="nv">code&lt;/span> &lt;span class="o">=&lt;/span> Unavailable &lt;span class="nv">desc&lt;/span> &lt;span class="o">=&lt;/span> connection error: &lt;span class="nv">desc&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;transport: Error while dialing dial tcp [::1]:4245: connect: connection refused&amp;#34;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¦‚æœå·²ç»å¼€å¯ Hubble çš„ port-forward ï¼Œæ­£å¸¸æƒ…å†µä¸‹ä¼šå¾—åˆ°å¦‚ä¸‹è¾“å‡ºï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">âœ cilium-mesh cilium connectivity &lt;span class="nb">test&lt;/span> --test egress-l7
â„¹ï¸ Monitor aggregation detected, will skip some flow validation steps
âŒ› &lt;span class="o">[&lt;/span>kind-kind&lt;span class="o">]&lt;/span> Waiting &lt;span class="k">for&lt;/span> deployments &lt;span class="o">[&lt;/span>client client2 echo-same-node&lt;span class="o">]&lt;/span> to become ready...
âŒ› &lt;span class="o">[&lt;/span>kind-kind&lt;span class="o">]&lt;/span> Waiting &lt;span class="k">for&lt;/span> deployments &lt;span class="o">[&lt;/span>echo-other-node&lt;span class="o">]&lt;/span> to become ready...
âŒ› &lt;span class="o">[&lt;/span>kind-kind&lt;span class="o">]&lt;/span> Waiting &lt;span class="k">for&lt;/span> CiliumEndpoint &lt;span class="k">for&lt;/span> pod cilium-test/client-6488dcf5d4-pk6w9 to appear...
âŒ› &lt;span class="o">[&lt;/span>kind-kind&lt;span class="o">]&lt;/span> Waiting &lt;span class="k">for&lt;/span> CiliumEndpoint &lt;span class="k">for&lt;/span> pod cilium-test/client2-5998d566b4-hrhrb to appear...
âŒ› &lt;span class="o">[&lt;/span>kind-kind&lt;span class="o">]&lt;/span> Waiting &lt;span class="k">for&lt;/span> CiliumEndpoint &lt;span class="k">for&lt;/span> pod cilium-test/echo-other-node-f4d46f75b-bqpcb to appear...
âŒ› &lt;span class="o">[&lt;/span>kind-kind&lt;span class="o">]&lt;/span> Waiting &lt;span class="k">for&lt;/span> CiliumEndpoint &lt;span class="k">for&lt;/span> pod cilium-test/echo-same-node-745bd5c77-zpzdn to appear...
âŒ› &lt;span class="o">[&lt;/span>kind-kind&lt;span class="o">]&lt;/span> Waiting &lt;span class="k">for&lt;/span> Service cilium-test/echo-other-node to become ready...
âŒ› &lt;span class="o">[&lt;/span>kind-kind&lt;span class="o">]&lt;/span> Waiting &lt;span class="k">for&lt;/span> Service cilium-test/echo-same-node to become ready...
âŒ› &lt;span class="o">[&lt;/span>kind-kind&lt;span class="o">]&lt;/span> Waiting &lt;span class="k">for&lt;/span> NodePort 172.18.0.5:32751 &lt;span class="o">(&lt;/span>cilium-test/echo-other-node&lt;span class="o">)&lt;/span> to become ready...
âŒ› &lt;span class="o">[&lt;/span>kind-kind&lt;span class="o">]&lt;/span> Waiting &lt;span class="k">for&lt;/span> NodePort 172.18.0.5:32133 &lt;span class="o">(&lt;/span>cilium-test/echo-same-node&lt;span class="o">)&lt;/span> to become ready...
âŒ› &lt;span class="o">[&lt;/span>kind-kind&lt;span class="o">]&lt;/span> Waiting &lt;span class="k">for&lt;/span> NodePort 172.18.0.3:32133 &lt;span class="o">(&lt;/span>cilium-test/echo-same-node&lt;span class="o">)&lt;/span> to become ready...
âŒ› &lt;span class="o">[&lt;/span>kind-kind&lt;span class="o">]&lt;/span> Waiting &lt;span class="k">for&lt;/span> NodePort 172.18.0.3:32751 &lt;span class="o">(&lt;/span>cilium-test/echo-other-node&lt;span class="o">)&lt;/span> to become ready...
âŒ› &lt;span class="o">[&lt;/span>kind-kind&lt;span class="o">]&lt;/span> Waiting &lt;span class="k">for&lt;/span> NodePort 172.18.0.2:32751 &lt;span class="o">(&lt;/span>cilium-test/echo-other-node&lt;span class="o">)&lt;/span> to become ready...
âŒ› &lt;span class="o">[&lt;/span>kind-kind&lt;span class="o">]&lt;/span> Waiting &lt;span class="k">for&lt;/span> NodePort 172.18.0.2:32133 &lt;span class="o">(&lt;/span>cilium-test/echo-same-node&lt;span class="o">)&lt;/span> to become ready...
âŒ› &lt;span class="o">[&lt;/span>kind-kind&lt;span class="o">]&lt;/span> Waiting &lt;span class="k">for&lt;/span> NodePort 172.18.0.4:32751 &lt;span class="o">(&lt;/span>cilium-test/echo-other-node&lt;span class="o">)&lt;/span> to become ready...
âŒ› &lt;span class="o">[&lt;/span>kind-kind&lt;span class="o">]&lt;/span> Waiting &lt;span class="k">for&lt;/span> NodePort 172.18.0.4:32133 &lt;span class="o">(&lt;/span>cilium-test/echo-same-node&lt;span class="o">)&lt;/span> to become ready...
â„¹ï¸ Skipping IPCache check
âŒ› &lt;span class="o">[&lt;/span>kind-kind&lt;span class="o">]&lt;/span> Waiting &lt;span class="k">for&lt;/span> pod cilium-test/client-6488dcf5d4-pk6w9 to reach default/kubernetes service...
âŒ› &lt;span class="o">[&lt;/span>kind-kind&lt;span class="o">]&lt;/span> Waiting &lt;span class="k">for&lt;/span> pod cilium-test/client2-5998d566b4-hrhrb to reach default/kubernetes service...
ğŸ”­ Enabling Hubble telescope...
â„¹ï¸ Hubble is OK, flows: 16380/16380
ğŸƒ Running tests...
&lt;span class="o">[=]&lt;/span> Skipping Test &lt;span class="o">[&lt;/span>no-policies&lt;span class="o">]&lt;/span>
&lt;span class="o">[=]&lt;/span> Skipping Test &lt;span class="o">[&lt;/span>allow-all&lt;span class="o">]&lt;/span>
&lt;span class="o">[=]&lt;/span> Skipping Test &lt;span class="o">[&lt;/span>client-ingress&lt;span class="o">]&lt;/span>
&lt;span class="o">[=]&lt;/span> Skipping Test &lt;span class="o">[&lt;/span>echo-ingress&lt;span class="o">]&lt;/span>
&lt;span class="o">[=]&lt;/span> Skipping Test &lt;span class="o">[&lt;/span>client-egress&lt;span class="o">]&lt;/span>
&lt;span class="o">[=]&lt;/span> Skipping Test &lt;span class="o">[&lt;/span>to-entities-world&lt;span class="o">]&lt;/span>
&lt;span class="o">[=]&lt;/span> Skipping Test &lt;span class="o">[&lt;/span>to-cidr-1111&lt;span class="o">]&lt;/span>
&lt;span class="o">[=]&lt;/span> Skipping Test &lt;span class="o">[&lt;/span>echo-ingress-l7&lt;span class="o">]&lt;/span>
&lt;span class="o">[=]&lt;/span> Test &lt;span class="o">[&lt;/span>client-egress-l7&lt;span class="o">]&lt;/span>
..........
&lt;span class="o">[=]&lt;/span> Skipping Test &lt;span class="o">[&lt;/span>dns-only&lt;span class="o">]&lt;/span>
&lt;span class="o">[=]&lt;/span> Skipping Test &lt;span class="o">[&lt;/span>to-fqdns&lt;span class="o">]&lt;/span>
âœ… All &lt;span class="m">1&lt;/span> tests &lt;span class="o">(&lt;/span>&lt;span class="m">10&lt;/span> actions&lt;span class="o">)&lt;/span> successful, &lt;span class="m">10&lt;/span> tests skipped, &lt;span class="m">0&lt;/span> scenarios skipped.
&lt;/code>&lt;/pre>&lt;/div>&lt;p>æˆ‘ä»¬ä¹Ÿå¯ä»¥åŒæ—¶æ‰“å¼€UIçœ‹çœ‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">âœ cilium-mesh cilium hubble ui
â„¹ï¸ Opening &lt;span class="s2">&amp;#34;http://localhost:12000&amp;#34;&lt;/span> in your browser...
&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ•ˆæœå›¾å¦‚ä¸‹ï¼š&lt;/p>
&lt;p>&lt;img src="https://s2.loli.net/2021/12/21/OcJRdFrhsWVG76w.png" alt="img">&lt;/p>
&lt;p>è¿™ä¸ªæ“ä½œå®é™…ä¸Šä¼šè¿›è¡Œå¦‚ä¸‹éƒ¨ç½²ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">âœ cilium-mesh kubectl -n cilium-test get all
NAME READY STATUS RESTARTS AGE
pod/client-6488dcf5d4-pk6w9 1/1 Running &lt;span class="m">0&lt;/span> 66m
pod/client2-5998d566b4-hrhrb 1/1 Running &lt;span class="m">0&lt;/span> 66m
pod/echo-other-node-f4d46f75b-bqpcb 1/1 Running &lt;span class="m">0&lt;/span> 66m
pod/echo-same-node-745bd5c77-zpzdn 1/1 Running &lt;span class="m">0&lt;/span> 66m
NAME TYPE CLUSTER-IP EXTERNAL-IP PORT&lt;span class="o">(&lt;/span>S&lt;span class="o">)&lt;/span> AGE
service/echo-other-node NodePort 10.96.124.211 &amp;lt;none&amp;gt; 8080:32751/TCP 66m
service/echo-same-node NodePort 10.96.136.252 &amp;lt;none&amp;gt; 8080:32133/TCP 66m
NAME READY UP-TO-DATE AVAILABLE AGE
deployment.apps/client 1/1 &lt;span class="m">1&lt;/span> &lt;span class="m">1&lt;/span> 66m
deployment.apps/client2 1/1 &lt;span class="m">1&lt;/span> &lt;span class="m">1&lt;/span> 66m
deployment.apps/echo-other-node 1/1 &lt;span class="m">1&lt;/span> &lt;span class="m">1&lt;/span> 66m
deployment.apps/echo-same-node 1/1 &lt;span class="m">1&lt;/span> &lt;span class="m">1&lt;/span> 66m
NAME DESIRED CURRENT READY AGE
replicaset.apps/client-6488dcf5d4 &lt;span class="m">1&lt;/span> &lt;span class="m">1&lt;/span> &lt;span class="m">1&lt;/span> 66m
replicaset.apps/client2-5998d566b4 &lt;span class="m">1&lt;/span> &lt;span class="m">1&lt;/span> &lt;span class="m">1&lt;/span> 66m
replicaset.apps/echo-other-node-f4d46f75b &lt;span class="m">1&lt;/span> &lt;span class="m">1&lt;/span> &lt;span class="m">1&lt;/span> 66m
replicaset.apps/echo-same-node-745bd5c77 &lt;span class="m">1&lt;/span> &lt;span class="m">1&lt;/span> &lt;span class="m">1&lt;/span> 66m
&lt;/code>&lt;/pre>&lt;/div>&lt;p>æˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹çœ‹å®ƒçš„ labelï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">âœ cilium-mesh kubectl get pods -n cilium-test --show-labels -o wide
NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES LABELS
client-6488dcf5d4-pk6w9 1/1 Running &lt;span class="m">0&lt;/span> 67m 10.244.3.7 kind-worker3 &amp;lt;none&amp;gt; &amp;lt;none&amp;gt; &lt;span class="nv">kind&lt;/span>&lt;span class="o">=&lt;/span>client,name&lt;span class="o">=&lt;/span>client,pod-template-hash&lt;span class="o">=&lt;/span>6488dcf5d4
client2-5998d566b4-hrhrb 1/1 Running &lt;span class="m">0&lt;/span> 67m 10.244.3.18 kind-worker3 &amp;lt;none&amp;gt; &amp;lt;none&amp;gt; &lt;span class="nv">kind&lt;/span>&lt;span class="o">=&lt;/span>client,name&lt;span class="o">=&lt;/span>client2,other&lt;span class="o">=&lt;/span>client,pod-template-hash&lt;span class="o">=&lt;/span>5998d566b4
echo-other-node-f4d46f75b-bqpcb 1/1 Running &lt;span class="m">0&lt;/span> 67m 10.244.1.146 kind-worker2 &amp;lt;none&amp;gt; &amp;lt;none&amp;gt; &lt;span class="nv">kind&lt;/span>&lt;span class="o">=&lt;/span>echo,name&lt;span class="o">=&lt;/span>echo-other-node,pod-template-hash&lt;span class="o">=&lt;/span>f4d46f75b
echo-same-node-745bd5c77-zpzdn 1/1 Running &lt;span class="m">0&lt;/span> 67m 10.244.3.164 kind-worker3 &amp;lt;none&amp;gt; &amp;lt;none&amp;gt; &lt;span class="nv">kind&lt;/span>&lt;span class="o">=&lt;/span>echo,name&lt;span class="o">=&lt;/span>echo-same-node,other&lt;span class="o">=&lt;/span>echo,pod-template-hash&lt;span class="o">=&lt;/span>745bd5c77
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="æµ‹è¯•-1">æµ‹è¯•&lt;/h3>
&lt;p>è¿™é‡Œæˆ‘ä»¬åœ¨ä¸»æœºä¸Šè¿›è¡Œæ“ä½œä¸‹ï¼Œ å…ˆæ‹¿åˆ° client2 çš„ Pod åç§°ï¼Œç„¶åé€šè¿‡ Hubble å‘½ä»¤è§‚å¯Ÿæ‰€æœ‰è®¿é—®æ­¤ Pod çš„æµé‡ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">âœ cilium-mesh &lt;span class="nb">export&lt;/span> &lt;span class="nv">CLIENT2&lt;/span>&lt;span class="o">=&lt;/span>client2-5998d566b4-hrhrb
âœ cilium-mesh hubble observe --from-pod cilium-test/&lt;span class="nv">$CLIENT2&lt;/span> -f
Dec &lt;span class="m">18&lt;/span> 14:07:37.200: cilium-test/client2-5998d566b4-hrhrb:44805 &amp;lt;&amp;gt; kube-system/coredns-78fcd69978-7lbwh:53 to-overlay FORWARDED &lt;span class="o">(&lt;/span>UDP&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 14:07:37.200: cilium-test/client2-5998d566b4-hrhrb:44805 -&amp;gt; kube-system/coredns-78fcd69978-7lbwh:53 to-endpoint FORWARDED &lt;span class="o">(&lt;/span>UDP&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 14:07:37.200: cilium-test/client2-5998d566b4-hrhrb:44805 &amp;lt;&amp;gt; kube-system/coredns-78fcd69978-7lbwh:53 to-overlay FORWARDED &lt;span class="o">(&lt;/span>UDP&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 14:07:37.200: cilium-test/client2-5998d566b4-hrhrb:44805 -&amp;gt; kube-system/coredns-78fcd69978-7lbwh:53 to-endpoint FORWARDED &lt;span class="o">(&lt;/span>UDP&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 14:07:37.200: cilium-test/client2-5998d566b4-hrhrb:42260 -&amp;gt; cilium-test/echo-same-node-745bd5c77-zpzdn:8080 to-endpoint FORWARDED &lt;span class="o">(&lt;/span>TCP Flags: SYN&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 14:07:37.201: cilium-test/client2-5998d566b4-hrhrb:42260 -&amp;gt; cilium-test/echo-same-node-745bd5c77-zpzdn:8080 to-endpoint FORWARDED &lt;span class="o">(&lt;/span>TCP Flags: ACK&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 14:07:37.201: cilium-test/client2-5998d566b4-hrhrb:42260 -&amp;gt; cilium-test/echo-same-node-745bd5c77-zpzdn:8080 to-endpoint FORWARDED &lt;span class="o">(&lt;/span>TCP Flags: ACK, PSH&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 14:07:37.202: cilium-test/client2-5998d566b4-hrhrb:42260 -&amp;gt; cilium-test/echo-same-node-745bd5c77-zpzdn:8080 to-endpoint FORWARDED &lt;span class="o">(&lt;/span>TCP Flags: ACK, FIN&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 14:07:37.203: cilium-test/client2-5998d566b4-hrhrb:42260 -&amp;gt; cilium-test/echo-same-node-745bd5c77-zpzdn:8080 to-endpoint FORWARDED &lt;span class="o">(&lt;/span>TCP Flags: ACK&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 14:07:50.769: cilium-test/client2-5998d566b4-hrhrb:36768 &amp;lt;&amp;gt; kube-system/coredns-78fcd69978-7lbwh:53 to-overlay FORWARDED &lt;span class="o">(&lt;/span>UDP&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 14:07:50.769: cilium-test/client2-5998d566b4-hrhrb:36768 &amp;lt;&amp;gt; kube-system/coredns-78fcd69978-7lbwh:53 to-overlay FORWARDED &lt;span class="o">(&lt;/span>UDP&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 14:07:50.769: cilium-test/client2-5998d566b4-hrhrb:36768 -&amp;gt; kube-system/coredns-78fcd69978-7lbwh:53 to-endpoint FORWARDED &lt;span class="o">(&lt;/span>UDP&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 14:07:50.769: cilium-test/client2-5998d566b4-hrhrb:36768 -&amp;gt; kube-system/coredns-78fcd69978-7lbwh:53 to-endpoint FORWARDED &lt;span class="o">(&lt;/span>UDP&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 14:07:50.770: cilium-test/client2-5998d566b4-hrhrb:42068 &amp;lt;&amp;gt; cilium-test/echo-other-node-f4d46f75b-bqpcb:8080 to-overlay FORWARDED &lt;span class="o">(&lt;/span>TCP Flags: SYN&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 14:07:50.770: cilium-test/client2-5998d566b4-hrhrb:42068 -&amp;gt; cilium-test/echo-other-node-f4d46f75b-bqpcb:8080 to-endpoint FORWARDED &lt;span class="o">(&lt;/span>TCP Flags: SYN&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 14:07:50.770: cilium-test/client2-5998d566b4-hrhrb:42068 &amp;lt;&amp;gt; cilium-test/echo-other-node-f4d46f75b-bqpcb:8080 to-overlay FORWARDED &lt;span class="o">(&lt;/span>TCP Flags: ACK&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 14:07:50.770: cilium-test/client2-5998d566b4-hrhrb:42068 -&amp;gt; cilium-test/echo-other-node-f4d46f75b-bqpcb:8080 to-endpoint FORWARDED &lt;span class="o">(&lt;/span>TCP Flags: ACK&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 14:07:50.770: cilium-test/client2-5998d566b4-hrhrb:42068 &amp;lt;&amp;gt; cilium-test/echo-other-node-f4d46f75b-bqpcb:8080 to-overlay FORWARDED &lt;span class="o">(&lt;/span>TCP Flags: ACK, PSH&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 14:07:50.770: cilium-test/client2-5998d566b4-hrhrb:42068 -&amp;gt; cilium-test/echo-other-node-f4d46f75b-bqpcb:8080 to-endpoint FORWARDED &lt;span class="o">(&lt;/span>TCP Flags: ACK, PSH&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 14:07:50.771: cilium-test/client2-5998d566b4-hrhrb:42068 &amp;lt;&amp;gt; cilium-test/echo-other-node-f4d46f75b-bqpcb:8080 to-overlay FORWARDED &lt;span class="o">(&lt;/span>TCP Flags: ACK, FIN&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 14:07:50.771: cilium-test/client2-5998d566b4-hrhrb:42068 -&amp;gt; cilium-test/echo-other-node-f4d46f75b-bqpcb:8080 to-endpoint FORWARDED &lt;span class="o">(&lt;/span>TCP Flags: ACK, FIN&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 14:07:50.772: cilium-test/client2-5998d566b4-hrhrb:42068 &amp;lt;&amp;gt; cilium-test/echo-other-node-f4d46f75b-bqpcb:8080 to-overlay FORWARDED &lt;span class="o">(&lt;/span>TCP Flags: ACK&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 14:07:50.772: cilium-test/client2-5998d566b4-hrhrb:42068 -&amp;gt; cilium-test/echo-other-node-f4d46f75b-bqpcb:8080 to-endpoint FORWARDED &lt;span class="o">(&lt;/span>TCP Flags: ACK&lt;span class="o">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä»¥ä¸Šè¾“å‡ºæ˜¯ç”±äºæˆ‘ä»¬æ‰§è¡Œäº†ä¸‹é¢çš„æ“ä½œï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">kubectl &lt;span class="nb">exec&lt;/span> -it -n cilium-test &lt;span class="nv">$CLIENT2&lt;/span> -- curl -v echo-same-node:8080/
kubectl &lt;span class="nb">exec&lt;/span> -it -n cilium-test &lt;span class="nv">$CLIENT2&lt;/span> -- curl -v echo-other-node:8080/
&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ—¥å¿—ä¸­åŸºæœ¬ä¸Šéƒ½æ˜¯ &lt;code>to-endpoint&lt;/code> æˆ–è€… &lt;code>to-overlay&lt;/code>çš„ã€‚&lt;/p>
&lt;h3 id="æµ‹è¯•ä½¿ç”¨-proxy">æµ‹è¯•ä½¿ç”¨ proxy&lt;/h3>
&lt;p>éœ€è¦å…ˆå®‰è£… networkpolicy ï¼Œ æˆ‘ä»¬å¯ä»¥ç›´æ¥ä» Cilium CLI çš„ä»“åº“ä¸­æ‹¿åˆ°ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">kubectl apply -f https://raw.githubusercontent.com/cilium/cilium-cli/master/connectivity/manifests/client-egress-l7-http.yaml
kubectl apply -f https://raw.githubusercontent.com/cilium/cilium-cli/master/connectivity/manifests/client-egress-only-dns.yaml
&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç„¶åé‡å¤ä¸Šé¢çš„è¯·æ±‚ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">Dec &lt;span class="m">18&lt;/span> 14:33:40.570: cilium-test/client2-5998d566b4-hrhrb:44344 -&amp;gt; kube-system/coredns-78fcd69978-2ww28:53 L3-L4 REDIRECTED &lt;span class="o">(&lt;/span>UDP&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 14:33:40.570: cilium-test/client2-5998d566b4-hrhrb:44344 -&amp;gt; kube-system/coredns-78fcd69978-2ww28:53 to-proxy FORWARDED &lt;span class="o">(&lt;/span>UDP&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 14:33:40.570: cilium-test/client2-5998d566b4-hrhrb:44344 -&amp;gt; kube-system/coredns-78fcd69978-2ww28:53 to-proxy FORWARDED &lt;span class="o">(&lt;/span>UDP&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 14:33:40.570: cilium-test/client2-5998d566b4-hrhrb:44344 -&amp;gt; kube-system/coredns-78fcd69978-2ww28:53 dns-request FORWARDED &lt;span class="o">(&lt;/span>DNS Query echo-other-node.cilium-test.svc.cluster.local. A&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 14:33:40.570: cilium-test/client2-5998d566b4-hrhrb:44344 -&amp;gt; kube-system/coredns-78fcd69978-2ww28:53 dns-request FORWARDED &lt;span class="o">(&lt;/span>DNS Query echo-other-node.cilium-test.svc.cluster.local. AAAA&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 14:33:40.571: cilium-test/client2-5998d566b4-hrhrb:42074 -&amp;gt; cilium-test/echo-other-node-f4d46f75b-bqpcb:8080 L3-L4 REDIRECTED &lt;span class="o">(&lt;/span>TCP Flags: SYN&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 14:33:40.571: cilium-test/client2-5998d566b4-hrhrb:42074 -&amp;gt; cilium-test/echo-other-node-f4d46f75b-bqpcb:8080 to-proxy FORWARDED &lt;span class="o">(&lt;/span>TCP Flags: SYN&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 14:33:40.571: cilium-test/client2-5998d566b4-hrhrb:42074 -&amp;gt; cilium-test/echo-other-node-f4d46f75b-bqpcb:8080 to-proxy FORWARDED &lt;span class="o">(&lt;/span>TCP Flags: ACK&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 14:33:40.571: cilium-test/client2-5998d566b4-hrhrb:42074 -&amp;gt; cilium-test/echo-other-node-f4d46f75b-bqpcb:8080 to-proxy FORWARDED &lt;span class="o">(&lt;/span>TCP Flags: ACK, PSH&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 14:33:40.572: cilium-test/client2-5998d566b4-hrhrb:42074 -&amp;gt; cilium-test/echo-other-node-f4d46f75b-bqpcb:8080 http-request FORWARDED &lt;span class="o">(&lt;/span>HTTP/1.1 GET http://echo-other-node:8080/&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 14:33:40.573: cilium-test/client2-5998d566b4-hrhrb:42074 -&amp;gt; cilium-test/echo-other-node-f4d46f75b-bqpcb:8080 to-proxy FORWARDED &lt;span class="o">(&lt;/span>TCP Flags: ACK, FIN&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 14:33:40.573: cilium-test/client2-5998d566b4-hrhrb:42074 -&amp;gt; cilium-test/echo-other-node-f4d46f75b-bqpcb:8080 to-proxy FORWARDED &lt;span class="o">(&lt;/span>TCP Flags: ACK&lt;span class="o">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ‰§è¡Œå¦ä¸€ä¸ªè¯·æ±‚ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">âœ cilium-mesh kubectl &lt;span class="nb">exec&lt;/span> -it -n cilium-test &lt;span class="nv">$CLIENT2&lt;/span> -- curl -v echo-same-node:8080/
&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¹Ÿå¯ä»¥çœ‹åˆ°å¦‚ä¸‹è¾“å‡ºï¼Œå…¶ä¸­æœ‰ &lt;code>to-proxy&lt;/code>çš„å­—æ ·ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">Dec &lt;span class="m">18&lt;/span> 14:45:18.857: cilium-test/client2-5998d566b4-hrhrb:58895 -&amp;gt; kube-system/coredns-78fcd69978-2ww28:53 L3-L4 REDIRECTED &lt;span class="o">(&lt;/span>UDP&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 14:45:18.857: cilium-test/client2-5998d566b4-hrhrb:58895 -&amp;gt; kube-system/coredns-78fcd69978-2ww28:53 to-proxy FORWARDED &lt;span class="o">(&lt;/span>UDP&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 14:45:18.857: cilium-test/client2-5998d566b4-hrhrb:58895 -&amp;gt; kube-system/coredns-78fcd69978-2ww28:53 to-proxy FORWARDED &lt;span class="o">(&lt;/span>UDP&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 14:45:18.857: cilium-test/client2-5998d566b4-hrhrb:58895 -&amp;gt; kube-system/coredns-78fcd69978-2ww28:53 dns-request FORWARDED &lt;span class="o">(&lt;/span>DNS Query echo-same-node.cilium-test.svc.cluster.local. AAAA&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 14:45:18.857: cilium-test/client2-5998d566b4-hrhrb:58895 -&amp;gt; kube-system/coredns-78fcd69978-2ww28:53 dns-request FORWARDED &lt;span class="o">(&lt;/span>DNS Query echo-same-node.cilium-test.svc.cluster.local. A&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 14:45:18.858: cilium-test/client2-5998d566b4-hrhrb:42266 -&amp;gt; cilium-test/echo-same-node-745bd5c77-zpzdn:8080 L3-L4 REDIRECTED &lt;span class="o">(&lt;/span>TCP Flags: SYN&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 14:45:18.858: cilium-test/client2-5998d566b4-hrhrb:42266 -&amp;gt; cilium-test/echo-same-node-745bd5c77-zpzdn:8080 to-proxy FORWARDED &lt;span class="o">(&lt;/span>TCP Flags: SYN&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 14:45:18.858: cilium-test/client2-5998d566b4-hrhrb:42266 -&amp;gt; cilium-test/echo-same-node-745bd5c77-zpzdn:8080 to-proxy FORWARDED &lt;span class="o">(&lt;/span>TCP Flags: ACK&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 14:45:18.858: cilium-test/client2-5998d566b4-hrhrb:42266 -&amp;gt; cilium-test/echo-same-node-745bd5c77-zpzdn:8080 to-proxy FORWARDED &lt;span class="o">(&lt;/span>TCP Flags: ACK, PSH&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 14:45:18.858: cilium-test/client2-5998d566b4-hrhrb:42266 -&amp;gt; cilium-test/echo-same-node-745bd5c77-zpzdn:8080 http-request FORWARDED &lt;span class="o">(&lt;/span>HTTP/1.1 GET http://echo-same-node:8080/&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 14:45:18.859: cilium-test/client2-5998d566b4-hrhrb:42266 -&amp;gt; cilium-test/echo-same-node-745bd5c77-zpzdn:8080 to-proxy FORWARDED &lt;span class="o">(&lt;/span>TCP Flags: ACK, FIN&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 14:45:18.859: cilium-test/client2-5998d566b4-hrhrb:42266 -&amp;gt; cilium-test/echo-same-node-745bd5c77-zpzdn:8080 to-proxy FORWARDED &lt;span class="o">(&lt;/span>TCP Flags: ACK&lt;span class="o">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>å…¶å®çœ‹è¯·æ±‚å¤´æ›´åŠ æ–¹ä¾¿ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">âœ cilium-mesh kubectl &lt;span class="nb">exec&lt;/span> -it -n cilium-test &lt;span class="nv">$CLIENT2&lt;/span> -- curl -I echo-same-node:8080/
HTTP/1.1 &lt;span class="m">403&lt;/span> Forbidden
content-length: &lt;span class="m">15&lt;/span>
content-type: text/plain
date: Sat, &lt;span class="m">18&lt;/span> Dec &lt;span class="m">2021&lt;/span> 14:47:39 GMT
server: envoy
&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¹‹å‰éƒ½æ˜¯å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="c1">## æ²¡æœ‰ proxy&lt;/span>
âœ cilium-mesh kubectl &lt;span class="nb">exec&lt;/span> -it -n cilium-test &lt;span class="nv">$CLIENT2&lt;/span> -- curl -v echo-same-node:8080/
* Trying 10.96.136.252:8080...
* Connected to echo-same-node &lt;span class="o">(&lt;/span>10.96.136.252&lt;span class="o">)&lt;/span> port &lt;span class="m">8080&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="c1">#0) &lt;/span>
&amp;gt; GET / HTTP/1.1
&amp;gt; Host: echo-same-node:8080
&amp;gt; User-Agent: curl/7.78.0
&amp;gt; Accept: */*
&amp;gt;
* Mark bundle as not supporting multiuse
&amp;lt; HTTP/1.1 &lt;span class="m">200&lt;/span> OK
&amp;lt; X-Powered-By: Express
&amp;lt; Vary: Origin, Accept-Encoding
&amp;lt; Access-Control-Allow-Credentials: &lt;span class="nb">true&lt;/span>
&amp;lt; Accept-Ranges: bytes
&amp;lt; Cache-Control: public, max-age&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span>
&amp;lt; Last-Modified: Sat, &lt;span class="m">26&lt;/span> Oct &lt;span class="m">1985&lt;/span> 08:15:00 GMT
&amp;lt; ETag: W/&lt;span class="s2">&amp;#34;809-7438674ba0&amp;#34;&lt;/span>
&amp;lt; Content-Type: text/html&lt;span class="p">;&lt;/span> &lt;span class="nv">charset&lt;/span>&lt;span class="o">=&lt;/span>UTF-8
&amp;lt; Content-Length: &lt;span class="m">2057&lt;/span>
&amp;lt; Date: Sat, &lt;span class="m">18&lt;/span> Dec &lt;span class="m">2021&lt;/span> 14:07:37 GMT
&amp;lt; Connection: keep-alive
&amp;lt; Keep-Alive: &lt;span class="nv">timeout&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">5&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="è¯·æ±‚ä¸€ä¸ªä¸å­˜åœ¨çš„åœ°å€">è¯·æ±‚ä¸€ä¸ªä¸å­˜åœ¨çš„åœ°å€ï¼š&lt;/h3>
&lt;p>ä»¥å‰è¯·æ±‚å“åº”æ˜¯ 404 ï¼Œç°åœ¨æ˜¯ 403 ,å¹¶å¾—åˆ°å¦‚ä¸‹å†…å®¹&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">âœ cilium-mesh kubectl &lt;span class="nb">exec&lt;/span> -it -n cilium-test &lt;span class="nv">$CLIENT2&lt;/span> -- curl -v echo-same-node:8080/foo
* Trying 10.96.136.252:8080...
* Connected to echo-same-node &lt;span class="o">(&lt;/span>10.96.136.252&lt;span class="o">)&lt;/span> port &lt;span class="m">8080&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="c1">#0)&lt;/span>
&amp;gt; GET /foo HTTP/1.1
&amp;gt; Host: echo-same-node:8080
&amp;gt; User-Agent: curl/7.78.0
&amp;gt; Accept: */*
&amp;gt;
* Mark bundle as not supporting multiuse
&amp;lt; HTTP/1.1 &lt;span class="m">403&lt;/span> Forbidden
&amp;lt; content-length: &lt;span class="m">15&lt;/span>
&amp;lt; content-type: text/plain
&amp;lt; date: Sat, &lt;span class="m">18&lt;/span> Dec &lt;span class="m">2021&lt;/span> 14:50:38 GMT
&amp;lt; server: envoy
&amp;lt;
Access denied
* Connection &lt;span class="c1">#0 to host echo-same-node left intact&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ—¥å¿—ä¸­ä¹Ÿéƒ½æ˜¯ &lt;code>to-proxy&lt;/code>çš„å­—æ ·ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">Dec &lt;span class="m">18&lt;/span> 14:50:39.185: cilium-test/client2-5998d566b4-hrhrb:37683 -&amp;gt; kube-system/coredns-78fcd69978-7lbwh:53 L3-L4 REDIRECTED &lt;span class="o">(&lt;/span>UDP&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 14:50:39.185: cilium-test/client2-5998d566b4-hrhrb:37683 -&amp;gt; kube-system/coredns-78fcd69978-7lbwh:53 to-proxy FORWARDED &lt;span class="o">(&lt;/span>UDP&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 14:50:39.185: cilium-test/client2-5998d566b4-hrhrb:37683 -&amp;gt; kube-system/coredns-78fcd69978-7lbwh:53 to-proxy FORWARDED &lt;span class="o">(&lt;/span>UDP&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 14:50:39.185: cilium-test/client2-5998d566b4-hrhrb:37683 -&amp;gt; kube-system/coredns-78fcd69978-7lbwh:53 dns-request FORWARDED &lt;span class="o">(&lt;/span>DNS Query echo-same-node.cilium-test.svc.cluster.local. AAAA&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 14:50:39.185: cilium-test/client2-5998d566b4-hrhrb:37683 -&amp;gt; kube-system/coredns-78fcd69978-7lbwh:53 dns-request FORWARDED &lt;span class="o">(&lt;/span>DNS Query echo-same-node.cilium-test.svc.cluster.local. A&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 14:50:39.186: cilium-test/client2-5998d566b4-hrhrb:42274 -&amp;gt; cilium-test/echo-same-node-745bd5c77-zpzdn:8080 L3-L4 REDIRECTED &lt;span class="o">(&lt;/span>TCP Flags: SYN&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 14:50:39.186: cilium-test/client2-5998d566b4-hrhrb:42274 -&amp;gt; cilium-test/echo-same-node-745bd5c77-zpzdn:8080 to-proxy FORWARDED &lt;span class="o">(&lt;/span>TCP Flags: SYN&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 14:50:39.186: cilium-test/client2-5998d566b4-hrhrb:42274 -&amp;gt; cilium-test/echo-same-node-745bd5c77-zpzdn:8080 to-proxy FORWARDED &lt;span class="o">(&lt;/span>TCP Flags: ACK&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 14:50:39.186: cilium-test/client2-5998d566b4-hrhrb:42274 -&amp;gt; cilium-test/echo-same-node-745bd5c77-zpzdn:8080 to-proxy FORWARDED &lt;span class="o">(&lt;/span>TCP Flags: ACK, PSH&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 14:50:39.186: cilium-test/client2-5998d566b4-hrhrb:42274 -&amp;gt; cilium-test/echo-same-node-745bd5c77-zpzdn:8080 http-request DROPPED &lt;span class="o">(&lt;/span>HTTP/1.1 GET http://echo-same-node:8080/foo&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 14:50:39.186: cilium-test/client2-5998d566b4-hrhrb:42274 -&amp;gt; cilium-test/echo-same-node-745bd5c77-zpzdn:8080 to-proxy FORWARDED &lt;span class="o">(&lt;/span>TCP Flags: ACK, FIN&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 14:50:39.187: cilium-test/client2-5998d566b4-hrhrb:42274 -&amp;gt; cilium-test/echo-same-node-745bd5c77-zpzdn:8080 to-proxy FORWARDED &lt;span class="o">(&lt;/span>TCP Flags: ACK&lt;span class="o">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>æˆ‘ä»¬ä½¿ç”¨å¦‚ä¸‹å†…å®¹ä½œä¸º Envoy çš„é…ç½®æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å« rewrite ç­–ç•¥ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">cilium.io/v2alpha1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">CiliumEnvoyConfig&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">envoy-lb-listener&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">services&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">echo-other-node&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">namespace&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">cilium-test&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">echo-same-node&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">namespace&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">cilium-test&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">resources&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">&amp;#34;@type&amp;#34;: &lt;/span>&lt;span class="l">type.googleapis.com/envoy.config.listener.v3.Listener&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">envoy-lb-listener&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">filter_chains&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">filters&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">envoy.filters.network.http_connection_manager&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">typed_config&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">&amp;#34;@type&amp;#34;: &lt;/span>&lt;span class="l">type.googleapis.com/envoy.extensions.filters.network.http_connection_manager.v3.HttpConnectionManager&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">stat_prefix&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">envoy-lb-listener&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">rds&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">route_config_name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">lb_route&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">http_filters&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">envoy.filters.http.router&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">&amp;#34;@type&amp;#34;: &lt;/span>&lt;span class="l">type.googleapis.com/envoy.config.route.v3.RouteConfiguration&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">lb_route&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">virtual_hosts&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;lb_route&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">domains&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;*&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">routes&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">match&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">prefix&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;/&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">route&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">weighted_clusters&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">clusters&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;cilium-test/echo-same-node&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">weight&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">50&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;cilium-test/echo-other-node&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">weight&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">50&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">retry_policy&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">retry_on&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">5xx&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">num_retries&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">3&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">per_try_timeout&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">1s&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">regex_rewrite&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">pattern&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">google_re2&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>{}&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">regex&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;^/foo.*$&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">substitution&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;/&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">&amp;#34;@type&amp;#34;: &lt;/span>&lt;span class="l">type.googleapis.com/envoy.config.cluster.v3.Cluster&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;cilium-test/echo-same-node&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">connect_timeout&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">5s&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">lb_policy&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ROUND_ROBIN&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">EDS&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">outlier_detection&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">split_external_local_origin_errors&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">consecutive_local_origin_failure&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">2&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">&amp;#34;@type&amp;#34;: &lt;/span>&lt;span class="l">type.googleapis.com/envoy.config.cluster.v3.Cluster&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;cilium-test/echo-other-node&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">connect_timeout&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">3s&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">lb_policy&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ROUND_ROBIN&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">EDS&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">outlier_detection&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">split_external_local_origin_errors&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">consecutive_local_origin_failure&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">2&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æµ‹è¯•è¯·æ±‚æ—¶ï¼Œå‘ç°å¯ä»¥æ­£ç¡®çš„å¾—åˆ°å“åº”äº†ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">âœ cilium-mesh kubectl &lt;span class="nb">exec&lt;/span> -it -n cilium-test &lt;span class="nv">$CLIENT2&lt;/span> -- curl -X GET -I echo-same-node:8080/
HTTP/1.1 &lt;span class="m">200&lt;/span> OK
x-powered-by: Express
vary: Origin, Accept-Encoding
access-control-allow-credentials: &lt;span class="nb">true&lt;/span>
accept-ranges: bytes
cache-control: public, max-age&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span>
last-modified: Sat, &lt;span class="m">26&lt;/span> Oct &lt;span class="m">1985&lt;/span> 08:15:00 GMT
etag: W/&lt;span class="s2">&amp;#34;809-7438674ba0&amp;#34;&lt;/span>
content-type: text/html&lt;span class="p">;&lt;/span> &lt;span class="nv">charset&lt;/span>&lt;span class="o">=&lt;/span>UTF-8
content-length: &lt;span class="m">2057&lt;/span>
date: Sat, &lt;span class="m">18&lt;/span> Dec &lt;span class="m">2021&lt;/span> 15:00:01 GMT
x-envoy-upstream-service-time: &lt;span class="m">1&lt;/span>
server: envoy
&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¹¶ä¸”è¯·æ±‚ &lt;code>/foo&lt;/code>åœ°å€æ—¶ï¼Œä¹Ÿå¯ä»¥æ­£ç¡®çš„å¾—åˆ°å“åº”äº†ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">âœ cilium-mesh kubectl &lt;span class="nb">exec&lt;/span> -it -n cilium-test &lt;span class="nv">$CLIENT2&lt;/span> -- curl -X GET -I echo-same-node:8080/foo
HTTP/1.1 &lt;span class="m">200&lt;/span> OK
x-powered-by: Express
vary: Origin, Accept-Encoding
access-control-allow-credentials: &lt;span class="nb">true&lt;/span>
accept-ranges: bytes
cache-control: public, max-age&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span>
last-modified: Sat, &lt;span class="m">26&lt;/span> Oct &lt;span class="m">1985&lt;/span> 08:15:00 GMT
etag: W/&lt;span class="s2">&amp;#34;809-7438674ba0&amp;#34;&lt;/span>
content-type: text/html&lt;span class="p">;&lt;/span> &lt;span class="nv">charset&lt;/span>&lt;span class="o">=&lt;/span>UTF-8
content-length: &lt;span class="m">2057&lt;/span>
date: Sat, &lt;span class="m">18&lt;/span> Dec &lt;span class="m">2021&lt;/span> 15:01:40 GMT
x-envoy-upstream-service-time: &lt;span class="m">2&lt;/span>
server: envoy
&lt;/code>&lt;/pre>&lt;/div>&lt;p>åŒæ—¶ï¼šè¯·æ±‚ &lt;code>/foo&lt;/code> çš„æ—¶å€™ï¼Œæµé‡å¦‚ä¸‹: ç›´æ¥è½¬æ¢æˆåŠŸäº†å¯¹/çš„è®¿é—®&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">Dec &lt;span class="m">18&lt;/span> 15:02:22.541: cilium-test/client2-5998d566b4-hrhrb:38860 -&amp;gt; kube-system/coredns-78fcd69978-2ww28:53 L3-L4 REDIRECTED &lt;span class="o">(&lt;/span>UDP&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 15:02:22.541: cilium-test/client2-5998d566b4-hrhrb:38860 -&amp;gt; kube-system/coredns-78fcd69978-2ww28:53 to-proxy FORWARDED &lt;span class="o">(&lt;/span>UDP&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 15:02:22.541: cilium-test/client2-5998d566b4-hrhrb:38860 -&amp;gt; kube-system/coredns-78fcd69978-2ww28:53 to-proxy FORWARDED &lt;span class="o">(&lt;/span>UDP&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 15:02:22.541: cilium-test/client2-5998d566b4-hrhrb:38860 -&amp;gt; kube-system/coredns-78fcd69978-2ww28:53 dns-request FORWARDED &lt;span class="o">(&lt;/span>DNS Query echo-same-node.cilium-test.svc.cluster.local. AAAA&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 15:02:22.541: cilium-test/client2-5998d566b4-hrhrb:38860 -&amp;gt; kube-system/coredns-78fcd69978-2ww28:53 dns-request FORWARDED &lt;span class="o">(&lt;/span>DNS Query echo-same-node.cilium-test.svc.cluster.local. A&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 15:02:22.542: cilium-test/client2-5998d566b4-hrhrb:53062 -&amp;gt; cilium-test/echo-same-node:8080 none REDIRECTED &lt;span class="o">(&lt;/span>TCP Flags: SYN&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 15:02:22.542: cilium-test/client2-5998d566b4-hrhrb:53062 -&amp;gt; cilium-test/echo-same-node:8080 to-proxy FORWARDED &lt;span class="o">(&lt;/span>TCP Flags: SYN&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 15:02:22.542: cilium-test/client2-5998d566b4-hrhrb:53062 -&amp;gt; cilium-test/echo-same-node:8080 to-proxy FORWARDED &lt;span class="o">(&lt;/span>TCP Flags: ACK&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 15:02:22.542: cilium-test/client2-5998d566b4-hrhrb:53062 -&amp;gt; cilium-test/echo-same-node:8080 to-proxy FORWARDED &lt;span class="o">(&lt;/span>TCP Flags: ACK, PSH&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 15:02:22.542: cilium-test/client2-5998d566b4-hrhrb:53048 -&amp;gt; cilium-test/echo-same-node-745bd5c77-zpzdn:8080 to-proxy FORWARDED &lt;span class="o">(&lt;/span>TCP Flags: ACK, PSH&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 15:02:22.542: cilium-test/client2-5998d566b4-hrhrb:53048 -&amp;gt; cilium-test/echo-same-node-745bd5c77-zpzdn:8080 http-request FORWARDED &lt;span class="o">(&lt;/span>HTTP/1.1 GET http://echo-same-node:8080/&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 15:02:22.543: cilium-test/client2-5998d566b4-hrhrb:53062 -&amp;gt; cilium-test/echo-same-node:8080 to-proxy FORWARDED &lt;span class="o">(&lt;/span>TCP Flags: ACK, FIN&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 15:02:22.544: cilium-test/client2-5998d566b4-hrhrb:53062 -&amp;gt; cilium-test/echo-same-node:8080 to-proxy FORWARDED &lt;span class="o">(&lt;/span>TCP Flags: ACK&lt;span class="o">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¤šæ¬¡è¯·æ±‚çœ‹æ—¥å¿—ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">Dec &lt;span class="m">18&lt;/span> 15:07:20.883: cilium-test/client2-5998d566b4-hrhrb:49656 -&amp;gt; kube-system/coredns-78fcd69978-2ww28:53 L3-L4 REDIRECTED &lt;span class="o">(&lt;/span>UDP&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 15:07:20.883: cilium-test/client2-5998d566b4-hrhrb:49656 -&amp;gt; kube-system/coredns-78fcd69978-2ww28:53 to-proxy FORWARDED &lt;span class="o">(&lt;/span>UDP&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 15:07:20.883: cilium-test/client2-5998d566b4-hrhrb:49656 -&amp;gt; kube-system/coredns-78fcd69978-2ww28:53 to-proxy FORWARDED &lt;span class="o">(&lt;/span>UDP&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 15:07:20.883: cilium-test/client2-5998d566b4-hrhrb:49656 -&amp;gt; kube-system/coredns-78fcd69978-2ww28:53 dns-request FORWARDED &lt;span class="o">(&lt;/span>DNS Query echo-same-node.cilium-test.svc.cluster.local. A&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 15:07:20.884: cilium-test/client2-5998d566b4-hrhrb:49656 -&amp;gt; kube-system/coredns-78fcd69978-2ww28:53 dns-request FORWARDED &lt;span class="o">(&lt;/span>DNS Query echo-same-node.cilium-test.svc.cluster.local. AAAA&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 15:07:20.885: cilium-test/client2-5998d566b4-hrhrb:53070 -&amp;gt; cilium-test/echo-same-node:8080 none REDIRECTED &lt;span class="o">(&lt;/span>TCP Flags: SYN&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 15:07:20.885: cilium-test/client2-5998d566b4-hrhrb:53070 -&amp;gt; cilium-test/echo-same-node:8080 to-proxy FORWARDED &lt;span class="o">(&lt;/span>TCP Flags: SYN&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 15:07:20.885: cilium-test/client2-5998d566b4-hrhrb:53070 -&amp;gt; cilium-test/echo-same-node:8080 to-proxy FORWARDED &lt;span class="o">(&lt;/span>TCP Flags: ACK&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 15:07:20.885: cilium-test/client2-5998d566b4-hrhrb:53070 -&amp;gt; cilium-test/echo-same-node:8080 to-proxy FORWARDED &lt;span class="o">(&lt;/span>TCP Flags: ACK, PSH&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 15:07:20.885: cilium-test/client2-5998d566b4-hrhrb:53064 -&amp;gt; cilium-test/echo-same-node-745bd5c77-zpzdn:8080 to-proxy FORWARDED &lt;span class="o">(&lt;/span>TCP Flags: ACK, PSH&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 15:07:20.885: cilium-test/client2-5998d566b4-hrhrb:53064 -&amp;gt; cilium-test/echo-same-node-745bd5c77-zpzdn:8080 http-request FORWARDED &lt;span class="o">(&lt;/span>HTTP/1.1 GET http://echo-same-node:8080/&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 15:07:20.886: cilium-test/client2-5998d566b4-hrhrb:53070 -&amp;gt; cilium-test/echo-same-node:8080 to-proxy FORWARDED &lt;span class="o">(&lt;/span>TCP Flags: ACK, FIN&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 15:07:20.886: cilium-test/client2-5998d566b4-hrhrb:53070 -&amp;gt; cilium-test/echo-same-node:8080 to-proxy FORWARDED &lt;span class="o">(&lt;/span>TCP Flags: ACK&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 15:07:26.086: cilium-test/client2-5998d566b4-hrhrb:53048 -&amp;gt; cilium-test/echo-same-node-745bd5c77-zpzdn:8080 to-proxy FORWARDED &lt;span class="o">(&lt;/span>TCP Flags: ACK&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 15:07:44.739: cilium-test/client2-5998d566b4-hrhrb:39057 -&amp;gt; kube-system/coredns-78fcd69978-7lbwh:53 L3-L4 REDIRECTED &lt;span class="o">(&lt;/span>UDP&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 15:07:44.739: cilium-test/client2-5998d566b4-hrhrb:39057 -&amp;gt; kube-system/coredns-78fcd69978-7lbwh:53 to-proxy FORWARDED &lt;span class="o">(&lt;/span>UDP&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 15:07:44.740: cilium-test/client2-5998d566b4-hrhrb:39057 -&amp;gt; kube-system/coredns-78fcd69978-7lbwh:53 to-proxy FORWARDED &lt;span class="o">(&lt;/span>UDP&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 15:07:44.740: cilium-test/client2-5998d566b4-hrhrb:39057 -&amp;gt; kube-system/coredns-78fcd69978-7lbwh:53 dns-request FORWARDED &lt;span class="o">(&lt;/span>DNS Query echo-same-node.cilium-test.svc.cluster.local. AAAA&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 15:07:44.740: cilium-test/client2-5998d566b4-hrhrb:39057 -&amp;gt; kube-system/coredns-78fcd69978-7lbwh:53 dns-request FORWARDED &lt;span class="o">(&lt;/span>DNS Query echo-same-node.cilium-test.svc.cluster.local. A&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 15:07:44.741: cilium-test/client2-5998d566b4-hrhrb:53072 -&amp;gt; cilium-test/echo-same-node:8080 none REDIRECTED &lt;span class="o">(&lt;/span>TCP Flags: SYN&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 15:07:44.741: cilium-test/client2-5998d566b4-hrhrb:53072 -&amp;gt; cilium-test/echo-same-node:8080 to-proxy FORWARDED &lt;span class="o">(&lt;/span>TCP Flags: SYN&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 15:07:44.741: cilium-test/client2-5998d566b4-hrhrb:53072 -&amp;gt; cilium-test/echo-same-node:8080 to-proxy FORWARDED &lt;span class="o">(&lt;/span>TCP Flags: ACK&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 15:07:44.741: cilium-test/client2-5998d566b4-hrhrb:53072 -&amp;gt; cilium-test/echo-same-node:8080 to-proxy FORWARDED &lt;span class="o">(&lt;/span>TCP Flags: ACK, PSH&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 15:07:44.742: cilium-test/client2-5998d566b4-hrhrb:53068 -&amp;gt; cilium-test/echo-other-node-f4d46f75b-bqpcb:8080 to-proxy FORWARDED &lt;span class="o">(&lt;/span>TCP Flags: ACK, PSH&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 15:07:44.742: cilium-test/client2-5998d566b4-hrhrb:53068 -&amp;gt; cilium-test/echo-other-node-f4d46f75b-bqpcb:8080 http-request FORWARDED &lt;span class="o">(&lt;/span>HTTP/1.1 GET http://echo-same-node:8080/&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 15:07:44.744: cilium-test/client2-5998d566b4-hrhrb:53072 -&amp;gt; cilium-test/echo-same-node:8080 to-proxy FORWARDED &lt;span class="o">(&lt;/span>TCP Flags: ACK, FIN&lt;span class="o">)&lt;/span>
Dec &lt;span class="m">18&lt;/span> 15:07:44.744: cilium-test/client2-5998d566b4-hrhrb:53072 -&amp;gt; cilium-test/echo-same-node:8080 to-proxy FORWARDED &lt;span class="o">(&lt;/span>TCP Flags: ACK&lt;span class="o">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¯ä»¥çœ‹åˆ°å®ƒçœŸçš„æˆåŠŸçš„è¿›è¡Œäº†è´Ÿè½½å‡è¡¡ã€‚&lt;/p>
&lt;h2 id="æ€»ç»“">æ€»ç»“&lt;/h2>
&lt;p>æœ¬æ–‡æˆ‘å¸¦ä½ éƒ¨ç½²äº† Cilium Service Meshï¼Œå¹¶é€šè¿‡ä¸¤ä¸ªç¤ºä¾‹ï¼Œå¸¦ä½ ä½“éªŒäº† Cilium Service Mesh çš„å·¥ä½œæƒ…å†µã€‚&lt;/p>
&lt;p>æ•´ä½“è€Œè¨€ï¼Œ è¿™ç§æ–¹å¼èƒ½å¸¦æ¥ä¸€å®šçš„ä¾¿åˆ©æ€§ï¼Œä½†å®ƒçš„æœåŠ¡é—´æµé‡é…ç½®ä¸»è¦ä¾é äº CiliumEnvoyConfig ï¼Œä¸ç®—å¤ªæ–¹ä¾¿ã€‚&lt;/p>
&lt;p>ä¸€èµ·æ¥æœŸå¾…å®ƒåç»­çš„æ¼”è¿›ï¼&lt;/p>
&lt;hr>
&lt;p>æ¬¢è¿è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://gitee.com/tlrr/awesome/raw/master/2020-9-9/1599632564572-mp-qrcode.png" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category><category domain="https://moelove.info/tags/cilium/">cilium</category></item><item><title>GitOps åº”ç”¨å®è·µç³»åˆ— - Flux CD åŠå…¶æ ¸å¿ƒç»„ä»¶</title><link>https://moelove.info/2021/12/18/GitOps-%E5%BA%94%E7%94%A8%E5%AE%9E%E8%B7%B5%E7%B3%BB%E5%88%97-Flux-CD-%E5%8F%8A%E5%85%B6%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6/</link><guid isPermaLink="true">https://moelove.info/2021/12/18/GitOps-%E5%BA%94%E7%94%A8%E5%AE%9E%E8%B7%B5%E7%B3%BB%E5%88%97-Flux-CD-%E5%8F%8A%E5%85%B6%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6/</guid><pubDate>Sat, 18 Dec 2021 20:56:29 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å¼ æ™‹æ¶›ã€‚&lt;/p>
&lt;p>ç»è¿‡å‰é¢ä¸‰ç¯‡æ–‡ç« ï¼Œä¸ä»…ä¸ºå¤§å®¶ä»‹ç»äº†ä»€ä¹ˆæ˜¯ GitOps ä¹Ÿä»‹ç»äº†å¦‚ä½•åˆ©ç”¨ Argo CD æ¥å®æ–½ GitOpsã€‚æœ¬ç¯‡æˆ‘æ¥ä¸ºä½ ä»‹ç»å¦ä¸€ä¸ªå¯ç”¨äºå®æ–½ GitOps çš„å·¥å…·ï¼šFlux CD ã€‚&lt;/p>
&lt;h2 id="flux-cd">Flux CD&lt;/h2>
&lt;p>&lt;img src="https://i.loli.net/2021/10/31/zFRTjgr18Z7XIfM.png" alt="img">&lt;/p>
&lt;p>Flux æ˜¯ä¸€ç»„å¯æ”¯æŒå®ç° GitOps çš„å·¥å…·ï¼Œç”¨äºä½¿ &lt;a href="https://kubernetes.io/">Kubernetes&lt;/a> é›†ç¾¤ä¸é…ç½®æºï¼ˆå¦‚ Git ä»“åº“ï¼‰ä¿æŒåŒæ­¥ï¼Œå¹¶åœ¨æœ‰ä»£ç æ›´æ–°åè‡ªåŠ¨åŒæ­¥é…ç½®ï¼Œé¢å‘ Kubernetes çš„&lt;strong>æŒç»­æ¸è¿›å¼äº¤ä»˜è§£å†³æ–¹æ¡ˆ&lt;/strong>ã€‚&lt;/p>
&lt;p>&lt;img src="https://i.loli.net/2021/10/31/EPI7DHZQkWxySvp.png" alt="img">&lt;/p>
&lt;h2 id="flux-cd-çš„å‘å±•å†å²">Flux CD çš„å‘å±•å†å²&lt;/h2>
&lt;ul>
&lt;li>2016 å¹´ 10 æœˆ 28 æ—¥ï¼Œ&lt;a href="https://github.com/fluxcd/flux/releases/tag/pre-split">Flux single-user service&lt;/a> ç‰ˆæœ¬å‘å¸ƒã€‚&lt;/li>
&lt;/ul>
&lt;p>å®ƒå¥ å®šäº† flux çš„ä¸¤ä¸ªåŸºè°ƒï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;ul>
&lt;li>é›†ä¸­å¼è¿è¡Œçš„æœåŠ¡&lt;/li>
&lt;li>ä»¥å®ˆæŠ¤è¿›ç¨‹çš„æ–¹å¼ï¼Œåœ¨è‡ªåŠ¨æ¨¡å¼ä¸‹è¿è¡Œåœ¨ k8s é›†ç¾¤ä¸­&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>2016 å¹´ 12 æœˆ 15 æ—¥ï¼Œå‘å¸ƒã€Šä½¿ç”¨ Weave Flux æŒç»­äº¤ä»˜ã€‹ï¼Œæ„å»ºäº†å°† CI ä¸æŒç»­éƒ¨ç½² (CD) è”ç³»èµ·æ¥çš„ Fluxã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>â€‹ &lt;img src="https://i.loli.net/2021/10/31/jAcoFS2ulXNH5ia.png" alt="img">&lt;/p>
&lt;ul>
&lt;li>2017 å¹´ 8 æœˆ 22 æ—¥ï¼Œv1.0.0 ç‰ˆæœ¬æ­£å¼å‘å¸ƒã€‚&lt;/li>
&lt;/ul>
&lt;p>è‡ª v1.0.0 å¼€å§‹ï¼ŒFlux è‡´åŠ›äºå°†é›†ç¾¤ä¸å­˜å‚¨åœ¨ Git ä¸­çš„é…ç½®åŒæ­¥ï¼Œå¹¶åœ¨æ–°ç‰ˆæœ¬å‡†å¤‡å¥½éƒ¨ç½²æ—¶è‡ªåŠ¨å‡çº§é•œåƒã€‚ï¼ˆæå‡ºäº†ï¼šConfiguration as codeï¼‰&lt;/p>
&lt;p>â€‹ &lt;img src="https://i.loli.net/2021/10/31/cvXCry2oRlkmUZI.png" alt="img">&lt;/p>
&lt;ul>
&lt;li>
&lt;p>2018 å¹´ 5 æœˆ 1 æ—¥ï¼Œå‘å¸ƒçš„ alpha ç‰ˆæœ¬ä¸­ï¼Œé›†æˆäº† Helm Operator ã€‚è¿™æ˜¯ Flux Helm Operator çš„ç¬¬ä¸€ä¸ª alpha æ ‡ç­¾çš„ç‰ˆæœ¬ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>2019 å¹´ 8 æœˆ 15 æ—¥ï¼ŒFlux å®£å¸ƒåŠ å…¥ CNCF Sandboxã€‚éšç€å„å¼€å‘è€…åŠä¼ä¸šå¼€å§‹è½åœ° GitOps ï¼ŒFlux çš„ç”¨æˆ·æ•°é‡ä¸æ–­å¢é•¿ã€‚ å½¼æ—¶å·²è¶…è¿‡ 2500 ä¸ª GitHub starï¼Œä¹Ÿåœ¨ä¸æ–­åœ°é›†æˆï¼šHelm Operator ã€ Kustomize ã€ Weave Flagger ã€ OpenFaaS ã€ Fluxcloud ã€ Flux Web UI ç­‰ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>2019 å¹´ 10 æœˆ 2 æ—¥å‘å¸ƒçš„ç‰ˆæœ¬ï¼Œæ­£å¼æ”¯æŒ kustomize ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>2019 å¹´ 11 æœˆ 14 æ—¥ï¼Œã€ŠArgo Flux ç®€ä»‹ - Weaveworks-Intuit-AWS åä½œã€‹ä¸­ï¼ŒWeaveworks å®£å¸ƒä¸ Intuit åˆä½œåˆ›å»ºäº† Argo Fluxã€‚è¯¥é¡¹ç›®è¢«ç§°ä¸º &lt;a href="https://github.com/argoproj/gitops-engine">GitOps-Engine&lt;/a> ï¼Œç°åœ¨ä½äº Argo é¡¹ç›®ç»„ç»‡ä¸­ï¼Œç”± Intuitã€Red Hat å’Œ GitLab é©±åŠ¨ã€‚ï¼ˆå…·ä½“å¯å‚è€ƒï¼šhttps://www.weave.works/blog/argo-flux-join-forcesï¼‰&lt;/p>
&lt;/li>
&lt;li>
&lt;p>2020 å¹´ 10 æœˆ 5 æ—¥ï¼ŒFlux v1ï¼ˆå’Œ Helm Operator v1ï¼‰å®£å¸ƒå¤„äºç»´æŠ¤æ¨¡å¼ï¼ˆä»…æä¾› 6 ä¸ªæœˆæ”¯æŒï¼‰ï¼Œå¹¶å®£å¸ƒå°†è‡´åŠ›äº Flux v2 çš„å¼€å‘ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;ul>
&lt;li>Flux v1 is in maintenance mode #3320 &lt;a href="https://github.com/fluxcd/flux/issues/3320">https://github.com/fluxcd/flux/issues/3320&lt;/a>&lt;/li>
&lt;li>Helm Operator (v1) is in maintenance mode #546 &lt;a href="https://github.com/fluxcd/helm-operator/issues/546">https://github.com/fluxcd/helm-operator/issues/546&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;ul>
&lt;li>V1 in maintenance #25 &lt;a href="https://github.com/fluxcd/website/pull/25">https://github.com/fluxcd/website/pull/25&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>2021 å¹´ 2 æœˆ 17æ—¥æ–°ç‰ˆæœ¬å‘å¸ƒï¼Œæ­£å¼å°† issueã€PR æŒ‡å‘ v2ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>2021 å¹´ 3 æœˆ 11 æ—¥ï¼ŒCNCF æŠ€æœ¯ç›‘ç£å§”å‘˜ä¼šï¼ˆTOCï¼‰ æŠ•ç¥¨å°† Flux ä» Sandbox æå‡ä¸ºå­µåŒ–é¡¹ç›®ï¼ˆIncubationï¼‰ã€‚è‡ªåŠ å…¥ CNCF Sandbox ä»¥æ¥ï¼ŒFlux çš„æœ€ç»ˆç”¨æˆ·ç¾¤å¢åŠ äº† 2.75 å€ï¼Œå¹¶å°†å…¶ç¤¾åŒºæ‰©å¤§äº† 2 è‡³ 4 å€ï¼ŒåŒ…æ‹¬ Slack ç”¨æˆ·ã€é‚®ä»¶åˆ—è¡¨è®¢é˜…è€…å’Œè´¡çŒ®è€…ã€‚ 80 å¤šä¸ªç»„ç»‡åœ¨ç”Ÿäº§ä¸­ä½¿ç”¨å®ƒï¼ŒåŒ…æ‹¬ Babylon Healthã€Fidelity Investmentsã€MyFitnessPalã€Starbucks ç­‰ç­‰ã€‚ CNCF End User Community å°† Flux çº³å…¥æŒç»­äº¤ä»˜çš„ Technology Radarã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>â€‹ &lt;img src="https://i.loli.net/2021/10/31/ThMWO3VmNrIb7Q4.png" alt="img">&lt;/p>
&lt;ul>
&lt;li>2021 å¹´ 8 æœˆ 13 æ—¥ï¼Œæ­£å¼å‘å¸ƒäº†ã€ŠFlux v2 åŠ©åŠ› GitOps å˜å¾—æ›´å¥½ã€‹ï¼Œå®£å‘Šäº†ä» Flux åˆ° Flux v2 çš„äº¤æ›¿ã€‚Flux v2 åœ¨ Flux å·²æœ‰åŠŸèƒ½çš„åŸºç¡€ä¸Šï¼Œæ›´é€‚äº Kubernetes çš„æ“ä½œå’Œ&lt;strong>å¯è§‚æµ‹æ€§&lt;/strong>ï¼Œå¹¶ä¸”åŠŸèƒ½æ›´å¼ºå¤§ã€‚Flux v2 çš„åŸºç¡€æ˜¯ GitOps Toolkitï¼Œè¿™æ˜¯ä¸€ç»„ç”¨äºæ„å»ºåŸºäº GitOps çš„äº¤ä»˜å’Œè‡ªåŠ¨åŒ–ç»„ä»¶ã€‚ï¼ˆä¹Ÿå®ç°äº†é‡è¦ç»„ä»¶çš„è§£è€¦ï¼Œå…·ä½“å¯å‚è€ƒï¼šhttps://www.weave.works/blog/gitops-with-flux-v2ï¼‰&lt;/li>
&lt;/ul>
&lt;p>â€‹ &lt;img src="https://i.loli.net/2021/10/31/rzXIFQh9UcNKlTv.png" alt="img">&lt;/p>
&lt;p>â€‹ æ³¨ï¼šFlux å›¢é˜Ÿå†³å®šåœ¨ä¸ä½¿ç”¨ GitOps Engine çš„æƒ…å†µä¸‹ç»§ç»­å‰è¿›ï¼Œå¹¶æ„å»ºäº†&lt;a href="https://fluxcd.io/docs/">GitOps Toolkit&lt;/a>ã€‚Flux v2 å‚è€ƒäº† GitOps Engine ï¼Œä½†å®ƒä¸ä½¿ç”¨ GitOps Engineã€‚&lt;/p>
&lt;ul>
&lt;li>è‡ª 2018 å¹´ 10 æœˆå¼€å§‹çš„ Flagger é¡¹ç›®ä¹Ÿäº 2021 å¹´é›†æˆå…¥ Flux v2ã€‚&lt;/li>
&lt;/ul>
&lt;p>â€‹ &lt;img src="https://i.loli.net/2021/10/31/ePZqo5dO7LCJzvX.png" alt="img">&lt;/p>
&lt;p>â€‹ &lt;img src="https://i.loli.net/2021/10/31/davhq8DzFbyGj16.png" alt="img">&lt;/p>
&lt;h2 id="flux-cd-v2-å’Œ-gitops-toolkit">Flux CD v2 å’Œ GitOps Toolkit&lt;/h2>
&lt;h3 id="gitops-toolkit">GitOps Toolkit&lt;/h3>
&lt;p>GitOps Toolkit æ˜¯æ„æˆ Flux è¿è¡Œæ—¶çš„ä¸€ç»„ APIs å’Œ controllers ã€‚å¯ä»¥é€šè¿‡ GitOps Toolkit æ¥æ‰©å±• Fluxï¼Œå¹¶æ„å»ºæ‰€éœ€ CD ç³»ç»Ÿã€‚&lt;/p>
&lt;h3 id="source-controller">Source Controller&lt;/h3>
&lt;p>Source Controller ä¸»è¦ä½œç”¨æ˜¯ä¸ºå·¥ä»¶è·å–æä¾›é€šç”¨æ¥å£ã€‚Source API å®šä¹‰äº†ä¸€ç»„ Kubernetes å¯¹è±¡ï¼Œcluster admin å’Œå„ç§è‡ªåŠ¨åŒ– operator å¯ä»¥ä¸ä¹‹äº¤äº’ï¼Œä»¥å°† Sourceï¼ˆå¦‚ Git å’Œ Helm repoï¼‰æ³¨å†Œã€èº«ä»½éªŒè¯ã€éªŒè¯å’Œèµ„æºè·å–å¸è½½åˆ°ä¸“ç”¨çš„ controller ã€‚&lt;/p>
&lt;p>æ¯ä¸ª Flux å’Œ Helm çš„ operator éƒ½ä»¥ç›¸åŒçš„æ–¹å¼ä½¿ç”¨ Git repositories ä¸­çš„ä»£ç ï¼ˆé•œåƒï¼‰ï¼Œä½†æ˜¯å…¶ä»–ç»„ä»¶å¯èƒ½éœ€è¦è®¿é—®åˆ°ä¸åŒçš„é•œåƒã€‚Flux å’Œ Helm operator å°±å¯ä»¥ä½¿ç”¨æ ‡å‡†çš„ Kubernetes æœºåˆ¶æ¥æ„å»º Source ï¼ˆé€šå¸¸æ˜¯ Git repoï¼Œä½†ä¹Ÿæœ‰ Helm chart ç­‰ï¼‰ ä½œä¸º Kubernetes èµ„æºï¼Œç‹¬ç«‹äºä½¿ç”¨å®ƒä»¬çš„ç»„ä»¶è¿›è¡Œç®¡ç†ã€‚&lt;/p>
&lt;p>&lt;img src="https://i.loli.net/2021/10/31/7JR9PlXLhqUatfT.png" alt="img">&lt;/p>
&lt;h4 id="git-repository">Git Repository&lt;/h4>
&lt;p>å®ƒä¸ºæ¥è‡ª Git çš„ artifact å®šä¹‰äº†ä¸€ä¸ªæºï¼Œå°†æ¥è‡ª Git çš„æœ€æ–°çŠ¶æ€ä½œä¸º artifact å…¬å¼€ä¸º gzip å‹ç¼©çš„ TAR æ–‡ä»¶ ( &lt;commit hash>.tar.gz) ã€‚&lt;/p>
&lt;p>é»˜è®¤æƒ…å†µä¼šæ’é™¤ï¼ŒGit æ–‡ä»¶ ( .git/ ,.gitignore, .gitmodules, .gitattributes)ï¼›æ–‡ä»¶æ‰©å±•å ( .jpg, .jpeg, .gif, .png, .wmv, .flv, .tar.gz, .zip)ï¼›CI é…ç½® ( .github/, .circleci/, .travis.yml, .gitlab-ci.yml, appveyor.yml, .drone.yml, cloudbuild.yaml, codeship-services.yml, codeship-steps.yml)ï¼›CLI é…ç½® ( .goreleaser.yml, .sops.yaml)ï¼›Flux v1 é…ç½® ( .flux.yaml)ã€‚&lt;/p>
&lt;p>å¦‚æœæƒ³è¦è‡ªå®šä¹‰æ’é™¤å¯ä»¥è€ƒè™‘ä»¥ä¸‹ä¸¤ç§åŠæ³•ï¼š&lt;/p>
&lt;ul>
&lt;li>é€šè¿‡ &lt;code>.sourceignore&lt;/code> åœ¨ repository çš„æ ¹ç›®å½•ä¸­æ·»åŠ æ–‡ä»¶ ã€‚ï¼ˆéµå¾ª .gitignore æ ¼å¼ï¼Œè¯¦è§ &lt;a href="https://git-scm.com/docs/gitignore#_pattern_format">https://git-scm.com/docs/gitignore#_pattern_format&lt;/a> ï¼‰&lt;/li>
&lt;li>ä½¿ç”¨ spec.ignore å­—æ®µã€‚&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">source.toolkit.fluxcd.io/v1beta1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">GitRepository&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">podinfo&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">namespace&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">default&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">interval&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">5m&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">url&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">https://github.com/stefanprodan/podinfo&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">ignore&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">|&lt;/span>&lt;span class="sd">
&lt;/span>&lt;span class="sd"> ## exclude all
&lt;/span>&lt;span class="sd"> /*
&lt;/span>&lt;span class="sd"> ## include deploy dir
&lt;/span>&lt;span class="sd"> !/deploy
&lt;/span>&lt;span class="sd"> ## exclude file extensions from deploy dir
&lt;/span>&lt;span class="sd"> /deploy/**/*.md
&lt;/span>&lt;span class="sd"> /deploy/**/*.txt &lt;/span>&lt;span class="w">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="helm-charts">Helm Charts&lt;/h4>
&lt;p>å®ƒä¸ºæ¥è‡ª Helm æº çš„ Helm chart artifacts å®šä¹‰äº†ä¸€ä¸ªæºï¼Œå°†ä½œä¸º artifact çš„æœ€æ–°æ‹‰å–æˆ–æ‰“åŒ…çš„ chart å…¬å¼€ã€‚&lt;/p>
&lt;h4 id="helm-repositories">Helm Repositories&lt;/h4>
&lt;p>å®ƒä¸º Helm repositories å®šä¹‰äº†ä¸€ä¸ªæºï¼Œå°†ä½œä¸º artifact çš„æœ€æ–°åŒæ­¥çš„ repository ç´¢å¼•å…¬å¼€ã€‚&lt;/p>
&lt;h4 id="object-storage-buckets">Object storage buckets&lt;/h4>
&lt;p>å®ƒä¸ºæ¥è‡ª S3 å…¼å®¹çš„å­˜å‚¨ï¼ˆMinio, Amazon S3, Google Cloud Storage, Alibaba Cloud OSS ç­‰ç­‰ï¼‰å®šä¹‰äº†ä¸€ä¸ªæºï¼Œå°†æ¥è‡ª S3 çš„æœ€æ–°åŒæ­¥çŠ¶æ€ä½œä¸º artifact å…¬å¼€ä¸º gzip å‹ç¼©çš„ TAR æ–‡ä»¶ ( &lt;bucket checksum>.tar.gz) ã€‚&lt;/p>
&lt;p>é»˜è®¤åŠè‡ªå®šä¹‰æ’é™¤æ–‡ä»¶ï¼Œå¯å‚è€ƒ Git Repositories ä¸­çš„æ’é™¤æ–‡ä»¶ç›¸å…³å†…å®¹ã€‚&lt;/p>
&lt;h3 id="kustomize-controller">Kustomize Controller&lt;/h3>
&lt;p>kustomize-controller æ˜¯ä¸€ä¸ªä¸“é—¨ç”¨äºè¿è¡Œé€šè¿‡ä½¿ç”¨ Kustomize ç»„è£… Kubernetes æ¸…å•å’Œå·¥ä½œè´Ÿè½½å®šä¹‰çš„æŒç»­äº¤ä»˜pipeline çš„ Kubernetes operatorã€‚å®ƒæä¾›ä¸€ä¸ªè‡ªåŠ¨åŒ–çš„ operator ï¼Œå¯ä»¥å¼•å¯¼å¹¶æŒç»­åè°ƒæ¥è‡ªå¤šä¸ª sourcesï¼ˆä¾‹å¦‚åŸºç¡€è®¾æ–½å’Œåº”ç”¨ç¨‹åº repositories ï¼‰çš„é›†ç¾¤çŠ¶æ€ã€‚&lt;/p>
&lt;p>é…ç½®æ–°é›†ç¾¤æ—¶ï¼Œå¯ä»¥æŒ‰ç…§ç‰¹å®šé¡ºåºå®‰è£…å·¥ä½œè´Ÿè½½ã€‚å½“å¤šä¸ªå›¢é˜ŸåŒæ—¶æ“ä½œé›†ç¾¤æ—¶ï¼Œé›†ç¾¤ç®¡ç†å‘˜å¯ä»¥ä¸ºæ¯ä¸ªå›¢é˜Ÿåˆ†é…è§’è‰²å’ŒæœåŠ¡å¸æˆ·ã€‚å›¢é˜Ÿæ‹¥æœ‰çš„ manifests å°†ä½¿ç”¨å›¢é˜Ÿå¸æˆ·åº”ç”¨äºé›†ç¾¤ï¼Œä»è€Œç¡®ä¿å›¢é˜Ÿä¹‹é—´çš„éš”ç¦»ã€‚&lt;/p>
&lt;p>å¤„ç†äº‹ä»¶æ—¶ï¼Œå¯ä»¥é€‰æ‹©ä¸åœæ­¢åè°ƒå™¨å½±å“æ•´ä¸ªé›†ç¾¤ï¼Œé‡‡ç”¨æš‚åœæŸäº›å·¥ä½œè´Ÿè½½çš„åè°ƒå¹¶å°†å…¶ä»–å·¥ä½œè´Ÿè½½çš„åè°ƒå›ºå®šåˆ°æŒ‡å®šçš„ Git ç‰ˆæœ¬çš„æ–¹å¼è¿›è¡Œã€‚&lt;/p>
&lt;p>æ“ä½œé›†ç¾¤æ—¶ï¼Œä¸åŒçš„å›¢é˜Ÿå¯ä»¥æ”¶åˆ°ä¸ä¹‹ç›¸å…³çš„ CD pipeline çŠ¶æ€é€šçŸ¥ã€‚&lt;/p>
&lt;p>&lt;img src="https://i.loli.net/2021/10/31/ZMfAKIuLxH9BE4S.png" alt="img">&lt;/p>
&lt;p>Kustomization API å®šä¹‰äº†ä¸€ä¸ªå¯ä»¥è·å–ï¼Œè§£å¯†ï¼Œæ„å»ºï¼ŒéªŒè¯å’Œåº”ç”¨ Kubernetes manifests çš„ pipeline ã€‚&lt;/p>
&lt;p>&lt;code>spec.sourceRef&lt;/code> æ˜¯å¯¹ Source Controller ç®¡ç†çš„å¯¹è±¡çš„å¼•ç”¨ ã€‚å½“ Source ï¼ˆæ”¯æŒç±»å‹ï¼šGitRepositoryã€Bucketï¼‰ç‰ˆæœ¬å˜æ›´æ—¶ï¼Œå®ƒä¼šç”Ÿæˆä¸€ä¸ª Kubernetes äº‹ä»¶ï¼Œè§¦å‘ kustomize çš„æ„å»ºå’Œåº”ç”¨ã€‚&lt;/p>
&lt;p>å¦‚æœ repository åŒ…å«åŸå§‹çš„ Kubernetes manifestï¼Œä¼šä¸º &lt;code>spec.path&lt;/code> å’Œå­ç›®å½•ä¸­çš„æ‰€æœ‰ Kubernetes manifest è‡ªåŠ¨ç”Ÿæˆ &lt;code>kustomization.yaml&lt;/code>ã€‚ï¼ˆå»ºè®® kustomization.yaml è‡ªè¡Œç”Ÿæˆå¹¶å­˜å‚¨åœ¨ Git ä»“åº“ä¸­ï¼‰&lt;/p>
&lt;p>&lt;code>spec.interval&lt;/code> å‘Šè¯‰ Controller åœ¨å“ªä¸ªæ—¶é—´é—´éš”ä¸º Source è·å– Kubernetes manifestï¼Œæ„å»º Kustomization å¹¶å°†å…¶åº”ç”¨äºé›†ç¾¤ã€‚é—´éš”æ—¶é—´å•ä½æ˜¯ sï¼ˆæœ€å°å€¼åº”è¶…è¿‡ 60 ç§’ï¼Œinterval: 60sï¼‰ã€‚&lt;/p>
&lt;p>&lt;code>spec.healthChecks&lt;/code> ã€&lt;code>spec.wait&lt;/code> å’Œ &lt;code>spec.timeout&lt;/code> å¯ä»¥è®¾ç½®ä¸€ç³»åˆ—è¿è¡ŒçŠ¶å†µæ£€æŸ¥ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>Kubernetes å†…ç½®ï¼ˆDeploymentã€DaemonSetã€StatefulSetã€PersistentVolumeClaimã€Podã€PodDisruptionBudgetã€Jobã€CronJobã€Serviceã€Secretã€ConfigMapã€CustomResourceDefinitionï¼‰&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Toolkit ï¼ˆHelmReleaseã€HelmRepositoryã€GitRepositoryç­‰ï¼‰&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä¸ kstatus å…¼å®¹çš„è‡ªå®šä¹‰èµ„æº ï¼ˆhttps://github.com/kubernetes-sigs/cli-utils/tree/master/pkg/kstatusï¼‰&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>&lt;code>spec.dependsOn&lt;/code> å¯ä»¥è‡ªå®šä¹‰ä¾èµ–ã€‚å¤šä¸ª Kustomizations çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥æŒ‡å®šå…ˆåé¡ºåºåŠä¾èµ–ã€‚è¿™å°±å¼•å…¥äº†ä¸¤ä¸ªå¿…é¡»æ³¨æ„çš„åœ°æ–¹ï¼š&lt;/p>
&lt;ul>
&lt;li>é¿å…å¾ªç¯ã€‚&lt;/li>
&lt;li>ä¸å¥åº·æ£€æŸ¥ç»“åˆä½¿ç”¨æ—¶ï¼Œå°†åœ¨å…¶æ‰€æœ‰ä¾èµ–é¡¹å¥åº·æ£€æŸ¥é€šè¿‡åè¿è¡Œ Kustomizationã€‚&lt;/li>
&lt;/ul>
&lt;p>Kustomization åœ¨è¦†ç›–è‡ªå®šä¹‰é…ç½®ã€å˜é‡æ›¿æ¢ã€åŠ è§£å¯†ç­‰ä¹Ÿæœ‰è¿™å¾ˆå¤šçµæ´»çš„è®¾ç½®ï¼Œæ„Ÿå…´è¶£çš„å°ä¼™ä¼´å¯ä»¥è‡ªè¡Œé˜…è¯»å®˜æ–¹æ–‡æ¡£äº†è§£ã€‚&lt;/p>
&lt;h3 id="helm-controller">Helm Controller&lt;/h3>
&lt;p>Helm Controller æ˜¯ä¸€ä¸ª Kubernetes operatorï¼Œå…è®¸ä½¿ç”¨ Kubernetes manifests ä»¥å£°æ˜æ–¹å¼ç®¡ç† Helm chart Releaseã€‚å®ƒæä¾›ä¸€ä¸ªè‡ªåŠ¨åŒ–çš„ operator ï¼Œå¯ä»¥æ‰§è¡Œ Helm æ“ä½œï¼ˆä¾‹å¦‚å®‰è£…ã€å‡çº§ã€å¸è½½ã€å›æ»šã€æµ‹è¯•ï¼‰å¹¶æŒç»­åè°ƒ Helm Releaseçš„çŠ¶æ€ã€‚&lt;/p>
&lt;p>é…ç½®æ–°é›†ç¾¤æ—¶ï¼Œå¯ä»¥æŒ‡å®šé¡ºåºå®‰è£… Helm Releaseã€‚å¤„ç†äº‹ä»¶æ—¶ï¼Œå¯ä»¥ä¸å¿…åœæ­¢åè°ƒå™¨å½±å“æ•´ä¸ªé›†ç¾¤ï¼Œé‡‡ç”¨æš‚åœä¸€äº› Helm Release çš„åè°ƒå³å¯ã€‚æ“ä½œé›†ç¾¤æ—¶ï¼Œä¸åŒçš„å›¢é˜Ÿå¯ä»¥æ”¶åˆ°ä¸å…¶æœ‰å…³çš„ Helm Release çŠ¶æ€çš„é€šçŸ¥ã€‚
&lt;img src="https://i.loli.net/2021/10/31/rLByzJExwYhHkj1.png" alt="img">&lt;/p>
&lt;p>&lt;img src="https://i.loli.net/2021/10/31/TLDrP41nQtigNkv.png" alt="img">&lt;/p>
&lt;p>HelmRelease å¯¹è±¡å®šä¹‰äº†ä¸€ä¸ªæ§åˆ¶å™¨èµ„æºé€šè¿‡ Helm æ“ä½œï¼ˆä¾‹å¦‚å®‰è£…ã€å‡çº§ã€æµ‹è¯•ã€å¸è½½å’Œå›æ»šï¼‰é©±åŠ¨çš„ Helm Release åè°ƒã€‚åŒ…æ‹¬å‘å¸ƒä½ç½®ï¼ˆnamespace/nameï¼‰ã€å‘å¸ƒå†…å®¹ï¼ˆchart/values overridesï¼‰ã€æ“ä½œè§¦å‘å™¨é…ç½®ã€ä¸ªåˆ«æ“ä½œé…ç½®å’ŒçŠ¶æ€ã€‚&lt;/p>
&lt;p>å¯ä»¥åˆ†åˆ«é€šè¿‡ &lt;code>spec.targetNamespace&lt;/code>ã€&lt;code>spec.storageNamespace&lt;/code> å’Œ &lt;code>spec.releaseName&lt;/code> è¦†ç›–é»˜è®¤éƒ¨ç½²å’Œå­˜å‚¨ Helm Release çš„namespace/nameã€‚&lt;/p>
&lt;p>&lt;code>spec.chart.spec&lt;/code> æ˜¯åˆ›å»ºå…·æœ‰æŒ‡å®š spec çš„æ–° HelmChart èµ„æºçš„æ¨¡æ¿ã€‚&lt;code>spec.chart.spec.sourceRef&lt;/code> æ˜¯å¯¹ Source Controller ç®¡ç†çš„å¯¹è±¡çš„å¼•ç”¨ã€‚ å½“ sourceï¼ˆæ”¯æŒç±»å‹ï¼šHelmRepositoryã€GitRepositoryã€Bucketï¼‰ ç‰ˆæœ¬å˜æ›´æ—¶ï¼Œä¼šç”Ÿæˆè§¦å‘æ–°ç‰ˆæœ¬çš„ Kubernetes äº‹ä»¶ã€‚&lt;/p>
&lt;p>å¦‚æœæ²¡æœ‰æ‰¾åˆ°å…·æœ‰åŒ¹é… namespace/name çš„ Helm Releaseï¼Œå°†å®‰è£…é…ç½®ä¸­çš„ Helm Release ã€‚&lt;/p>
&lt;p>å½“å‡ºç°ä»¥ä¸‹çŠ¶æ€æ›´æ–°æ—¶ï¼ŒHelm Release å°†å‡çº§ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>spec ï¼ˆä»¥åŠ metadata.generation ï¼‰&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æœ€æ–°çš„ HelmChart ä¿®è®¢ç‰ˆå¯ç”¨&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ConfigMap å’Œ Secret å€¼è¦†ç›–ï¼ˆä¸ºäº†é¿å…åœ¨æ›´æ–°å¤šä¸ªèµ„æºæ—¶å‘ç”Ÿå¤§é‡å‡çº§ï¼Œä¸ä¼šç«‹å³è¿›è¡Œï¼Œä¼šåœ¨spec.interval é—´éš”åè¿›è¡Œï¼‰&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>Helm æ”¯æŒå®‰è£… CRDï¼Œç”±äºå­˜åœ¨æ•°æ®ä¸¢å¤±çš„é£é™©ï¼Œç›®å‰æš‚ä¸æ”¯æŒä½¿ç”¨ Helm å‡çº§æˆ–åˆ é™¤ CRDã€‚&lt;/p>
&lt;p>æ›´å¤š Helm Controller çš„è¯¦ç»†å†…å®¹æ¬¢è¿å‚è€ƒå®˜æ–¹æ–‡æ¡£ã€‚&lt;/p>
&lt;h3 id="notification-controller">Notification Controller&lt;/h3>
&lt;p>Notification Controller æ˜¯ä¸€ä¸ª Kubernetes operatorï¼Œä¸“é—¨å¤„ç†å‡ºå…¥å£äº‹ä»¶ã€‚&lt;/p>
&lt;p>å®ƒæä¾›ä¸€ä¸ªé€šçŸ¥æœåŠ¡ï¼Œå¯ä»¥é€šè¿‡ HTTP æ¥æ”¶äº‹ä»¶å¹¶æ ¹æ®äº‹ä»¶ä¸¥é‡æ€§å’Œæ¶‰åŠçš„å¯¹è±¡å°†å®ƒä»¬åˆ†æ´¾åˆ°å¤–éƒ¨ç³»ç»Ÿï¼ˆSlackã€Microsoft Teamsã€Discordã€Rockerï¼‰ã€‚&lt;/p>
&lt;p>GitOps Controller æœ¬è´¨ä¸Šæ˜¯åŸºäºæ‹‰å–çš„ï¼Œä¸ºäº†é€šçŸ¥ Controllers æœ‰å…³ Git æˆ– Helm åº“ä¸­çš„å˜æ›´ï¼Œå¯ä»¥æ”¯æŒè®¾ç½® webhooks åœ¨æ¯æ¬¡æºæ›´æ”¹æ—¶è§¦å‘é›†ç¾¤åè°ƒã€‚&lt;/p>
&lt;p>&lt;img src="https://i.loli.net/2021/10/31/LAOYlxyZBibmgdj.png" alt="img">&lt;/p>
&lt;h3 id="image-reflector-and-automation-controllers">Image reflector and automation controllers&lt;/h3>
&lt;p>image-reflector-controller å’Œ image-automation-controller ååŒå·¥ä½œï¼Œåœ¨æ–°çš„å®¹å™¨é•œåƒå¯ç”¨æ—¶æ›´æ–° Git repositoryã€‚&lt;/p>
&lt;ul>
&lt;li>image-reflector-controller æ‰«æé•œåƒä»“åº“ï¼Œå¹¶ä¸ K8S èµ„æºä¸­çš„å…ƒæ•°æ®è¿›è¡Œå¯¹æ¯”ã€‚&lt;/li>
&lt;li>image-automation-controller æ ¹æ®æ‰«æåˆ°çš„æœ€æ–°é•œåƒï¼Œæ›´æ–° YAML æ–‡ä»¶ å¹¶ä¸”æäº¤å˜æ›´åˆ°æŒ‡å®šçš„ Git repositoryã€‚&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://i.loli.net/2021/10/31/Z1klTnrbuKH6Dae.png" alt="img">&lt;/p>
&lt;h2 id="flux-cd-ä½¿ç”¨è¦æ±‚">Flux CD ä½¿ç”¨è¦æ±‚&lt;/h2>
&lt;h3 id="kubernetes-ç‰ˆæœ¬">Kubernetes ç‰ˆæœ¬&lt;/h3>
&lt;p>ä½¿ç”¨ Flux CDï¼Œæœ€å¥½ Kubernetes é›†ç¾¤ç‰ˆæœ¬åœ¨ v&lt;strong>1.19&lt;/strong> æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚æ—§ç‰ˆæœ¬ä¹Ÿæ”¯æŒï¼Œä½†å®˜æ–¹ä¸å»ºè®®åœ¨ç”Ÿäº§ä¸­è¿è¡Œ EOL Kubernetes ç‰ˆæœ¬ã€‚&lt;/p>
&lt;p>&lt;img src="https://i.loli.net/2021/10/31/BJhqdksWc5Mue6K.png" alt="img">&lt;/p>
&lt;p>æ³¨ï¼šå¦‚æœä½ æ­£åœ¨ä½¿ç”¨ APIServiceï¼ˆä¾‹å¦‚ &lt;a href="https://github.com/kubernetes-sigs/metrics-server">metrics-server&lt;/a>ï¼‰ï¼ŒKubernetes é›†ç¾¤ç‰ˆæœ¬è‡³å°‘éœ€è¦ v1.18.18ï¼Œv1.19.10ï¼Œv1.20.6 æˆ– v1.21.0 ã€‚&lt;/p>
&lt;h3 id="git-repo-æƒé™">Git Repo æƒé™&lt;/h3>
&lt;p>é€šè¿‡è®¾ç½® SSH éƒ¨ç½²å¯†é’¥æˆ–ä½¿ç”¨åŸºäºä»¤ç‰Œçš„èº«ä»½éªŒè¯ï¼Œå°†ç›®æ ‡é›†ç¾¤é…ç½®ä¸ºä¸ Git åº“è¿›è¡ŒåŒæ­¥ã€‚&lt;/p>
&lt;ul>
&lt;li>GitLab ä½¿ç”¨ç¤ºä¾‹&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-plain" data-lang="plain">//å°† GitLab personal access token å¯¼å‡ºä¸ºç¯å¢ƒå˜é‡ï¼š
export GITLAB_TOKEN=&amp;lt;your-token&amp;gt;
//åœ¨ GitLab è´¦å·ä¸Šè¿è¡Œ git åº“çš„å¼•å¯¼ç¨‹åºï¼š
flux bootstrap gitlab \
--owner=my-gitlab-username \
--repository=my-repository \
--branch=master \
--path=clusters/my-cluster \
--token-auth \
--personal
//ä½¿ç”¨éƒ¨ç½²å¯†é’¥è¿›è¡Œèº«ä»½éªŒè¯è¿è¡Œ git åº“çš„å¼•å¯¼ç¨‹åºï¼Œå¿…é¡»æŒ‡å®š SSH hostnameï¼š
flux bootstrap gitlab \
--ssh-hostname=gitlab.com \
--owner=my-gitlab-username \
--repository=my-repository \
--branch=master \
--path=clusters/my-cluster
//ä¸º GitLab å›¢é˜Ÿçš„ git åº“è¿è¡Œå¼•å¯¼ç¨‹åºï¼š
flux bootstrap gitlab \
--owner=my-gitlab-group/my-gitlab-subgroup \
--repository=my-repository \
--branch=master \
--path=clusters/my-cluster
//ä¸ºæ‰˜ç®¡åœ¨æœ¬åœ°æˆ–ä¼ä¸š GitLab ä¸Šçš„ git åº“è¿è¡Œå¼•å¯¼ç¨‹åºï¼Œå¿…é¡»æŒ‡å®š GitLab hostnameï¼š
flux bootstrap gitlab \
--hostname=my-gitlab.com \
--token-auth \
--owner=my-gitlab-group \
--repository=my-repository \
--branch=master \
--path=clusters/my-cluster
&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>GitHub ä½¿ç”¨ç¤ºä¾‹&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-plain" data-lang="plain">//å°† GitHub personal access token å¯¼å‡ºä¸ºç¯å¢ƒå˜é‡ï¼š
export GITHUB_TOKEN=&amp;lt;your-token&amp;gt;
//flux bootstrap å‘½ä»¤ä¼šåˆ›å»ºä¸€ä¸ª SSH å¯†é’¥ï¼Œå¹¶å­˜å‚¨åœ¨ Kubernetes é›†ç¾¤ä¸­ã€‚
//è¯¥å¯†é’¥è¿˜ç”¨äºåœ¨ GitHub åº“ä¸­åˆ›å»ºéƒ¨ç½²å¯†é’¥ã€‚
//åœ¨ GitHub è´¦å·ä¸Šè¿è¡Œ git åº“çš„å¼•å¯¼ç¨‹åºï¼š
flux bootstrap github \
--owner=my-github-username \
--repository=my-repository \
--path=clusters/my-cluster \
--personal
//å½“æŒ‡å®šå›¢é˜Ÿåˆ—è¡¨æ—¶ï¼Œè¿™äº›å›¢é˜Ÿå°†è¢«æˆäºˆå¯¹ git åº“çš„ç»´æŠ¤è€…è®¿é—®æƒé™ã€‚
//ä¸º GitHub ä¸­å›¢é˜Ÿæ‹¥æœ‰çš„ git åº“è¿è¡Œå¼•å¯¼ç¨‹åºï¼š
flux bootstrap github \
--owner=my-github-organization \
--repository=my-repository \
--team=team1-slug \
--team=team2-slug \
--path=clusters/my-cluster
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="æ€»ç»“">æ€»ç»“&lt;/h2>
&lt;p>æœ¬ç¯‡ä¸»è¦ä»‹ç»äº† Flux CD çš„å‘å±•å†å²å’Œå…¶æ ¸å¿ƒç»„ä»¶åŠå…¶åŠŸèƒ½ï¼Œåç»­æ–‡ç« ä¸­å°†é™†ç»­ä»‹ç»å¦‚ä½•ä½¿ç”¨ Flux CD æ¥å®è·µ GitOpsï¼Œæ•¬è¯·æœŸå¾…ã€‚&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category><category domain="https://moelove.info/tags/GitOps/">GitOps</category></item><item><title>Grafana k6 çš„ä¸Šæ‰‹å®è·µ</title><link>https://moelove.info/2021/12/17/Grafana-k6-%E7%9A%84%E4%B8%8A%E6%89%8B%E5%AE%9E%E8%B7%B5/</link><guid isPermaLink="true">https://moelove.info/2021/12/17/Grafana-k6-%E7%9A%84%E4%B8%8A%E6%89%8B%E5%AE%9E%E8%B7%B5/</guid><pubDate>Fri, 17 Dec 2021 03:50:29 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å¼ æ™‹æ¶›ã€‚&lt;/p>
&lt;p>æœ¬ç¯‡æˆ‘å°†ä¸ºä½ ä»‹ç»ä¸€ä¸ªå·¥å…· - k6 ï¼Œå®ƒå’Œ K8s å¹¶æ²¡æœ‰ä»€ä¹ˆç›´æ¥çš„å…³ç³»ï¼Œå®ƒæ˜¯ä¸€æ¬¾å¼€æºçš„æ€§èƒ½å‹æµ‹å·¥å…·ã€‚&lt;/p>
&lt;h2 id="k6-èƒŒåçš„æ•…äº‹">k6 èƒŒåçš„æ•…äº‹&lt;/h2>
&lt;p>2016 å¹´ 8 æœˆï¼Œk6 åœ¨ GitHub ä¸Šå‘å¸ƒäº†ç¬¬ä¸€ä¸ªç‰ˆæœ¬ï¼Œè‡³æ­¤ï¼Œä¸€ä¸ªå‡ºè‰²çš„å¼€æºè´Ÿè½½å‹æµ‹å·¥å…·è¿›å…¥äº†äººä»¬çš„è§†é‡ã€‚&lt;/p>
&lt;p>2021 å¹´çš„ 6 æœˆï¼Œå¯¹äº Grafana å’Œ k6 æ¥è®²æ˜¯ä¸ªå¤§æ—¥å­ï¼ŒGrafana Labs æ”¶è´­äº† k6 ã€‚&lt;/p>
&lt;p>è€Œäº‹å®ä¸Šï¼Œ Grafana ä¸ k6 çš„ç¼˜åˆ†è¿˜è¦è¿½æº¯åˆ°æ›´æ—©çš„ 2 å¹´å‰ã€‚&lt;/p>
&lt;p>2019 å¹´ï¼Œåœ¨è¿›è¡Œ Grafana 6.0 çš„çŸ­æœŸä»¤ç‰Œåˆ·æ–°è¡Œä¸ºçš„å‹æµ‹æ—¶ï¼ŒGrafana Labs è¿›è¡Œäº†ä¸€ç³»åˆ—çš„æŠ€æœ¯é€‰å‹ã€‚&lt;/p>
&lt;p>ç”±äº Grafana Labs çš„å¤§éƒ¨åˆ†åç«¯è½¯ä»¶æ˜¯ä½¿ç”¨ Go æ¥å®ç°çš„ï¼Œæ°å·§ k6 æ»¡è¶³ OSS å’Œ Go éœ€æ±‚ï¼Œå¹¶ä¸”è´Ÿè½½æµ‹è¯•æ˜¯ä½¿ç”¨ JS ç¼–å†™ï¼ˆGrafana å‰ç«¯æ¡†æ¶åŠ UI éƒ½åœ¨ä½¿ç”¨ï¼‰ã€‚è¿™ä½¿å¾— k6 è‡ª Grafana 6.0 ç‰ˆæœ¬å¼€å§‹ï¼Œä¸æ–­åœ°ä¸º Grafana å¼€å‘è€…åŠæµ‹è¯•è€…å®Œæˆè¿½è¸ª bug çš„ä½¿å‘½ã€‚&lt;/p>
&lt;p>&lt;img src="https://s2.loli.net/2021/12/17/FkHjMApXsSuZcwe.png" alt="img">&lt;/p>
&lt;p>å›¾ 1 ï¼Œk6 åŠ å…¥ Grafana Labs&lt;/p>
&lt;h3 id="å¤šæ ·çš„å‹æµ‹å·¥å…·">å¤šæ ·çš„å‹æµ‹å·¥å…·&lt;/h3>
&lt;p>ä¸€ä¸ªç§°å¿ƒåº”æ‰‹çš„è‡ªåŠ¨åŒ–è´Ÿè½½å‹æµ‹å·¥å…·ä¼šæå¤§çš„æå‡ç¨‹åºå¼€å‘äººå‘˜çš„ä»£ç è´¨é‡åŠæ•ˆç‡ã€‚&lt;/p>
&lt;p>ä¸‹å›¾ä¸­æ˜¯ä¸€äº›æ¯”è¾ƒå¸¸è§çš„ç”¨äºè´Ÿè½½å‹æµ‹çš„å·¥å…·ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ GitHub ä¸Šçœ‹åˆ°ï¼Œç›®å‰ï¼Œæ›´æ–°æ¯”è¾ƒé¢‘ç¹ã€æ´»è·ƒçš„é¡¹ç›®ä¸»è¦æœ‰ï¼šGatling, Jmeter å’Œ k6 ã€‚&lt;/p>
&lt;p>&lt;img src="https://s2.loli.net/2021/12/17/C1tJIe7BEGRKgV6.png" alt="img">&lt;/p>
&lt;p>å›¾ 2 ï¼Œå‹æµ‹å·¥å…·ä»¬&lt;/p>
&lt;p>å¦‚ä½•ä»ä¸­é€‰æ‹©ï¼Œç®€å•çš„è®²å°±æ˜¯å·¥å…·æ•ˆç‡çš„æ¯”æ‹¼ã€‚ä¸»è¦ä»ä»¥ä¸‹ä¸¤ä¸ªæ–¹é¢æ¥è€ƒé‡ï¼š&lt;/p>
&lt;ul>
&lt;li>å·¥å…·æ€§èƒ½&lt;/li>
&lt;li>å·¥å…·ä½¿ç”¨ä½“éªŒ&lt;/li>
&lt;/ul>
&lt;p>ä¸‹å›¾å¯¹ä»¥ä¸Šå·¥å…·è¿›è¡Œäº†ä¸€äº›ç®€å•çš„å¯¹æ¯”ã€‚&lt;/p>
&lt;p>&lt;img src="https://s2.loli.net/2021/12/17/TxGyYpRtMKza4fE.png" alt="img">&lt;/p>
&lt;p>è¿™é‡Œæˆ‘ä¸»è¦å¯¹æ¯”ä¸‹å…¶ä¸­è¾ƒä¸ºæ´»è·ƒçš„ 3 ä¸ªé¡¹ç›®ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>JMeter - ç†Ÿæ‚‰ Java çš„å°ä¼™ä¼´å¯èƒ½æ¯”è¾ƒäº†è§£è¿™ä¸ªå·¥å…·ã€‚ç”±äºå­˜åœ¨æ—¶é—´ä¹…ï¼ŒJMeter çš„åŠŸèƒ½æ˜¯è¿™ä¹‹ä¸­æœ€å…¨é¢çš„ï¼Œå¹¶ä¸”é›†æˆã€é™„åŠ ç»„ä»¶åšçš„è¾ƒå¥½ã€‚åŸºäºå®ƒæ„å»ºçš„ SaaS æœåŠ¡ Blazemeterï¼Œç›¸ä¿¡å¤§å®¶ä¹Ÿéƒ½ç†Ÿè¯†ã€‚è¿™ä¹Ÿå¯¼è‡´äº†ä¸€ä¸ªæå¤§çš„é—®é¢˜ï¼Œä½¿ç”¨çš„å¤æ‚æ€§é«˜åŠä¸å¤Ÿè½»é‡çº§ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Gatling - Gatling ä¹Ÿæœ‰ç€ SaaS äº§å“ Gatling Frontlineã€‚å°±ä½¿ç”¨é—¨æ§›æ¥è®²ï¼ŒJS è¦æ¯” Scala è¦ä½å¾ˆå¤šï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>k6 - k6 æœ€åˆæ˜¯ç”± SaaS æœåŠ¡ Load Impact çš„å‡ åå‘˜å·¥å¼€å‘ç»´æŠ¤ã€‚ä½¿ç”¨é—¨æ§›ä½ï¼ˆJSï¼‰ï¼Œå‚æ•°åŒ–æ›´ç®€å•ï¼Œå¹¶ä¸” â€œè´Ÿè½½æµ‹è¯•å³ä»£ç â€ çš„ç†å¿µä¹Ÿè®©ä»–çš„ç»´æŠ¤æˆæœ¬æ›´ä½ã€‚æœªæ¥å¯æœŸã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://s2.loli.net/2021/12/17/IYNDA5FEQLWZz4b.png" alt="img">&lt;/p>
&lt;p>å›¾ 3 ï¼Œ3 ç§çƒ­é—¨å·¥å…·æ¯”ä¸€æ¯”&lt;/p>
&lt;h2 id="æ‰§è¡Œæ•ˆæœ">æ‰§è¡Œæ•ˆæœ&lt;/h2>
&lt;p>&lt;img src="https://s2.loli.net/2021/12/17/YLoJZqdn5QrTeB6.png" alt="img">&lt;/p>
&lt;p>æˆ–è€…è¿™æ ·ï¼š&lt;/p>
&lt;p>&lt;img src="https://s2.loli.net/2021/12/17/CNA91tqRhGwTYcm.png" alt="img">&lt;/p>
&lt;h2 id="å®‰è£…-k6">å®‰è£… k6&lt;/h2>
&lt;p>k6 æ˜¯ç”¨ Go è¯­è¨€å¼€å‘çš„ï¼Œè¦å®‰è£… k6 æ­¥éª¤å¾ˆç®€å•ï¼Œåªè¦ç›´æ¥åœ¨å…¶ GitHub çš„ Release é¡µé¢ä¸‹è½½äºŒè¿›åˆ¶æ–‡ä»¶å³å¯ã€‚æ¯”å¦‚ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ wget -q https://github.com/grafana/k6/releases/download/v0.35.0/k6-v0.35.0-linux-amd64.tar.gz
&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ tar -xzf k6-v0.35.0-linux-amd64.tar.gz
&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ ls
k6-v0.35.0-linux-amd64 k6-v0.35.0-linux-amd64.tar.gz
&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ mv ./k6-v0.35.0-linux-amd64/k6 ~/bin/k6
&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ k6 version
k6 v0.35.0 &lt;span class="o">(&lt;/span>2021-11-17T09:53:18+0000/1c44b2d, go1.17.3, linux/amd64&lt;span class="o">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>æˆ–è€…ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨å®ƒçš„ Docker é•œåƒï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">âœ ~ docker run --rm loadimpact/k6 version
k6 v0.35.0 &lt;span class="o">(&lt;/span>2021-11-17T09:53:03+0000/1c44b2d, go1.17.3, linux/amd64&lt;span class="o">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="æ ¸å¿ƒæ¦‚å¿µ">æ ¸å¿ƒæ¦‚å¿µ&lt;/h2>
&lt;p>åœ¨ k6 ä¸­å¹¶æ²¡æœ‰å¤ªå¤šçš„æ¦‚å¿µã€‚å…¶ä¸­æœ€ä¸»è¦çš„å°±æ˜¯ç”¨æ¥æ‰§è¡Œæµ‹è¯•çš„ &lt;strong>virtual users (VUs)&lt;/strong> ï¼Œå®ƒçš„æœ¬è´¨å°±æ˜¯å¹¶å‘æ‰§è¡Œä»»åŠ¡çš„æ¬¡æ•°ã€‚&lt;/p>
&lt;p>åœ¨ä½¿ç”¨ k6 æ‰§è¡Œæµ‹è¯•çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡ &lt;code>--vus&lt;/code>æˆ–è€… &lt;code>-u&lt;/code>è¿›è¡ŒæŒ‡å®šï¼Œé»˜è®¤æ˜¯ 1 ã€‚&lt;/p>
&lt;h2 id="ä¸Šæ‰‹å®è·µ">ä¸Šæ‰‹å®è·µ&lt;/h2>
&lt;p>æˆ‘ä¸ªäººæ„Ÿè§‰ k6 åœ¨ç›®å‰çš„è¿™äº›ä¸»æµå‹æµ‹å·¥å…·ä¸­ç®—ç”¨æˆ·ä½“éªŒæ¯”è¾ƒå¥½çš„ä¸€ä¸ªã€‚å®ƒä½¿ç”¨ JSï¼ˆES6ï¼‰ä½œä¸ºé…ç½®è¯­è¨€ï¼Œè¿˜æ˜¯æ¯”è¾ƒæ–¹ä¾¿çš„ï¼Œæˆ‘ä»¬æ¥åšä¸€äº›ç¤ºä¾‹ã€‚&lt;/p>
&lt;h3 id="ç®€å•è¯·æ±‚">ç®€å•è¯·æ±‚&lt;/h3>
&lt;p>å¦‚æœå¯¹äºè¿›è¡Œ HTTP è¯·æ±‚çš„æ—¶å€™ï¼Œæˆ‘ä»¬åªéœ€è¦ä» &lt;code>k6/http&lt;/code> å¯¼å…¥ &lt;code>http&lt;/code>å³å¯ã€‚&lt;/p>
&lt;p>æ³¨æ„åœ¨ k6 ä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹å¿…é¡»å¾—æœ‰ä¸ªä½œä¸ºå…¥å£çš„ &lt;code>default&lt;/code>å‡½æ•°ï¼Œè¿™ç±»ä¼¼æˆ‘ä»¬å¸¸ç”¨çš„ &lt;code>main&lt;/code>å‡½æ•°ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-javascript" data-lang="javascript">&lt;span class="kr">import&lt;/span> &lt;span class="nx">http&lt;/span> &lt;span class="nx">from&lt;/span> &lt;span class="s2">&amp;#34;k6/http&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="kr">export&lt;/span> &lt;span class="k">default&lt;/span> &lt;span class="kd">function&lt;/span>&lt;span class="p">(){&lt;/span>
&lt;span class="nx">http&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;https://test-api.k6.io/public/crocodiles/&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ‰§è¡Œåæ•ˆæœå¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ k6 run simple_http_get.js
/&lt;span class="se">\ &lt;/span> &lt;span class="p">|&lt;/span>â€¾â€¾&lt;span class="p">|&lt;/span> /â€¾â€¾/ /â€¾â€¾/
/&lt;span class="se">\ &lt;/span> / &lt;span class="se">\ &lt;/span> &lt;span class="p">|&lt;/span> &lt;span class="p">|&lt;/span>/ / / /
/ &lt;span class="se">\/&lt;/span> &lt;span class="se">\ &lt;/span> &lt;span class="p">|&lt;/span> &lt;span class="o">(&lt;/span> / â€¾â€¾&lt;span class="se">\ &lt;/span>
/ &lt;span class="se">\ &lt;/span> &lt;span class="p">|&lt;/span> &lt;span class="p">|&lt;/span>&lt;span class="se">\ &lt;/span> &lt;span class="se">\ &lt;/span>&lt;span class="p">|&lt;/span> &lt;span class="o">(&lt;/span>â€¾&lt;span class="o">)&lt;/span> &lt;span class="p">|&lt;/span>
/ __________ &lt;span class="se">\ &lt;/span> &lt;span class="p">|&lt;/span>__&lt;span class="p">|&lt;/span> &lt;span class="se">\_&lt;/span>_&lt;span class="se">\ \_&lt;/span>____/ .io
execution: &lt;span class="nb">local&lt;/span>
script: simple_http_get.js
output: -
scenarios: &lt;span class="o">(&lt;/span>100.00%&lt;span class="o">)&lt;/span> &lt;span class="m">1&lt;/span> scenario, &lt;span class="m">1&lt;/span> max VUs, 10m30s max duration &lt;span class="o">(&lt;/span>incl. graceful stop&lt;span class="o">)&lt;/span>:
* default: &lt;span class="m">1&lt;/span> iterations &lt;span class="k">for&lt;/span> each of &lt;span class="m">1&lt;/span> VUs &lt;span class="o">(&lt;/span>maxDuration: 10m0s, gracefulStop: 30s&lt;span class="o">)&lt;/span>
running &lt;span class="o">(&lt;/span>00m01.1s&lt;span class="o">)&lt;/span>, 0/1 VUs, &lt;span class="m">1&lt;/span> &lt;span class="nb">complete&lt;/span> and &lt;span class="m">0&lt;/span> interrupted iterations
default âœ“ &lt;span class="o">[======================================]&lt;/span> &lt;span class="m">1&lt;/span> VUs 00m01.1s/10m0s 1/1 iters, &lt;span class="m">1&lt;/span> per VU
data_received..................: 6.3 kB 5.7 kB/s
data_sent......................: &lt;span class="m">634&lt;/span> B &lt;span class="m">578&lt;/span> B/s
http_req_blocked...............: &lt;span class="nv">avg&lt;/span>&lt;span class="o">=&lt;/span>848.34ms &lt;span class="nv">min&lt;/span>&lt;span class="o">=&lt;/span>848.34ms &lt;span class="nv">med&lt;/span>&lt;span class="o">=&lt;/span>848.34ms &lt;span class="nv">max&lt;/span>&lt;span class="o">=&lt;/span>848.34ms p&lt;span class="o">(&lt;/span>90&lt;span class="o">)=&lt;/span>848.34ms p&lt;span class="o">(&lt;/span>95&lt;span class="o">)=&lt;/span>848.34ms
http_req_connecting............: &lt;span class="nv">avg&lt;/span>&lt;span class="o">=&lt;/span>75.59Âµs &lt;span class="nv">min&lt;/span>&lt;span class="o">=&lt;/span>75.59Âµs &lt;span class="nv">med&lt;/span>&lt;span class="o">=&lt;/span>75.59Âµs &lt;span class="nv">max&lt;/span>&lt;span class="o">=&lt;/span>75.59Âµs p&lt;span class="o">(&lt;/span>90&lt;span class="o">)=&lt;/span>75.59Âµs p&lt;span class="o">(&lt;/span>95&lt;span class="o">)=&lt;/span>75.59Âµs
http_req_duration..............: &lt;span class="nv">avg&lt;/span>&lt;span class="o">=&lt;/span>247.46ms &lt;span class="nv">min&lt;/span>&lt;span class="o">=&lt;/span>247.46ms &lt;span class="nv">med&lt;/span>&lt;span class="o">=&lt;/span>247.46ms &lt;span class="nv">max&lt;/span>&lt;span class="o">=&lt;/span>247.46ms p&lt;span class="o">(&lt;/span>90&lt;span class="o">)=&lt;/span>247.46ms p&lt;span class="o">(&lt;/span>95&lt;span class="o">)=&lt;/span>247.46ms
&lt;span class="o">{&lt;/span> expected_response:true &lt;span class="o">}&lt;/span>...: &lt;span class="nv">avg&lt;/span>&lt;span class="o">=&lt;/span>247.46ms &lt;span class="nv">min&lt;/span>&lt;span class="o">=&lt;/span>247.46ms &lt;span class="nv">med&lt;/span>&lt;span class="o">=&lt;/span>247.46ms &lt;span class="nv">max&lt;/span>&lt;span class="o">=&lt;/span>247.46ms p&lt;span class="o">(&lt;/span>90&lt;span class="o">)=&lt;/span>247.46ms p&lt;span class="o">(&lt;/span>95&lt;span class="o">)=&lt;/span>247.46ms
http_req_failed................: 0.00% âœ“ &lt;span class="m">0&lt;/span> âœ— &lt;span class="m">1&lt;/span>
http_req_receiving.............: &lt;span class="nv">avg&lt;/span>&lt;span class="o">=&lt;/span>455.24Âµs &lt;span class="nv">min&lt;/span>&lt;span class="o">=&lt;/span>455.24Âµs &lt;span class="nv">med&lt;/span>&lt;span class="o">=&lt;/span>455.24Âµs &lt;span class="nv">max&lt;/span>&lt;span class="o">=&lt;/span>455.24Âµs p&lt;span class="o">(&lt;/span>90&lt;span class="o">)=&lt;/span>455.24Âµs p&lt;span class="o">(&lt;/span>95&lt;span class="o">)=&lt;/span>455.24Âµs
http_req_sending...............: &lt;span class="nv">avg&lt;/span>&lt;span class="o">=&lt;/span>103.77Âµs &lt;span class="nv">min&lt;/span>&lt;span class="o">=&lt;/span>103.77Âµs &lt;span class="nv">med&lt;/span>&lt;span class="o">=&lt;/span>103.77Âµs &lt;span class="nv">max&lt;/span>&lt;span class="o">=&lt;/span>103.77Âµs p&lt;span class="o">(&lt;/span>90&lt;span class="o">)=&lt;/span>103.77Âµs p&lt;span class="o">(&lt;/span>95&lt;span class="o">)=&lt;/span>103.77Âµs
http_req_tls_handshaking.......: &lt;span class="nv">avg&lt;/span>&lt;span class="o">=&lt;/span>848.07ms &lt;span class="nv">min&lt;/span>&lt;span class="o">=&lt;/span>848.07ms &lt;span class="nv">med&lt;/span>&lt;span class="o">=&lt;/span>848.07ms &lt;span class="nv">max&lt;/span>&lt;span class="o">=&lt;/span>848.07ms p&lt;span class="o">(&lt;/span>90&lt;span class="o">)=&lt;/span>848.07ms p&lt;span class="o">(&lt;/span>95&lt;span class="o">)=&lt;/span>848.07ms
http_req_waiting...............: &lt;span class="nv">avg&lt;/span>&lt;span class="o">=&lt;/span>246.9ms &lt;span class="nv">min&lt;/span>&lt;span class="o">=&lt;/span>246.9ms &lt;span class="nv">med&lt;/span>&lt;span class="o">=&lt;/span>246.9ms &lt;span class="nv">max&lt;/span>&lt;span class="o">=&lt;/span>246.9ms p&lt;span class="o">(&lt;/span>90&lt;span class="o">)=&lt;/span>246.9ms p&lt;span class="o">(&lt;/span>95&lt;span class="o">)=&lt;/span>246.9ms
http_reqs......................: &lt;span class="m">1&lt;/span> 0.911502/s
iteration_duration.............: &lt;span class="nv">avg&lt;/span>&lt;span class="o">=&lt;/span>1.09s &lt;span class="nv">min&lt;/span>&lt;span class="o">=&lt;/span>1.09s &lt;span class="nv">med&lt;/span>&lt;span class="o">=&lt;/span>1.09s &lt;span class="nv">max&lt;/span>&lt;span class="o">=&lt;/span>1.09s p&lt;span class="o">(&lt;/span>90&lt;span class="o">)=&lt;/span>1.09s p&lt;span class="o">(&lt;/span>95&lt;span class="o">)=&lt;/span>1.09s
iterations.....................: &lt;span class="m">1&lt;/span> 0.911502/s
vus............................: &lt;span class="m">1&lt;/span> &lt;span class="nv">min&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">1&lt;/span> &lt;span class="nv">max&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">1&lt;/span>
vus_max........................: &lt;span class="m">1&lt;/span> &lt;span class="nv">min&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">1&lt;/span> &lt;span class="nv">max&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">1&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>k6 é»˜è®¤ä¼šå°†æ‰§è¡Œåçš„ç»“æœè¾“å‡ºåˆ°ç»ˆç«¯ã€‚åŒæ—¶å®ƒè‡ªå¸¦äº†ä¸€äº›æŒ‡æ ‡ä¼šåŒæ—¶è¾“å‡ºã€‚&lt;/p>
&lt;p>è¿™äº›æŒ‡æ ‡åŸºæœ¬ä¸Šéƒ½æ˜¯è¯­ä¹‰åŒ–çš„ï¼Œçœ‹åå­—å°±å¯ä»¥ç†è§£å…¶å«ä¹‰ï¼Œè¿™é‡Œå°±ä¸ä¸€ä¸€ä»‹ç»äº†ã€‚&lt;/p>
&lt;h3 id="å¸¦æ£€æŸ¥çš„è¯·æ±‚">å¸¦æ£€æŸ¥çš„è¯·æ±‚&lt;/h3>
&lt;p>æˆ‘ä»¬å¯ä»¥åœ¨è¯·æ±‚ä¸­åŒæ—¶å¢åŠ ä¸€äº›æµ‹è¯•ï¼Œåˆ¤æ–­æ¥å£çš„å“åº”å€¼æ˜¯å¦ç¬¦åˆæˆ‘ä»¬çš„é¢„æœŸã€‚å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-javascript" data-lang="javascript">&lt;span class="kr">import&lt;/span> &lt;span class="nx">http&lt;/span> &lt;span class="nx">from&lt;/span> &lt;span class="s2">&amp;#34;k6/http&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="kr">import&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">check&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">group&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="nx">from&lt;/span> &lt;span class="s2">&amp;#34;k6&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="kr">export&lt;/span> &lt;span class="k">default&lt;/span> &lt;span class="kd">function&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">group&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;GET&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kd">function&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="kd">let&lt;/span> &lt;span class="nx">res&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">http&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;http://httpbin.org/get?verb=get&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;span class="nx">check&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">res&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="s2">&amp;#34;status is 200&amp;#34;&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">r&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="nx">r&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">status&lt;/span> &lt;span class="o">===&lt;/span> &lt;span class="mi">200&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="s2">&amp;#34;is verb correct&amp;#34;&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">r&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="nx">r&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">json&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="nx">args&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">verb&lt;/span> &lt;span class="o">===&lt;/span> &lt;span class="s2">&amp;#34;get&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="p">});&lt;/span>
&lt;span class="p">});&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>é€šè¿‡å¼•å…¥äº† &lt;code>check&lt;/code>å‡½æ•°ï¼Œæ¥æ‰§è¡Œä¸€äº›åˆ¤æ–­çš„é€»è¾‘ï¼Œå½“ç„¶ä¸Šè¿°çš„ &lt;code>==&amp;gt;&lt;/code> å…¶å®æ˜¯ ES6 ä¸­çš„ä¸€ç§ç®€å†™ï¼Œå°†å…¶å±•å¼€ä¸ºæ­£å¸¸çš„å‡½æ•°ä¹Ÿå¯ä»¥ã€‚æ¯”å¦‚ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-javascript" data-lang="javascript">&lt;span class="kr">import&lt;/span> &lt;span class="nx">http&lt;/span> &lt;span class="nx">from&lt;/span> &lt;span class="s2">&amp;#34;k6/http&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="kr">import&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">check&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">group&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="nx">from&lt;/span> &lt;span class="s2">&amp;#34;k6&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="kr">export&lt;/span> &lt;span class="k">default&lt;/span> &lt;span class="kd">function&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">group&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;GET&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kd">function&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="kd">let&lt;/span> &lt;span class="nx">res&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">http&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;http://httpbin.org/get?verb=get&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;span class="nx">check&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">res&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="s2">&amp;#34;status is 200&amp;#34;&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="kd">function&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">r&lt;/span>&lt;span class="p">){&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="nx">r&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">status&lt;/span> &lt;span class="o">===&lt;/span> &lt;span class="mi">200&lt;/span>
&lt;span class="p">},&lt;/span>
&lt;span class="s2">&amp;#34;is verb correct&amp;#34;&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">r&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="nx">r&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">json&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="nx">args&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">verb&lt;/span> &lt;span class="o">===&lt;/span> &lt;span class="s2">&amp;#34;get&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="p">});&lt;/span>
&lt;span class="p">});&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä½¿ç”¨ k6 æ‰§è¡Œæ­¤è„šæœ¬åï¼Œå¾—åˆ°çš„è¾“å‡ºç›¸æ¯”ä¹‹å‰çš„å¤šäº†å¦‚ä¸‹å†…å®¹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash"> â–ˆ GET
âœ“ status is &lt;span class="m">200&lt;/span>
âœ“ is verb correct
checks.........................: 100.00% âœ“ &lt;span class="m">2&lt;/span> âœ— &lt;span class="m">0&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä»è¿™é‡Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬å½“å‰è¯·æ±‚æ¥å£çš„æµ‹è¯•æ˜¯å¦é€šè¿‡ï¼ˆä¹Ÿå¯ä»¥ç”¨æ¥åˆ¤æ–­å½“å‰æ¥å£æ˜¯å¦èƒ½æ­£å¸¸æä¾›æœåŠ¡ï¼‰ã€‚&lt;/p>
&lt;h3 id="è‡ªå®šä¹‰æŒ‡æ ‡è¾“å‡º">è‡ªå®šä¹‰æŒ‡æ ‡è¾“å‡º&lt;/h3>
&lt;p>æ¥ä¸‹æ¥æˆ‘ä»¬å°è¯•ä¸‹åœ¨å‹æµ‹è¿‡ç¨‹ä¸­å®šä¹‰ä¸€äº›è‡ªå·±å®šçš„æŒ‡æ ‡ã€‚åªéœ€è¦ä» &lt;code>k6/metrics&lt;/code>ä¸­å¯¼å…¥ä¸€äº›ä¸åŒç±»å‹çš„æŒ‡æ ‡å³å¯ã€‚è¿™å’Œåœ¨ Prometheus ä¸­çš„ç±»å‹åŸºæœ¬ä¸€è‡´ã€‚&lt;/p>
&lt;p>è¿™é‡Œæˆ‘å¢åŠ äº†ä¸¤ä¸ª metricã€‚ä¸€ä¸ª &lt;code>testCounter&lt;/code>ç”¨äºç»Ÿè®¡ä¸€å…±æ‰§è¡Œäº†å¤šå°‘æ¬¡æµ‹è¯•ï¼Œ &lt;code>passedRate&lt;/code>è®¡ç®—é€šè¿‡ç‡ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-javascript" data-lang="javascript">&lt;span class="kr">import&lt;/span> &lt;span class="nx">http&lt;/span> &lt;span class="nx">from&lt;/span> &lt;span class="s2">&amp;#34;k6/http&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="kr">import&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">Counter&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">Rate&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="nx">from&lt;/span> &lt;span class="s2">&amp;#34;k6/metrics&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="kr">import&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">check&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">group&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="nx">from&lt;/span> &lt;span class="s2">&amp;#34;k6&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="kd">let&lt;/span> &lt;span class="nx">testCounter&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="nx">Counter&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;test_counter&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;span class="kd">let&lt;/span> &lt;span class="nx">passedRate&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="nx">Rate&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;passed_rate&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;span class="kr">export&lt;/span> &lt;span class="k">default&lt;/span> &lt;span class="kd">function&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">group&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;GET&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kd">function&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="kd">let&lt;/span> &lt;span class="nx">res&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">http&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;http://httpbin.org/get?verb=get&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;span class="kd">let&lt;/span> &lt;span class="nx">passed&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">check&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">res&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="s2">&amp;#34;status is 200&amp;#34;&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">r&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="nx">r&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">status&lt;/span> &lt;span class="o">===&lt;/span> &lt;span class="mi">200&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="s2">&amp;#34;is verb correct&amp;#34;&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">r&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="nx">r&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">json&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="nx">args&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">verb&lt;/span> &lt;span class="o">===&lt;/span> &lt;span class="s2">&amp;#34;get&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="p">});&lt;/span>
&lt;span class="nx">testCounter&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">);&lt;/span>
&lt;span class="nx">passedRate&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">passed&lt;/span>&lt;span class="p">);&lt;/span>
&lt;span class="p">});&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™é‡Œæˆ‘ä»¬è®¾ç½®äº† 2 ä¸ª VUï¼Œ ä»¥åŠè®¾ç½®äº†æ‰§è¡Œè¿‡ç¨‹ä¸º &lt;code>10s&lt;/code> æ‰§è¡Œåçš„è¾“å‡ºå¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ k6 run -u &lt;span class="m">2&lt;/span> -d 10s simple_custom_metrics.js
...
execution: &lt;span class="nb">local&lt;/span>
script: simple_custom_metrics.js
output: -
scenarios: &lt;span class="o">(&lt;/span>100.00%&lt;span class="o">)&lt;/span> &lt;span class="m">1&lt;/span> scenario, &lt;span class="m">2&lt;/span> max VUs, 40s max duration &lt;span class="o">(&lt;/span>incl. graceful stop&lt;span class="o">)&lt;/span>:
* default: &lt;span class="m">2&lt;/span> looping VUs &lt;span class="k">for&lt;/span> 10s &lt;span class="o">(&lt;/span>gracefulStop: 30s&lt;span class="o">)&lt;/span>
running &lt;span class="o">(&lt;/span>10.4s&lt;span class="o">)&lt;/span>, 0/2 VUs, &lt;span class="m">36&lt;/span> &lt;span class="nb">complete&lt;/span> and &lt;span class="m">0&lt;/span> interrupted iterations
default âœ“ &lt;span class="o">[======================================]&lt;/span> &lt;span class="m">2&lt;/span> VUs 10s
â–ˆ GET
âœ“ status is &lt;span class="m">200&lt;/span>
âœ“ is verb correct
checks.........................: 100.00% âœ“ &lt;span class="m">72&lt;/span> âœ— &lt;span class="m">0&lt;/span>
data_received..................: &lt;span class="m">18&lt;/span> kB 1.7 kB/s
data_sent......................: 3.9 kB &lt;span class="m">372&lt;/span> B/s
group_duration.................: &lt;span class="nv">avg&lt;/span>&lt;span class="o">=&lt;/span>567.35ms &lt;span class="nv">min&lt;/span>&lt;span class="o">=&lt;/span>440.56ms &lt;span class="nv">med&lt;/span>&lt;span class="o">=&lt;/span>600.52ms &lt;span class="nv">max&lt;/span>&lt;span class="o">=&lt;/span>738.73ms p&lt;span class="o">(&lt;/span>90&lt;span class="o">)=&lt;/span>620.88ms p&lt;span class="o">(&lt;/span>95&lt;span class="o">)=&lt;/span>655.17ms
http_req_blocked...............: &lt;span class="nv">avg&lt;/span>&lt;span class="o">=&lt;/span>266.72Âµs &lt;span class="nv">min&lt;/span>&lt;span class="o">=&lt;/span>72.33Âµs &lt;span class="nv">med&lt;/span>&lt;span class="o">=&lt;/span>135.14Âµs &lt;span class="nv">max&lt;/span>&lt;span class="o">=&lt;/span>776.66Âµs p&lt;span class="o">(&lt;/span>90&lt;span class="o">)=&lt;/span>644.4Âµs p&lt;span class="o">(&lt;/span>95&lt;span class="o">)=&lt;/span>719.96Âµs
http_req_connecting............: &lt;span class="nv">avg&lt;/span>&lt;span class="o">=&lt;/span>170.04Âµs &lt;span class="nv">min&lt;/span>&lt;span class="o">=&lt;/span>45.51Âµs &lt;span class="nv">med&lt;/span>&lt;span class="o">=&lt;/span>79.9Âµs &lt;span class="nv">max&lt;/span>&lt;span class="o">=&lt;/span>520.69Âµs p&lt;span class="o">(&lt;/span>90&lt;span class="o">)=&lt;/span>399.41Âµs p&lt;span class="o">(&lt;/span>95&lt;span class="o">)=&lt;/span>463.55Âµs
http_req_duration..............: &lt;span class="nv">avg&lt;/span>&lt;span class="o">=&lt;/span>566.82ms &lt;span class="nv">min&lt;/span>&lt;span class="o">=&lt;/span>439.69ms &lt;span class="nv">med&lt;/span>&lt;span class="o">=&lt;/span>600.31ms &lt;span class="nv">max&lt;/span>&lt;span class="o">=&lt;/span>738.16ms p&lt;span class="o">(&lt;/span>90&lt;span class="o">)=&lt;/span>620.52ms p&lt;span class="o">(&lt;/span>95&lt;span class="o">)=&lt;/span>654.61ms
&lt;span class="o">{&lt;/span> expected_response:true &lt;span class="o">}&lt;/span>...: &lt;span class="nv">avg&lt;/span>&lt;span class="o">=&lt;/span>566.82ms &lt;span class="nv">min&lt;/span>&lt;span class="o">=&lt;/span>439.69ms &lt;span class="nv">med&lt;/span>&lt;span class="o">=&lt;/span>600.31ms &lt;span class="nv">max&lt;/span>&lt;span class="o">=&lt;/span>738.16ms p&lt;span class="o">(&lt;/span>90&lt;span class="o">)=&lt;/span>620.52ms p&lt;span class="o">(&lt;/span>95&lt;span class="o">)=&lt;/span>654.61ms
http_req_failed................: 0.00% âœ“ &lt;span class="m">0&lt;/span> âœ— &lt;span class="m">36&lt;/span>
http_req_receiving.............: &lt;span class="nv">avg&lt;/span>&lt;span class="o">=&lt;/span>309.13Âµs &lt;span class="nv">min&lt;/span>&lt;span class="o">=&lt;/span>122.4Âµs &lt;span class="nv">med&lt;/span>&lt;span class="o">=&lt;/span>231.72Âµs &lt;span class="nv">max&lt;/span>&lt;span class="o">=&lt;/span>755.3Âµs p&lt;span class="o">(&lt;/span>90&lt;span class="o">)=&lt;/span>597.95Âµs p&lt;span class="o">(&lt;/span>95&lt;span class="o">)=&lt;/span>641.92Âµs
http_req_sending...............: &lt;span class="nv">avg&lt;/span>&lt;span class="o">=&lt;/span>80.69Âµs &lt;span class="nv">min&lt;/span>&lt;span class="o">=&lt;/span>20.47Âµs &lt;span class="nv">med&lt;/span>&lt;span class="o">=&lt;/span>38.91Âµs &lt;span class="nv">max&lt;/span>&lt;span class="o">=&lt;/span>235.1Âµs p&lt;span class="o">(&lt;/span>90&lt;span class="o">)=&lt;/span>197.87Âµs p&lt;span class="o">(&lt;/span>95&lt;span class="o">)=&lt;/span>214.79Âµs
http_req_tls_handshaking.......: &lt;span class="nv">avg&lt;/span>&lt;span class="o">=&lt;/span>0s &lt;span class="nv">min&lt;/span>&lt;span class="o">=&lt;/span>0s &lt;span class="nv">med&lt;/span>&lt;span class="o">=&lt;/span>0s &lt;span class="nv">max&lt;/span>&lt;span class="o">=&lt;/span>0s p&lt;span class="o">(&lt;/span>90&lt;span class="o">)=&lt;/span>0s p&lt;span class="o">(&lt;/span>95&lt;span class="o">)=&lt;/span>0s
http_req_waiting...............: &lt;span class="nv">avg&lt;/span>&lt;span class="o">=&lt;/span>566.43ms &lt;span class="nv">min&lt;/span>&lt;span class="o">=&lt;/span>439.31ms &lt;span class="nv">med&lt;/span>&lt;span class="o">=&lt;/span>600.16ms &lt;span class="nv">max&lt;/span>&lt;span class="o">=&lt;/span>737.8ms p&lt;span class="o">(&lt;/span>90&lt;span class="o">)=&lt;/span>620.19ms p&lt;span class="o">(&lt;/span>95&lt;span class="o">)=&lt;/span>654.18ms
http_reqs......................: &lt;span class="m">36&lt;/span> 3.472534/s
iteration_duration.............: &lt;span class="nv">avg&lt;/span>&lt;span class="o">=&lt;/span>567.38ms &lt;span class="nv">min&lt;/span>&lt;span class="o">=&lt;/span>440.62ms &lt;span class="nv">med&lt;/span>&lt;span class="o">=&lt;/span>600.53ms &lt;span class="nv">max&lt;/span>&lt;span class="o">=&lt;/span>738.75ms p&lt;span class="o">(&lt;/span>90&lt;span class="o">)=&lt;/span>620.89ms p&lt;span class="o">(&lt;/span>95&lt;span class="o">)=&lt;/span>655.2ms
iterations.....................: &lt;span class="m">36&lt;/span> 3.472534/s
passed_rate....................: 100.00% âœ“ &lt;span class="m">36&lt;/span> âœ— &lt;span class="m">0&lt;/span>
test_counter...................: &lt;span class="m">36&lt;/span> 3.472534/s
vus............................: &lt;span class="m">2&lt;/span> &lt;span class="nv">min&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">2&lt;/span> &lt;span class="nv">max&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">2&lt;/span>
vus_max........................: &lt;span class="m">2&lt;/span> &lt;span class="nv">min&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">2&lt;/span> &lt;span class="nv">max&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">2&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¯ä»¥çœ‹åˆ°åœ¨è¾“å‡ºä¸­å¤šäº†ä¸¤è¡Œï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash"> passed_rate....................: 100.00% âœ“ &lt;span class="m">36&lt;/span> âœ— &lt;span class="m">0&lt;/span>
test_counter...................: &lt;span class="m">36&lt;/span> 3.472534/s
&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¸æˆ‘ä»¬çš„é¢„æœŸç›¸ç¬¦ã€‚&lt;/p>
&lt;p>ä¸è¿‡è¿™æ ·çœ‹èµ·æ¥ä¸å¤Ÿç›´è§‚ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•ä½¿ç”¨ k6 Cloud æ¥å±•ç¤ºç»“æœã€‚ç™»é™†åï¼Œåªè¦åœ¨æ‰§è¡Œ k6 æ—¶ï¼Œé€šè¿‡ &lt;code>-o cloud&lt;/code>çš„æ–¹å¼å°†è¾“å‡ºæŒ‡å®šåˆ° cloud å°±å¯ä»¥åœ¨ cloud ä¸Šçœ‹åˆ°æ‰€æœ‰çš„æŒ‡æ ‡äº†&lt;/p>
&lt;p>&lt;img src="https://s2.loli.net/2021/12/17/YkoIXDai59Crbct.png" alt="img">&lt;/p>
&lt;h2 id="æ€»ç»“">æ€»ç»“&lt;/h2>
&lt;p>æœ¬ç¯‡ä¸»è¦æ˜¯åœ¨ä»‹ç»ä¸€ä¸ªç°ä»£åŒ–çš„ç”¨æˆ·ä½“éªŒç›¸å¯¹è¾ƒå¥½çš„å‹æµ‹å·¥å…· k6 ã€‚æˆ‘ç›®å‰æ­£åœ¨è®¡åˆ’å°†å…¶å¼•å…¥åˆ°æˆ‘ä»¬é¡¹ç›®çš„ CI ä¸­ï¼Œä»¥ä¾¿äº†è§£æ¯æ¬¡æ ¸å¿ƒéƒ¨åˆ†çš„å˜æ›´å¯¹é¡¹ç›®æ€§èƒ½çš„å½±å“ã€‚&lt;/p>
&lt;p>åç»­æ¨è¿›é¡ºåˆ©çš„è¯ï¼Œä¼šå†åˆ†äº« k6 å¦‚ä½•åº”ç”¨åˆ° CI ç¯å¢ƒä¸­ï¼Œæ•¬è¯·æœŸå¾…ã€‚&lt;/p>
&lt;hr>
&lt;p>æ¬¢è¿è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://gitee.com/tlrr/awesome/raw/master/2020-9-9/1599632564572-mp-qrcode.png" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category><category domain="https://moelove.info/tags/Grafana/">Grafana</category></item><item><title>ææ‡‚å®¹å™¨æŠ€æœ¯çš„åŸºçŸ³ï¼š namespace ï¼ˆä¸‹ï¼‰</title><link>https://moelove.info/2021/12/13/%E6%90%9E%E6%87%82%E5%AE%B9%E5%99%A8%E6%8A%80%E6%9C%AF%E7%9A%84%E5%9F%BA%E7%9F%B3-namespace-%E4%B8%8B/</link><guid isPermaLink="true">https://moelove.info/2021/12/13/%E6%90%9E%E6%87%82%E5%AE%B9%E5%99%A8%E6%8A%80%E6%9C%AF%E7%9A%84%E5%9F%BA%E7%9F%B3-namespace-%E4%B8%8B/</guid><pubDate>Mon, 13 Dec 2021 03:50:29 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å¼ æ™‹æ¶›ã€‚&lt;/p>
&lt;p>ç›®å‰æˆ‘ä»¬æ‰€æåˆ°çš„å®¹å™¨æŠ€æœ¯ã€è™šæ‹ŸåŒ–æŠ€æœ¯ï¼ˆä¸è®ºä½•ç§æŠ½è±¡å±‚æ¬¡ä¸‹çš„è™šæ‹ŸåŒ–æŠ€æœ¯ï¼‰éƒ½èƒ½åšåˆ°èµ„æºå±‚é¢ä¸Šçš„éš”ç¦»å’Œé™åˆ¶ã€‚&lt;/p>
&lt;p>å¯¹äºå®¹å™¨æŠ€æœ¯è€Œè¨€ï¼Œå®ƒå®ç°èµ„æºå±‚é¢ä¸Šçš„é™åˆ¶å’Œéš”ç¦»ï¼Œä¾èµ–äº Linux å†…æ ¸æ‰€æä¾›çš„ cgroup å’Œ namespace æŠ€æœ¯ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬å…ˆå¯¹è¿™ä¸¤é¡¹æŠ€æœ¯çš„ä½œç”¨åšä¸ªæ¦‚æ‹¬ï¼š&lt;/p>
&lt;ul>
&lt;li>cgroup çš„ä¸»è¦ä½œç”¨ï¼šç®¡ç†èµ„æºçš„åˆ†é…ã€é™åˆ¶ï¼›&lt;/li>
&lt;li>namespace çš„ä¸»è¦ä½œç”¨ï¼šå°è£…æŠ½è±¡ï¼Œé™åˆ¶ï¼Œéš”ç¦»ï¼Œä½¿å‘½åç©ºé—´å†…çš„è¿›ç¨‹çœ‹èµ·æ¥æ‹¥æœ‰ä»–ä»¬è‡ªå·±çš„å…¨å±€èµ„æºï¼›&lt;/li>
&lt;/ul>
&lt;p>è¿™æ˜¯ä¸€ä¸ªç³»åˆ—æ–‡ç« ï¼Œå¯¹æ­¤ç³»åˆ—æ„Ÿå…´è¶£çš„å°ä¼™ä¼´å¯ä»¥æŸ¥çœ‹ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://zhuanlan.zhihu.com/p/434731896">å½»åº•ææ‡‚å®¹å™¨æŠ€æœ¯çš„åŸºçŸ³ï¼šcgroup&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://zhuanlan.zhihu.com/p/443605569">å½»åº•ææ‡‚å®¹å™¨æŠ€æœ¯çš„åŸºçŸ³ï¼šnamespaceï¼ˆä¸Šï¼‰&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>æœ¬ç¯‡æˆ‘ä»¬å°†ç»§ç»­èŠ namespaceã€‚&lt;/p>
&lt;h2 id="namespace-ç±»å‹">Namespace ç±»å‹&lt;/h2>
&lt;p>æˆ‘ä»¬å…ˆæ¥æ€»è§ˆä¸€ä¸‹ namespace çš„ç±»å‹ï¼Œä¸Šç¯‡ä¸­å·²ç»ä¸ºå¤§å®¶ä»‹ç»è¿‡ &lt;code>Cgroup&lt;/code> , &lt;code>IPC&lt;/code>, &lt;code>Network&lt;/code> å’Œ &lt;code>Mount&lt;/code> ç­‰ 4 ç§ç±»å‹çš„ namespaceã€‚æˆ‘ä»¬ç»§ç»­èŠå‰©ä½™çš„éƒ¨åˆ†ã€‚&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>namespaceåç§°&lt;/th>
&lt;th>ä½¿ç”¨çš„æ ‡è¯† - Flag&lt;/th>
&lt;th>æ§åˆ¶å†…å®¹&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>Cgroup&lt;/td>
&lt;td>CLONE_NEWCGROUP&lt;/td>
&lt;td>Cgroup root directory cgroup æ ¹ç›®å½•&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>IPC&lt;/td>
&lt;td>CLONE_NEWIPC&lt;/td>
&lt;td>System V IPC, POSIX message queuesä¿¡å·é‡ï¼Œæ¶ˆæ¯é˜Ÿåˆ—&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Network&lt;/td>
&lt;td>CLONE_NEWNET&lt;/td>
&lt;td>Network devices, stacks, ports, etc.ç½‘ç»œè®¾å¤‡ï¼Œåè®®æ ˆï¼Œç«¯å£ç­‰ç­‰&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Mount&lt;/td>
&lt;td>CLONE_NEWNS&lt;/td>
&lt;td>Mount pointsæŒ‚è½½ç‚¹&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>PID&lt;/td>
&lt;td>CLONE_NEWPID&lt;/td>
&lt;td>Process IDsè¿›ç¨‹å·&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Time&lt;/td>
&lt;td>CLONE_NEWTIME&lt;/td>
&lt;td>Boot and monotonic clockså¯åŠ¨å’Œå•è°ƒæ—¶é’Ÿ&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>User&lt;/td>
&lt;td>CLONE_NEWUSER&lt;/td>
&lt;td>User and group IDsç”¨æˆ·å’Œç”¨æˆ·ç»„&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>UTS&lt;/td>
&lt;td>CLONE_NEWUTS&lt;/td>
&lt;td>Hostname and NIS domain nameä¸»æœºåä¸ NIS åŸŸå&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="pid-namespaces">PID namespaces&lt;/h3>
&lt;p>æˆ‘ä»¬çŸ¥é“åœ¨ Linux ç³»ç»Ÿä¸­ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½ä¼šæœ‰è‡ªå·±çš„ç‹¬ç«‹çš„ PIDï¼Œè€Œ PID namespace ä¸»è¦æ˜¯ç”¨äºéš”ç¦»è¿›ç¨‹å·ã€‚å³ï¼Œåœ¨ä¸åŒçš„ PID namespace ä¸­å¯ä»¥åŒ…å«ç›¸åŒçš„è¿›ç¨‹å·ã€‚&lt;/p>
&lt;p>æ¯ä¸ª PID namespace ä¸­è¿›ç¨‹å·éƒ½æ˜¯ä» 1 å¼€å§‹çš„ï¼Œåœ¨æ­¤ PID namespace ä¸­å¯é€šè¿‡è°ƒç”¨ &lt;code>fork(2)&lt;/code>, &lt;code>vfork(2)&lt;/code>å’Œ &lt;code>clone(2)&lt;/code> ç­‰ç³»ç»Ÿè°ƒç”¨æ¥åˆ›å»ºå…¶ä»–æ‹¥æœ‰ç‹¬ç«‹ PID çš„è¿›ç¨‹ã€‚&lt;/p>
&lt;p>è¦ä½¿ç”¨ PID namespace éœ€è¦å†…æ ¸æ”¯æŒ &lt;code>CONFIG_PID_NS&lt;/code> é€‰é¡¹ã€‚å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ grep CONFIG_PID_NS /boot/config-&lt;span class="k">$(&lt;/span>uname -r&lt;span class="k">)&lt;/span>
&lt;span class="nv">CONFIG_PID_NS&lt;/span>&lt;span class="o">=&lt;/span>y
&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="init-è¿›ç¨‹">init è¿›ç¨‹&lt;/h4>
&lt;p>æˆ‘ä»¬éƒ½çŸ¥é“åœ¨ Linux ç³»ç»Ÿä¸­æœ‰ä¸€ä¸ªè¿›ç¨‹æ¯”è¾ƒç‰¹æ®Šï¼Œæ‰€è°“çš„ init è¿›ç¨‹ï¼Œä¹Ÿå°±æ˜¯ PID ä¸º 1 çš„è¿›ç¨‹ã€‚&lt;/p>
&lt;p>å‰é¢æˆ‘ä»¬å·²ç»è¯´äº†æ¯ä¸ª PID namespace ä¸­è¿›ç¨‹å·éƒ½æ˜¯ä» 1 å¼€å§‹çš„ï¼Œé‚£ä¹ˆå®ƒæœ‰ä»€ä¹ˆç‰¹ç‚¹å‘¢ï¼Ÿ&lt;/p>
&lt;p>é¦–å…ˆï¼ŒPID namespace ä¸­çš„ 1 å·è¿›ç¨‹æ˜¯æ‰€æœ‰å­¤ç«‹è¿›ç¨‹çš„çˆ¶è¿›ç¨‹ã€‚&lt;/p>
&lt;p>å…¶æ¬¡ï¼Œå¦‚æœè¿™ä¸ªè¿›ç¨‹è¢«ç»ˆæ­¢ï¼Œå†…æ ¸å°†è°ƒç”¨ &lt;code>SIGKILL&lt;/code> å‘å‡ºç»ˆæ­¢æ­¤ namespace ä¸­çš„æ‰€æœ‰è¿›ç¨‹çš„ä¿¡å·ã€‚ &lt;strong>è¿™éƒ¨åˆ†å†…å®¹ä¸ Kubernetes ä¸­åº”ç”¨çš„ä¼˜é›…å…³é—­/å¹³æ»‘å‡çº§ç­‰éƒ½æœ‰ä¸€å®šçš„è”ç³»ã€‚&lt;/strong>ï¼ˆå¯¹æ­¤éƒ¨åˆ†æ„Ÿå…´è¶£çš„å°ä¼™ä¼´å¯ä»¥ç•™è¨€äº¤æµï¼Œå¦‚æœå¯¹è¿™äº›å†…å®¹æ„Ÿå…´è¶£çš„è¯ï¼Œæˆ‘å¯ä»¥ä¸“é—¨å†™ä¸€ç¯‡å±•å¼€æ¥èŠï¼‰&lt;/p>
&lt;p>æœ€åï¼Œä» Linux v3.4 å†…æ ¸ç‰ˆæœ¬å¼€å§‹ï¼Œå¦‚æœåœ¨ä¸€ä¸ª PID namespace ä¸­å‘ç”Ÿ &lt;code>reboot()&lt;/code> çš„ç³»ç»Ÿè°ƒç”¨ï¼Œåˆ™ PID namespace ä¸­çš„ init è¿›ç¨‹ä¼šç«‹å³é€€å‡ºã€‚&lt;strong>è¿™ç®—æ˜¯ä¸€ä¸ªæ¯”è¾ƒç‰¹æ®Šçš„æŠ€å·§ï¼Œå¯ç”¨äºå¤„ç†é«˜è´Ÿè½½æœºå™¨ä¸Šå®¹å™¨é€€å‡ºçš„é—®é¢˜ã€‚&lt;/strong>&lt;/p>
&lt;h4 id="pid-namespace-çš„å±‚æ¬¡ç»“æ„">PID namespace çš„å±‚æ¬¡ç»“æ„&lt;/h4>
&lt;p>PID namespace æ”¯æŒåµŒå¥—ï¼Œé™¤äº†åˆå§‹çš„ PID namespaceå¤–ï¼Œå…¶ä½™çš„ PID namespace éƒ½æ‹¥æœ‰å…¶çˆ¶èŠ‚ç‚¹çš„ PID namespaceã€‚&lt;/p>
&lt;p>ä¹Ÿå°±æ˜¯è¯´ PID namespace ä¹Ÿæ˜¯æ ‘å½¢ç»“æ„çš„ï¼Œæ­¤ç»“æ„å†…çš„æ‰€æœ‰ PID namespace æˆ‘ä»¬éƒ½å¯ä»¥è¿½è¸ªåˆ°ç¥–å…ˆ PID namespaceã€‚å½“ç„¶ï¼Œè¿™ä¸ªæ·±åº¦ä¹Ÿä¸æ˜¯æ— é™çš„ï¼Œä» Linux v3.7 å†…æ ¸ç‰ˆæœ¬å¼€å§‹ï¼Œæ ‘çš„æœ€å¤§æ·±åº¦è¢«é™åˆ¶æˆ 32 ã€‚&lt;/p>
&lt;p>å¦‚æœè¾¾åˆ°æ­¤æœ€å¤§æ·±åº¦ï¼Œå°†ä¼šæŠ›å‡º &lt;code>No space left on device&lt;/code>çš„é”™è¯¯ã€‚&lt;em>ï¼ˆæˆ‘ä¹‹å‰å°è¯•åµŒå¥—å®¹å™¨çš„æ—¶å€™é‡åˆ°è¿‡ï¼‰&lt;/em>&lt;/p>
&lt;p>&lt;strong>åœ¨åŒä¸€ä¸ªï¼ˆä¸”åŒçº§ï¼‰ PID namespace ä¸­ï¼Œè¿›ç¨‹é—´å½¼æ­¤å¯è§ã€‚&lt;/strong>&lt;/p>
&lt;p>ä½†å¦‚æœæŸä¸ªè¿›ç¨‹ä½äºå­ PID namespace çš„è¯ï¼Œé‚£ä¹ˆè¯¥è¿›ç¨‹æ˜¯çœ‹ä¸åˆ°ä¸Šä¸€å±‚ï¼ˆå³ï¼Œçˆ¶ PID namespaceï¼‰ä¸­çš„è¿›ç¨‹çš„ã€‚&lt;/p>
&lt;p>è¿›ç¨‹é—´æ˜¯å¦å¯è§ï¼Œå†³å®šäº†è¿›ç¨‹é—´èƒ½å¦å­˜åœ¨ä¸€å®šçš„å…³è”å’Œè°ƒç”¨å…³ç³»ï¼Œå°ä¼™ä¼´ä»¬å¯¹è¿™ä¸ªåº”è¯¥æ¯”è¾ƒç†Ÿæ‚‰ï¼Œè¿™é‡Œæˆ‘å°±ä¸èµ˜è¿°äº†ã€‚&lt;/p>
&lt;p>é‚£ä¹ˆï¼Œè¿›ç¨‹æ˜¯å¦å¯ä»¥è°ƒåº¦åˆ°ä¸åŒå±‚çº§çš„ PID namespace å‘¢ï¼Ÿ&lt;/p>
&lt;p>æˆ‘ä»¬å…ˆæ¥è¯´ç»“è®ºï¼Œ&lt;strong>è¿›ç¨‹åœ¨ PID namespace ä¸­çš„è°ƒåº¦åªèƒ½æ˜¯å•å‘è°ƒåº¦ï¼ˆä»é«˜ -&amp;gt; ä½ï¼‰&lt;/strong>ã€‚å³ï¼š&lt;/p>
&lt;ul>
&lt;li>è¿›ç¨‹åªèƒ½ä»çˆ¶ PID namespace è°ƒåº¦åˆ° å­ PID namespace ä¸­ï¼›&lt;/li>
&lt;li>è¿›ç¨‹ä¸èƒ½ä»å­ PID namespace è°ƒåº¦åˆ° çˆ¶ PID namespace ä¸­ï¼›&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://s2.loli.net/2021/12/14/aoe3DC2TLA47xBZ.png" alt="img">&lt;/p>
&lt;p>&lt;strong>å›¾ 1 ï¼Œé€šè¿‡ setns(2) è°ƒåº¦è¿›ç¨‹è¯´æ˜&lt;/strong>&lt;/p>
&lt;p>PID namespace çš„å±‚çº§å…³ç³»å…¶å®æ˜¯ç”± &lt;code>ioctl_ns(2)&lt;/code> ç³»ç»Ÿè°ƒç”¨è¿›è¡Œå‘ç°å’Œç»´æŠ¤çš„ï¼ˆNS_GET_PARENTï¼‰ï¼Œè¿™é‡Œå…ˆä¸å±•å¼€ã€‚é‚£ä¹ˆï¼Œä¸Šè¿°å†…å®¹ä¸­çš„è°ƒåº¦æ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿ&lt;/p>
&lt;p>è¦è§£ç­”è¿™ä¸ªé—®é¢˜ï¼Œå°±å¿…é¡»å…ˆæ„è¯†åˆ°åœ¨ PID namespace åˆ›å»ºä¹‹åˆï¼Œå“ªäº›è¿›ç¨‹å…·å¤‡è¯¥ namespace çš„æƒé™å°±å·²ç»ç¡®å®šäº†ã€‚è‡³äºè°ƒåº¦ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•åœ°å°†å…¶ç†è§£æˆå…³ç³»æ˜ å°„æˆ–è€…ç¬¦å·é“¾æ¥ã€‚&lt;/p>
&lt;p>çº¿ç¨‹å¿…é¡»åœ¨åŒä¸€ä¸ªPID namespace ä¸­ï¼Œä»¥ä¾¿ä¿è¯è¿›ç¨‹ä¸­çš„çº¿ç¨‹é—´å¯ä»¥å½¼æ­¤äº’ä¼ ä¿¡å·ã€‚è¿™å°±å¯¼è‡´äº†&lt;code>CLONE_NEWPID&lt;/code> ä¸èƒ½ä¸ &lt;code>CLONE_THREAD&lt;/code> åŒæ—¶ä½¿ç”¨ã€‚ä½†å¦‚æœåˆ†å¸ƒåœ¨ä¸åŒ PID namespace çš„å¤šä¸ªè¿›ç¨‹äº’ç›¸æœ‰ä¿¡å·ä¼ é€’çš„éœ€æ±‚è¦æ€ä¹ˆåŠå‘¢ï¼Ÿ ç”¨å…±äº«çš„ä¿¡å·é˜Ÿåˆ—å³å¯è§£å†³ã€‚&lt;/p>
&lt;p>æ­¤å¤–ï¼Œæˆ‘ä»¬å¸¸æ¥è§¦åˆ°çš„ &lt;code>/proc&lt;/code> ç›®å½•ä¸‹æœ‰å¾ˆå¤š &lt;code>/proc/${PID}&lt;/code>çš„ç›®å½•ï¼Œåœ¨å…¶ä¸­å¯çœ‹åˆ° PID namespace ä¸­çš„è¿›ç¨‹æƒ…å†µã€‚ åŒæ—¶æ­¤ç›®å½•ä¹Ÿæ˜¯å¯ç›´æ¥é€šè¿‡æŒ‚è½½æ–¹å¼è¿›è¡Œæ“ä½œçš„ã€‚æ¯”å¦‚ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-plain" data-lang="plain">(MoeLove) âœ mount |grep proc
proc on /proc type proc (rw,nosuid,nodev,noexec,relatime)
&lt;/code>&lt;/pre>&lt;/div>&lt;p>æœ‰æ²¡æœ‰åŠæ³•çŸ¥é“å½“å‰æœ€å¤§çš„ PID æ•°å‘¢ï¼Ÿ&lt;/p>
&lt;p>è¿™ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œè‡ªä» Linux v3.3 ç‰ˆæœ¬çš„å†…æ ¸å¼€å§‹æ–°å¢äº†ä¸€ä¸ª &lt;code>/proc/sys/kernel/ns_last_pid&lt;/code>çš„æ–‡ä»¶ï¼Œç”¨äºè®°å½•æœ€åä¸€ä¸ªè¿›ç¨‹çš„ ID ã€‚&lt;/p>
&lt;p>å½“éœ€è¦åˆ†é…ä¸‹ä¸€ä¸ªè¿›ç¨‹ ID çš„æ—¶å€™ï¼Œå†…æ ¸ä¼šå»æœç´¢æœ€å¤§çš„æœªä½¿ç”¨ ID è¿›è¡Œåˆ†é…ï¼Œéšåä¼šæ›´æ–°æ­¤æ–‡ä»¶ä¸­ PID çš„ä¿¡æ¯ã€‚&lt;/p>
&lt;h3 id="time-namespaces">Time namespaces&lt;/h3>
&lt;p>åœ¨èŠ time namespace ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆèŠä¸‹&lt;strong>å•è°ƒæ—¶é—´&lt;/strong>ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬é€šå¸¸æåˆ°çš„ç³»ç»Ÿæ—¶é—´ï¼ŒæŒ‡çš„æ˜¯ clock realtimeï¼Œå³ï¼Œæœºå™¨å¯¹å½“å‰æ—¶é—´çš„å±•ç¤ºã€‚å®ƒå¯ä»¥å‘å‰æˆ–è€…å‘åè°ƒæ•´ï¼ˆç»“åˆ NTP æœåŠ¡æ¥ç†è§£ï¼‰ã€‚è€Œ clock monotonic è¡¨ç¤ºåœ¨æŸä¸€æ—¶åˆ»ä¹‹åçš„æ—¶é—´è®°å½•ï¼Œå®ƒæ˜¯å•å‘å‘åçš„ç»å¯¹æ—¶é—´ï¼Œä¸å—ç³»ç»Ÿæ—¶é—´çš„å˜åŒ–æ‰€å½±å“ã€‚&lt;/p>
&lt;p>ä½¿ç”¨ time namespace éœ€è¦å†…æ ¸æ”¯æŒ &lt;code>CONFIG_TIME_NS&lt;/code> é€‰é¡¹ã€‚å¦‚ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ grep CONFIG_TIME_NS /boot/config-&lt;span class="k">$(&lt;/span>uname -r&lt;span class="k">)&lt;/span>
&lt;span class="nv">CONFIG_TIME_NS&lt;/span>&lt;span class="o">=&lt;/span>y
&lt;/code>&lt;/pre>&lt;/div>&lt;p>time namespace ä¸ä¼šè™šæ‹ŸåŒ– CLOCK_REALTIME æ—¶é’Ÿã€‚ä½ å¯èƒ½ä¼šå¥½å¥‡ï¼Œä¸ºä»€ä¹ˆå†…æ ¸æ”¯æŒ time namespace å‘¢ï¼Ÿä¸»è¦æ˜¯ä¸ºäº†ä¸€äº›ç‰¹æ®Šçš„åœºæ™¯ã€‚&lt;/p>
&lt;p>time namespace ä¸­çš„æ‰€æœ‰è¿›ç¨‹å…±äº«ç”± time namespace æä¾›çš„ä»¥ä¸‹ä¸¤ä¸ªå‚æ•°ï¼š&lt;/p>
&lt;ul>
&lt;li>CLOCK_MONOTONIC - å•è°ƒæ—¶é—´ï¼Œä¸€ä¸ªä¸å¯è®¾ç½®çš„æ—¶é’Ÿï¼›&lt;/li>
&lt;li>CLOCK_BOOTTIMEï¼ˆå¯å‚è€ƒ CLOCK_BOOTTIME_ALARM å†…æ ¸å‚æ•°ï¼‰- ä¸å¯è®¾ç½®çš„æ—¶é’Ÿï¼ŒåŒ…æ‹¬ç³»ç»Ÿæš‚åœçš„æ—¶é—´ã€‚&lt;/li>
&lt;/ul>
&lt;p>time namespace ç›®å‰åªèƒ½ä½¿ç”¨ CLONE_NEWTIME æ ‡è¯†ï¼Œé€šè¿‡è°ƒç”¨ &lt;code>unshare(2)&lt;/code> ç³»ç»Ÿè°ƒç”¨è¿›è¡Œåˆ›å»ºã€‚åˆ›å»º time namespace çš„è¿›ç¨‹æ˜¯ç‹¬ç«‹äºæ–°å»ºçš„ time namespace ä¹‹å¤–çš„ï¼Œè€Œè¯¥è¿›ç¨‹åç»­çš„å­è¿›ç¨‹å°†ä¼šè¢«æ”¾ç½®åˆ°æ–°å»ºçš„ time namespace ä¹‹å†…ã€‚åŒä¸€ä¸ª time namespace ä¸­çš„è¿›ç¨‹ä»¬ä¼šå…±äº« CLOCK_MONOTONIC å’Œ CLOCK_BOOTTIMEã€‚&lt;/p>
&lt;p>å½“çˆ¶è¿›ç¨‹åˆ›å»ºå­è¿›ç¨‹æ—¶ï¼Œå­è¿›ç¨‹çš„ time namespace å½’å±å°†åœ¨æ–‡ä»¶ /proc/[pid]/ns/time_for_children ä¸­æ˜¾ç¤ºã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ ls -al /proc/self/ns/time_for_children
lrwxrwxrwx. &lt;span class="m">1&lt;/span> tao tao &lt;span class="m">0&lt;/span> 12æœˆ &lt;span class="m">14&lt;/span> 02:06 /proc/self/ns/time_for_children -&amp;gt; &lt;span class="s1">&amp;#39;time:[4026531834]&amp;#39;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ–‡ä»¶ /proc/PID/timens_offsets å®šä¹‰äº†åˆå§‹ time namespace çš„å•è°ƒæ—¶é’Ÿå’Œå¯åŠ¨æ—¶é’Ÿï¼Œå¹¶è®°å½•äº†åç§»é‡ã€‚ï¼ˆå¦‚æœä¸€ä¸ªæ–°çš„ time namespace è¿˜æ²¡æœ‰è¿›ç¨‹å…¥é©»æ—¶ï¼Œæ˜¯å¯ä»¥è¿›è¡Œä¿®æ”¹çš„ã€‚è¿™é‡Œæš‚ä¸å±•å¼€ï¼Œæ„Ÿå…´è¶£çš„å°ä¼™ä¼´å¯è®¨è®ºåŒºç•™è¨€äº¤æµè®¨è®ºã€‚ï¼‰&lt;/p>
&lt;p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼šåœ¨åˆå§‹çš„ time namespace ä¸­ï¼Œ/proc/self/timens_offsets æ˜¾ç¤ºçš„åç§»é‡éƒ½ä¸º 0ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ cat /proc/self/timens_offsets
monotonic &lt;span class="m">0&lt;/span> &lt;span class="m">0&lt;/span>
boottime &lt;span class="m">0&lt;/span> &lt;span class="m">0&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>å…¶ä¸­ç¬¬äºŒåˆ—å’Œç¬¬ä¸‰åˆ—çš„å«ä¹‰å¦‚ä¸‹ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;offset-secs> å¯ä»¥ä¸ºè´Ÿå€¼ï¼Œå•ä½ ï¼šç§’ï¼ˆsï¼‰&lt;/li>
&lt;li>&lt;offset-nanosecs> æ˜¯ä¸ªæ— ç¬¦å·å€¼ï¼Œå•ä½ ï¼šçº³ç§’ï¼ˆnsï¼‰&lt;/li>
&lt;/ul>
&lt;p>ä»¥ä¸‹çš„æ—¶é’Ÿæ¥å£éƒ½ä¸æ­¤ namespace æœ‰æ‰€å…³è”ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>clock_gettime(2)&lt;/p>
&lt;/li>
&lt;li>
&lt;p>clock_nanosleep(2)&lt;/p>
&lt;/li>
&lt;li>
&lt;p>nanosleep(2)&lt;/p>
&lt;/li>
&lt;li>
&lt;p>timer_settime(2)&lt;/p>
&lt;/li>
&lt;li>
&lt;p>timerfd_settime(2)&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>æ•´ä½“è€Œè¨€ï¼Œ time namespace åœ¨ä¸€äº›ç‰¹æ®Šåœºæ™¯ä¸‹è¿˜æ˜¯å¾ˆæœ‰ç”¨çš„ã€‚&lt;/p>
&lt;h3 id="user-namespaces">User namespaces&lt;/h3>
&lt;p>User namespaces é¡¾åæ€ä¹‰æ˜¯éš”ç¦»äº†ç”¨æˆ· idã€ç»„ id ç­‰ã€‚&lt;/p>
&lt;p>ä½¿ç”¨ user namespaces éœ€è¦å†…æ ¸æ”¯æŒ CONFIG_USER_NS é€‰é¡¹ã€‚å¦‚ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">âœ local_time grep CONFIG_USER_NS /boot/config-&lt;span class="k">$(&lt;/span>uname -r&lt;span class="k">)&lt;/span>
&lt;span class="nv">CONFIG_USER_NS&lt;/span>&lt;span class="o">=&lt;/span>y
&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿›ç¨‹çš„ç”¨æˆ· id å’Œç»„ id åœ¨ä¸€ä¸ª user namespace å†…å’Œå¤–æœ‰å¯èƒ½æ˜¯ä¸åŒçš„ã€‚&lt;/p>
&lt;p>æ¯”å¦‚ï¼Œä¸€ä¸ªè¿›ç¨‹åœ¨ user namespace ä¸­çš„ç”¨æˆ·å’Œç»„å¯ä»¥æ˜¯ç‰¹æƒç”¨æˆ·ï¼ˆrootï¼‰ï¼Œä½†åœ¨è¯¥ user namespace ä¹‹å¤–ï¼Œå¯èƒ½åªæ˜¯ä¸€ä¸ªæ™®é€šçš„éç‰¹æƒç”¨æˆ·ã€‚è¿™å°±æ¶‰åŠåˆ°ç”¨æˆ·ã€ç»„æ˜ å°„ï¼ˆuid_map ã€gid_mapï¼‰ç­‰ç›¸å…³çš„å†…å®¹äº†ã€‚&lt;/p>
&lt;p>è‡ª Linux v3.5 ç‰ˆæœ¬çš„å†…æ ¸å¼€å§‹ï¼Œåœ¨ &lt;code>/proc/[pid]/uid_map&lt;/code> å’Œ &lt;code>/proc/[pid]/gid_map&lt;/code> æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æŸ¥çœ‹åˆ°æ˜ å°„å†…å®¹ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ cat /proc/self/uid_map
&lt;span class="m">0&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="m">4294967295&lt;/span>
&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ cat /proc/self/gid_map
&lt;span class="m">0&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="m">4294967295&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>user namespace ä¹Ÿæ”¯æŒåµŒå¥—ï¼Œä½¿ç”¨ CLONE_NEWUSER æ ‡è¯†ï¼Œä½¿ç”¨ unshare(2) æˆ–è€… clone(2) ç­‰ç³»ç»Ÿè°ƒç”¨æ¥åˆ›å»ºï¼Œæœ€å¤§çš„åµŒå¥—å±‚çº§æ·±åº¦ä¹Ÿæ˜¯ 32ã€‚&lt;/p>
&lt;p>å¦‚æœæ˜¯é€šè¿‡ fork(2) æˆ–è€… clone(2) åˆ›å»ºçš„å­è¿›ç¨‹æ²¡å¸¦æœ‰ CLONE_NEWUSER æ ‡è¯†ï¼Œä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œå­è¿›ç¨‹è·Ÿçˆ¶è¿›ç¨‹åŒåœ¨ä¸€ä¸ª user namespace ä¸­ã€‚æ ‘çŠ¶çš„å…³è”å…³ç³»åŒæ ·é€šè¿‡ ioctl(2) ç³»ç»Ÿè°ƒç”¨æ¥å£ç»´æŠ¤ã€‚&lt;/p>
&lt;p>ä¸€ä¸ªå•çº¿ç¨‹è¿›ç¨‹å¯ä»¥é€šè¿‡ setns(2) ç³»ç»Ÿè°ƒç”¨æ¥è°ƒæ•´å…¶å½’å±çš„ user namespaceã€‚&lt;/p>
&lt;p>æ­¤å¤–ï¼Œ user namespace è¿˜æœ‰ä¸ªå¾ˆé‡è¦çš„è§„åˆ™ï¼Œé‚£å°±æ˜¯å…³äº Linux capability çš„ç»§æ‰¿å…³ç³»ã€‚å…³äº Linux capability æˆ‘å°±ä¸å±•å¼€äº†ï¼Œè¿™é‡Œç®€å•è®°å½•ä¸€ä¸‹ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>å½“è¿›ç¨‹æ‰€åœ¨çš„ user namespace æ‹¥æœ‰ effective capability set ä¸­çš„ capability æ—¶ï¼Œè¯¥è¿›ç¨‹å…·æœ‰è¯¥ capabilityã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å½“è¿›ç¨‹åœ¨è¯¥ user namespace ä¸­æ‹¥æœ‰ capability æ—¶ï¼Œè¯¥è¿›ç¨‹åœ¨æ­¤ user namespace çš„æ‰€æœ‰å­ user namespace ä¸­éƒ½æ‹¥æœ‰è¯¥ capabilityã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>åˆ›å»ºè¯¥ user namespace çš„ç”¨æˆ·ä¼šè¢«å†…æ ¸è®°å½•ä¸º owner ï¼Œå³ï¼Œæ‹¥æœ‰è¯¥ user namespace ä¸­çš„å…¨éƒ¨ capabilitiesã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>å¯¹äº Docker è€Œè¨€ï¼Œå®ƒå¯ä»¥åŸç”Ÿçš„æ”¯æŒæ­¤èƒ½åŠ›ï¼Œè¿›è€Œè¾¾åˆ°å¯¹å®¹å™¨ç¯å¢ƒçš„ä¸€ç§ä¿æŠ¤ã€‚&lt;/p>
&lt;h3 id="uts-namespaces">UTS namespaces&lt;/h3>
&lt;p>UTS namespaces éš”ç¦»äº†ä¸»æœºåå’Œ NIS åŸŸåã€‚&lt;/p>
&lt;p>ä½¿ç”¨ UTS namespaces éœ€è¦å†…æ ¸æ”¯æŒ CONFIG_UTS_NS é€‰é¡¹ã€‚å¦‚ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ grep CONFIG_UTS_NS /boot/config-&lt;span class="k">$(&lt;/span>uname -r&lt;span class="k">)&lt;/span>
&lt;span class="nv">CONFIG_UTS_NS&lt;/span>&lt;span class="o">=&lt;/span>y
&lt;/code>&lt;/pre>&lt;/div>&lt;p>åœ¨åŒä¸€ä¸ª UTS namespace ä¸­ï¼Œé€šè¿‡ sethostname(2) å’Œ and setdomainname(2) ç³»ç»Ÿè°ƒç”¨è¿›è¡Œçš„è®¾ç½®å’Œä¿®æ”¹æ˜¯æ‰€æœ‰è¿›ç¨‹å…±äº«æŸ¥çœ‹çš„ï¼Œä½†æ˜¯å¯¹äºä¸åŒ UTS namespaces è€Œè¨€ï¼Œåˆ™å½¼æ­¤éš”ç¦»ä¸å¯è§ã€‚&lt;/p>
&lt;h2 id="namespaces-ä¸»è¦çš„-api">Namespaces ä¸»è¦çš„ API&lt;/h2>
&lt;p>å‰é¢å†…å®¹ä¸­æåˆ°äº†å¾ˆå¤šçš„ç³»ç»Ÿè°ƒç”¨ï¼Œè¿™é‡Œæˆ‘ä»¬æ¥æŒ‘å‡ ä¸ªé‡è¦çš„ä»‹ç»ä¸€ä¸‹ã€‚&lt;/p>
&lt;h3 id="clone2">clone(2)&lt;/h3>
&lt;p>ç³»ç»Ÿè°ƒç”¨ clone(2) åˆ›å»ºä¸€ä¸ªæ–°çš„è¿›ç¨‹ï¼Œå®ƒä¼šæ ¹æ®å‚æ•°ä¸­çš„ CLONE_NEW* è®¾ç½®ï¼Œé€ä¸ªå®ç°å¯¹åº”çš„é…ç½®åŠŸèƒ½ã€‚å½“ç„¶è¿™ä¸ªç³»ç»Ÿè°ƒç”¨ä¹Ÿå®ç°äº†ä¸€äº›ä¸ namespace æ— å…³çš„åŠŸèƒ½ã€‚å¯¹ä½äº Linux 3.8 ç‰ˆæœ¬å†…æ ¸çš„ç³»ç»Ÿè€Œè¨€ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œ éœ€è¦å…·å¤‡ CAP_SYS_ADMIN çš„ capabilityã€‚&lt;/p>
&lt;h3 id="unshare2">unshare(2)&lt;/h3>
&lt;p>ç³»ç»Ÿè°ƒç”¨ unshare(2) å°†è¿›ç¨‹åˆ†é…è‡³æ–°çš„ namespace ï¼ŒåŒæ ·ï¼Œå®ƒä¹Ÿä¼šæ ¹æ®å‚æ•°ä¸­çš„ CLONE_NEW* è®¾ç½®æ¥è°ƒæ•´å®ç°å¯¹åº”çš„é…ç½®åŠŸèƒ½ã€‚å¯¹ä½äº Linux 3.8 çš„ç³»ç»Ÿè€Œè¨€ï¼Œå¤§å¤šæ•°æƒ…å†µï¼Œéœ€è¦å…·å¤‡ CAP_SYS_ADMIN çš„ capabilityã€‚&lt;/p>
&lt;h3 id="setns2">setns(2)&lt;/h3>
&lt;p>ç³»ç»Ÿè°ƒç”¨ setns(2) å°†è¿›ç¨‹ç§»åŠ¨åˆ°æŸä¸€å·²å­˜åœ¨çš„ namespaceï¼Œè¿™ä¼šå¯¼è‡´ /proc/[pid]/ns å¯¹åº”çš„ç›®å½•ä¸­å†…å®¹çš„å˜æ›´ã€‚è¿›ç¨‹åˆ›å»ºçš„å­è¿›ç¨‹å¯ä»¥é€šè¿‡è°ƒç”¨ unshare(2) å’Œ setns(2) æ¥è°ƒæ•´æ‰€å±çš„ namespaceã€‚è¿™é€šå¸¸æ˜¯éœ€è¦å…·å¤‡ CAP_SYS_ADMIN çš„ capability çš„ã€‚&lt;/p>
&lt;h2 id="ä¸€äº›å…³é”®ç›®å½•è¯´æ˜">ä¸€äº›å…³é”®ç›®å½•è¯´æ˜&lt;/h2>
&lt;h3 id="procpidns-ç›®å½•">/proc/[pid]/ns/ ç›®å½•&lt;/h3>
&lt;p>æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ä¸€ä¸ª /proc/[pid]/ns/ å­ç›®å½•ï¼Œç›®å½•ä¸­çš„å†…å®¹ä¼šå—åˆ° setns(2) ç³»ç»Ÿè°ƒç”¨çš„å½±å“ã€‚åªè¦ç›®å½•ä¸­çš„æ–‡ä»¶è¢«æ‰“å¼€ï¼Œå¯¹åº”çš„ namespace å°±ä¸èƒ½è¢«é”€æ¯ã€‚ç³»ç»Ÿå¯ä»¥é€šè¿‡è°ƒç”¨ setns(2) æ¥å˜æ›´è¿™äº›æ–‡ä»¶å†…å®¹ã€‚&lt;/p>
&lt;ul>
&lt;li>Linux 3.7 åŠæ›´æ—©æœŸçš„ç‰ˆæœ¬ - æ–‡ä»¶æ˜¯ä»¥ç¡¬é“¾æ¥æ–¹å¼å­˜åœ¨çš„ï¼›&lt;/li>
&lt;li>Linux 3.8 å¼€å§‹ - æ–‡ä»¶ä»¥è½¯è¿æ¥çš„æ–¹å¼å­˜åœ¨ï¼›&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ ls -l --time-style&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;+&amp;#39;&lt;/span> /proc/&lt;span class="nv">$$&lt;/span>/ns
æ€»ç”¨é‡ &lt;span class="m">0&lt;/span>
lrwxrwxrwx. &lt;span class="m">1&lt;/span> tao tao &lt;span class="m">0&lt;/span> cgroup -&amp;gt; &lt;span class="s1">&amp;#39;cgroup:[4026531835]&amp;#39;&lt;/span>
lrwxrwxrwx. &lt;span class="m">1&lt;/span> tao tao &lt;span class="m">0&lt;/span> ipc -&amp;gt; &lt;span class="s1">&amp;#39;ipc:[4026531839]&amp;#39;&lt;/span>
lrwxrwxrwx. &lt;span class="m">1&lt;/span> tao tao &lt;span class="m">0&lt;/span> mnt -&amp;gt; &lt;span class="s1">&amp;#39;mnt:[4026531840]&amp;#39;&lt;/span>
lrwxrwxrwx. &lt;span class="m">1&lt;/span> tao tao &lt;span class="m">0&lt;/span> net -&amp;gt; &lt;span class="s1">&amp;#39;net:[4026532008]&amp;#39;&lt;/span>
lrwxrwxrwx. &lt;span class="m">1&lt;/span> tao tao &lt;span class="m">0&lt;/span> pid -&amp;gt; &lt;span class="s1">&amp;#39;pid:[4026531836]&amp;#39;&lt;/span>
lrwxrwxrwx. &lt;span class="m">1&lt;/span> tao tao &lt;span class="m">0&lt;/span> pid_for_children -&amp;gt; &lt;span class="s1">&amp;#39;pid:[4026531836]&amp;#39;&lt;/span>
lrwxrwxrwx. &lt;span class="m">1&lt;/span> tao tao &lt;span class="m">0&lt;/span> &lt;span class="nb">time&lt;/span> -&amp;gt; &lt;span class="s1">&amp;#39;time:[4026531834]&amp;#39;&lt;/span>
lrwxrwxrwx. &lt;span class="m">1&lt;/span> tao tao &lt;span class="m">0&lt;/span> time_for_children -&amp;gt; &lt;span class="s1">&amp;#39;time:[4026531834]&amp;#39;&lt;/span>
lrwxrwxrwx. &lt;span class="m">1&lt;/span> tao tao &lt;span class="m">0&lt;/span> user -&amp;gt; &lt;span class="s1">&amp;#39;user:[4026531837]&amp;#39;&lt;/span>
lrwxrwxrwx. &lt;span class="m">1&lt;/span> tao tao &lt;span class="m">0&lt;/span> uts -&amp;gt; &lt;span class="s1">&amp;#39;uts:[4026531838]&amp;#39;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¦‚æœä¸¤ä¸ªè¿›ç¨‹çš„ namespace ç›¸åŒï¼Œé‚£ä¹ˆå®ƒä»¬è¿™ä¸ªç›®å½•å†…çš„å†…å®¹åº”è¯¥æ˜¯ä¸€æ ·çš„ã€‚&lt;/p>
&lt;p>ä»¥ä¸‹æ˜¯è¯¥ç›®å½•ä¸‹æ–‡ä»¶çš„è¯¦ç»†è¯´æ˜ï¼š&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>æ–‡ä»¶åç§°&lt;/th>
&lt;th>èµ·å§‹ç‰ˆæœ¬&lt;/th>
&lt;th>æè¿°&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>/proc/[pid]/ns/cgroup&lt;/td>
&lt;td>Linux 4.6&lt;/td>
&lt;td>è¿›ç¨‹çš„ cgroup namespace&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>/proc/[pid]/ns/ipc&lt;/td>
&lt;td>Linux 3.0&lt;/td>
&lt;td>è¿›ç¨‹çš„ IPC namespace&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>/proc/[pid]/ns/mnt&lt;/td>
&lt;td>Linux 3.8&lt;/td>
&lt;td>è¿›ç¨‹çš„ mount namespace&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>/proc/[pid]/ns/net&lt;/td>
&lt;td>Linux 3.0&lt;/td>
&lt;td>è¿›ç¨‹çš„ network namespace&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>/proc/[pid]/ns/pid&lt;/td>
&lt;td>Linux 3.8&lt;/td>
&lt;td>è¿›ç¨‹çš„ PID namespaceåœ¨è¿›ç¨‹çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸé‡Œæ˜¯ä¸å˜çš„&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>/proc/[pid]/ns/pid_for_children&lt;/td>
&lt;td>Linux 4.12&lt;/td>
&lt;td>è¿›ç¨‹åˆ›å»ºå­è¿›ç¨‹çš„ PID namespaceè¿™ä¸ªæ–‡ä»¶ä¸ /proc/[pid]/ns/pid ä¸ä¸€å®šä¸€è‡´ã€‚&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>/proc/[pid]/ns/time&lt;/td>
&lt;td>Linux 5.6&lt;/td>
&lt;td>è¿›ç¨‹çš„ time namespace&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>/proc/[pid]/ns/time_for_children&lt;/td>
&lt;td>Linux 5.6&lt;/td>
&lt;td>è¿›ç¨‹åˆ›å»ºå­è¿›ç¨‹çš„ time namespace&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>/proc/[pid]/ns/user&lt;/td>
&lt;td>Linux 3.8&lt;/td>
&lt;td>è¿›ç¨‹çš„ user namespace&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>/proc/[pid]/ns/uts&lt;/td>
&lt;td>Linux 3.0&lt;/td>
&lt;td>è¿›ç¨‹çš„ UTS namespace&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="procsysuser-ç›®å½•">/proc/sys/user ç›®å½•&lt;/h3>
&lt;p>/proc/sys/user ç›®å½•ä¸‹çš„æ–‡ä»¶è®°å½•äº†å„ namespace çš„ç›¸å…³é™åˆ¶ã€‚å½“è¾¾åˆ°é™åˆ¶ï¼Œç›¸å…³è°ƒç”¨ä¼šæŠ¥é”™ error ENOSPC ã€‚&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>æ–‡ä»¶åç§°&lt;/th>
&lt;th>é™åˆ¶å†…å®¹è¯´æ˜&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>max_cgroup_namespaces&lt;/td>
&lt;td>åœ¨ user namespace ä¸­çš„æ¯ä¸ªç”¨æˆ·å¯ä»¥åˆ›å»ºçš„æœ€å¤§ cgroup namespaces æ•°&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>max_ipc_namespaces&lt;/td>
&lt;td>åœ¨ user namespace ä¸­çš„æ¯ä¸ªç”¨æˆ·å¯ä»¥åˆ›å»ºçš„æœ€å¤§ ipc namespaces æ•°&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>max_mnt_namespaces&lt;/td>
&lt;td>åœ¨ user namespace ä¸­çš„æ¯ä¸ªç”¨æˆ·å¯ä»¥åˆ›å»ºçš„æœ€å¤§ mount namespaces æ•°&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>max_net_namespaces&lt;/td>
&lt;td>åœ¨ user namespace ä¸­çš„æ¯ä¸ªç”¨æˆ·å¯ä»¥åˆ›å»ºçš„æœ€å¤§ network namespaces æ•°&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>max_pid_namespaces&lt;/td>
&lt;td>åœ¨ user namespace ä¸­çš„æ¯ä¸ªç”¨æˆ·å¯ä»¥åˆ›å»ºçš„æœ€å¤§ PID namespaces æ•°&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>max_time_namespaces&lt;/td>
&lt;td>Linux 5.7åœ¨ user namespace ä¸­çš„æ¯ä¸ªç”¨æˆ·å¯ä»¥åˆ›å»ºçš„æœ€å¤§ time namespaces æ•°&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>max_user_namespaces&lt;/td>
&lt;td>åœ¨ user namespace ä¸­çš„æ¯ä¸ªç”¨æˆ·å¯ä»¥åˆ›å»ºçš„æœ€å¤§ user namespaces æ•°&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>max_uts_namespaces&lt;/td>
&lt;td>åœ¨ user namespace ä¸­çš„æ¯ä¸ªç”¨æˆ·å¯ä»¥åˆ›å»ºçš„æœ€å¤§ uts namespaces æ•°&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="namespace-çš„ç”Ÿå‘½å‘¨æœŸ">Namespace çš„ç”Ÿå‘½å‘¨æœŸ&lt;/h2>
&lt;p>æ­£å¸¸çš„ namespace çš„ç”Ÿå‘½å‘¨æœŸä¸æœ€åä¸€ä¸ªè¿›ç¨‹çš„ç»ˆæ­¢å’Œç¦»å¼€ç›¸å…³ã€‚&lt;/p>
&lt;p>ä½†æœ‰ä¸€äº›æƒ…å†µï¼Œå³ä½¿æœ€åä¸€ä¸ªè¿›ç¨‹å·²ç»é€€å‡ºäº†ï¼Œnamespace ä»ä¸èƒ½è¢«é”€æ¯ã€‚è¿™é‡Œæ¥ç¨å¾®èŠä¸‹è¿™äº›ç‰¹æ®Šçš„æƒ…å†µï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;code>/proc/[pid]/ns/*&lt;/code> ä¸­çš„æ–‡ä»¶è¢«æ‰“å¼€æˆ–è€… mount ï¼Œå³ä½¿æœ€åä¸€ä¸ªè¿›ç¨‹é€€å‡ºï¼Œä¹Ÿä¸èƒ½è¢«é”€æ¯ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>namespace å­˜åœ¨åˆ†å±‚ï¼Œå­ namespace ä»å­˜åœ¨ ï¼Œå³ä½¿æœ€åä¸€ä¸ªè¿›ç¨‹é€€å‡ºï¼Œä¹Ÿä¸èƒ½è¢«é”€æ¯ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä¸€ä¸ª user namespace æ‹¥æœ‰ä¸€äº›é user namespace ï¼ˆæ¯”å¦‚æ‹¥æœ‰ PID namespace ç­‰å…¶ä»–çš„ namespace å­˜åœ¨ï¼‰ï¼Œå³ä½¿æœ€åä¸€ä¸ªè¿›ç¨‹é€€å‡ºï¼Œä¹Ÿä¸èƒ½è¢«é”€æ¯ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¯¹äº PID namespace è€Œè¨€ï¼Œå¦‚æœä¸ &lt;code>/proc/[pid]/ns/pid_for_children&lt;/code> å­˜åœ¨å…³è”å…³ç³»æ—¶ï¼Œå³ä½¿æœ€åä¸€ä¸ªè¿›ç¨‹é€€å‡ºï¼Œä¹Ÿä¸èƒ½è¢«é”€æ¯;&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>å½“ç„¶è¿˜æœ‰ä¸€äº›å…¶ä»–çš„æƒ…å†µï¼Œæœ‰ç©ºå†è¡¥å……ã€‚&lt;/p>
&lt;h2 id="æ€»ç»“">æ€»ç»“&lt;/h2>
&lt;p>é€šè¿‡ä¹‹å‰çš„ä¸€ç¯‡ï¼Œå’Œæœ¬ç¯‡ï¼Œä¸»è¦ä¸ºå¤§å®¶ä»‹ç»äº† Linux namespace çš„å‘å±•å†ç¨‹ï¼ŒåŸºæœ¬ç±»å‹ï¼Œä¸»è¦ API ä»¥åŠä¸€äº›ä½¿ç”¨åœºæ™¯å’Œç”¨é€”ã€‚&lt;/p>
&lt;p>namespace å¯¹äºå®¹å™¨æŠ€æœ¯è€Œè¨€ï¼Œæ˜¯éå¸¸æ ¸å¿ƒçš„éƒ¨åˆ†ã€‚åç»­æœ¬ç³»åˆ—ä¸­è¿˜å°†ç»§ç»­ä¸ºå¤§å®¶åˆ†äº«å…³äºå®¹å™¨å’Œ Kubernetes ç­‰æŠ€æœ¯çš„å†…å®¹ï¼Œæ•¬è¯·æœŸå¾…ã€‚&lt;/p>
&lt;hr>
&lt;p>æ¬¢è¿è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://gitee.com/tlrr/awesome/raw/master/2020-9-9/1599632564572-mp-qrcode.png" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>ææ‡‚å®¹å™¨æŠ€æœ¯çš„åŸºçŸ³ï¼š namespace ï¼ˆä¸Šï¼‰</title><link>https://moelove.info/2021/12/10/%E6%90%9E%E6%87%82%E5%AE%B9%E5%99%A8%E6%8A%80%E6%9C%AF%E7%9A%84%E5%9F%BA%E7%9F%B3-namespace-%E4%B8%8A/</link><guid isPermaLink="true">https://moelove.info/2021/12/10/%E6%90%9E%E6%87%82%E5%AE%B9%E5%99%A8%E6%8A%80%E6%9C%AF%E7%9A%84%E5%9F%BA%E7%9F%B3-namespace-%E4%B8%8A/</guid><pubDate>Fri, 10 Dec 2021 03:50:29 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å¼ æ™‹æ¶›ã€‚&lt;/p>
&lt;p>ç›®å‰æˆ‘ä»¬æ‰€æåˆ°çš„å®¹å™¨æŠ€æœ¯ã€è™šæ‹ŸåŒ–æŠ€æœ¯ï¼ˆä¸è®ºä½•ç§æŠ½è±¡å±‚æ¬¡ä¸‹çš„è™šæ‹ŸåŒ–æŠ€æœ¯ï¼‰éƒ½èƒ½åšåˆ°èµ„æºå±‚é¢ä¸Šçš„éš”ç¦»å’Œé™åˆ¶ã€‚&lt;/p>
&lt;p>å¯¹äºå®¹å™¨æŠ€æœ¯è€Œè¨€ï¼Œå®ƒå®ç°èµ„æºå±‚é¢ä¸Šçš„é™åˆ¶å’Œéš”ç¦»ï¼Œä¾èµ–äº Linux å†…æ ¸æ‰€æä¾›çš„ cgroup å’Œ namespace æŠ€æœ¯ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬å…ˆå¯¹è¿™ä¸¤é¡¹æŠ€æœ¯çš„ä½œç”¨åšä¸ªæ¦‚æ‹¬ï¼š&lt;/p>
&lt;ul>
&lt;li>cgroup çš„ä¸»è¦ä½œç”¨ï¼šç®¡ç†èµ„æºçš„åˆ†é…ã€é™åˆ¶ï¼›&lt;/li>
&lt;li>namespace çš„ä¸»è¦ä½œç”¨ï¼šå°è£…æŠ½è±¡ï¼Œé™åˆ¶ï¼Œéš”ç¦»ï¼Œä½¿å‘½åç©ºé—´å†…çš„è¿›ç¨‹çœ‹èµ·æ¥æ‹¥æœ‰ä»–ä»¬è‡ªå·±çš„å…¨å±€èµ„æºï¼›&lt;/li>
&lt;/ul>
&lt;p>&lt;a href="https://zhuanlan.zhihu.com/p/434731896">åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬é‡ç‚¹èŠäº† cgroup &lt;/a>ã€‚æœ¬ç¯‡ï¼Œæˆ‘ä»¬é‡ç‚¹æ¥èŠ namespace ã€‚&lt;/p>
&lt;h2 id="namespace-æ˜¯ä»€ä¹ˆ">Namespace æ˜¯ä»€ä¹ˆï¼Ÿ&lt;/h2>
&lt;p>æˆ‘ä»¬å¼•ç”¨ &lt;a href="https://en.wikipedia.org/wiki/Linux_namespaces">wiki&lt;/a> ä¸Šå¯¹ namespace çš„å®šä¹‰ï¼š&lt;/p>
&lt;blockquote>
&lt;p>Namespaces are a feature of the Linux kernel that partitions kernel resources such that one set of processes sees one set of resources while another set of processes sees a different set of resources. The feature works by having the same namespace for a set of resources and processes, but those namespaces refer to distinct resources.&lt;/p>
&lt;/blockquote>
&lt;p>namespace æ˜¯ Linux å†…æ ¸çš„ä¸€é¡¹ç‰¹æ€§ï¼Œå®ƒå¯ä»¥å¯¹å†…æ ¸èµ„æºè¿›è¡Œåˆ†åŒºï¼Œä½¿å¾—ä¸€ç»„è¿›ç¨‹å¯ä»¥çœ‹åˆ°ä¸€ç»„èµ„æºï¼›è€Œå¦ä¸€ç»„è¿›ç¨‹å¯ä»¥çœ‹åˆ°å¦ä¸€ç»„ä¸åŒçš„èµ„æºã€‚è¯¥åŠŸèƒ½çš„åŸç†æ˜¯ä¸ºä¸€ç»„èµ„æºå’Œè¿›ç¨‹ä½¿ç”¨ç›¸åŒçš„ namespaceï¼Œä½†æ˜¯è¿™äº› namespace å®é™…ä¸Šå¼•ç”¨çš„æ˜¯ä¸åŒçš„èµ„æºã€‚&lt;/p>
&lt;p>è¿™æ ·çš„è¯´æ³•æœªå…å¤ªç»•äº†äº›ï¼Œç®€å•æ¥è¯´ namespace æ˜¯ç”± Linux å†…æ ¸æä¾›çš„ï¼Œç”¨äºè¿›ç¨‹é—´èµ„æºéš”ç¦»çš„ä¸€ç§æŠ€æœ¯ã€‚å°†å…¨å±€çš„ç³»ç»Ÿèµ„æºåŒ…è£…åœ¨ä¸€ä¸ªæŠ½è±¡é‡Œï¼Œè®©è¿›ç¨‹ï¼ˆçœ‹èµ·æ¥ï¼‰æ‹¥æœ‰ç‹¬ç«‹çš„å…¨å±€èµ„æºå®ä¾‹ã€‚åŒæ—¶ Linux ä¹Ÿé»˜è®¤æä¾›äº†å¤šç§ namespaceï¼Œç”¨äºå¯¹å¤šç§ä¸åŒèµ„æºè¿›è¡Œéš”ç¦»ã€‚&lt;/p>
&lt;p>åœ¨ä¹‹å‰ï¼Œæˆ‘ä»¬å•ç‹¬ä½¿ç”¨ namespace çš„åœºæ™¯æ¯”è¾ƒæœ‰é™ï¼Œä½† namespace å´æ˜¯å®¹å™¨åŒ–æŠ€æœ¯çš„åŸºçŸ³ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹å®ƒçš„å‘å±•å†ç¨‹ã€‚&lt;/p>
&lt;h2 id="namespace-çš„å‘å±•å†ç¨‹">Namespace çš„å‘å±•å†ç¨‹&lt;/h2>
&lt;p>&lt;img src="https://s2.loli.net/2021/12/10/rRA1dQx69butYTZ.jpg" alt="img">&lt;/p>
&lt;p>&lt;strong>å›¾ 1 ï¼Œnamespace çš„å†å²è¿‡ç¨‹&lt;/strong>&lt;/p>
&lt;h3 id="æœ€æ—©æœŸ---plan-9">æœ€æ—©æœŸ - Plan 9&lt;/h3>
&lt;p>namespace çš„æ—©æœŸæå‡ºåŠä½¿ç”¨è¦è¿½æº¯åˆ° Plan 9 from Bell Labs ï¼Œè´å°”å®éªŒå®¤çš„ Plan 9ã€‚è¿™æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼æ“ä½œç³»ç»Ÿï¼Œç”±è´å°”å®éªŒå®¤çš„è®¡ç®—ç§‘å­¦ç ”ç©¶ä¸­å¿ƒåœ¨å…«å‡ å¹´è‡³02å¹´å¼€å‘çš„ï¼ˆ02å¹´å‘å¸ƒäº†ç¨³å®šçš„ç¬¬å››ç‰ˆï¼Œè·ç¦»92å¹´å‘å¸ƒçš„ç¬¬ä¸€ä¸ªå…¬å¼€ç‰ˆæœ¬å·²10å¹´æ‰“ç£¨ï¼‰ï¼Œç°åœ¨ä»ç„¶è¢«æ“ä½œç³»ç»Ÿçš„ç ”ç©¶è€…å’Œçˆ±å¥½è€…å¼€å‘ä½¿ç”¨ã€‚åœ¨ Plan 9 çš„è®¾è®¡ä¸å®ç°ä¸­ï¼Œæˆ‘ä»¬ç€é‡æä»¥ä¸‹3ç‚¹å†…å®¹ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>æ–‡ä»¶ç³»ç»Ÿï¼šæ‰€æœ‰ç³»ç»Ÿèµ„æºéƒ½åˆ—åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œä»¥ Node æ ‡è¯†ã€‚æ‰€æœ‰çš„æ¥å£ä¹Ÿä½œä¸ºæ–‡ä»¶ç³»ç»Ÿçš„ä¸€éƒ¨åˆ†å‘ˆç°ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Namespaceï¼šèƒ½æ›´å¥½çš„åº”ç”¨åŠå±•ç¤ºæ–‡ä»¶ç³»ç»Ÿçš„å±‚æ¬¡ç»“æ„ï¼Œå®ƒå®ç°äº†æ‰€è°“çš„ â€œåˆ†ç¦»â€å’Œâ€œç‹¬ç«‹â€ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æ ‡å‡†é€šä¿¡åè®®ï¼š9Påè®®ï¼ˆStyx/9P2000ï¼‰ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://s2.loli.net/2021/12/10/ye5wSuNMnJoc6TU.jpg" alt="img">&lt;/p>
&lt;p>&lt;strong>å›¾ 2 ï¼ŒPlan 9 from Bell Labs å›¾æ ‡&lt;/strong>&lt;/p>
&lt;h3 id="å¼€å§‹åŠ å…¥-linux-kernel">å¼€å§‹åŠ å…¥ Linux Kernel&lt;/h3>
&lt;p>Namespace å¼€å§‹è¿›å…¥ Linux Kernel çš„ç‰ˆæœ¬æ˜¯åœ¨ 2.4.Xï¼Œæœ€åˆå§‹äº 2.4.19 ç‰ˆæœ¬ã€‚ä½†æ˜¯ï¼Œè‡ª 2.4.2 ç‰ˆæœ¬æ‰å¼€å§‹å®ç°æ¯ä¸ªè¿›ç¨‹çš„ namespaceã€‚&lt;/p>
&lt;p>&lt;img src="https://s2.loli.net/2021/12/10/KeakXfEFsMjoLPz.jpg" alt="img">&lt;/p>
&lt;p>&lt;strong>å›¾ 3 ï¼ŒLinux Kernel Note&lt;/strong>&lt;/p>
&lt;p>&lt;img src="https://s2.loli.net/2021/12/10/YlNU6uBeWdEJhgG.png" alt="img">&lt;/p>
&lt;p>&lt;strong>å›¾ 4 ï¼ŒLinux Kernel å¯¹åº”çš„å„æ“ä½œç³»ç»Ÿç‰ˆæœ¬&lt;/strong>&lt;/p>
&lt;h3 id="linux-38-åŸºæœ¬å®ç°">Linux 3.8 åŸºæœ¬å®ç°&lt;/h3>
&lt;p>Linux 3.8 ä¸­ç»ˆäºå®Œå…¨å®ç°äº† &lt;code>User&lt;/code> Namespace çš„ç›¸å…³åŠŸèƒ½é›†æˆåˆ°å†…æ ¸ã€‚è¿™æ · Docker åŠå…¶ä»–å®¹å™¨æŠ€æœ¯æ‰€ç”¨åˆ°çš„ namespace ç›¸å…³çš„èƒ½åŠ›å°±åŸºæœ¬éƒ½å®ç°äº†ã€‚&lt;/p>
&lt;p>&lt;img src="https://s2.loli.net/2021/12/10/5HBV3ylXepPijvD.png" alt="img">&lt;/p>
&lt;p>&lt;strong>å›¾ 5 ï¼ŒLinux Kernel ä» 2001 åˆ°2013 é€æ­¥æ¼”å˜ï¼Œå®Œæˆäº† namespace çš„å®ç°&lt;/strong>&lt;/p>
&lt;h2 id="namespace-ç±»å‹">Namespace ç±»å‹&lt;/h2>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>namespaceåç§°&lt;/th>
&lt;th>ä½¿ç”¨çš„æ ‡è¯† - Flag&lt;/th>
&lt;th>æ§åˆ¶å†…å®¹&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>Cgroup&lt;/td>
&lt;td>CLONE_NEWCGROUP&lt;/td>
&lt;td>Cgroup root directory cgroup æ ¹ç›®å½•&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>IPC&lt;/td>
&lt;td>CLONE_NEWIPC&lt;/td>
&lt;td>System V IPC, POSIX message queuesä¿¡å·é‡ï¼Œæ¶ˆæ¯é˜Ÿåˆ—&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Network&lt;/td>
&lt;td>CLONE_NEWNET&lt;/td>
&lt;td>Network devices, stacks, ports, etc.ç½‘ç»œè®¾å¤‡ï¼Œåè®®æ ˆï¼Œç«¯å£ç­‰ç­‰&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Mount&lt;/td>
&lt;td>CLONE_NEWNS&lt;/td>
&lt;td>Mount pointsæŒ‚è½½ç‚¹&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>PID&lt;/td>
&lt;td>CLONE_NEWPID&lt;/td>
&lt;td>Process IDsè¿›ç¨‹å·&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Time&lt;/td>
&lt;td>CLONE_NEWTIME&lt;/td>
&lt;td>æ—¶é’Ÿ&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>User&lt;/td>
&lt;td>CLONE_NEWUSER&lt;/td>
&lt;td>ç”¨æˆ·å’Œç»„ ID&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>UTS&lt;/td>
&lt;td>CLONE_NEWUTS&lt;/td>
&lt;td>ç³»ç»Ÿä¸»æœºåå’Œ NIS(Network Information Service) ä¸»æœºåï¼ˆæœ‰æ—¶ç§°ä¸ºåŸŸåï¼‰&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="cgroup-namespaces">Cgroup namespaces&lt;/h3>
&lt;p>Cgroup namespace æ˜¯è¿›ç¨‹çš„ cgroups çš„è™šæ‹ŸåŒ–è§†å›¾ï¼Œé€šè¿‡ &lt;code>/proc/[pid]/cgroup&lt;/code> å’Œ &lt;code>/proc/[pid]/mountinfo&lt;/code> å±•ç¤ºã€‚&lt;/p>
&lt;p>ä½¿ç”¨ cgroup namespace éœ€è¦å†…æ ¸å¼€å¯ &lt;code>CONFIG_CGROUPS&lt;/code> é€‰é¡¹ã€‚å¯é€šè¿‡ä»¥ä¸‹æ–¹å¼éªŒè¯ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="p">(&lt;/span>&lt;span class="nx">MoeLove&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="err">âœ&lt;/span> &lt;span class="nx">grep&lt;/span> &lt;span class="nx">CONFIG_CGROUPS&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="nx">boot&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="nx">config&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="err">$&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">uname&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="nx">r&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="nx">CONFIG_CGROUPS&lt;/span>&lt;span class="p">=&lt;/span>&lt;span class="nx">y&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>cgroup namespace æä¾›çš„äº†ä¸€ç³»åˆ—çš„éš”ç¦»æ”¯æŒï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>é˜²æ­¢ä¿¡æ¯æ³„æ¼ï¼ˆå®¹å™¨ä¸åº”è¯¥çœ‹åˆ°å®¹å™¨å¤–çš„ä»»ä½•ä¿¡æ¯ï¼‰ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ç®€åŒ–äº†å®¹å™¨è¿ç§»ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>é™åˆ¶å®¹å™¨è¿›ç¨‹èµ„æºï¼Œå› ä¸ºå®ƒä¼šæŠŠ cgroup æ–‡ä»¶ç³»ç»Ÿè¿›è¡ŒæŒ‚è½½ï¼Œä½¿å¾—å®¹å™¨è¿›ç¨‹æ— æ³•è·å–ä¸Šå±‚çš„è®¿é—®æƒé™ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>æ¯ä¸ª cgroup namespace éƒ½æœ‰è‡ªå·±çš„ä¸€ç»„ cgroup æ ¹ç›®å½•ã€‚è¿™äº› cgroup çš„æ ¹ç›®å½•æ˜¯åœ¨ &lt;code>/proc/[pid]/cgroup&lt;/code> æ–‡ä»¶ä¸­å¯¹åº”è®°å½•çš„ç›¸å¯¹ä½ç½®çš„åŸºç‚¹ã€‚å½“ä¸€ä¸ªè¿›ç¨‹ç”¨ &lt;code>CLONE_NEWCGROUP&lt;/code>ï¼ˆclone(2) æˆ–è€… unshare(2)ï¼‰ åˆ›å»ºä¸€ä¸ªæ–°çš„ cgroup namespaceæ—¶ï¼Œå®ƒå½“å‰çš„ cgroups çš„ç›®å½•å°±å˜æˆäº†æ–° namespace çš„ cgroup æ ¹ç›®å½•ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ cat /proc/self/cgroup
0::/user.slice/user-1000.slice/session-2.scope
&lt;/code>&lt;/pre>&lt;/div>&lt;p>å½“ä¸€ä¸ªç›®æ ‡è¿›ç¨‹ä» &lt;code>/proc/[pid]/cgroup&lt;/code> ä¸­è¯»å– cgroup å…³ç³»æ—¶ï¼Œæ¯ä¸ªè®°å½•çš„è·¯å¾„åä¼šåœ¨ç¬¬ä¸‰å­—æ®µä¸­å±•ç¤ºï¼Œä¼šå…³è”åˆ°æ­£åœ¨è¯»å–çš„è¿›ç¨‹çš„ç›¸å…³ cgroup åˆ†å±‚ç»“æ„çš„æ ¹ç›®å½•ã€‚å¦‚æœç›®æ ‡è¿›ç¨‹çš„ cgroup ç›®å½•ä½äºæ­£åœ¨è¯»å–çš„è¿›ç¨‹çš„ cgroup namespace æ ¹ç›®å½•ä¹‹å¤–æ—¶ï¼Œé‚£ä¹ˆï¼Œè·¯å¾„åç§°å°†ä¼šå¯¹æ¯ä¸ª cgroup å±‚æ¬¡ä¸­çš„ä¸Šå±‚èŠ‚ç‚¹æ˜¾ç¤º &lt;code>../&lt;/code> ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬æ¥çœ‹çœ‹ä¸‹é¢çš„ç¤ºä¾‹ï¼ˆè¿™é‡Œä»¥ cgroup v1 ä¸ºä¾‹ï¼Œå¦‚æœä½ æƒ³çœ‹ v2 ç‰ˆæœ¬çš„ç¤ºä¾‹ï¼Œè¯·åœ¨ç•™è¨€ä¸­å‘Šè¯‰æˆ‘ï¼‰ï¼š&lt;/p>
&lt;ol>
&lt;li>åœ¨åˆå§‹çš„ cgroup namespace ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ root ï¼ˆæˆ–è€…æœ‰ root æƒé™çš„ç”¨æˆ·ï¼‰ï¼Œåœ¨ freezer å±‚ä¸‹åˆ›å»ºä¸€ä¸ªå­ cgroup åä¸º &lt;code>moelove-sub&lt;/code>ï¼ŒåŒæ—¶ï¼Œå°†è¿›ç¨‹æ”¾å…¥è¯¥ cgroup è¿›è¡Œé™åˆ¶ã€‚&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-plain" data-lang="plain">(MoeLove) âœ mkdir -p /sys/fs/cgroup/freezer/moelove-sub
(MoeLove) âœ sleep 6666666 &amp;amp;
[1] 1489125
(MoeLove) âœ echo 1489125 &amp;gt; /sys/fs/cgroup/freezer/moelove-sub/cgroup.procs
&lt;/code>&lt;/pre>&lt;/div>&lt;ol start="2">
&lt;li>æˆ‘ä»¬åœ¨ freezer å±‚ä¸‹åˆ›å»ºå¦å¤–ä¸€ä¸ªå­ cgroupï¼Œåä¸º &lt;code>moelove-sub2&lt;/code>ï¼Œ å¹¶ä¸”å†æ”¾å…¥æ‰§è¡Œè¿›ç¨‹å·ã€‚å¯ä»¥çœ‹åˆ°å½“å‰çš„è¿›ç¨‹å·²ç»çº³å…¥åˆ° &lt;code>moelove-sub2&lt;/code>çš„ cgroup ä¸‹ç®¡ç†äº†ã€‚&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-plain" data-lang="plain">(MoeLove) âœ mkdir -p /sys/fs/cgroup/freezer/moelove-sub2
(MoeLove) âœ echo $$
1488899
(MoeLove) âœ echo 1488899 &amp;gt; /sys/fs/cgroup/freezer/moelove-sub2/cgroup.procs
(MoeLove) âœ cat /proc/self/cgroup |grep freezer
7:freezer:/moelove-sub2
&lt;/code>&lt;/pre>&lt;/div>&lt;ol start="3">
&lt;li>æˆ‘ä»¬ä½¿ç”¨ &lt;code>unshare(1)&lt;/code> åˆ›å»ºä¸€ä¸ªè¿›ç¨‹ï¼Œè¿™é‡Œä½¿ç”¨äº† &lt;code>-C&lt;/code>å‚æ•°è¡¨ç¤ºæ˜¯æ–°çš„ cgroup namespaceï¼Œ ä½¿ç”¨äº† &lt;code>-m&lt;/code>å‚æ•°è¡¨ç¤ºæ˜¯æ–°çš„ mount namespaceã€‚&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-plain" data-lang="plain">(MoeLove) âœ unshare -Cm bash
root@moelove:~#
&lt;/code>&lt;/pre>&lt;/div>&lt;ol start="4">
&lt;li>ä»ç”¨ unshare(1) å¯åŠ¨çš„æ–° shell ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ &lt;code>/proc/[pid]/cgroup&lt;/code> æ–‡ä»¶ä¸­çœ‹åˆ°ï¼Œæ–° shell å’Œä»¥ä¸Šç¤ºä¾‹ä¸­çš„è¿›ç¨‹ï¼š&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-plain" data-lang="plain">root@moelove:~# cat /proc/self/cgroup | grep freezer
7:freezer:/
root@moelove:~# cat /proc/1/cgroup | grep freezer
7:freezer:/..
# ç¬¬ä¸€ä¸ªç¤ºä¾‹è¿›ç¨‹
root@moelove:~# cat /proc/1489125/cgroup | grep freezer
7:freezer:/../moelove-sub
&lt;/code>&lt;/pre>&lt;/div>&lt;ol start="5">
&lt;li>ä»ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ–° shell çš„ freezer cgroup å…³ç³»ä¸­ï¼Œå½“æ–°çš„ cgroup namespace åˆ›å»ºæ—¶ï¼Œfreezer cgroup çš„æ ¹ç›®å½•ä¸å®ƒçš„å…³ç³»ä¹Ÿå°±å»ºç«‹äº†ã€‚&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-plain" data-lang="plain">root@moelove:~# cat /proc/self/mountinfo | grep freezer
1238 1230 0:37 /.. /sys/fs/cgroup/freezer rw,nosuid,nodev,noexec,relatime - cgroup cgroup rw,freezer
&lt;/code>&lt;/pre>&lt;/div>&lt;ol start="6">
&lt;li>ç¬¬å››ä¸ªå­—æ®µ ( &lt;code>/..&lt;/code>) æ˜¾ç¤ºäº†åœ¨ cgroup æ–‡ä»¶ç³»ç»Ÿä¸­çš„æŒ‚è½½ç›®å½•ã€‚ä» cgroup namespaces çš„å®šä¹‰ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œè¿›ç¨‹å½“å‰çš„ freezer cgroup ç›®å½•å˜æˆäº†å®ƒçš„æ ¹ç›®å½•ï¼Œæ‰€ä»¥è¿™ä¸ªå­—æ®µæ˜¾ç¤º &lt;code>/..&lt;/code> ã€‚æˆ‘ä»¬å¯ä»¥é‡æ–°æŒ‚è½½æ¥å¤„ç†å®ƒã€‚&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-plain" data-lang="plain">root@moelove:~# mount --make-rslave /
root@moelove:~# umount /sys/fs/cgroup/freezer
root@moelove:~# mount -t cgroup -o freezer freezer /sys/fs/cgroup/freezer
root@moelove:~# cat /proc/self/mountinfo | grep freezer
1238 1230 0:37 / /sys/fs/cgroup/freezer rw,relatime - cgroup freezer rw,freezer
root@moelove:~# mount |grep freezer
freezer on /sys/fs/cgroup/freezer type cgroup (rw,relatime,freezer)
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="ipc-namespaces">IPC namespaces&lt;/h3>
&lt;p>IPC namespaces éš”ç¦»äº† IPC èµ„æºï¼Œå¦‚ System V IPC objectsã€ POSIX message queuesã€‚æ¯ä¸ª IPC namespace éƒ½æœ‰ç€è‡ªå·±çš„ä¸€ç»„ System V IPC æ ‡è¯†ç¬¦ï¼Œä»¥åŠ POSIX æ¶ˆæ¯é˜Ÿåˆ—ç³»ç»Ÿã€‚åœ¨ä¸€ä¸ª IPC namespace ä¸­åˆ›å»ºçš„å¯¹è±¡ï¼Œå¯¹æ‰€æœ‰è¯¥ namespace ä¸‹çš„æˆå‘˜å‡å¯è§ï¼ˆå¯¹å…¶ä»– namespace ä¸‹çš„æˆå‘˜å‡ä¸å¯è§ï¼‰ã€‚&lt;/p>
&lt;p>ä½¿ç”¨ IPC namespace éœ€è¦å†…æ ¸æ”¯æŒ CONFIG_IPC_NS é€‰é¡¹ã€‚å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="p">(&lt;/span>&lt;span class="nx">MoeLove&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="err">âœ&lt;/span> &lt;span class="nx">grep&lt;/span> &lt;span class="nx">CONFIG_IPC_NS&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="nx">boot&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="nx">config&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="err">$&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">uname&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="nx">r&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="nx">CONFIG_IPC_NS&lt;/span>&lt;span class="p">=&lt;/span>&lt;span class="nx">y&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¯ä»¥åœ¨ IPC namespace ä¸­è®¾ç½®ä»¥ä¸‹ &lt;code>/proc&lt;/code> æ¥å£ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;code>/proc/sys/fs/mqueue&lt;/code> - POSIX æ¶ˆæ¯é˜Ÿåˆ—æ¥å£&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>/proc/sys/kernel&lt;/code> - System V IPC æ¥å£ ï¼ˆmsgmax, msgmnb, msgmni, sem, shmall, shmmax, shmmni, shm_rmid_forcedï¼‰&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>/proc/sysvipc&lt;/code> - System V IPC æ¥å£&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>å½“ IPC namespace è¢«é”€æ¯æ—¶ï¼ˆç©ºé—´é‡Œçš„æœ€åä¸€ä¸ªè¿›ç¨‹éƒ½è¢«åœæ­¢åˆ é™¤æ—¶ï¼‰ï¼Œåœ¨ IPC namespace ä¸­åˆ›å»ºçš„ object ä¹Ÿä¼šè¢«é”€æ¯ã€‚&lt;/p>
&lt;h3 id="network-namepaces">Network namepaces&lt;/h3>
&lt;p>Network namespaces éš”ç¦»äº†ä¸ç½‘ç»œç›¸å…³çš„ç³»ç»Ÿèµ„æºï¼ˆè¿™é‡Œç½—åˆ—ä¸€äº›ï¼‰ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>network devices - ç½‘ç»œè®¾å¤‡&lt;/p>
&lt;/li>
&lt;li>
&lt;p>IPv4 and IPv6 protocol stacks - IPv4ã€IPv6 çš„åè®®æ ˆ&lt;/p>
&lt;/li>
&lt;li>
&lt;p>IP routing tables - IP è·¯ç”±è¡¨&lt;/p>
&lt;/li>
&lt;li>
&lt;p>firewall rules - é˜²ç«å¢™è§„åˆ™&lt;/p>
&lt;/li>
&lt;li>
&lt;p>/proc/net ï¼ˆå³ /proc/PID/netï¼‰&lt;/p>
&lt;/li>
&lt;li>
&lt;p>/sys/class/net&lt;/p>
&lt;/li>
&lt;li>
&lt;p>/proc/sys/net ç›®å½•ä¸‹çš„æ–‡ä»¶&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ç«¯å£ã€socket&lt;/p>
&lt;/li>
&lt;li>
&lt;p>UNIX domain abstract socket namespace&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>ä½¿ç”¨ Network namespaces éœ€è¦å†…æ ¸æ”¯æŒ CONFIG_NET_NS é€‰é¡¹ã€‚å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ grep CONFIG_NET_NS /boot/config-&lt;span class="k">$(&lt;/span>uname -r&lt;span class="k">)&lt;/span>
&lt;span class="nv">CONFIG_NET_NS&lt;/span>&lt;span class="o">=&lt;/span>y
&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¸€ä¸ªç‰©ç†ç½‘ç»œè®¾å¤‡åªèƒ½å­˜åœ¨äºä¸€ä¸ª Network namespace ä¸­ã€‚å½“ä¸€ä¸ª Network namespace è¢«é‡Šæ”¾æ—¶ï¼ˆç©ºé—´é‡Œçš„æœ€åä¸€ä¸ªè¿›ç¨‹éƒ½è¢«åœæ­¢åˆ é™¤æ—¶ï¼‰ï¼Œç‰©ç†ç½‘ç»œè®¾å¤‡å°†è¢«ç§»åŠ¨åˆ°åˆå§‹çš„ Network namespace è€Œä¸æ˜¯ä¸Šå±‚çš„ Network namespaceã€‚&lt;/p>
&lt;p>ä¸€ä¸ªè™šæ‹Ÿçš„ç½‘ç»œè®¾å¤‡(veth(4)) ï¼Œåœ¨ Network namespace é—´é€šè¿‡ä¸€ä¸ªç±»ä¼¼ç®¡é“çš„æ–¹å¼è¿›è¡Œè¿æ¥ã€‚è¿™ä½¿å¾—å®ƒèƒ½å­˜åœ¨äºå¤šä¸ª Network namespaceï¼Œä½†æ˜¯ï¼Œå½“ Network namespace è¢«æ‘§æ¯æ—¶ï¼Œè¯¥ç©ºé—´ä¸‹åŒ…å«çš„ veth(4) è®¾å¤‡å¯èƒ½è¢«ç ´åã€‚&lt;/p>
&lt;h3 id="mount-namespaces">Mount namespaces&lt;/h3>
&lt;p>Mount namespaces æœ€æ—©å‡ºç°åœ¨ Linux 2.4.19 ç‰ˆæœ¬ã€‚Mount namespaces éš”ç¦»äº†å„ç©ºé—´ä¸­æŒ‚è½½çš„è¿›ç¨‹å®ä¾‹ã€‚æ¯ä¸ª mount namespace çš„å®ä¾‹ä¸‹çš„è¿›ç¨‹ä¼šçœ‹åˆ°ä¸åŒçš„ç›®å½•å±‚æ¬¡ç»“æ„ã€‚&lt;/p>
&lt;p>æ¯ä¸ªè¿›ç¨‹åœ¨ mount namespace ä¸­çš„æè¿°å¯ä»¥åœ¨ä¸‹é¢çš„æ–‡ä»¶è§†å›¾ä¸­çœ‹åˆ°ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;code>/proc/[pid]/mounts&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>/proc/[pid]/mountinfo&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>/proc/[pid]/mountstats&lt;/code>&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>ä¸€ä¸ªæ–°çš„ Mount namespace çš„åˆ›å»ºæ ‡è¯†æ˜¯ CLONE_NEWNS ï¼Œä½¿ç”¨äº† clone(2) æˆ–è€… unshare(2) ã€‚&lt;/p>
&lt;ul>
&lt;li>å¦‚æœ Mount namespace ç”¨ clone(2) åˆ›å»ºï¼Œå­ namespace çš„æŒ‚è½½åˆ—è¡¨æ˜¯ä»çˆ¶è¿›ç¨‹çš„ mount namespace æ‹·è´çš„ã€‚&lt;/li>
&lt;li>å¦‚æœ Mount namespace ç”¨ unshare(2) åˆ›å»ºï¼Œæ–° namespace çš„æŒ‚è½½åˆ—è¡¨æ˜¯ä»è°ƒç”¨è€…ä¹‹å‰çš„ moun namespace æ‹·è´çš„ã€‚&lt;/li>
&lt;/ul>
&lt;p>å¦‚æœ mount namespace å‘ç”Ÿäº†ä¿®æ”¹ï¼Œä¼šå¼•èµ·ä»€ä¹ˆæ ·çš„è¿é”ååº”ï¼Ÿä¸‹é¢ï¼Œæˆ‘ä»¬å°±åœ¨ &lt;strong>å…±äº«å­æ ‘&lt;/strong>ä¸­è°ˆè°ˆã€‚&lt;/p>
&lt;p>æ¯ä¸ª mount éƒ½è¢«å¯ä»¥æœ‰å¦‚ä¸‹æ ‡è®° ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>MS_SHARED - ä¸ç»„å†…æ¯ä¸ªæˆå‘˜åˆ†äº« events ã€‚ä¹Ÿå°±æ˜¯è¯´ç›¸åŒçš„ mount æˆ–è€… unmount å°†è‡ªåŠ¨å‘ç”Ÿåœ¨ç»„å†…å…¶ä»–çš„ mounts ä¸­ã€‚åä¹‹ï¼Œmount æˆ–è€… unmount äº‹ä»¶ ä¹Ÿä¼šå½±å“è¿™æ¬¡çš„ event åŠ¨ä½œã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>MS_PRIVATE - è¿™ä¸ª mount æ˜¯ç§æœ‰çš„ã€‚mount æˆ–è€… unmount events éƒ½ä¸ä¼šå½±å“è¿™æ¬¡çš„ event åŠ¨ä½œã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>MS_SLAVE - mount æˆ–è€… unmount events ä¼šä» master èŠ‚ç‚¹ä¼ å…¥å½±å“è¯¥èŠ‚ç‚¹ã€‚ä½†æ˜¯è¿™ä¸ªèŠ‚ç‚¹ä¸‹çš„ mount æˆ–è€… unmount events ä¸ä¼šå½±å“ç»„å†…çš„å…¶ä»–èŠ‚ç‚¹ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>MS_UNBINDABLE - è¿™ä¹Ÿæ˜¯ä¸ªç§æœ‰çš„ mount ã€‚ä»»ä½•å°è¯•ç»‘å®šçš„ mount åœ¨è¿™ä¸ªè®¾ç½®ä¸‹éƒ½å°†å¤±è´¥ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>åœ¨æ–‡ä»¶ &lt;code>/proc/[pid]/mountinfo&lt;/code> ä¸­å¯ä»¥çœ‹åˆ° &lt;code>propagation&lt;/code> ç±»å‹çš„å­—æ®µã€‚æ¯ä¸ªå¯¹ç­‰ç»„éƒ½ä¼šç”±å†…æ ¸ç”Ÿæˆå”¯ä¸€çš„ ID ï¼ŒåŒä¸€å¯¹ç­‰ç»„çš„ mount éƒ½æ˜¯è¿™ä¸ª IDï¼ˆå³ï¼Œä¸‹æ–‡ä¸­çš„ X ï¼‰ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ cat /proc/self/mountinfo &lt;span class="p">|&lt;/span>grep root
&lt;span class="m">65&lt;/span> &lt;span class="m">1&lt;/span> 0:33 /root / rw,relatime shared:1 - btrfs /dev/nvme0n1p6 rw,seclabel,compress&lt;span class="o">=&lt;/span>zstd:1,ssd,space_cache,subvolid&lt;span class="o">=&lt;/span>256,subvol&lt;span class="o">=&lt;/span>/root
&lt;span class="m">1210&lt;/span> &lt;span class="m">65&lt;/span> 0:33 /root/var/lib/docker/btrfs /var/lib/docker/btrfs rw,relatime shared:1 - btrfs /dev/nvme0n1p6 rw,seclabel,compress&lt;span class="o">=&lt;/span>zstd:1,ssd,space_cache,subvolid&lt;span class="o">=&lt;/span>256,subvol&lt;span class="o">=&lt;/span>/root
&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>
&lt;p>shared:X - åœ¨ç»„ X ä¸­å…±äº«ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>master:X - å¯¹äºç»„ X è€Œè¨€æ˜¯ slaveï¼Œå³ï¼Œä»å±äº ID ä¸º X çš„ä¸»ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>propagate_from:X - æ¥æ”¶ä»ç»„ X å‘å‡ºçš„å…±äº« mountã€‚è¿™ä¸ªæ ‡ç­¾æ€»æ˜¯ä¸ª master:X ä¸€åŒå‡ºç°ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>unbindable - è¡¨ç¤ºä¸èƒ½è¢«ç»‘å®šï¼Œå³ï¼Œä¸ä¸å…¶ä»–å…³è”ä»å±ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>æ–° mount namespace çš„ä¼ æ’­ç±»å‹å–å†³äºå®ƒçš„çˆ¶èŠ‚ç‚¹ã€‚å¦‚æœçˆ¶èŠ‚ç‚¹çš„ä¼ æ’­ç±»å‹æ˜¯ MS_SHARED ï¼Œé‚£ä¹ˆæ–° mount namespace çš„ä¼ æ’­ç±»å‹æ˜¯ MS_SHARED ï¼Œä¸ç„¶ä¼šé»˜è®¤ä¸º MS_PRIVATEã€‚&lt;/p>
&lt;p>å…³äº mount namespaces æˆ‘ä»¬è¿˜éœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š&lt;/p>
&lt;p>ï¼ˆ1ï¼‰æ¯ä¸ª mount namespace éƒ½æœ‰ä¸€ä¸ª owner user namespaceã€‚å¦‚æœæ–°çš„ mount namespace å’Œæ‹·è´çš„ mount namespace åˆ†å±äºä¸åŒçš„ user namespace ï¼Œé‚£ä¹ˆï¼Œæ–°çš„ mount namespace ä¼˜å…ˆçº§ä½ã€‚&lt;/p>
&lt;p>ï¼ˆ2ï¼‰å½“åˆ›å»ºçš„ mount namespace ä¼˜å…ˆçº§ä½æ—¶ï¼Œé‚£ä¹ˆï¼Œslave çš„ mount events ä¼šä¼˜å…ˆäº shared çš„ mount eventsã€‚&lt;/p>
&lt;p>ï¼ˆ3ï¼‰é«˜ä¼˜å…ˆçº§å’Œä½ä¼˜å…ˆçº§çš„ mount namespace æœ‰å…³è”è¢«é”å®šåœ¨ä¸€èµ·æ—¶ï¼Œä»–ä»¬éƒ½ä¸èƒ½è¢«å•ç‹¬å¸è½½ã€‚&lt;/p>
&lt;p>ï¼ˆ4ï¼‰mount(2) æ ‡è¯†å’Œ atime æ ‡è¯†ä¼šè¢«é”å®šï¼Œå³ï¼Œä¸èƒ½è¢«ä¼ æ’­å½±å“è€Œä¿®æ”¹ã€‚&lt;/p>
&lt;h2 id="å°ç»“">å°ç»“&lt;/h2>
&lt;p>ä»¥ä¸Šå°±æ˜¯å…³äº Linux å†…æ ¸ä¸­ namespace çš„ä¸€äº›ä»‹ç»äº†ï¼Œç¯‡å¹…åŸå› ï¼Œå‰©ä½™éƒ¨åˆ†ä»¥åŠ namespace åœ¨å®¹å™¨ä¸­çš„åº”ç”¨æˆ‘ä»¬æ”¾åœ¨ä¸‹ä¸€ç¯‡ä¸­ä»‹ç»ï¼Œæ•¬è¯·æœŸå¾…ï¼&lt;/p>
&lt;hr>
&lt;p>æ¬¢è¿è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://gitee.com/tlrr/awesome/raw/master/2020-9-9/1599632564572-mp-qrcode.png" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| Kubernetes v1.23.0 æ­£å¼å‘å¸ƒï¼Œæ–°ç‰¹æ€§ä¸€è§ˆ</title><link>https://moelove.info/2021/12/08/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Kubernetes-v1.23.0-%E6%AD%A3%E5%BC%8F%E5%8F%91%E5%B8%83%E6%96%B0%E7%89%B9%E6%80%A7%E4%B8%80%E8%A7%88/</link><guid isPermaLink="true">https://moelove.info/2021/12/08/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Kubernetes-v1.23.0-%E6%AD%A3%E5%BC%8F%E5%8F%91%E5%B8%83%E6%96%B0%E7%89%B9%E6%80%A7%E4%B8%80%E8%A7%88/</guid><pubDate>Wed, 08 Dec 2021 03:50:29 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container" title="k8sç”Ÿæ€">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;p>Kubernetes v1.23 å³å°†å‘å¸ƒï¼Œè¿™æ˜¯ 2021 å¹´å‘å¸ƒçš„ç¬¬ä¸‰ä¸ªç‰ˆæœ¬ï¼Œä¹Ÿæ˜¯ä»Šå¹´æœ€åä¸€ä¸ªæ­£å¼å‘å¸ƒçš„ç‰ˆæœ¬ã€‚&lt;/p>
&lt;p>æ­¤ç‰ˆæœ¬ä¸­ä¸»è¦åŒ…æ‹¬ 47 é¡¹å¢å¼ºæ›´æ–°ï¼Œå…¶ä¸­ 11 é¡¹è¾¾åˆ° stable, 17 é¡¹è¾¾åˆ° beta è¿˜æœ‰ 19 é¡¹è¾¾åˆ° alpha ã€‚ å½“ç„¶ï¼Œä¹Ÿæœ‰ 1 é¡¹è¢«æ ‡è®°ä¸ºåºŸå¼ƒã€‚ç›¸æ¯”äº v1.22 ä»æ•°é‡ä¸Šæ¥è¯´æ˜¯å°‘äº†ä¸€ç‚¹ï¼ˆv1.22 æœ‰ 53 é¡¹å¢å¼ºæ›´æ–°ï¼‰ï¼Œä½†è¿™å¹¶ä¸å½±å“è¿™æ˜¯ä¸€ä¸ªå¾ˆæ£’çš„ç‰ˆæœ¬ï¼&lt;/p>
&lt;p>åœ¨ Kubernetes çš„å‘å¸ƒå‘¨æœŸå˜æ›´ä¸º &lt;strong>æ¯4ä¸ªæœˆä¸€ä¸ªç‰ˆæœ¬&lt;/strong> åï¼Œå¾ˆæ˜æ˜¾çš„æ„Ÿè§‰å°±æ˜¯ä¸ç”¨åœ¨å‡çº§ä¸Šé¢èŠ±è´¹å¤ªå¤šæ—¶é—´äº†ï¼Œæ¯•ç«Ÿ Kubernetes çš„å‡çº§æ“ä½œæ˜¯ä¸ªä½“åŠ›æ´»ï¼Œå¤§å®¶è§‰å¾—å‘¢ï¼Ÿ&lt;/p>
&lt;p>æˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹è¿™ä¸ªç‰ˆæœ¬ä¸­æœ‰å“ªäº›å€¼å¾—å…³æ³¨çš„å˜æ›´å§ï¼&lt;/p>
&lt;h1 id="æ–°å¢-kubectl-alpha-events-å‘½ä»¤">æ–°å¢ kubectl alpha events å‘½ä»¤&lt;/h1>
&lt;p>åœ¨ä¹‹å‰çš„ ã€ŠK8S ç”Ÿæ€å‘¨æŠ¥| Helm æ–°ç‰ˆæœ¬å‘å¸ƒå¢å¼ºå¯¹ OCI çš„æ”¯æŒã€‹ æ–‡ç« çš„ä¸Šæ¸¸è¿›å±•ä¸­æˆ‘æ›¾ä¸ºå¤§å®¶ä»‹ç»äº†è¯¥åŠŸèƒ½ã€‚å®ƒæ˜¯æŒ‰ç…§ &lt;a href="https://github.com/kubernetes/enhancements/issues/1440">KEP #1440&lt;/a> å®æ–½çš„ã€‚&lt;/p>
&lt;blockquote>
&lt;p>å¢åŠ æ­¤å‘½ä»¤ä¸»è¦æ˜¯ç”±äºåœ¨ä¸ä¿®æ”¹ &lt;code>kubectl get&lt;/code> çš„å‰æä¸‹ï¼ŒæŸ¥çœ‹ &lt;code>event&lt;/code> æœ‰ä¸€äº›é™åˆ¶ï¼Œæ‰€ä»¥ç›´æ¥å¢åŠ  &lt;code>kubectl events&lt;/code> å‘½ä»¤å¯ä»¥æ›´æ–¹ä¾¿çš„å»è·å–åˆ°éœ€è¦çš„ä¿¡æ¯ï¼Œå°¤å…¶æ˜¯ event æ˜¯åœ¨ Kubernetes ä¸­ç»å¸¸éœ€è¦æŸ¥çœ‹çš„ä¸€ä¸ªä¿¡æ¯ã€‚&lt;code>kubectl get events&lt;/code> æ¯”è¾ƒå…¸å‹çš„ä¸€äº›é—®é¢˜, æ¯”å¦‚æ’åºï¼ˆè™½ç„¶å¯ä»¥é€šè¿‡åŠ å‚æ•°è§£å†³ï¼‰ï¼Œ watchï¼Œä»¥åŠæ— æ³•æŒ‰ç…§æ—¶é—´çº¿æ–¹å¼å»æŸ¥çœ‹ events ç­‰ã€‚&lt;/p>
&lt;/blockquote>
&lt;p>æˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªå‘½ä»¤å…·ä½“å¦‚ä½•ä½¿ç”¨ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬å…ˆæ¥åˆ›å»ºä¸¤ä¸ª Podï¼Œåˆ†åˆ«å« &lt;code>redis&lt;/code> å’Œ &lt;code>redis2&lt;/code> ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ kubectl run redis --image&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;ghcr.io/tao12345666333/redis:alpine&amp;#34;&lt;/span>
pod/redis created
&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ kubectl run redis2 --image&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;ghcr.io/tao12345666333/redis:alpine&amp;#34;&lt;/span>
pod/redis2 created
&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ kubectl get pods
NAME READY STATUS RESTARTS AGE
redis 1/1 Running &lt;span class="m">0&lt;/span> 12m
redis2 1/1 Running &lt;span class="m">0&lt;/span> 2m23s
&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ‰§è¡Œ &lt;code>kubectl alpha events&lt;/code> å¯ä»¥çœ‹åˆ°å½“å‰ namespace ä¸‹çš„æ‰€æœ‰ events ã€‚å¦‚æœå¢åŠ  &lt;code>--for&lt;/code> æ¡ä»¶å¯ä»¥ç”¨æ¥ç­›é€‰åªå±•ç¤ºç‰¹å®šèµ„æºç›¸å…³çš„ events ã€‚åŒæ—¶ &lt;strong>é»˜è®¤æƒ…å†µä¸‹å°±æ˜¯æŒ‰æ—¶é—´æ’åºçš„&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ kubectl alpha events
LAST SEEN TYPE REASON OBJECT MESSAGE
12m Normal Scheduled Pod/redis Successfully assigned default/redis to kind-control-plane
12m Normal Pulling Pod/redis Pulling image &lt;span class="s2">&amp;#34;ghcr.io/tao12345666333/redis:alpine&amp;#34;&lt;/span>
12m Normal Pulled Pod/redis Successfully pulled image &lt;span class="s2">&amp;#34;ghcr.io/tao12345666333/redis:alpine&amp;#34;&lt;/span> in 4.028873745s
12m Normal Created Pod/redis Created container redis
12m Normal Started Pod/redis Started container redis
3m5s Normal Scheduled Pod/redis2 Successfully assigned default/redis2 to kind-control-plane
3m5s Normal Pulled Pod/redis2 Container image &lt;span class="s2">&amp;#34;ghcr.io/tao12345666333/redis:alpine&amp;#34;&lt;/span> already present on machine
3m4s Normal Created Pod/redis2 Created container redis2
3m4s Normal Started Pod/redis2 Started container redis2
&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ kubectl alpha events --for pod/redis2
LAST SEEN TYPE REASON OBJECT MESSAGE
3m23s Normal Scheduled Pod/redis2 Successfully assigned default/redis2 to kind-control-plane
3m23s Normal Pulled Pod/redis2 Container image &lt;span class="s2">&amp;#34;ghcr.io/tao12345666333/redis:alpine&amp;#34;&lt;/span> already present on machine
3m22s Normal Created Pod/redis2 Created container redis2
3m22s Normal Started Pod/redis2 Started container redis2
&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="ipv4ipv6-åŒæ ˆæ”¯æŒè¾¾åˆ°-ga">IPv4/IPv6 åŒæ ˆæ”¯æŒè¾¾åˆ° GA&lt;/h1>
&lt;p>åœ¨é…ç½®åŒæ ˆç½‘ç»œçš„ Kubernetes æ—¶ï¼Œéœ€è¦åŒæ—¶æŒ‡å®š &lt;code>--node-cidr-mask-size-ipv4&lt;/code> å’Œ &lt;code>--node-cidr-mask-size-ipv6&lt;/code> ä»¥ä¾¿äºè®¾ç½®æ¯ä¸ª Node ä¸Šçš„å­ç½‘å¤§å°ã€‚åœ¨æ­¤ä¹‹å‰æˆ‘ä»¬éƒ½æ˜¯ç›´æ¥ä½¿ç”¨ &lt;code> --node-cidr-mask-size&lt;/code> è¿›è¡Œè®¾ç½®å³å¯ã€‚&lt;/p>
&lt;p>å¦‚æœæˆ‘ä»¬ä»ç„¶ä½¿ç”¨å•æ ˆ Kubernetes é›†ç¾¤çš„è¯ï¼Œæ­£å¸¸æ¥è¯´ä¸éœ€è¦åšä»€ä¹ˆè°ƒæ•´ï¼Œå½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸Šé¢æåˆ°çš„é€‰é¡¹ï¼Œæ¥å•ç‹¬è®¾ç½®é›†ç¾¤çš„ IPv4/IPv6 å­ç½‘ã€‚&lt;/p>
&lt;h1 id="podsecurity-admission-è¾¾åˆ°-beta">PodSecurity Admission è¾¾åˆ° Beta&lt;/h1>
&lt;p>PodSecurity Admission æ˜¯ä¹‹å‰çš„ PSP çš„ä»£æ›¿ï¼Œå…³äº Kubernetes Admission å¯ä»¥å‚è€ƒæˆ‘ä¹‹å‰çš„æ–‡ç«  ã€Šç†æ¸… Kubernetes ä¸­ Admission æœºåˆ¶ã€‹ï¼Œè¿™é‡Œå°±ä¸å±•å¼€äº†ã€‚&lt;/p>
&lt;h1 id="ingressclass-æ”¯æŒ-namespace-çº§åˆ«çš„å‚æ•°">IngressClass æ”¯æŒ namespace çº§åˆ«çš„å‚æ•°&lt;/h1>
&lt;p>&lt;code>IngressClass.Spec.Parameters.Namespace&lt;/code> å­—æ®µå½“å‰è¾¾åˆ° GA ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ä¸º IngressClass è®¾ç½®å‚æ•°ä¸º namespace çº§åˆ«äº†ã€‚æ¯”å¦‚ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">networking.k8s.io/v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">IngressClass&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">external-lb&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">controller&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">example.com/ingress-controller&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">parameters&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">apiGroup&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">k8s.example.com&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">IngressParameters&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">external-lb&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">namespace&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">external-configuration&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">scope&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Namespace&lt;/span>&lt;span class="w">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="probe-ä¸­å¢åŠ -grpc-åè®®çš„æ”¯æŒ">Probe ä¸­å¢åŠ  gRPC åè®®çš„æ”¯æŒ&lt;/h1>
&lt;p>é€šè¿‡ KEP #2727 ï¼Œåœ¨æ­¤ç‰ˆæœ¬ä¸­ä¸º Pod.Spec.Container.{Liveness,Readiness,Startup} çš„ Probe æ·»åŠ äº† gRPC åè®®çš„æ”¯æŒã€‚ ä¾‹å¦‚ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="nt">readinessProbe&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">grpc&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">port&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">9090&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">service&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">moelove-service&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">initialDelaySeconds&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">5&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">periodSeconds&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">10&lt;/span>&lt;span class="w">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¯é€šè¿‡ &lt;code>GRPCContainerProbe&lt;/code> feature gate å¼€å¯æ­¤ç‰¹æ€§ã€‚å…·ä½“ç»†èŠ‚å¯å‚è€ƒ &lt;a href="https://github.com/kubernetes/kubernetes/pull/106463">#106463&lt;/a>&lt;/p>
&lt;h1 id="æ–°å¢-openapi-v3">æ–°å¢ OpenAPI V3&lt;/h1>
&lt;p>è¿™ä¸ªç‰¹æ€§æ˜¯ Alpha çº§åˆ«ï¼Œå¯é€šè¿‡ &lt;code>OpenApiv3&lt;/code> feature gate è¿›è¡Œå¼€å¯ã€‚&lt;/p>
&lt;p>å¢åŠ æ­¤ç‰¹æ€§ä¸»è¦æ˜¯ç”±äº CRD ç›®å‰å¯é€šè¿‡ OpenApi V3 è¿›è¡Œå®šä¹‰ï¼Œä½†æ˜¯ api-server ç›®å‰è¿˜ä¸æ”¯æŒã€‚å½“ä» OpenApi V3 è½¬æ¢ä¸º V2 æ—¶ï¼Œéƒ¨åˆ†ä¿¡æ¯å°†ä¼šä¸¢å¤±ã€‚&lt;/p>
&lt;p>æ›´å¤šè¯¦ç»†ä¿¡æ¯å¯å‚è€ƒ &lt;a href="https://github.com/kubernetes/enhancements/issues/2896">KEP #2896&lt;/a>&lt;/p>
&lt;h1 id="crd-validation-è¡¨è¾¾å¼è¯­è¨€">CRD Validation è¡¨è¾¾å¼è¯­è¨€&lt;/h1>
&lt;p>è¿™æ˜¯ä¸€é¡¹ Alpha çº§åˆ«çš„ç‰¹æ€§ï¼Œé»˜è®¤æ˜¯ä¸å¼€å¯çš„ã€‚å¯é€šè¿‡å¢åŠ  &lt;code>CustomResourceValidationExpressions&lt;/code> feature gate æ¥è¿›è¡Œå¼€å¯ã€‚å•ç‹¬ä»‹ç»æ­¤ Alpha çº§åˆ«çš„ç‰¹æ€§æ˜¯å› ä¸ºç›®å‰åŸºäº Custom Resource Definitions (CRDs) çš„æ–¹å¼å¯¹ Kubernetes è¿›è¡Œæ‰©å±•å·²ç»æˆä¸ºä¸»æµï¼Œä½†æ˜¯åœ¨ CRD ä¸­ç›®å‰èƒ½æ·»åŠ çš„æ ¡éªŒè§„åˆ™æœ‰é™ï¼Œæ›´å¤šçš„åœºæ™¯éƒ½éœ€è¦é€šè¿‡é¢å¤–çš„ Admission æ¥å®Œæˆã€‚&lt;/p>
&lt;p>æ­¤åŠŸèƒ½ä½¿ç”¨ä¸€ç§å«åš Common Expression Language (CEL) çš„è¯­è¨€è¿›è¡Œè§„åˆ™å®šä¹‰ï¼Œé€šè¿‡ &lt;code>x-kubernetes-validation-rules&lt;/code> å­—æ®µè¿›è¡Œè§„åˆ™çš„æ·»åŠ ã€‚&lt;/p>
&lt;p>ä¾‹å¦‚ï¼ŒæŸä¸ª CRDs çš„å†…å®¹å¦‚ä¸‹ï¼Œå…¶ä¸­å®šä¹‰äº† &lt;code>minReplicas&lt;/code> å°äº &lt;code>replicas&lt;/code> å¹¶ä¸” &lt;code>replicas&lt;/code> å°äº &lt;code>maxReplicas&lt;/code> ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="nn">...&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">openAPIV3Schema&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">object&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">properties&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">object&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">x-kubernetes-validation-rules&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">rule&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;self.minReplicas &amp;lt;= self.replicas&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">message&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;replicas should be greater than or equal to minReplicas.&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">rule&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;self.replicas &amp;lt;= self.maxReplicas&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">message&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;replicas should be smaller than or equal to maxReplicas.&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">properties&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">...&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">minReplicas&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">integer&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">replicas&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">integer&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">maxReplicas&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">integer&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">required&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="l">minReplicas&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="l">replicas&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="l">maxReplicas &lt;/span>&lt;span class="w">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>é‚£ä¹ˆï¼Œå½“æœ‰å¦‚ä¸‹çš„è‡ªå®šä¹‰èµ„æºåˆ›å»ºæ—¶ï¼ŒKubernetes å°†ä¼šæ‹’ç»å…¶è¯·æ±‚ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;stable.example.com/v1&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">CustomDeployment&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">my-new-deploy-object&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">minReplicas&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">0&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">replicas&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">20&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">maxReplicas&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">10&lt;/span>&lt;span class="w">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¹¶ä¸”è¿”å›å¦‚ä¸‹é”™è¯¯ï¼š&lt;/p>
&lt;pre>&lt;code>The CustomDeployment &amp;quot;my-new-deploy-object&amp;quot; is invalid:
* spec: Invalid value: map[string]interface {}{&amp;quot;maxReplicas&amp;quot;:10, &amp;quot;minReplicas&amp;quot;:0, &amp;quot;replicas&amp;quot;:20}: replicas should be smaller than or equal to maxReplicas.
&lt;/code>&lt;/pre>&lt;p>è¿™æ ·ç›¸æ¯”åŸæ¥æˆ‘ä»¬é€šè¿‡ Admission çš„æ–¹å¼æ¥è¿›è¡Œæ ¡éªŒå°±ä¼šæ–¹ä¾¿çš„å¤šã€‚å…³äº Kubernetes Admission å¯ä»¥å‚è€ƒæˆ‘ä¹‹å‰çš„æ–‡ç«  ã€Šç†æ¸… Kubernetes ä¸­ Admission æœºåˆ¶ã€‹ã€‚&lt;/p>
&lt;h1 id="hpa-v2-api-è¾¾åˆ°-ga">HPA v2 API è¾¾åˆ° GA&lt;/h1>
&lt;p>HPA v2 å¤§çº¦æ˜¯åœ¨ 5 å¹´å‰é¦–æ¬¡æå‡ºï¼Œç»è¿‡è¿™ 5 å¹´çš„å‘å±•ï¼Œç»ˆäºåœ¨ç°åœ¨å®ƒè¾¾åˆ°äº† GA çº§åˆ«ã€‚&lt;/p>
&lt;p>ä»¥ä¸Šå°±æ˜¯å…³äº Kubernetes v1.23 ä¸­æˆ‘è®¤ä¸ºå€¼å¾—å…³æ³¨çš„ä¸€äº›ä¸»è¦ç‰¹æ€§ï¼Œæ›´å¤šä¿¡æ¯å¯å‚é˜…å…¶ &lt;a href="https://github.com/kubernetes/kubernetes/blob/master/CHANGELOG/CHANGELOG-1.23.md">ReleaseNote&lt;/a>&lt;/p>
&lt;hr>
&lt;p>æ¬¢è¿è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://gitee.com/tlrr/awesome/raw/master/2020-9-9/1599632564572-mp-qrcode.png" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>Open Policy Agent (OPA) å…¥é—¨å®è·µ</title><link>https://moelove.info/2021/12/06/Open-Policy-Agent-OPA-%E5%85%A5%E9%97%A8%E5%AE%9E%E8%B7%B5/</link><guid isPermaLink="true">https://moelove.info/2021/12/06/Open-Policy-Agent-OPA-%E5%85%A5%E9%97%A8%E5%AE%9E%E8%B7%B5/</guid><pubDate>Mon, 06 Dec 2021 19:50:29 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å¼ æ™‹æ¶›ã€‚&lt;/p>
&lt;p>æœ¬ç¯‡æˆ‘æ¥ä¸ºä½ ä»‹ç»ä¸€ä¸ªæˆ‘ä¸ªäººå¾ˆå–œæ¬¢çš„ï¼Œé€šç”¨ç­–ç•¥å¼•æ“ï¼Œåå« OPAï¼Œå…¨ç§°æ˜¯ Open Policy Agentã€‚&lt;/p>
&lt;p>åœ¨å…·ä½“èŠ OPA ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥èŠä¸€ä¸‹ä¸ºä»€ä¹ˆéœ€è¦ä¸€ä¸ªé€šç”¨ç­–ç•¥å¼•æ“ï¼Œä»¥åŠ OPA è§£å†³äº†ä»€ä¹ˆé—®é¢˜ã€‚&lt;/p>
&lt;h2 id="opa-è§£å†³äº†ä»€ä¹ˆé—®é¢˜">OPA è§£å†³äº†ä»€ä¹ˆé—®é¢˜&lt;/h2>
&lt;p>åœ¨å®é™…çš„ç”Ÿäº§ç¯å¢ƒä¸­å¾ˆå¤šåœºæ™¯ä¸­éƒ½éœ€è¦ç­–ç•¥æ§åˆ¶ï¼Œæ¯”å¦‚ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>éœ€è¦ç­–ç•¥æ§åˆ¶ç”¨æˆ·æ˜¯å¦å¯ç™»é™†æœåŠ¡å™¨æˆ–è€…åšä¸€äº›æ“ä½œï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>éœ€è¦ç­–ç•¥æ§åˆ¶å“ªäº›é¡¹ç›®/å“ªäº›ç»„ä»¶å¯è¿›è¡Œéƒ¨ç½²ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>éœ€è¦ç­–ç•¥æ§åˆ¶å¦‚ä½•è®¿é—®æ•°æ®åº“ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>éœ€è¦ç­–ç•¥æ§åˆ¶å“ªäº›èµ„æºå¯éƒ¨ç½²åˆ° Kubernetes ä¸­ï¼›&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://s2.loli.net/2021/12/07/paN9tjO46QM3RbT.png" alt="img">&lt;/p>
&lt;p>ä½†æ˜¯å¯¹äºè¿™äº›åœºæ™¯æˆ–è€…è½¯ä»¶æ¥è¯´ï¼Œé…ç½®å®ƒä»¬çš„ç­–ç•¥æ˜¯éœ€è¦ä¸è¯¥è½¯ä»¶è¿›è¡Œè€¦åˆçš„ï¼Œå½¼æ­¤æ˜¯ä¸ç»Ÿä¸€ï¼Œä¸é€šç”¨çš„ã€‚ç®¡ç†èµ·æ¥ä¹Ÿä¼šæ¯”è¾ƒæ··ä¹±ï¼Œå¸¦æ¥äº†ä¸å°çš„ç»´æŠ¤æˆæœ¬ã€‚&lt;/p>
&lt;p>OPA çš„å‡ºç°å¯ä»¥å°†å„å¤„é…ç½®çš„ç­–ç•¥è¿›è¡Œç»Ÿä¸€ï¼Œæå¤§çš„&lt;strong>é™ä½äº†ç»´æŠ¤æˆæœ¬&lt;/strong>ã€‚ä»¥åŠå°†ç­–ç•¥ä¸å¯¹åº”çš„è½¯ä»¶/æœåŠ¡è¿›è¡Œè§£è€¦ï¼Œæ–¹ä¾¿è¿›è¡Œç§»æ¤/å¤ç”¨ã€‚&lt;/p>
&lt;p>&lt;img src="https://s2.loli.net/2021/12/07/dPrM4sqaeXIT1Q8.png" alt="img">&lt;/p>
&lt;h2 id="opa-çš„å‘å±•è¿‡ç¨‹">OPA çš„å‘å±•è¿‡ç¨‹&lt;/h2>
&lt;p>OPA æœ€åˆæ˜¯ç”± Styra å…¬å¸åœ¨ 2016 å¹´åˆ›å»ºå¹¶å¼€æºçš„é¡¹ç›®ï¼Œç›®å‰è¯¥å…¬å¸çš„ä¸»è¦äº§å“å°±æ˜¯æä¾›å¯è§†åŒ–ç­–ç•¥æ§åˆ¶åŠç­–ç•¥æ‰§è¡Œçš„å¯è§†åŒ– Dashboard æœåŠ¡çš„ã€‚&lt;/p>
&lt;p>OPA é¦–æ¬¡è¿›å…¥ CNCF å¹¶æˆä¸º sandbox çº§åˆ«çš„é¡¹ç›®æ˜¯åœ¨ 2018 å¹´ï¼Œ åœ¨ 2021 å¹´çš„ 2 æœˆä»½ä¾¿å·²ç»ä» CNCF æ¯•ä¸šï¼Œè¿™ä¸ªè¿‡ç¨‹ç›¸å¯¹æ¥è¯´è¿˜æ˜¯æ¯”è¾ƒå¿«çš„ï¼Œç”±æ­¤ä¹Ÿå¯ä»¥çœ‹å‡º OPA æ˜¯ä¸€ä¸ªæ¯”è¾ƒæ´»è·ƒä¸”åº”ç”¨å¹¿æ³›çš„é¡¹ç›®ã€‚&lt;/p>
&lt;h2 id="opa-æ˜¯ä»€ä¹ˆ">OPA æ˜¯ä»€ä¹ˆ&lt;/h2>
&lt;p>å‰é¢æˆ‘ä»¬å·²ç»ä»‹ç»è¿‡ Open Policy Agent (OPA) æ˜¯ä¸€ç§å¼€æºçš„é€šç”¨ç­–ç•¥å¼•æ“ï¼Œå¯åœ¨æ•´ä¸ªå †æ ˆä¸­å®ç°ç»Ÿä¸€ã€ä¸Šä¸‹æ–‡æ„ŸçŸ¥çš„ç­–ç•¥æ§åˆ¶ã€‚&lt;/p>
&lt;p>OPA å¯å°†ç­–ç•¥å†³ç­–ä¸åº”ç”¨ç¨‹åºçš„ä¸šåŠ¡é€»è¾‘åˆ†ç¦»ï¼ˆè§£è€¦ï¼‰ï¼Œ&lt;strong>é€è¿‡ç°è±¡çœ‹æœ¬è´¨ï¼Œç­–ç•¥å°±æ˜¯ä¸€ç»„è§„åˆ™ï¼Œè¯·æ±‚å‘é€åˆ°å¼•æ“ï¼Œå¼•æ“æ ¹æ®è§„åˆ™æ¥è¿›è¡Œå†³ç­–ã€‚&lt;/strong>&lt;/p>
&lt;p>&lt;img src="https://s2.loli.net/2021/12/07/6bqX3GINMmUVg2k.png" alt="img">&lt;/p>
&lt;p>å›¾ 3 ï¼ŒOPA çš„ç­–ç•¥è§£è€¦ç¤ºä¾‹&lt;/p>
&lt;p>&lt;strong>OPA å¹¶ä¸è´Ÿè´£å…·ä½“ä»»åŠ¡çš„æ‰§è¡Œï¼Œå®ƒä»…è´Ÿè´£å†³ç­–&lt;/strong>ï¼Œéœ€è¦å†³ç­–çš„è¯·æ±‚é€šè¿‡ JSON çš„æ–¹å¼ä¼ é€’ç»™ OPA ï¼Œåœ¨ OPA å†³ç­–åï¼Œä¹Ÿä¼šå°†ç»“æœä»¥ JSON çš„å½¢å¼è¿”å›ã€‚&lt;/p>
&lt;h2 id="rego">Rego&lt;/h2>
&lt;p>OPA ä¸­çš„ç­–ç•¥æ˜¯ä»¥ Rego è¿™ç§ DSL(Domain Specific Language) æ¥è¡¨ç¤ºçš„ã€‚&lt;/p>
&lt;p>Rego å— Datalogï¼ˆhttps://en.wikipedia.org/wiki/Datalogï¼‰ çš„å¯å‘ï¼Œå¹¶ä¸”æ‰©å±•äº† Datalog å¯¹äºç»“æ„åŒ–æ–‡æ¡£æ¨¡å‹çš„æ”¯æŒï¼Œæ–¹ä¾¿ä»¥ JSON çš„æ–¹å¼å¯¹æ•°æ®è¿›è¡Œå¤„ç†ã€‚&lt;/p>
&lt;p>Rego å…è®¸ç­–ç•¥åˆ¶å®šè€…å¯ä»¥ä¸“æ³¨äºè¿”å›å†…å®¹çš„æŸ¥è¯¢è€Œä¸æ˜¯å¦‚ä½•æ‰§è¡ŒæŸ¥è¯¢ã€‚åŒæ—¶ OPA ä¸­ä¹Ÿå†…ç½®äº†æ‰§è¡Œè§„åˆ™æ—¶çš„ä¼˜åŒ–ï¼Œç”¨æˆ·å¯ä»¥é»˜è®¤ä½¿ç”¨ã€‚&lt;/p>
&lt;p>Rego å…è®¸æˆ‘ä»¬ä½¿ç”¨è§„åˆ™ï¼ˆif-thenï¼‰å°è£…å’Œé‡ç”¨é€»è¾‘ï¼Œè§„åˆ™å¯ä»¥æ˜¯å®Œæ•´çš„æˆ–è€…æ˜¯éƒ¨åˆ†çš„ã€‚&lt;/p>
&lt;p>æ¯ä¸ªè§„åˆ™éƒ½æ˜¯ç”±å¤´éƒ¨å’Œä¸»ä½“ç»„æˆã€‚åœ¨ Rego ä¸­ï¼Œå¦‚æœè§„åˆ™ä¸»ä½“å¯¹äºæŸäº›å˜é‡èµ‹å€¼ä¸ºçœŸï¼Œé‚£ä¹ˆæˆ‘ä»¬è¯´è§„åˆ™å¤´ä¸ºçœŸã€‚å¯ä»¥é€šè¿‡ç»å¯¹è·¯å¾„å¼•ç”¨ä»»ä½•åŠ è½½åˆ° OPA ä¸­çš„è§„åˆ™æ¥æŸ¥è¯¢å®ƒçš„å€¼ã€‚è§„åˆ™çš„è·¯å¾„æ€»æ˜¯ï¼š data.&lt;package-path>.&lt;rule-name> ï¼ˆè§„åˆ™ç”Ÿæˆçš„æ‰€æœ‰å€¼éƒ½å¯ä»¥é€šè¿‡å…¨å±€ data å˜é‡è¿›è¡ŒæŸ¥è¯¢ã€‚ ä¾‹å¦‚ï¼Œä¸‹æ–¹ç¤ºä¾‹ä¸­çš„ &lt;code>data.example.rules.any_public_networks&lt;/code>&lt;/p>
&lt;ul>
&lt;li>å®Œæ•´è§„åˆ™æ˜¯å°†å•ä¸ªå€¼åˆ†é…ç»™å˜é‡çš„ if-then è¯­å¥ã€‚&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://s2.loli.net/2021/12/07/bQDisFJrBPAyk6h.png" alt="img">&lt;/p>
&lt;p>å›¾ 4 ï¼ŒRego å®Œæ•´è§„åˆ™ç¤ºä¾‹&lt;/p>
&lt;ul>
&lt;li>éƒ¨åˆ†è§„åˆ™æ˜¯ç”Ÿæˆä¸€ç»„å€¼å¹¶å°†è¯¥ç»„åˆ†é…ç»™å˜é‡çš„ if-then è¯­å¥ã€‚&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://s2.loli.net/2021/12/07/hKIamVtH5AzMbYr.png" alt="img">&lt;/p>
&lt;p>å›¾ 5 ï¼ŒRego éƒ¨åˆ†è§„åˆ™ç¤ºä¾‹&lt;/p>
&lt;ul>
&lt;li>é€»è¾‘æˆ–æ˜¯è¦åœ¨ Rego ä¸­å®šä¹‰å¤šä¸ªå…·æœ‰ç›¸åŒåç§°çš„è§„åˆ™ã€‚ï¼ˆæŸ¥è¯¢ä¸­å°†å¤šä¸ªè¡¨è¾¾å¼è¿æ¥åœ¨ä¸€èµ·æ—¶ï¼Œè¡¨ç¤ºçš„æ˜¯é€»è¾‘ ANDï¼‰&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://s2.loli.net/2021/12/07/PJjwpmZtBNk4yHh.png" alt="img">&lt;/p>
&lt;p>å›¾ 6 ï¼ŒRego è§„åˆ™æˆ–çš„å®Œå…¨è§„åˆ™å’Œéƒ¨åˆ†è§„åˆ™ç¤ºä¾‹å›¾&lt;/p>
&lt;h2 id="opa-çš„ä½¿ç”¨">OPA çš„ä½¿ç”¨&lt;/h2>
&lt;p>OPA çš„ä½¿ç”¨è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ã€‚&lt;/p>
&lt;h3 id="å®‰è£…-opa">å®‰è£… OPA&lt;/h3>
&lt;h4 id="äºŒè¿›åˆ¶æ–¹å¼">äºŒè¿›åˆ¶æ–¹å¼&lt;/h4>
&lt;p>æˆ‘ä»¬å¯ä»¥ç›´æ¥ä» OPA çš„ release é¡µé¢ä¸‹è½½å…¶äºŒè¿›åˆ¶è¿›è¡Œä½¿ç”¨&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-plain" data-lang="plain">âœ ~ wget -q -O ~/bin/opa https://github.com/open-policy-agent/opa/releases/download/v0.35.0/opa_linux_amd64_static
âœ ~ chmod +x ~/bin/opa
âœ ~ opa version
Version: 0.35.0
Build Commit: a54537a
Build Timestamp: 2021-12-01T02:11:47Z
Build Hostname: 9e4cf671a460
Go Version: go1.17.3
WebAssembly: unavailable
&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="å®¹å™¨">å®¹å™¨&lt;/h4>
&lt;p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å…¶å®˜æ–¹é•œåƒ&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-plain" data-lang="plain">âœ ~ docker run --rm openpolicyagent/opa:0.35.0 version
Version: 0.35.0
Build Commit: a54537a
Build Timestamp: 2021-12-01T02:10:31Z
Build Hostname: 4ee9b086e5de
Go Version: go1.17.3
WebAssembly: available
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="opa-äº¤äº’">OPA äº¤äº’&lt;/h3>
&lt;h4 id="opa-eval">opa eval&lt;/h4>
&lt;p>æœ€ç®€å•çš„å‘½ä»¤æ˜¯ &lt;code>opa eval&lt;/code> ï¼Œå½“ç„¶æˆ‘ä»¬é™¤äº†èƒ½ä½¿ç”¨å®ƒè¿›è¡Œç­–ç•¥çš„æ‰§è¡Œå¤–ï¼Œè¿˜å¯ä»¥ç”¨æ¥åšè¡¨è¾¾å¼è®¡ç®—ã€‚&lt;/p>
&lt;p>&lt;img src="https://s2.loli.net/2021/12/07/Ql5Lhwt1Knr7O3D.png" alt="img">&lt;/p>
&lt;p>å›¾ 7 ï¼Œ opa eval çš„ä½¿ç”¨å¸®åŠ©&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-plain" data-lang="plain">âœ ~ opa eval &amp;#34;6+6&amp;#34;
{
&amp;#34;result&amp;#34;: [
{
&amp;#34;expressions&amp;#34;: [
{
&amp;#34;value&amp;#34;: 12,
&amp;#34;text&amp;#34;: &amp;#34;6+6&amp;#34;,
&amp;#34;location&amp;#34;: {
&amp;#34;row&amp;#34;: 1,
&amp;#34;col&amp;#34;: 1
}
}
]
}
]
}
&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="opa-run">opa run&lt;/h4>
&lt;p>&lt;code>opa run&lt;/code> ä¼šå¯åŠ¨ä¸€ä¸ªäº¤äº’å¼ shell ï¼ˆ REPLï¼‰ ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ REPL æ¥è¯•éªŒç­–ç•¥å¹¶æ„å»ºæ–°çš„åŸå‹ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">âœ ~ opa run
OPA 0.35.0 &lt;span class="o">(&lt;/span>commit a54537a, built at 2021-12-01T02:11:47Z&lt;span class="o">)&lt;/span>
Run &lt;span class="s1">&amp;#39;help&amp;#39;&lt;/span> to see a list of commands and check &lt;span class="k">for&lt;/span> updates.
&amp;gt; &lt;span class="nb">true&lt;/span>
&lt;span class="nb">true&lt;/span>
&amp;gt; &lt;span class="o">[&lt;/span>&lt;span class="s2">&amp;#34;Hello&amp;#34;&lt;/span>, &lt;span class="s2">&amp;#34;OPA&amp;#34;&lt;/span>&lt;span class="o">]&lt;/span>
&lt;span class="o">[&lt;/span>
&lt;span class="s2">&amp;#34;Hello&amp;#34;&lt;/span>,
&lt;span class="s2">&amp;#34;OPA&amp;#34;&lt;/span>
&lt;span class="o">]&lt;/span>
&amp;gt; pi :&lt;span class="o">=&lt;/span> 3.14
Rule &lt;span class="s1">&amp;#39;pi&amp;#39;&lt;/span> defined in package repl. Type &lt;span class="s1">&amp;#39;show&amp;#39;&lt;/span> to see rules.
&amp;gt; show
package repl
pi :&lt;span class="o">=&lt;/span> 3.14
&amp;gt; pi &amp;gt; &lt;span class="m">1&lt;/span>
&lt;span class="nb">true&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>æˆ‘ä»¬ä¹Ÿå¯ä»¥å°†ç­–ç•¥ç›´æ¥åŠ è½½è¿›å»ï¼Œæˆ–è€… å°† OPA ä½œä¸ºä¸€ä¸ªæœåŠ¡è¿è¡Œå¹¶é€šè¿‡ HTTP æ‰§è¡ŒæŸ¥è¯¢ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒOPA ç›‘ä¼šç›‘å¬åœ¨ 8181 ç«¯å£ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-plain" data-lang="plain">âœ ~ opa run --server
{&amp;#34;addrs&amp;#34;:[&amp;#34;:8181&amp;#34;],&amp;#34;diagnostic-addrs&amp;#34;:[],&amp;#34;level&amp;#34;:&amp;#34;info&amp;#34;,&amp;#34;msg&amp;#34;:&amp;#34;Initializing server.&amp;#34;,&amp;#34;time&amp;#34;:&amp;#34;2021-12-07T01:12:47+08:00&amp;#34;}
&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ‰“å¼€æµè§ˆå™¨ä¹Ÿå¯ä»¥çœ‹åˆ°ä¸€ä¸ªç®€å•çš„æŸ¥è¯¢çª—å£&lt;/p>
&lt;p>&lt;img src="https://s2.loli.net/2021/12/07/nbe45kwZFJWgiKL.png" alt="img">&lt;/p>
&lt;h4 id="opa-ä½œä¸º-go-çš„åº“ä½¿ç”¨">opa ä½œä¸º go çš„åº“ä½¿ç”¨&lt;/h4>
&lt;p>OPA å¯ä»¥ä½œä¸ºåº“åµŒå…¥åˆ° Go ç¨‹åºä¸­ã€‚å°† OPA åµŒå…¥ä¸ºåº“çš„æœ€ç®€å•æ–¹æ³•æ˜¯å¯¼å…¥ &lt;code>github.com/open-policy-agent/opa/rego&lt;/code> åŒ…ã€‚é€šè¿‡ &lt;code>rego.New&lt;/code> å‡½æ•°ç”¨æ¥åˆ›å»ºä¸€ä¸ªå¯ä»¥å‡†å¤‡æˆ–è¯„ä¼°çš„å¯¹è±¡, &lt;code>PrepareForEval()&lt;/code> ä»¥è·å–å¯æ‰§è¡ŒæŸ¥è¯¢ã€‚&lt;/p>
&lt;p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼š&lt;/p>
&lt;ul>
&lt;li>ç›®å½•ç»“æ„&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">âœ opa tree
.
â”œâ”€â”€ data
â”œâ”€â”€ go.mod
â”œâ”€â”€ go.sum
â”œâ”€â”€ input.json
â”œâ”€â”€ k8s-label.rego
â””â”€â”€ main.go
&lt;span class="m">1&lt;/span> directory, &lt;span class="m">5&lt;/span> files
&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>ç­–ç•¥æ–‡ä»¶&lt;/li>
&lt;/ul>
&lt;p>è¿™é‡Œçš„ç­–ç•¥æ–‡ä»¶æ˜¯æ¥æ ¡éªŒ INPUT ä¸­æ˜¯å¦åŒ…å«åä¸º domain çš„ label ï¼Œ ä»¥åŠè¯¥ label æ˜¯å¦ä»¥ &lt;code>moelove-&lt;/code>å¼€å¤´ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="kn">package&lt;/span> &lt;span class="nx">kubernetes&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">validating&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">existence&lt;/span>
&lt;span class="nx">deny&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nx">msg&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">not&lt;/span> &lt;span class="nx">input&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">request&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">object&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">metadata&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">labels&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">domain&lt;/span>
&lt;span class="nx">msg&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="s">&amp;#34;Every resource must have a domain label&amp;#34;&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="nx">deny&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nx">msg&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">value&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">input&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">request&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">object&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">metadata&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">labels&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">domain&lt;/span>
&lt;span class="nx">not&lt;/span> &lt;span class="nf">startswith&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">value&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;moelove-&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="nx">msg&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nf">sprintf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;domain label must start with `moelove-`; found `%v`&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="nx">value&lt;/span>&lt;span class="p">])&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>INPUT æ–‡ä»¶ï¼Œ ä»¥ Kubernetes çš„ AdmissionReview ä¸ºä¾‹&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-json" data-lang="json">&lt;span class="p">{&lt;/span>
&lt;span class="nt">&amp;#34;kind&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;AdmissionReview&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="nt">&amp;#34;request&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nt">&amp;#34;kind&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nt">&amp;#34;kind&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;Pod&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="nt">&amp;#34;version&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;v1&amp;#34;&lt;/span>
&lt;span class="p">},&lt;/span>
&lt;span class="nt">&amp;#34;object&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nt">&amp;#34;metadata&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nt">&amp;#34;name&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;myapp&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="nt">&amp;#34;labels&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nt">&amp;#34;domain&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;opa&amp;#34;&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="p">},&lt;/span>
&lt;span class="nt">&amp;#34;spec&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nt">&amp;#34;containers&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;span class="p">{&lt;/span>
&lt;span class="nt">&amp;#34;image&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;alpine&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="nt">&amp;#34;name&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;alpine&amp;#34;&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="p">]&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>main.go æ–‡ä»¶&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="kn">package&lt;/span> &lt;span class="nx">main&lt;/span>
&lt;span class="kn">import&lt;/span> &lt;span class="p">(&lt;/span>
&lt;span class="s">&amp;#34;context&amp;#34;&lt;/span>
&lt;span class="s">&amp;#34;encoding/json&amp;#34;&lt;/span>
&lt;span class="s">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;span class="s">&amp;#34;log&amp;#34;&lt;/span>
&lt;span class="s">&amp;#34;os&amp;#34;&lt;/span>
&lt;span class="s">&amp;#34;github.com/open-policy-agent/opa/rego&amp;#34;&lt;/span>
&lt;span class="p">)&lt;/span>
&lt;span class="kd">func&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">ctx&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">context&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Background&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="c1">// Construct a Rego object that can be prepared or evaluated.
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="nx">r&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">rego&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">New&lt;/span>&lt;span class="p">(&lt;/span>
&lt;span class="nx">rego&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Query&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">os&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Args&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">]),&lt;/span>
&lt;span class="nx">rego&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Load&lt;/span>&lt;span class="p">([]&lt;/span>&lt;span class="kt">string&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="nx">os&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Args&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">]},&lt;/span> &lt;span class="kc">nil&lt;/span>&lt;span class="p">))&lt;/span>
&lt;span class="c1">// Create a prepared query that can be evaluated.
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="nx">query&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">r&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">PrepareForEval&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">ctx&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Fatal&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">err&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="c1">// Load the input document from stdin.
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="kd">var&lt;/span> &lt;span class="nx">input&lt;/span> &lt;span class="kd">interface&lt;/span>&lt;span class="p">{}&lt;/span>
&lt;span class="nx">dec&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">json&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">NewDecoder&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">os&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Stdin&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="nx">dec&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">UseNumber&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">dec&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Decode&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="nx">input&lt;/span>&lt;span class="p">);&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Fatal&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">err&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="nx">rs&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">query&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Eval&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">ctx&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">rego&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">EvalInput&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">input&lt;/span>&lt;span class="p">))&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Fatal&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">err&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">rs&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">âœ opa go run main.go k8s-label.rego &lt;span class="s2">&amp;#34;data&amp;#34;&lt;/span> &amp;lt; input.json
&lt;span class="o">[{[&lt;/span>map&lt;span class="o">[&lt;/span>kubernetes:map&lt;span class="o">[&lt;/span>validating:map&lt;span class="o">[&lt;/span>existence:map&lt;span class="o">[&lt;/span>deny:&lt;span class="o">[&lt;/span>domain label must start with &lt;span class="sb">`&lt;/span>moelove-&lt;span class="sb">`&lt;/span>&lt;span class="p">;&lt;/span> found &lt;span class="sb">`&lt;/span>opa&lt;span class="sb">`&lt;/span>&lt;span class="o">]]]]]]&lt;/span> map&lt;span class="o">[]}]&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="æ€»ç»“">æ€»ç»“&lt;/h2>
&lt;p>ä»¥ä¸Šä¾¿æ˜¯å¯¹äº OPA çš„ä¸€ä¸ªå¤§è‡´ä»‹ç»ï¼ŒOPA çš„åº”ç”¨åœºæ™¯æœ‰å¾ˆå¤šï¼Œåç»­æ–‡ç« ä¸­å°†ä¸ºå¤§å®¶åˆ†äº« OPA åœ¨ Kubernetes ä¸­çš„åº”ç”¨ï¼Œå’Œå°† OPA åº”ç”¨ä¸ CI/CD pipeline çš„åœºæ™¯ã€‚æ•¬è¯·æœŸå¾…ã€‚&lt;/p>
&lt;hr>
&lt;p>æ¬¢è¿è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://gitee.com/tlrr/awesome/raw/master/2020-9-9/1599632564572-mp-qrcode.png" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category><category domain="https://moelove.info/tags/OPA/">OPA</category></item><item><title>ç†æ¸… Kubernetes ä¸­çš„å‡†å…¥æ§åˆ¶ï¼ˆAdmission Controller)</title><link>https://moelove.info/2021/11/30/%E7%90%86%E6%B8%85-Kubernetes-%E4%B8%AD%E7%9A%84%E5%87%86%E5%85%A5%E6%8E%A7%E5%88%B6Admission-Controller/</link><guid isPermaLink="true">https://moelove.info/2021/11/30/%E7%90%86%E6%B8%85-Kubernetes-%E4%B8%AD%E7%9A%84%E5%87%86%E5%85%A5%E6%8E%A7%E5%88%B6Admission-Controller/</guid><pubDate>Tue, 30 Nov 2021 03:04:22 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å¼ æ™‹æ¶›ã€‚&lt;/p>
&lt;p>åœ¨æˆ‘ä¹‹å‰å‘å¸ƒçš„æ–‡ç«  ã€Šäº‘åŸç”Ÿæ—¶ä»£ä¸‹çš„å®¹å™¨é•œåƒå®‰å…¨ã€‹ï¼ˆç³»åˆ—ï¼‰ä¸­ï¼Œæˆ‘æåˆ°è¿‡ Kubernetes é›†ç¾¤çš„æ ¸å¿ƒç»„ä»¶ -- kube-apiserverï¼Œå®ƒå…è®¸æ¥è‡ªç»ˆç«¯ç”¨æˆ·æˆ–é›†ç¾¤çš„å„ç»„ä»¶ä¸ä¹‹è¿›è¡Œé€šä¿¡ï¼ˆä¾‹å¦‚ï¼ŒæŸ¥è¯¢ã€åˆ›å»ºã€ä¿®æ”¹æˆ–åˆ é™¤ Kubernetes èµ„æºï¼‰ã€‚&lt;/p>
&lt;p>æœ¬ç¯‡æˆ‘ä»¬å°†èšç„¦äº kube-apiserver è¯·æ±‚å¤„ç†è¿‡ç¨‹ä¸­ä¸€ä¸ªå¾ˆé‡è¦çš„éƒ¨åˆ† -- å‡†å…¥æ§åˆ¶å™¨ï¼ˆAdmission Controllerï¼‰&lt;/p>
&lt;h2 id="k8s-çš„å‡†å…¥æ§åˆ¶å™¨æ˜¯ä»€ä¹ˆ">K8s çš„å‡†å…¥æ§åˆ¶å™¨æ˜¯ä»€ä¹ˆ&lt;/h2>
&lt;h3 id="k8s-ä¸­çš„è¯·æ±‚å¤„ç†æµç¨‹">K8s ä¸­çš„è¯·æ±‚å¤„ç†æµç¨‹&lt;/h3>
&lt;p>åœ¨èŠ K8s å‡†å…¥æ§åˆ¶å™¨æ˜¯ä»€ä¹ˆä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆæ¥å›é¡¾ä¸€ä¸‹ Kubernetes API çš„å¤„ç†å…·ä½“è¯·æ±‚çš„è¿‡ç¨‹ã€‚&lt;/p>
&lt;p>&lt;img src="https://i.loli.net/2021/11/30/PrlCtD3dvUAoRni.png" alt="img">&lt;/p>
&lt;p>&lt;strong>å›¾ 1 ï¼ŒKubernetes API å¤„ç†è¯·æ±‚çš„è¿‡ç¨‹ ï¼ˆä» API Handler åˆ° etcd æŒä¹…åŒ–çš„è¿‡ç¨‹ï¼‰&lt;/strong>&lt;/p>
&lt;p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæ¯ä¸ª API çš„è¯·æ±‚ä»å¼€å§‹è¢« kube-apiserver æ¥æ”¶åˆ°æœ€ç»ˆæŒä¹…åŒ–åˆ° ETCD çš„è¿‡ç¨‹ï¼Œå³ä¸º Kubernetes API çš„è¯·æ±‚å¤„ç†æµç¨‹ã€‚&lt;/p>
&lt;p>å®ƒä¸»è¦åŒ…å«äº†ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;strong>API Handler&lt;/strong> -- ä¸»è¦è´Ÿè´£æä¾›æœåŠ¡ï¼Œæ¥æ”¶è¯·æ±‚ã€‚&lt;/li>
&lt;/ul>
&lt;p>å¯¹äºå…¶å†…éƒ¨å®ç°è€Œè¨€ï¼Œè¯·æ±‚ä¼šå…ˆåˆ° &lt;code>FullHandlerChain&lt;/code> ï¼ˆå®ƒæ˜¯ç”± &lt;code>DefaultBuildHandlerChain&lt;/code> æ„å»ºå‡ºæ¥çš„ï¼‰æ˜¯ä¸€ä¸ª &lt;code>director&lt;/code> å¯¹è±¡&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="kd">type&lt;/span> &lt;span class="nx">director&lt;/span> &lt;span class="kd">struct&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">name&lt;/span> &lt;span class="kt">string&lt;/span>
&lt;span class="nx">goRestfulContainer&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">restful&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Container&lt;/span>
&lt;span class="nx">nonGoRestfulMux&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">mux&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">PathRecorderMux&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>director&lt;/code>æ ¹æ®é…ç½®è¿›è¡Œåˆå§‹åŒ–ï¼Œå¦‚æœ &lt;code>goRestfulContainer&lt;/code>çš„ WebServices çš„ RootPath æ˜¯ &lt;code>/apis&lt;/code>ï¼Œæˆ–è€…è¯·æ±‚å‰ç¼€ä¸ RootPath åŒ¹é…ï¼Œåˆ™è¿›å…¥ Restful å¤„ç†é“¾è·¯ã€‚&lt;/p>
&lt;ul>
&lt;li>&lt;strong>Authentication&lt;/strong> -- è®¤è¯çš„æµç¨‹ã€‚&lt;/li>
&lt;/ul>
&lt;p>åœ¨TLS è¿æ¥å»ºç«‹åï¼Œä¼šè¿›è¡Œè®¤è¯å¤„ç†ï¼Œå¦‚æœè¯·æ±‚è®¤è¯å¤±è´¥ï¼Œä¼šæ‹’ç»è¯¥è¯·æ±‚å¹¶è¿”å› 401 é”™è¯¯ç ï¼›å¦‚æœè®¤è¯æˆåŠŸï¼Œå°†è¿›è¡Œåˆ°é‰´æƒçš„éƒ¨åˆ†ã€‚ç›®å‰æ”¯æŒçš„å®¢æˆ·ç«¯è®¤è¯æ–¹å¼æœ‰å¾ˆå¤šï¼Œä¾‹å¦‚ï¼šx509 å®¢æˆ·ç«¯è¯ä¹¦ã€Bearer Tokenã€åŸºäºç”¨æˆ·åå¯†ç çš„è®¤è¯ã€OpenID è®¤è¯ç­‰ã€‚ç”±äºè¿™äº›å†…å®¹ä¸æ˜¯æœ¬ç¯‡çš„é‡ç‚¹æˆ‘ä»¬æš‚ä¸”è·³è¿‡ï¼Œæ„Ÿå…´è¶£çš„å°ä¼™ä¼´å¯ä»¥åœ¨è¯„è®ºåŒºç•™è¨€è®¨è®ºã€‚&lt;/p>
&lt;ul>
&lt;li>&lt;strong>Authorization&lt;/strong> -- é‰´æƒçš„æµç¨‹ã€‚&lt;/li>
&lt;/ul>
&lt;p>å¯¹äº Kubernetes è€Œè¨€ï¼Œæ”¯æŒå¤šç§çš„é‰´æƒæ¨¡å¼ï¼Œä¾‹å¦‚ï¼ŒABAC æ¨¡å¼ï¼ŒRBAC æ¨¡å¼å’Œ Webhook æ¨¡å¼ç­‰ã€‚æˆ‘ä»¬åœ¨åˆ›å»ºé›†ç¾¤æ—¶ï¼Œå¯ä»¥ç›´æ¥ä¸º kube-apiserver ä¼ é€’å‚æ•°è¿›è¡Œé…ç½®ï¼Œè¿™é‡Œä¹Ÿä¸èµ˜è¿°äº†ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;strong>Mutating Admission&lt;/strong> -- æŒ‡æ‰§è¡Œå¯ç”¨äºå˜æ›´æ“ä½œçš„å‡†å…¥æ§åˆ¶å™¨ï¼Œä¸‹æ–‡ä¸­ä¼šè¯¦ç»†ä»‹ç»ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>Object Schema Validation&lt;/strong> -- å¯¹èµ„æºå¯¹è±¡çš„ schema æ ¡éªŒã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>Validating Admission&lt;/strong> -- æŒ‡æ‰§è¡Œå¯ç”¨äºéªŒè¯æ“ä½œçš„å‡†å…¥æ§åˆ¶å™¨ï¼Œä¸‹æ–‡ä¸­ä¼šè¯¦ç»†ä»‹ç»ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>ETCD&lt;/strong> -- ETCD å®ç°èµ„æºçš„æŒä¹…åŒ–å­˜å‚¨ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>ä¸Šé¢ä¾¿æ˜¯ä¸€ä¸ªè¯·æ±‚çš„å¤„ç†æµç¨‹ï¼Œå…¶ä¸­ Mutating Admission å’Œ Validating Admission ä¾¿æ˜¯æˆ‘ä»¬ä»Šå¤©çš„ä¸»è§’ã€‚æˆ‘ä»¬æ¥è¯¦ç»†çš„çœ‹ä¸€çœ‹ã€‚&lt;/p>
&lt;h3 id="ä»€ä¹ˆæ˜¯å‡†å…¥æ§åˆ¶å™¨admission-controller">ä»€ä¹ˆæ˜¯å‡†å…¥æ§åˆ¶å™¨ï¼ˆAdmission Controllerï¼‰&lt;/h3>
&lt;p>å‡†å…¥æ§åˆ¶å™¨æ˜¯æŒ‡åœ¨&lt;strong>è¯·æ±‚é€šè¿‡è®¤è¯å’Œæˆæƒä¹‹å&lt;/strong>ï¼Œå¯ç”¨äºå¯¹å…¶è¿›è¡Œå˜æ›´æ“ä½œæˆ–éªŒè¯æ“ä½œçš„ä¸€äº›ä»£ç æˆ–åŠŸèƒ½ã€‚&lt;/p>
&lt;p>å‡†å…¥æ§åˆ¶çš„è¿‡ç¨‹åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ç¬¬ä¸€é˜¶æ®µï¼Œè¿è¡Œå˜æ›´å‡†å…¥æ§åˆ¶å™¨ï¼ˆMutating Admissionï¼‰ã€‚å®ƒå¯ä»¥ä¿®æ”¹è¢«å®ƒæ¥å—çš„å¯¹è±¡ï¼Œè¿™å°±å¼•å‡ºäº†å®ƒçš„å¦ä¸€ä¸ªä½œç”¨ï¼Œå°†ç›¸å…³èµ„æºä½œä¸ºè¯·æ±‚å¤„ç†çš„ä¸€éƒ¨åˆ†è¿›è¡Œå˜æ›´ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ç¬¬äºŒé˜¶æ®µï¼Œè¿è¡ŒéªŒè¯å‡†å…¥æ§åˆ¶å™¨ï¼ˆValidating Admissionï¼‰ã€‚å®ƒåªèƒ½è¿›è¡ŒéªŒè¯ï¼Œä¸èƒ½è¿›è¡Œä»»ä½•èµ„æºæ•°æ®çš„ä¿®æ”¹æ“ä½œï¼›&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒæŸäº›æ§åˆ¶å™¨å¯ä»¥æ—¢æ˜¯å˜æ›´å‡†å…¥æ§åˆ¶å™¨åˆæ˜¯éªŒè¯å‡†å…¥æ§åˆ¶å™¨ã€‚å¦‚æœä»»ä¸€ä¸ªé˜¶æ®µçš„å‡†å…¥æ§åˆ¶å™¨æ‹’ç»äº†è¯¥è¯·æ±‚ï¼Œåˆ™æ•´ä¸ªè¯·æ±‚å°†ç«‹å³è¢«æ‹’ç»ï¼Œå¹¶å‘ç»ˆç«¯ç”¨æˆ·è¿”å›é”™è¯¯ã€‚&lt;/p>
&lt;h2 id="ä¸ºä»€ä¹ˆéœ€è¦å‡†å…¥æ§åˆ¶å™¨-admission-controller">ä¸ºä»€ä¹ˆéœ€è¦å‡†å…¥æ§åˆ¶å™¨ Admission Controller&lt;/h2>
&lt;p>æˆ‘ä»¬ä¸»è¦ä»ä¸¤ä¸ªè§’åº¦æ¥ç†è§£ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦å‡†å…¥æ§åˆ¶å™¨ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ä»å®‰å…¨çš„è§’åº¦&lt;/p>
&lt;/li>
&lt;li>
&lt;ul>
&lt;li>æˆ‘ä»¬éœ€è¦æ˜ç¡®åœ¨ Kubernetes é›†ç¾¤ä¸­éƒ¨ç½²çš„é•œåƒæ¥æºæ˜¯å¦å¯ä¿¡ï¼Œä»¥å…é­å—æ”»å‡»ï¼›&lt;/li>
&lt;li>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œåœ¨ Pod å†…å°½é‡ä¸ä½¿ç”¨ root ç”¨æˆ·ï¼Œæˆ–è€…å°½é‡ä¸å¼€å¯ç‰¹æƒå®¹å™¨ç­‰ï¼›&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>ä»æ²»ç†çš„è§’åº¦&lt;/p>
&lt;/li>
&lt;li>
&lt;ul>
&lt;li>æ¯”å¦‚é€šè¿‡ label å¯¹ä¸šåŠ¡/æœåŠ¡è¿›è¡ŒåŒºåˆ†ï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡ admission controller æ ¡éªŒæœåŠ¡æ˜¯å¦å·²ç»æœ‰å¯¹åº”çš„ label å­˜åœ¨ä¹‹ç±»çš„ï¼›&lt;/li>
&lt;li>æ¯”å¦‚æ·»åŠ èµ„æºé…é¢é™åˆ¶ ï¼Œä»¥å…å‡ºç°èµ„æºè¶…å–ä¹‹ç±»çš„æƒ…å†µï¼›&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="å‡†å…¥æ§åˆ¶å™¨">å‡†å…¥æ§åˆ¶å™¨&lt;/h2>
&lt;p>è€ƒè™‘åˆ°è¿™äº›éœ€æ±‚æ¯”è¾ƒæœ‰ç”¨ &amp;amp; ç¡®å®ä¹Ÿæ¯”è¾ƒéœ€è¦ï¼Œæ‰€ä»¥ Kubernetes ç›®å‰å·²ç»å®ç°äº†å¾ˆå¤šå†…ç½®çš„ Admission Controller ã€‚ å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£æ¥è·å–è¯¦ç»†åˆ—è¡¨ï¼š &lt;a href="https://kubernetes.io/docs/reference/access-authn-authz/admission-controllers/#what-does-each-admission-controller-do">https://kubernetes.io/docs/reference/access-authn-authz/admission-controllers/#what-does-each-admission-controller-do&lt;/a>&lt;/p>
&lt;p>è¿™äº›å†…ç½®çš„ Admission Controller éƒ½æ˜¯ä»¥æ’ä»¶çš„æ–¹å¼ä¸ kube-apiserver æ„å»ºåˆ°ä¸€èµ·çš„ï¼Œä½ å¯ä»¥å¯¹å…¶è¿›è¡Œå¯ç”¨å’Œå…³åœã€‚æ¯”å¦‚ç”¨å¦‚ä¸‹å‚æ•°è¿›è¡Œæ§åˆ¶ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">âœ bin ./kube-apiserver --help &lt;span class="p">|&lt;/span>grep admission-plugins
--admission-control strings Admission is divided into two phases. In the first phase, only mutating admission plugins run. In the second phase, only validating admission plugins run. The names in the below list may represent a validating plugin, a mutating plugin, or both. The order of plugins in which they are passed to this flag does not matter. Comma-delimited list of: AlwaysAdmit, AlwaysDeny, AlwaysPullImages, CertificateApproval, CertificateSigning, CertificateSubjectRestriction, DefaultIngressClass, DefaultStorageClass, DefaultTolerationSeconds, DenyServiceExternalIPs, EventRateLimit, ExtendedResourceToleration, ImagePolicyWebhook, LimitPodHardAntiAffinityTopology, LimitRanger, MutatingAdmissionWebhook, NamespaceAutoProvision, NamespaceExists, NamespaceLifecycle, NodeRestriction, OwnerReferencesPermissionEnforcement, PersistentVolumeClaimResize, PersistentVolumeLabel, PodNodeSelector, PodSecurity, PodSecurityPolicy, PodTolerationRestriction, Priority, ResourceQuota, RuntimeClass, SecurityContextDeny, ServiceAccount, StorageObjectInUseProtection, TaintNodesByCondition, ValidatingAdmissionWebhook. &lt;span class="o">(&lt;/span>DEPRECATED: Use --enable-admission-plugins or --disable-admission-plugins instead. Will be removed in a future version.&lt;span class="o">)&lt;/span>
--disable-admission-plugins strings admission plugins that should be disabled although they are in the default enabled plugins list &lt;span class="o">(&lt;/span>NamespaceLifecycle, LimitRanger, ServiceAccount, TaintNodesByCondition, PodSecurity, Priority, DefaultTolerationSeconds, DefaultStorageClass, StorageObjectInUseProtection, PersistentVolumeClaimResize, RuntimeClass, CertificateApproval, CertificateSigning, CertificateSubjectRestriction, DefaultIngressClass, MutatingAdmissionWebhook, ValidatingAdmissionWebhook, ResourceQuota&lt;span class="o">)&lt;/span>. Comma-delimited list of admission plugins: AlwaysAdmit, AlwaysDeny, AlwaysPullImages, CertificateApproval, CertificateSigning, CertificateSubjectRestriction, DefaultIngressClass, DefaultStorageClass, DefaultTolerationSeconds, DenyServiceExternalIPs, EventRateLimit, ExtendedResourceToleration, ImagePolicyWebhook, LimitPodHardAntiAffinityTopology, LimitRanger, MutatingAdmissionWebhook, NamespaceAutoProvision, NamespaceExists, NamespaceLifecycle, NodeRestriction, OwnerReferencesPermissionEnforcement, PersistentVolumeClaimResize, PersistentVolumeLabel, PodNodeSelector, PodSecurity, PodSecurityPolicy, PodTolerationRestriction, Priority, ResourceQuota, RuntimeClass, SecurityContextDeny, ServiceAccount, StorageObjectInUseProtection, TaintNodesByCondition, ValidatingAdmissionWebhook. The order of plugins in this flag does not matter.
--enable-admission-plugins strings admission plugins that should be enabled in addition to default enabled ones &lt;span class="o">(&lt;/span>NamespaceLifecycle, LimitRanger, ServiceAccount, TaintNodesByCondition, PodSecurity, Priority, DefaultTolerationSeconds, DefaultStorageClass, StorageObjectInUseProtection, PersistentVolumeClaimResize, RuntimeClass, CertificateApproval, CertificateSigning, CertificateSubjectRestriction, DefaultIngressClass, MutatingAdmissionWebhook, ValidatingAdmissionWebhook, ResourceQuota&lt;span class="o">)&lt;/span>. Comma-delimited list of admission plugins: AlwaysAdmit, AlwaysDeny, AlwaysPullImages, CertificateApproval, CertificateSigning, CertificateSubjectRestriction, DefaultIngressClass, DefaultStorageClass, DefaultTolerationSeconds, DenyServiceExternalIPs, EventRateLimit, ExtendedResourceToleration, ImagePolicyWebhook, LimitPodHardAntiAffinityTopology, LimitRanger, MutatingAdmissionWebhook, NamespaceAutoProvision, NamespaceExists, NamespaceLifecycle, NodeRestriction, OwnerReferencesPermissionEnforcement, PersistentVolumeClaimResize, PersistentVolumeLabel, PodNodeSelector, PodSecurity, PodSecurityPolicy, PodTolerationRestriction, Priority, ResourceQuota, RuntimeClass, SecurityContextDeny, ServiceAccount, StorageObjectInUseProtection, TaintNodesByCondition, ValidatingAdmissionWebhook. The order of plugins in this flag does not matter.
&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™ä¹ˆå¤šçš„å‡†å…¥æ§åˆ¶å™¨ä¸­æœ‰ä¸¤ä¸ªæ¯”è¾ƒç‰¹åˆ«ï¼Œåˆ†åˆ«æ˜¯ &lt;code>MutatingAdmissionWebhook&lt;/code> å’Œ &lt;code>ValidatingAdmissionWebhook&lt;/code>ã€‚å®ƒä»¬å¹¶æ²¡æœ‰çœŸæ­£æ‰§è¡Œç›¸åº”çš„ç­–ç•¥ï¼Œè€Œæ˜¯ä¸º kube-apiserver æä¾›äº†ä¸€ç§å¯æ‰©å±•çš„æ–¹å¼ï¼Œ ç”¨æˆ·å¯ä»¥é€šè¿‡é…ç½® &lt;code>MutatingAdmissionWebhook&lt;/code> å’Œ &lt;code>ValidatingAdmissionWebhook&lt;/code> æ¥ä½¿ç”¨è‡ªæ„å»ºçš„æœåŠ¡ï¼Œ è€Œä¸”è¿™ç§æ–¹å¼æ˜¯æ— éœ€å¯¹ kube-spiserver æ‰§è¡Œç¼–è¯‘æˆ–è€…é‡å¯ï¼Œå®Œå…¨æ˜¯åŠ¨æ€çš„ï¼Œéå¸¸çš„æ–¹ä¾¿ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬æ¥å…·ä½“çœ‹ä¸€ä¸‹ã€‚&lt;/p>
&lt;h2 id="åŠ¨æ€å‡†å…¥æ§åˆ¶å™¨">åŠ¨æ€å‡†å…¥æ§åˆ¶å™¨&lt;/h2>
&lt;p>åˆ©ç”¨ä¸Šæ–‡ä¸­æåˆ°çš„ &lt;code>MutatingAdmissionWebhook&lt;/code> å’Œ &lt;code>ValidatingAdmissionWebhook&lt;/code> è¿›è¡Œè¿è¡Œæ—¶é…ç½®çš„ï¼Œä»¥ Webhook å½¢å¼è°ƒç”¨çš„ Admission Controller å³ä¸ºåŠ¨æ€å‡†å…¥æ§åˆ¶å™¨ã€‚&lt;/p>
&lt;p>å®ƒæ˜¯ä¸€ç§ç”¨äºæ¥æ”¶å‡†å…¥è¯·æ±‚å¹¶å¯¹å…¶è¿›è¡Œå¤„ç†çš„ HTTP å›è°ƒæœºåˆ¶ï¼Œå°±æ˜¯ä¸€ä¸ª Web æœåŠ¡ã€‚å½“å‰çš„ä¸¤ç§ç±»å‹çš„å‡†å…¥ webhookï¼š&lt;/p>
&lt;ul>
&lt;li>validating admission webhook&lt;/li>
&lt;li>mutating admission webhook&lt;/li>
&lt;/ul>
&lt;p>mutating admission webhook ä¼šä¼˜å…ˆè¢«è°ƒç”¨ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­å¯ä»¥å¯¹èµ„æºè¿›è¡Œä¿®æ”¹ã€‚&lt;/p>
&lt;p>å¦‚æœæˆ‘ä»¬éœ€è¦ç¡®ä¿å¯¹è±¡çš„æœ€ç»ˆçŠ¶æ€ä»¥æ‰§è¡ŒæŸäº›æ“ä½œåº”è¯¥è€ƒè™‘ä½¿ç”¨ validating admission webhook *ï¼Œ*å› ä¸ºåˆ°è¾¾è¿™ä¸ªé˜¶æ®µçš„è¯·æ±‚ä¸ä¼šå†è¢«ä¿®æ”¹ã€‚&lt;/p>
&lt;h3 id="ä½¿ç”¨æ¡ä»¶">ä½¿ç”¨æ¡ä»¶&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>ç¡®ä¿ Kubernetes é›†ç¾¤ç‰ˆæœ¬è‡³å°‘ä¸º v1.16ï¼ˆä»¥ä¾¿ä½¿ç”¨ &lt;code>admissionregistration.k8s.io/v1&lt;/code> APIï¼‰ æˆ–è€… v1.9 ï¼ˆä»¥ä¾¿ä½¿ç”¨ &lt;code>admissionregistration.k8s.io/v1beta1&lt;/code> APIï¼‰ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ç¡®ä¿å·²ç»å¯ç”¨ &lt;code>MutatingAdmissionWebhook&lt;/code> å’Œ &lt;code>ValidatingAdmissionWebhook&lt;/code> å‡†å…¥æ§åˆ¶å™¨ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ç¡®ä¿å¯ç”¨äº† &lt;code>admissionregistration.k8s.io/v1beta1&lt;/code> æˆ–è€… &lt;code>admissionregistration.k8s.io/v1&lt;/code> API;&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="admission-webhook-æ˜¯ä»€ä¹ˆ">Admission Webhook æ˜¯ä»€ä¹ˆ&lt;/h3>
&lt;p>å®ƒå…¶å®å°±æ˜¯ä¸€ä¸ªæ™®é€šçš„ HTTP Serverï¼Œéœ€è¦å¤„ç†çš„å°±æ˜¯ &lt;code>AdmissionReview&lt;/code> ç±»å‹çš„èµ„æºï¼Œæˆ‘ä»¬æ¥çœ‹ä¸ªç¤ºä¾‹ï¼Œæ¯”å¦‚è¯´è¦å¯¹ &lt;code>Ingress&lt;/code>èµ„æºè¿›è¡Œå‡†å…¥æ ¡éªŒï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="kd">func&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">ia&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">IngressAdmission&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="nf">HandleAdmission&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">obj&lt;/span> &lt;span class="nx">runtime&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Object&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">runtime&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Object&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kt">error&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">review&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">isV1&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">obj&lt;/span>&lt;span class="p">.(&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="nx">admissionv1&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">AdmissionReview&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="p">!&lt;/span>&lt;span class="nx">isV1&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="kc">nil&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Errorf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;request is not of type AdmissionReview v1&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="p">!&lt;/span>&lt;span class="nx">apiequality&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Semantic&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">DeepEqual&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">review&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Request&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Kind&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">ingressResource&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="kc">nil&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Errorf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;rejecting admission review because the request does not contain an Ingress resource but %s with name %s in namespace %s&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="nx">review&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Request&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Kind&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">String&lt;/span>&lt;span class="p">(),&lt;/span> &lt;span class="nx">review&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Request&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Name&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">review&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Request&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Namespace&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="nx">status&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="o">&amp;amp;&lt;/span>&lt;span class="nx">admissionv1&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">AdmissionResponse&lt;/span>&lt;span class="p">{}&lt;/span>
&lt;span class="nx">status&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">UID&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">review&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Request&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">UID&lt;/span>
&lt;span class="nx">ingress&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">networking&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Ingress&lt;/span>&lt;span class="p">{}&lt;/span>
&lt;span class="nx">codec&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">json&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">NewSerializerWithOptions&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">json&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">DefaultMetaFactory&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">scheme&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">scheme&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">json&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">SerializerOptions&lt;/span>&lt;span class="p">{&lt;/span>
&lt;span class="nx">Pretty&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="p">})&lt;/span>
&lt;span class="nx">codec&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Decode&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">review&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Request&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Object&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Raw&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kc">nil&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kc">nil&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="nx">_&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">_&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">codec&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Decode&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">review&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Request&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Object&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Raw&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kc">nil&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">&amp;amp;&lt;/span>&lt;span class="nx">ingress&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">klog&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">ErrorS&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">err&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;failed to decode ingress&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="nx">status&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Allowed&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="kc">false&lt;/span>
&lt;span class="nx">status&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Result&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="o">&amp;amp;&lt;/span>&lt;span class="nx">metav1&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Status&lt;/span>&lt;span class="p">{&lt;/span>
&lt;span class="nx">Status&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nx">metav1&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">StatusFailure&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">Code&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nx">http&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">StatusBadRequest&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">Reason&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nx">metav1&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">StatusReasonBadRequest&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="nx">Message&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nx">err&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Error&lt;/span>&lt;span class="p">(),&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="nx">review&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Response&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">status&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="nx">review&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kc">nil&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">ia&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Checker&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">CheckIngress&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="nx">ingress&lt;/span>&lt;span class="p">);&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">klog&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">ErrorS&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">err&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;invalid ingress configuration&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;ingress&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Sprintf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;%v/%v&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">review&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Request&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Name&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">review&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Request&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Namespace&lt;/span>&lt;span class="p">))&lt;/span>
&lt;span class="nx">status&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Allowed&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="kc">false&lt;/span>
&lt;span class="nx">status&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Result&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="o">&amp;amp;&lt;/span>&lt;span class="nx">metav1&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Status&lt;/span>&lt;span class="p">{&lt;/span>
&lt;span class="nx">Status&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nx">metav1&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">StatusFailure&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">Code&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nx">http&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">StatusBadRequest&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">Reason&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nx">metav1&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">StatusReasonBadRequest&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="nx">Message&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nx">err&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Error&lt;/span>&lt;span class="p">(),&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="nx">review&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Response&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">status&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="nx">review&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kc">nil&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="nx">klog&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">InfoS&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;successfully validated configuration, accepting&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;ingress&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Sprintf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;%v/%v&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">review&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Request&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Name&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">review&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Request&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Namespace&lt;/span>&lt;span class="p">))&lt;/span>
&lt;span class="nx">status&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Allowed&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="kc">true&lt;/span>
&lt;span class="nx">review&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Response&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">status&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="nx">review&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kc">nil&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ ¸å¿ƒå¤„ç†é€»è¾‘å…¶å®å°±æ˜¯å¤„ç†è¯·æ±‚ Webhook æ—¶å€™å‘é€çš„ &lt;code>AdmissionReview&lt;/code> ï¼Œå®ƒä¼šåŒ…å«ç€æˆ‘ä»¬å¾…æ ¡éªŒçš„èµ„æºå¯¹è±¡ã€‚ç„¶åæˆ‘ä»¬å°±æŒ‰ç…§å®é™…çš„éœ€è¦å¯¹èµ„æºå¯¹è±¡è¿›è¡Œæ ¡éªŒæˆ–è€…ä¿®æ”¹äº†ã€‚&lt;/p>
&lt;p>è¿™é‡Œéœ€è¦æ³¨æ„å‡ ä¸ªç‚¹ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>Mutating Webhook çš„å¤„ç†æ˜¯ä¸²è¡Œçš„ï¼Œè€Œ Validating Webhook æ˜¯å¹¶è¡Œå¤„ç†çš„ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Mutating Webhook è™½ç„¶å¤„ç†æ˜¯ä¸²è¡Œçš„ï¼Œä½†æ˜¯å¹¶ä¸ä¿è¯é¡ºåºï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æ³¨æ„å¯¹ Mutating Webhook çš„å¤„ç†åšåˆ°å¹‚ç­‰æ€§ï¼Œä»¥å…ç»“æœä¸ç¬¦åˆé¢„æœŸï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>è¯·æ±‚å¤„ç†æ—¶ï¼Œæ³¨æ„è¦å¤„ç†èµ„æºå¯¹è±¡çš„æ‰€æœ‰ API ç‰ˆæœ¬ï¼›&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="å¦‚ä½•éƒ¨ç½²-admission-webhook">å¦‚ä½•éƒ¨ç½² Admission Webhook&lt;/h3>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">admissionregistration.k8s.io/v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ValidatingWebhookConfiguration&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">labels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">app.kubernetes.io/name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ingress-nginx&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ingress-nginx-admission&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">webhooks&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">validate.nginx.ingress.kubernetes.io&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">matchPolicy&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Equivalent&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">rules&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">apiGroups&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="l">networking.k8s.io&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">apiVersions&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="l">v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">operations&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="l">CREATE&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="l">UPDATE&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">resources&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="l">ingresses&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">failurePolicy&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Fail&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">sideEffects&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">None&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">admissionReviewVersions&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="l">v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">clientConfig&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">service&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">namespace&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ingress-nginx&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ingress-nginx-controller-admission&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">path&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/networking/v1/ingresses&lt;/span>&lt;span class="w">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åœ¨ &lt;code>webhooks&lt;/code> ä¸­é…ç½® webhook çš„å…·ä½“è¿æ¥ä¿¡æ¯ï¼Œä»¥åŠè§¦å‘è§„åˆ™ã€‚&lt;code>rules&lt;/code>ä¸­å¯æŒ‡å®šå¯¹å“ªäº›èµ„æºçš„å…·ä½“è¡Œä¸ºç”Ÿæ•ˆã€‚&lt;/p>
&lt;h2 id="æ€»ç»“">æ€»ç»“&lt;/h2>
&lt;p>æœ¬ç¯‡ä¸»è¦ä»‹ç»äº† Kubernetes ä¸­çš„ Admission Controller ï¼Œé»˜è®¤æƒ…å†µä¸‹æœ‰ä¸€äº›å·²ç»ä»¥æ’ä»¶å½¢å¼ä¸ kube-apiserver ç¼–è¯‘åˆ°äº†ä¸€èµ·ï¼Œå¦å¤–æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡è‡ªå·±ç¼–å†™åŠ¨æ€å‡†å…¥æ§åˆ¶å™¨æ¥å®Œæˆç›¸å…³çš„éœ€æ±‚ã€‚&lt;/p>
&lt;p>å½“ç„¶ï¼Œç›®å‰åœ¨ K8s ç”Ÿæ€ä¸­å·²ç»æœ‰å¾ˆå¤šç°æˆçš„å·¥å…·å¯ä»¥å¸®æˆ‘ä»¬å®Œæˆå¯¹åº”çš„è¿™äº›äº‹æƒ…äº†ï¼Œå¾ˆå¤šæƒ…å†µä¸‹ä¸éœ€è¦å†è‡ªè¡Œå¼€å‘å¯¹åº”çš„æœåŠ¡äº†ã€‚åç»­æˆ‘æ¥ä¸ºå¤§å®¶åˆ†äº«å½“å‰ä¸€äº›æ¯”è¾ƒä¸»æµçš„ï¼Œå¯ç”¨äºè¿›è¡Œ Mutating å’Œ Validating å‡†å…¥æ§åˆ¶çš„å·¥å…·ï¼Œ æ¬¢è¿å…³æ³¨ã€‚&lt;/p>
&lt;hr>
&lt;p>æ¬¢è¿è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://gitee.com/tlrr/awesome/raw/master/2020-9-9/1599632564572-mp-qrcode.png" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category><category domain="https://moelove.info/tags/Linux/">Linux</category></item><item><title>æ–°åŠŸèƒ½ï¼šPrometheus Agent æ¨¡å¼ä¸Šæ‰‹ä½“éªŒ</title><link>https://moelove.info/2021/11/28/%E6%96%B0%E5%8A%9F%E8%83%BDPrometheus-Agent-%E6%A8%A1%E5%BC%8F%E4%B8%8A%E6%89%8B%E4%BD%93%E9%AA%8C/</link><guid isPermaLink="true">https://moelove.info/2021/11/28/%E6%96%B0%E5%8A%9F%E8%83%BDPrometheus-Agent-%E6%A8%A1%E5%BC%8F%E4%B8%8A%E6%89%8B%E4%BD%93%E9%AA%8C/</guid><pubDate>Sun, 28 Nov 2021 00:26:44 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å¼ æ™‹æ¶›ã€‚&lt;/p>
&lt;p>Prometheus å‡ ä¹å·²ç»æˆä¸ºäº†äº‘åŸç”Ÿæ—¶ä»£ä¸‹ç›‘æ§é€‰å‹çš„äº‹å®æ ‡å‡†ï¼Œå®ƒä¹Ÿæ˜¯ç¬¬äºŒä¸ªä» CNCF æ¯•ä¸šçš„é¡¹ç›®ã€‚&lt;/p>
&lt;p>å½“å‰ï¼ŒPrometheus å‡ ä¹å¯ä»¥æ»¡è¶³å„ç§åœºæ™¯/æœåŠ¡çš„ç›‘æ§éœ€æ±‚ã€‚æˆ‘ä¹‹å‰æœ‰å†™è¿‡ä¸€äº›æ–‡ç« ä»‹ç»è¿‡ Prometheus åŠå…¶ç”Ÿæ€ï¼Œæœ¬ç¯‡æˆ‘ä»¬å°†èšç„¦äº Prometheus æœ€æ–°ç‰ˆæœ¬ä¸­å‘å¸ƒçš„ Agent æ¨¡å¼ï¼Œå¯¹äºä¸æ­¤ä¸»é¢˜æ— å…³çš„ä¸€äº›æ¦‚å¿µæˆ–è€…ç”¨æ³•ï¼Œæˆ‘ä¼šç²—ç•¥å¸¦è¿‡ã€‚&lt;/p>
&lt;h2 id="æ‹‰æ¨¡å¼pullå’Œ-æ¨æ¨¡å¼push">æ‹‰æ¨¡å¼ï¼ˆPullï¼‰å’Œ æ¨æ¨¡å¼ï¼ˆPushï¼‰&lt;/h2>
&lt;p>ä¼—æ‰€å‘¨çŸ¥ï¼ŒPrometheus æ˜¯ä¸€ç§æ‹‰æ¨¡å¼ï¼ˆPullï¼‰çš„ç›‘æ§ç³»ç»Ÿï¼Œè¿™ä¸åŒäºä¼ ç»Ÿçš„åŸºäºæ¨æ¨¡å¼ï¼ˆPushï¼‰çš„ç›‘æ§ç³»ç»Ÿã€‚&lt;/p>
&lt;p>ä»€ä¹ˆæ˜¯æ‹‰æ¨¡å¼ï¼ˆPullï¼‰å‘¢ï¼Ÿ&lt;/p>
&lt;p>&lt;img src="https://i.loli.net/2021/11/28/yAYWuiLRdks7BgZ.png" alt="Prometheus Pull model">&lt;/p>
&lt;p>å¾…ç›‘æ§çš„æœåŠ¡è‡ªèº«æˆ–è€…é€šè¿‡ä¸€äº› exporter æš´éœ²å‡ºæ¥ä¸€äº› metrics æŒ‡æ ‡çš„æ¥å£ï¼Œç”± Prometheus å»ä¸»åŠ¨çš„å®šæ—¶è¿›è¡ŒæŠ“å–/é‡‡é›†ï¼Œè¿™å°±æ˜¯æ‹‰æ¨¡å¼ï¼ˆPullï¼‰ã€‚å³ç”±ç›‘æ§ç³»ç»Ÿä¸»åŠ¨çš„å»æ‹‰ï¼ˆPullï¼‰ç›®æ ‡çš„ metricsã€‚&lt;/p>
&lt;p>ä¸ä¹‹ç›¸å¯¹åº”çš„å°±æ˜¯æ¨æ¨¡å¼ï¼ˆPushï¼‰äº†ã€‚&lt;/p>
&lt;p>&lt;img src="https://i.loli.net/2021/11/28/Vki54At9fCXrm6Z.png" alt="Monitor Push model">&lt;/p>
&lt;p>ç”±åº”ç”¨ç¨‹åºä¸»åŠ¨å°†è‡ªèº«çš„ä¸€äº› metrics æŒ‡æ ‡è¿›è¡Œä¸ŠæŠ¥ï¼Œç›‘æ§ç³»ç»Ÿå†è¿›è¡Œç›¸å¯¹åº”çš„å¤„ç†ã€‚å¦‚æœå¯¹äºæŸäº›åº”ç”¨ç¨‹åºçš„ç›‘æ§æƒ³è¦ä½¿ç”¨æ¨æ¨¡å¼ï¼ˆPushï¼‰ï¼Œæ¯”å¦‚ï¼šä¸æ˜“å®ç° metrics æ¥å£ç­‰åŸå› ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ Pushgateway æ¥å®Œæˆã€‚&lt;/p>
&lt;p>å¯¹äºæ‹‰æ¨¡å¼ï¼ˆPullï¼‰å’Œæ¨æ¨¡å¼ï¼ˆPushï¼‰åˆ°åº•å“ªç§æ›´å¥½çš„è®¨è®ºä¸€ç›´éƒ½åœ¨ç»§ç»­ï¼Œæœ‰å…´è¶£çš„å°ä¼™ä¼´å¯ä»¥è‡ªè¡Œæœç´¢ä¸‹ã€‚&lt;/p>
&lt;p>è¿™é‡Œä¸»è¦æ˜¯èšç„¦äºå•ä¸ª Prometheus å’Œåº”ç”¨æœåŠ¡ä¹‹é—´äº¤äº’çš„æ‰‹æ–¹å¼ã€‚æœ¬ç¯‡æˆ‘ä»¬ä»æ›´ä¸Šå±‚çš„è§’åº¦æˆ–è€…å…¨å±€è§’åº¦æ¥çœ‹çœ‹å½“å‰ Prometheus æ˜¯å¦‚ä½•åš HAã€ æŒä¹…åŒ–å’Œé›†ç¾¤çš„ã€‚&lt;/p>
&lt;h2 id="prometheus-haæŒä¹…åŒ–é›†ç¾¤çš„æ–¹æ¡ˆ">Prometheus HA/æŒä¹…åŒ–/é›†ç¾¤çš„æ–¹æ¡ˆ&lt;/h2>
&lt;p>åœ¨å¤§è§„æ¨¡ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨æ—¶ï¼Œå¾ˆå°‘æœ‰ç³»ç»Ÿä¸­ä»…æœ‰ä¸€ä¸ªå•å®ä¾‹ Prometheus å­˜åœ¨çš„æƒ…å†µå‡ºç°ã€‚æ— è®ºä»é«˜å¯ç”¨ã€æ•°æ®æŒä¹…åŒ–è¿˜æ˜¯ä»ä¸ºç”¨æˆ·æä¾›æ›´æ˜“ç”¨çš„å…¨å±€è§†å›¾æ¥è€ƒè™‘ï¼Œè¿è¡Œå¤šä¸ª Prometheus å®ä¾‹çš„æƒ…å†µå°±å¾ˆå¸¸è§äº†ã€‚&lt;/p>
&lt;p>ç›®å‰ Prometheus ä¸»è¦æœ‰ä¸‰ç§åŠæ³•æ¥å°†å¤šä¸ª Prometheus å®ä¾‹çš„æ•°æ®è¿›è¡Œèšåˆï¼Œå¹¶ç»™ç”¨æˆ·æä¾›ä¸€ä¸ªç»Ÿä¸€çš„å…¨å±€è§†å›¾ã€‚&lt;/p>
&lt;p>&lt;img src="https://i.loli.net/2021/11/28/Vu61jXHeR2i5zsp.png" alt="">&lt;/p>
&lt;ul>
&lt;li>è”é‚¦ï¼ˆFederationï¼‰ï¼šæ˜¯æœ€æ—©æœŸçš„ Prometheus å†…ç½®çš„æ•°æ®èšåˆæ–¹æ¡ˆã€‚è¿™ç§æ–¹æ¡ˆä¸‹ï¼Œå¯ä»¥ä½¿ç”¨æŸä¸ªä¸­å¿ƒ Prometheus å®ä¾‹ä»å¶å­ Prometheus å®ä¾‹ä¸Šè¿›è¡ŒæŒ‡æ ‡çš„æŠ“å–ã€‚è¿™ç§æ–¹æ¡ˆä¸‹å¯ä»¥ä¿ç•™ metrics åŸæœ¬çš„æ—¶é—´æˆ³ï¼Œæ•´ä½“ä¹Ÿæ¯”è¾ƒç®€å•ï¼›&lt;/li>
&lt;li>Prometheus Remote Readï¼ˆè¿œç¨‹è¯»ï¼‰ï¼šå¯ä»¥æ”¯æŒä»è¿œç¨‹çš„å­˜å‚¨ä¸­è¯»å–åŸå§‹ metricsï¼Œæ³¨æ„ï¼šè¿™é‡Œçš„è¿œç¨‹å­˜å‚¨å¯ä»¥æœ‰å¤šç§é€‰æ‹©ã€‚å½“è¯»å–å®Œæ•°æ®åï¼Œä¾¿å¯å¯¹å®ƒä»¬è¿›è¡Œèšåˆï¼Œå¹¶å±•ç°ç»™ç”¨æˆ·äº†ï¼›&lt;/li>
&lt;li>Prometheus Remote Writeï¼ˆè¿œç¨‹å†™ï¼‰ï¼šå¯ä»¥æ”¯æŒå°† Prometheus é‡‡é›†åˆ° metrics ç­‰å†™åˆ°è¿œç¨‹å­˜å‚¨ä¸­ã€‚ç”¨æˆ·åœ¨ä½¿ç”¨çš„æ—¶å€™ï¼Œç›´æ¥ä»è¿œç«¯å­˜å‚¨ä¸­è¯»å–æ•°æ®ï¼Œå¹¶æä¾›å…¨å±€è§†å›¾ç­‰ï¼›&lt;/li>
&lt;/ul>
&lt;h2 id="prometheus-agent-æ¨¡å¼">Prometheus Agent æ¨¡å¼&lt;/h2>
&lt;p>Prometheus Agent æ˜¯è‡ª Prometheus v2.32.0 å¼€å§‹å°†ä¼šæä¾›çš„ä¸€é¡¹åŠŸèƒ½ï¼Œå®ƒä¸»è¦æ˜¯é‡‡ç”¨ä¸Šæ–‡ä¸­æåˆ°çš„ &lt;strong>Prometheus Remote Write&lt;/strong> çš„æ–¹å¼ï¼Œå°†å¯ç”¨äº† Agent æ¨¡å¼çš„ Prometheus å®ä¾‹çš„æ•°æ®å†™å…¥åˆ°è¿œç¨‹å­˜å‚¨ä¸­ã€‚å¹¶å€ŸåŠ©è¿œç¨‹å­˜å‚¨æ¥æä¾›ä¸€ä¸ªå…¨å±€è§†å›¾ã€‚&lt;/p>
&lt;h3 id="å‰ç½®ä¾èµ–">å‰ç½®ä¾èµ–&lt;/h3>
&lt;p>ç”±äºå®ƒä½¿ç”¨äº† &lt;strong>Prometheus Remote Write&lt;/strong> çš„æ–¹å¼ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å…ˆå‡†å¤‡ä¸€ä¸ª &amp;quot;è¿œç¨‹å­˜å‚¨&amp;quot; ç”¨äº metrcis çš„ä¸­å¿ƒåŒ–å­˜å‚¨ã€‚è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ &lt;a href="https://github.com/thanos-io/thanos">Thanos&lt;/a> æ¥æä¾›æ­¤èƒ½åŠ›ã€‚å½“ç„¶ï¼Œå¦‚æœä½ æƒ³è¦ä½¿ç”¨å…¶ä»–çš„æ–¹æ¡ˆï¼Œæ¯”å¦‚ï¼š Cortexã€influxDB ç­‰ä¹Ÿéƒ½æ˜¯å¯ä»¥çš„ã€‚&lt;/p>
&lt;h4 id="å‡†å¤‡è¿œç¨‹å­˜å‚¨">å‡†å¤‡è¿œç¨‹å­˜å‚¨&lt;/h4>
&lt;p>è¿™é‡Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨ Thanos æœ€æ–°ç‰ˆæœ¬çš„å®¹å™¨é•œåƒæ¥è¿›è¡Œéƒ¨ç½²ã€‚è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº† &lt;code>host&lt;/code> ç½‘ç»œæ¯”è¾ƒæ–¹ä¾¿è¿›è¡Œæµ‹è¯•ã€‚&lt;/p>
&lt;p>æ‰§è¡Œå®Œè¿™äº›å‘½ä»¤åï¼ŒThanos receive å°†ä¼šç›‘å¬åœ¨ &lt;code>http://127.0.0.1:10908/api/v1/receive&lt;/code> ç”¨äºæ¥æ”¶&amp;quot;è¿œç¨‹å†™å…¥&amp;quot;ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">âœ &lt;span class="nb">cd&lt;/span> prometheus
âœ prometheus docker run -d --rm &lt;span class="se">\
&lt;/span>&lt;span class="se">&lt;/span> -v &lt;span class="k">$(&lt;/span>&lt;span class="nb">pwd&lt;/span>&lt;span class="k">)&lt;/span>/receive-data:/receive/data &lt;span class="se">\
&lt;/span>&lt;span class="se">&lt;/span> --net&lt;span class="o">=&lt;/span>host &lt;span class="se">\
&lt;/span>&lt;span class="se">&lt;/span> --name receive &lt;span class="se">\
&lt;/span>&lt;span class="se">&lt;/span> quay.io/thanos/thanos:v0.23.1 &lt;span class="se">\
&lt;/span>&lt;span class="se">&lt;/span> receive &lt;span class="se">\
&lt;/span>&lt;span class="se">&lt;/span> --tsdb.path &lt;span class="s2">&amp;#34;/receive/data&amp;#34;&lt;/span> &lt;span class="se">\
&lt;/span>&lt;span class="se">&lt;/span> --grpc-address 127.0.0.1:10907 &lt;span class="se">\
&lt;/span>&lt;span class="se">&lt;/span> --http-address 127.0.0.1:10909 &lt;span class="se">\
&lt;/span>&lt;span class="se">&lt;/span> --label &lt;span class="s2">&amp;#34;receive_replica=\&amp;#34;0\&amp;#34;&amp;#34;&lt;/span> &lt;span class="se">\
&lt;/span>&lt;span class="se">&lt;/span> --label &lt;span class="s2">&amp;#34;receive_cluster=\&amp;#34;moelove\&amp;#34;&amp;#34;&lt;/span> &lt;span class="se">\
&lt;/span>&lt;span class="se">&lt;/span> --remote-write.address 127.0.0.1:10908
59498d43291b705709b3f360d28af81d5a8daba11f5629bb11d6e07532feb8b6
âœ prometheus docker ps -l
CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES
59498d43291b quay.io/thanos/thanos:v0.23.1 &lt;span class="s2">&amp;#34;/bin/thanos receiveâ€¦&amp;#34;&lt;/span> &lt;span class="m">21&lt;/span> seconds ago Up &lt;span class="m">20&lt;/span> seconds receive
&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="å‡†å¤‡æŸ¥è¯¢ç»„ä»¶">å‡†å¤‡æŸ¥è¯¢ç»„ä»¶&lt;/h4>
&lt;p>æ¥ä¸‹æ¥æˆ‘ä»¬å¯åŠ¨ä¸€ä¸ª Thanos çš„ query ç»„ä»¶ï¼Œè·Ÿ receive ç»„ä»¶è¿æ¥ï¼Œç”¨äºæŸ¥è¯¢å†™å…¥çš„æ•°æ®ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">âœ prometheus docker run -d --rm &lt;span class="se">\
&lt;/span>&lt;span class="se">&lt;/span>--net&lt;span class="o">=&lt;/span>host &lt;span class="se">\
&lt;/span>&lt;span class="se">&lt;/span>--name query &lt;span class="se">\
&lt;/span>&lt;span class="se">&lt;/span>quay.io/thanos/thanos:v0.23.1 &lt;span class="se">\
&lt;/span>&lt;span class="se">&lt;/span>query &lt;span class="se">\
&lt;/span>&lt;span class="se">&lt;/span>--http-address &lt;span class="s2">&amp;#34;0.0.0.0:39090&amp;#34;&lt;/span> &lt;span class="se">\
&lt;/span>&lt;span class="se">&lt;/span>--store &lt;span class="s2">&amp;#34;127.0.0.1:10907&amp;#34;&lt;/span>
10c2b1bf2375837dbda16d09cee43d95787243f6dcbee73f4159a21b12d36019
âœ prometheus docker ps -l
CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES
10c2b1bf2375 quay.io/thanos/thanos:v0.23.1 &lt;span class="s2">&amp;#34;/bin/thanos query -â€¦&amp;#34;&lt;/span> &lt;span class="m">4&lt;/span> seconds ago Up &lt;span class="m">3&lt;/span> seconds query
&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ³¨æ„ï¼šè¿™é‡Œæˆ‘ä»¬é…ç½®äº† &lt;code>--store&lt;/code> å­—æ®µï¼ŒæŒ‡å‘äº†å‰é¢çš„ receive ç»„ä»¶ã€‚&lt;/p>
&lt;p>&lt;img src="https://i.loli.net/2021/11/28/Iq15lebL8UHFvWY.png" alt="">&lt;/p>
&lt;p>æ‰“å¼€æµè§ˆå™¨è®¿é—® http://127.0.0.1:39090/stores ï¼Œå¦‚æœä¸€èµ·é¡ºåˆ©ï¼Œä½ åº”è¯¥å¯ä»¥çœ‹åˆ° receive å·²ç»æ³¨å†Œåˆ°äº† store ä¸­ã€‚&lt;/p>
&lt;h3 id="éƒ¨ç½²-prometheus-agent-æ¨¡å¼">éƒ¨ç½² Prometheus Agent æ¨¡å¼&lt;/h3>
&lt;p>è¿™é‡Œæˆ‘ç›´æ¥ä» Prometheus çš„ &lt;a href="https://github.com/prometheus/prometheus/releases/tag/v2.32.0-beta.0">Release é¡µé¢&lt;/a> ä¸‹è½½äº†å®ƒæœ€æ–°ç‰ˆæœ¬ v2.32.0 çš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚è§£å‹åï¼Œä½ ä¼šå‘ç°ç›®å½•ä¸­çš„å†…å®¹å’Œä¹‹å‰ç‰ˆæœ¬ä¸­æ˜¯ä¸€è‡´çš„ã€‚&lt;/p>
&lt;p>è¿™æ˜¯å› ä¸º &lt;strong>Prometheus Agent æ¨¡å¼ç°åœ¨æ˜¯å†…ç½®åœ¨ Prometheus äºŒè¿›åˆ¶æ–‡ä»¶ä¸­çš„ï¼Œå¢åŠ  &lt;code>--enable-feature=agent&lt;/code> é€‰é¡¹å³å¯å¯ç”¨ã€‚&lt;/strong>&lt;/p>
&lt;h4 id="å‡†å¤‡é…ç½®æ–‡ä»¶">å‡†å¤‡é…ç½®æ–‡ä»¶&lt;/h4>
&lt;p>æˆ‘ä»¬éœ€è¦ä¸ºå®ƒå‡†å¤‡ä¸€ä»½é…ç½®æ–‡ä»¶ï¼Œæ³¨æ„ï¼Œ &lt;strong>éœ€è¦é…ç½® remote_write ï¼Œä¸”ä¸èƒ½æœ‰ alerting ä¹‹ç±»çš„é…ç½®&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="nt">global&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">scrape_interval&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">15s&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">external_labels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">cluster&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">moelove&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">replica&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">0&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">scrape_configs&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">job_name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;prometheus&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">static_configs&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">targets&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;localhost:9090&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">remote_write&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>- &lt;span class="nt">url&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;http://127.0.0.1:10908/api/v1/receive&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>é…ç½®æ–‡ä»¶å¦å­˜ä¸º &lt;code>prometheus.yml&lt;/code>&lt;/p>
&lt;h4 id="å¯åŠ¨">å¯åŠ¨&lt;/h4>
&lt;p>æˆ‘ä»¬å°†å®ƒçš„æ—¥å¿—çº§åˆ«è®¾ç½®æˆ debug æ–¹ä¾¿æŸ¥çœ‹å®ƒçš„ä¸€äº›ç»†èŠ‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">âœ ./prometheus --enable-feature&lt;span class="o">=&lt;/span>agent --log.level&lt;span class="o">=&lt;/span>debug --config.file&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;prometheus.yml&amp;#34;&lt;/span>
&lt;span class="nv">ts&lt;/span>&lt;span class="o">=&lt;/span>2021-11-27T19:03:15.861Z &lt;span class="nv">caller&lt;/span>&lt;span class="o">=&lt;/span>main.go:195 &lt;span class="nv">level&lt;/span>&lt;span class="o">=&lt;/span>info &lt;span class="nv">msg&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;Experimental agent mode enabled.&amp;#34;&lt;/span>
&lt;span class="nv">ts&lt;/span>&lt;span class="o">=&lt;/span>2021-11-27T19:03:15.861Z &lt;span class="nv">caller&lt;/span>&lt;span class="o">=&lt;/span>main.go:515 &lt;span class="nv">level&lt;/span>&lt;span class="o">=&lt;/span>info &lt;span class="nv">msg&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;Starting Prometheus&amp;#34;&lt;/span> &lt;span class="nv">version&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;(version=2.32.0-beta.0, branch=HEAD, revision=c32725ba7873dbaa39c223410043430ffa5a26c0)&amp;#34;&lt;/span>
&lt;span class="nv">ts&lt;/span>&lt;span class="o">=&lt;/span>2021-11-27T19:03:15.861Z &lt;span class="nv">caller&lt;/span>&lt;span class="o">=&lt;/span>main.go:520 &lt;span class="nv">level&lt;/span>&lt;span class="o">=&lt;/span>info &lt;span class="nv">build_context&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;(go=go1.17.3, user=root@da630543d231, date=20211116-11:23:14)&amp;#34;&lt;/span>
&lt;span class="nv">ts&lt;/span>&lt;span class="o">=&lt;/span>2021-11-27T19:03:15.861Z &lt;span class="nv">caller&lt;/span>&lt;span class="o">=&lt;/span>main.go:521 &lt;span class="nv">level&lt;/span>&lt;span class="o">=&lt;/span>info &lt;span class="nv">host_details&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;(Linux 5.14.18-200.fc34.x86_64 #1 SMP Fri Nov 12 16:48:10 UTC 2021 x86_64 moelove (none))&amp;#34;&lt;/span>
&lt;span class="nv">ts&lt;/span>&lt;span class="o">=&lt;/span>2021-11-27T19:03:15.861Z &lt;span class="nv">caller&lt;/span>&lt;span class="o">=&lt;/span>main.go:522 &lt;span class="nv">level&lt;/span>&lt;span class="o">=&lt;/span>info &lt;span class="nv">fd_limits&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;(soft=1024, hard=524288)&amp;#34;&lt;/span>
&lt;span class="nv">ts&lt;/span>&lt;span class="o">=&lt;/span>2021-11-27T19:03:15.861Z &lt;span class="nv">caller&lt;/span>&lt;span class="o">=&lt;/span>main.go:523 &lt;span class="nv">level&lt;/span>&lt;span class="o">=&lt;/span>info &lt;span class="nv">vm_limits&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;(soft=unlimited, hard=unlimited)&amp;#34;&lt;/span>
&lt;span class="nv">ts&lt;/span>&lt;span class="o">=&lt;/span>2021-11-27T19:03:15.862Z &lt;span class="nv">caller&lt;/span>&lt;span class="o">=&lt;/span>web.go:546 &lt;span class="nv">level&lt;/span>&lt;span class="o">=&lt;/span>info &lt;span class="nv">component&lt;/span>&lt;span class="o">=&lt;/span>web &lt;span class="nv">msg&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;Start listening for connections&amp;#34;&lt;/span> &lt;span class="nv">address&lt;/span>&lt;span class="o">=&lt;/span>0.0.0.0:9090
&lt;span class="nv">ts&lt;/span>&lt;span class="o">=&lt;/span>2021-11-27T19:03:15.862Z &lt;span class="nv">caller&lt;/span>&lt;span class="o">=&lt;/span>main.go:980 &lt;span class="nv">level&lt;/span>&lt;span class="o">=&lt;/span>info &lt;span class="nv">msg&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;Starting WAL storage ...&amp;#34;&lt;/span>
&lt;span class="nv">ts&lt;/span>&lt;span class="o">=&lt;/span>2021-11-27T19:03:15.863Z &lt;span class="nv">caller&lt;/span>&lt;span class="o">=&lt;/span>tls_config.go:195 &lt;span class="nv">level&lt;/span>&lt;span class="o">=&lt;/span>info &lt;span class="nv">component&lt;/span>&lt;span class="o">=&lt;/span>web &lt;span class="nv">msg&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;TLS is disabled.&amp;#34;&lt;/span> &lt;span class="nv">http2&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nb">false&lt;/span>
&lt;span class="nv">ts&lt;/span>&lt;span class="o">=&lt;/span>2021-11-27T19:03:15.864Z &lt;span class="nv">caller&lt;/span>&lt;span class="o">=&lt;/span>db.go:306 &lt;span class="nv">level&lt;/span>&lt;span class="o">=&lt;/span>info &lt;span class="nv">msg&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;replaying WAL, this may take a while&amp;#34;&lt;/span> &lt;span class="nv">dir&lt;/span>&lt;span class="o">=&lt;/span>data-agent/wal
&lt;span class="nv">ts&lt;/span>&lt;span class="o">=&lt;/span>2021-11-27T19:03:15.864Z &lt;span class="nv">caller&lt;/span>&lt;span class="o">=&lt;/span>db.go:357 &lt;span class="nv">level&lt;/span>&lt;span class="o">=&lt;/span>info &lt;span class="nv">msg&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;WAL segment loaded&amp;#34;&lt;/span> &lt;span class="nv">segment&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">maxSegment&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span>
&lt;span class="nv">ts&lt;/span>&lt;span class="o">=&lt;/span>2021-11-27T19:03:15.864Z &lt;span class="nv">caller&lt;/span>&lt;span class="o">=&lt;/span>main.go:1001 &lt;span class="nv">level&lt;/span>&lt;span class="o">=&lt;/span>info &lt;span class="nv">fs_type&lt;/span>&lt;span class="o">=&lt;/span>9123683e
&lt;span class="nv">ts&lt;/span>&lt;span class="o">=&lt;/span>2021-11-27T19:03:15.864Z &lt;span class="nv">caller&lt;/span>&lt;span class="o">=&lt;/span>main.go:1004 &lt;span class="nv">level&lt;/span>&lt;span class="o">=&lt;/span>info &lt;span class="nv">msg&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;Agent WAL storage started&amp;#34;&lt;/span>
&lt;span class="nv">ts&lt;/span>&lt;span class="o">=&lt;/span>2021-11-27T19:03:15.864Z &lt;span class="nv">caller&lt;/span>&lt;span class="o">=&lt;/span>main.go:1005 &lt;span class="nv">level&lt;/span>&lt;span class="o">=&lt;/span>debug &lt;span class="nv">msg&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;Agent WAL storage options&amp;#34;&lt;/span> &lt;span class="nv">WALSegmentSize&lt;/span>&lt;span class="o">=&lt;/span>0B &lt;span class="nv">WALCompression&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nb">true&lt;/span> &lt;span class="nv">StripeSize&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">TruncateFrequency&lt;/span>&lt;span class="o">=&lt;/span>0s &lt;span class="nv">MinWALTime&lt;/span>&lt;span class="o">=&lt;/span>0s &lt;span class="nv">MaxWALTime&lt;/span>&lt;span class="o">=&lt;/span>0s
&lt;span class="nv">ts&lt;/span>&lt;span class="o">=&lt;/span>2021-11-27T19:03:15.864Z &lt;span class="nv">caller&lt;/span>&lt;span class="o">=&lt;/span>main.go:1129 &lt;span class="nv">level&lt;/span>&lt;span class="o">=&lt;/span>info &lt;span class="nv">msg&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;Loading configuration file&amp;#34;&lt;/span> &lt;span class="nv">filename&lt;/span>&lt;span class="o">=&lt;/span>prometheus.yml
&lt;span class="nv">ts&lt;/span>&lt;span class="o">=&lt;/span>2021-11-27T19:03:15.865Z &lt;span class="nv">caller&lt;/span>&lt;span class="o">=&lt;/span>dedupe.go:112 &lt;span class="nv">component&lt;/span>&lt;span class="o">=&lt;/span>remote &lt;span class="nv">level&lt;/span>&lt;span class="o">=&lt;/span>info &lt;span class="nv">remote_name&lt;/span>&lt;span class="o">=&lt;/span>e6fa2a &lt;span class="nv">url&lt;/span>&lt;span class="o">=&lt;/span>http://127.0.0.1:10908/api/v1/receive &lt;span class="nv">msg&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;Starting WAL watcher&amp;#34;&lt;/span> &lt;span class="nv">queue&lt;/span>&lt;span class="o">=&lt;/span>e6fa2a
&lt;span class="nv">ts&lt;/span>&lt;span class="o">=&lt;/span>2021-11-27T19:03:15.865Z &lt;span class="nv">caller&lt;/span>&lt;span class="o">=&lt;/span>dedupe.go:112 &lt;span class="nv">component&lt;/span>&lt;span class="o">=&lt;/span>remote &lt;span class="nv">level&lt;/span>&lt;span class="o">=&lt;/span>info &lt;span class="nv">remote_name&lt;/span>&lt;span class="o">=&lt;/span>e6fa2a &lt;span class="nv">url&lt;/span>&lt;span class="o">=&lt;/span>http://127.0.0.1:10908/api/v1/receive &lt;span class="nv">msg&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;Starting scraped metadata watcher&amp;#34;&lt;/span>
&lt;span class="nv">ts&lt;/span>&lt;span class="o">=&lt;/span>2021-11-27T19:03:15.865Z &lt;span class="nv">caller&lt;/span>&lt;span class="o">=&lt;/span>dedupe.go:112 &lt;span class="nv">component&lt;/span>&lt;span class="o">=&lt;/span>remote &lt;span class="nv">level&lt;/span>&lt;span class="o">=&lt;/span>info &lt;span class="nv">remote_name&lt;/span>&lt;span class="o">=&lt;/span>e6fa2a &lt;span class="nv">url&lt;/span>&lt;span class="o">=&lt;/span>http://127.0.0.1:10908/api/v1/receive &lt;span class="nv">msg&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;Replaying WAL&amp;#34;&lt;/span> &lt;span class="nv">queue&lt;/span>&lt;span class="o">=&lt;/span>e6fa2a
&lt;span class="nv">ts&lt;/span>&lt;span class="o">=&lt;/span>2021-11-27T19:03:15.865Z &lt;span class="nv">caller&lt;/span>&lt;span class="o">=&lt;/span>dedupe.go:112 &lt;span class="nv">component&lt;/span>&lt;span class="o">=&lt;/span>remote &lt;span class="nv">level&lt;/span>&lt;span class="o">=&lt;/span>debug &lt;span class="nv">remote_name&lt;/span>&lt;span class="o">=&lt;/span>e6fa2a &lt;span class="nv">url&lt;/span>&lt;span class="o">=&lt;/span>http://127.0.0.1:10908/api/v1/receive &lt;span class="nv">msg&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;Tailing WAL&amp;#34;&lt;/span> &lt;span class="nv">lastCheckpoint&lt;/span>&lt;span class="o">=&lt;/span> &lt;span class="nv">checkpointIndex&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">currentSegment&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">lastSegment&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span>
&lt;span class="nv">ts&lt;/span>&lt;span class="o">=&lt;/span>2021-11-27T19:03:15.865Z &lt;span class="nv">caller&lt;/span>&lt;span class="o">=&lt;/span>dedupe.go:112 &lt;span class="nv">component&lt;/span>&lt;span class="o">=&lt;/span>remote &lt;span class="nv">level&lt;/span>&lt;span class="o">=&lt;/span>debug &lt;span class="nv">remote_name&lt;/span>&lt;span class="o">=&lt;/span>e6fa2a &lt;span class="nv">url&lt;/span>&lt;span class="o">=&lt;/span>http://127.0.0.1:10908/api/v1/receive &lt;span class="nv">msg&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;Processing segment&amp;#34;&lt;/span> &lt;span class="nv">currentSegment&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span>
&lt;span class="nv">ts&lt;/span>&lt;span class="o">=&lt;/span>2021-11-27T19:03:15.877Z &lt;span class="nv">caller&lt;/span>&lt;span class="o">=&lt;/span>manager.go:196 &lt;span class="nv">level&lt;/span>&lt;span class="o">=&lt;/span>debug &lt;span class="nv">component&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;discovery manager scrape&amp;#34;&lt;/span> &lt;span class="nv">msg&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;Starting provider&amp;#34;&lt;/span> &lt;span class="nv">provider&lt;/span>&lt;span class="o">=&lt;/span>static/0 &lt;span class="nv">subs&lt;/span>&lt;span class="o">=[&lt;/span>prometheus&lt;span class="o">]&lt;/span>
&lt;span class="nv">ts&lt;/span>&lt;span class="o">=&lt;/span>2021-11-27T19:03:15.877Z &lt;span class="nv">caller&lt;/span>&lt;span class="o">=&lt;/span>main.go:1166 &lt;span class="nv">level&lt;/span>&lt;span class="o">=&lt;/span>info &lt;span class="nv">msg&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;Completed loading of configuration file&amp;#34;&lt;/span> &lt;span class="nv">filename&lt;/span>&lt;span class="o">=&lt;/span>prometheus.yml &lt;span class="nv">totalDuration&lt;/span>&lt;span class="o">=&lt;/span>12.433099ms &lt;span class="nv">db_storage&lt;/span>&lt;span class="o">=&lt;/span>361ns &lt;span class="nv">remote_storage&lt;/span>&lt;span class="o">=&lt;/span>323.413Âµs &lt;span class="nv">web_handler&lt;/span>&lt;span class="o">=&lt;/span>247ns &lt;span class="nv">query_engine&lt;/span>&lt;span class="o">=&lt;/span>157ns &lt;span class="nv">scrape&lt;/span>&lt;span class="o">=&lt;/span>11.609215ms &lt;span class="nv">scrape_sd&lt;/span>&lt;span class="o">=&lt;/span>248.024Âµs &lt;span class="nv">notify&lt;/span>&lt;span class="o">=&lt;/span>3.216Âµs &lt;span class="nv">notify_sd&lt;/span>&lt;span class="o">=&lt;/span>6.338Âµs &lt;span class="nv">rules&lt;/span>&lt;span class="o">=&lt;/span>914ns
&lt;span class="nv">ts&lt;/span>&lt;span class="o">=&lt;/span>2021-11-27T19:03:15.877Z &lt;span class="nv">caller&lt;/span>&lt;span class="o">=&lt;/span>main.go:897 &lt;span class="nv">level&lt;/span>&lt;span class="o">=&lt;/span>info &lt;span class="nv">msg&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;Server is ready to receive web requests.&amp;#34;&lt;/span>
&lt;span class="nv">ts&lt;/span>&lt;span class="o">=&lt;/span>2021-11-27T19:03:15.877Z &lt;span class="nv">caller&lt;/span>&lt;span class="o">=&lt;/span>manager.go:214 &lt;span class="nv">level&lt;/span>&lt;span class="o">=&lt;/span>debug &lt;span class="nv">component&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;discovery manager scrape&amp;#34;&lt;/span> &lt;span class="nv">msg&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;Discoverer channel closed&amp;#34;&lt;/span> &lt;span class="nv">provider&lt;/span>&lt;span class="o">=&lt;/span>static/0
&lt;span class="nv">ts&lt;/span>&lt;span class="o">=&lt;/span>2021-11-27T19:03:28.196Z &lt;span class="nv">caller&lt;/span>&lt;span class="o">=&lt;/span>dedupe.go:112 &lt;span class="nv">component&lt;/span>&lt;span class="o">=&lt;/span>remote &lt;span class="nv">level&lt;/span>&lt;span class="o">=&lt;/span>info &lt;span class="nv">remote_name&lt;/span>&lt;span class="o">=&lt;/span>e6fa2a &lt;span class="nv">url&lt;/span>&lt;span class="o">=&lt;/span>http://127.0.0.1:10908/api/v1/receive &lt;span class="nv">msg&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;Done replaying WAL&amp;#34;&lt;/span> &lt;span class="nv">duration&lt;/span>&lt;span class="o">=&lt;/span>12.331255772s
&lt;span class="nv">ts&lt;/span>&lt;span class="o">=&lt;/span>2021-11-27T19:03:30.867Z &lt;span class="nv">caller&lt;/span>&lt;span class="o">=&lt;/span>dedupe.go:112 &lt;span class="nv">component&lt;/span>&lt;span class="o">=&lt;/span>remote &lt;span class="nv">level&lt;/span>&lt;span class="o">=&lt;/span>debug &lt;span class="nv">remote_name&lt;/span>&lt;span class="o">=&lt;/span>e6fa2a &lt;span class="nv">url&lt;/span>&lt;span class="o">=&lt;/span>http://127.0.0.1:10908/api/v1/receive &lt;span class="nv">msg&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;runShard timer ticked, sending buffered data&amp;#34;&lt;/span> &lt;span class="nv">samples&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">230&lt;/span> &lt;span class="nv">exemplars&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">shard&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span>
&lt;span class="nv">ts&lt;/span>&lt;span class="o">=&lt;/span>2021-11-27T19:03:35.865Z &lt;span class="nv">caller&lt;/span>&lt;span class="o">=&lt;/span>dedupe.go:112 &lt;span class="nv">component&lt;/span>&lt;span class="o">=&lt;/span>remote &lt;span class="nv">level&lt;/span>&lt;span class="o">=&lt;/span>debug &lt;span class="nv">remote_name&lt;/span>&lt;span class="o">=&lt;/span>e6fa2a &lt;span class="nv">url&lt;/span>&lt;span class="o">=&lt;/span>http://127.0.0.1:10908/api/v1/receive &lt;span class="nv">msg&lt;/span>&lt;span class="o">=&lt;/span>QueueManager.calculateDesiredShards &lt;span class="nv">dataInRate&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">23&lt;/span> &lt;span class="nv">dataOutRate&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">23&lt;/span> &lt;span class="nv">dataKeptRatio&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">1&lt;/span> &lt;span class="nv">dataPendingRate&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">dataPending&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">dataOutDuration&lt;/span>&lt;span class="o">=&lt;/span>0.0003201718 &lt;span class="nv">timePerSample&lt;/span>&lt;span class="o">=&lt;/span>1.3920513043478261e-05 &lt;span class="nv">desiredShards&lt;/span>&lt;span class="o">=&lt;/span>0.0003201718 &lt;span class="nv">highestSent&lt;/span>&lt;span class="o">=&lt;/span>1.638039808e+09 &lt;span class="nv">highestRecv&lt;/span>&lt;span class="o">=&lt;/span>1.638039808e+09
&lt;span class="nv">ts&lt;/span>&lt;span class="o">=&lt;/span>2021-11-27T19:03:35.865Z &lt;span class="nv">caller&lt;/span>&lt;span class="o">=&lt;/span>dedupe.go:112 &lt;span class="nv">component&lt;/span>&lt;span class="o">=&lt;/span>remote &lt;span class="nv">level&lt;/span>&lt;span class="o">=&lt;/span>debug &lt;span class="nv">remote_name&lt;/span>&lt;span class="o">=&lt;/span>e6fa2a &lt;span class="nv">url&lt;/span>&lt;span class="o">=&lt;/span>http://127.0.0.1:10908/api/v1/receive &lt;span class="nv">msg&lt;/span>&lt;span class="o">=&lt;/span>QueueManager.updateShardsLoop &lt;span class="nv">lowerBound&lt;/span>&lt;span class="o">=&lt;/span>0.7 &lt;span class="nv">desiredShards&lt;/span>&lt;span class="o">=&lt;/span>0.0003201718 &lt;span class="nv">upperBound&lt;/span>&lt;span class="o">=&lt;/span>1.3
&lt;span class="nv">ts&lt;/span>&lt;span class="o">=&lt;/span>2021-11-27T19:03:45.866Z &lt;span class="nv">caller&lt;/span>&lt;span class="o">=&lt;/span>dedupe.go:112 &lt;span class="nv">component&lt;/span>&lt;span class="o">=&lt;/span>remote &lt;span class="nv">level&lt;/span>&lt;span class="o">=&lt;/span>debug &lt;span class="nv">remote_name&lt;/span>&lt;span class="o">=&lt;/span>e6fa2a &lt;span class="nv">url&lt;/span>&lt;span class="o">=&lt;/span>http://127.0.0.1:10908/api/v1/receive &lt;span class="nv">msg&lt;/span>&lt;span class="o">=&lt;/span>QueueManager.calculateDesiredShards &lt;span class="nv">dataInRate&lt;/span>&lt;span class="o">=&lt;/span>23.7 &lt;span class="nv">dataOutRate&lt;/span>&lt;span class="o">=&lt;/span>18.4 &lt;span class="nv">dataKeptRatio&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">1&lt;/span> &lt;span class="nv">dataPendingRate&lt;/span>&lt;span class="o">=&lt;/span>5.300000000000001 &lt;span class="nv">dataPending&lt;/span>&lt;span class="o">=&lt;/span>355.5 &lt;span class="nv">dataOutDuration&lt;/span>&lt;span class="o">=&lt;/span>0.00025613744 &lt;span class="nv">timePerSample&lt;/span>&lt;span class="o">=&lt;/span>1.3920513043478263e-05 &lt;span class="nv">desiredShards&lt;/span>&lt;span class="o">=&lt;/span>0.00037940358300000006 &lt;span class="nv">highestSent&lt;/span>&lt;span class="o">=&lt;/span>1.638039808e+09 &lt;span class="nv">highestRecv&lt;/span>&lt;span class="o">=&lt;/span>1.638039823e+09
&lt;span class="nv">ts&lt;/span>&lt;span class="o">=&lt;/span>2021-11-27T19:03:45.866Z &lt;span class="nv">caller&lt;/span>&lt;span class="o">=&lt;/span>dedupe.go:112 &lt;span class="nv">component&lt;/span>&lt;span class="o">=&lt;/span>remote &lt;span class="nv">level&lt;/span>&lt;span class="o">=&lt;/span>debug &lt;span class="nv">remote_name&lt;/span>&lt;span class="o">=&lt;/span>e6fa2a &lt;span class="nv">url&lt;/span>&lt;span class="o">=&lt;/span>http://127.0.0.1:10908/api/v1/receive &lt;span class="nv">msg&lt;/span>&lt;span class="o">=&lt;/span>QueueManager.updateShardsLoop &lt;span class="nv">lowerBound&lt;/span>&lt;span class="o">=&lt;/span>0.7 &lt;span class="nv">desiredShards&lt;/span>&lt;span class="o">=&lt;/span>0.00037940358300000006 &lt;span class="nv">upperBound&lt;/span>&lt;span class="o">=&lt;/span>1.3
&lt;span class="nv">ts&lt;/span>&lt;span class="o">=&lt;/span>2021-11-27T19:03:45.871Z &lt;span class="nv">caller&lt;/span>&lt;span class="o">=&lt;/span>dedupe.go:112 &lt;span class="nv">component&lt;/span>&lt;span class="o">=&lt;/span>remote &lt;span class="nv">level&lt;/span>&lt;span class="o">=&lt;/span>debug &lt;span class="nv">remote_name&lt;/span>&lt;span class="o">=&lt;/span>e6fa2a &lt;span class="nv">url&lt;/span>&lt;span class="o">=&lt;/span>http://127.0.0.1:10908/api/v1/receive &lt;span class="nv">msg&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;runShard timer ticked, sending buffered data&amp;#34;&lt;/span> &lt;span class="nv">samples&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">265&lt;/span> &lt;span class="nv">exemplars&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">shard&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä»æ—¥å¿—ä¸­å¯ä»¥çœ‹åˆ°ï¼Œå®ƒä¼šå»å‘ &lt;code>http://127.0.0.1:10908/api/v1/receive&lt;/code> ä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¸€å¼€å§‹éƒ¨ç½²çš„ Thanos receive å‘é€æ•°æ®ã€‚&lt;/p>
&lt;h4 id="æŸ¥è¯¢æ•°æ®">æŸ¥è¯¢æ•°æ®&lt;/h4>
&lt;p>æ‰“å¼€æˆ‘ä»¬ä¸€å¼€å§‹éƒ¨ç½²å¥½çš„ Thanos queryï¼Œ è¾“å…¥ä»»æ„ metrics è¿›è¡ŒæŸ¥è¯¢ï¼Œå¯ä»¥æŸ¥è¯¢åˆ°é¢„æœŸçš„ç»“æœã€‚&lt;/p>
&lt;p>&lt;img src="https://i.loli.net/2021/11/28/Sa1pjykYWIA8lQE.png" alt="">&lt;/p>
&lt;p>ä½†æ˜¯å¦‚æœæˆ‘ä»¬ç›´æ¥è®¿é—®å¼€å¯äº† Agent æ¨¡å¼çš„ Prometheus çš„ UI åœ°å€çš„æ—¶å€™ï¼Œä¼šç›´æ¥æŠ¥é”™ï¼Œæ— æ³•è¿›è¡ŒæŸ¥è¯¢ã€‚è¿™æ˜¯ç”±äº &lt;strong>å¦‚æœå·²å¼€å¯ Agent æ¨¡å¼çš„ Prometheus å°†ä¼šé»˜è®¤å…³é—­å…¶ UI æŸ¥è¯¢èƒ½åŠ›ï¼ŒæŠ¥è­¦ä»¥åŠæœ¬åœ°å­˜å‚¨ç­‰èƒ½åŠ›&lt;/strong>ã€‚&lt;/p>
&lt;h2 id="æ€»ç»“">æ€»ç»“&lt;/h2>
&lt;p>æœ¬ç¯‡ä¸»è¦è¿›è¡Œäº† Prometheus Agent çš„ä¸Šæ‰‹å®è·µï¼Œé€šè¿‡ Thanos receive æ¥æ”¶æ¥è‡ª Prometheus Agent çš„ metrics ä¸ŠæŠ¥ï¼Œç„¶åé€šè¿‡ Thanos query è¿›è¡Œç»“æœçš„æŸ¥è¯¢ã€‚&lt;/p>
&lt;p>&lt;img src="https://i.loli.net/2021/11/28/pYPXM5KC3VF8yTr.png" alt="">&lt;/p>
&lt;p>Prometheus Agent å¹¶æ²¡æœ‰æœ¬è´¨ä¸Šæ”¹å˜ Prometheus æŒ‡æ ‡é‡‡é›†çš„æ–¹å¼ï¼Œä»ç„¶è¿˜æ˜¯ç»§ç»­ä½¿ç”¨æ‹‰æ¨¡å¼ï¼ˆPullï¼‰ã€‚&lt;/p>
&lt;p>å®ƒçš„ä½¿ç”¨åœºæ™¯ä¸»è¦æ˜¯è¿›è¡Œ Prometheus çš„ HA/æ•°æ®æŒä¹…åŒ–æˆ–é›†ç¾¤ã€‚ä¸ç°æœ‰çš„ä¸€äº›æ–¹æ¡ˆåœ¨æ¶æ„ä¸Šä¼šç•¥æœ‰é‡åˆï¼Œ
ä½†æ˜¯æœ‰ä¸€äº›ä¼˜åŠ¿ï¼š&lt;/p>
&lt;ul>
&lt;li>Agent æ¨¡å¼æ˜¯ Prometheus å†…ç½®çš„åŠŸèƒ½ï¼›&lt;/li>
&lt;li>å¼€å¯ Agent æ¨¡å¼çš„ Prometheus å®ä¾‹ï¼Œèµ„æºæ¶ˆè€—æ›´å°‘ï¼ŒåŠŸèƒ½ä¹Ÿä¼šæ›´å•ä¸€ï¼Œå¯¹äºæ‰©å±•ä¸€äº›è¾¹ç¼˜åœºæ™¯æ›´æœ‰åˆ©ï¼›&lt;/li>
&lt;li>å¯ç”¨ Agent æ¨¡å¼åï¼ŒPrometheus å®ä¾‹å‡ ä¹å¯ä»¥å½“ä½œæ˜¯ä¸€ä¸ªæ— çŠ¶æ€çš„åº”ç”¨ï¼Œæ¯”è¾ƒæ–¹ä¾¿è¿›è¡Œæ‰©å±•ä½¿ç”¨ï¼›&lt;/li>
&lt;/ul>
&lt;p>è¿‡æ®µæ—¶é—´å°±ä¼šå‘å¸ƒæ­£å¼ç‰ˆæœ¬äº†ï¼Œä½ æ˜¯å¦ä¼šå°è¯•ä½¿ç”¨å‘¢ï¼Ÿ&lt;/p>
&lt;hr>
&lt;p>æ¬¢è¿è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://gitee.com/tlrr/awesome/raw/master/2020-9-9/1599632564572-mp-qrcode.png" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Prometheus/">Prometheus</category></item><item><title>ç”¨ Go è°ƒç”¨ Rust</title><link>https://moelove.info/2021/11/26/%E7%94%A8-Go-%E8%B0%83%E7%94%A8-Rust/</link><guid isPermaLink="true">https://moelove.info/2021/11/26/%E7%94%A8-Go-%E8%B0%83%E7%94%A8-Rust/</guid><pubDate>Fri, 26 Nov 2021 03:04:22 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å¼ æ™‹æ¶›ã€‚&lt;/p>
&lt;p>è¿‘æœŸ Rust ç¤¾åŒº/å›¢é˜Ÿæœ‰äº›å˜åŠ¨ï¼Œæ‰€ä»¥å†ä¸€æ¬¡å°† Rust æ‹‰åˆ°å¤§å¤šæ•°äººçœ¼å‰ã€‚&lt;/p>
&lt;p>æˆ‘æœ€è¿‘çœ‹åˆ°å¾ˆå¤šå°ä¼™ä¼´è¯´çš„è¯ï¼š&lt;/p>
&lt;blockquote>
&lt;p>Rust è¿˜å€¼å¾—å­¦å—ï¼Ÿç¤¾åŒºæ˜¯ä¸æ˜¯ä¸ç¨³å®šå‘€&lt;/p>
&lt;/blockquote>
&lt;blockquote>
&lt;p>Rust å’Œ Go å“ªä¸ªå¥½ï¼Ÿ&lt;/p>
&lt;/blockquote>
&lt;blockquote>
&lt;p>Rust è¿˜å€¼å¾—å­¦å—ï¼Ÿ&lt;/p>
&lt;/blockquote>
&lt;p>è¿™äº›é—®é¢˜å¦‚æœæœ‰äººæ¥é—®æˆ‘ï¼Œé‚£æˆ‘çš„å›ç­”æ˜¯ï¼š&lt;/p>
&lt;p>&lt;strong>å°å­©å­æ‰åšé€‰æ‹©ï¼Œæˆ‘éƒ½è¦ï¼&lt;/strong>&lt;/p>
&lt;p>å½“ç„¶ï¼Œå…³äº Rust å’Œ Go çš„é—®é¢˜ä¹Ÿä¸ç®—æ–°ï¼Œæ¯”å¦‚ä¹‹å‰çš„ä¸€æ¡æ¨æ–‡ï¼š&lt;/p>
&lt;p>&lt;img src="https://i.loli.net/2021/11/26/JsdQwfOImrvek2K.png" alt="">&lt;/p>
&lt;p>æˆ‘åœ¨æœ¬ç¯‡ä¸­å°±æ¥ä»‹ç»ä¸‹å¦‚ä½•ç”¨ Go è°ƒç”¨ Rustã€‚&lt;/p>
&lt;p>&lt;strong>å½“ç„¶ï¼Œè¿™ç¯‡ä¸­æˆ‘åŸºæœ¬ä¸Šä¸ä¼šå»æ¯”è¾ƒ Go å’Œ Rust çš„åŠŸèƒ½ï¼Œæˆ–è€…è¿™ç§æ–¹å¼çš„æ€§èƒ½ä¹‹ç±»çš„ï¼ŒJust for Fun&lt;/strong>&lt;/p>
&lt;h1 id="ffi-å’Œ-binding">FFI å’Œ Binding&lt;/h1>
&lt;p>FFI (Foreign Function Interface) ç¿»è¯‘è¿‡æ¥å«åšå¤–éƒ¨å‡½æ•°æ¥å£ï¼ˆä¸ºäº†æ¯”è¾ƒç®€å•ï¼Œä¸‹æ–‡ä¸­éƒ½å°†ä½¿ç”¨ FFI æŒ‡ä»£ï¼‰ã€‚æœ€æ—©æ¥è‡ªäº Common Lisp çš„è§„èŒƒï¼Œè¿™æ˜¯åœ¨ wiki ä¸Šå†™çš„ï¼Œæˆ‘å¹¶æ²¡æœ‰å»è€ƒè¯ã€‚
ä¸è¿‡æˆ‘æ‰€ä½¿ç”¨è¿‡çš„ç»å¤§å¤šæ•°è¯­è¨€ä¸­éƒ½æœ‰ FFI çš„æ¦‚å¿µ/æœ¯è¯­å­˜åœ¨ï¼Œæ¯”å¦‚ï¼šPythonã€Ruby, Haskellã€Goã€Rustã€LuaJIT ç­‰ã€‚&lt;/p>
&lt;p>FFI çš„ä½œç”¨ç®€å•æ¥è¯´å°±æ˜¯å…è®¸ä¸€ç§è¯­è¨€å»è°ƒç”¨å¦ä¸€ç§è¯­è¨€ï¼Œæœ‰æ—¶å€™æˆ‘ä»¬ä¹Ÿä¼šç”¨ Binding æ¥è¡¨ç¤ºç±»ä¼¼çš„èƒ½åŠ›ã€‚&lt;/p>
&lt;p>åœ¨ä¸åŒçš„è¯­è¨€ä¸­ä¼šæœ‰ä¸åŒçš„å®ç°ï¼Œæ¯”å¦‚åœ¨ Go ä¸­çš„ cgo , Python ä¸­çš„ ctypes ï¼Œ Haskell ä¸­çš„ CAPI ï¼ˆä¹‹å‰è¿˜æœ‰ä¸€ä¸ª ccallï¼‰ç­‰ã€‚
æˆ‘ä¸ªäººæ„Ÿè§‰ Haskell ä¸­ç”¨ FFI ç›¸æ¯”å…¶ä»–è¯­è¨€è¦æ›´ç®€å•&amp;amp;æ–¹ä¾¿çš„å¤šï¼Œä¸è¿‡è¿™ä¸æ˜¯æœ¬ç¯‡çš„é‡ç‚¹å°±ä¸å±•å¼€äº†ã€‚&lt;/p>
&lt;p>åœ¨æœ¬æ–‡ä¸­ï¼Œå¯¹äº Go å’Œ Rust è€Œè¨€ï¼Œå®ƒä»¬çš„ FFI éœ€è¦ä¸ C è¯­è¨€å¯¹è±¡è¿›è¡Œé€šä¿¡ï¼Œè€Œè¿™éƒ¨åˆ†å…¶å®æ˜¯ç”±æ“ä½œç³»ç»Ÿæ ¹æ® API ä¸­çš„è°ƒç”¨çº¦å®šæ¥å®Œæˆçš„ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬æ¥è¿›å…¥æ­£é¢˜ã€‚&lt;/p>
&lt;h1 id="å‡†å¤‡-rust-ç¤ºä¾‹ç¨‹åº">å‡†å¤‡ Rust ç¤ºä¾‹ç¨‹åº&lt;/h1>
&lt;p>Rust çš„å®‰è£…å’Œ Cargo å·¥å…·çš„åŸºæœ¬ä½¿ç”¨ï¼Œè¿™é‡Œå°±ä¸ä»‹ç»äº†ã€‚å¤§å®¶å¯ä»¥å» Rust çš„å®˜ç½‘è¿›è¡Œäº†è§£ã€‚&lt;/p>
&lt;h2 id="ç”¨-cargo-åˆ›å»ºé¡¹ç›®">ç”¨ Cargo åˆ›å»ºé¡¹ç›®&lt;/h2>
&lt;p>æˆ‘ä»¬å…ˆå‡†å¤‡ä¸€ä¸ªç›®å½•ç”¨æ¥æ”¾æœ¬æ¬¡ç¤ºä¾‹çš„ä»£ç ã€‚ï¼ˆæˆ‘åˆ›å»ºçš„ç›®å½•å«åš &lt;code>go-rust&lt;/code> ï¼‰&lt;/p>
&lt;p>ç„¶åä½¿ç”¨ Rust çš„ Cargo å·¥å…·åˆ›å»ºä¸€ä¸ªåå« &lt;code>rustdemo&lt;/code> çš„é¡¹ç›®ï¼Œè¿™é‡Œç”±äºæˆ‘å¢åŠ äº† &lt;code>--lib&lt;/code> çš„é€‰é¡¹ï¼Œä½¿ç”¨å…¶å†…ç½®çš„ library æ¨¡æ¿ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">âœ go-rust git:&lt;span class="o">(&lt;/span>master&lt;span class="o">)&lt;/span> âœ— mkdir lib &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="nb">cd&lt;/span> lib
âœ go-rust git:&lt;span class="o">(&lt;/span>master&lt;span class="o">)&lt;/span> âœ— cargo new --lib rustdemo
Created library &lt;span class="sb">`&lt;/span>rustdemo&lt;span class="sb">`&lt;/span> package
âœ go-rust git:&lt;span class="o">(&lt;/span>master&lt;span class="o">)&lt;/span> âœ— tree rustdemo
rustdemo
â”œâ”€â”€ Cargo.toml
â””â”€â”€ src
â””â”€â”€ lib.rs
&lt;span class="m">1&lt;/span> directory, &lt;span class="m">2&lt;/span> files
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="å‡†å¤‡-rust-ä»£ç ">å‡†å¤‡ Rust ä»£ç &lt;/h2>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="k">extern&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">crate&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">libc&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">std&lt;/span>::&lt;span class="n">ffi&lt;/span>::&lt;span class="p">{&lt;/span>&lt;span class="n">CStr&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">CString&lt;/span>&lt;span class="p">};&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="cp">#[no_mangle]&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">extern&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;C&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">rustdemo&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">name&lt;/span>: &lt;span class="o">*&lt;/span>&lt;span class="k">const&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">libc&lt;/span>::&lt;span class="n">c_char&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="o">*&lt;/span>&lt;span class="k">const&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">libc&lt;/span>::&lt;span class="n">c_char&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">cstr_name&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">unsafe&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">CStr&lt;/span>::&lt;span class="n">from_ptr&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">};&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">str_name&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">cstr_name&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">to_str&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="n">unwrap&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="n">to_string&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">println&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Rust get Input: \&amp;#34;{}\&amp;#34;&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">str_name&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">r_string&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="kt">str&lt;/span> &lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34; Rust say: Hello Go &amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">str_name&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">push_str&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">r_string&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">CString&lt;/span>::&lt;span class="n">new&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">str_name&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="n">unwrap&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="n">into_raw&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä»£ç æ¯”è¾ƒç®€å•ï¼ŒRust æš´éœ²å‡ºæ¥çš„å‡½æ•°åå«åš &lt;code>rustdemo&lt;/code> ï¼Œæ¥æ”¶ä¸€ä¸ªå¤–éƒ¨çš„å‚æ•°ï¼Œå¹¶å°†å…¶æ‰“å°å‡ºæ¥ã€‚ä¹‹åä» Rust è¿™è¾¹å†è®¾ç½®ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚&lt;/p>
&lt;p>&lt;code>CString::new(str_name).unwrap().into_raw()&lt;/code> è¢«è½¬æ¢ä¸ºåŸå§‹æŒ‡é’ˆï¼Œä»¥ä¾¿ä¹‹åç”± C è¯­è¨€å¤„ç†ã€‚&lt;/p>
&lt;h2 id="ç¼–è¯‘-rust-ä»£ç ">ç¼–è¯‘ Rust ä»£ç &lt;/h2>
&lt;p>æˆ‘ä»¬éœ€è¦ä¿®æ”¹ä¸‹ &lt;code>Cargo.toml&lt;/code> æ–‡ä»¶ä»¥ä¾¿è¿›è¡Œç¼–è¯‘ã€‚æ³¨æ„ï¼Œè¿™é‡Œæˆ‘ä»¬å¢åŠ äº† &lt;code>crate-type = [&amp;quot;cdylib&amp;quot;]&lt;/code> å’Œ &lt;code>libc&lt;/code> ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-toml" data-lang="toml">&lt;span class="p">[&lt;/span>&lt;span class="nx">package&lt;/span>&lt;span class="p">]&lt;/span>
&lt;span class="nx">name&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;rustdemo&amp;#34;&lt;/span>
&lt;span class="nx">version&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;0.1.0&amp;#34;&lt;/span>
&lt;span class="nx">edition&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;2021&amp;#34;&lt;/span>
&lt;span class="p">[&lt;/span>&lt;span class="nx">lib&lt;/span>&lt;span class="p">]&lt;/span>
&lt;span class="nx">crate&lt;/span>&lt;span class="err">-&lt;/span>&lt;span class="nx">type&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;cdylib&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span>
&lt;span class="p">[&lt;/span>&lt;span class="nx">dependencies&lt;/span>&lt;span class="p">]&lt;/span>
&lt;span class="nx">libc&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;0.2&amp;#34;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç„¶åè¿›è¡Œç¼–è¯‘&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">âœ rustdemo git:&lt;span class="o">(&lt;/span>master&lt;span class="o">)&lt;/span> âœ— cargo build --release
Compiling rustdemo v0.1.0 &lt;span class="o">(&lt;/span>/home/tao/go/src/github.com/tao12345666333/go-rust/lib/rustdemo&lt;span class="o">)&lt;/span>
Finished release &lt;span class="o">[&lt;/span>optimized&lt;span class="o">]&lt;/span> target&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span> in 0.22s
&lt;/code>&lt;/pre>&lt;/div>&lt;p>æŸ¥çœ‹ç”Ÿæˆçš„æ–‡ä»¶ï¼Œè¿™æ˜¯ä¸€ä¸ª &lt;code>.so&lt;/code> æ–‡ä»¶ï¼ˆè¿™æ˜¯å› ä¸ºæˆ‘åœ¨ Linux ç¯å¢ƒä¸‹ï¼Œä½ å¦‚æœåœ¨å…¶ä»–ç³»ç»Ÿç¯å¢ƒä¸‹ä¼šä¸åŒ)&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">âœ rustdemo git:&lt;span class="o">(&lt;/span>master&lt;span class="o">)&lt;/span> âœ— ls target/release/librustdemo.so
target/release/librustdemo.so
&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="å‡†å¤‡-go-ä»£ç ">å‡†å¤‡ Go ä»£ç &lt;/h1>
&lt;p>Go ç¯å¢ƒçš„å®‰è£…ä¹‹ç±»çš„è¿™é‡Œä¹Ÿä¸å†èµ˜è¿°äº†ï¼Œç»§ç»­åœ¨æˆ‘ä»¬çš„ go-rust ç›®å½•æ“ä½œå³å¯ã€‚&lt;/p>
&lt;h2 id="ç¼–å†™-maingo">ç¼–å†™ main.go&lt;/h2>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="kn">package&lt;/span> &lt;span class="nx">main&lt;/span>
&lt;span class="cm">/*
&lt;/span>&lt;span class="cm">#cgo LDFLAGS: -L./lib -lrustdemo
&lt;/span>&lt;span class="cm">#include &amp;lt;stdlib.h&amp;gt;
&lt;/span>&lt;span class="cm">#include &amp;#34;./lib/rustdemo.h&amp;#34;
&lt;/span>&lt;span class="cm">*/&lt;/span>
&lt;span class="kn">import&lt;/span> &lt;span class="s">&amp;#34;C&amp;#34;&lt;/span>
&lt;span class="kn">import&lt;/span> &lt;span class="p">(&lt;/span>
&lt;span class="s">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;span class="s">&amp;#34;unsafe&amp;#34;&lt;/span>
&lt;span class="p">)&lt;/span>
&lt;span class="kd">func&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">s&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="s">&amp;#34;Go say: Hello Rust&amp;#34;&lt;/span>
&lt;span class="nx">input&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">C&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">CString&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">s&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">defer&lt;/span> &lt;span class="nx">C&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">free&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">unsafe&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Pointer&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">input&lt;/span>&lt;span class="p">))&lt;/span>
&lt;span class="nx">o&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">C&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">rustdemo&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">input&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="nx">output&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">C&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">GoString&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">o&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Printf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;%s\n&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">output&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>åœ¨è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº† cgo ï¼Œåœ¨ &lt;code>import &amp;quot;C&amp;quot;&lt;/code> ä¹‹å‰çš„æ³¨é‡Šå†…å®¹æ˜¯ä¸€ç§ç‰¹æ®Šçš„è¯­æ³•ï¼Œè¿™é‡Œæ˜¯æ­£å¸¸çš„ C ä»£ç ï¼Œå…¶ä¸­éœ€è¦å£°æ˜ä½¿ç”¨åˆ°çš„å¤´æ–‡ä»¶ä¹‹ç±»çš„ã€‚&lt;/p>
&lt;p>ä¸‹é¢çš„ä»£ç å¾ˆç®€å•ï¼Œå®šä¹‰äº†ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä¼ é€’ç»™ rustdemo å‡½æ•°ï¼Œç„¶åæ‰“å° C å¤„ç†åçš„å­—ç¬¦ä¸²ã€‚&lt;/p>
&lt;p>åŒæ—¶ï¼Œä¸ºäº†èƒ½å¤Ÿè®© Go ç¨‹åºèƒ½æ­£å¸¸è°ƒç”¨ Rust å‡½æ•°ï¼Œè¿™é‡Œæˆ‘ä»¬è¿˜éœ€è¦å£°æ˜å…¶å¤´æ–‡ä»¶ï¼Œåœ¨ &lt;code>lib/rustdemo.h&lt;/code> ä¸­å†™å…¥å¦‚ä¸‹å†…å®¹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-c" data-lang="c">&lt;span class="kt">char&lt;/span>&lt;span class="o">*&lt;/span> &lt;span class="nf">rustdemo&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">char&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="ç¼–è¯‘ä»£ç ">ç¼–è¯‘ä»£ç &lt;/h2>
&lt;p>åœ¨ Go ç¼–è¯‘çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦å¼€å¯ CGO ï¼ˆé»˜è®¤éƒ½æ˜¯å¼€å¯çš„ï¼‰ï¼ŒåŒæ—¶éœ€è¦é“¾æ¥åˆ° Rust æ„å»ºå‡ºæ¥çš„ &lt;code>rustdemo.so&lt;/code> æ–‡ä»¶ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†è¯¥æ–‡ä»¶å’Œå®ƒçš„å¤´æ–‡ä»¶æ”¾åˆ° &lt;code>lib&lt;/code> ç›®å½•ä¸‹ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">âœ go-rust git:&lt;span class="o">(&lt;/span>master&lt;span class="o">)&lt;/span> âœ— cp lib/rustdemo/target/release/librustdemo.so lib
&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ‰€ä»¥å®Œæ•´çš„ç›®å½•ç»“æ„å°±æ˜¯ï¼š&lt;/p>
&lt;pre>&lt;code>âœ go-rust git:(master) âœ— tree -L 2 .
.
â”œâ”€â”€ go.mod
â”œâ”€â”€ lib
â”‚Â Â  â”œâ”€â”€ librustdemo.so
â”‚Â Â  â”œâ”€â”€ rustdemo
â”‚Â Â  â””â”€â”€ rustdemo.h
â””â”€â”€ main.go
2 directories, 5 files
&lt;/code>&lt;/pre>&lt;p>ç¼–è¯‘ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">âœ go-rust git:&lt;span class="o">(&lt;/span>master&lt;span class="o">)&lt;/span> âœ— go build -o go-rust -ldflags&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;-r ./lib&amp;#34;&lt;/span> main.go
âœ go-rust git:&lt;span class="o">(&lt;/span>master&lt;span class="o">)&lt;/span> âœ— ./go-rust
Rust get Input: &lt;span class="s2">&amp;#34;Go say: Hello Rust&amp;#34;&lt;/span>
Go say: Hello Rust Rust say: Hello Go
&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¯ä»¥çœ‹åˆ°ï¼Œç¬¬ä¸€è¡Œçš„è¾“å‡ºæ˜¯ç”± Go ä¼ å…¥äº† Rust ï¼Œ ç¬¬äºŒè¡Œä¸­åˆ™æ˜¯ä» Rust å†ä¼ å› Go çš„äº†ã€‚ç¬¦åˆæˆ‘ä»¬çš„é¢„æœŸã€‚&lt;/p>
&lt;h1 id="æ€»ç»“">æ€»ç»“&lt;/h1>
&lt;p>æœ¬ç¯‡ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨ Go ä¸ Rust è¿›è¡Œç»“åˆï¼Œä»‹ç»äº†å…¶å‰ç½®å…³äº FFI ç›¸å…³çš„çŸ¥è¯†ï¼Œåç»­é€šè¿‡ä¸€ä¸ªå°çš„å®è·µæ¼”ç¤ºäº†å…¶å®Œæ•´è¿‡ç¨‹ã€‚
æ„Ÿå…´è¶£çš„å°ä¼™ä¼´å¯ä»¥è‡ªè¡Œå®è·µä¸‹ã€‚&lt;/p>
&lt;hr>
&lt;p>æ¬¢è¿è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://gitee.com/tlrr/awesome/raw/master/2020-9-9/1599632564572-mp-qrcode.png" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Go/">Go</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Rust/">Rust</category></item><item><title>äº‘åŸç”Ÿæ—¶ä»£ä¸‹çš„å®¹å™¨é•œåƒå®‰å…¨ï¼ˆä¸Šï¼‰</title><link>https://moelove.info/2021/11/23/%E4%BA%91%E5%8E%9F%E7%94%9F%E6%97%B6%E4%BB%A3%E4%B8%8B%E7%9A%84%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F%E5%AE%89%E5%85%A8%E4%B8%8A/</link><guid isPermaLink="true">https://moelove.info/2021/11/23/%E4%BA%91%E5%8E%9F%E7%94%9F%E6%97%B6%E4%BB%A3%E4%B8%8B%E7%9A%84%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F%E5%AE%89%E5%85%A8%E4%B8%8A/</guid><pubDate>Tue, 23 Nov 2021 23:16:42 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å¼ æ™‹æ¶›ã€‚&lt;/p>
&lt;p>Kubernetes ä½œä¸ºäº‘åŸç”Ÿçš„åŸºçŸ³ï¼Œä¸ºæˆ‘ä»¬å¸¦æ¥äº†æå¤§çš„ä¾¿åˆ©æ€§ï¼Œè¶Šæ¥è¶Šå¤šçš„å…¬å¸ä¹Ÿéƒ½å°† Kubernetes åº”ç”¨åˆ°äº†ç”Ÿäº§ç¯å¢ƒä¸­ã€‚ç„¶è€Œï¼Œåœ¨äº«å—å…¶å¸¦æ¥çš„ä¾¿åˆ©æ€§çš„åŒæ—¶ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦å…³æ³¨å…¶ä¸­çš„ä¸€äº›å®‰å…¨éšæ‚£ã€‚&lt;/p>
&lt;p>æœ¬ç¯‡ï¼Œæˆ‘å°†ä¸ºä½ é‡ç‚¹ä»‹ç»&lt;strong>å®¹å™¨é•œåƒå®‰å…¨&lt;/strong>ç›¸å…³çš„å†…å®¹ã€‚&lt;/p>
&lt;p>é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æåˆ°&lt;strong>å®¹å™¨é•œåƒå®‰å…¨&lt;/strong>ï¼Œä¸»è¦æ˜¯æŒ‡ä»¥ä¸‹ä¸¤ä¸ªæ–¹é¢ï¼š&lt;/p>
&lt;ul>
&lt;li>é•œåƒè‡ªèº«å†…å®¹çš„å®‰å…¨ï¼›&lt;/li>
&lt;li>é•œåƒåˆ†å‘è¿‡ç¨‹çš„å®‰å…¨ï¼›&lt;/li>
&lt;/ul>
&lt;h2 id="é•œåƒè‡ªèº«å†…å®¹çš„å®‰å…¨">é•œåƒè‡ªèº«å†…å®¹çš„å®‰å…¨&lt;/h2>
&lt;p>è¦èŠé•œåƒè‡ªèº«å†…å®¹çš„å®‰å…¨ï¼Œé‚£æˆ‘ä»¬å°±éœ€è¦çŸ¥é“é•œåƒåˆ°åº•æ˜¯ä»€ä¹ˆï¼Œä»¥åŠå®ƒå…¶ä¸­çš„å†…å®¹æ˜¯ä»€ä¹ˆã€‚&lt;/p>
&lt;h3 id="é•œåƒæ˜¯ä»€ä¹ˆ">é•œåƒæ˜¯ä»€ä¹ˆ&lt;/h3>
&lt;p>æˆ‘ä»¬ä»¥ &lt;code>debian&lt;/code>é•œåƒä¸ºä¾‹ï¼Œpull æœ€æ–°çš„é•œåƒï¼Œå¹¶å°†å…¶ä¿å­˜ä¸º tar æ–‡ä»¶ï¼Œä¹‹åè¿›è¡Œè§£å‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">âœ ~ mkdir -p debian-image
âœ ~ docker pull debian
Using default tag: latest
latest: Pulling from library/debian
647acf3d48c2: Pull &lt;span class="nb">complete&lt;/span>
Digest: sha256:e8c184b56a94db0947a9d51ec68f42ef5584442f20547fa3bd8cbd00203b2e7a
Status: Downloaded newer image &lt;span class="k">for&lt;/span> debian:latest
docker.io/library/debian:latest
âœ ~ docker image save -o debian-image/debian.tar debian
âœ ~ ls debian-image
debian.tar
âœ ~ tar -C debian-image -xf debian-image/debian.tar
âœ ~ tree -I debian.tar debian-image
debian-image
â”œâ”€â”€ 827e5611389abf13dad1057e92f163b771febc0bcdb19fa2d634a7eb0641e0cc.json
â”œâ”€â”€ b331057b5d32f835ac4b051f6a08af6e9beedb99ec9aba5c029105abe360bbda
â”‚ â”œâ”€â”€ json
â”‚ â”œâ”€â”€ layer.tar
â”‚ â””â”€â”€ VERSION
â”œâ”€â”€ manifest.json
â””â”€â”€ repositories
&lt;span class="m">1&lt;/span> directory, &lt;span class="m">6&lt;/span> files
&lt;/code>&lt;/pre>&lt;/div>&lt;p>è§£å‹å®Œæˆåï¼Œæˆ‘ä»¬çœ‹åˆ°å®ƒæ˜¯ä¸€å † json æ–‡ä»¶å’Œ &lt;code>layer.tar&lt;/code>æ–‡ä»¶çš„ç»„åˆï¼Œæˆ‘ä»¬å†æ¬¡å¯¹å…¶ä¸­çš„ &lt;code>layer.tar&lt;/code>è¿›è¡Œè§£å‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">âœ ~ tar -C debian-image/b331057b5d32f835ac4b051f6a08af6e9beedb99ec9aba5c029105abe360bbda -xf debian-image/b331057b5d32f835ac4b051f6a08af6e9beedb99ec9aba5c029105abe360bbda/layer.tar
âœ ~ tree -I &lt;span class="s1">&amp;#39;layer.tar|json|VERSION&amp;#39;&lt;/span> -L &lt;span class="m">1&lt;/span> debian-image/b331057b5d32f835ac4b051f6a08af6e9beedb99ec9aba5c029105abe360bbda
debian-image/b331057b5d32f835ac4b051f6a08af6e9beedb99ec9aba5c029105abe360bbda
â”œâ”€â”€ bin
â”œâ”€â”€ boot
â”œâ”€â”€ dev
â”œâ”€â”€ etc
â”œâ”€â”€ home
â”œâ”€â”€ lib
â”œâ”€â”€ lib64
â”œâ”€â”€ media
â”œâ”€â”€ mnt
â”œâ”€â”€ opt
â”œâ”€â”€ proc
â”œâ”€â”€ root
â”œâ”€â”€ run
â”œâ”€â”€ sbin
â”œâ”€â”€ srv
â”œâ”€â”€ sys
â”œâ”€â”€ tmp
â”œâ”€â”€ usr
â””â”€â”€ var
&lt;span class="m">19&lt;/span> directories, &lt;span class="m">0&lt;/span> files
&lt;/code>&lt;/pre>&lt;/div>&lt;p>è§£å‹åçš„ç›®å½•ç»“æ„æƒ³å¿…ä½ å·²ç»å¾ˆç†Ÿæ‚‰äº†ï¼Œæ˜¯çš„ï¼Œè¿™æ˜¯ &lt;code>rootfs&lt;/code>çš„ç›®å½•ç»“æ„ã€‚&lt;/p>
&lt;p>å¦‚æœæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯è‡ªå·±æ„å»ºçš„ä¸€äº›åº”ç”¨é•œåƒçš„è¯ï¼Œç»è¿‡å‡ æ¬¡è§£å‹ï¼Œä½ ä¹Ÿä¼šåœ¨å…¶ä¸­æ‰¾åˆ°åº”ç”¨ç¨‹åºç›¸å¯¹åº”çš„æ–‡ä»¶ã€‚&lt;/p>
&lt;h3 id="é•œåƒè‡ªèº«å†…å®¹å®‰å…¨å¦‚ä½•ä¿è¯">é•œåƒè‡ªèº«å†…å®¹å®‰å…¨å¦‚ä½•ä¿è¯&lt;/h3>
&lt;p>å‰é¢æˆ‘ä»¬å·²ç»çœ‹åˆ°äº†å®¹å™¨é•œåƒå°±æ˜¯ &lt;code>rootfs&lt;/code>å’Œåº”ç”¨ç¨‹åºï¼Œä»¥åŠä¸€äº›é…ç½®æ–‡ä»¶çš„ç»„åˆã€‚æ‰€ä»¥è¦ä¿è¯å®ƒè‡ªèº«å†…å®¹çš„å®‰å…¨æ€§ï¼Œä¸»è¦ä»ä»¥ä¸‹å‡ ä¸ªæ–¹é¢æ¥è€ƒè™‘ï¼š&lt;/p>
&lt;h4 id="rootfså®‰å…¨">&lt;code>rootfs&lt;/code>å®‰å…¨&lt;/h4>
&lt;p>å¯¹åº”åˆ°æˆ‘ä»¬çš„å®é™…æƒ…å†µï¼Œ&lt;code>rootfs&lt;/code>é€šå¸¸æ˜¯ç”±æˆ‘ä»¬ä½¿ç”¨çš„åŸºç¡€ï¼ˆç³»ç»Ÿï¼‰é•œåƒæä¾›çš„ï¼Œæˆ–è€…ä¹Ÿå¯ä»¥è®¤ä¸ºæ˜¯æˆ‘ä»¬æ„å»ºé•œåƒæ—¶ï¼Œ&lt;code>Dockerfile&lt;/code>çš„ &lt;code>FROM&lt;/code>å­—æ®µæ‰€é…ç½®çš„é•œåƒæä¾›çš„ã€‚&lt;/p>
&lt;p>åœ¨è¿™ä¸ªæ–¹é¢æƒ³è¦åšåˆ°å®‰å…¨æ€§å°±éœ€è¦æˆ‘ä»¬ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ä½¿ç”¨å¯ä¿¡æ¥æºçš„é•œåƒï¼Œæ¯”å¦‚ Docker å®˜æ–¹ç»´æŠ¤çš„é•œåƒï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¯¹åŸºç¡€é•œåƒæŒç»­çš„è¿›è¡Œæ¼æ´æ‰«æå’Œå‡çº§ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä¹Ÿå¯ä»¥è€ƒè™‘ä½¿ç”¨ &lt;code>Distroless&lt;/code>é•œåƒï¼Œè¿™æ ·ä¹Ÿå¯ä»¥ä¸€å®šç¨‹åº¦ä¸Šå…å—æ”»å‡»ï¼›&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h4 id="åº”ç”¨ç¨‹åº">åº”ç”¨ç¨‹åº&lt;/h4>
&lt;p>åº”ç”¨ç¨‹åºå…¶å®æ˜¯æˆ‘ä»¬è‡ªå·±æä¾›çš„ï¼Œåœ¨è¿™æ–¹é¢æƒ³è¦åšåˆ°å®‰å…¨æ€§ï¼Œé‚£ä¹ˆå°±éœ€è¦æˆ‘ä»¬ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>æŒç»­çš„è¿›è¡Œè½¯ä»¶çš„æ¼æ´æ‰«æï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¯¹ä¾èµ–åŠæ—¶çš„è¿›è¡Œæ›´æ–°ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¯ä»¥è€ƒè™‘ä» SDLï¼ˆSecurity Development Lifecycleï¼‰è¿‡æ¸¡åˆ° DevSecOps ï¼›&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h4 id="é…ç½®æ–‡ä»¶">é…ç½®æ–‡ä»¶&lt;/h4>
&lt;p>é•œåƒä¸­æ‰€åŒ…å«çš„é‚£äº›é…ç½®æ–‡ä»¶æ˜¯ç”±é•œåƒæ„å»ºå·¥å…·æ‰€æä¾›çš„ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œåªè¦æˆ‘ä»¬ä¿è¯ä½¿ç”¨çš„é•œåƒæ„å»ºå·¥å…·æœªè¢«ç¯¡æ”¹æˆ–è€…ç•™ä¸‹ä»€ä¹ˆæ¼æ´ï¼Œé‚£ä¹ˆè¿™é‡ŒåŸºæœ¬ä¸Šä¸ä¼šæœ‰ä»€ä¹ˆå¤§çš„é—®é¢˜ã€‚&lt;/p>
&lt;p>ç»¼åˆæ¥çœ‹ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨ç±»ä¼¼ &lt;a href="https://github.com/aquasecurity/trivy">Trivy&lt;/a> æˆ–è€… &lt;a href="https://github.com/anchore/anchore-engine">Anchore Engine&lt;/a> ç­‰é•œåƒæ¼æ´æ‰«æå·¥å…·æ¥å¸®åŠ©æˆ‘ä»¬ä¿éšœé•œåƒå†…å®¹çš„å®‰å…¨ã€‚æ­¤å¤–ï¼Œä¸€äº›é•œåƒä»“åº“ï¼Œæ¯”å¦‚ Harbor ç­‰éƒ½å·²ç»å†…ç½®äº†é•œåƒå®‰å…¨çš„æ‰«æå·¥å…·ï¼Œæˆ–è€…å¯ä»¥ä½¿ç”¨ &lt;code>docker scan&lt;/code>å‘½ä»¤è¿›è¡Œé•œåƒçš„å®‰å…¨æ‰«æã€‚&lt;/p>
&lt;h2 id="é•œåƒåˆ†å‘å®‰å…¨">é•œåƒåˆ†å‘å®‰å…¨&lt;/h2>
&lt;h3 id="é•œåƒå¦‚ä½•åˆ†å‘">é•œåƒå¦‚ä½•åˆ†å‘&lt;/h3>
&lt;p>æˆ‘ä»¬é¦–å…ˆæ¥çœ‹çœ‹ï¼Œå®¹å™¨é•œåƒæ˜¯æ€ä¹ˆæ ·ä»æ„å»ºåˆ°éƒ¨ç½²åˆ°æˆ‘ä»¬çš„ Kubernetes ç¯å¢ƒä¸­çš„ã€‚&lt;/p>
&lt;p>&lt;img src="https://i.loli.net/2021/11/24/KnehEd4PD6H5YB3.png" alt="img">&lt;/p>
&lt;p>&lt;strong>å›¾ 1 ï¼Œå®¹å™¨é•œåƒè‡ªåˆ›å»ºåˆ°å‘å¸ƒéƒ¨ç½²çš„ç®€è¦è¿‡ç¨‹ç¤ºæ„å›¾&lt;/strong>&lt;/p>
&lt;p>å¼€å‘è€…åœ¨ç¼–å†™å®Œä»£ç åï¼Œæ¨é€ä»£ç åˆ°ä»£ç ä»“åº“ã€‚ç”±æ­¤æ¥è§¦å‘ CI è¿›è¡Œæ„å»ºï¼Œåœ¨æ­¤è¿‡ç¨‹ä¸­ä¼šè¿›è¡Œé•œåƒçš„æ„å»ºï¼Œä»¥åŠå°†é•œåƒæ¨é€è‡³é•œåƒä»“åº“ä¸­ã€‚&lt;/p>
&lt;p>åœ¨ CD çš„ç¯èŠ‚ä¸­ï¼Œåˆ™ä¼šä½¿ç”¨é•œåƒä»“åº“ä¸­çš„é•œåƒï¼Œéƒ¨ç½²è‡³ç›®æ ‡ Kubernetes é›†ç¾¤ä¸­ã€‚&lt;/p>
&lt;p>é‚£ä¹ˆåœ¨æ­¤è¿‡ç¨‹ä¸­ï¼Œæ”»å‡»è€…å¦‚ä½•è¿›è¡Œæ”»å‡»å‘¢ï¼Ÿ&lt;/p>
&lt;h3 id="é•œåƒåˆ†å‘ä¸­çš„å®‰å…¨é—®é¢˜">é•œåƒåˆ†å‘ä¸­çš„å®‰å…¨é—®é¢˜&lt;/h3>
&lt;p>&lt;img src="https://i.loli.net/2021/11/24/ZjrvqNodKxU9AXY.png" alt="img">&lt;/p>
&lt;p>&lt;strong>å›¾ 2 ï¼Œé•œåƒåˆ†å‘éƒ¨ç½²å®‰å…¨ç¤ºä¾‹&lt;/strong>&lt;/p>
&lt;p>å¦‚å›¾ï¼Œåœ¨é•œåƒåˆ†å‘éƒ¨ç½²çš„ç¯èŠ‚ä¸­å…¶ä¸Šæ¸¸æ˜¯é•œåƒä»“åº“ï¼Œä¸‹æ¸¸æ˜¯ Kubernetes é›†ç¾¤ã€‚å¯¹äºé•œåƒä»“åº“è€Œè¨€ï¼Œå³ä½¿æ˜¯å†…ç½‘çš„è‡ªå»ºç¯å¢ƒï¼Œç”±äºæˆ‘ä»¬çš„è§‚å¿µå·²ä»åŸºäºè¾¹ç•Œçš„å®‰å…¨è½¬å˜ä¸ºé›¶ä¿¡ä»»å®‰å…¨ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬ç»Ÿä¸€ä»¥å…¬å…±ä»“åº“ä¸ºä¾‹æ¥è®²è§£ã€‚&lt;/p>
&lt;p>æ”»å‡»è€…å¯ä»¥é€šè¿‡ä¸€äº›æ‰‹æ®µè¿›è¡ŒåŠ«æŒã€æ›¿æ¢æˆæ¶æ„çš„é•œåƒï¼ŒåŒ…æ‹¬ç›´æ¥æ”»å‡»é•œåƒä»“åº“ç­‰ã€‚&lt;/p>
&lt;p>è¦ä¿è¯éƒ¨ç½²åˆ° Kubernetes é›†ç¾¤ä¸­é•œåƒçš„å®‰å…¨æ€§æ¥æºä»¥åŠå®Œæ•´æ€§ï¼Œå…¶å®æ˜¯éœ€è¦åœ¨ä¸¤ä¸ªä¸»è¦çš„ç¯èŠ‚ä¸Šè¿›è¡Œï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;strong>æ„å»ºé•œåƒæ—¶è¿›è¡Œé•œåƒçš„ç­¾åï¼›&lt;/strong>&lt;/li>
&lt;li>&lt;strong>é•œåƒåˆ†å‘éƒ¨ç½²æ—¶è¿›è¡Œç­¾åçš„æ ¡éªŒï¼›ï¼ˆä¸‹ä¸€ç¯‡å†…å®¹ç»§ç»­ï¼‰&lt;/strong>&lt;/li>
&lt;/ul>
&lt;p>æˆ‘ä»¬æ¥åˆ†åˆ«çœ‹ä¸€ä¸‹ã€‚&lt;/p>
&lt;h3 id="é•œåƒçš„æ ‡ç­¾å’Œæ‘˜è¦">é•œåƒçš„æ ‡ç­¾å’Œæ‘˜è¦&lt;/h3>
&lt;p>æˆ‘ä»¬é€šå¸¸åœ¨ä½¿ç”¨å®¹å™¨é•œåƒæ—¶æœ‰ä¸¤ç§é€‰æ‹©ï¼š&lt;/p>
&lt;ul>
&lt;li>æ ‡ç­¾ï¼Œæ¯”å¦‚ &lt;code>alpine:3.14.3&lt;/code>&lt;/li>
&lt;li>æ‘˜è¦ï¼Œæ¯”å¦‚ &lt;code>alpine@sha256:635f0aa53d99017b38d1a0aa5b2082f7812b03e3cdb299103fe77b5c8a07f1d2&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>å¤§å¤šæ•°åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬ä¼šç›´æ¥ä½¿ç”¨æ ‡ç­¾ï¼Œå› ä¸ºå®ƒçš„å¯è¯»æ€§æ›´å¥½ã€‚ä½†æ˜¯é•œåƒå†…å®¹å¯èƒ½ä¼šéšç€æ—¶é—´çš„æ¨ç§»è€Œå˜åŒ–ï¼Œå› ä¸ºæˆ‘ä»¬å¯èƒ½ä¼šä¸ºä¸åŒå†…å®¹çš„é•œåƒä½¿ç”¨ç›¸åŒçš„æ ‡ç­¾ï¼Œæœ€å¸¸è§çš„å°±æ˜¯ &lt;code>:latest&lt;/code>æ ‡ç­¾ï¼Œæ¯æ¬¡æ–°ç‰ˆæœ¬å‘å¸ƒçš„æ—¶å€™ï¼Œæ–°ç‰ˆæœ¬çš„é•œåƒéƒ½ä¼šç»§ç»­æ²¿ç”¨ &lt;code>:latest&lt;/code>æ ‡ç­¾ï¼Œä½†å…¶ä¸­çš„åº”ç”¨ç¨‹åºç‰ˆæœ¬å·²ç»å‡çº§åˆ°äº†æœ€æ–°ã€‚&lt;/p>
&lt;p>ä½¿ç”¨æ‘˜è¦çš„ä¸»è¦å¼Šç«¯æ˜¯å®ƒçš„å¯è¯»æ€§ä¸å¥½ï¼Œä½†æ˜¯ï¼Œæ¯ä¸ªé•œåƒçš„æ‘˜è¦éƒ½æ˜¯å”¯ä¸€çš„ï¼Œæ‘˜è¦æ˜¯é•œåƒå†…å®¹çš„ SHA256 çš„å“ˆå¸Œå€¼ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡æ‘˜è¦æ¥ä¿è¯é•œåƒçš„å”¯ä¸€æ€§ã€‚&lt;/p>
&lt;p>é€šè¿‡ä»¥ä¸‹ç¤ºä¾‹å¯ä»¥ç›´æ¥çœ‹åˆ°æ ‡ç­¾å’Œæ‘˜è¦ä¿¡æ¯ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-plain" data-lang="plain">âœ ~ docker pull alpine:3.14.3
3.14.3: Pulling from library/alpine
Digest: sha256:635f0aa53d99017b38d1a0aa5b2082f7812b03e3cdb299103fe77b5c8a07f1d2
Status: Image is up to date for alpine:3.14.3
docker.io/library/alpine:3.14.3
âœ ~ docker image inspect alpine:3.14.3 | jq -r &amp;#39;.[] | {RepoTags: .RepoTags, RepoDigests: .RepoDigests}&amp;#39;
{
&amp;#34;RepoTags&amp;#34;: [
&amp;#34;alpine:3.14.3&amp;#34;
],
&amp;#34;RepoDigests&amp;#34;: [
&amp;#34;alpine@sha256:635f0aa53d99017b38d1a0aa5b2082f7812b03e3cdb299103fe77b5c8a07f1d2&amp;#34;
]
}
&lt;/code>&lt;/pre>&lt;/div>&lt;p>é‚£ä¹ˆå¦‚ä½•æ¥ä¿è¯é•œåƒçš„æ­£ç¡®æ€§/å®‰å…¨æ€§å‘¢ï¼Ÿè¿™å°±æ˜¯é•œåƒç­¾åè§£å†³çš„ä¸»è¦é—®é¢˜äº†ã€‚&lt;/p>
&lt;h3 id="é•œåƒç­¾åè§£å†³æ–¹æ¡ˆ">é•œåƒç­¾åè§£å†³æ–¹æ¡ˆ&lt;/h3>
&lt;p>æ•°å­—ç­¾åæ˜¯ä¸€ç§ä¼—æ‰€å‘¨çŸ¥çš„æ–¹æ³•ï¼Œç”¨äºç»´æŠ¤åœ¨ç½‘ç»œä¸Šä¼ è¾“çš„ä»»ä½•æ•°æ®çš„å®Œæ•´æ€§ã€‚å¯¹äºå®¹å™¨é•œåƒç­¾åï¼Œæˆ‘ä»¬æœ‰å‡ ç§æ¯”è¾ƒé€šç”¨çš„æ–¹æ¡ˆã€‚&lt;/p>
&lt;h4 id="docker-content-trust-dct">Docker Content Trust (DCT)&lt;/h4>
&lt;p>åœ¨ä¼ è¾“ä¸€èˆ¬æ–‡ä»¶æ—¶ï¼Œå¯èƒ½æœ‰è¿‡ç±»ä¼¼çš„ç»å†ï¼Œæ¯”å¦‚å› ä¸ºç½‘ç»œåŸå› å¯¼è‡´ä¸‹è½½çš„æ–‡ä»¶ä¸å®Œæ•´ï¼›æˆ–æ˜¯é­é‡ä¸­é—´äººçš„æ”»å‡»å¯¼è‡´æ–‡ä»¶è¢«ç¯¡æ”¹ã€æ›¿æ¢ç­‰ã€‚&lt;/p>
&lt;p>é•œåƒåœ¨åˆ†å‘è¿‡ç¨‹ä¸­å…¶å®ä¹Ÿå¯èƒ½ä¼šé‡åˆ°ç±»ä¼¼çš„é—®é¢˜ï¼Œè¿™å°±æ˜¯æ­¤å¤„æˆ‘ä»¬è¦è®¨è®ºçš„é‡ç‚¹ï¼Œä¹Ÿå°±æ˜¯ Docker Content Trustï¼ˆDCTï¼‰ä¸»è¦è§£å†³çš„é—®é¢˜ã€‚&lt;/p>
&lt;p>Docker Content Trust ä½¿ç”¨æ•°å­—ç­¾åï¼Œå¹¶ä¸”å…è®¸å®¢æˆ·ç«¯æˆ–è¿è¡Œæ—¶éªŒè¯ç‰¹å®šé•œåƒæ ‡ç­¾çš„å®Œæ•´æ€§å’Œå‘å¸ƒè€…ã€‚å¯¹äºä½¿ç”¨è€Œè¨€ä¹Ÿå°±æ˜¯ &lt;code>docker trust&lt;/code> å‘½ä»¤æ‰€æä¾›çš„ç›¸å…³åŠŸèƒ½ã€‚æ³¨æ„ï¼šè¿™éœ€è¦ Docker CE 17.12 åŠä»¥ä¸Šç‰ˆæœ¬ã€‚&lt;/p>
&lt;p>å‰é¢æˆ‘ä»¬æåˆ°äº†ï¼Œé•œåƒè®°å½•å¯ä»¥æœ‰ä¸€äº›æ ‡ç­¾ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-plain" data-lang="plain">[REGISTRY_HOST[:REGISTRY_PORT]/]REPOSITORY[:TAG]
&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä»¥æ ‡ç­¾ä¸ºä¾‹ï¼ŒDCT ä¼šä¸æ ‡ç­¾çš„ä¸€éƒ¨åˆ†ç›¸å…³è”ã€‚æ¯ä¸ªé•œåƒä»“åº“éƒ½æœ‰ä¸€ç»„å¯†é’¥ï¼Œé•œåƒå‘å¸ƒè€…ä½¿ç”¨è¿™äº›å¯†é’¥å¯¹é•œåƒæ ‡ç­¾è¿›è¡Œç­¾åã€‚ï¼ˆé•œåƒå‘å¸ƒè€…å¯ä»¥è‡ªè¡Œå†³å®šè¦ç­¾ç½²å“ªäº›æ ‡ç­¾ï¼‰é•œåƒä»“åº“å¯ä»¥åŒæ—¶åŒ…å«å¤šä¸ªå¸¦æœ‰å·²ç­¾åæ ‡ç­¾å’Œæœªç­¾åæ ‡ç­¾çš„é•œåƒã€‚&lt;/p>
&lt;p>è¿™é‡Œéœ€è¦è¯´æ˜ä¸‹ï¼Œå¦‚æœé•œåƒå‘å¸ƒè€…å…ˆæ¨é€ç­¾åçš„ latest é•œåƒï¼Œå†æ¨é€æœªç­¾åçš„ latest é•œåƒï¼Œé‚£ä¹ˆåä¸€ä¸ªé•œåƒä¸ä¼šå½±å“å‰ä¸€ä¸ªé•œåƒçš„å†…å®¹ï¼ˆåŒºåˆ«äºä¸Šæ–‡ä¸­æ ‡ç­¾è¦†ç›–çš„åœ°æ–¹ï¼‰ã€‚&lt;/p>
&lt;p>&lt;img src="https://i.loli.net/2021/11/24/m94jihT7XgCftod.png" alt="img">&lt;/p>
&lt;p>&lt;strong>å›¾ 4 ï¼ŒDCT é•œåƒç­¾åç¤ºä¾‹ï¼ˆå›¾ä¸­ç®€ç•¥äº†ç™»å½•é•œåƒä»“åº“çš„è®¤è¯è¿‡ç¨‹ï¼‰&lt;/strong>&lt;/p>
&lt;p>åœ¨ç”Ÿäº§ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å¯ç”¨ DCT ç¡®ä¿ä½¿ç”¨çš„é•œåƒéƒ½å·²ç­¾åã€‚å¦‚æœå¯ç”¨äº† DCTï¼Œé‚£ä¹ˆåªèƒ½å¯¹å—ä¿¡ä»»çš„é•œåƒï¼ˆå·²ç­¾åå¹¶å¯éªŒè¯çš„é•œåƒï¼‰è¿›è¡Œæ‹‰å–ã€è¿è¡Œæˆ–æ„å»ºã€‚&lt;/p>
&lt;p>å¯ç”¨ DCT æœ‰ç‚¹åƒå¯¹é•œåƒä»“åº“åº”ç”¨â€œè¿‡æ»¤å™¨â€ï¼Œå³ï¼Œåªèƒ½çœ‹åˆ°å·²ç­¾åçš„é•œåƒæ ‡ç­¾ï¼Œçœ‹ä¸åˆ°æœªç­¾åçš„é•œåƒæ ‡ç­¾ã€‚å¦‚æœå®¢æˆ·ç«¯æ²¡æœ‰å¯ç”¨ DCT ï¼Œé‚£ä¹ˆå®ƒå¯ä»¥çœ‹åˆ°æ‰€æœ‰çš„é•œåƒã€‚&lt;/p>
&lt;p>&lt;strong>è¿™é‡Œæˆ‘ä»¬æ¥å¿«é€Ÿçš„çœ‹ä¸€ä¸‹ DCT çš„å·¥ä½œè¿‡ç¨‹&lt;/strong>&lt;/p>
&lt;p>å®ƒå¯¹é•œåƒæ ‡ç­¾çš„ä¿¡ä»»æ˜¯é€šè¿‡ä½¿ç”¨ç­¾åå¯†é’¥æ¥ç®¡ç†çš„ã€‚åœ¨æˆ‘ä»¬é¦–æ¬¡å¼€å¯ DCT å¹¶ä½¿ç”¨çš„æ—¶å€™ä¼šåˆ›å»ºå¯†é’¥é›†ã€‚ä¸€ä¸ªå¯†é’¥é›†ç”±ä»¥ä¸‹å‡ ç±»å¯†é’¥ç»„æˆï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ä¸€ä¸ªç¦»çº¿å¯†é’¥ offline key ï¼Œå®ƒæ˜¯é•œåƒæ ‡ç­¾ DCT çš„æ ¹ ï¼ˆ&lt;strong>ä¸¢å¤±æ ¹å¯†é’¥å¾ˆéš¾æ¢å¤&lt;/strong>ï¼‰&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¯¹æ ‡ç­¾è¿›è¡Œç­¾åçš„å­˜å‚¨åº“æˆ–æ ‡è®°å¯†é’¥ tag key&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æœåŠ¡å™¨ç®¡ç†çš„å¯†é’¥ï¼Œä¾‹å¦‚æ—¶é—´æˆ³å¯†é’¥&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://i.loli.net/2021/11/24/r6TeNFBLQOu9Unm.png" alt="img">&lt;/p>
&lt;p>&lt;strong>å›¾ 5 ï¼Œ é•œåƒç­¾åå¯†é’¥ç¤ºä¾‹&lt;/strong>&lt;/p>
&lt;p>åˆšä»æˆ‘ä»¬æåˆ°å®¢æˆ·ç«¯ä½¿ç”¨ DCT ä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„ &lt;code>docker trust&lt;/code>å‘½ä»¤ï¼Œå®ƒæ˜¯å»ºç«‹åœ¨ Notary v1 ä¸Šçš„ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒDocker å®¢æˆ·ç«¯ä¸­ç¦ç”¨ DCT ã€‚è¦å¯ç”¨éœ€è¦è®¾ç½® &lt;code>DOCKER_CONTENT_TRUST=1&lt;/code> ç¯å¢ƒå˜é‡ ã€‚&lt;/p>
&lt;p>æ•ˆæœå¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-plain" data-lang="plain">âœ ~ DOCKER_CONTENT_TRUST=1 docker pull alpine:3.12
Pull (1 of 1): alpine:3.12@sha256:c0e9560cda118f9ec63ddefb4a173a2b2a0347082d7dff7dc14272e7841a5b5a
docker.io/library/alpine@sha256:c0e9560cda118f9ec63ddefb4a173a2b2a0347082d7dff7dc14272e7841a5b5a: Pulling from library/alpine
188c0c94c7c5: Already exists
Digest: sha256:c0e9560cda118f9ec63ddefb4a173a2b2a0347082d7dff7dc14272e7841a5b5a
Status: Downloaded newer image for alpine@sha256:c0e9560cda118f9ec63ddefb4a173a2b2a0347082d7dff7dc14272e7841a5b5a
Tagging alpine@sha256:c0e9560cda118f9ec63ddefb4a173a2b2a0347082d7dff7dc14272e7841a5b5a as alpine:3.12
docker.io/library/alpine:3.12
&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="notary-v1">Notary v1&lt;/h4>
&lt;p>å‰é¢æˆ‘ä»¬æåˆ° DCT æ˜¯åŸºäº Notary v1 å®ç°çš„ï¼Œä¸è¿‡è¿™ä¸æ˜¯æˆ‘ä»¬æœ¬ç¯‡çš„é‡ç‚¹ï¼Œæ‰€ä»¥è¿™é‡Œä»…å¯¹ Notary v1 åšä¸ªç®€å•çš„ä»‹ç»ã€‚Notary é¡¹ç›®åœ°å€ï¼š &lt;a href="https://github.com/notaryproject/notary">https://github.com/notaryproject/notary&lt;/a>&lt;/p>
&lt;p>&lt;img src="https://i.loli.net/2021/11/24/rLne1joJQNXhRkp.png" alt="img">&lt;/p>
&lt;p>&lt;strong>å›¾ 6 ï¼ŒNotary å®¢æˆ·ç«¯ã€æœåŠ¡å™¨å’Œç­¾åç›¸å…³çš„äº¤äº’æµç¨‹&lt;/strong>&lt;/p>
&lt;p>è¿‡ç¨‹1 - èº«ä»½è®¤è¯ï¼Œä»»ä½•æ²¡æœ‰ä»¤ç‰Œçš„è¿æ¥å°†è¢«é‡å®šå‘åˆ°æˆæƒæœåŠ¡å™¨ï¼ˆDocker Registry v2 èº«ä»½è®¤è¯ï¼‰ï¼›&lt;/p>
&lt;p>è¿‡ç¨‹2 - å®¢æˆ·ç«¯å°†é€šè¿‡ HTTPS ä¸Šçš„èº«ä»½éªŒè¯ç™»å½•åˆ°æˆæƒæœåŠ¡å™¨ï¼Œè·å–ä»¤ç‰Œï¼›&lt;/p>
&lt;p>è¿‡ç¨‹3 - å½“å®¢æˆ·ç«¯ä¸Šä¼ æ–°çš„å…ƒæ•°æ®æ–‡ä»¶æ—¶ï¼ŒæœåŠ¡å™¨ä¼šæ ¹æ®ä»¥å‰çš„ç‰ˆæœ¬æ£€æŸ¥å®ƒä»¬æ˜¯å¦å­˜åœ¨å†²çªï¼Œå¹¶éªŒè¯ä¸Šä¼ çš„å…ƒæ•°æ®çš„ç­¾åã€æ ¡éªŒå’Œå’Œæœ‰æ•ˆæ€§ï¼›&lt;/p>
&lt;p>è¿‡ç¨‹4 - ä¸€æ—¦æ‰€æœ‰ä¸Šä¼ çš„å…ƒæ•°æ®éƒ½ç»è¿‡éªŒè¯ï¼ŒæœåŠ¡å™¨ä¼šç”Ÿæˆæ—¶é—´æˆ³ï¼ˆå¯èƒ½è¿˜æœ‰å¿«ç…§ï¼‰ï¼Œç„¶åå°†å®ƒä»¬å‘é€ç»™ sign è¿›è¡Œç­¾åï¼›&lt;/p>
&lt;p>è¿‡ç¨‹5 - sign ä»å…¶æ•°æ®åº“ä¸­æ£€ç´¢åŠ å¯†ç§é’¥ï¼Œè§£å¯†å¯†é’¥ï¼Œå¹¶ä½¿ç”¨å®ƒä»¬è¿›è¡Œç­¾åï¼Œå¹¶å‘é€å›æœåŠ¡å™¨ï¼›&lt;/p>
&lt;p>è¿‡ç¨‹6 - æœåŠ¡å™¨å°†å®¢æˆ·ç«¯ä¸Šä¼ å’ŒæœåŠ¡å™¨ç”Ÿæˆçš„å…ƒæ•°æ®å­˜å‚¨åœ¨ TUF åº“ä¸­ã€‚ç”Ÿæˆçš„æ—¶é—´æˆ³å’Œå¿«ç…§å…ƒæ•°æ®è¯æ˜å®¢æˆ·ç«¯ä¸Šä¼ çš„å…ƒæ•°æ®æ˜¯è¯¥å¯ä¿¡é›†åˆçš„æœ€æ–°ç‰ˆæœ¬ã€‚ä¹‹åï¼ŒæœåŠ¡å™¨ä¼šé€šçŸ¥å®¢æˆ·ç«¯--ä¸Šä¼ æˆåŠŸï¼›&lt;/p>
&lt;p>è¿‡ç¨‹7 - å®¢æˆ·ç«¯ç°åœ¨å¯ä»¥ç«‹å³ä»æœåŠ¡å™¨ä¸‹è½½æœ€æ–°çš„å…ƒæ•°æ®äº†ã€‚åœ¨æ—¶é—´æˆ³è¿‡æœŸçš„æƒ…å†µä¸‹ï¼ŒæœåŠ¡å™¨å°†éå†æ•´ä¸ªåºåˆ—ï¼Œç”Ÿæˆæ–°çš„æ—¶é—´æˆ³ï¼Œè¯·æ±‚ sign ç­¾åï¼Œå°†æ–°ç­¾åçš„æ—¶é—´æˆ³å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ã€‚ç„¶åï¼Œå®ƒå°†è¿™ä¸ªæ–°çš„æ—¶é—´æˆ³è¿åŒå…¶ä»–å­˜å‚¨çš„å…ƒæ•°æ®ä¸€èµ·å‘é€ç»™è¯·æ±‚å®¢æˆ·ç«¯ï¼›&lt;/p>
&lt;p>è¿™ä¸ªé¡¹ç›®ç”±äºæ˜¯ä¸€ä¸ªå®‰å…¨é¡¹ç›®ï¼Œè™½ç„¶ç”¨é€”å¾ˆå¤§ï¼Œä½†æ•´ä½“å¹¶ä¸æ´»è·ƒã€‚ç°åœ¨æ­£åœ¨è¿›è¡Œ v2 ç‰ˆæœ¬çš„å¼€å‘ï¼Œæœ‰å…´è¶£çš„å°ä¼™ä¼´æ¬¢è¿åŠ å…¥ã€‚&lt;/p>
&lt;h4 id="sigstore-å’Œ-cosign">sigstore å’Œ Cosign&lt;/h4>
&lt;p>è¿™é‡Œä»‹ç»å¦ä¸€ä¸ªæ¥è‡ª Linux åŸºé‡‘ä¼šçš„é¡¹ç›®ï¼Œå«åš sigstore å®ƒä¸»è¦æ˜¯ä¸ºäº†æä¾›ä¸€äº›æ ‡å‡†çš„åº“/å·¥å…·ï¼Œä¾¿äºæ›´å¥½çš„è¿›è¡Œç­¾åå’Œæ ¡éªŒã€‚å½“ç„¶ï¼Œç›®å‰ sigstore å·²ç»æ±‡èšäº†åŒ…æ‹¬ Cosignï¼ŒFulcio å’Œ Rekor ç­‰å¼€æºé¡¹ç›®ï¼Œæ¶‰åŠåˆ°é•œåƒé•œåƒç­¾åæ ¡éªŒå’Œä¾›åº”é“¾ç­‰æ–¹é¢ã€‚&lt;/p>
&lt;p>&lt;img src="https://i.loli.net/2021/11/24/RIQ7Vvbd2aJ4BAh.png" alt="img">&lt;/p>
&lt;p>&lt;strong>å›¾ 7 ï¼Œsigstore ç®€ä»‹&lt;/strong>&lt;/p>
&lt;p>Cosign æ˜¯ sigstore çš„å·¥å…·ä¹‹ä¸€ï¼Œç”¨äº OCI registry ä¸­åˆ›å»ºã€å­˜å‚¨å’ŒéªŒè¯å®¹å™¨é•œåƒç­¾åã€‚Cosign v1.0 å·²äºä»Šå¹´ä¸‹åŠå¹´å‘å¸ƒï¼Œæ˜¯å¦èƒ½ç¨³å®šç”¨äºç”Ÿäº§ç¯å¢ƒï¼Œè¿˜æœ‰å¾…è€ƒéªŒã€‚ æˆªæ­¢ç›®å‰ï¼ŒCosign å·²ç»å‘å¸ƒäº† v1.3.1 ç‰ˆæœ¬ï¼Œè¯¦ç»†å˜æ›´è¯·å‚è€ƒå…¶ ReleaseNoteï¼š &lt;a href="https://github.com/sigstore/cosign/releases/tag/v1.3.1">https://github.com/sigstore/cosign/releases/tag/v1.3.1&lt;/a>&lt;/p>
&lt;p>æˆ‘ä»¬è¿™é‡Œçœ‹ä¸‹å®ƒå¦‚ä½•è¿›è¡Œé•œåƒçš„ç­¾å&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-plain" data-lang="plain">âœ cosign cosign generate-key-pair
Enter password for private key:
Enter password for private key again:
Private key written to cosign.key
Public key written to cosign.pub
âœ cosign cosign sign --key cosign.key ghcr.io/tao12345666333/argo-cd-demo/argo-cd-demo:fa5714f419b3d11dee6ac795e38356e9c3c439cb
Enter password for private key: %
âœ cosign cosign verify --key cosign.pub ghcr.io/tao12345666333/argo-cd-demo/argo-cd-demo:fa5714f419b3d11dee6ac795e38356e9c3c439cb
Verification for ghcr.io/tao12345666333/argo-cd-demo/argo-cd-demo:fa5714f419b3d11dee6ac795e38356e9c3c439cb --
The following checks were performed on each of these signatures:
- The cosign claims were validated
- The signatures were verified against the specified public key
- Any certificates were verified against the Fulcio roots.
[{&amp;#34;critical&amp;#34;:{&amp;#34;identity&amp;#34;:{&amp;#34;docker-reference&amp;#34;:&amp;#34;ghcr.io/tao12345666333/argo-cd-demo/argo-cd-demo&amp;#34;},&amp;#34;image&amp;#34;:{&amp;#34;docker-manifest-digest&amp;#34;:&amp;#34;sha256:768845efa2a32bc5c5d83a6f7ec668b98f5db46585dd1918afc9695a9e653d2d&amp;#34;},&amp;#34;type&amp;#34;:&amp;#34;cosign container image signature&amp;#34;},&amp;#34;optional&amp;#34;:null}]
&lt;/code>&lt;/pre>&lt;/div>&lt;p>çœ‹èµ·æ¥è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ã€‚&lt;/p>
&lt;h2 id="æ€»ç»“">æ€»ç»“&lt;/h2>
&lt;p>ä»¥ä¸Šå°±æ˜¯å…³äºé•œåƒè‡ªèº«å†…å®¹å®‰å…¨ï¼Œä»¥åŠé•œåƒåˆ†å‘å®‰å…¨ä¸­çš„é•œåƒç­¾åæ ¡éªŒéƒ¨åˆ†çš„å†…å®¹ã€‚&lt;/p>
&lt;p>ä¸‹ä¸€ç¯‡æˆ‘å°†ä¸ºå¤§å®¶ä»‹ç»å¦‚ä½•åœ¨é•œåƒåˆ†å‘åŠéƒ¨ç½²æ—¶è¿›è¡Œç­¾åçš„æ ¡éªŒï¼Œä»¥åŠå¦‚ä½•ä¿æŠ¤ Kubernetes é›†ç¾¤å…å—æœªç­¾åæˆ–ä¸å¯ä¿¡æ¥æºé•œåƒçš„æ”»å‡»ï¼Œæ•¬è¯·æœŸå¾…ï¼&lt;/p>
&lt;hr>
&lt;p>æ¬¢è¿è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://gitee.com/tlrr/awesome/raw/master/2020-9-9/1599632564572-mp-qrcode.png" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Docker/">Docker</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>Shell è„šæœ¬é¿å‘æŒ‡å—ï¼ˆä¸€ï¼‰</title><link>https://moelove.info/2021/11/21/Shell-%E8%84%9A%E6%9C%AC%E9%81%BF%E5%9D%91%E6%8C%87%E5%8D%97%E4%B8%80/</link><guid isPermaLink="true">https://moelove.info/2021/11/21/Shell-%E8%84%9A%E6%9C%AC%E9%81%BF%E5%9D%91%E6%8C%87%E5%8D%97%E4%B8%80/</guid><pubDate>Sun, 21 Nov 2021 22:41:02 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å¼ æ™‹æ¶›ã€‚&lt;/p>
&lt;p>æåˆ° Shell å¤§å®¶æƒ³å¿…ä¸ä¼šå¤ªé™Œç”Ÿï¼Œæˆ‘ä»¬é€šå¸¸è®¤ä¸º Shell æ˜¯æˆ‘ä»¬å’Œç³»ç»Ÿäº¤äº’çš„æ¥å£ï¼Œæ‰§è¡Œå‘½ä»¤è¿”å›è¾“å‡ºï¼Œæ¯”å¦‚ bash ã€zsh ç­‰ã€‚å¶å°”ä¹Ÿä¼šæœ‰äººæŠŠ Shell å’Œ Terminalï¼ˆç»ˆç«¯ï¼‰æ··æ·†ï¼Œä½†è¿™å’Œæœ¬æ–‡å…³ç³»ä¸å¤§ï¼Œæš‚ä¸”ç•¥è¿‡ã€‚&lt;/p>
&lt;p>ä½œä¸ºä¸€åç¨‹åºå‘˜ï¼Œæˆ‘ä»¬å¯èƒ½å¤©å¤©éƒ½ä¼šç”¨åˆ° Shell ï¼Œå¶å°”ä¹Ÿä¼šæŠŠä¸€äº›å‘½ä»¤ç»„ç»‡åˆ°ä¸€èµ·ï¼Œå†™ä¸ª Shell è„šæœ¬ä¹‹ç±»çš„ï¼Œä»¥ä¾¿æå‡æˆ‘ä»¬çš„å·¥ä½œæ•ˆç‡ã€‚&lt;/p>
&lt;p>ç„¶è€Œåœ¨çœ‹ä¼¼ç®€å•çš„ Shell è„šæœ¬ä¸­ï¼Œå¯èƒ½éšè—ç€å¾ˆæ·±çš„å‘ã€‚è¿™é‡Œæˆ‘å…ˆç»™å‡ºä¸¤æ®µç®€å•ä¸”ç›¸ä¼¼çš„ Shell è„šæœ¬ï¼Œå¤§å®¶ä¸å¦¨æ¥çœ‹çœ‹è¿™ä¸¤æ®µä»£ç çš„è¾“å‡ºæ˜¯ä»€ä¹ˆï¼š&lt;/p>
&lt;pre>&lt;code>#!/bin/bash
set -e -u
i=0
while [ $i -lt 6 ]; do
echo $i
((i++))
done
&lt;/code>&lt;/pre>&lt;p>&lt;strong>ç­”æ¡ˆæ˜¯åªä¼šè¾“å‡ºä¸€ä¸ª 0 ã€‚&lt;/strong>&lt;/p>
&lt;pre>&lt;code>#!/bin/bash
set -e -u
let i=0
while [ $i -lt 6 ]; do
echo $i
((i++))
done
&lt;/code>&lt;/pre>&lt;p>&lt;strong>ç­”æ¡ˆæ˜¯æ²¡æœ‰ä»»ä½•è¾“å‡ºï¼Œç›´æ¥é€€å‡ºã€‚&lt;/strong>&lt;/p>
&lt;p>&lt;strong>å¦‚æœä½ èƒ½è§£é‡Šæ¸…æ¥šä¸Šé¢ä¸¤æ®µä»£ç è¾“å‡ºç»“æœçš„è¯ï¼Œ é‚£å¤§æ¦‚ä½ å¯ä»¥è·³è¿‡è¿™ç¯‡æ–‡ç« åç»­çš„å†…å®¹äº†ã€‚&lt;/strong>&lt;/p>
&lt;p>æˆ‘å…ˆæ¥åˆ†è§£ä¸‹è¿™æ®µä»£ç ä¸­æ¶‰åŠåˆ°çš„ä¸»è¦çŸ¥è¯†ç‚¹ã€‚&lt;/p>
&lt;h2 id="å˜é‡å£°æ˜">å˜é‡å£°æ˜&lt;/h2>
&lt;p>å˜é‡å£°æ˜æœ‰å¾ˆå¤šç§åŠæ³•ï¼Œ ä½†æ˜¯å…¶è¡Œä¸ºå´å„æœ‰ä¸åŒã€‚&lt;/p>
&lt;p>æˆ‘ä»¬å¿…é¡»å…ˆæœ‰ä¸ªåŸºç¡€è®¤è¯†ï¼š &lt;strong>Bash æ²¡æœ‰ç±»å‹ç³»ç»Ÿï¼Œæ‰€æœ‰å˜é‡éƒ½æ˜¯ string ã€‚&lt;/strong> åŸºäºè¿™ä¸ªåŸå› ï¼Œå¦‚æœæ˜¯è®©å˜é‡è¿›è¡Œç®—æœ¯è¿ç®—æ—¶ï¼Œä¸èƒ½åƒåœ¨å…¶ä»–çš„ç¼–ç¨‹è¯­è¨€ä¸­é‚£æ ·ç›´æ¥å†™ç®—æœ¯è¿ç®—ç¬¦ã€‚è¿™ä¼šè®© bash è§£é‡Šä¸ºå¯¹ string çš„æ“ä½œï¼Œè€Œä¸æ˜¯å¯¹æ•°å­—çš„æ“ä½œã€‚&lt;/p>
&lt;h3 id="ç›´æ¥å£°æ˜">ç›´æ¥å£°æ˜&lt;/h3>
&lt;pre>&lt;code>(MoeLove)âœ ~ foo=1+1
(MoeLove)âœ ~ echo $foo
1+1
&lt;/code>&lt;/pre>&lt;p>ç›´æ¥å£°æ˜æœ€ç®€å•ï¼Œä½†æ­£å¦‚å‰é¢æåˆ°çš„ï¼Œç›´æ¥å£°æ˜ä¼šé»˜è®¤å½“ä½œ string è¿›è¡Œå¤„ç†ï¼Œä¸èƒ½åœ¨å£°æ˜æ—¶è¿›è¡Œç®—æœ¯è¿ç®—ã€‚&lt;/p>
&lt;h3 id="declare-å£°æ˜">declare å£°æ˜&lt;/h3>
&lt;pre>&lt;code>(MoeLove)âœ ~ declare foo=1+1
(MoeLove)âœ ~ echo $foo
1+1
&lt;/code>&lt;/pre>&lt;p>é™¤å»ç›´æ¥å£°æ˜å˜é‡å¤–ï¼Œæ¯”è¾ƒå¸¸ç”¨çš„æ–¹æ³•æ˜¯ç”¨ &lt;code>declare&lt;/code> æ¥å£°æ˜å˜é‡ï¼Œä½†é»˜è®¤æƒ…å†µä¸‹ï¼Œå…¶å£°æ˜çš„å˜é‡éƒ½æ˜¯æŒ‰ string å¤„ç†çš„ï¼Œæ— æ³•è¿›è¡Œæ­£å¸¸çš„ç®—æœ¯è¿ç®—ã€‚&lt;/p>
&lt;p>&lt;strong>declare æ•´æ•°å±æ€§&lt;/strong>&lt;/p>
&lt;p>declare åœ¨å£°æ˜å˜é‡çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡ &lt;code>-i&lt;/code> å‚æ•°å¢åŠ æ•´æ•°å±æ€§ï¼Œå½“å˜é‡è¢«èµ‹å€¼æ—¶ï¼Œå°†è¿›è¡Œç®—æœ¯è¿ç®—ã€‚&lt;/p>
&lt;pre>&lt;code>(MoeLove)âœ ~ declare -i bar=1+1
(MoeLove)âœ ~ echo $bar
2
&lt;/code>&lt;/pre>&lt;p>ä½†è¦æ³¨æ„çš„æ˜¯ï¼Œå¢åŠ æ•´æ•°å±æ€§åï¼Œå¦‚æœå°†å­—ç¬¦ä¸²èµ‹å€¼ç»™å®ƒï¼Œåˆ™ä¼šå‡ºç°è§£æå¤±è´¥çš„æƒ…å†µï¼Œå³ï¼šå°†å€¼è®¾ç½®ä¸º 0ï¼š&lt;/p>
&lt;pre>&lt;code>(MoeLove)âœ ~ bar=test
(MoeLove)âœ ~ echo $bar
0
&lt;/code>&lt;/pre>&lt;h3 id="let-å£°æ˜">let å£°æ˜&lt;/h3>
&lt;p>å¦ä¸€ç§åŠæ³•ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ &lt;code>let&lt;/code> å‘½ä»¤è¿›è¡Œå˜é‡çš„å£°æ˜ï¼Œè¿™ç§æ–¹å¼å…è®¸åœ¨å£°æ˜æ—¶è¿›è¡Œç®—æœ¯è¿ç®—ï¼ŒåŒæ—¶ä¹Ÿæ”¯æŒå°†å…¶ä»–å€¼èµ‹å€¼ç»™æ­¤å˜é‡ã€‚&lt;/p>
&lt;pre>&lt;code>(MoeLove)âœ ~ let baz=1+1
(MoeLove)âœ ~ echo $baz
2
(MoeLove)âœ ~ baz=moelove.info
(MoeLove)âœ ~ echo $baz
moelove.info
&lt;/code>&lt;/pre>&lt;h2 id="while-å¾ªç¯">while å¾ªç¯&lt;/h2>
&lt;pre>&lt;code>while list-1; do list-2; done
&lt;/code>&lt;/pre>&lt;p>Bash ä¸­ while è¯­æ³•å°±æ˜¯è¿™æ ·ï¼Œåœ¨ while å…³é”®å­—åæ˜¯ä¸€ä¸ªåºåˆ—ï¼ˆlistï¼‰ï¼Œå¯ä»¥æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªè¡¨è¾¾å¼/è¯­å¥ï¼Œ&lt;/p>
&lt;p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“ list-1 è¿”å›å€¼ä¸º 0 æ—¶ï¼Œ list-2 æ€»æ˜¯ä¼šè¢«æ‰§è¡Œï¼Œå¹¶ä¸” while è¯­å¥æœ€åçš„è¿”å›å€¼æ˜¯ list-2 æœ€åä¸€æ¬¡æ‰§è¡Œçš„è¿”å›å€¼ï¼Œæˆ–è€…ï¼Œå¦‚æœæ²¡æ‰§è¡Œä»»ä½•è¯­å¥çš„è¯ï¼Œåˆ™è¿”å› 0 ã€‚&lt;/p>
&lt;h2 id="bash-ä¸­çš„ç®—æ•°è®¡ç®—">bash ä¸­çš„ç®—æ•°è®¡ç®—&lt;/h2>
&lt;p>è¿™éƒ¨åˆ†çš„å†…å®¹å¤§å®¶æƒ³å¿…å¸¸ä¼šç”¨åˆ°ã€‚æˆ‘æ¥ä»‹ç»å‡ ç§å¸¸ç”¨çš„æ–¹æ³•ï¼š&lt;/p>
&lt;h3 id="ç®—æœ¯æ‰©å±•">ç®—æœ¯æ‰©å±•&lt;/h3>
&lt;p>Bash ä¸­çš„æ‰©å±•ä¸€å…±æœ‰ 7 ç§ï¼Œç®—æœ¯æ‰©å±•åªæ˜¯å…¶ä¸­ä¹‹ä¸€ã€‚å…·ä½“è€Œè¨€å°±æ˜¯é€šè¿‡ç±»ä¼¼ &lt;code>$((expression))&lt;/code> è¿™æ ·çš„å½¢å¼ï¼Œæ¥è®¡ç®—è¡¨è¾¾å¼çš„å€¼ã€‚ä¾‹å¦‚ï¼š&lt;/p>
&lt;pre>&lt;code>(MoeLove)âœ ~ echo $((3+7))
10
(MoeLove)âœ ~ x=3;y=7
(MoeLove)âœ ~ echo $((x+y))
10
&lt;/code>&lt;/pre>&lt;h3 id="expr-å‘½ä»¤">expr å‘½ä»¤&lt;/h3>
&lt;p>expr æ˜¯ coreutils è½¯ä»¶åŒ…æä¾›çš„ä¸€ä¸ªå‘½ä»¤ï¼Œå¯å¯¹è¡¨è¾¾å¼è¿›è¡Œè®¡ç®—ï¼Œæˆ–è€…æ¯”è¾ƒå¤§å°ä¹‹ç±»çš„ã€‚&lt;/p>
&lt;pre>&lt;code>(MoeLove)âœ ~ x=3;y=7
(MoeLove)âœ ~ expr $x + $y
10
## æ¯”è¾ƒå¤§å°
(MoeLove)âœ ~ expr 2 \&amp;lt; 3
1
(MoeLove)âœ ~ expr 2 \&amp;lt; 1
0
&lt;/code>&lt;/pre>&lt;h3 id="bc-å‘½ä»¤">bc å‘½ä»¤&lt;/h3>
&lt;p>æŒ‰å®šä¹‰æ¥è¯´ï¼Œbc å…¶å®æ˜¯ä¸€ç§æ”¯æŒä»»æ„ç²¾åº¦å’Œå¯äº¤äº’æ‰§è¡Œçš„è®¡ç®—è¯­è¨€ã€‚å®ƒæ¯”ä¸Šè¿°æåˆ°çš„ &lt;code>expr&lt;/code> è¦å¼ºå¤§çš„å¤šï¼Œå°¤å…¶æ˜¯å®ƒè¿˜æ”¯æŒæµ®ç‚¹æ•°è¿ç®—ã€‚ä¾‹å¦‚ï¼š&lt;/p>
&lt;h4 id="ä¸€èˆ¬æµ®ç‚¹æ•°è®¡ç®—">ä¸€èˆ¬æµ®ç‚¹æ•°è®¡ç®—&lt;/h4>
&lt;pre>&lt;code>(MoeLove)âœ ~ echo &amp;quot;scale=2;7/3&amp;quot;|bc
2.33
(MoeLove)âœ ~ echo &amp;quot;7/3&amp;quot;|bc
2
&lt;/code>&lt;/pre>&lt;p>æ³¨æ„ï¼š &lt;code>scale&lt;/code> éœ€è¦æ‰‹åŠ¨æŒ‡å®šï¼Œå®ƒè¡¨ç¤ºå°æ•°ç‚¹åçš„ä½æ•°ã€‚é»˜è®¤æƒ…å†µä¸‹ &lt;code>scale&lt;/code> çš„å€¼ä¸º 0 ã€‚&lt;/p>
&lt;h4 id="å†…ç½®å‡½æ•°">å†…ç½®å‡½æ•°&lt;/h4>
&lt;p>bc è¿˜æœ‰ä¸€äº›å†…ç½®å‡½æ•°ï¼Œå¯ä»¥æ–¹ä¾¿æˆ‘ä»¬è¿›è¡Œä¸€äº›å¿«é€Ÿçš„è®¡ç®—ï¼Œæ¯”å¦‚å¯ä»¥åˆ©ç”¨ &lt;code>sqrt()&lt;/code> å¿«é€Ÿçš„è®¡ç®—å¹³æ–¹æ ¹ã€‚&lt;/p>
&lt;pre>&lt;code>(MoeLove)âœ ~ echo &amp;quot;scale=2;sqrt(9)&amp;quot; |bc
3.00
(MoeLove)âœ ~ echo &amp;quot;scale=2;sqrt(6)&amp;quot; |bc
2.44
&lt;/code>&lt;/pre>&lt;h4 id="è„šæœ¬">è„šæœ¬&lt;/h4>
&lt;p>æ­¤å¤–ï¼Œ bc è¿˜æ”¯æŒä¸€ç§ç®€å•çš„è¯­æ³•ï¼Œå¯ä»¥æ”¯æŒå£°æ˜å˜é‡ï¼Œç¼–å†™å¾ªç¯å’Œåˆ¤æ–­è¯­å¥ç­‰ã€‚ä¾‹å¦‚ï¼šæˆ‘ä»¬å¯ä»¥æ‰“å°20 ä»¥å†…å¯ä»¥è¢« 3 æ•´é™¤çš„æ•°ï¼š&lt;/p>
&lt;pre>&lt;code>(MoeLove)âœ ~ echo &amp;quot;for(i=1; i&amp;lt;=20; i++) {if (i % 3 == 0) i;}&amp;quot; |bc
3
6
9
12
15
18
&lt;/code>&lt;/pre>&lt;h2 id="bash-çš„è°ƒè¯•">bash çš„è°ƒè¯•&lt;/h2>
&lt;p>å…¶å® bash shell ä¸­å¹¶æ²¡æœ‰å†…ç½®è°ƒè¯•å™¨ã€‚å¾ˆå¤šæƒ…å†µä¸‹ï¼Œéƒ½æ˜¯é‡‡ç”¨é‡å¤è¿è¡ŒåŠ æ‰“å°æ¥è¿›è¡Œè°ƒè¯•ã€‚ä½†è¿™ç§æ–¹å¼ä¸å¤Ÿé«˜æ•ˆã€‚&lt;/p>
&lt;p>è¿™é‡Œä»‹ç»ä¸€ç§æ¯”è¾ƒç›´è§‚çš„ï¼Œä¹Ÿæ¯”è¾ƒæ–¹ä¾¿çš„ç”¨æ¥è°ƒè¯• shell ä»£ç çš„åŠæ³•ã€‚ä»¥ä¸‹æ˜¯ä¸€æ®µç¤ºä¾‹ shell ä»£ç ã€‚&lt;/p>
&lt;pre>&lt;code>(MoeLove)âœ ~ cat compare.sh
#!/bin/bash
read -p &amp;quot;è¯·è¾“å…¥ä»»æ„æ•°å­—: &amp;quot; val
real_val=66
if [ &amp;quot;$val&amp;quot; -gt &amp;quot;$real_val&amp;quot; ]
then
echo &amp;quot;è¾“å…¥å€¼å¤§äºç­‰äºé¢„è®¾å€¼&amp;quot;
else
echo &amp;quot;è¾“å…¥å€¼æ¯”é¢„è®¾å€¼å°&amp;quot;
fi
&lt;/code>&lt;/pre>&lt;p>ä¸ºå…¶å¢åŠ æ‰§è¡Œæƒé™ï¼Œæˆ–è€…ä½¿ç”¨ bash æ‰§è¡Œï¼š&lt;/p>
&lt;pre>&lt;code>(MoeLove)âœ ~ bash compare.sh
è¯·è¾“å…¥ä»»æ„æ•°å­—: 33
è¾“å…¥å€¼æ¯”é¢„è®¾å€¼å°
&lt;/code>&lt;/pre>&lt;h3 id="è¯¦ç»†æ¨¡å¼">è¯¦ç»†æ¨¡å¼&lt;/h3>
&lt;p>é€šè¿‡å¢åŠ  &lt;code>-v&lt;/code> é€‰é¡¹ï¼Œå³å¯å¼€å¯è¯¦ç»†æ¨¡å¼ï¼Œç”¨äºæŸ¥çœ‹æ‰€æ‰§è¡Œçš„å‘½ä»¤ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡åœ¨ shebang ä¸Šç›´æ¥å¢åŠ  &lt;code>-v&lt;/code> é€‰é¡¹ï¼Œ æˆ–è€…å¢åŠ  &lt;code>set -v&lt;/code> æ¥å¼€å¯æ­¤æ¨¡å¼&lt;/p>
&lt;pre>&lt;code>(MoeLove)âœ ~ bash -v compare.sh
which () { ( alias;
eval ${which_declare} ) | /usr/bin/which --tty-only --read-alias --read-functions --show-tilde --show-dot &amp;quot;$@&amp;quot;
}
#!/bin/bash
read -p &amp;quot;è¯·è¾“å…¥ä»»æ„æ•°å­—: &amp;quot; val
è¯·è¾“å…¥ä»»æ„æ•°å­—: 33
real_val=66
if [ &amp;quot;$val&amp;quot; -gt &amp;quot;$real_val&amp;quot; ]
then
echo &amp;quot;è¾“å…¥å€¼å¤§äºç­‰äºé¢„è®¾å€¼&amp;quot;
else
echo &amp;quot;è¾“å…¥å€¼æ¯”é¢„è®¾å€¼å°&amp;quot;
fi
è¾“å…¥å€¼æ¯”é¢„è®¾å€¼å°
&lt;/code>&lt;/pre>&lt;h3 id="ä½¿ç”¨-xtrace-æ¨¡å¼">ä½¿ç”¨ xtrace æ¨¡å¼&lt;/h3>
&lt;p>æˆ‘ä»¬å¯ä»¥é€šè¿‡å¢åŠ  &lt;code>-x&lt;/code> å‚æ•°æ¥è¿›å…¥ xtrace æ¨¡å¼ï¼Œç”¨äºè°ƒè¯•æ‰§è¡Œé˜¶æ®µçš„å˜é‡å€¼ã€‚&lt;/p>
&lt;pre>&lt;code>(MoeLove)âœ ~ bash -x compare.sh
+ read -p 'è¯·è¾“å…¥ä»»æ„æ•°å­—: ' val
è¯·è¾“å…¥ä»»æ„æ•°å­—: 33
+ real_val=66
+ '[' 33 -gt 66 ']'
+ echo è¾“å…¥å€¼æ¯”é¢„è®¾å€¼å°
è¾“å…¥å€¼æ¯”é¢„è®¾å€¼å°
&lt;/code>&lt;/pre>&lt;h3 id="è¯†åˆ«æœªå®šä¹‰å˜é‡">è¯†åˆ«æœªå®šä¹‰å˜é‡&lt;/h3>
&lt;p>ä»¥ä¸‹ç¤ºä¾‹ä¸­ï¼Œæˆ‘æ•…æ„å†™é”™ä¸€ä¸ªå­—ç¬¦ã€‚æ‰§è¡Œè„šæœ¬åï¼Œä½ ä¼šå‘ç°æ²¡æœ‰ä»»ä½•æŠ¥é”™ï¼Œä½†ç»“æœå¹¶ä¸æ˜¯æˆ‘ä»¬é¢„æœŸçš„ã€‚è¿™ç±»å¯èƒ½æ˜¯æ‰‹è¯¯å±…å¤šï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æ£€æŸ¥æ˜¯å¦å­˜åœ¨æœªç»‘å®šçš„å˜é‡ã€‚&lt;/p>
&lt;pre>&lt;code>(MoeLove)âœ ~ cat add.sh
#!/bin/bash
five=5
ten=10
total=$((five+tne))
echo $total
(MoeLove)âœ ~ bash add.sh
5
(MoeLove)âœ ~ bash -u add.sh
add.sh: line 4: tne: unbound variable
&lt;/code>&lt;/pre>&lt;p>å¢åŠ  &lt;code>-u&lt;/code> é€‰é¡¹ï¼Œ å¯ä»¥æ£€æŸ¥å˜é‡æ˜¯å¦æœªå®šä¹‰/ç»‘å®šã€‚&lt;/p>
&lt;h3 id="ç»„åˆä½¿ç”¨">ç»„åˆä½¿ç”¨&lt;/h3>
&lt;p>ä»¥ä¸Šæ˜¯å‡ ç§æ¯”è¾ƒå¸¸è§çš„ä½¿ç”¨æ–¹å¼ï¼Œå½“ç„¶ï¼Œä¹Ÿå¯ä»¥æŠŠå®ƒè¿›è¡Œç»„åˆä½¿ç”¨ã€‚æ¯”å¦‚ä¸Šé¢çš„å˜é‡æœªå®šä¹‰çš„é—®é¢˜ï¼Œ ç»„åˆä½¿ç”¨ &lt;code>-vu&lt;/code> å°±å¯ä»¥ç›´æ¥çœ‹åˆ°å…·ä½“å‡ºç°é—®é¢˜çš„ä»£ç æ˜¯ä»€ä¹ˆå†…å®¹äº†ã€‚&lt;/p>
&lt;pre>&lt;code>(MoeLove)âœ ~ bash -vu add.sh
which () { ( alias;
eval ${which_declare} ) | /usr/bin/which --tty-only --read-alias --read-functions --show-tilde --show-dot &amp;quot;$@&amp;quot;
}
#!/bin/bash
five=5
ten=10
total=$((five+tne))
add.sh: line 4: tne: unbound variable
&lt;/code>&lt;/pre>&lt;h3 id="å°†è°ƒè¯•ä¿¡æ¯è¾“å‡ºåˆ°æŒ‡å®šæ–‡ä»¶">å°†è°ƒè¯•ä¿¡æ¯è¾“å‡ºåˆ°æŒ‡å®šæ–‡ä»¶&lt;/h3>
&lt;p>è¿™é‡Œæˆ‘æ‰“å¼€äº†ä¸€ä¸ªç‰¹å®š FD ä¸Šçš„ &lt;code>debug.log&lt;/code> æ–‡ä»¶ï¼Œæ³¨æ„è¿™ä¸ª FD éœ€è¦ä¸ &lt;code>BASH_XTRACEFD&lt;/code> é…ç½®çš„ä¸€è‡´ï¼Œå¦å¤–æˆ‘ä¿®æ”¹äº† &lt;code>PS4&lt;/code> çš„å˜é‡å†…å®¹ï¼Œå®ƒçš„é»˜è®¤å€¼æ˜¯ &lt;code>+&lt;/code> çœ‹èµ·æ¥ä¼šæ¯”è¾ƒä¹±ï¼Œè€Œä¸”æ²¡æœ‰æœ‰æ•ˆä¿¡æ¯ï¼Œæˆ‘é€šè¿‡è®¾ç½® &lt;code>PS4='$LINENO: ' &lt;/code> è®©å®ƒæ˜¾ç¤ºè¡Œå·ã€‚&lt;/p>
&lt;p>ç„¶ååœ¨éœ€è¦è°ƒè¯•çš„ä½ç½®è®¾ç½® &lt;code>set -x&lt;/code> ï¼Œåœ¨ç»“æŸçš„ä½ç½®è®¾ç½® &lt;code>set +x&lt;/code> ï¼Œè¿™æ ·è°ƒè¯•æ—¥å¿—ä¸­å°±åªä¼šè®°å½•æˆ‘éœ€è¦è°ƒè¯•éƒ¨åˆ†çš„æ—¥å¿—äº†ã€‚&lt;/p>
&lt;pre>&lt;code>(MoeLove)âœ ~ cat compare.sh
#!/bin/bash
exec 6&amp;gt; debug.log
PS4='$LINENO: '
BASH_XTRACEFD=&amp;quot;6&amp;quot;
read -p &amp;quot;è¯·è¾“å…¥ä»»æ„æ•°å­—: &amp;quot; val
real_val=66
set -x
if [ &amp;quot;$val&amp;quot; -gt &amp;quot;$real_val&amp;quot; ]
then
echo &amp;quot;è¾“å…¥å€¼å¤§äºç­‰äºé¢„è®¾å€¼&amp;quot;
else
echo &amp;quot;è¾“å…¥å€¼æ¯”é¢„è®¾å€¼å°&amp;quot;
fi
set +x
echo &amp;quot;End&amp;quot;
(MoeLove)âœ ~ bash compare.sh
è¯·è¾“å…¥ä»»æ„æ•°å­—: 88
è¾“å…¥å€¼å¤§äºç­‰äºé¢„è®¾å€¼
End
(MoeLove)âœ ~ cat debug.log
8: '[' 88 -gt 66 ']'
10: echo $'\350\276\223\345\205\245\345\200\274\345\244\247\344\272\216\347\255\211\344\272\216\351\242\204\350\256\276\345\200\274'
14: set +x
&lt;/code>&lt;/pre>&lt;p>è¿™é‡Œä»‹ç»äº†&lt;strong>é€šè¿‡ set è®¾ç½®é€‰é¡¹&lt;/strong> çš„æ–¹å¼è¾ƒç®€å•ï¼Œå…¶ä»–çš„æ¯”å¦‚ä½¿ç”¨ trap åŠ è°ƒè¯•çš„æ–¹å¼ä¹Ÿæ¨èå¤§å®¶å»å°è¯•ä¸‹ï¼Œè¿™é‡Œå°±ä¸å±•å¼€äº†ã€‚&lt;/p>
&lt;h2 id="å›åˆ°å¼€å§‹çš„é—®é¢˜">å›åˆ°å¼€å§‹çš„é—®é¢˜&lt;/h2>
&lt;p>é‚£æˆ‘ä»¬ç”¨åˆšæ‰ä»‹ç»çš„è°ƒè¯•æ–¹æ³•æ¥æ‰§è¡Œä¸‹å¼€å¤´çš„ä¸¤ä¸ªè„šæœ¬ï¼Œå¹¶ä¸”è¿›è¡Œé—®é¢˜çš„è§£ç­”ã€‚&lt;/p>
&lt;h3 id="ç¬¬ä¸€ä¸ª">ç¬¬ä¸€ä¸ª&lt;/h3>
&lt;pre>&lt;code>(MoeLove)âœ ~ bash -xv demo1.sh
#!/bin/bash
set -e -u
+ set -e -u
i=0
+ i=0
while [ $i -lt 6 ]; do
echo $i
((i++))
done
+ '[' 0 -lt 6 ']'
+ echo 0
0
+ (( i++ ))
&lt;/code>&lt;/pre>&lt;p>ä»ä¸Šè¿°è°ƒè¯•ç»“æœå¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªè„šæœ¬åœ¨è¾“å‡º &lt;code>0&lt;/code> ç„¶åæ‰§è¡Œå®Œ &lt;code>((i++))&lt;/code> åé€€å‡ºã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ ä¸»è¦æ˜¯ç”±äºåœ¨è„šæœ¬é¡¶éƒ¨å¢åŠ çš„ &lt;code>set -e&lt;/code> é€‰é¡¹ã€‚&lt;/p>
&lt;p>&lt;strong>è¯¥é€‰é¡¹åœ¨é‡åˆ°é¦–ä¸ªé 0 å€¼çš„æ—¶å€™ä¼šç›´æ¥é€€å‡ºã€‚&lt;/strong> æˆ‘ä»¬æ¥è§£é‡Šä¸‹ï¼š&lt;/p>
&lt;pre>&lt;code>(MoeLove)âœ ~ i=0
(MoeLove)âœ ~ ((i++))
(MoeLove)âœ ~ echo $?
1
&lt;/code>&lt;/pre>&lt;p>å¯ä»¥çœ‹åˆ°ï¼Œæ‰§è¡Œ &lt;code>((i++))&lt;/code> åï¼Œè¿”å›å€¼å…¶å®æ˜¯ 1 ï¼Œæ‰€ä»¥è§¦å‘äº† &lt;code>set -e&lt;/code> çš„é€€å‡ºæ¡ä»¶ï¼Œè„šæœ¬ä¾¿é€€å‡ºäº†ã€‚&lt;/p>
&lt;h3 id="ç¬¬äºŒä¸ª">ç¬¬äºŒä¸ª&lt;/h3>
&lt;pre>&lt;code>(MoeLove)âœ ~ bash -xv demo2.sh
#!/bin/bash
set -e -u
+ set -e -u
let i=0
+ let i=0
&lt;/code>&lt;/pre>&lt;p>ç¬¬äºŒä¸ªå’Œç¬¬ä¸€ä¸ªçš„æœ€ä¸»è¦åŒºåˆ«åœ¨äºå˜é‡çš„èµ‹å€¼ä¸Šï¼Œ &lt;code>let i=0&lt;/code> çš„è¿”å›å€¼æ˜¯ 1 ï¼Œæ‰€ä»¥ä¹Ÿå°±ä¼šè§¦å‘ &lt;code>set -e&lt;/code> çš„é€€å‡ºæ¡ä»¶äº†ã€‚æˆ‘ä»¬å°è¯•å°†ç¬¬äºŒä¸ªè„šæœ¬ä¿®æ”¹ä¸‹ï¼Œå†æ¬¡æ‰§è¡Œï¼š&lt;/p>
&lt;pre>&lt;code>[tao@moelove ~]$ cat demo2-1.sh
#!/bin/bash
set -e -u
let i=1
while [ $i -lt 6 ]; do
echo $i
((i++))
done
[tao@moelove ~]$ bash demo2-1.sh
1
2
3
4
5
&lt;/code>&lt;/pre>&lt;p>å°† &lt;code>let i=0&lt;/code> ä¿®æ”¹æˆ &lt;code>let i=1&lt;/code> å³å¯æŒ‰é¢„æœŸæ‰§è¡ŒæˆåŠŸã€‚&lt;/p>
&lt;h2 id="æ€»ç»“">æ€»ç»“&lt;/h2>
&lt;p>æœ¬ç¯‡ä¸­ï¼Œæˆ‘ä»¬ä¸»è¦èŠäº† bash shell ä¸­çš„å˜é‡å£°æ˜ï¼Œå¾ªç¯ï¼Œæ•°å­¦è¿ç®—ä»¥åŠ bash shell çš„è°ƒè¯•ã€‚æ˜¯å¦å¯¹ä½ æœ‰æ‰€å¯å‘å‘¢ï¼Ÿ æ¬¢è¿ç•™è¨€è¿›è¡Œäº¤æµã€‚&lt;/p>
&lt;ul>
&lt;li>æ³¨ï¼šæœ¬æ–‡ä»…è®¨è®º Bash Shell&lt;/li>
&lt;/ul>
&lt;hr>
&lt;p>æ¬¢è¿è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://gitee.com/tlrr/awesome/raw/master/2020-9-9/1599632564572-mp-qrcode.png" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Shell/">Shell</category></item><item><title>ä¸€ç¯‡ææ‡‚å®¹å™¨æŠ€æœ¯çš„åŸºçŸ³ï¼š cgroup</title><link>https://moelove.info/2021/11/17/%E4%B8%80%E7%AF%87%E6%90%9E%E6%87%82%E5%AE%B9%E5%99%A8%E6%8A%80%E6%9C%AF%E7%9A%84%E5%9F%BA%E7%9F%B3-cgroup/</link><guid isPermaLink="true">https://moelove.info/2021/11/17/%E4%B8%80%E7%AF%87%E6%90%9E%E6%87%82%E5%AE%B9%E5%99%A8%E6%8A%80%E6%9C%AF%E7%9A%84%E5%9F%BA%E7%9F%B3-cgroup/</guid><pubDate>Wed, 17 Nov 2021 23:16:42 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å¼ æ™‹æ¶›ã€‚&lt;/p>
&lt;p>ç›®å‰æˆ‘ä»¬æ‰€æåˆ°çš„å®¹å™¨æŠ€æœ¯ã€è™šæ‹ŸåŒ–æŠ€æœ¯ï¼ˆä¸è®ºä½•ç§æŠ½è±¡å±‚æ¬¡ä¸‹çš„è™šæ‹ŸåŒ–æŠ€æœ¯ï¼‰éƒ½èƒ½åšåˆ°èµ„æºå±‚é¢ä¸Šçš„éš”ç¦»å’Œé™åˆ¶ã€‚&lt;/p>
&lt;p>å¯¹äºå®¹å™¨æŠ€æœ¯è€Œè¨€ï¼Œå®ƒå®ç°èµ„æºå±‚é¢ä¸Šçš„é™åˆ¶å’Œéš”ç¦»ï¼Œä¾èµ–äº Linux å†…æ ¸æ‰€æä¾›çš„ cgroup å’Œ namespace æŠ€æœ¯ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬å…ˆå¯¹è¿™ä¸¤é¡¹æŠ€æœ¯çš„ä½œç”¨åšä¸ªæ¦‚æ‹¬ï¼š&lt;/p>
&lt;ul>
&lt;li>cgroup çš„ä¸»è¦ä½œç”¨ï¼šç®¡ç†èµ„æºçš„åˆ†é…ã€é™åˆ¶ï¼›&lt;/li>
&lt;li>namespace çš„ä¸»è¦ä½œç”¨ï¼šå°è£…æŠ½è±¡ï¼Œé™åˆ¶ï¼Œéš”ç¦»ï¼Œä½¿å‘½åç©ºé—´å†…çš„è¿›ç¨‹çœ‹èµ·æ¥æ‹¥æœ‰ä»–ä»¬è‡ªå·±çš„å…¨å±€èµ„æºï¼›&lt;/li>
&lt;/ul>
&lt;p>æœ¬ç¯‡ï¼Œæˆ‘ä»¬é‡ç‚¹æ¥èŠ cgroup ã€‚&lt;/p>
&lt;h2 id="ä¸ºä»€ä¹ˆè¦å…³æ³¨-cgroup--namespace">ä¸ºä»€ä¹ˆè¦å…³æ³¨ cgroup &amp;amp; namespace&lt;/h2>
&lt;h3 id="äº‘åŸç”Ÿå®¹å™¨æŠ€æœ¯çš„äº•å–·å¼å¢é•¿">äº‘åŸç”Ÿ/å®¹å™¨æŠ€æœ¯çš„äº•å–·å¼å¢é•¿&lt;/h3>
&lt;p>è‡ª 1979å¹´ï¼Œ&lt;strong>Unix ç‰ˆæœ¬7&lt;/strong> åœ¨å¼€å‘è¿‡ç¨‹ä¸­å¼•å…¥ &lt;strong>Chroot Jail&lt;/strong> ä»¥åŠ &lt;strong>Chroot&lt;/strong> ç³»ç»Ÿè°ƒç”¨å¼€å§‹ï¼Œç›´åˆ° 2013 å¹´å¼€æºå‡ºçš„ Dockerï¼Œ2014 å¹´å¼€æºå‡ºæ¥çš„ Kubernetesï¼Œç›´åˆ°ç°åœ¨çš„äº‘åŸç”Ÿç”Ÿæ€çš„ç«çƒ­ã€‚ å®¹å™¨æŠ€æœ¯å·²ç»é€æ­¥æˆä¸ºä¸»æµçš„åŸºç¡€æŠ€æœ¯ä¹‹ä¸€ã€‚&lt;/p>
&lt;p>åœ¨è¶Šæ¥è¶Šå¤šçš„å…¬å¸ã€ä¸ªäººé€‰æ‹©äº†äº‘æœåŠ¡/å®¹å™¨æŠ€æœ¯åï¼Œèµ„æºçš„åˆ†é…å’Œéš”ç¦»ï¼Œä»¥åŠå®‰å…¨æ€§å˜æˆäº†äººä»¬å…³æ³¨åŠè®¨è®ºçš„çƒ­ç‚¹è¯é¢˜ã€‚&lt;/p>
&lt;p>&lt;strong>å…¶å®å®¹å™¨æŠ€æœ¯ä½¿ç”¨èµ·æ¥å¹¶ä¸éš¾ï¼Œä½†è¦çœŸæ­£æŠŠå®ƒç”¨å¥½ï¼Œå¤§è§„æ¨¡çš„åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ï¼Œ é‚£æˆ‘ä»¬è¿˜æ˜¯éœ€è¦æŒæ¡å…¶æ ¸å¿ƒçš„ã€‚&lt;/strong>&lt;/p>
&lt;p>ä»¥ä¸‹æ˜¯å®¹å™¨æŠ€æœ¯&amp;amp;äº‘åŸç”Ÿç”Ÿæ€çš„å¤§è‡´å‘å±•å†ç¨‹ï¼š&lt;/p>
&lt;p>&lt;img src="https://i.loli.net/2021/11/18/tnwBPg6JofNKh5F.png" alt="img">&lt;/p>
&lt;p>&lt;strong>å›¾ 1 ï¼Œå®¹å™¨æŠ€æœ¯å‘å±•å†ç¨‹&lt;/strong>&lt;/p>
&lt;p>ä»å›¾ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®¹å™¨æŠ€æœ¯ã€äº‘åŸç”Ÿç”Ÿæ€çš„å‘å±•è½¨è¿¹ã€‚å®¹å™¨æŠ€æœ¯å…¶å®å¾ˆæ—©å°±å‡ºç°äº†ï¼Œä½†ä¸ºä½•åœ¨ Docker å‡ºç°åæ‰å¼€å§‹æœ‰äº†è¾ƒä¸ºæ˜¾è‘—çš„å‘å±•ï¼Ÿæ—©æœŸçš„ chroot ã€ Linux VServer åˆæœ‰å“ªäº›é—®é¢˜å‘¢ï¼Ÿ&lt;/p>
&lt;h3 id="chroot-å¸¦æ¥çš„å®‰å…¨æ€§é—®é¢˜">Chroot å¸¦æ¥çš„å®‰å…¨æ€§é—®é¢˜&lt;/h3>
&lt;p>&lt;img src="https://i.loli.net/2021/11/18/7CfsBmyolDGPJZL.png" alt="img">&lt;/p>
&lt;p>&lt;strong>å›¾ 2 ï¼Œchroot ç¤ºä¾‹&lt;/strong>&lt;/p>
&lt;p>Chroot å¯ä»¥å°†è¿›ç¨‹åŠå…¶å­è¿›ç¨‹ä¸æ“ä½œç³»ç»Ÿçš„å…¶ä½™éƒ¨åˆ†éš”ç¦»å¼€æ¥ã€‚ä½†æ˜¯ï¼Œ&lt;strong>å¯¹äº root process&lt;/strong> ï¼Œå´&lt;strong>å¯ä»¥ä»»æ„é€€å‡º chroot&lt;/strong>ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="kn">package&lt;/span> &lt;span class="nx">main&lt;/span>
&lt;span class="kn">import&lt;/span> &lt;span class="p">(&lt;/span>
&lt;span class="s">&amp;#34;log&amp;#34;&lt;/span>
&lt;span class="s">&amp;#34;os&amp;#34;&lt;/span>
&lt;span class="s">&amp;#34;syscall&amp;#34;&lt;/span>
&lt;span class="p">)&lt;/span>
&lt;span class="kd">func&lt;/span> &lt;span class="nf">getWd&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">path&lt;/span> &lt;span class="kt">string&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">path&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">os&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Getwd&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">err&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="nx">log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">path&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">return&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="kd">func&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">RealRoot&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">os&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Open&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;/&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">defer&lt;/span> &lt;span class="nx">RealRoot&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Close&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Fatalf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;[ Error ] - /: %v\n&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="nx">path&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nf">getWd&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="nx">err&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">syscall&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Chroot&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">path&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Fatalf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;[ Error ] - chroot: %v\n&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="nf">getWd&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="nx">err&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">RealRoot&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Chdir&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Fatalf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;[ Error ] - chdir(): %v&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="nf">getWd&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="nx">err&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">syscall&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Chroot&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;.&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Fatalf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;[ Error ] - chroot back: %v&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="nf">getWd&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>åˆ†åˆ«ä»¥æ™®é€šç”¨æˆ·å’Œ sudo çš„æ–¹å¼è¿è¡Œï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">âœ chroot go run main.go
2021/11/18 00:46:21 /tmp/chroot
2021/11/18 00:46:21 &lt;span class="o">[&lt;/span> Error &lt;span class="o">]&lt;/span> - chroot: operation not permitted
&lt;span class="nb">exit&lt;/span> status &lt;span class="m">1&lt;/span>
âœ chroot sudo go run main.go
2021/11/18 00:46:25 /tmp/chroot
2021/11/18 00:46:25 /
2021/11/18 00:46:25 &lt;span class="o">(&lt;/span>unreachable&lt;span class="o">)&lt;/span>/
2021/11/18 00:46:25 /
&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¯ä»¥çœ‹åˆ°å¦‚æœæ˜¯ä½¿ç”¨ &lt;code>sudo&lt;/code>æ¥è¿è¡Œçš„æ—¶å€™ï¼Œç¨‹åºåœ¨å½“å‰ç›®å½•å’Œç³»ç»ŸåŸæœ¬çš„æ ¹ç›®å½•ä¸‹è¿›è¡Œäº†åˆ‡æ¢ã€‚è€Œæ™®é€šç”¨æˆ·åˆ™æ— æƒé™æ“ä½œã€‚&lt;/p>
&lt;h3 id="linux-vserver-çš„å®‰å…¨æ¼æ´">Linux VServer çš„å®‰å…¨æ¼æ´&lt;/h3>
&lt;p>Linux-VServer æ˜¯ä¸€ç§åŸºäº &lt;em>Security Contexts&lt;/em> çš„è½¯åˆ†åŒºæŠ€æœ¯ï¼Œå¯ä»¥åšåˆ°è™šæ‹ŸæœåŠ¡å™¨éš”ç¦»ï¼Œå…±äº«ç›¸åŒçš„ç¡¬ä»¶èµ„æºã€‚ä¸»è¦é—®é¢˜æ˜¯ VServer åº”ç”¨ç¨‹åºé’ˆå¯¹ &amp;quot;chroot-again&amp;quot; ç±»å‹çš„æ”»å‡»æ²¡æœ‰å¾ˆå¥½çš„è¿›è¡Œå®‰å…¨ä¿æŠ¤ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ¼æ´è„±ç¦»é™åˆ¶ç¯å¢ƒï¼Œè®¿é—®é™åˆ¶ç›®å½•ä¹‹å¤–çš„ä»»æ„æ–‡ä»¶ã€‚ï¼ˆè‡ª 2004å¹´å¼€å§‹ï¼Œå›½å®¶ä¿¡æ¯å®‰å…¨æ¼æ´åº“å°±ç™»å‡ºäº†ç›¸å…³æ¼æ´é—®é¢˜ï¼‰&lt;/p>
&lt;h3 id="ç°ä»£åŒ–å®¹å™¨æŠ€æœ¯å¸¦æ¥çš„ä¼˜åŠ¿">ç°ä»£åŒ–å®¹å™¨æŠ€æœ¯å¸¦æ¥çš„ä¼˜åŠ¿&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>è½»é‡çº§ï¼ŒåŸºäº Linux å†…æ ¸æ‰€æä¾›çš„ cgroup å’Œ namespace èƒ½åŠ›ï¼Œåˆ›å»ºå®¹å™¨çš„æˆæœ¬å¾ˆä½ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä¸€å®šçš„éš”ç¦»æ€§ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æ ‡å‡†åŒ–ï¼Œé€šè¿‡ä½¿ç”¨å®¹å™¨é•œåƒçš„æ–¹å¼è¿›è¡Œåº”ç”¨ç¨‹åºçš„æ‰“åŒ…å’Œåˆ†å‘ï¼Œå¯ä»¥å±è”½æ‰å› ä¸ºç¯å¢ƒä¸ä¸€è‡´å¸¦æ¥çš„è¯¸å¤šé—®é¢˜ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>DevOps æ”¯æ’‘ï¼ˆå¯ä»¥åœ¨ä¸åŒç¯å¢ƒï¼Œå¦‚å¼€å‘ã€æµ‹è¯•å’Œç”Ÿäº§ç­‰ç¯å¢ƒä¹‹é—´è½»æ¾è¿ç§»åº”ç”¨ï¼ŒåŒæ—¶è¿˜å¯ä¿ç•™åº”ç”¨çš„å…¨éƒ¨åŠŸèƒ½ï¼‰ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä¸ºåŸºç¡€æ¶æ„å¢æ·»é˜²æŠ¤ï¼Œæå‡å¯é æ€§ã€å¯æ‰©å±•æ€§å’Œä¿¡èµ–åº¦ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>DevOps/GitOps æ”¯æ’‘ ï¼ˆå¯ä»¥åšåˆ°å¿«é€Ÿæœ‰æ•ˆåœ°æŒç»­æ€§å‘å¸ƒï¼Œç®¡ç†ç‰ˆæœ¬åŠé…ç½®ï¼‰ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å›¢é˜Ÿæˆå‘˜é—´å¯ä»¥æœ‰æ•ˆç®€åŒ–ã€åŠ é€Ÿå’Œç¼–æ’åº”ç”¨çš„å¼€å‘ä¸éƒ¨ç½²ï¼›&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>åœ¨äº†è§£äº†ä¸ºä»€ä¹ˆè¦å…³æ³¨ cgroup å’Œ namespace ç­‰æŠ€æœ¯ä¹‹åï¼Œé‚£æˆ‘ä»¬å°±è¿›å…¥åˆ°æœ¬ç¯‡çš„é‡ç‚¹å§ï¼Œæ¥ä¸€èµ·å­¦ä¹ ä¸‹ cgroup ã€‚&lt;/p>
&lt;h2 id="ä»€ä¹ˆæ˜¯-cgroup">ä»€ä¹ˆæ˜¯ cgroup&lt;/h2>
&lt;p>cgroup æ˜¯ Linux å†…æ ¸çš„ä¸€ä¸ªåŠŸèƒ½ï¼Œç”¨æ¥é™åˆ¶ã€æ§åˆ¶ä¸åˆ†ç¦»ä¸€ä¸ªè¿›ç¨‹ç»„çš„èµ„æºï¼ˆå¦‚CPUã€å†…å­˜ã€ç£ç›˜è¾“å…¥è¾“å‡ºç­‰ï¼‰ã€‚å®ƒæ˜¯ç”± Google çš„ä¸¤ä½å·¥ç¨‹å¸ˆè¿›è¡Œå¼€å‘çš„ï¼Œè‡ª 2018 å¹´ 1 æœˆæ­£å¼å‘å¸ƒçš„ Linux å†…æ ¸ v2.6.24 å¼€å§‹æä¾›æ­¤èƒ½åŠ›ã€‚&lt;/p>
&lt;p>cgroup åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæœ‰ä¸¤ä¸ªå¤§ç‰ˆæœ¬ï¼Œ cgroup v1 å’Œ v2 ã€‚ä»¥ä¸‹å†…å®¹ä»¥ cgroup v2 ç‰ˆæœ¬ä¸ºä¸»ï¼Œæ¶‰åŠä¸¤ä¸ªç‰ˆæœ¬å·®åˆ«çš„åœ°æ–¹ä¼šåœ¨ä¸‹æ–‡è¯¦ç»†ä»‹ç»ã€‚&lt;/p>
&lt;p>cgroup ä¸»è¦é™åˆ¶çš„èµ„æºæ˜¯ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>CPU&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å†…å­˜&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ç½‘ç»œ&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ç£ç›˜ I/O&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>å½“æˆ‘ä»¬å°†å¯ç”¨ç³»ç»Ÿèµ„æºæŒ‰ç‰¹å®šç™¾åˆ†æ¯”åˆ†é…ç»™ cgroup æ—¶ï¼Œå‰©ä½™çš„èµ„æºå¯ä¾›ç³»ç»Ÿä¸Šçš„å…¶ä»– cgroup æˆ–å…¶ä»–è¿›ç¨‹ä½¿ç”¨ã€‚&lt;/p>
&lt;p>&lt;img src="https://i.loli.net/2021/11/18/1KqfLoNisJkQgtd.png" alt="img">&lt;/p>
&lt;p>&lt;strong>å›¾ 4 ï¼Œcgroup èµ„æºåˆ†é…åŠå‰©ä½™å¯ç”¨èµ„æºç¤ºä¾‹&lt;/strong>&lt;/p>
&lt;h3 id="cgroup-çš„ç»„æˆ">cgroup çš„ç»„æˆ&lt;/h3>
&lt;p>cgroup ä»£è¡¨â€œæ§åˆ¶ç»„â€ï¼Œå¹¶ä¸”ä¸ä¼šä½¿ç”¨å¤§å†™ã€‚cgroup æ˜¯ä¸€ç§åˆ†å±‚ç»„ç»‡è¿›ç¨‹çš„æœºåˆ¶ï¼Œ æ²¿å±‚æ¬¡ç»“æ„ä»¥å—æ§çš„æ–¹å¼åˆ†é…ç³»ç»Ÿèµ„æºã€‚æˆ‘ä»¬é€šå¸¸ä½¿ç”¨å•æ•°å½¢å¼ç”¨äºæŒ‡å®šæ•´ä¸ªç‰¹å¾ï¼Œä¹Ÿç”¨ä½œé™å®šç¬¦å¦‚ â€œcgroup controllerâ€ ã€‚&lt;/p>
&lt;p>cgroup ä¸»è¦æœ‰ä¸¤ä¸ªç»„æˆéƒ¨åˆ†ï¼š&lt;/p>
&lt;ul>
&lt;li>core - è´Ÿè´£åˆ†å±‚ç»„ç»‡è¿‡ç¨‹ï¼›&lt;/li>
&lt;li>controller - é€šå¸¸è´Ÿè´£æ²¿å±‚æ¬¡ç»“æ„åˆ†é…ç‰¹å®šç±»å‹çš„ç³»ç»Ÿèµ„æºã€‚æ¯ä¸ª cgroup éƒ½æœ‰ä¸€ä¸ª &lt;code>cgroup.controllers&lt;/code> æ–‡ä»¶ï¼Œå…¶ä¸­åˆ—å‡ºäº†æ‰€æœ‰å¯ä¾› cgroup å¯ç”¨çš„æ§åˆ¶å™¨ã€‚å½“åœ¨ &lt;code>cgroup.subtree_control&lt;/code> ä¸­æŒ‡å®šå¤šä¸ªæ§åˆ¶å™¨æ—¶ï¼Œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ã€‚åœ¨åŒä¸€ä¸ªæ§åˆ¶å™¨ä¸ŠæŒ‡å®šå¤šé¡¹æ“ä½œï¼Œé‚£ä¹ˆåªæœ‰æœ€åä¸€ä¸ªç”Ÿæ•ˆã€‚æ¯ä¸ª cgroup çš„æ§åˆ¶å™¨é”€æ¯æ˜¯å¼‚æ­¥çš„ï¼Œåœ¨å¼•ç”¨æ—¶åŒæ ·ä¹Ÿæœ‰ç€å»¶è¿Ÿå¼•ç”¨çš„é—®é¢˜ï¼›&lt;/li>
&lt;/ul>
&lt;p>æ‰€æœ‰ cgroup æ ¸å¿ƒæ¥å£æ–‡ä»¶éƒ½ä»¥ &lt;code>cgroup&lt;/code> ä¸ºå‰ç¼€ã€‚æ¯ä¸ªæ§åˆ¶å™¨çš„æ¥å£æ–‡ä»¶éƒ½ä»¥æ§åˆ¶å™¨åç§°å’Œä¸€ä¸ªç‚¹ä¸ºå‰ç¼€ã€‚æ§åˆ¶å™¨çš„åç§°ç”±å°å†™å­—æ¯å’Œâ€œ&lt;em>â€ç»„æˆï¼Œä½†æ°¸è¿œä¸ä¼šä»¥â€œ&lt;/em>â€å¼€å¤´ã€‚&lt;/p>
&lt;h3 id="cgroup-çš„æ ¸å¿ƒæ–‡ä»¶">cgroup çš„æ ¸å¿ƒæ–‡ä»¶&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>cgroup.type - ï¼ˆå•å€¼ï¼‰å­˜åœ¨äºéæ ¹ cgroup ä¸Šçš„å¯è¯»å†™æ–‡ä»¶ã€‚é€šè¿‡å°†â€œthreadedâ€å†™å…¥è¯¥æ–‡ä»¶ï¼Œå¯ä»¥å°† cgroup è½¬æ¢ä¸ºçº¿ç¨‹ cgroupï¼Œå¯é€‰æ‹© 4 ç§å–å€¼ï¼Œå¦‚ä¸‹ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;ol>
&lt;li>domain - ä¸€ä¸ªæ­£å¸¸çš„æœ‰æ•ˆåŸŸ cgroup&lt;/li>
&lt;/ol>
&lt;/li>
&lt;li>
&lt;ol start="2">
&lt;li>domain threaded - çº¿ç¨‹å­æ ‘æ ¹çš„çº¿ç¨‹åŸŸ cgroup&lt;/li>
&lt;/ol>
&lt;/li>
&lt;li>
&lt;ol start="3">
&lt;li>domain invalid - æ— æ•ˆçš„ cgroup&lt;/li>
&lt;/ol>
&lt;/li>
&lt;li>
&lt;ol start="4">
&lt;li>threaded - çº¿ç¨‹ cgroupï¼Œçº¿ç¨‹å­æ ‘&lt;/li>
&lt;/ol>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>cgroup.procs - ï¼ˆæ¢è¡Œåˆ†éš”ï¼‰æ‰€æœ‰ cgroup éƒ½æœ‰çš„å¯è¯»å†™æ–‡ä»¶ã€‚æ¯è¡Œåˆ—å‡ºå±äº cgroup çš„è¿›ç¨‹çš„ PIDã€‚PID ä¸æ˜¯æœ‰åºçš„ï¼Œå¦‚æœè¿›ç¨‹ç§»åŠ¨åˆ°å¦ä¸€ä¸ª cgroup ï¼Œç›¸åŒçš„ PID å¯èƒ½ä¼šå‡ºç°ä¸æ­¢ä¸€æ¬¡ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>cgroup.controllers - ï¼ˆç©ºæ ¼åˆ†éš”ï¼‰æ‰€æœ‰ cgroup éƒ½æœ‰çš„åªè¯»æ–‡ä»¶ã€‚æ˜¾ç¤º cgroup å¯ç”¨çš„æ‰€æœ‰æ§åˆ¶å™¨ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>cgroup.subtree_control - ï¼ˆç©ºæ ¼åˆ†éš”ï¼‰æ‰€æœ‰ cgroup éƒ½æœ‰çš„å¯è¯»å†™æ–‡ä»¶ï¼Œåˆå§‹ä¸ºç©ºã€‚å¦‚æœä¸€ä¸ªæ§åˆ¶å™¨åœ¨åˆ—è¡¨ä¸­å‡ºç°ä¸æ­¢ä¸€æ¬¡ï¼Œæœ€åä¸€ä¸ªæœ‰æ•ˆã€‚å½“æŒ‡å®šå¤šä¸ªå¯ç”¨å’Œç¦ç”¨æ“ä½œæ—¶ï¼Œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;ol>
&lt;li>ä»¥â€œ+â€ä¸ºå‰ç¼€çš„æ§åˆ¶å™¨åç§°è¡¨ç¤ºå¯ç”¨æ§åˆ¶å™¨&lt;/li>
&lt;/ol>
&lt;/li>
&lt;li>
&lt;ol start="2">
&lt;li>ä»¥â€œ-â€ä¸ºå‰ç¼€çš„æ§åˆ¶å™¨åç§°è¡¨ç¤ºç¦ç”¨æ§åˆ¶å™¨&lt;/li>
&lt;/ol>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>cgroup.events - å­˜åœ¨äºéæ ¹ cgroup ä¸Šçš„åªè¯»æ–‡ä»¶ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;ol>
&lt;li>populated - cgroup åŠå…¶å­èŠ‚ç‚¹ä¸­åŒ…å«æ´»åŠ¨è¿›ç¨‹ï¼Œå€¼ä¸º1ï¼›æ— æ´»åŠ¨è¿›ç¨‹ï¼Œå€¼ä¸º0.&lt;/li>
&lt;/ol>
&lt;/li>
&lt;li>
&lt;ol start="2">
&lt;li>frozen - cgroup æ˜¯å¦è¢«å†»ç»“ï¼Œå†»ç»“å€¼ä¸º1ï¼›æœªå†»ç»“å€¼ä¸º0.&lt;/li>
&lt;/ol>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>cgroup.threads - ï¼ˆæ¢è¡Œåˆ†éš”ï¼‰æ‰€æœ‰ cgroup éƒ½æœ‰çš„å¯è¯»å†™æ–‡ä»¶ã€‚æ¯è¡Œåˆ—å‡ºå±äº cgroup çš„çº¿ç¨‹çš„ TIDã€‚TID ä¸æ˜¯æœ‰åºçš„ï¼Œå¦‚æœçº¿ç¨‹ç§»åŠ¨åˆ°å¦ä¸€ä¸ª cgroup ï¼Œç›¸åŒçš„ TID å¯èƒ½ä¼šå‡ºç°ä¸æ­¢ä¸€æ¬¡ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>cgroup.max.descendants - ï¼ˆå•å€¼ï¼‰å¯è¯»å†™æ–‡ä»¶ã€‚æœ€å¤§å…è®¸çš„ cgroup æ•°é‡å­èŠ‚ç‚¹æ•°é‡ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>cgroup.max.depth - ï¼ˆå•å€¼ï¼‰å¯è¯»å†™æ–‡ä»¶ã€‚ä½äºå½“å‰èŠ‚ç‚¹æœ€å¤§å…è®¸çš„æ ‘æ·±åº¦ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>cgroup.stat - åªè¯»æ–‡ä»¶ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;ol>
&lt;li>nr_descendants - å¯è§åä»£çš„ cgroup æ•°é‡ã€‚&lt;/li>
&lt;/ol>
&lt;/li>
&lt;li>
&lt;ol start="2">
&lt;li>nr_dying_descendants - è¢«ç”¨æˆ·åˆ é™¤å³å°†è¢«ç³»ç»Ÿé”€æ¯çš„ cgroup æ•°é‡ã€‚&lt;/li>
&lt;/ol>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>cgroup.freeze - ï¼ˆå•å€¼ï¼‰å­˜åœ¨äºéæ ¹ cgroup ä¸Šçš„å¯è¯»å†™æ–‡ä»¶ã€‚é»˜è®¤å€¼ä¸º0ã€‚å½“å€¼ä¸º1æ—¶ï¼Œä¼šå†»ç»“ cgroup åŠå…¶æ‰€æœ‰å­èŠ‚ç‚¹ cgroupï¼Œä¼šå°†ç›¸å…³çš„è¿›ç¨‹å…³åœå¹¶ä¸”ä¸å†è¿è¡Œã€‚å†»ç»“ cgroup éœ€è¦ä¸€å®šçš„æ—¶é—´ï¼Œå½“åŠ¨ä½œå®Œæˆåï¼Œ cgroup.events æ§åˆ¶æ–‡ä»¶ä¸­çš„ â€œfrozenâ€ å€¼ä¼šæ›´æ–°ä¸ºâ€œ1â€ï¼Œå¹¶å‘å‡ºç›¸åº”çš„é€šçŸ¥ã€‚cgroup çš„å†»ç»“çŠ¶æ€ä¸ä¼šå½±å“ä»»ä½• cgroup æ ‘æ“ä½œï¼ˆåˆ é™¤ã€åˆ›å»ºç­‰ï¼‰ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>cgroup.kill - ï¼ˆå•å€¼ï¼‰å­˜åœ¨äºéæ ¹ cgroup ä¸Šçš„å¯è¯»å†™æ–‡ä»¶ã€‚å”¯ä¸€å…è®¸å€¼ä¸º1ï¼Œå½“å€¼ä¸º1æ—¶ï¼Œä¼šå°† cgroup åŠå…¶æ‰€æœ‰å­èŠ‚ç‚¹ä¸­çš„ cgroup æ€æ­»ï¼ˆè¿›ç¨‹ä¼šè¢« SIGKILL æ€æ‰ï¼‰ã€‚ä¸€èˆ¬ç”¨äºå°†ä¸€ä¸ª cgroup æ ‘æ€æ‰ï¼Œé˜²æ­¢å¶å­èŠ‚ç‚¹è¿ç§»ï¼›&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="cgroup-çš„å½’å±å’Œè¿ç§»">cgroup çš„å½’å±å’Œè¿ç§»&lt;/h3>
&lt;p>ç³»ç»Ÿä¸­çš„æ¯ä¸ªè¿›ç¨‹éƒ½å±äºä¸€ä¸ª cgroupï¼Œä¸€ä¸ªè¿›ç¨‹çš„æ‰€æœ‰çº¿ç¨‹éƒ½å±äºåŒä¸€ä¸ª cgroupã€‚ä¸€ä¸ªè¿›ç¨‹å¯ä»¥ä»ä¸€ä¸ª cgroup è¿ç§»åˆ°å¦ä¸€ä¸ª cgroup ã€‚è¿›ç¨‹çš„è¿ç§»ä¸ä¼šå½±å“ç°æœ‰çš„åä»£è¿›ç¨‹æ‰€å±çš„ cgroupã€‚&lt;/p>
&lt;p>&lt;img src="https://i.loli.net/2021/11/18/wHkb1QLV6KjMd3B.png" alt="img">&lt;/p>
&lt;p>&lt;strong>å›¾ 5 ï¼Œè¿›ç¨‹åŠå…¶å­è¿›ç¨‹çš„ cgroup åˆ†é…ï¼›è·¨ cgroup è¿ç§»ç¤ºä¾‹&lt;/strong>&lt;/p>
&lt;p>è·¨ cgroup è¿ç§»è¿›ç¨‹æ˜¯ä¸€é¡¹ä»£ä»·æ˜‚è´µçš„æ“ä½œå¹¶ä¸”æœ‰çŠ¶æ€çš„èµ„æºé™åˆ¶ï¼ˆä¾‹å¦‚ï¼Œå†…å­˜ï¼‰ä¸ä¼šåŠ¨æ€çš„åº”ç”¨äºè¿ç§»ã€‚å› æ­¤ï¼Œç»å¸¸è·¨ cgroup è¿ç§»è¿›ç¨‹åªæ˜¯ä½œä¸ºä¸€ç§æ‰‹æ®µã€‚ä¸é¼“åŠ±ç›´æ¥åº”ç”¨ä¸åŒçš„èµ„æºé™åˆ¶ã€‚&lt;/p>
&lt;h4 id="å¦‚ä½•å®ç°è·¨-cgroup-è¿ç§»">å¦‚ä½•å®ç°è·¨ cgroup è¿ç§»&lt;/h4>
&lt;p>æ¯ä¸ªcgroupéƒ½æœ‰ä¸€ä¸ªå¯è¯»å†™çš„æ¥å£æ–‡ä»¶ â€œcgroup.procsâ€ ã€‚æ¯è¡Œä¸€ä¸ª PID è®°å½• cgroup é™åˆ¶ç®¡ç†çš„æ‰€æœ‰è¿›ç¨‹ã€‚ä¸€ä¸ªè¿›ç¨‹å¯ä»¥é€šè¿‡å°†å…¶ PID å†™å…¥å¦ä¸€ cgroup çš„ â€œcgroup.procsâ€ æ–‡ä»¶æ¥å®ç°è¿ç§»ã€‚&lt;/p>
&lt;p>ä½†æ˜¯è¿™ç§æ–¹å¼ï¼Œåªèƒ½è¿ç§»ä¸€ä¸ªè¿›ç¨‹åœ¨å•ä¸ª write(2) ä¸Šçš„è°ƒç”¨ï¼ˆå¦‚æœä¸€ä¸ªè¿›ç¨‹æœ‰å¤šä¸ªçº¿ç¨‹ï¼Œåˆ™ä¼šåŒæ—¶è¿ç§»æ‰€æœ‰çº¿ç¨‹ï¼Œä½†ä¹Ÿè¦å‚è€ƒçº¿ç¨‹å­æ ‘ï¼Œæ˜¯å¦æœ‰å°†è¿›ç¨‹çš„çº¿ç¨‹æ”¾å…¥ä¸åŒçš„ cgroup çš„è®°å½•ï¼‰ã€‚&lt;/p>
&lt;p>å½“ä¸€ä¸ªè¿›ç¨‹ fork å‡ºä¸€ä¸ªå­è¿›ç¨‹æ—¶ï¼Œè¯¥è¿›ç¨‹å°±è¯ç”Ÿåœ¨å…¶çˆ¶äº²è¿›ç¨‹æ‰€å±çš„ cgroup ä¸­ã€‚&lt;/p>
&lt;p>ä¸€ä¸ªæ²¡æœ‰ä»»ä½•å­è¿›ç¨‹æˆ–æ´»åŠ¨è¿›ç¨‹çš„ cgroup æ˜¯å¯ä»¥é€šè¿‡åˆ é™¤ç›®å½•è¿›è¡Œé”€æ¯çš„ï¼ˆå³ä½¿å­˜åœ¨å…³è”çš„åƒµå°¸è¿›ç¨‹ï¼Œä¹Ÿè¢«è®¤ä¸ºæ˜¯å¯ä»¥è¢«åˆ é™¤çš„ï¼‰ã€‚&lt;/p>
&lt;h2 id="ä»€ä¹ˆæ˜¯-cgroups">ä»€ä¹ˆæ˜¯ cgroups&lt;/h2>
&lt;p>å½“æ˜ç¡®æåˆ°å¤šä¸ªå•ç‹¬çš„æ§åˆ¶ç»„æ—¶ï¼Œæ‰ä½¿ç”¨å¤æ•°å½¢å¼ â€œcgroupsâ€ ã€‚&lt;/p>
&lt;p>cgroups å½¢æˆäº†æ ‘çŠ¶ç»“æ„ã€‚ï¼ˆä¸€ä¸ªç»™å®šçš„ cgroup å¯èƒ½æœ‰å¤šä¸ªå­ cgroup å½¢æˆä¸€æ£µæ ‘ç»“æ„ä½“ï¼‰æ¯ä¸ªéæ ¹ cgroup éƒ½æœ‰ä¸€ä¸ª &lt;code>cgroup.events&lt;/code> æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å« &lt;code>populated&lt;/code> å­—æ®µæŒ‡ç¤º cgroup çš„å­å±‚æ¬¡ç»“æ„æ˜¯å¦å…·æœ‰å®æ—¶è¿›ç¨‹ã€‚æ‰€æœ‰éæ ¹çš„ &lt;code>cgroup.subtree_control&lt;/code> æ–‡ä»¶ï¼Œåªèƒ½åŒ…å«åœ¨çˆ¶çº§ä¸­å¯ç”¨çš„æ§åˆ¶å™¨ã€‚&lt;/p>
&lt;p>&lt;img src="https://i.loli.net/2021/11/18/YfPRAelm92GnSEq.png" alt="img">&lt;/p>
&lt;p>&lt;strong>å›¾ 6 ï¼Œcgroups ç¤ºä¾‹&lt;/strong>&lt;/p>
&lt;p>å¦‚å›¾æ‰€ç¤ºï¼Œcgroup1 ä¸­é™åˆ¶äº†ä½¿ç”¨ cpu åŠ å†…å­˜èµ„æºï¼Œå®ƒå°†æ§åˆ¶å­èŠ‚ç‚¹çš„ CPU å‘¨æœŸå’Œå†…å­˜åˆ†é…ï¼ˆå³ï¼Œé™åˆ¶ cgroup2ã€cgroup3ã€cgroup4 ä¸­çš„cpuåŠå†…å­˜èµ„æºåˆ†é…ï¼‰ã€‚cgroup2 ä¸­å¯ç”¨äº†å†…å­˜é™åˆ¶ï¼Œä½†æ˜¯æ²¡æœ‰å¯ç”¨cpuçš„èµ„æºé™åˆ¶ï¼Œè¿™å°±å¯¼è‡´äº† cgroup3 å’Œ cgroup4 çš„å†…å­˜èµ„æºå— cgroup2ä¸­çš„ mem è®¾ç½®å†…å®¹çš„é™åˆ¶ï¼›cgroup3 å’Œ cgroup4 ä¼šè‡ªç”±ç«äº‰åœ¨ cgroup1 çš„ cpu èµ„æºé™åˆ¶èŒƒå›´å†…çš„ cpu èµ„æºã€‚&lt;/p>
&lt;p>ç”±æ­¤ï¼Œä¹Ÿå¯ä»¥æ˜æ˜¾çš„çœ‹å‡º cgroup èµ„æºæ˜¯è‡ªä¸Šè€Œä¸‹åˆ†å¸ƒçº¦æŸçš„ã€‚åªæœ‰å½“èµ„æºå·²ç»ä»ä¸Šæ¸¸ cgroup èŠ‚ç‚¹åˆ†å‘ç»™ä¸‹æ¸¸æ—¶ï¼Œä¸‹æ¸¸çš„ cgroup æ‰èƒ½è¿›ä¸€æ­¥åˆ†å‘çº¦æŸèµ„æºã€‚æ‰€æœ‰éæ ¹çš„ &lt;code>cgroup.subtree_control&lt;/code> æ–‡ä»¶åªèƒ½åŒ…å«åœ¨çˆ¶èŠ‚ç‚¹çš„ &lt;code>cgroup.subtree_control&lt;/code> æ–‡ä»¶ä¸­å¯ç”¨çš„æ§åˆ¶å™¨å†…å®¹ã€‚&lt;/p>
&lt;p>é‚£ä¹ˆï¼Œ&lt;strong>å­èŠ‚ç‚¹ cgroup ä¸çˆ¶èŠ‚ç‚¹ cgroup æ˜¯å¦ä¼šå­˜åœ¨å†…éƒ¨è¿›ç¨‹ç«äº‰çš„æƒ…å†µå‘¢&lt;/strong>ï¼Ÿ&lt;/p>
&lt;p>å½“ç„¶ä¸ä¼šã€‚cgroup v2 ä¸­ï¼Œè®¾å®šäº†éæ ¹ cgroup åªèƒ½åœ¨æ²¡æœ‰ä»»ä½•è¿›ç¨‹æ—¶æ‰èƒ½å°†åŸŸèµ„æºåˆ†å‘ç»™å­èŠ‚ç‚¹çš„ cgroupã€‚ç®€è€Œè¨€ä¹‹ï¼Œåªæœ‰ä¸åŒ…å«ä»»ä½•è¿›ç¨‹çš„ cgroup æ‰èƒ½åœ¨å…¶ &lt;code>cgroup.subtree_control&lt;/code> æ–‡ä»¶ä¸­å¯ç”¨åŸŸæ§åˆ¶å™¨ï¼Œè¿™å°±ä¿è¯äº†ï¼Œè¿›ç¨‹æ€»åœ¨å¶å­èŠ‚ç‚¹ä¸Šã€‚&lt;/p>
&lt;h3 id="æŒ‚è½½å’Œå§”æ´¾">æŒ‚è½½å’Œå§”æ´¾&lt;/h3>
&lt;h4 id="cgroup-çš„æŒ‚è½½æ–¹å¼">cgroup çš„æŒ‚è½½æ–¹å¼&lt;/h4>
&lt;ul>
&lt;li>
&lt;p>memory_recursiveprot - é€’å½’åœ°å°† memory.min å’Œ memory.low ä¿æŠ¤åº”ç”¨äºæ•´ä¸ªå­æ ‘ï¼Œæ— éœ€æ˜¾å¼å‘ä¸‹ä¼ æ’­åˆ°å¶èŠ‚ç‚¹çš„ cgroup ä¸­ï¼Œå­æ ‘å†…å¶å­èŠ‚ç‚¹å¯ä»¥è‡ªç”±ç«äº‰ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>memory_localevents - åªèƒ½æŒ‚è½½æ—¶è®¾ç½®æˆ–è€…é€šè¿‡ä» init å‘½åç©ºé—´é‡æ–°æŒ‚è½½æ¥ä¿®æ”¹ï¼Œè¿™æ˜¯ç³»ç»ŸèŒƒå›´çš„é€‰é¡¹ã€‚åªç”¨å½“å‰ cgroup çš„æ•°æ®å¡«å…… memory.eventsï¼Œå¦‚æœæ²¡æœ‰è¿™ä¸ªé€‰é¡¹ï¼Œé»˜è®¤ä¼šè®¡æ•°æ‰€æœ‰å­æ ‘ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>nsdelegate - åªèƒ½æŒ‚è½½æ—¶è®¾ç½®æˆ–è€…é€šè¿‡ä» init å‘½åç©ºé—´é‡æ–°æŒ‚è½½æ¥ä¿®æ”¹ï¼Œè¿™ä¹Ÿæ˜¯ç³»ç»ŸèŒƒå›´çš„é€‰é¡¹ã€‚å®ƒå°† cgroup å‘½åç©ºé—´è§†ä¸ºå§”æ‰˜è¾¹ç•Œï¼Œè¿™æ˜¯ä¸¤ç§å§”æ´¾ cgroup çš„æ–¹å¼ä¹‹ä¸€ï¼›&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h4 id="cgroup-çš„å§”æ´¾æ–¹å¼">cgroup çš„å§”æ´¾æ–¹å¼&lt;/h4>
&lt;ul>
&lt;li>è®¾ç½®æŒ‚è½½é€‰é¡¹ nsdelegate ï¼›&lt;/li>
&lt;li>æˆæƒç”¨æˆ·å¯¹ç›®å½•åŠå…¶ &lt;code>cgroup.procs&lt;/code>ã€&lt;code>cgroup.threads&lt;/code> å’Œ &lt;code>cgroup.subtree_control&lt;/code> æ–‡ä»¶çš„å†™è®¿é—®æƒé™&lt;/li>
&lt;/ul>
&lt;p>ä¸¤ç§æ–¹å¼çš„ç»“æœç›¸åŒã€‚ä¸€æ—¦è¢«å§”æ´¾ï¼Œç”¨æˆ·å°±å¯ä»¥åœ¨ç›®å½•ä¸‹å»ºç«‹å­å±‚æ¬¡ç»“æ„ï¼Œæ‰€æœ‰çš„èµ„æºåˆ†é…éƒ½å—çˆ¶èŠ‚ç‚¹çš„åˆ¶çº¦ã€‚ç›®å‰ï¼Œcgroup å¯¹å§”æ‰˜å­å±‚æ¬¡ç»“æ„ä¸­çš„ cgroup æ•°é‡æˆ–åµŒå¥—æ·±åº¦æ²¡æœ‰ä»»ä½•é™åˆ¶ï¼ˆä¹‹åå¯èƒ½ä¼šå—åˆ°æ˜ç¡®é™åˆ¶ï¼‰ã€‚&lt;/p>
&lt;p>å‰é¢æåˆ°äº†è·¨ cgroup è¿ç§»ï¼Œä»å§”æ´¾ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆæ˜ç¡®çš„å¾—çŸ¥è·¨ cgroup è¿ç§»å¯¹äºæ™®é€šç”¨æˆ·æ¥è®²ï¼Œæ˜¯æœ‰é™åˆ¶æ¡ä»¶çš„ã€‚å³ï¼Œæ˜¯å¦å¯¹ç›®å‰ cgroup çš„ â€œcgroup.procsâ€ æ–‡ä»¶å…·æœ‰å†™è®¿é—®æƒé™ä»¥åŠæ˜¯å¦å¯¹æº cgroup å’Œç›®æ ‡ cgroup çš„å…±åŒç¥–å…ˆçš„ â€œcgroup.procsâ€ æ–‡ä»¶å…·æœ‰å†™è®¿é—®æƒé™ã€‚&lt;/p>
&lt;h4 id="å§”æ´¾å’Œè¿ç§»">å§”æ´¾å’Œè¿ç§»&lt;/h4>
&lt;p>&lt;img src="https://i.loli.net/2021/11/18/JCmExjwOUcTBvrL.png" alt="img">&lt;/p>
&lt;p>&lt;strong>å›¾ 7 ï¼Œå§”æ´¾æƒé™ç¤ºä¾‹&lt;/strong>&lt;/p>
&lt;p>å¦‚å›¾ï¼Œæ™®é€šç”¨æˆ· User0 å…·æœ‰ cgroup[1-5] çš„å§”æ´¾æƒé™ã€‚&lt;/p>
&lt;p>ä¸ºä»€ä¹ˆ User0 æƒ³å°†è¿›ç¨‹ ä» cgroup3 è¿ç§»è‡³ cgroup5ä¼šå¤±è´¥å‘¢ï¼Ÿ&lt;/p>
&lt;p>è¿™æ˜¯ç”±äº User0 çš„æƒé™åªåˆ° cgroup1 å’Œ cgroup2 å±‚ï¼Œå¹¶ä¸å…·å¤‡ cgroup0 çš„æƒé™ã€‚è€Œå§”æ´¾ä¸­çš„æˆæƒç”¨æˆ·æ˜ç¡®æŒ‡å‡º&lt;strong>éœ€è¦å…±åŒç¥–å…ˆçš„&lt;/strong> &lt;strong>â€œcgroup.procsâ€ æ–‡ä»¶å…·æœ‰å†™è®¿é—®æƒé™ï¼&lt;/strong>ï¼ˆå³ï¼Œéœ€è¦å›¾ä¸­ cgroup0 çš„æƒé™ï¼Œæ‰å¯ä»¥å®ç°ï¼‰&lt;/p>
&lt;h3 id="èµ„æºåˆ†é…æ¨¡å‹åŠåŠŸèƒ½">èµ„æºåˆ†é…æ¨¡å‹åŠåŠŸèƒ½&lt;/h3>
&lt;p>ä»¥ä¸‹æ˜¯ cgroups çš„èµ„æºåˆ†é…æ¨¡å‹ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>æƒé‡ - (ä¾‹å¦‚ï¼Œcpu.weight) æ‰€æœ‰æƒé‡éƒ½åœ¨ [1, 10000] èŒƒå›´å†…ï¼Œé»˜è®¤å€¼ä¸º 100ã€‚æŒ‰ç…§æƒé‡æ¯”ç‡æ¥åˆ†é…èµ„æºã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>é™åˆ¶ - [0, max] èŒƒå›´å†…ï¼Œé»˜è®¤ä¸ºâ€œmaxâ€ï¼Œå³ noopï¼ˆä¾‹å¦‚ï¼Œio.maxï¼‰ã€‚é™åˆ¶å¯ä»¥è¢«è¿‡åº¦ä½¿ç”¨ï¼ˆå­èŠ‚ç‚¹é™åˆ¶çš„æ€»å’Œå¯èƒ½è¶…è¿‡çˆ¶èŠ‚ç‚¹å¯ç”¨çš„èµ„æºé‡ï¼‰ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä¿æŠ¤ - [0, max] èŒƒå›´å†…ï¼Œé»˜è®¤ä¸º 0ï¼Œå³ noopï¼ˆä¾‹å¦‚ï¼Œio.lowï¼‰ã€‚ä¿æŠ¤å¯ä»¥æ˜¯ç¡¬ä¿è¯æˆ–å°½åŠ›è€Œä¸ºçš„è½¯è¾¹ç•Œï¼Œä¿æŠ¤ä¹Ÿå¯èƒ½è¢«è¿‡åº¦ä½¿ç”¨ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>åˆ†é… - [0, max] èŒƒå›´å†…ï¼Œé»˜è®¤ä¸º 0ï¼Œå³æ²¡æœ‰èµ„æºã€‚åˆ†é…ä¸èƒ½è¢«è¿‡åº¦ä½¿ç”¨ï¼ˆå­èŠ‚ç‚¹åˆ†é…çš„æ€»å’Œä¸èƒ½è¶…è¿‡çˆ¶èŠ‚ç‚¹å¯ç”¨çš„èµ„æºé‡ï¼‰ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>cgroups æä¾›äº†å¦‚ä¸‹åŠŸèƒ½ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>èµ„æºé™åˆ¶ - ä¸Šé¢ cgroup éƒ¨åˆ†å·²ç»ç¤ºä¾‹ï¼Œcgroups å¯ä»¥ä»¥æ ‘çŠ¶ç»“æ„æ¥åµŒå¥—å¼é™åˆ¶èµ„æºã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä¼˜å…ˆçº§ - å‘ç”Ÿèµ„æºäº‰ç”¨æ—¶ï¼Œä¼˜å…ˆä¿éšœå“ªäº›è¿›ç¨‹çš„èµ„æºã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å®¡è®¡ - ç›‘æ§åŠæŠ¥å‘Šèµ„æºé™åˆ¶åŠä½¿ç”¨ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æ§åˆ¶ - æ§åˆ¶è¿›ç¨‹çš„çŠ¶æ€ï¼ˆèµ·ã€åœã€æŒ‚èµ·ï¼‰ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="cgroup-v1-ä¸-cgroup-v2">cgroup v1 ä¸ cgroup v2&lt;/h2>
&lt;h3 id="è¢«å¼ƒç”¨çš„æ ¸å¿ƒåŠŸèƒ½">è¢«å¼ƒç”¨çš„æ ¸å¿ƒåŠŸèƒ½&lt;/h3>
&lt;p>cgroup v2 å’Œ cgroup v1 æœ‰å¾ˆå¤§çš„ä¸åŒï¼Œæˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹åœ¨ cgroup v2 ä¸­å¼ƒç”¨äº†å“ªäº› cgroup v1 çš„åŠŸèƒ½ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ä¸æ”¯æŒåŒ…æ‹¬å‘½åå±‚æ¬¡åœ¨å†…çš„å¤šä¸ªå±‚æ¬¡ç»“æ„ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä¸æ”¯æŒæ‰€æœ‰ v1 å®‰è£…é€‰é¡¹ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>â€œtasksâ€ æ–‡ä»¶è¢«åˆ é™¤ï¼Œâ€œcgroup.procsâ€ æ²¡æœ‰æ’åº&lt;/p>
&lt;/li>
&lt;li>
&lt;ul>
&lt;li>åœ¨ cgroup v1 ä¸­çº¿ç¨‹ç»„ ID çš„åˆ—è¡¨ã€‚ä¸ä¿è¯æ­¤åˆ—è¡¨å·²æ’åºæˆ–æ²¡æœ‰é‡å¤çš„ TGIDï¼Œå¦‚æœéœ€è¦æ­¤å±æ€§ï¼Œç”¨æˆ·ç©ºé—´åº”æ’åº/ç»Ÿä¸€åˆ—è¡¨ã€‚å°†çº¿ç¨‹ç»„ ID å†™å…¥æ­¤æ–‡ä»¶ä¼šå°†è¯¥ç»„ä¸­çš„æ‰€æœ‰çº¿ç¨‹ç§»åŠ¨åˆ°æ­¤ cgroup ä¸­ï¼›&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;code>cgroup.clone_children&lt;/code> è¢«åˆ é™¤ã€‚clone_children ä»…å½±å“ cpuset controllerã€‚å¦‚æœåœ¨ cgroup ä¸­å¯ç”¨äº† clone_children ï¼ˆè®¾ç½®ï¼š1ï¼‰ï¼Œæ–°çš„ cpuset cgroup å°†åœ¨åˆå§‹åŒ–æœŸé—´ä»çˆ¶èŠ‚ç‚¹çš„ cgroup å¤åˆ¶é…ç½®ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>/proc/cgroups å¯¹äº v2 æ²¡æœ‰æ„ä¹‰ã€‚æ”¹ç”¨æ ¹ç›®å½•ä¸‹çš„â€œcgroup.controllersâ€æ–‡ä»¶ï¼›&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="cgroup-v1-çš„é—®é¢˜">cgroup v1 çš„é—®é¢˜&lt;/h3>
&lt;p>cgroup v2 å’Œ v1 ä¸­æœ€æ˜¾è‘—çš„ä¸åŒå°±æ˜¯ cgroup v1 å…è®¸ä»»æ„æ•°é‡çš„å±‚æ¬¡ç»“æ„, ä½†è¿™ä¼šå¸¦æ¥ä¸€äº›é—®é¢˜çš„ã€‚æˆ‘ä»¬æ¥è¯¦ç»†èŠèŠã€‚&lt;/p>
&lt;p>æŒ‚è½½ cgroup å±‚æ¬¡ç»“æ„æ—¶ï¼Œä½ å¯ä»¥æŒ‡å®šè¦æŒ‚è½½çš„å­ç³»ç»Ÿçš„é€—å·åˆ†éš”åˆ—è¡¨ä½œä¸ºæ–‡ä»¶ç³»ç»ŸæŒ‚è½½é€‰é¡¹ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒæŒ‚è½½ cgroup æ–‡ä»¶ç³»ç»Ÿä¼šå°è¯•æŒ‚è½½åŒ…å«æ‰€æœ‰å·²æ³¨å†Œå­ç³»ç»Ÿçš„å±‚æ¬¡ç»“æ„ã€‚&lt;/p>
&lt;p>å¦‚æœå·²ç»å­˜åœ¨å…·æœ‰å®Œå…¨ç›¸åŒå­ç³»ç»Ÿé›†çš„æ´»åŠ¨å±‚æ¬¡ç»“æ„ï¼Œå®ƒå°†è¢«é‡æ–°ç”¨äºæ–°å®‰è£…ã€‚&lt;/p>
&lt;p>å¦‚æœç°æœ‰å±‚æ¬¡ç»“æ„ä¸åŒ¹é…ï¼Œå¹¶ä¸”ä»»ä½•è¯·æ±‚çš„å­ç³»ç»Ÿæ­£åœ¨ç°æœ‰å±‚æ¬¡ç»“æ„ä¸­ä½¿ç”¨ï¼Œåˆ™æŒ‚è½½å°†å¤±è´¥å¹¶æ˜¾ç¤º -EBUSYã€‚å¦åˆ™ï¼Œå°†æ¿€æ´»ä¸è¯·æ±‚çš„å­ç³»ç»Ÿç›¸å…³è”çš„æ–°å±‚æ¬¡ç»“æ„ã€‚&lt;/p>
&lt;p>å½“å‰æ— æ³•å°†æ–°å­ç³»ç»Ÿç»‘å®šåˆ°æ´»åŠ¨ cgroup å±‚æ¬¡ç»“æ„ï¼Œæˆ–ä»æ´»åŠ¨ cgroup å±‚æ¬¡ç»“æ„ä¸­å–æ¶ˆç»‘å®šå­ç³»ç»Ÿã€‚å½“ cgroup æ–‡ä»¶ç³»ç»Ÿè¢«å¸è½½æ—¶ï¼Œå¦‚æœåœ¨é¡¶çº§ cgroup ä¹‹ä¸‹åˆ›å»ºäº†ä»»ä½•å­ cgroupï¼Œå³ä½¿å¸è½½ï¼Œè¯¥å±‚æ¬¡ç»“æ„ä»å°†ä¿æŒæ´»åŠ¨çŠ¶æ€ï¼›å¦‚æœæ²¡æœ‰å­ cgroupï¼Œåˆ™å±‚æ¬¡ç»“æ„å°†è¢«åœç”¨ã€‚&lt;/p>
&lt;p>è¿™å°±æ˜¯ cgroup v1 ä¸­çš„é—®é¢˜ï¼Œåœ¨ cgroup v2 ä¸­å°±å¾ˆå¥½çš„è¿›è¡Œäº†è§£å†³ã€‚&lt;/p>
&lt;h2 id="cgroup-å’Œå®¹å™¨çš„è”ç³»">cgroup å’Œå®¹å™¨çš„è”ç³»&lt;/h2>
&lt;p>è¿™é‡Œæˆ‘ä»¬ä»¥ Docker ä¸ºä¾‹ã€‚ åˆ›å»ºä¸€ä¸ªå®¹å™¨ï¼Œå¹¶å¯¹å…¶å¯ä½¿ç”¨çš„ CPU å’Œå†…å­˜è¿›è¡Œé™åˆ¶ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">âœ ~ docker run --rm -d --cpus&lt;span class="o">=&lt;/span>&lt;span class="m">2&lt;/span> --memory&lt;span class="o">=&lt;/span>2g --name&lt;span class="o">=&lt;/span>2c2g redis:alpine
e420a97835d9692df5b90b47e7951bc3fad48269eb2c8b1fa782527e0ae91c8e
âœ ~ cat /sys/fs/cgroup/system.slice/docker-&lt;span class="sb">`&lt;/span>docker ps -lq --no-trunc&lt;span class="sb">`&lt;/span>.scope/cpu.max
&lt;span class="m">200000&lt;/span> &lt;span class="m">100000&lt;/span>
âœ ~ cat /sys/fs/cgroup/system.slice/docker-&lt;span class="sb">`&lt;/span>docker ps -lq --no-trunc&lt;span class="sb">`&lt;/span>.scope/memory.max
&lt;span class="m">2147483648&lt;/span>
âœ ~
âœ ~ docker run --rm -d --cpus&lt;span class="o">=&lt;/span>0.5 --memory&lt;span class="o">=&lt;/span>0.5g --name&lt;span class="o">=&lt;/span>0.5c0.5g redis:alpine
8b82790fe0da9d00ab07aac7d6e4ef2f5871d5f3d7d06a5cdb56daaf9f5bc48e
âœ ~ cat /sys/fs/cgroup/system.slice/docker-&lt;span class="sb">`&lt;/span>docker ps -lq --no-trunc&lt;span class="sb">`&lt;/span>.scope/cpu.max
&lt;span class="m">50000&lt;/span> &lt;span class="m">100000&lt;/span>
âœ ~ cat /sys/fs/cgroup/system.slice/docker-&lt;span class="sb">`&lt;/span>docker ps -lq --no-trunc&lt;span class="sb">`&lt;/span>.scope/memory.max
&lt;span class="m">536870912&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä»ä¸Šé¢çš„ç¤ºä¾‹å¯ä»¥çœ‹åˆ°ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨ Docker åˆ›å»ºå‡ºæ–°çš„å®¹å™¨å¹¶ä¸”ä¸ºä»–æŒ‡å®š CPU å’Œ å†…å­˜é™åˆ¶åï¼Œå…¶å¯¹åº”çš„ cgroup é…ç½®æ–‡ä»¶çš„ &lt;code>cpu.max&lt;/code> å’Œ &lt;code>memory.max&lt;/code>éƒ½è®¾ç½®æˆäº†ç›¸åº”çš„å€¼ã€‚&lt;/p>
&lt;p>å¦‚æœä½ æƒ³è¦å¯¹ä¸€äº›å·²ç»åœ¨è¿è¡Œçš„å®¹å™¨è¿›è¡Œèµ„æºé…é¢çš„æ£€æŸ¥çš„è¯ï¼Œä¹Ÿå¯ä»¥ç›´æ¥å»æŸ¥çœ‹å…¶å¯¹åº”çš„é…ç½®æ–‡ä»¶ä¸­çš„å†…å®¹ã€‚&lt;/p>
&lt;h2 id="æ€»ç»“">æ€»ç»“&lt;/h2>
&lt;p>ä»¥ä¸Šå°±æ˜¯å…³äºå®¹å™¨æŠ€æœ¯çš„åŸºçŸ³ä¹‹ä¸€çš„ cgroup çš„è¯¦ç»†ä»‹ç»äº†ã€‚æ¥ä¸‹æ¥æˆ‘è¿˜ä¼šå†™å…³äº namespace ä»¥åŠå…¶ä»–å®¹å™¨æŠ€æœ¯ç›¸å…³çš„å†…å®¹ï¼Œæ•¬è¯·å…³æ³¨ï¼&lt;/p>
&lt;hr>
&lt;p>æ¬¢è¿è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://gitee.com/tlrr/awesome/raw/master/2020-9-9/1599632564572-mp-qrcode.png" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Docker/">Docker</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>OCI ä¸ä¸‹ä¸€ä»£é•œåƒæ„å»ºå·¥å…·</title><link>https://moelove.info/2021/11/03/OCI-%E4%B8%8E%E4%B8%8B%E4%B8%80%E4%BB%A3%E9%95%9C%E5%83%8F%E6%9E%84%E5%BB%BA%E5%B7%A5%E5%85%B7/</link><guid isPermaLink="true">https://moelove.info/2021/11/03/OCI-%E4%B8%8E%E4%B8%8B%E4%B8%80%E4%BB%A3%E9%95%9C%E5%83%8F%E6%9E%84%E5%BB%BA%E5%B7%A5%E5%85%B7/</guid><pubDate>Wed, 03 Nov 2021 23:16:42 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å¼ æ™‹æ¶›ã€‚&lt;/p>
&lt;p>è¿™ç¯‡æ–‡ç« ä¸­æˆ‘å°†ä»‹ç» OCI åŠ Docker é•œåƒç›¸å…³çš„å†…å®¹ï¼Œæ¬¢è¿ç•™è¨€è®¨è®ºã€‚&lt;/p>
&lt;h2 id="oci-çš„å‰ä¸–ä»Šç”Ÿ">OCI çš„å‰ä¸–ä»Šç”Ÿ&lt;/h2>
&lt;p>2013 å¹´ 3 æœˆ dotCloud å…¬å¸åœ¨ PyCon ä¸Šè¿›è¡Œäº† Docker çš„é¦–æ¬¡å±•ç¤ºï¼Œéšåå®£å¸ƒå¼€æºã€‚è‡ªæ­¤ Docker å¼€å§‹è¢«ä¼—äººçŸ¥æ™“ï¼Œéšåæ€èµ·äº†ä¸€è‚¡å®¹å™¨åŒ–çš„çƒ­æ½®ã€‚&lt;/p>
&lt;p>åœ¨ 2014 å¹´ 6 æœˆ Docker 1.0 æ­£å¼å‘å¸ƒï¼Œæœ‰è¿‘ 460 ä½è´¡çŒ®è€…å’Œè¶…è¿‡ 8700 æ¬¡æäº¤ï¼Œè¿™ä¹Ÿæ ‡å¿—ç€ Docker è¾¾åˆ°äº†ç”Ÿäº§å¯ç”¨çš„çŠ¶æ€ã€‚&lt;/p>
&lt;p>åœ¨å½“æ—¶ï¼Œæåˆ°å®¹å™¨åŒ–ç¬¬ä¸€æƒ³æ³•å°±æ˜¯ç”¨ Docker ã€‚è€Œå½“æ—¶ Docker çš„å®ç°æˆ–è€…è¯´å‘å±•æ–¹å‘ä¸»è¦æ˜¯ç”± Docker Inc. å…¬å¸æ§åˆ¶çš„ï¼Œå¹¶æ²¡æœ‰ä¸€ä¸ªç»Ÿä¸€çš„å·¥ä¸šæ ‡å‡†ã€‚è¿™å¯¹äºä¸€äº›å¤´éƒ¨å…¬å¸è€Œè¨€ï¼Œæ˜¾ç„¶æ˜¯ä¸èƒ½æ¥å—çš„ï¼Œæ²¡æœ‰ç»Ÿä¸€çš„å·¥ä¸šæ ‡å‡†æ„å‘³ç€å¦‚æœé€‰æ‹©äº†ä½¿ç”¨ Docker çš„å®¹å™¨åŒ–æŠ€æœ¯ï¼Œä¾¿ä¼šè¢« Docker Inc. å…¬å¸æ‰€ç»‘å®šï¼›åŠ ä¸Šéšç€ Docker è½¯ä»¶çš„å‡çº§ï¼ŒæŸäº›åŠŸèƒ½æˆ–è€…ç‰¹æ€§å¿…ç„¶ä¼šè¿›è¡Œå˜åŠ¨ï¼Œæ²¡äººèƒ½ä¿è¯ä¸å‘ç”Ÿç ´åæ€§å˜æ›´ã€‚&lt;/p>
&lt;p>æ‰€ä»¥ï¼Œä¸ºäº†æ¨è¿›å®¹å™¨åŒ–æŠ€æœ¯çš„å·¥ä¸šæ ‡å‡†åŒ–ï¼Œ2015 å¹´ 6 æœˆåœ¨ DockerCon ä¸Š Linux åŸºé‡‘ä¼šä¸ Googleï¼Œåä¸ºï¼Œæƒ æ™®ï¼ŒIBMï¼ŒDockerï¼ŒRed Hatï¼ŒVMware ç­‰å…¬å¸å…±åŒå®£å¸ƒæˆç«‹å¼€æ”¾å®¹å™¨é¡¹ç›®(OCP)ï¼Œåæ›´åä¸º OCIã€‚å®ƒçš„ä¸»è¦ç›®æ ‡ä¾¿æ˜¯ &lt;strong>å»ºç«‹å®¹å™¨æ ¼å¼å’Œè¿è¡Œæ—¶çš„å·¥ä¸šå¼€æ”¾é€šç”¨æ ‡å‡†&lt;/strong>ã€‚&lt;/p>
&lt;p>å‘å±•è‡³ä»Šï¼Œ OCI åˆ¶å®šçš„ä¸»è¦æ ‡å‡†æœ‰ä¸‰ä¸ªåˆ†åˆ«æ˜¯ &lt;code>runtime-spec&lt;/code> ã€&lt;code>image-spec&lt;/code> å’Œ &lt;code>distribution-spec&lt;/code> è¿™ä¸‰ä¸ªæ ‡å‡†åˆ†åˆ«å®šä¹‰äº†å®¹å™¨è¿è¡Œæ—¶ï¼Œå®¹å™¨é•œåƒè¿˜æœ‰åˆ†å‘çš„è§„èŒƒï¼Œåé¢ä¼šå±•å¼€ä»‹ç»ã€‚&lt;/p>
&lt;p>ä¸ºäº†æ”¯æŒ OCI å®¹å™¨è¿è¡Œæ—¶æ ‡å‡†çš„æ¨è¿›ï¼ŒDocker å…¬å¸èµ·è‰äº†é•œåƒæ ¼å¼å’Œè¿è¡Œæ—¶è§„èŒƒçš„è‰æ¡ˆï¼Œå¹¶å°† Docker é¡¹ç›®çš„ç›¸å…³å®ç°æçŒ®ç»™äº† OCI ä½œä¸ºå®¹å™¨è¿è¡Œæ—¶çš„åŸºç¡€å®ç°ï¼Œç°åœ¨é¡¹ç›®åä¸º &lt;a href="https://github.com/opencontainers/runc">&lt;code>runc&lt;/code>&lt;/a> ã€‚&lt;/p>
&lt;p>åæ¥ Docker å°†å…¶å®¹å™¨è¿è¡Œæ—¶ç‹¬ç«‹æˆäº†ä¸€ä¸ªé¡¹ç›®ï¼Œåä¸º &lt;code>containerd&lt;/code> å¹¶å°†æ­¤é¡¹ç›®æçŒ®ç»™äº† CNCF ï¼Œç°åœ¨å·²ç»æ˜¯ CNCF æ¯•ä¸šé¡¹ç›®äº†ã€‚&lt;/p>
&lt;h2 id="oci-image-vs-docker-image">OCI image vs Docker image&lt;/h2>
&lt;p>OCI çš„å»ºç«‹æ¨åŠ¨äº†å®¹å™¨æŠ€æœ¯çš„å·¥ä¸šæ ‡å‡†åŒ–ï¼Œä½†æ˜¯å¦æ­¤æ ‡å‡†å°±æ˜¯å”¯ä¸€å‘¢ï¼Ÿå…¶å®ä¸ç„¶ã€‚åœ¨æˆç«‹ OCI å¹¶åˆ¶å®š &lt;code>image-spec&lt;/code> æ ‡å‡†çš„æ—¶å€™ Docker å·²ç»ç©ºå‰ç¹è£ï¼Œå¹¶å¾—åˆ°äº†å¹¿æ³›çš„åº”ç”¨ã€‚&lt;/p>
&lt;p>ç”±äºæ ‡å‡†åªå®šä¹‰äº†æœ€åŸºæœ¬çš„å†…å®¹ï¼Œæƒ³è¦å°† Docker çš„å®ç°å…¨éƒ¨æŒ‰ç…§æ ‡å‡†è¿›è¡Œæ”¹é€ çš„è¯ï¼Œä¼šå¯¹ Docker é€ æˆç ´åæ€§å˜æ›´ï¼Œä¹Ÿä¸åˆ©äº Docker åŠŸèƒ½çš„è¿­ä»£ã€‚&lt;/p>
&lt;p>æ‰€ä»¥ï¼ŒDocker ä¸ºäº†æ”¯æŒ OCI æ ‡å‡†çš„æ™®åŠï¼Œå·²ç»æ¨è¿›äº† registry å¯¹ OCI é•œåƒçš„æ”¯æŒï¼Œç°åœ¨ä¹Ÿæ­£åœ¨ç»™ Docker è‡ªèº«å¢åŠ é€‚é…ä¸­ï¼Œç›®æ ‡æ˜¯è®© Docker æ”¯æŒä¸¤ç§é•œåƒæ ¼å¼ï¼Œåˆ†åˆ«æ˜¯ç¬¦åˆ Docker æ ‡å‡†çš„é•œåƒå’Œç¬¦åˆ OCI æ ‡å‡†çš„é•œåƒã€‚&lt;/p>
&lt;p>é‚£è¿™ä¸¤è€…æœ‰ä»€ä¹ˆå¼‚åŒå‘¢ï¼Ÿ æˆ‘ä»¬æ¥é€æ­¥çœ‹ä¸‹ã€‚&lt;/p>
&lt;h3 id="docker-image-å’Œ-oci-image-çš„åŒºåˆ«å’Œè”ç³»">Docker Image å’Œ OCI Image çš„åŒºåˆ«å’Œè”ç³»&lt;/h3>
&lt;p>åœ¨æˆ‘ä»¥å‰çš„æ–‡ç« ä¸­æˆ‘ä»¬å·²ç»è¯¦ç»†çš„ä»æ ¹æœ¬ä¸Šä»‹ç»äº† Docker image æ˜¯ä»€ä¹ˆï¼Œè¿™é‡Œæˆ‘ä»¬å°±å¿«é€Ÿçš„ä»‹ç»ä¸‹ã€‚&lt;/p>
&lt;p>æ¯ä¸ª Docker é•œåƒéƒ½æ˜¯ç”±ä¸€ç³»åˆ—çš„é…ç½®æ¸…å•å’Œç›¸åº”çš„å±‚è¿›è¡Œç»„ç»‡çš„ã€‚æ¯ä¸ªå±‚ä¸€èˆ¬éƒ½æ˜¯ tar æ ¼å¼çš„å½’æ¡£ï¼Œé…ç½®æ¸…å•ä¸­æè¿°äº†å¯¹åº”çš„å±‚åº”è¯¥æŒ‰ä½•ç§é¡ºåºè¿›è¡Œç»„ç»‡ï¼Œä»¥åŠé•œåƒçš„ä¸€äº›å…ƒå±æ€§ã€‚æ¯”å¦‚é•œåƒæ‰€æ”¯æŒçš„æ¶æ„ï¼Œä¾‹å¦‚ &lt;code>amd64&lt;/code> ä¹‹ç±»çš„ï¼Œè¿˜æœ‰ ENV ç­‰æå‰é…ç½®å¥½çš„ä¸€äº›å‚æ•°ç­‰ã€‚&lt;/p>
&lt;p>å½“ç„¶ï¼Œåœ¨ Docker Image ä¸­ä¹ŸåŒ…å«ç€æ„å»ºé•œåƒæ—¶å€™æ‰€ç”¨çš„ Docker ç‰ˆæœ¬ &lt;code>docker_version&lt;/code> ä»¥åŠæ„å»ºé•œåƒçš„å†å²è®°å½• &lt;code>history&lt;/code> ç­‰ä¿¡æ¯ã€‚æ‰€ä»¥ä½ åœ¨ &lt;code>DockerHub&lt;/code> æˆ–è€…å…¶ä»–çš„é•œåƒä»“åº“ä¸Šå¯ä»¥çœ‹åˆ°æ„å»ºé•œåƒæ‰€ç”¨çš„ Docker ç‰ˆæœ¬ï¼Œ æˆ–è€…å¯é€šè¿‡ &lt;code>docker history &amp;lt;IMAGE&amp;gt;&lt;/code> çš„æ–¹å¼æ¥æŸ¥çœ‹æ„å»ºå†å²ã€‚&lt;/p>
&lt;p>é‚£ä¹ˆ OCI Image æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ é¦–å…ˆæˆ‘ä»¬éœ€è¦æœ‰ä¸€ä¸ª OCI Image æ‰å¥½æ¢ç©¶å®ƒåˆ°åº•æ˜¯ä»€ä¹ˆã€‚&lt;/p>
&lt;p>è¿™é‡Œä»‹ç»ä¸€ä¸ªå·¥å…· &lt;a href="https://github.com/projectatomic/skopeo">skopeo&lt;/a> å¯ä»¥å¾ˆæ–¹ä¾¿çš„ä»é•œåƒä»“åº“æˆ–è€…æœ¬åœ° Docker daemon ç”šè‡³æ˜¯é€šè¿‡ &lt;code>docker save&lt;/code> ä¿å­˜çš„ Docker Image tar æ–‡ä»¶è½¬æ¢ä¸º OCI Image ã€‚&lt;/p>
&lt;p>å…³äº &lt;a href="https://github.com/projectatomic/skopeo">skopeo&lt;/a> çš„å®‰è£…è¿‡ç¨‹å°±ä¸å†èµ˜è¿°äº†ï¼Œå‚è€ƒé¡¹ç›®ä¸»é¡µçš„æ–‡æ¡£è¯´æ˜å³å¯ã€‚è¿™é‡Œç›´æ¥å¼€å§‹ä½¿ç”¨ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬ä½¿ç”¨ &lt;code>debian&lt;/code> çš„é•œåƒä¸ºä¾‹ã€‚&lt;/p>
&lt;pre>&lt;code>(MoeLove) âœ skopeo copy docker://debian:stretch oci:debian:stretch
Getting image source signatures
Copying blob a4d8138d0f6b done
Copying config 45f82268e3 done
Writing manifest to image destination
Storing signatures
&lt;/code>&lt;/pre>&lt;p>é€šè¿‡ä¸Šé¢çš„å‘½ä»¤ä¾¿ä¼šå¾—åˆ°ä¸€ä¸ª OCI Image äº†ï¼Œ æˆ‘ä»¬çœ‹ä¸‹å®ƒçš„ç›®å½•ç»“æ„ã€‚&lt;/p>
&lt;pre>&lt;code>(MoeLove) âœ tree debian
debian
â”œâ”€â”€ blobs
â”‚Â Â  â””â”€â”€ sha256
â”‚Â Â  â”œâ”€â”€ 0043cd2a654fe86258f43f5b1dbbb4e6c582cc4bb6e505e9c5171c124150d155
â”‚Â Â  â”œâ”€â”€ 45f82268e32180cb1839f90467d9b8a8258953d68b7221199976653308d92ef5
â”‚Â Â  â””â”€â”€ a4d8138d0f6b5a441aaa533faf5fe0c3996a6ca42643c46f4402c7e8bda53742
â”œâ”€â”€ index.json
â””â”€â”€ oci-layout
2 directories, 5 files
&lt;/code>&lt;/pre>&lt;p>æ˜¯ä¸æ˜¯æœ‰ç§ä¼¼æ›¾ç›¸è¯†çš„æ„Ÿè§‰ï¼Ÿæ²¡é”™ OCI Image çš„è§„èŒƒæ˜¯åœ¨ Docker Image çš„åŸºç¡€ä¸Šå»ºç«‹çš„ï¼Œæ‰€ä»¥å¤§è‡´çœ‹èµ·æ¥å·®å¼‚ä¸æ˜¯ç‰¹åˆ«å¤§ã€‚æˆ‘ä»¬çœ‹çœ‹å…¶ä¸­å…·ä½“çš„å†…å®¹ã€‚&lt;/p>
&lt;h4 id="oci-layout">&lt;code>oci-layout&lt;/code>&lt;/h4>
&lt;p>è¿™ä¸ªæ–‡ä»¶æ˜¯ OCI Image çš„å¸ƒå±€æ–‡ä»¶ï¼Œä¹Ÿæ˜¯ç”¨äºè¯´æ˜å®ƒæ‰€ä½¿ç”¨æˆ–è€…éµå¾ªçš„é•œåƒè§„èŒƒã€‚&lt;/p>
&lt;pre>&lt;code>(MoeLove) âœ debian cat oci-layout| jq
{
&amp;quot;imageLayoutVersion&amp;quot;: &amp;quot;1.0.0&amp;quot;
}
&lt;/code>&lt;/pre>&lt;p>å¯ä»¥çœ‹åˆ°æ­¤å¤„çš„å†…å®¹å†™çš„æ˜¯ &lt;code>1.0.0&lt;/code> è¿™ä¾¿è¯´æ˜è¯¥é•œåƒéµå¾ª OCI 1.0.0 ç‰ˆæœ¬çš„å¸ƒå±€è§„èŒƒã€‚&lt;/p>
&lt;h4 id="indexjson">&lt;code>index.json&lt;/code>&lt;/h4>
&lt;p>&lt;code>index.json&lt;/code> æ–‡ä»¶ä¸­çš„ &lt;code>manifest&lt;/code> å­—æ®µç±»ä¼¼äº Docker Image ä¸­çš„ &lt;code>manifest.json&lt;/code> ä½œä¸º OCI Image çš„é¡¶çº§é…ç½®, ä¹Ÿæ˜¯é•œåƒçš„ä¸€ä¸ªå…¥å£é…ç½®ã€‚&lt;/p>
&lt;pre>&lt;code>(MoeLove) âœ debian cat index.json | jq
{
&amp;quot;schemaVersion&amp;quot;: 2,
&amp;quot;manifests&amp;quot;: [
{
&amp;quot;mediaType&amp;quot;: &amp;quot;application/vnd.oci.image.manifest.v1+json&amp;quot;,
&amp;quot;digest&amp;quot;: &amp;quot;sha256:0043cd2a654fe86258f43f5b1dbbb4e6c582cc4bb6e505e9c5171c124150d155&amp;quot;,
&amp;quot;size&amp;quot;: 349,
&amp;quot;annotations&amp;quot;: {
&amp;quot;org.opencontainers.image.ref.name&amp;quot;: &amp;quot;stretch&amp;quot;
},
&amp;quot;platform&amp;quot;: {
&amp;quot;architecture&amp;quot;: &amp;quot;amd64&amp;quot;,
&amp;quot;os&amp;quot;: &amp;quot;linux&amp;quot;
}
}
]
}
&lt;/code>&lt;/pre>&lt;p>ä»å®ƒçš„å†…å®¹å¯ä»¥çœ‹åˆ°å®ƒå…¶ä¸­çš„ &lt;code>mediaType&lt;/code> å­—æ®µä¸ Docker Image ä¸­çš„ç±»å‹å½¢å¼ç›¸åŒï¼Œä½†æ˜¯å°† &lt;code>docker&lt;/code> éƒ½æ¢æˆäº† &lt;code>oci&lt;/code>ã€‚ä»è¿™ä¸ªé…ç½®æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°ç¬¬ä¸€ä¸ª blob æ˜¯ &lt;code>sha256:0043cd2a654fe86258f43f5b1dbbb4e6c582cc4bb6e505e9c5171c124150d155&lt;/code> æˆ‘ä»¬çœ‹çœ‹å®ƒçš„å†…å®¹ã€‚&lt;/p>
&lt;pre>&lt;code>(MoeLove) âœ debian cat blobs/sha256/0043cd2a654fe86258f43f5b1dbbb4e6c582cc4bb6e505e9c5171c124150d155 | jq
{
&amp;quot;schemaVersion&amp;quot;: 2,
&amp;quot;config&amp;quot;: {
&amp;quot;mediaType&amp;quot;: &amp;quot;application/vnd.oci.image.config.v1+json&amp;quot;,
&amp;quot;digest&amp;quot;: &amp;quot;sha256:45f82268e32180cb1839f90467d9b8a8258953d68b7221199976653308d92ef5&amp;quot;,
&amp;quot;size&amp;quot;: 579
},
&amp;quot;layers&amp;quot;: [
{
&amp;quot;mediaType&amp;quot;: &amp;quot;application/vnd.oci.image.layer.v1.tar+gzip&amp;quot;,
&amp;quot;digest&amp;quot;: &amp;quot;sha256:a4d8138d0f6b5a441aaa533faf5fe0c3996a6ca42643c46f4402c7e8bda53742&amp;quot;,
&amp;quot;size&amp;quot;: 45337510
}
]
}
&lt;/code>&lt;/pre>&lt;p>è¿™ä¸ªå…¥å£æ–‡ä»¶æè¿°äº† OCI é•œåƒçš„å®é™…é…ç½®å’Œå…¶ä¸­çš„ Layer é…ç½®ã€‚å¦‚æœæœ‰å¤šå±‚é‚£ &lt;code>layers&lt;/code> ä¹Ÿä¼šç›¸åº”å¢åŠ ã€‚&lt;/p>
&lt;p>&lt;strong>æ³¨æ„ï¼šlayers ä¸­ &lt;code>mediaType&lt;/code> ä½¿ç”¨äº† &lt;code>application/vnd.oci.image.layer.v1.tar+gzip&lt;/code> è¯´æ˜æ•°æ®å†…å®¹æ˜¯ç»è¿‡ gzip å‹ç¼©çš„&lt;/strong> å¦‚æœæœ‰å…´è¶£ä½ å¯ä»¥å°†å®ƒç”¨ tar è§£å‹ä¸€ä¸‹ï¼Œä½ ä¼šå‘ç°å¾ˆæœ‰è¶£çš„å†…å®¹ã€‚&lt;/p>
&lt;blockquote>
&lt;p>è¿™é‡Œå…ˆå°†ç»“æœè¯´å‡ºæ¥ï¼Œè§£å‹åä½ ä¼šå¾—åˆ°ä¸€ä¸ª &lt;code>rootfs&lt;/code> è¿™ä¸ Docker Image æ˜¯ç±»ä¼¼çš„ã€‚&lt;/p>
&lt;/blockquote>
&lt;h3 id="å°ç»“">å°ç»“&lt;/h3>
&lt;p>æˆ‘ä»¬é€šè¿‡ &lt;a href="https://github.com/projectatomic/skopeo">skopeo&lt;/a> å·¥å…·ï¼Œä»æœ¬åœ°çš„ Docker daemon ä¸­ç”± debian çš„ Docker Image å¾—åˆ°äº† OCI Imageï¼Œå¹¶åˆ†æäº†å®ƒå…¶ä¸­çš„å†…å®¹ã€‚&lt;/p>
&lt;p>æœ€ä¸»è¦çš„åŒºåˆ«åœ¨äºå®ƒä»¬çš„ç›®å½•ç»“æ„ä¸å®Œå…¨ç›¸åŒï¼Œé…ç½®ä¿¡æ¯å°¤å…¶æ˜¯ &lt;code>mediaType&lt;/code> çš„è§„èŒƒæ˜¯ä¸ç›¸åŒçš„ã€‚&lt;/p>
&lt;p>è€Œå®ƒä»¬çš„è”ç³»ä¹Ÿåœ¨äºæ­¤ï¼ŒOCI Image çš„è§„èŒƒæ˜¯ç”± Docker Image çš„è§„èŒƒä¿®æ”¹è€Œæ¥çš„ï¼Œæ‰€ä»¥ç±»ä¼¼å®ƒä»¬çš„ blob çš„ç»„ç»‡å½¢å¼å¤§è‡´æ˜¯ç›¸åŒçš„ï¼Œé…ç½®æ–‡ä»¶ä¸­å¾ˆå¤šçš„å‚æ•°ä¹Ÿç›¸ä¼¼ã€‚&lt;/p>
&lt;p>å¦å¤–ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å¾ˆå®¹æ˜“çš„å¾—åˆ°å¦ä¸€ä¸ªç»“è®ºï¼Œé‚£ä¾¿æ˜¯æˆ‘ä»¬å¯ä»¥å¾ˆæ–¹ä¾¿çš„å°† Docker Image è½¬æ¢ä¸º OCI Image ã€‚&lt;/p>
&lt;h3 id="oci-image-å’Œ-docker-image-çš„è½¬æ¢">OCI image å’Œ Docker image çš„è½¬æ¢&lt;/h3>
&lt;p>ä¸Šé¢æˆ‘ä»¬å·²ç»çœ‹åˆ°ï¼Œä½¿ç”¨ &lt;a href="https://github.com/projectatomic/skopeo">skopeo&lt;/a> å·¥å…·ï¼Œå¯ä»¥å°† Docker Image è½¬æ¢ä¸º OCI Image ï¼Œå½“ç„¶å®ƒä¹Ÿå¯ä»¥å°† OCI Image è½¬æ¢ä¸º Docker Image ã€‚ä¸‹é¢ç»™å‡ºäº†æ–¹æ³•ï¼š&lt;/p>
&lt;pre>&lt;code># ä» DockerHub å°† debian çš„ Docker Image æ‹‰å–å¹¶è½¬æ¢ä¸º OCI Image
(MoeLove) âœ skopeo copy docker://debian:stretch oci:debian:stretch
Getting image source signatures
Copying blob a4d8138d0f6b done
Copying config 45f82268e3 done
Writing manifest to image destination
Storing signatures
# å°†å½“å‰ç›®å½•ä¸‹çš„ debian çš„ OCI Image è½¬æ¢ä¸º Docker Image å¹¶å­˜å‚¨åˆ°æœ¬åœ° docker daemon ä¸­
(MoeLove) âœ skopeo copy oci:debian:stretch docker-daemon:local/debian:oci
Getting image source signatures
Copying blob 0e350e141713 done
Copying config aae58a37cf done
Writing manifest to image destination
Storing signatures
# éªŒè¯
(MoeLove) âœ oci docker images local/debian
REPOSITORY TAG IMAGE ID CREATED SIZE
local/debian oci ac6bcf605d82 6 months ago 101MB
&lt;/code>&lt;/pre>&lt;h3 id="é•œåƒæ„å»ºå·¥å…·">é•œåƒæ„å»ºå·¥å…·&lt;/h3>
&lt;p>åœ¨ CI/CD ç¯å¢ƒä¸­ï¼Œè™½ç„¶æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ DinD (Docker in Docker) çš„æ–¹å¼å¯åŠ¨ä¸€ä¸ª docker daemon æˆ–è€…ä½¿ç”¨æŒ‚è½½çš„æ–¹å¼ï¼Œå°†å¤–éƒ¨çš„ &lt;code>/var/run/docker.sock&lt;/code> æŒ‚è½½è¿›å®¹å™¨å†…éƒ¨ï¼Œäº¦æˆ–è€…å°† Docker API ä½¿ç”¨ HTTP çš„æ–¹å¼æš´éœ²å‡ºæ¥ï¼Œç›´æ¥ä½¿ç”¨è¯¥åœ°å€è¿›è¡Œæ„å»ºã€‚&lt;/p>
&lt;p>ä½†è¿™äº›æ–¹å¼ä½ æ˜¯å¦ä¼šè§‰å¾—æ¯”è¾ƒé‡ï¼Ÿæ˜¯å¦æœ‰è€ƒè™‘å®‰å…¨é—®é¢˜ï¼Œæˆ–è€…å‹åŠ›åŠè´Ÿè½½çš„é—®é¢˜ï¼Ÿ&lt;/p>
&lt;p>è¿™é‡Œçš„å‹åŠ›åŠè´Ÿè½½ä¸»è¦æ˜¯æŒ‡å½“æ‰€æœ‰çš„ä»»åŠ¡éƒ½å…±ç”¨åŒä¸€ä¸ª docker daemon æä¾›æœåŠ¡çš„è¯ï¼Œå¯¹è¯¥ docker daemon é€ æˆçš„å‹åŠ›ã€‚&lt;/p>
&lt;p>è¿™é‡Œæˆ‘ä»¬æ¥ä»‹ç»ä¸€äº›å…¶ä»–çš„é•œåƒæ„å»ºå·¥å…·ï¼Œä½¿ç”¨è¿™äº›å·¥å…·å¯ä»¥è®©ä½ åœ¨æ—  Docker çš„ç¯å¢ƒä¸‹æ„å»ºå‡ºé•œåƒå¹¶ä¸Šä¼ è‡³ Docker é•œåƒä»“åº“ä¸­ã€‚&lt;/p>
&lt;p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å¯ä»¥æœ‰å¾ˆå¤šç§é€‰æ‹©ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://github.com/moby/buildkit">BuildKit&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/genuinetools/img">img&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/cyphar/orca-build">orca-build&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/openSUSE/umoci">umoci&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/containers/buildah">buildah&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/GoogleContainerTools/kaniko">kaniko&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/GoogleCloudPlatform/runtimes-common/tree/master/ftl">FTL&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/bazelbuild/rules_docker">Bazel rules_docker&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>è¿™äº›å·¥å…·ä¾§é‡ç‚¹å„æœ‰ä¸åŒï¼Œå½“ç„¶ä¹Ÿä¸ä»…æœ‰ä¸Šé¢åˆ—åˆ°çš„è¿™äº›å·¥å…·ï¼Œåªæ˜¯è¿™äº›å·¥å…·æ¯”è¾ƒå…¸å‹ç½¢äº†ã€‚&lt;/p>
&lt;p>é€šå¸¸æƒ…å†µä¸‹ï¼Œåœ¨ç½‘ç»œä¸Šæ¯”è¾ƒå®¹æ˜“è§åˆ°å®£ä¼ ä¸ºä¸‹ä¸€ä»£é•œåƒæ„å»ºå·¥å…·çš„æ˜¯ &lt;code>buildah&lt;/code> ï¼Œæœ€ä¸»è¦åŸå› æ˜¯å› ä¸ºå®ƒå¯ä»¥ç›´æ¥æ„å»º OCI æ ‡å‡†çš„é•œåƒæˆ– Docker é•œåƒï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ &lt;code>Dockerfile&lt;/code> ã€‚å¹¶ä¸”å®ƒè¿˜å¯ä»¥ &lt;code>pull&lt;/code>/&lt;code>push&lt;/code> é•œåƒï¼Œå¯ä»¥è¯´åœ¨é•œåƒæ„å»ºæ–¹é¢ä¸ Docker æ˜¯å®Œå…¨å…¼å®¹ï¼Œç”šè‡³å¯ä»¥è¯´å®ƒåœ¨æ„å»ºé•œåƒæ–¹é¢å¯ä»¥ä½œä¸º Docker çš„æ›¿ä»£å“äº†ã€‚&lt;/p>
&lt;p>å¹¶ä¸” &lt;code>buildah&lt;/code> æ„å»ºé•œåƒçš„æ—¶å€™ä¸éœ€è¦ä»»ä½• &lt;code>root&lt;/code> æƒé™ï¼Œä¹Ÿä¸ä¾èµ– Dockerï¼Œ å®ƒä½¿ç”¨äº†ç®€å•çš„ &lt;code>fork-exec&lt;/code> æ¨¡å‹ï¼ŒåŒæ—¶å®ƒä¹Ÿå¯ä»¥ä½œä¸ºä¸€ä¸ªåº“åŒ…å«åœ¨å…¶ä»–çš„å·¥å…·ä¸­ã€‚å®ƒçš„æœ€ç»ˆç›®æ ‡ä¾¿æ˜¯æä¾›ä¸€ä¸ªæ›´ä½å±‚æ¬¡çš„æ ¸å¿ƒå·¥å…·é›†ï¼Œæ¥å®Œæˆæ„å»ºé•œåƒç›¸å…³çš„äº‹æƒ…ã€‚&lt;/p>
&lt;p>è¯´å®Œè¿™ä¸ªå…¸å‹çš„æ›¿ä»£å“ï¼Œæˆ‘ä»¬å†æ¥è¯´ä¸‹ &lt;code>BuildKit&lt;/code> å’Œ &lt;code>img&lt;/code> , &lt;code>img&lt;/code> è¿™ä¸ªå·¥å…·æ˜¯æ„å»ºåœ¨ &lt;code>BuildKit&lt;/code> ä¹‹ä¸Šçš„ï¼Œæ‰€ä»¥æœ‰å¾ˆå¤šç›¸ä¼¼æ€§ã€‚å®ƒä»¬ä½¿ç”¨é root ç”¨æˆ·æ¥æ„å»ºé•œåƒã€‚å½“ç„¶ &lt;code>BuildKit&lt;/code> æˆ‘åœ¨ä¹‹å‰çš„æ–‡ç« ä¸­è¯¦ç»†ä»‹ç»è¿‡äº†ï¼Œå®ƒæ˜¯ Docker å†…ç½®çš„ä¸‹ä¸€ä»£æ„å»ºå·¥å…·ï¼Œç‹¬ç«‹ä½¿ç”¨ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚ç§°å®ƒä¸ºâ€œä¸‹ä¸€ä»£é•œåƒæ„å»ºå·¥å…·â€ ä¹Ÿå¹¶ä¸ä¸ºè¿‡ã€‚&lt;/p>
&lt;p>&lt;code>kaniko&lt;/code> æ˜¯ Google æ¨å‡ºçš„ï¼Œå®ƒä¸»è¦çš„å®£ä¼ è¯­ä¸º â€œåœ¨ Kubernetes ä¸­æ„å»ºå®¹å™¨é•œåƒâ€ å®é™…ä¸Šæ— è®ºæ˜¯åœ¨ K8S é›†ç¾¤ä¸­æˆ–è€…åœ¨å®¹å™¨ä¸­å®ƒéƒ½æ˜¯å¯ä»¥å·¥ä½œçš„ã€‚å®ƒä¹Ÿå¯ä»¥ä½¿ç”¨ &lt;code>Dockerfile&lt;/code> æ„å»ºé•œåƒã€‚å½“ç„¶è¿˜æœ‰å¾ˆé‡è¦çš„ä¸€ç‚¹ï¼Œå®ƒæ‰€æœ‰çš„æ„å»ºå‘½ä»¤éƒ½æ˜¯è¿è¡Œåœ¨ç”¨æˆ·æ€çš„ï¼Œå¹¶ä¸”ä¹Ÿå¯ä»¥å¾ˆå¥½çš„ä¸ Kubernetes ç»“åˆï¼Œåœ¨äº‘åŸç”Ÿæ—¶ä»£ä¸‹ï¼Œå®ƒä¹Ÿå æ®äº†ä¸€å®šçš„ä¼˜åŠ¿ã€‚&lt;/p>
&lt;p>ä»¥ä¸Šå·¥å…·éƒ½åªæ˜¯å¤§è‡´ä»‹ç»äº†ä¸‹ï¼Œå¦‚æœå¯¹å®ƒä»¬æ„Ÿå…´è¶£ï¼Œå¯ç›´æ¥è¿›å…¥é¡¹ç›®ä¸»é¡µæŸ¥çœ‹ &lt;code>README.md&lt;/code> åŸºç¡€ä½¿ç”¨éƒ½æœ‰æ¯”è¾ƒè¯¦ç»†çš„è¯´æ˜ï¼Œè¿™é‡Œä¸å†è¿›è¡Œèµ˜è¿°äº†ã€‚&lt;/p>
&lt;h2 id="æ€»ç»“">æ€»ç»“&lt;/h2>
&lt;p>æœ¬ç¯‡ä¸ºå¤§å®¶ä»‹ç»äº† OCI çš„å‰ä¸–ä»Šç”Ÿï¼Œä»¥åŠ OCI Image çš„è§„èŒƒå’Œç‰¹ç‚¹ï¼Œå¦å¤–ä¹Ÿä»‹ç»äº†ä¸€ä¸ªå¯ç”¨äºåœ¨ OCI Image å’Œ Docker Image ä¹‹é—´é•œåƒè½¬æ¢çš„å·¥å…· &lt;code>skopeo&lt;/code> ã€‚å¦å¤–ä»‹ç»äº†ä¸€äº›å¯ç”¨äºåœ¨ CI ç¯å¢ƒæˆ–å…¶ä»–æœ‰ç‰¹å®šåœºæ™¯ç¯å¢ƒä¸‹æ›¿ä»£ Docker build çš„å·¥å…·ï¼Œè¯·å¤§å®¶æŒ‰å®é™…éœ€æ±‚è¿›è¡Œé€‰æ‹©ã€‚&lt;/p>
&lt;hr>
&lt;p>æ¬¢è¿è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://gitee.com/tlrr/awesome/raw/master/2020-9-9/1599632564572-mp-qrcode.png" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Docker/">Docker</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| Helm æ–°ç‰ˆæœ¬å‘å¸ƒå¢å¼ºå¯¹ OCI çš„æ”¯æŒ</title><link>https://moelove.info/2021/10/31/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Helm-%E6%96%B0%E7%89%88%E6%9C%AC%E5%8F%91%E5%B8%83%E5%A2%9E%E5%BC%BA%E5%AF%B9-OCI-%E7%9A%84%E6%94%AF%E6%8C%81/</link><guid isPermaLink="true">https://moelove.info/2021/10/31/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Helm-%E6%96%B0%E7%89%88%E6%9C%AC%E5%8F%91%E5%B8%83%E5%A2%9E%E5%BC%BA%E5%AF%B9-OCI-%E7%9A%84%E6%94%AF%E6%8C%81/</guid><pubDate>Sun, 31 Oct 2021 01:15:34 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container" title="k8sç”Ÿæ€">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;h1 id="docker-v201010-å‘å¸ƒ">Docker v20.10.10 å‘å¸ƒ&lt;/h1>
&lt;p>è¿™ä¸ªç‰ˆæœ¬æ˜¯ Docker v20.10 çš„ç¬¬ 10 ä¸ªå°ç‰ˆæœ¬ï¼Œè¿™ä¸ªç‰ˆæœ¬ä¸­æ²¡æœ‰ä»€ä¹ˆå¤ªç‰¹åˆ«çš„å…±æ€§é—®é¢˜ï¼Œä½†æ˜¯ç”±äº&lt;a href="https://go-review.googlesource.com/c/net/+/249440/" title="Go 116 å¯¹ http_proxy çš„å¤„ç†è¡Œä¸º"> Go 1.16 ä¸­ &lt;code>net/http&lt;/code> åŒ…å¯¹ &lt;code>$HTTP_PROXY&lt;/code> è¡Œä¸ºçš„å˜åŒ–&lt;/a>ï¼Œæ‰€ä»¥å½“ä½ ä¸º Docker daemon è®¾ç½®ä»£ç†çš„æ—¶å€™ï¼Œè¯·ç¡®è®¤ä½ å·²ç»æ­£ç¡®çš„è®¾ç½®äº† &lt;code>$HTTP_PROXY&lt;/code> å’Œ &lt;code>$HTTPS_PROXY&lt;/code> ç­‰ã€‚&lt;/p>
&lt;p>æ­¤ç‰ˆæœ¬çš„å…¶ä»–å˜æ›´ï¼Œå¯å‚è€ƒå…¶ &lt;a href="https://github.com/moby/moby/releases/tag/v20.10.10">ReleaseNote&lt;/a> ã€‚è‡³äº Docker v21.x çŸ­æ—¶é—´å†…è¿˜ä¸ä¼šå‘å¸ƒï¼Œä¸è¿‡é‡Œé¢ç¡®å®å¢åŠ äº†ä¸€äº›å€¼å¾—ä¸€æçš„ç‰¹æ€§ï¼Œåç»­æ–°ç‰ˆæœ¬å¿«å‘å¸ƒå‰å†è·Ÿå¤§å®¶åˆ†äº«ã€‚&lt;/p>
&lt;h1 id="helm-v37-æ­£å¼å‘å¸ƒ">Helm v3.7 æ­£å¼å‘å¸ƒ&lt;/h1>
&lt;p>Helm v3.7 æ˜¯ä¸€ä¸ªç‰¹æ€§ç‰ˆæœ¬ï¼Œæˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹æœ‰å“ªäº›å€¼å¾—å…³æ³¨çš„å˜æ›´å§ã€‚&lt;/p>
&lt;h2 id="å¯¹-oci-chart-çš„æ”¯æŒç›¸å…³çš„å˜æ›´">å¯¹ OCI Chart çš„æ”¯æŒç›¸å…³çš„å˜æ›´&lt;/h2>
&lt;ul>
&lt;li>&lt;code>helm chart export&lt;/code> å·²åˆ é™¤&lt;/li>
&lt;li>&lt;code>helm chart list&lt;/code> å·²åˆ é™¤&lt;/li>
&lt;li>&lt;code>helm chart pull&lt;/code> ç”± &lt;code>helm pull&lt;/code> ä»£æ›¿&lt;/li>
&lt;li>&lt;code>helm chart push&lt;/code> ç”± &lt;code>helm push&lt;/code> ä»£æ›¿&lt;/li>
&lt;li>&lt;code>helm chart remove&lt;/code> å·²åˆ é™¤&lt;/li>
&lt;li>&lt;code>helm chart save&lt;/code> ç”± &lt;code>helm package&lt;/code> ä»£æ›¿&lt;/li>
&lt;/ul>
&lt;p>å¦å¤–ï¼Œ &lt;strong>å¦‚æœæ˜¯é€šè¿‡æ—§ç‰ˆæœ¬åˆ›å»ºçš„ OCI chart éœ€è¦ä½¿ç”¨ Helm v3.7 è¿›è¡Œé‡æ–°æ‰“åŒ…å’Œä¸Šä¼ æ‰èƒ½ä½¿ç”¨ã€‚&lt;/strong>&lt;/p>
&lt;h2 id="ä¸€äº›æ–°ç‰¹æ€§">ä¸€äº›æ–°ç‰¹æ€§&lt;/h2>
&lt;ul>
&lt;li>æ–°å¢ &lt;code>helm uninstall --wait&lt;/code>&lt;/li>
&lt;li>æ–°å¢ &lt;code>helm show crds&lt;/code>&lt;/li>
&lt;li>&lt;code>helm dependency list&lt;/code> æ–°å¢ &lt;code>--max-col-width&lt;/code> ç”¨äºè®¾ç½®åˆ—å®½&lt;/li>
&lt;li>&lt;code>helm repo add&lt;/code> æ–°å¢ &lt;code>--password-stdin&lt;/code> ç”¨äºä» stdin è¾“å…¥å¯†ç &lt;/li>
&lt;li>&lt;code>helm repo update&lt;/code> å¯ä»¥æŒ‡å®š repo åç§°è¿›è¡Œæ›´æ–°äº†&lt;/li>
&lt;li>Helm æ¨¡æ¿å¼•æ“ä¸­æ–°å¢ &lt;code>{{ .Chart.IsRoot }}&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>æ›´å¤šå…³äºæ­¤ç‰ˆæœ¬çš„å˜æ›´å¯ä»¥å‚è€ƒå…¶ &lt;a href="https://github.com/helm/helm/releases/tag/v3.7.0">ReleaseNote&lt;/a>&lt;/p>
&lt;h1 id="notary-v2-alpha1-å‘å¸ƒ">Notary v2 alpha1 å‘å¸ƒ&lt;/h1>
&lt;p>Notary v1ï¼Œä¹Ÿç§°ä¸º Docker Content Trust(DCT)ï¼Œä¸»è¦æ˜¯ä¸ºå½“æ—¶çš„ Docker Hub å‘å¸ƒçš„ã€‚ä»é‚£ä»¥åå‘ç”Ÿäº†å¾ˆå¤šå˜åŒ–ï¼Œå›´ç»•é¦–æ¬¡ä½¿ç”¨ä¿¡ä»» (TOFU)ã€å¯†é’¥ç®¡ç†ä»¥åŠåœ¨æ³¨å†Œä¸­å¿ƒå†…å’Œè·¨æ³¨å†Œä¸­å¿ƒç¼ºä¹å†…å®¹æ¨å¹¿çš„ä¸€äº›è®¾è®¡é€‰æ‹©å·²æˆä¸º Docker Content Trust å’Œ Notary v1 çš„é™åˆ¶å› ç´ ã€‚&lt;/p>
&lt;p>å¯¹ Notary ä¸äº†è§£çš„å°ä¼™ä¼´ï¼Œå¯ä»¥çœ‹ä¸‹æˆ‘ä¸¤å¹´å‰å†™çš„ä¸€ç¯‡ ã€ŠK8S ç”Ÿæ€å‘¨æŠ¥| TUF æ­£å¼ä» CNCF æ¯•ä¸šã€‹åœ¨è¿™ç¯‡æ–‡ç« ä¸­ä»‹ç»äº† TUF è¿˜æœ‰ Notary ç­‰å†…å®¹ã€‚è¿™é‡Œå°±ä¸å±•å¼€äº†ã€‚&lt;/p>
&lt;p>Notary v2 æ”¯æŒå¯¹å­˜å‚¨åœ¨åŸºäº OCI åˆ†å‘çš„æ³¨å†Œè¡¨ä¸­çš„æ‰€æœ‰å·¥ä»¶ï¼ˆå®¹å™¨é•œåƒã€è½¯ä»¶ææ–™æ¸…å•ã€æ‰«æç»“æœï¼‰è¿›è¡Œç­¾åï¼Œå¹¶å¢å¼ºäº† ORAS å·¥ä»¶è§„èŒƒã€‚Notary v2 çš„ä¸€ä¸ªå…³é”®åŸåˆ™æ˜¯å®ƒæ”¯æŒåœ¨æ³¨å†Œä¸­å¿ƒå†…å’Œè·¨æ³¨å†Œä¸­å¿ƒæ¨å¹¿å·²ç­¾åçš„å·¥ä»¶ï¼ŒåŒ…æ‹¬ç§æœ‰ç½‘ç»œç¯å¢ƒã€‚&lt;/p>
&lt;p>å®ƒçš„å·¥ä½œè¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š&lt;/p>
&lt;p>&lt;img src="https://i.loli.net/2021/11/03/ETIVuP7jK6U9pcH.png" alt="Notary v2">&lt;/p>
&lt;p>åœ¨ Notary v2 ä¸­æœ€æ˜¾è‘—çš„å˜åŒ–å°±æ˜¯æ˜“ç”¨æ€§çš„æå‡ï¼ŒåŒ…æ‹¬å®ƒå‘å¸ƒäº†åä¸º &lt;code>notation&lt;/code> çš„ CLI å·¥å…·ã€‚å¯ä»¥åˆ›å»ºè¯ä¹¦ï¼Œç­¾åï¼Œæ ¡éªŒç­‰ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ ~ notation
NAME:
notation - Notation - Notary V2
USAGE:
notation &lt;span class="o">[&lt;/span>global options&lt;span class="o">]&lt;/span> &lt;span class="nb">command&lt;/span> &lt;span class="o">[&lt;/span>&lt;span class="nb">command&lt;/span> options&lt;span class="o">]&lt;/span> &lt;span class="o">[&lt;/span>arguments...&lt;span class="o">]&lt;/span>
VERSION:
0.7.0-alpha.1
AUTHOR:
CNCF Notary Project
COMMANDS:
sign Signs artifacts
verify Verifies OCI Artifacts
push Push signature to remote
pull Pull signatures from remote
list, ls List signatures from remote
certificate, cert Manage certificates used &lt;span class="k">for&lt;/span> verification
key Manage keys used &lt;span class="k">for&lt;/span> signing
cache Manage signature cache
help, h Shows a list of commands or &lt;span class="nb">help&lt;/span> &lt;span class="k">for&lt;/span> one &lt;span class="nb">command&lt;/span>
GLOBAL OPTIONS:
--help, -h show &lt;span class="nb">help&lt;/span> &lt;span class="o">(&lt;/span>default: &lt;span class="nb">false&lt;/span>&lt;span class="o">)&lt;/span>
--version, -v print the version &lt;span class="o">(&lt;/span>default: &lt;span class="nb">false&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ­¤ç‰ˆæœ¬ä¸­æœ€æ˜¾è‘—çš„ç‰¹æ€§å°±æ˜¯ç¦»çº¿ç­¾ååˆ›å»ºï¼Œä»¥åŠå¯¹ OCI åˆ†å‘è§„èŒƒçš„æ”¯æŒã€‚åç»­çš„ç‰ˆæœ¬ä¸­å°†æ”¯æŒè¯ä¹¦åŠé”€ï¼Œç­–ç•¥æ”¯æŒç­‰èƒ½åŠ›ã€‚æ„Ÿå…´è¶£çš„å°ä¼™ä¼´å¯ä»¥å‚è€ƒå…¶ &lt;a href="https://github.com/notaryproject/notaryproject/releases/tag/v1.0.0-draft.1">ReleaseNote&lt;/a>&lt;/p>
&lt;h1 id="docker-hub-registry-å…¬å¸ƒå¯¹-ipv6-çš„æ”¯æŒ">Docker Hub Registry å…¬å¸ƒå¯¹ IPv6 çš„æ”¯æŒ&lt;/h1>
&lt;p>éšç€ IPv6 çš„é€æ­¥æ™®åŠï¼Œä¸–ç•ŒèŒƒå›´å†…è¶Šæ¥è¶Šå¤šçš„ç”¨æˆ·å¼€å§‹åœ¨ä½¿ç”¨ IPv6 ç½‘ç»œäº†ï¼Œä½†æ˜¯ Docker Hub æ­¤å‰å¹¶ä¸æ”¯æŒ IPv6 ç½‘ç»œã€‚åœ¨å¬å–ç¤¾åŒºåé¦ˆæ„è§åï¼Œæ­£å¼åŠ å…¥äº†å¯¹ Docker Hub çš„ IPv6 ç½‘ç»œçš„æ”¯æŒã€‚&lt;/p>
&lt;p>&lt;img src="https://i.loli.net/2021/11/03/C48k9VZ2xUSmohe.png" alt="Google IPv6 statistic">&lt;/p>
&lt;p>ç›®å‰å…¬å¸ƒçš„æµ‹è¯•ç‰ˆæœ¬çš„ IPv6 åœ°å€ä¸º &lt;code>registry.ipv6.docker.com&lt;/code>ï¼Œ å¦‚æœæ˜¯çº¯ IPv6 æˆ–è€…åŒæ ˆç”¨æˆ·ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤è¿›è¡Œç™»é™†ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">docker login registry.ipv6.docker.com
&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¹Ÿå¯ä»¥ä½¿ç”¨å¦‚ä¸‹çš„å‘½ä»¤è¿›è¡Œé•œåƒçš„æ‹‰å–ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">docker pull registry.ipv6.docker.com/library/debian:latest
&lt;/code>&lt;/pre>&lt;/div>&lt;p>åœ¨åç»­å¯¹ IPv6 çš„æ”¯æŒè¾¾åˆ°ç¨³å®šåï¼Œé»˜è®¤çš„ Docker Hub Registry çš„åœ°å€ä¹Ÿå°†æ”¯æŒ IPv6ã€‚è¿™ä»¶äº‹æƒ…å¯¹äº Docker Inc. å…¬å¸è€Œè¨€ï¼Œæ¯”è¾ƒå¤§çš„æŒ‘æˆ˜åœ¨ä¸å®ƒéœ€è¦å¤„ç†å®ƒçš„é™æµé™é€Ÿç›¸å…³çš„é€»è¾‘ï¼Œä¸è¿‡ç›®å‰ä¹Ÿå·²ç»åŸºæœ¬å¤„ç†å¥½äº†ã€‚&lt;/p>
&lt;h1 id="ä¸Šæ¸¸è¿›å±•">ä¸Šæ¸¸è¿›å±•&lt;/h1>
&lt;ul>
&lt;li>
&lt;p>&lt;a href="https://github.com/kubernetes/kubernetes/pull/99557">#99557 Â· kubernetes/kubernetes&lt;/a> æ–°å¢äº†ä¸€ä¸ªå®éªŒæ€§çš„ &lt;code>kubectl events&lt;/code> å‘½ä»¤ï¼Œè¿™ä¸ª PR ä¸­ä»…åŒ…å«äº†æœ€åŸºæœ¬çš„å®ç°ï¼Œåç»­ç‰ˆæœ¬ä¸­å°†ä¼šæŒ‰ç…§ &lt;a href="https://github.com/kubernetes/enhancements/issues/1440">KEP #1440&lt;/a> ç»§ç»­å®æ–½ã€‚&lt;/p>
&lt;p>å¢åŠ æ­¤å‘½ä»¤ä¸»è¦æ˜¯ç”±äºåœ¨ä¸ä¿®æ”¹ &lt;code>kubectl get&lt;/code> çš„å‰æä¸‹ï¼ŒæŸ¥çœ‹ &lt;code>event&lt;/code> æœ‰ä¸€äº›é™åˆ¶ï¼Œæ‰€ä»¥ç›´æ¥å¢åŠ  &lt;code>kubectl events&lt;/code> å‘½ä»¤å¯ä»¥æ›´æ–¹ä¾¿çš„å»è·å–åˆ°éœ€è¦çš„ä¿¡æ¯ï¼Œå°¤å…¶æ˜¯ event æ˜¯åœ¨ Kubernetes ä¸­ç»å¸¸éœ€è¦æŸ¥çœ‹çš„ä¸€ä¸ªä¿¡æ¯ã€‚&lt;code>kubectl get events&lt;/code> æ¯”è¾ƒå…¸å‹çš„ä¸€äº›é—®é¢˜, æ¯”å¦‚æ’åºï¼ˆè™½ç„¶å¯ä»¥é€šè¿‡åŠ å‚æ•°è§£å†³ï¼‰ï¼Œ watchï¼Œä»¥åŠæ— æ³•æŒ‰ç…§æ—¶é—´çº¿æ–¹å¼å»æŸ¥çœ‹ events ç­‰ã€‚&lt;/p>
&lt;p>å½“ç„¶ä»¥ä¸Šçš„è¿™äº›é—®é¢˜ä¹Ÿå¯ä»¥å‚è€ƒæˆ‘ä¹‹å‰çš„æ–‡ç«  &lt;a href="https://zhuanlan.zhihu.com/p/383795254">ã€Šæ›´ä¼˜é›…çš„ Kubernetes é›†ç¾¤äº‹ä»¶åº¦é‡æ–¹æ¡ˆã€‹&lt;/a> æ¥è§£å†³ã€‚&lt;/p>
&lt;p>ç°åœ¨ä¸»è¦æ˜¯å¢åŠ äº† &lt;code>--for&lt;/code> é€‰é¡¹ï¼Œå¯ä»¥ç›´æ¥æŒ‰ç…§å¯¹è±¡è¿›è¡Œè¿‡æ»¤ï¼Œåœ¨ä¸‹ä¸ªç‰ˆæœ¬ v1.23 ä¸­å°±å°†æ­£å¼å’Œå¤§å®¶è§é¢äº†ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a href="https://github.com/kubernetes/kubernetes/pull/105908">#105908 Â· kubernetes/kubernetes&lt;/a> ä½œä¸ºåœ¨ v1.21 ä¸­è¢«åºŸå¼ƒçš„ PSPï¼ˆPod Security Policyï¼‰çš„æ›¿ä»£å“ï¼ŒPod Security Admission Control åœ¨æ­¤ç‰ˆæœ¬ä¸­å®ç°äº†å¾ˆå¤šå†…å®¹ã€‚æ­¤ PR ä¸­ä¸ºè¢«å…äº Pod Security çš„ Pod æ·»åŠ äº† annotation ç”¨äºè§£é‡Šå¦‚ä½•/ä¸ºä»€ä¹ˆã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a href="https://github.com/kubernetes/kubernetes/pull/104909">#104909 Â· kubernetes/kubernetes&lt;/a> ä¿®æ­£äº†è·å– Pod QoS æ—¶çš„é€»è¾‘ã€‚åŸå…ˆçš„é€»è¾‘ä¸­ä»…åŒ…å«äº† &lt;code>pod.Spec.Containers&lt;/code> çš„éƒ¨åˆ†ï¼Œè€Œæ²¡æœ‰å¤„ç† &lt;code>pod.Spec.InitContainers&lt;/code> è¿™äº› InitContainer çš„éƒ¨åˆ†ï¼Œæ­¤æ¬¡ä¿®æ”¹å°†å®ƒä»¬éƒ½åŠ ä¸Šäº†ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a href="https://github.com/kubernetes/kubernetes/pull/104693">#104693 Â· kubernetes/kubernetes&lt;/a> åœ¨ &lt;code>PodSpec&lt;/code> ä¸­æ ¹æ® KEP-2808 å¢åŠ  &lt;code>OS&lt;/code> å­—æ®µï¼Œä»¥åŠä¸€äº›æ ¡éªŒï¼Œä¸»è¦æ˜¯ä¸ºäº†åŒºåˆ†æ˜¯å¦ä¸º Windows èŠ‚ç‚¹ç­‰ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;hr>
&lt;p>æ¬¢è¿è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://gitee.com/tlrr/awesome/raw/master/2020-9-9/1599632564572-mp-qrcode.png" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>GitOps åº”ç”¨å®è·µç³»åˆ— - Argo CD çš„åŸºæœ¬ä»‹ç»</title><link>https://moelove.info/2021/10/21/GitOps-%E5%BA%94%E7%94%A8%E5%AE%9E%E8%B7%B5%E7%B3%BB%E5%88%97-Argo-CD-%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D/</link><guid isPermaLink="true">https://moelove.info/2021/10/21/GitOps-%E5%BA%94%E7%94%A8%E5%AE%9E%E8%B7%B5%E7%B3%BB%E5%88%97-Argo-CD-%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D/</guid><pubDate>Thu, 21 Oct 2021 20:56:29 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å¼ æ™‹æ¶›ã€‚&lt;/p>
&lt;p>åœ¨ä¸Šä¸€ç¯‡&lt;a href="https://mp.weixin.qq.com/s?__biz=MzI2ODAwMzUwNA==&amp;amp;mid=2649296484&amp;amp;idx=1&amp;amp;sn=03e9d37f5919bf6702f3463644b3291c&amp;amp;chksm=f2eb9fbbc59c16ad41151faeacdccf5d9e9d52bde12e77d48234c87a837e07b90240153f4701&amp;amp;mpshare=1&amp;amp;scene=1&amp;amp;srcid=1021yuHEEAO2EHfV21mv0iU4&amp;amp;sharer_sharetime=1634745866724&amp;amp;sharer_shareid=ca2e51094588e06bf753d47ce6ce6894&amp;amp;exportkey=AV3eqjRIBjJyEyLC5rFwQiA%3D&amp;amp;pass_ticket=dKcOVN1krZPAqOSsYDQNdfDP5pZPyajrfnBNwCPn53J8GD0ry7ubzn6xT7tDLhOz&amp;amp;wx_header=0#rd">ã€GitOps åº”ç”¨å®è·µç³»åˆ— - ç»¼è¿°ï¼ˆä¸€ï¼‰ã€&lt;/a>ä¸­ï¼Œæˆ‘ä»‹ç»äº† GitOps çš„æ¦‚å¿µã€å¦‚ä½•å·¥ä½œä»¥åŠåŸºäº Pull å’Œ Push çš„æ¨¡å‹ç­‰å†…å®¹ã€‚æœ¬ç¯‡ï¼Œæˆ‘ä»¬é‡ç‚¹ä»‹ç»ç”¨äºå®æ–½ GitOps çš„å·¥å…· &lt;a href="https://argoproj.github.io/argo-cd/">ArgoCD&lt;/a> ã€‚&lt;/p>
&lt;h2 id="argo-cd-æ¦‚è§ˆ">Argo CD æ¦‚è§ˆ&lt;/h2>
&lt;p>&lt;img src="https://s2.loli.net/2021/12/19/XLMzJdCmGK12sWg.png" alt="img">&lt;/p>
&lt;p>2020 å¹´ 4 æœˆ 7 æ—¥ï¼ŒCNCF Technical Oversight Committee (TOC) æŠ•ç¥¨é€šè¿‡ Argo é¡¹ç›®è¿›å…¥ CNCF å­µåŒ–ã€‚&lt;/p>
&lt;p>å…¶å® Argo æ˜¯åœ¨ 2017 å¹´ç”± &lt;a href="https://www.applatix.com/">Applatix&lt;/a> å…¬å¸åˆ›å»ºçš„ï¼ˆè¿™å®¶å…¬å¸çš„ä¸»è¦äº§å“å’ŒæœåŠ¡ç›®å‰ä¸»è¦ä¸ AWS è¿›è¡Œæ·±åº¦èåˆï¼Œå½“ç„¶ä¹ŸåŒ…æ‹¬ä¸€äº›å¤šäº‘çš„æœåŠ¡ï¼‰ï¼Œ2018 å¹´åˆè¢« Intuit æ”¶è´­ã€‚ ä¹‹åï¼ŒBlackRock ä¸º Argo é¡¹ç›®è´¡çŒ®äº† Argo Events å­é¡¹ç›®ã€‚ä¸¤å®¶å…¬å¸éƒ½ç§¯æå‚ä¸é¡¹ç›®å’Œç¤¾åŒºçš„å¼€å‘å’ŒåŸ¹è‚²ä¸­ã€‚&lt;/p>
&lt;p>Argo åŠå…¶å­é¡¹ç›®æä¾›äº†ä¸€ç§ç®€å•çš„æ–¹æ³•ç®¡ç† Workflowï¼Œäº‹ä»¶å’Œåº”ç”¨ç¨‹åºã€‚æ‰€æœ‰ Argo å·¥å…·éƒ½é€šè¿‡ CRD çš„æ–¹å¼å®ç°ã€‚ä»–ä»¬å¯ä»¥ä½¿ç”¨æˆ–é›†æˆå…¶ä»– CNCF é¡¹ç›®ï¼Œå¦‚ gRPCã€Prometheusã€NATSã€Helm å’Œ CloudEventsã€‚&lt;/p>
&lt;p>Argo ç”Ÿæ€ç›®å‰ä¸»è¦ç”±å››ä¸ªå­é¡¹ç›®ç»„æˆï¼ŒåŒ…æ‹¬ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;strong>Argo Workflows&lt;/strong> -- ç¬¬ä¸€ä¸ª Argo é¡¹ç›®ï¼Œæ˜¯ Kubernetes çš„åŸç”Ÿ&lt;strong>å·¥ä½œæµå¼•æ“&lt;/strong>ï¼Œæ”¯æŒ DAG å’Œ step-based çš„å·¥ä½œæµï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>Argo Events&lt;/strong> -- Kubernetes ä¸Šçš„åŸºäºäº‹ä»¶çš„ä¾èµ–ç®¡ç†å™¨ï¼Œç”¨äºè§¦å‘ Kubernetes ä¸­çš„ Argo å·¥ä½œæµå’Œå…¶ä»–æ“ä½œã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>Argo CD&lt;/strong> -- æ˜¯ Argo ç¤¾åŒºå’Œ Intuit å¸¦æ¥çš„å¼€æºé¡¹ç›®ï¼Œæ”¯æŒåŸºäº GitOps çš„å£°æ˜æ€§éƒ¨ç½² Kubernetes èµ„æºã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>Argo Rollouts&lt;/strong> -- æ”¯æŒå£°æ˜å¼æ¸è¿›å¼äº¤ä»˜ç­–ç•¥ï¼Œä¾‹å¦‚ canary ã€blue-green å’Œæ›´å¤šå½¢å¼ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>Argo CD æ—¨åœ¨æä¾›ä¸€ä¸ª&lt;strong>å£°æ˜å¼æŒç»­äº¤ä»˜ (CD) å·¥å…·ã€‚&lt;strong>Argo CD æ”¯æŒå¤šç§é…ç½®ç®¡ç†å·¥å…·ï¼ŒåŒ…æ‹¬ ksonnet /jsonnetï¼Œkustomize å’Œ &lt;a href="https://github.com/helm/helm">Helm&lt;/a> ç­‰&lt;/strong>ã€‚&lt;strong>Argo CD æ‰©å±•äº†å£°æ˜å¼å’ŒåŸºäº Git çš„é…ç½®ç®¡ç†çš„ä¼˜åŠ¿ï¼Œä»¥åœ¨&lt;/strong>ä¸å½±å“å®‰å…¨æ€§å’Œåˆè§„æ€§çš„æƒ…å†µä¸‹åŠ é€Ÿåº”ç”¨ç¨‹åºçš„éƒ¨ç½²å’Œç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚&lt;/strong>&lt;/p>
&lt;h2 id="argo-cd-çš„é€‚ç”¨åœºæ™¯">Argo CD çš„é€‚ç”¨åœºæ™¯&lt;/h2>
&lt;ul>
&lt;li>
&lt;p>åº”ç”¨ç¨‹åºåŠå…¶éƒ¨ç½²ç¯å¢ƒçš„é…ç½®æ˜¯å£°æ˜æ€§çš„ï¼Œå¹¶ä¸”æ˜¯ç‰ˆæœ¬å¯æ§çš„ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>åº”ç”¨ç¨‹åºéƒ¨ç½²å’Œç”Ÿå‘½å‘¨æœŸç®¡ç†ç®€å•ã€å¯è‡ªåŠ¨å’Œå¯å®¡è®¡ï¼ˆä¼ä¸šå‹å¥½ï¼‰ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>åº”ç”¨ç¨‹åºéƒ¨ç½²å¿«é€Ÿã€å¯é å’Œå¹‚ç­‰ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>éœ€è¦æ£€æµ‹å¹¶çº æ­£ä¸ç‰ˆæœ¬æ§åˆ¶é…ç½®çš„ä»»ä½•åå·®ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å›æ»šç®€å•ï¼›&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="argo-cd-çš„ä¸»è¦åŠŸèƒ½">Argo CD çš„ä¸»è¦åŠŸèƒ½&lt;/h2>
&lt;ul>
&lt;li>
&lt;p>å¯æ­é…ä½¿ç”¨å„ç§é…ç½®ç®¡ç†å·¥å…·ï¼ˆå¦‚ ksonnet/jsonnetã€Helm å’Œ kustomizeï¼‰ä½¿åº”ç”¨ç¨‹åºä¸ Git ä¸­å®šä¹‰çš„ä¿æŒä¸€è‡´ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å°†åº”ç”¨ç¨‹åºè‡ªåŠ¨éƒ¨ç½²åˆ°æŒ‡å®šçš„ç›®æ ‡ç¯å¢ƒï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æŒç»­ç›‘æ§å·²éƒ¨ç½²çš„åº”ç”¨ç¨‹åºï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>åŸºäº Web å’Œ CLI çš„æ“ä½œï¼Œä»¥åŠåº”ç”¨ç¨‹åºå¯è§†åŒ–ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>éƒ¨ç½²æˆ–å›æ»šåˆ° Git ä»“åº“ä¸­æäº¤çš„åº”ç”¨ç¨‹åºçš„ä»»ä½•çŠ¶æ€ï¼ˆè¿™ä¹Ÿæ˜¯ä½¿ç”¨ Git è¿›è¡Œç‰ˆæœ¬ç®¡ç†çš„ä¸€å¤§å¥½å¤„ï¼‰ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>PreSyncã€Syncã€PostSync hooks ä»¥æ”¯æŒå¤æ‚çš„åº”ç”¨ç¨‹åºéƒ¨ç½²ç­–ç•¥ï¼ˆä¾‹å¦‚ï¼šblue/green ã€canary upgradesï¼‰ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>SSO é›†æˆï¼ˆOIDCã€LDAPã€SAML 2.0ã€GitLabã€Microsoftã€LinkedInï¼‰ï¼Œè¿™äº›æ˜¯ä¼ä¸šæ¯”è¾ƒéœ€è¦çš„åŠŸèƒ½ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Webhook é›†æˆï¼ˆGitHubã€BitBucketã€GitLabï¼‰ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¯ä»¥ç‹¬ç«‹ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºç°æœ‰ Pipeline çš„ä¸€éƒ¨åˆ†ä½¿ç”¨ï¼Œä¾‹å¦‚ä¸ Argo Workflowã€Jenkins ä»¥åŠ GitLab CI ç­‰é…åˆä½¿ç”¨ï¼›&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="argo-cd-æ¶æ„">Argo CD æ¶æ„&lt;/h2>
&lt;p>&lt;img src="https://s2.loli.net/2021/12/19/jql6DZiAV92XWGT.png" alt="img">&lt;/p>
&lt;p>ä»æ•´ä½“ä¸Šçœ‹ï¼ŒArgo CD æœ‰ä¸‰ä¸ªä¸»è¦çš„ç»„æˆéƒ¨åˆ†ï¼šAPI Server ã€Repository Server ã€Application Controllerã€‚&lt;/p>
&lt;h3 id="api-server">API Server&lt;/h3>
&lt;p>Argo CD çš„ API Server æ˜¯ä¸€ä¸ª gRPC/REST serverï¼Œå®ƒå…¬å¼€ Web UIã€CLI ä»¥åŠä¸€äº›å…¶ä»–åœºæ™¯éœ€è¦ç”¨åˆ°çš„ APIã€‚&lt;/p>
&lt;p>å®ƒä¸»è¦è¿›è¡Œä»¥ä¸‹å‡ ä¸ªå†…å®¹ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>åº”ç”¨ç¨‹åºç®¡ç†å’ŒçŠ¶æ€æŠ¥å‘Šï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>è°ƒç”¨åº”ç”¨ç¨‹åºæ“ä½œï¼ˆä¾‹å¦‚ï¼šåŒæ­¥ã€å›æ»šã€ç”¨æˆ·å®šä¹‰çš„æ“ä½œï¼‰ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>repository å’Œé›†ç¾¤ credential ç®¡ç†ï¼ˆå­˜ K8s secretsï¼‰ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>èº«ä»½éªŒè¯å’Œæˆæƒå§”æ‰˜ç»™å¤–éƒ¨èº«ä»½è®¤è¯ç»„ä»¶ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>RBACï¼ˆ&lt;strong>Role-based access control&lt;/strong> åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼‰ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Git webhook äº‹ä»¶çš„ listener/forwarderï¼›&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="repository-server">Repository Server&lt;/h3>
&lt;p>Repository Server æ˜¯ä¸€ä¸ªå†…éƒ¨æœåŠ¡ï¼Œå®ƒè´Ÿè´£ä¿å­˜åº”ç”¨ç¨‹åº Git ä»“åº“çš„æœ¬åœ°ç¼“å­˜ï¼Œå¹¶è´Ÿè´£ç”Ÿæˆå’Œè¿”å›å¯ä¾› Kubernetes ä½¿ç”¨çš„ manifestsï¼Œå®ƒæ¥å—çš„è¾“å…¥ä¿¡æ¯ä¸»è¦æœ‰ä»¥ä¸‹å†…å®¹ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ä»“åº“åœ°å€ï¼ˆURLï¼‰&lt;/p>
&lt;/li>
&lt;li>
&lt;p>revisionï¼ˆcommit, tag, branchï¼‰&lt;/p>
&lt;/li>
&lt;li>
&lt;p>åº”ç”¨ç¨‹åºè·¯å¾„&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æ¨¡æ¿çš„ç‰¹å®šè®¾ç½®ï¼šæ¯”å¦‚ helm values.yaml ç­‰&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="application-controller">Application Controller&lt;/h3>
&lt;p>Application Controller æ˜¯ä¸€ä¸ª Kubernetes controllerï¼Œå®ƒæŒç»­ç›‘å¬æ­£åœ¨è¿è¡Œçš„åº”ç”¨ç¨‹åºå¹¶å°†å½“å‰çš„å®æ—¶çŠ¶æ€ä¸æ‰€éœ€çš„ç›®æ ‡çŠ¶æ€ï¼ˆå¦‚ repo ä¸­æŒ‡å®šçš„ï¼‰è¿›è¡Œæ¯”è¾ƒã€‚å®ƒæ£€æµ‹ OutOfSync åº”ç”¨ç¨‹åºçŠ¶æ€å¹¶æœ‰é€‰æ‹©åœ°é‡‡å–çº æ­£æªæ–½ã€‚å®ƒè´Ÿè´£ä¸ºç”Ÿå‘½å‘¨æœŸäº‹ä»¶ï¼ˆPreSyncã€Syncã€PostSyncï¼‰è°ƒç”¨ä»»ä½•ç”¨æˆ·å®šä¹‰çš„ hooksã€‚&lt;/p>
&lt;h2 id="argo-cd-çš„ä¸»è¦ç‰¹æ€§">Argo CD çš„ä¸»è¦ç‰¹æ€§&lt;/h2>
&lt;p>è‡ª2019å¹´3æœˆ17å·å‘å¸ƒäº† &lt;a href="https://github.com/argoproj/argo-cd/releases/tag/v1.0.0">v1.0.0&lt;/a> ç‰ˆæœ¬å¼€å§‹ï¼Œåˆ°ç°åœ¨ï¼ŒArgo CDå·²ç»å…¨é¢è¿›å…¥äº† v2.x æ—¶ä»£ï¼Œå½“å‰æœ€æ–°çš„ç‰ˆæœ¬æ˜¯ v2.1.5ã€‚&lt;/p>
&lt;p>åœ¨ 2.0 ä¸­å¼•å…¥äº†Pods ViewåŠŸèƒ½ã€é‡å†™äº†æ—¥å¿—å¯è§†åŒ–ã€æ–°å¢äº†é€šçŸ¥æ¨ªå¹…åŠŸèƒ½ã€è¿˜æœ‰å¾ˆå¤šåå°æ“ä½œåŠè‡ªå®šä¹‰æ“ä½œï¼Œå¹¶ä¸”è‡´åŠ›äºæ‰“é€  Argo CD Core ï¼ˆè½»é‡çº§ Argo CD å‘è¡Œç‰ˆï¼Œä»…æ‰“åŒ…æ ¸å¿ƒ GitOps åŠŸèƒ½ï¼Œä¾èµ–Kubernetes API/RBAC ä¸º UI å’Œ CLI æä¾›æ”¯æŒï¼‰ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>Pods View ï¼šå¯¹äºæ‹¥æœ‰æ•°ç™¾ä¸ª Pod çš„åº”ç”¨ç¨‹åºç‰¹åˆ«æœ‰ç”¨ã€‚å®ƒæ²¡æœ‰å¯è§†åŒ–åº”ç”¨ç¨‹åºçš„æ‰€æœ‰ Kubernetes èµ„æºï¼Œè€Œæ˜¯ä»…æ˜¾ç¤º Kubernetes pod å’Œå¯†åˆ‡ç›¸å…³çš„èµ„æºã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æ–°æ—¥å¿—å¯è§†åŒ–ï¼šæ”¯æŒåˆ†é¡µã€è¿‡æ»¤ã€ç¦ç”¨/å¯ç”¨æ—¥å¿—æµçš„èƒ½åŠ›ï¼Œç”šè‡³ä¸ºç»ˆç«¯çˆ±å¥½è€…æä¾›æš—æ¨¡å¼ã€‚æ”¯æŒæŸ¥çœ‹å¤šä¸ªéƒ¨ç½² Pod çš„èšåˆæ—¥å¿—ï¼ŒArgo CD CLI ä¹Ÿæ”¯æŒæ—¥å¿—æµã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>UIé€šçŸ¥æ¨ªå¹…åŠŸèƒ½ï¼šä½¿ç”¨ConfigMap ä¸­çš„ui.bannercontentå’Œui.bannerurlå±æ€§æŒ‡å®šé€šçŸ¥æ¶ˆæ¯å’Œå¯é€‰ URL argocd-cmã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>åå°æ“ä½œï¼šèµ„æºçš„deletion/pruningã€ä»…åŒæ­¥æ›´æ”¹çš„èµ„æºã€Prune Lastã€å¼•å…¥äº†å¯¹ &lt;a href="https://github.com/external-secrets/kubernetes-external-secrets">Sealed-&lt;/a>&lt;a href="https://github.com/bitnami-labs/sealed-secrets">secrets&lt;/a>ã€&lt;a href="https://github.com/external-secrets/kubernetes-external-secrets">kubernetes-external-secrets&lt;/a> å’Œ &lt;a href="https://github.com/strimzi">strimzi&lt;/a> CRD çš„å¥åº·æ£€æŸ¥ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="éƒ¨ç½²-argo-cd">éƒ¨ç½² Argo CD&lt;/h2>
&lt;p>Argo CD æœ‰å››ç§å®‰è£…æ–¹å¼ï¼šå¤šç§Ÿæˆ·ï¼ˆmulti-tenantï¼‰ã€ core ã€è‡ªå®šä¹‰ ã€Helmã€‚&lt;/p>
&lt;h3 id="å¤šç§Ÿæˆ·multi-tenant">å¤šç§Ÿæˆ·ï¼ˆmulti-tenantï¼‰&lt;/h3>
&lt;p>å¤šç§Ÿæˆ·æ˜¯ Argo CD ä½¿ç”¨æœ€å¤šçš„éƒ¨ç½²æ–¹å¼ã€‚ç”¨æˆ·å¯ä»¥ä½¿ç”¨ Web UI æˆ– argocd CLI é€šè¿‡ API Serverè®¿é—® Argo CD ã€‚&lt;/p>
&lt;p>è¯¥ argocd CLI å¿…é¡»å…ˆæ‰§è¡Œ &lt;code>argocd login &amp;lt;server-host&amp;gt;&lt;/code>å‘½ä»¤ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-plain" data-lang="plain">argocd login SERVER [flags]
## Login to Argo CD using a username and password
argocd login cd.argoproj.io
## Login to Argo CD using SSO
argocd login cd.argoproj.io --sso
## Configure direct access using Kubernetes API server
argocd login cd.argoproj.io --core
&lt;/code>&lt;/pre>&lt;/div>&lt;p>åœ¨é¡¹ç›®çš„ GitHub ä»“åº“ä¸­é»˜è®¤æä¾›äº†ä¸¤ç§éƒ¨ç½²æ–¹å¼ï¼ˆmanifestsï¼‰ï¼š&lt;/p>
&lt;h4 id="éé«˜å¯ç”¨">éé«˜å¯ç”¨&lt;/h4>
&lt;p>è¿™ç§ç±»å‹çš„å®‰è£…é€šå¸¸ç”¨äºæ¼”ç¤ºå’Œæµ‹è¯•ã€‚ï¼ˆä¸æ¨èç”¨äºç”Ÿäº§ï¼‰&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;a href="https://github.com/argoproj/argo-cd/blob/master/manifests/install.yaml">install.yaml&lt;/a> - å…·æœ‰é›†ç¾¤ç®¡ç†å‘˜æƒé™çš„æ ‡å‡† Argo CD å®‰è£…ã€‚å¯ä½¿ç”¨ Argo CD åœ¨å…¶è¿è¡Œçš„åŒä¸€é›†ç¾¤ä¸­éƒ¨ç½²åº”ç”¨ç¨‹åºï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨è¾“å…¥çš„ credentials éƒ¨ç½²åˆ°å¤–éƒ¨é›†ç¾¤ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a href="https://github.com/argoproj/argo-cd/blob/master/manifests/namespace-install.yaml">namespace-install.yaml&lt;/a> - åªéœ€è¦å‘½åç©ºé—´çº§åˆ«çš„æƒé™ï¼ˆä¸éœ€è¦é›†ç¾¤ç®¡ç†å‘˜æƒé™ï¼‰ã€‚ä½†è¿™ç§å®‰è£…çš„è¯ Argo CD ä¸èƒ½åœ¨å…¶æ‰€è¿è¡Œçš„åŒä¸€é›†ç¾¤ä¸­éƒ¨ç½²åº”ç”¨ç¨‹åºï¼Œå¹¶ä¸”å°†ä»…ä¾èµ–äºè¾“å…¥çš„å¤–éƒ¨é›†ç¾¤ credentials ã€‚&lt;/p>
&lt;p>æ³¨æ„ï¼šArgo CD CRD ä¸åŒ…å«åœ¨ &lt;a href="https://github.com/argoproj/argo-cd/blob/master/manifests/namespace-install.yaml">namespace-install.yaml ä¸­&lt;/a> å¿…é¡»å•ç‹¬å®‰è£…ã€‚CRD manifests ä½äº&lt;a href="https://github.com/argoproj/argo-cd/blob/master/manifests/crds">manifests/crds&lt;/a>ç›®å½•ä¸­ã€‚ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®‰è£…å®ƒä»¬ï¼š&lt;/p>
&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">kubectl apply -k https://github.com/argoproj/argo-cd/manifests/crds&lt;span class="se">\?&lt;/span>ref&lt;span class="se">\=&lt;/span>stable
&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="é«˜å¯ç”¨">é«˜å¯ç”¨&lt;/h4>
&lt;p>å¼ºçƒˆå»ºè®®ç”Ÿäº§ç¯å¢ƒä½¿ç”¨é«˜å¯ç”¨æ–¹å¼å®‰è£…ã€‚&lt;/p>
&lt;p>bundle åŒ…å«ç›¸åŒçš„ç»„ä»¶ï¼Œä½†é’ˆå¯¹é«˜å¯ç”¨æ€§å’Œå¼¹æ€§è¿›è¡Œäº†è°ƒæ•´ã€‚&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://github.com/argoproj/argo-cd/blob/master/manifests/ha/install.yaml">ha/install.yaml&lt;/a> - ä¸ä¸Šæ–‡ä¸­æåˆ°çš„ install.yaml ç›¸åŒï¼Œä½†é…ç½®äº†ç›¸å…³ç»„ä»¶çš„å¤šä¸ªå‰¯æœ¬ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/argoproj/argo-cd/blob/master/manifests/ha/namespace-install.yaml">ha/namespace-install.yaml&lt;/a> - ä¸ä¸Šæ–‡æåˆ°çš„ namespace-install.yaml ç›¸åŒï¼Œä½†é…ç½®äº†ç›¸å…³ç»„ä»¶çš„å¤šä¸ªå‰¯æœ¬ï¼›&lt;/li>
&lt;/ul>
&lt;h3 id="core">core&lt;/h3>
&lt;p>core å®‰è£…æœ€é€‚åˆç‹¬ç«‹ä½¿ç”¨ Argo CD ä¸”ä¸éœ€è¦å¤šç§Ÿæˆ·åŠŸèƒ½çš„é›†ç¾¤ç®¡ç†å‘˜ã€‚&lt;/p>
&lt;p>æ­¤å®‰è£…åŒ…æ‹¬è¾ƒå°‘çš„ç»„ä»¶ï¼Œå¹¶ä¸”æ›´æ˜“äºè®¾ç½®ã€‚bundle ä¸åŒ…æ‹¬ API Serveræˆ– UIï¼Œå¹¶åªå®‰è£…æ¯ä¸ªç»„ä»¶çš„è½»é‡çº§ï¼ˆé HAï¼‰ç‰ˆæœ¬ã€‚&lt;/p>
&lt;p>ç”¨æˆ·éœ€è¦ Kubernetes è®¿é—®æƒé™æ¥ç®¡ç† Argo CDã€‚è¯¥ argocd CLI å¿…é¡»ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤è¿›è¡Œé…ç½®ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-plain" data-lang="plain">kubectl config set-context --current --namespace=argocd
argocd login --core
&lt;/code>&lt;/pre>&lt;/div>&lt;p>Web UI ä¹Ÿå¯ä»¥ä½¿ç”¨ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¯åŠ¨ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-plain" data-lang="plain">argocd admin dashboard
&lt;/code>&lt;/pre>&lt;/div>&lt;p>å…·ä½“çš„ manifests å¯¹åº”äºä»“åº“ä¸­çš„ &lt;a href="https://github.com/argoproj/argo-cd/blob/master/manifests/core-install.yaml">core-install.yaml&lt;/a> ã€‚&lt;/p>
&lt;h3 id="è‡ªå®šä¹‰å®‰è£…">è‡ªå®šä¹‰å®‰è£…&lt;/h3>
&lt;p>Argo CD manifests ä¹Ÿå¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰å®‰è£…ã€‚å»ºè®®å°† manifests ä½œä¸ºè¿œç¨‹èµ„æºåŒ…å«åœ¨å†…ï¼Œå¹¶ä½¿ç”¨ Kustomize è¡¥ä¸åº”ç”¨å…¶ä»–è‡ªå®šä¹‰ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-plain" data-lang="plain">apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
namespace: argocd
resources:
- https://raw.githubusercontent.com/argoproj/argo-cd/v2.0.4/manifests/ha/install.yaml
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="helm">Helm&lt;/h3>
&lt;p>Argo CD å¯ä»¥ä½¿ç”¨&lt;a href="https://helm.sh/">Helm&lt;/a>å®‰è£…ã€‚Helm chart ç›®å‰ç”±ç¤¾åŒºç»´æŠ¤ï¼Œè®¿é—® &lt;a href="https://github.com/argoproj/argo-helm/tree/master/charts/argo-cd">https://github.com/argoproj/argo-helm/tree/master/charts/argo-cd&lt;/a> è·å–å³å¯ï¼Œæ­¤å¤„ä¸å†æ·»åŠ ç¤ºä¾‹ã€‚&lt;/p>
&lt;h2 id="argo-cd-çš„-secret-ç®¡ç†">Argo CD çš„ Secret ç®¡ç†&lt;/h2>
&lt;p>Argo CD æ²¡æœ‰æ˜ç¡®é™åˆ¶ Secret ç®¡ç†çš„æ–¹å¼ã€‚è¿™é‡Œç½—åˆ—äº› GitOps çš„ç®¡ç† Secret çš„æ–¹å¼ï¼Œå¯¹å…¶ä»–åœºæ™¯ä¹Ÿé€‚ç”¨ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;a href="https://www.vaultproject.io/">Hashicorp Vault&lt;/a> æ¨èï¼Œè¿™æ˜¯ä¸€ç§æ¯”è¾ƒé€šç”¨çš„æ–¹æ¡ˆï¼Œå¹¶ä¸”åº”ç”¨åœºæ™¯å¾ˆå¹¿æ³›ã€‚ï¼ˆhttps://www.vaultproject.io/ï¼‰&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a href="https://github.com/bitnami-labs/sealed-secrets">Bitnami Sealed Secrets&lt;/a> å°† Secret åŠ å¯†ä¸ºå¯å®‰å…¨å­˜å‚¨çš„ SealedSecretï¼Œç”šè‡³å¯ä»¥å­˜å‚¨åˆ°å…¬å…±åº“ä¸­ï¼›SealedSecret åªèƒ½ç”±è¿è¡Œåœ¨ç›®æ ‡é›†ç¾¤ä¸­çš„æ§åˆ¶å™¨è§£å¯†ï¼Œå…¶ä»–äººï¼ˆç”šè‡³åŸä½œè€…ï¼‰éƒ½æ— æ³•ä» SealedSecret ä¸­è·å–åŸå§‹ Secretã€‚ï¼ˆhttps://github.com/bitnami-labs/sealed-secretsï¼‰ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a href="https://github.com/banzaicloud/bank-vaults">Banzai Cloud Bank-Vaults&lt;/a> ä¸º Vault æä¾›å„ç§å·¥å…·ï¼Œä½¿ Hashicorp Vault çš„ä½¿ç”¨å’Œæ“ä½œæ›´å®¹æ˜“ã€‚å®ƒæ˜¯å®˜æ–¹ Vault å®¢æˆ·ç«¯çš„å°è£…ï¼Œå…·æœ‰è‡ªåŠ¨ä»¤ç‰Œæ›´æ–°å’Œå†…ç½® Kubernetes æ”¯æŒã€åŸºäºGolang çš„å®¢æˆ·ç«¯çš„åŠ¨æ€æ•°æ®åº“å‡­æ®æä¾›ç¨‹åºã€‚å®ƒæœ‰ä¸€ä¸ª CLI å·¥å…·æ¥è‡ªåŠ¨åˆå§‹åŒ–ã€è§£å°å’Œé…ç½® Vaultã€‚å®ƒè¿˜æä¾›äº†ä¸€ä¸ªç”¨äºé…ç½®çš„ Kubernetes operatorï¼Œä»¥åŠä¸€ä¸ªç”¨äºæ³¨å…¥æœºå¯†çš„ mutating webhookã€‚ï¼ˆhttps://github.com/banzaicloud/bank-vaultsï¼‰&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a href="https://github.com/jkroepke/helm-secrets">Helm Secrets&lt;/a> ä¸Argo CDçš„é›†æˆæ˜¯ä» helm-secrets v3.9.0 å¼€å§‹å¯ç”¨;&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a href="https://github.com/IBM/argocd-vault-plugin">argocd-vault-plugin&lt;/a> ä»å„ç§ secrets ç®¡ç†å·¥å…·ï¼ˆHashiCorp Vaultã€IBM Cloud Secrets Managerã€AWS Secrets Manager ç­‰ï¼‰ä¸­æ£€ç´¢ secrets å¹¶å°†å®ƒä»¬æ³¨å…¥åˆ° Kubernetes èµ„æºä¸­ï¼ˆhttps://github.com/IBM/argocd-vault-pluginï¼‰ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a href="https://github.com/kubernetes-sigs/kustomize/blob/fd7a353df6cece4629b8e8ad56b71e30636f38fc/examples/kvSourceGoPlugin.md#secret-values-from-anywhere">Kustomize secret generator plugins&lt;/a> Kubernetes &lt;a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.13/#configmap-v1-core">ConfigMaps&lt;/a>å’Œ&lt;a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.13/#secret-v1-core">Secrets&lt;/a>éƒ½æ˜¯ key:value (KV) æ˜ å°„ã€‚kustomize æœ‰ä¸‰ç§ä¸åŒçš„æ–¹æ³•æ¥ä»æœ¬åœ°æ–‡ä»¶ç”Ÿæˆ secretsï¼Œè¯¦ç»†å¯æŸ¥çœ‹é“¾æ¥ ã€‚ï¼ˆhttps://github.com/kubernetes-sigs/kustomize/blob/fd7a353df6cece4629b8e8ad56b71e30636f38fc/examples/kvSourceGoPlugin.md#secret-values-from-anywhereï¼‰&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a href="https://github.com/mumoshu/aws-secret-operator">aws-secret-operator&lt;/a> ä¸€ä¸ª Kubernetes operatorï¼Œå¯æ ¹æ® AWS Secrets Manager ä¸­å­˜å‚¨çš„å†…å®¹è‡ªåŠ¨åˆ›å»ºå’Œæ›´æ–° Kubernetes secretsã€‚aws-secret-operator è‡ªå®šä¹‰èµ„æºå°† AWS secretsæ˜ å°„åˆ° Kubernetes ã€‚ï¼ˆhttps://github.com/mumoshu/aws-secret-operatorï¼‰&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a href="https://github.com/kubernetes-sigs/secrets-store-csi-driver">secrets-store-csi-driver&lt;/a> æ˜¯ä¸€ä¸ªåˆ©ç”¨ CSI æ¥å£ï¼Œå°†å¯†é’¥ä¿¡æ¯æŒ‚è½½è¿› Pod çš„å·¥å…·ã€‚æ”¯æŒå¤šç§å¯†é’¥å­˜å‚¨æ–¹å¼ï¼Œæ¯”å¦‚ Vaultï¼ŒGCPï¼ŒAWSï¼ŒAzure ç­‰ï¼›&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="èµ„æºå¥åº·è¯„ä¼°">èµ„æºå¥åº·è¯„ä¼°&lt;/h2>
&lt;p>Argo CD ä¸ºå‡ ç§æ ‡å‡†çš„ Kubernetes èµ„æºæä¾›äº†å†…ç½®çš„å¥åº·è¯„ä¼°ï¼Œç„¶åå°†è¿™äº›è¯„ä¼°ä½œä¸ºä¸€ä¸ªæ•´ä½“å‘ˆç°åœ¨æ•´ä½“åº”ç”¨ç¨‹åºå¥åº·çŠ¶æ€ä¸­ã€‚&lt;/p>
&lt;p>å¯¹ä»¥ä¸‹å‡ ç§ç±»å‹çš„ Kubernetes èµ„æºè¿›è¡Œæ£€æŸ¥ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>Deploymentï¼ŒReplicaSetï¼ŒStatefulSetï¼ŒDaemonSet&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Service&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Ingress&lt;/p>
&lt;/li>
&lt;li>
&lt;p>PersistentVolumeClaim&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Argocd App&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>ä¹Ÿå¯ä»¥æ·»åŠ è‡ªå®šä¹‰çš„å¥åº·æ£€æŸ¥ï¼ŒArgo CD æ”¯æŒç”¨ &lt;a href="https://www.lua.org/">Lua&lt;/a> ç¼–å†™è‡ªå®šä¹‰å¥åº·æ£€æŸ¥ï¼Œæ”¯æŒä¸¤ç§é…ç½®æ–¹å¼ï¼š&lt;/p>
&lt;p>1ï¼‰ åœ¨argocd-cm è¿™ä¸ª ConfigMap ä¸­å®šä¹‰è‡ªå®šä¹‰å¥åº·æ£€æŸ¥&lt;/p>
&lt;p>å¯ä»¥åœ¨ &lt;code>argocd-cm&lt;/code> çš„ &lt;code>resource.customizations.health.&amp;lt;group_kind&amp;gt;&lt;/code>å­—æ®µä¸­å®šä¹‰è‡ªå®šä¹‰å¥åº·æ£€æŸ¥ã€‚&lt;/p>
&lt;p>2ï¼‰ æ†ç»‘åˆ° Argo CD ä¸­ã€‚è‡ªå®šä¹‰å¥åº·æ£€æŸ¥è„šæœ¬ä½äº &lt;a href="https://github.com/argoproj/argo-cd/tree/master/resource_customizations">https://github.com/argoproj/argo-cd/tree/master/resource_customizations&lt;/a> ç›®å½•ä¸­ã€‚&lt;/p>
&lt;p>ä»¥ä¸Šå°±æ˜¯å…³äº Argo CD çš„æ ¸å¿ƒå†…å®¹äº†ï¼Œä¸‹ä¸€ç¯‡æˆ‘ä»¬å°†è¿›è¡Œ Argo CD çš„å®è·µã€‚æ¬¢è¿å¤§å®¶ç»§ç»­å…³æ³¨å’Œåé¦ˆï¼&lt;/p>
&lt;hr>
&lt;p>æ¬¢è¿è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://gitee.com/tlrr/awesome/raw/master/2020-9-9/1599632564572-mp-qrcode.png" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category><category domain="https://moelove.info/tags/GitOps/">GitOps</category></item><item><title>GitOps åº”ç”¨å®è·µç³»åˆ— - ç»¼è¿°</title><link>https://moelove.info/2021/10/19/GitOps-%E5%BA%94%E7%94%A8%E5%AE%9E%E8%B7%B5%E7%B3%BB%E5%88%97-%E7%BB%BC%E8%BF%B0/</link><guid isPermaLink="true">https://moelove.info/2021/10/19/GitOps-%E5%BA%94%E7%94%A8%E5%AE%9E%E8%B7%B5%E7%B3%BB%E5%88%97-%E7%BB%BC%E8%BF%B0/</guid><pubDate>Tue, 19 Oct 2021 20:56:29 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å¼ æ™‹æ¶›ã€‚&lt;/p>
&lt;p>æ¥ä¸‹æ¥ä¼šä¸ºå¤§å®¶å¸¦æ¥ä¸€ä¸ª GitOps çš„åº”ç”¨å®è·µç³»åˆ—æ–‡ç« ï¼Œè¿™æ˜¯ç¬¬ä¸€ç¯‡ã€‚&lt;/p>
&lt;h1 id="ä»€ä¹ˆæ˜¯-gitops">ä»€ä¹ˆæ˜¯ GitOps&lt;/h1>
&lt;p>é¦–å…ˆæˆ‘ä»¬æ¥äº†è§£ä¸‹ GitOpsï¼š&lt;/p>
&lt;p>GitOps æœ€æ—©æ˜¯åœ¨2017å¹´ç”± Weaveworks åˆ›ç«‹æå‡ºï¼Œå®ƒæ˜¯ä¸€ç§è¿›è¡Œ Kubernetes é›†ç¾¤ç®¡ç†å’Œåº”ç”¨ç¨‹åºäº¤ä»˜çš„æ–¹å¼ã€‚ GitOps ä½¿ç”¨ Git ä½œä¸ºå£°æ˜æ€§åŸºç¡€è®¾æ–½å’Œåº”ç”¨ç¨‹åºçš„å•ä¸€äº‹å®æ¥æºã€‚ GitOps çš„æ ¸å¿ƒæ€æƒ³æ˜¯æ‹¥æœ‰ä¸€ä¸ª Git repositoryï¼ŒåŒ…å«ç›®æ ‡ç¯å¢ƒä¸­å½“å‰æ‰€éœ€åŸºç¡€è®¾æ–½çš„&lt;strong>å£°æ˜æ€§&lt;/strong>æè¿°ï¼Œä»¥åŠä½¿ç›®æ ‡ç¯å¢ƒä¸ Git repository ä¸­æè¿°çš„çŠ¶æ€ç›¸åŒ¹é…çš„è‡ªåŠ¨åŒ–è¿‡ç¨‹ã€‚å€ŸåŠ© GitOpsï¼Œå¯ä»¥é’ˆå¯¹ Git repository ä¸é›†ç¾¤ä¸­è¿è¡Œçš„å†…å®¹ä¹‹é—´çš„ä»»ä½•å·®å¼‚å‘å‡ºè­¦æŠ¥ï¼Œå¦‚æœå­˜åœ¨å·®å¼‚ï¼ŒKubernetes reconcilersä¼šæ ¹æ®æƒ…å†µè‡ªåŠ¨æ›´æ–°æˆ–å›æ»šé›†ç¾¤ã€‚ ä»¥ Git ä½œä¸º pipeline çš„ä¸­å¿ƒï¼Œå¼€å‘äººå‘˜å¯ä»¥ä½¿ç”¨è‡ªå·±ç†Ÿæ‚‰çš„å·¥å…·å‘å‡ºPRï¼Œä»¥åŠ é€Ÿå’Œç®€åŒ– Kubernetes ä¸­åº”ç”¨ç¨‹åºéƒ¨ç½²å’Œæ“ä½œä»»åŠ¡ã€‚&lt;/p>
&lt;p>è¿™ä½¿å¾— GitOps åœ¨ Twitter å’Œ KubeCon ä¸Šå¼•èµ·äº†ä¸å°çš„è½°åŠ¨ã€‚&lt;/p>
&lt;p>&lt;img src="https://i.loli.net/2021/11/02/diSXjoQ6TGONA8f.png" alt="img">&lt;/p>
&lt;p>è¿™é‡Œè¯´ä¸€ä¸‹Weaveworks è¿™å®¶å…¬å¸ï¼Œè¿™æ˜¯ä¸€å®¶ä¸ºå¼€å‘äººå‘˜æä¾›æœ€é«˜æ•ˆçš„æ–¹å¼æ¥è¿æ¥ã€è§‚å¯Ÿå’Œæ§åˆ¶ Docker å®¹å™¨çš„å…¬å¸ã€‚åœ¨å®˜ç½‘ä¸Šï¼Œæˆ‘ä»¬èƒ½çœ‹åˆ°ï¼ŒGitOps å·¥ä½œæµçš„åŸåˆ™å’Œæ¨¡å¼ï¼Œå¦‚ä½•å®ç°å®ƒä»¬åœ¨ç”Ÿäº§ä¸­å¤§è§„æ¨¡è¿è¡Œ Kubernetesï¼Œ ä»¥åŠGitOps å’ŒåŸºç¡€è®¾æ–½å³ä»£ç  (IAC) é…ç½®ç®¡ç†å·¥å…·ä¹‹é—´çš„åŒºåˆ«å’Œæœ€ä½³å®è·µç­‰ç­‰ã€‚https://www.weave.works/technologies/gitops/&lt;/p>
&lt;p>K8Sçš„åˆ›å§‹äººä¹‹ä¸€ï¼š&lt;a href="https://twitter.com/kelseyhightower/status/953638870888849408">Kelsey Hightower&lt;/a> æ›¾å‘æ¨æ–‡è¯„è®ºè¿‡ GitOpsæ˜¯åŸºäºå£°æ˜å¼åŸºç¡€è®¾æ–½çš„ç‰ˆæœ¬åŒ– CI/CDï¼Œ åœæ­¢è„šæœ¬åŒ–æ“ä½œï¼Œå¼€å§‹ï¼ˆè‡ªåŠ¨åŒ–ï¼‰åˆ†å‘ã€‚&lt;/p>
&lt;h1 id="gitops-æ˜¯å¦‚ä½•å·¥ä½œçš„å‘¢">GitOps æ˜¯å¦‚ä½•å·¥ä½œçš„å‘¢ï¼Ÿ&lt;/h1>
&lt;h2 id="æŠŠç¯å¢ƒé…ç½®ä½œä¸º-git-repository">æŠŠç¯å¢ƒé…ç½®ä½œä¸º Git repository&lt;/h2>
&lt;p>GitOps ä»¥ä»£ç åº“ä¸ºæ ¸å¿ƒæ¥ç»„ç»‡éƒ¨ç½²ã€‚ æˆ‘ä»¬éœ€è¦è‡³å°‘æœ‰ä¸¤ä¸ªä»“åº“ï¼šåº”ç”¨ç¨‹åºåº“å’Œç¯å¢ƒé…ç½®åº“ã€‚ åº”ç”¨ç¨‹åºåº“åŒ…å«åº”ç”¨ç¨‹åºçš„æºä»£ç å’Œéƒ¨ç½²åº”ç”¨ç¨‹åºçš„ manifestsã€‚ ç¯å¢ƒé…ç½®åº“åŒ…å«éƒ¨ç½²ç¯å¢ƒå½“å‰æ‰€éœ€åŸºç¡€æ¶æ„çš„æ‰€æœ‰éƒ¨ç½²manifestsã€‚ å®ƒæè¿°äº†å“ªäº›åº”ç”¨ç¨‹åºå’ŒåŸºç¡€è®¾æ–½æœåŠ¡ï¼ˆæ¶ˆæ¯ä»£ç†ã€æœåŠ¡ç½‘æ ¼ã€ç›‘æ§å·¥å…·ç­‰ï¼‰åº”è¯¥åœ¨éƒ¨ç½²ç¯å¢ƒä¸­ä»¥ä½•ç§é…ç½®å’Œç‰ˆæœ¬è¿è¡Œç­‰å†…å®¹ã€‚&lt;/p>
&lt;h2 id="åŸºäº-push-ä¸åŸºäº-pull-çš„éƒ¨ç½²">åŸºäº push ä¸åŸºäº pull çš„éƒ¨ç½²&lt;/h2>
&lt;p>ä¸¤ç§éƒ¨ç½²ç±»å‹ä¹‹é—´çš„åŒºåˆ«åœ¨äºå¦‚ä½•ç¡®ä¿éƒ¨ç½²ç¯å¢ƒä¸æ‰€éœ€çš„åŸºç¡€æ¶æ„ç›¸åŒã€‚è¿™é‡Œæ¨èï¼Œ&lt;strong>é¦–é€‰åŸºäº pull çš„æ–¹æ³•&lt;/strong>ï¼Œå®ç° GitOps æ›´å®‰å…¨ã€ä¹Ÿæœ‰å¾ˆå¤šå·²æœ‰çš„æœ€ä½³å®è·µæ¥å€Ÿé‰´ã€‚&lt;/p>
&lt;h3 id="åŸºäº-pull-çš„éƒ¨ç½²">åŸºäº pull çš„éƒ¨ç½²&lt;/h3>
&lt;p>ä¼ ç»Ÿçš„ CI/CD pipelineç”±å¤–éƒ¨äº‹ä»¶è§¦å‘ï¼Œæ¯”å¦‚æ–°ä»£ç è¢«æ¨é€åˆ°åº”ç”¨ç¨‹åºåº“æ—¶ï¼Œå°±è§¦å‘äº†ã€‚&lt;/p>
&lt;p>è€ŒåŸºäº Pull çš„éƒ¨ç½²æ–¹æ³•ï¼Œå¼•å…¥äº†operatorã€‚ å®ƒé€šè¿‡ä¸æ–­å°†ç¯å¢ƒé…ç½®åº“ä¸­çš„æœŸæœ›çŠ¶æ€ä¸éƒ¨ç½²ç¯å¢ƒä¸­çš„å®é™…çŠ¶æ€è¿›è¡Œæ¯”è¾ƒæ¥æ¥ç®¡pipelineçš„è§’è‰²ã€‚ å½“å‘ç°å·®å¼‚æ—¶ï¼Œoperatorä¼šæ›´æ–°éƒ¨ç½²ç¯å¢ƒä¸­çš„çŠ¶æ€ä»¥åŒ¹é…ç¯å¢ƒé…ç½®åº“ã€‚ æ­¤å¤–ï¼Œå®ƒè¿˜å¯ä»¥ç›‘æ§ image registry ï¼Œä»¥æŸ¥æ‰¾è¦éƒ¨ç½²çš„æ–°é•œåƒç‰ˆæœ¬ã€‚&lt;/p>
&lt;p>&lt;img src="https://i.loli.net/2021/11/02/XwlgxTj6cBUYdaf.png" alt="img">&lt;/p>
&lt;p>åŸºäº pull æ¨¡å‹çš„éƒ¨ç½²ä¸ä»…èƒ½åšåˆ°ç¯å¢ƒé…ç½®åº“æ›´æ”¹æ—¶æ›´æ–°ç¯å¢ƒï¼›&lt;/p>
&lt;p>operatorä¹Ÿèƒ½åšåˆ°å½“å®é™…ç¯å¢ƒä¸ç¯å¢ƒé…ç½®åº“ä¸­å­˜åœ¨å·®å¼‚æ—¶è¿›è¡Œè¿˜åŸã€‚&lt;/p>
&lt;p>è¿™å°±ç¡®ä¿äº†æ‰€æœ‰æ›´æ”¹éƒ½å¯ä»¥åœ¨ Git æ—¥å¿—ä¸­è¿›è¡Œè·Ÿè¸ªï¼Œå› ä¸ºä»»ä½•äººéƒ½ä¸å…è®¸å¯¹é›†ç¾¤è¿›è¡Œç›´æ¥æ›´æ”¹ã€‚&lt;/p>
&lt;p>é‚£ä¹ˆï¼Œè¿™ç§æ–¹å¼çš„ç›‘æ§ç‚¹å°±é›†ä¸­åœ¨ operator åŠå„ä¸ªç»„ä»¶ä¸Šäº†ï¼ˆæ¯”å¦‚ï¼Œé•œåƒä»“åº“æ˜¯å¦èƒ½æ­£å¸¸æ‹‰å–åˆ°é•œåƒç­‰ç­‰ï¼‰ã€‚&lt;/p>
&lt;p>ä¸ºäº†é¿å…åŸºäº Push åœºæ™¯ä¸­çš„ä¸Šå¸æ¨¡å¼æƒé™é—®é¢˜ï¼Œoperator åº”è¯¥å§‹ç»ˆä¸è¦éƒ¨ç½²çš„åº”ç”¨ç¨‹åºåœ¨åŒä¸€ç¯å¢ƒæˆ–é›†ç¾¤ä¸­ã€‚ï¼ˆk8s RBACæˆæƒï¼šKubernetes ä» 1.6 å¼€å§‹æ”¯æŒåŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶æœºåˆ¶ï¼ˆRole-Based Accessï¼ŒRBACï¼‰ï¼Œé›†ç¾¤ç®¡ç†å‘˜å¯ä»¥å¯¹ç”¨æˆ·æˆ– service account çš„è§’è‰²è¿›è¡Œæ›´ç²¾ç¡®çš„èµ„æºè®¿é—®æ§åˆ¶ã€‚åœ¨ RBAC ä¸­ï¼Œæƒé™ä¸è§’è‰²ç›¸å…³è”ï¼Œç”¨æˆ·é€šè¿‡æˆä¸ºé€‚å½“è§’è‰²çš„æˆå‘˜è€Œå¾—åˆ°è¿™äº›è§’è‰²çš„æƒé™ã€‚ï¼‰&lt;/p>
&lt;h3 id="åŸºäº-push-çš„éƒ¨ç½²">åŸºäº push çš„éƒ¨ç½²&lt;/h3>
&lt;p>åŸºäº Push çš„éƒ¨ç½²ç­–ç•¥å¯ä»¥åˆ©ç”¨æµè¡Œçš„ CI/CD å·¥å…·æ¥å®ç°ï¼Œä¾‹å¦‚ Jenkinsã€CircleCI æˆ– Travis CIã€‚ åº”ç”¨ç¨‹åºçš„æºä»£ç ä¸éƒ¨ç½²çš„åº”ç”¨ç¨‹åºæ‰€éœ€çš„ Kubernetes YAML ä¸€èµ·å­˜åœ¨äºåº”ç”¨ç¨‹åºåº“ä¸­ã€‚ æ¯å½“æ›´æ–°åº”ç”¨ç¨‹åºä»£ç æ—¶ï¼Œéƒ½ä¼šè§¦å‘æ„å»ºpipelineï¼Œæ„å»ºå®¹å™¨é•œåƒï¼Œæœ€åä½¿ç”¨æ–°çš„éƒ¨ç½²manifestï¼Œæ›´æ–°ç¯å¢ƒé…ç½®åº“ã€‚&lt;/p>
&lt;p>ä¹Ÿå¯ä»¥å°† YAML çš„æ¨¡æ¿å­˜å‚¨åœ¨åº”ç”¨ç¨‹åºåº“ä¸­ã€‚ æ„å»ºæ–°ç‰ˆæœ¬æ—¶ï¼Œå¯ä»¥ä½¿ç”¨æ¨¡æ¿åœ¨ç¯å¢ƒé…ç½®åº“ä¸­ç”Ÿæˆ YAMLã€‚&lt;/p>
&lt;p>&lt;img src="https://i.loli.net/2021/11/02/1wrJ7eDQ56GZsEU.png" alt="img">&lt;/p>
&lt;p>å¯¹ç¯å¢ƒé…ç½®åº“çš„æ›´æ”¹ä¼šè§¦å‘éƒ¨ç½²pipelineã€‚pipelineè´Ÿè´£å°†ç¯å¢ƒé…ç½®åº“ä¸­çš„æ‰€æœ‰manifestsåº”ç”¨åˆ°åŸºç¡€è®¾æ–½ã€‚è¿™å°±éœ€è¦æˆ‘ä»¬æ›´å…³æ³¨éƒ¨ç½²æƒé™ç»†åˆ†åŠæ§åˆ¶ã€‚åŒæ—¶ï¼Œè¿™ç§æ–¹å¼æ— æ³•è‡ªåŠ¨æ³¨æ„åˆ°ç¯å¢ƒåŠå…¶æ‰€éœ€çŠ¶æ€çš„ä»»ä½•åå·®ã€‚ æˆ‘ä»¬éœ€è¦é¢å¤–çš„ç›‘æ§æŠ¥è­¦æ–¹å¼ï¼Œæ¥ä¿éšœç¯å¢ƒä¸ç¯å¢ƒå­˜å‚¨åº“ä¸­æè¿°çš„å†…å®¹ä¸€è‡´ã€‚&lt;/p>
&lt;h2 id="å¤æ‚åº”ç”¨ç¯å¢ƒ">å¤æ‚åº”ç”¨ç¯å¢ƒ&lt;/h2>
&lt;p>å¯¹äºå¤§å¤šæ•°åº”ç”¨ç¨‹åºæ¥è¯´ï¼Œåªä½¿ç”¨ä¸€ä¸ªåº”ç”¨ç¨‹åºåº“å’Œä¸€ä¸ªç¯å¢ƒé…ç½®åº“æ˜¯ä¸ç°å®çš„ã€‚GitOps ä¹Ÿèƒ½åº”å¯¹ã€‚å¯ä»¥è®¾ç½®å¤šä¸ªæ„å»º pipeline æ¥æ›´æ–°ç¯å¢ƒé…ç½®åº“ã€‚ ç„¶åå°±åƒä¸Šä¸¤ä¸ªæè¿°è¿‡ç¨‹ä¸€æ ·ï¼Œè‡ªåŠ¨åŒ– GitOps å·¥ä½œæµç¨‹å¼€å§‹å¹¶éƒ¨ç½²åº”ç”¨ç¨‹åºã€‚&lt;/p>
&lt;p>&lt;img src="https://i.loli.net/2021/11/02/mz8Le3duSOAlUXt.png" alt="img">&lt;/p>
&lt;p>æˆ‘ä»¬éœ€è¦åœ¨ç¯å¢ƒé…ç½®åº“ä¸­ä½¿ç”¨ç‹¬ç«‹çš„åˆ†æ”¯ï¼Œæ¥ç®¡ç†å¤šä¸ªç¯å¢ƒã€‚ é€‰æ‹©è®¾ç½® operator æˆ–è€…æ„å»ºpipelineï¼Œè‡ªåŠ¨åŒ– GitOps å·¥ä½œæµç¨‹å¼€å§‹å¹¶éƒ¨ç½²åº”ç”¨ç¨‹åºã€‚&lt;/p>
&lt;p>Tipsï¼š&lt;/p>
&lt;p>1.ä¸ä½¿ç”¨k8sçš„ç¯å¢ƒä¹Ÿå¯ä»¥è€ƒè™‘ä½¿ç”¨ GitOpsã€‚ï¼ˆç›®å‰å¤§å¤šæ•°åŸºäº pull çš„ GitOps éƒ½æ˜¯åœ¨Kubernetes ä¸‹å®ç°çš„ã€‚ï¼‰&lt;/p>
&lt;p>2.å¯†ç ã€‚æ°¸è¿œä¸è¦åœ¨ git ä¸­ä»¥çº¯æ–‡æœ¬å½¢å¼å­˜å‚¨å¯†ç ï¼åœ¨ K8s ç”Ÿæ€ç³»ç»Ÿä¸­ï¼Œæœ‰å·¥å…·æ”¯æŒè¿™ç§åŠ å¯†ã€‚(æ¯”å¦‚ Vault)&lt;/p>
&lt;p>3.devã€qaã€prodç¯å¢ƒä¸èƒ½ç›´æ¥èƒ½ç”¨ GitOps æ¥å¤„ç†ï¼Œå¯ä»¥è€ƒè™‘å¼•å…¥ CI/CD pipeline æ¥ç®¡ç†ç¯å¢ƒã€‚&lt;/p>
&lt;p>4.DevOps ä¸GitOps ä¸å†²çªã€‚DevOps æ˜¯å…³äºç»„ç»‡ä¸­çš„æ–‡åŒ–å˜é©ï¼Œå¯ä»¥ä½¿ç¨‹åºå‘˜åŠç³»ç»Ÿç»´æŠ¤è€…ä»¬æ›´å¥½åœ°åˆä½œã€‚è€ŒGitOps æ˜¯ä¸€ç§å®ç°æŒç»­äº¤ä»˜çš„æŠ€æœ¯ã€‚å¦‚æœå·²ç»åœ¨æ¨è¿› DevOps é‚£ä¹ˆå¯èƒ½ä¼šæ›´å¥½æ¥å…¥ GitOpsã€‚&lt;/p>
&lt;hr>
&lt;p>æ¬¢è¿è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://gitee.com/tlrr/awesome/raw/master/2020-9-9/1599632564572-mp-qrcode.png" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category><category domain="https://moelove.info/tags/GitOps/">GitOps</category></item><item><title>ã€è¯‘ã€‘Limaï¼šDocker Desktop for Mac çš„å…è´¹å¼€æºä¸”è‡ªç”±çš„æ›¿ä»£å“</title><link>https://moelove.info/2021/09/05/%E8%AF%91LimaDocker-Desktop-for-Mac-%E7%9A%84%E5%85%8D%E8%B4%B9%E5%BC%80%E6%BA%90%E4%B8%94%E8%87%AA%E7%94%B1%E7%9A%84%E6%9B%BF%E4%BB%A3%E5%93%81/</link><guid isPermaLink="true">https://moelove.info/2021/09/05/%E8%AF%91LimaDocker-Desktop-for-Mac-%E7%9A%84%E5%85%8D%E8%B4%B9%E5%BC%80%E6%BA%90%E4%B8%94%E8%87%AA%E7%94%B1%E7%9A%84%E6%9B%BF%E4%BB%A3%E5%93%81/</guid><pubDate>Sun, 05 Sep 2021 10:39:13 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;p>è¿‘æœŸï¼ŒDocker Inc. å…¬å¸çªç„¶ä¿®æ”¹äº†&lt;a href="https://www.docker.com/blog/updating-product-subscriptions/" title="Docker æ–°çš„äº§å“å®šä»·ç­–ç•¥å…¬å‘Š">å…¶äº§å“å®šä»·å’Œç­–ç•¥&lt;/a>ï¼ŒDocker Desktop for Mac/Win ä¸å† &lt;strong>å…è´¹&lt;/strong> ä¾›å¤§å‹ä¼ä¸šå†…ä¸ªäººä½¿ç”¨ã€‚&lt;/p>
&lt;p>å…³äºæ­¤æ–°é—»ä¸­æ¶‰åŠçš„æ¡æ¬¾ï¼Œè¿™é‡Œå°±ä¸å†å±•å¼€ä»‹ç»äº†ã€‚æˆ‘æ¥ä¸ºå¤§å®¶ä»‹ç» &lt;strong>ä¸€æ¬¾å…è´¹ã€è‡ªç”±ã€å¼€æºçš„ Docker for Mac æ›¿ä»£å“ï¼Œ&lt;a href="https://github.com/containerd/containerd" title="containerd">containerd&lt;/a> &amp;amp; &lt;a href="https://github.com/lima-vm/lima" title="Lima">Lima&lt;/a>&lt;/strong> ã€‚&lt;/p>
&lt;p>ä½ åªéœ€è¦æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å³å¯å¿«é€Ÿä½“éªŒï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">$ brew install lima
$ limactl start
$ lima nerdctl run -it --rm alpine
&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ³¨æ„ï¼šå¦‚æœæ˜¯ Arm ç‰ˆçš„ Mac åˆ™éœ€è¦å®‰è£…ä¸€ä¸ªé¢å¤–çš„ QEMU çš„ patch ï¼Œè¯·å‚è€ƒ &lt;a href="https://github.com/lima-vm/lima#getting-started">Lima çš„æ–‡æ¡£&lt;/a>ã€‚&lt;/p>
&lt;h2 id="ä»€ä¹ˆæ˜¯-containerd--ä»€ä¹ˆæ˜¯-nerdctl-">ä»€ä¹ˆæ˜¯ containerd ? ä»€ä¹ˆæ˜¯ nerdctl ?&lt;/h2>
&lt;p>&lt;a href="https://github.com/containerd/containerd">containerd&lt;/a> æ˜¯ä¸€ä¸ªå¼€æºçš„å®¹å™¨è¿è¡Œæ—¶ï¼Œè¢«å¾ˆå¤šé¡¹ç›®æ‰€ä½¿ç”¨ï¼ŒåŒ…æ‹¬ Dockerï¼Œå’Œå¾ˆå¤šäº‘å‚å•†é»˜è®¤é…ç½®çš„ Kubernetes é›†ç¾¤ï¼Œä¾‹å¦‚ AKSï¼Œ EKS å’Œ GKEã€‚&lt;/p>
&lt;p>ç”±äº &lt;a href="https://containerd.io/scope/" title="containerd é¡¹ç›®çš„æ ¸å¿ƒç›®æ ‡">containerd é¡¹ç›®çš„æ ¸å¿ƒèŒƒå›´ä»…é™äºéé¢å‘ç”¨æˆ·çš„åŒºåŸŸ&lt;/a>ï¼Œå› æ­¤ç”¨æˆ·å¾ˆéš¾ç›´æ¥ä¸ containerd è¿›è¡Œäº¤äº’ã€‚æ‰€ä»¥æˆ‘ä»¬è¿‘æœŸè´¡çŒ®äº†ä¸€ä¸ªäººæ€§åŒ–çš„ CLI ä½œä¸º containerd çš„éæ ¸å¿ƒå­é¡¹ç›®ï¼š&lt;a href="https://github.com/containerd/nerdctl" title="nerdctl">nerdctl&lt;/a> ã€‚&lt;/p>
&lt;p>nerdctl çš„åŠŸèƒ½å’Œç”¨æ³•å‡ ä¹ä¸ Docker CLI ç›¸åŒï¼Œä½†æ˜¯ nerdctl è¿˜æ”¯æŒ Docker ä¸­ä¸å­˜åœ¨çš„å‡ ä¸ª containerd çš„å‰æ²¿åŠŸèƒ½ã€‚æ­¤ç±»åŠŸèƒ½åŒ…æ‹¬ä½†ä¸é™äº &lt;a href="https://github.com/containerd/nerdctl/blob/master/docs/stargz.md">å»¶è¿Ÿæ‹‰å–(stargz)&lt;/a> å’Œ &lt;a href="https://github.com/containerd/nerdctl/blob/master/docs/ocicrypt.md">è¿è¡ŒåŠ å¯†é•œåƒï¼ˆocicryptï¼‰&lt;/a>ã€‚&lt;/p>
&lt;p>æœ‰å…³æ›´å¤šè¾“ nerdctl çš„å†…å®¹å¯å‚è€ƒä¹‹å‰çš„æ–‡ç« ï¼š&lt;a href="https://medium.com/nttlabs/nerdctl-359311b32d0e">nerdctl: Docker-compatible CLI for contaiNERD&lt;/a>&lt;/p>
&lt;h2 id="ä»€ä¹ˆæ˜¯-lima">ä»€ä¹ˆæ˜¯ Limaï¼Ÿ&lt;/h2>
&lt;p>&lt;a href="https://github.com/lima-vm/lima">Limaï¼ˆLinux MAchinesï¼‰&lt;/a>å¯ä»¥å¯åŠ¨å…·æœ‰è‡ªåŠ¨æ–‡ä»¶å…±äº«ã€ç«¯å£è½¬å‘å’Œä½¿ç”¨ containerd çš„ Linux è™šæ‹Ÿæœºã€‚&lt;/p>
&lt;p>Lima æˆªè‡³åˆ° 2021 å¹´ 9 æœˆ 1 æ—¥æ—¶å·²ç»åœ¨ GitHub ä¸Šè·å¾—äº† 3k star ã€‚&lt;/p>
&lt;p>&lt;img src="https://i.loli.net/2021/09/05/MGQxt31A6vDo8sb.png" alt="img">&lt;/p>
&lt;p>æˆ‘ä»¬æœ€åˆåˆ›å»º Lima æ˜¯ä¸ºäº†å‘ Mac ç”¨æˆ·æ¨å¹¿ containerd å’Œ nerdctl ï¼Œä½†æ˜¯ Lima ä¹Ÿå¯ä»¥ç”¨äºå…¶ä»–çš„å®¹å™¨å¼•æ“ï¼Œä¾‹å¦‚ Podman ç”šè‡³æ˜¯éå®¹å™¨åŒ–çš„åº”ç”¨ç¨‹åºã€‚&lt;/p>
&lt;p>Lima çš„è®¾è®¡å’Œ WSL2 ç±»ä¼¼ï¼Œä½† Lima ä½¿ç”¨ MacOS ä½œä¸ºå…¶ä¸»è¦çš„ç›®æ ‡ä¸»æœºã€‚Lima ç›®å‰ä¸æ”¯æŒ Windows ä¸»æœºï¼Œå¦‚æœæœ‰éœ€æ±‚ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è€ƒè™‘æ”¯æŒ Windows ç³»ç»Ÿã€‚&lt;/p>
&lt;h3 id="lima-çš„æŠ€æœ¯ç»†èŠ‚">Lima çš„æŠ€æœ¯ç»†èŠ‚&lt;/h3>
&lt;p>ä»¥ä¸‹æ˜¯ Lima çš„æŠ€æœ¯ç»†èŠ‚ï¼Œæ„Ÿè°¢çš„å°ä¼™ä¼´å¯ä»¥çœ‹çœ‹ï¼š&lt;/p>
&lt;ul>
&lt;li>ç®¡ç†ç¨‹åºï¼š QEMUï¼Œ å¸¦ &lt;code>hvf&lt;/code> ï¼ˆHypervisor.frameworkï¼‰åŠ é€Ÿå™¨ï¼›&lt;/li>
&lt;li>æ”¯æŒçš„ Guest æ“ä½œç³»ç»Ÿï¼šUbuntu (é»˜è®¤), Debian, Fedora, Alpine, Arch, and openSUSEï¼›&lt;/li>
&lt;li>æ–‡ä»¶å…±äº«ï¼ˆhost-&amp;gt;gusetï¼‰ï¼šå½“å‰ç‰ˆæœ¬ä¸­ä½¿ç”¨çš„æ˜¯ â€œReverse SSHFSâ€ï¼Œåœ¨å°†æ¥å¯èƒ½ä¼šæ”¹å˜ï¼Œå¯èƒ½ä¼šåˆ‡æ¢åˆ° Sambaï¼›&lt;/li>
&lt;li>æ–‡ä»¶å…±äº«ï¼ˆguset-&amp;gt;hostï¼‰ï¼šWebDAV over SSHï¼ˆåœ¨ &lt;a href="https://github.com/lima-vm/sshwebdav">https://github.com/lima-vm/sshwebdav&lt;/a> ä¸­å®éªŒï¼‰ï¼›&lt;/li>
&lt;li>ç«¯å£è½¬å‘ï¼š &lt;code>ssh -L&lt;/code> æœ‰ä¸€ä¸ª agent è¿›ç¨‹åœ¨ guest ä¸­ç›‘å¬ &lt;code>/proc/net/tcp*&lt;/code> ï¼›&lt;/li>
&lt;li>ç½‘ç»œï¼šé»˜è®¤åœ¨ç”¨æˆ·ç©ºé—´ä½¿ç”¨ â€œslirpâ€ã€‚åŒæ—¶ä¹Ÿæ”¯æŒé€šè¿‡ sudo å’Œ VDE ä½¿ç”¨ &lt;code>vmnet.framework&lt;/code> çš„é«˜çº§ç½‘ç»œé…ç½®ï¼Œå‚è€ƒ &lt;a href="https://github.com/lima-vm/vde_vmnet">https://github.com/lima-vm/vde_vmnet&lt;/a> ï¼›&lt;/li>
&lt;li>å®‰å…¨ï¼šåœ¨è®¾è®¡ä¸Šä¸éœ€è¦ä½¿ç”¨å®¿ä¸»æœºä¸Šçš„ root æƒé™ï¼Œé™¤äº†å¯é€‰çš„ &lt;code>vmnet.framework&lt;/code> æ”¯æŒï¼›&lt;/li>
&lt;/ul>
&lt;h2 id="å¿«é€Ÿå¼€å§‹">å¿«é€Ÿå¼€å§‹&lt;/h2>
&lt;h3 id="å®‰è£…-lima">å®‰è£… Lima&lt;/h3>
&lt;p>å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ Intel Macï¼Œåªè¦è¿è¡Œå¦‚ä¸‹ &lt;code>brew&lt;/code> å‘½ä»¤å³å¯å®Œæˆï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">$ brew install lima
&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¦‚æœä½ ä½¿ç”¨çš„ Arm Macï¼ˆM1ï¼‰ï¼Œå½“å‰ä½ éœ€è¦å®‰è£…&lt;a href="https://lore.kernel.org/qemu-devel/20210519202253.76782-1-agraf@csgraf.de/">ä¸€ä¸ª QEMU çš„ path ç‰ˆæœ¬&lt;/a>æ‰èƒ½å¯ç”¨ &lt;code>hvf&lt;/code> åŠ é€Ÿï¼Œè¯¥è¡¥ä¸å¯èƒ½åœ¨ä¸ä¹…ä¹‹åä¼šåˆå¹¶åˆ° QEMU ä¸Šæ¸¸ã€‚è¯·å‚è€ƒ &lt;a href="https://github.com/lima-vm/lima#getting-started">Lima çš„æ–‡æ¡£&lt;/a>&lt;/p>
&lt;h3 id="å¯åŠ¨-lima">å¯åŠ¨ Lima&lt;/h3>
&lt;p>æ‰§è¡Œ &lt;code>limactl start&lt;/code> å¹¶æŒ‰ä¸‹å›è½¦é€‰æ‹© &lt;code>Proceed with the default configuration&lt;/code> ï¼Œç¨ç­‰å‡ åˆ†é’Ÿï¼ŒLima ä¼šè‡ªåŠ¨å®Œæˆä¸‹è½½ VM é•œåƒå’Œå¯åŠ¨è™šæ‹Ÿæœºã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">$ limactl start
? Creating an instance &lt;span class="s2">&amp;#34;default&amp;#34;&lt;/span> &lt;span class="o">[&lt;/span>Use arrows to move, &lt;span class="nb">type&lt;/span> to filter&lt;span class="o">]&lt;/span>
&amp;gt; Proceed with the default configuration
Open an editor to override the configuration
Exit
...
INFO&lt;span class="o">[&lt;/span>0111&lt;span class="o">]&lt;/span> READY. Run &lt;span class="sb">`&lt;/span>lima&lt;span class="sb">`&lt;/span> to open the shell.
&lt;/code>&lt;/pre>&lt;/div>&lt;p>åœ¨çœ‹åˆ° &lt;code>READY&lt;/code> è¾“å‡ºåï¼Œæ‰§è¡Œ &lt;code>lima uname -a&lt;/code> æ¥ç¡®è®¤è™šæ‹Ÿæœºå·²ç»åœ¨è¿è¡Œäº†ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">$ lima uname -a
Linux lima-default 5.11.0-31-generic &lt;span class="c1">#33-Ubuntu SMP Wed Aug 11 13:19:04 UTC 2021 x86_64 x86_64 x86_64 GNU/Linux&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="ä½¿ç”¨-lima-nerdctl-æ„å»ºå’Œè¿è¡Œä¸€ä¸ªå®¹å™¨">ä½¿ç”¨ &lt;code>lima nerdctl&lt;/code> æ„å»ºå’Œè¿è¡Œä¸€ä¸ªå®¹å™¨&lt;/h3>
&lt;p>åœ¨å®¿ä¸»æœºä¸Šåˆ›å»ºä¸€ä¸ªæ–‡ä»¶ &lt;code>~/lima-test/Dockerfile&lt;/code> å¹¶å†™å…¥ä»¥ä¸‹å†…å®¹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-dockerfile" data-lang="dockerfile">&lt;span class="k">FROM&lt;/span>&lt;span class="s"> nginx&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="k">RUN&lt;/span> &lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;hello lima&amp;#34;&lt;/span> &amp;gt; /usr/share/nginx/html/index.html&lt;span class="err">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç„¶åä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æ„å»ºä¸€ä¸ªåä¸º &lt;code>lima-test&lt;/code> çš„å®¹å™¨é•œåƒï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">$ lima nerdctl build -t lima-test ~/lima-test
&lt;/code>&lt;/pre>&lt;/div>&lt;p>Lima å°†ä¸»æœºçš„å®¶ç›®å½•æŒ‚è½½åˆ° guest æ–‡ä»¶ç³»ç»Ÿï¼Œæ‰€ä»¥ guest ä¸­çš„ &lt;code>nerdctl&lt;/code> å¯ä»¥æ— ç¼çš„è®¿é—®ä¸»æœºä¸Šçš„ &lt;code>~/lima-test&lt;/code> ç›®å½•ã€‚ä¸ºäº†å®‰å…¨èµ·è§ï¼Œå®¶ç›®å½•é»˜è®¤è¢«æŒ‚è½½ä¸ºåªè¯»ï¼Œä½†æ˜¯ä¹Ÿå¯ä»¥é€šè¿‡åœ¨æ‰§è¡Œ &lt;code>limactl start&lt;/code> æ—¶ï¼Œé€šè¿‡ä¿®æ”¹é…ç½®æ¥å®ç°å¯è¯»å†™æ¨¡å¼çš„æŒ‚è½½ã€‚&lt;/p>
&lt;p>åˆšæ‰æ„å»ºå¥½çš„ &lt;code>lima-test&lt;/code> é•œåƒå¯é€šè¿‡å¦‚ä¸‹å‘½ä»¤è¿›è¡Œå¯åŠ¨ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">$ lima nerdctl run -d -p 127.0.0.1:8080:80 lima-test
&lt;/code>&lt;/pre>&lt;/div>&lt;p>Lima å°† guest VM ä¸Šå·²ç»æ˜ å°„äº†å®¹å™¨ä¸­ 80 ç«¯å£çš„åœ°å€ &lt;code>127.0.0.1:8080&lt;/code> æ˜ å°„åˆ°å®¿ä¸»æœºä¸Šçš„ &lt;code>127.0.0.1:8080&lt;/code> ï¼Œæ‰€ä»¥ä½ å¯ä»¥ç›´æ¥åœ¨ Safari ä¸­æ‰“å¼€ &lt;a href="http://127.0.0.1:8080/">http://127.0.0.1:8080/&lt;/a> è¿›è€Œè®¿é—®åˆ° &lt;code>lima-test&lt;/code> å®¹å™¨ã€‚&lt;/p>
&lt;p>&lt;img src="https://i.loli.net/2021/09/05/exTksJN1ZCfXoEt.png" alt="é€šè¿‡ Safari è®¿é—®åˆ° guest VM">&lt;/p>
&lt;h2 id="rancher-desktop--gui">Rancher Desktop &amp;amp; GUI&lt;/h2>
&lt;p>&lt;a href="https://github.com/rancher-sandbox/rancher-desktop">Rancher Desktop&lt;/a> å·²ç»é€‚é…äº† Lima ï¼Œä»¥ä¾¿åœ¨ macOS ä¸Šè¿è¡Œ k3s ã€‚(æˆ‘åœ¨ä¹‹å‰çš„ ã€K8Sç”Ÿæ€å‘¨æŠ¥ã€ä¸­æ›¾ä¸ºå¤§å®¶ä»‹ç»è¿‡æ­¤é¡¹ç›®)&lt;/p>
&lt;p>&lt;img src="https://i.loli.net/2021/09/05/z6evkARfEjGOI1D.png" alt="å®‰è£… Rancher Desktop">&lt;/p>
&lt;p>å°½ç®¡ Lima å’Œ nerdctl å®ƒä»¬ç›®å‰ä¸åŒ…å« GUI æ§åˆ¶é¢ï¼Œä½†æ˜¯ Rancher Desktop å·²ç»ä½¿ç”¨ Electron æä¾›äº†ä¸€ä¸ªå¾ˆé…·çš„ GUI ã€‚&lt;/p>
&lt;p>&lt;img src="https://i.loli.net/2021/09/05/OWpytz4SrDIV6ws.png" alt="Rancher Desktop v0.4.1">&lt;/p>
&lt;p>&lt;img src="https://i.loli.net/2021/09/05/EqbpuNJ31lw4Pem.png" alt="Rancher Desktop åœ¨åå°è¿è¡Œ Lima ">&lt;/p>
&lt;p>æœªæ¥ï¼Œä¸Šæ¸¸çš„ Lima å’Œ nerdctl å¯èƒ½ä¹Ÿä¼šæœ‰è‡ªå·±çš„ GUI ï¼Œè¿™å–å†³äºæ¥è‡ªç¤¾åŒºçš„éœ€æ±‚ï¼ˆå’Œè´¡çŒ®ï¼‰ã€‚&lt;/p>
&lt;p>&lt;em>åŸæ–‡åœ°å€ï¼šhttps://medium.com/nttlabs/containerd-and-lima-39e0b64d2a59&lt;/em>
&lt;em>ç»åŸä½œè€… Akihiro Suda æˆæƒç¿»è¯‘&lt;/em>&lt;/p>
&lt;hr>
&lt;p>æ¬¢è¿è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://gitee.com/tlrr/awesome/raw/master/2020-9-9/1599632564572-mp-qrcode.png" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Docker/">Docker</category><category domain="https://moelove.info/tags/containerd/">containerd</category></item><item><title>å¼€æºæµªæ½®ä¸‹ç¨‹åºå‘˜çš„èŒä¸šè§„åˆ’å’Œæˆé•¿</title><link>https://moelove.info/2021/08/27/%E5%BC%80%E6%BA%90%E6%B5%AA%E6%BD%AE%E4%B8%8B%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E8%81%8C%E4%B8%9A%E8%A7%84%E5%88%92%E5%92%8C%E6%88%90%E9%95%BF/</link><guid isPermaLink="true">https://moelove.info/2021/08/27/%E5%BC%80%E6%BA%90%E6%B5%AA%E6%BD%AE%E4%B8%8B%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E8%81%8C%E4%B8%9A%E8%A7%84%E5%88%92%E5%92%8C%E6%88%90%E9%95%BF/</guid><pubDate>Fri, 27 Aug 2021 12:39:40 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å¼ æ™‹æ¶›ã€‚&lt;/p>
&lt;p>æ— è®ºä»å¹´åˆå¼€æºç¤¾å‘å¸ƒçš„ã€Š2020 ä¸­å›½å¼€æºå¹´åº¦æŠ¥å‘Šã€‹è¿˜æ˜¯æ•´ä½“çš„å¤§ç¯å¢ƒï¼Œä¸éš¾çœ‹åˆ°ä¸­å›½çš„å¼€æºæ­£åœ¨å´›èµ·ï¼Œè¶Šæ¥è¶Šå¤šçš„æ¥è‡ªä¸­å›½çš„å¼€æºé¡¹ç›®å’Œå¼€å‘è€…ä»¬æ­£åœ¨èµ°å…¥å¤§å®¶çš„è§†é‡ã€‚åœ¨å¼€æºæµªæ½®çš„å¤§è¶‹åŠ¿ä¸‹ï¼Œç¨‹åºå‘˜åˆè¯¥å¦‚ä½•è§„åˆ’è‡ªå·±çš„èŒä¸šä»¥åŠä¸ªäººæˆé•¿å‘¢ï¼Ÿä¸å¦‚å¬å¬æ­£åœ¨å…¨èŒåšå¼€æºçš„å·¥ç¨‹å¸ˆå¼ æ™‹æ¶›æ€ä¹ˆè¯´ã€‚&lt;/p>
&lt;blockquote>
&lt;p>æœ¬æ–‡æ ¹æ®å¼ æ™‹æ¶›åœ¨åˆæ‹äº‘ Open Talk æŠ€æœ¯æ²™é¾™åŒ—äº¬ç«™ä¸»é¢˜æ¼”è®²ã€Šå¼€æºæµªæ½®ä¸‹ç¨‹åºå‘˜çš„èŒä¸šè§„åˆ’å’Œæˆé•¿ã€‹æ•´ç†è€Œæˆï¼Œç°åœºè§†é¢‘åŠ PPT å¯ä¸‹æ‹‰æ–‡æœ«ç‚¹å‡»é˜…è¯»åŸæ–‡æŸ¥çœ‹ã€‚&lt;/p>
&lt;/blockquote>
&lt;blockquote>
&lt;p>å¼ æ™‹æ¶›ï¼Œæ”¯æµç§‘æŠ€äº‘åŸç”ŸæŠ€æœ¯ä¸“å®¶ï¼ŒApache APISIX committer, Kubernetes ingress-nginx reviewerï¼Œcontainerd/Docker/Helm/Kubernetes/KIND ç­‰ä¼—å¤šå¼€æºé¡¹ç›® contributorï¼Œå¯¹ Docker å’Œ Kubernetes ç­‰å®¹å™¨åŒ–æŠ€æœ¯æœ‰å¤§é‡å®è·µå’Œæ·±å…¥æºç çš„ç ”ç©¶ï¼Œè‘—æœ‰ ã€ŠKubernetes ä¸Šæ‰‹å®è·µã€‹å’Œ ã€ŠDocker æ ¸å¿ƒçŸ¥è¯†å¿…çŸ¥å¿…ä¼šã€‹ç­‰ä¸“æ ã€‚&lt;/p>
&lt;/blockquote>
&lt;p>å¤§å®¶å¥½ï¼Œä»Šå¤©æˆ‘åˆ†äº«çš„ä¸»é¢˜æ˜¯ã€Šå¼€æºæµªæ½®ä¸‹ç¨‹åºå‘˜çš„èŒä¸šè§„åˆ’å’Œæˆé•¿ã€‹ã€‚ä»Šå¤©åœ¨è¿™é‡ŒèŠä¸¤ä¸ªé¡¹ç›®ï¼Œä¸€ä¸ªæ˜¯ Apache APISIXï¼ŒAPISIX æ˜¯ Apache åŸºé‡‘ä¼šæ——ä¸‹çš„é¡¶çº§å¼€æºé¡¹ç›®ã€‚ç¬¬äºŒä¸ªé¡¹ç›®æ˜¯ ingress-nginxï¼Œå®ƒæ˜¯ Kubernetes æ•´ä¸ªç”Ÿæ€åœˆé‡Œå¤´ï¼Œé™¤å» Kubernetes è‡ªèº«ä»¥å¤–ä½¿ç”¨é¢‘ç‡æœ€é«˜çš„è½¯ä»¶ä¹‹ä¸€äº†ã€‚æè¿‡ Kubernetes çš„åŒå­¦åº”è¯¥åŸºæœ¬ä¸Šéƒ½ç”¨è¿‡è¿™ä¸ªé¡¹ç›®ã€‚&lt;/p>
&lt;p>ä»Šå¤©æˆ‘åˆ†äº«çš„å†…å®¹ä¸»è¦ä»å››ä¸ªæ–¹é¢æ¥èŠï¼š&lt;/p>
&lt;ul>
&lt;li>å¼€æºçš„æ–‡åŒ–&lt;/li>
&lt;li>å¦‚ä½•å‚ä¸å¼€æº&lt;/li>
&lt;li>å…³äºæˆ‘çš„æ•…äº‹&lt;/li>
&lt;li>èŒä¸šè§„åˆ’ç›¸å…³çš„å†…å®¹&lt;/li>
&lt;/ul>
&lt;h1 id="äº†è§£å¼€æºæ–‡åŒ–">äº†è§£å¼€æºæ–‡åŒ–&lt;/h1>
&lt;h2 id="è‡ªç”±è½¯ä»¶è¿åŠ¨">è‡ªç”±è½¯ä»¶è¿åŠ¨&lt;/h2>
&lt;p>æåˆ°å¼€æºæ–‡åŒ–ï¼Œé¦–å…ˆéœ€è¦äº†è§£è‡ªç”±è½¯ä»¶è¿åŠ¨ã€‚&lt;/p>
&lt;p>&lt;img src="https://i.loli.net/2021/08/27/VTUujOarwgL2zFm.png" alt="img">&lt;/p>
&lt;p>å›¾å³æ˜¯è¢«ç§°ä¸ºè‡ªç”±è½¯ä»¶ä¹‹çˆ¶çš„æ–¯æ‰˜æ›¼ï¼Œä»–åœ¨ 1983 å¹´æå‡ºäº† GNU è®¡åˆ’ã€‚1984 å¹´ï¼Œæ–¯æ‰˜æ›¼æå‡ºäº† Copyleft çš„æ¦‚å¿µï¼ŒCopyleft è·Ÿæˆ‘ä»¬å¹³æ—¶ç”¨åˆ°çš„ç‰ˆæƒ Copyright æ˜¯ç›¸å¯¹åº”çš„ï¼Œå®ƒæ”¾å¼ƒäº† Copyright ç±»ä¼¼å¯¹ç‰ˆæƒçš„ä¸¥æ ¼é™åˆ¶ã€‚&lt;/p>
&lt;p>1985 å¹´ï¼Œæ–¯æ‰˜æ›¼æˆç«‹äº†è‡ªç”±è½¯ä»¶åŸºé‡‘ä¼šï¼Œç›®çš„æ˜¯ä¸ºäº†èƒ½å¤Ÿè®©è‡ªç”±è½¯ä»¶æ›´å¥½åœ°å‘å±•ã€‚åœ¨å½“æ—¶ï¼Œå¾ˆå¤šè½¯ä»¶éƒ½æ˜¯ä¸“æœ‰è½¯ä»¶æˆ–è€…å•†ç”¨è½¯ä»¶ï¼Œä»»ä½•äººä½¿ç”¨è¿™äº›è½¯ä»¶éƒ½æ˜¯éœ€è¦ä»˜è´¹çš„ã€‚æ–¯æ‰˜æ›¼è®¤ä¸ºéšç€è®¡ç®—æœºçš„å‘å±•ï¼Œå¦‚æœå•†ç”¨è½¯ä»¶ã€ä»˜è´¹è½¯ä»¶æŒæ¡åœ¨æå°‘æ•°å…¬å¸çš„æƒ…å†µä¸‹ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°†ä¼šé€æ­¥å¤±å»è‡ªç”±ã€‚å› ä¸ºå¾ˆå¤šå•†ä¸šè½¯ä»¶æˆ–è€…ä¸“ç”¨è½¯ä»¶éƒ½æ˜¯ç”±å•†ä¸šå…¬å¸ï¼Œæˆ–è€…æ˜¯æå°‘æ•°çš„äººæŒæ¡ç€ï¼Œå¦‚æœä½ ä¾èµ–è¿™äº›è½¯ä»¶ï¼Œéƒ½å¿…é¡»ä¾èµ–äºå…¶ä»–äººï¼Œä½ çš„å‘½è„‰å°±æŒæ¡åœ¨äº†ä»–ä»¬æ‰‹ä¸­ï¼Œå°±ä¸å¯èƒ½è·å¾—è‡ªç”±ã€‚&lt;/p>
&lt;p>1989 å¹´ï¼Œå‡ºç°äº†ç¬¬ä¸€ä¸ª GNU çš„é€šç”¨åè®®ï¼Œå«åš GPLã€‚&lt;/p>
&lt;p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹åœ¨è‡ªç”±è½¯ä»¶è¿åŠ¨ä¹‹åå‘ç”Ÿäº†ä»€ä¹ˆäº‹æƒ…ã€‚æƒ³å¿…å¤§å®¶éƒ½æ¥è§¦è¿‡ Linux æ“ä½œç³»ç»Ÿã€‚Linux æ“ä½œç³»ç»Ÿçš„åˆ›å§‹äººæ˜¯æ—çº³æ–¯Â·æ‰˜ç“¦å…¹ï¼Œä»–åœ¨ 1991 å¹´é¦–æ¬¡å‘å¸ƒäº† Linux æ“ä½œç³»ç»Ÿï¼Œå¹¶ä¸”é€‰æ‹©äº†å°†å®ƒçš„æºä»£ç ç›´æ¥å‘å¸ƒåˆ°ç½‘ç»œä¸Šï¼Œä¾›å…¶ä»–äººå»ä½¿ç”¨å’Œåˆ†äº«ã€‚&lt;/p>
&lt;p>åœ¨è¿™ä¸ªæ—¶å€™ï¼Œæ–¯æ‰˜æ›¼æ‰¾åˆ°äº†æ—çº³æ–¯ã€‚GNU è‡ªç”±è½¯ä»¶åŸºé‡‘ä¼šçš„ä¸»è¦ç›®æ ‡æ˜¯å¸Œæœ›èƒ½å¤Ÿåˆ›å»ºå‡ºæ‰€æœ‰äººéƒ½å¯ä»¥ä½¿ç”¨çš„åŸºç¡€è½¯ä»¶ï¼ŒåŒ…æ‹¬æ“ä½œç³»ç»Ÿã€‚ç›´åˆ° 1991 å¹´ Linux æ“ä½œç³»ç»Ÿå‘å¸ƒçš„æ—¶å€™ï¼ŒGNU è‡ªç”±è½¯ä»¶åŸºé‡‘ä¼šå·²ç»å®Œæˆäº†æ‰€æœ‰åŸºç¡€ç±»çš„è‡ªç”±è½¯ä»¶å¼€å‘ï¼Œä½†æ˜¯å®ƒæ²¡å®Œæˆæœ€æ ¸å¿ƒçš„æ“ä½œç³»ç»Ÿçš„å¼€å‘ã€‚æ‰€ä»¥ï¼Œæ–¯æ‰˜æ›¼æ‰¾ä¸Šäº†æ—çº³æ–¯ã€‚ç»“æœæˆ‘ä»¬éƒ½çŸ¥é“ï¼ŒLinux æ“ä½œç³»ç»Ÿçš„å®Œæ•´åå­—æ˜¯ GNU/Linuxã€‚&lt;/p>
&lt;h2 id="å¼€æºåä½œä¸æ–‡åŒ–">å¼€æºåä½œä¸æ–‡åŒ–&lt;/h2>
&lt;p>èŠå®Œè‡ªç”±è½¯ä»¶è¿åŠ¨ã€Linux æ“ä½œç³»ç»Ÿï¼Œæ¥çœ‹ä¸‹æˆ‘ä»¬ç°åœ¨æ‰€æ¥è§¦åˆ°çš„å¼€æºåä½œå’Œå¼€æºæ–‡åŒ–ã€‚&lt;/p>
&lt;h3 id="å¼€æ”¾">å¼€æ”¾&lt;/h3>
&lt;p>åœ¨å¼€æºåä½œä¸­ï¼ŒåŸºæœ¬çš„ç†å¿µå°±æ˜¯å¼€æ”¾ã€‚ä½†å¾ˆå¤šäººå¯èƒ½å¯¹æ­¤æœ‰è¯¯è§£ï¼Œè®¤ä¸ºå¼€æ”¾æºä»£ç å°±ç­‰äºå¼€æ”¾ï¼Œå…¶å®ä¸ç„¶ã€‚æºä»£ç çš„å¼€æ”¾å’ŒçœŸæ­£çš„å¼€æ”¾å¹¶ä¸ä¸€æ ·ã€‚ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼šMongoDBã€‚&lt;/p>
&lt;p>MongoDB æ˜¯ä¸€ä¸ªæ–‡æ¡£ç±»å‹çš„æ•°æ®åº“ã€‚è¿‘å‡ å¹´ï¼ŒMongoDB ä¿®æ”¹äº†ä¸€æ¬¡åè®® SSPLï¼Œç§°ä¹‹ä¸ºæœåŠ¡ç«¯å…¬å…±è®¸å¯è¯ï¼Œåè®®æ›´æ”¹ä¹‹åæœ‰ä»€ä¹ˆå˜åŒ–å‘¢ï¼Ÿå®ƒçš„åè®®è§„å®šä»»ä½•ä¸€ä¸ªäº‘å‚å•†ï¼Œå¦‚æœåœ¨äº‘æœåŠ¡ä¸Šä½¿ç”¨äº† MongoDBï¼Œå°±å¿…é¡»æŠŠåœ¨ MongoDB ä¹‹ä¸Šæ‰€åšçš„æ›´æ”¹ï¼ŒåŒ…æ‹¬ç®¡æ§ç«¯çš„æºä»£ç éƒ½å¼€æºå‡ºæ¥ã€‚&lt;/p>
&lt;p>å¤§å®¶æƒ³ä¸€ä¸‹è¿™ä¸ªäº‹æƒ…å¯èƒ½å—ï¼Ÿ&lt;/p>
&lt;p>å…¶å®ä¸å¯èƒ½ï¼Œä»»ä½•ä¸€ä¸ªäº‘å‚å•†ï¼Œå®ƒå¯¹æ‰€æœ‰åŸºç¡€è½¯ä»¶ï¼Œæˆ–è€…æ‰€æœ‰å¼€æºè½¯ä»¶çš„å˜æ›´ï¼Œéƒ½æ˜¯å®ƒçš„æ ¸å¿ƒï¼Œæ˜¯å®ƒçš„å‘½è„‰ã€‚æ‰€ä»¥è¯´ï¼ŒMongoDB è¿™ä¸€æ¬¡ä¿®æ”¹å…¶å®æ˜¯å¸¦æœ‰é’ˆå¯¹æ€§çš„ï¼Œå®ƒé’ˆå¯¹çš„æ˜¯è¿™äº›äº‘å‚å•†ã€‚åœ¨å¼€æºè½¯ä»¶çš„åŸºæœ¬åå®šä¹‹ä¸‹ï¼Œè¿™å…¶å®å±äºä¸å¼€æ”¾çš„åè®®ã€‚&lt;/p>
&lt;p>å†æœ‰å°±æ˜¯å‰æ®µæ—¶é—´ï¼ŒElasticsearch ä¹Ÿå®£å¸ƒå…¶ä½¿ç”¨ SSPLï¼Œè¿™å¯¼è‡´ AWS åŸºäºä¹‹å‰ Apache åè®®çš„ä»£ç ç›´æ¥ fork äº†ä¸€ä¸ªç‰ˆæœ¬ï¼Œå¹¶ç§°ä¹‹ä¸º OpenSearch ã€‚è¿™ä¹Ÿæ˜¯å¯¹è¿™ç§ä¸å¼€æ”¾çš„è¡Œä¸ºçš„ä¸€ç§åº”å¯¹æ–¹å¼ã€‚&lt;/p>
&lt;h3 id="ååŒ">ååŒ&lt;/h3>
&lt;p>å¼€æºæ–‡åŒ–å½“ä¸­æåˆ°å¦å¤–ä¸€ç‚¹ï¼Œå°±æ˜¯åä½œã€‚Linux æ“ä½œç³»ç»Ÿä¸ºä»€ä¹ˆèƒ½å¤Ÿè·å¾—æˆåŠŸï¼Ÿå› ä¸º 1991 å¹´çš„æ—¶å€™æ—çº³æ–¯å‘å¸ƒäº†ç¬¬ä¸€ä¸ª Linux çš„ç‰ˆæœ¬ï¼ŒæŠŠæºä»£ç ç›´æ¥å…¬å¼€åˆ°äº†äº’è”ç½‘ä¸Šï¼Œå…¶ä»–äººå¯ä»¥ç›´æ¥ä¸‹è½½æºä»£ç ï¼Œå¹¶ä¸”å¯¹è¿™äº›æºä»£ç è¿›è¡Œä¿®æ”¹ã€‚&lt;/p>
&lt;p>åœ¨ 1991 å¹´ï¼Œæ—çº³æ–¯å‘å¸ƒå®Œ Linux ç¬¬ä¸€ä¸ªå¯ä¾›ä¸‹è½½å’Œä½¿ç”¨çš„ç‰ˆæœ¬æ—¶ï¼Œå…¶å®è‡ªç”±è½¯ä»¶åŸºé‡‘ä¼šæ——ä¸‹è¿˜æœ‰å…¶ä»–äººä¹Ÿåœ¨å†™ç»™ GNU ä½¿ç”¨çš„å†…æ ¸ï¼Œåªæ˜¯æ²¡æœ‰ Linux çš„å®Œæˆåº¦é«˜ã€‚&lt;/p>
&lt;p>ä¸ºä»€ä¹ˆå®ƒæ²¡æœ‰å‘å±•èµ·æ¥å‘¢ï¼Ÿå› ä¸ºå®ƒæ˜¯ç”±å›ºå®šçš„å‡ ä¸ªäººåœ¨åšè¿™ä¸ªäº‹æƒ…ï¼Œä¸”ä»…æœ‰é‚£ä¹ˆå‡ ä¸ªäººï¼Œåªæœ‰å®ƒçœŸæ­£å¯¹å¤–å…¬å¼€å‘å¸ƒäº†ä¸€ä¸ªç‰ˆæœ¬ï¼Œå¤–ç•Œæ‰ä¼šäº†è§£åˆ°ã€‚è¿™é‡Œå°±ä¸å¾—ä¸æåˆ°ä¸€ç§æ€æƒ³ï¼Œé‚£å°±æ˜¯å¤§æ•™å ‚ä¸é›†å¸‚ã€‚è¿™æ˜¯ä¸€ä¸ªä»€ä¹ˆæ¦‚å¿µå‘¢ï¼Ÿ&lt;/p>
&lt;p>å¯ä»¥è¿™æ ·ç†è§£ï¼Œä¼ ç»Ÿçš„è½¯ä»¶å¼€å‘è¿‡ç¨‹åƒå¤§å®¶åœ¨ä¿®å»ºä¸€ä¸ªå¤§æ•™å ‚ä¸€æ ·ï¼Œåªæœ‰æå°‘æ•°çš„ç²¾è‹±å·¥åŒ å‚ä¸å…¶ä¸­ã€‚è€Œå¼€æºè½¯ä»¶æå€¡çš„å¼€æ”¾å’ŒååŒï¼Œä¸»è¦æŒ‡å°†è½¯ä»¶å½“æˆä¸€ä¸ªå¤§é›†å¸‚ï¼Œæ¯ä¸ªäººéƒ½æ˜¯è‡ªç”±çš„ï¼Œå¤§å®¶éƒ½å¯ä»¥äº’ç›¸åä½œï¼Œæ¯ä¸ªäººè´¡çŒ®è‡ªå·±çš„ä¸€ä»½åŠ›é‡ã€‚æœ‰ä¸“é—¨ä¸€æœ¬ä¹¦ï¼Œæ¥é˜è¿°è¿™äº›ç†å¿µï¼Œå°±å«åšã€Šå¤§æ•™å ‚ä¸é›†å¸‚ã€‹ï¼Œæ„Ÿå…´è¶£å¯ä»¥çœ‹çœ‹ã€‚&lt;/p>
&lt;h2 id="å¼€æºè½¯ä»¶">å¼€æºè½¯ä»¶&lt;/h2>
&lt;p>èŠå®Œå¼€æºç†å¿µï¼Œæˆ‘ä»¬æœ€åæ¥è¯´è¯´å¼€æºè½¯ä»¶ã€‚&lt;/p>
&lt;p>&lt;img src="https://i.loli.net/2021/08/27/bI2HQaWx9ygTtMK.png" alt="img">&lt;/p>
&lt;p>å¼€æºè½¯ä»¶çš„å‰ææ˜¯å¼€æ”¾æºä»£ç ï¼Œè¿™æ˜¯å¿…ä¸å¯å°‘çš„ã€‚å¦å¤–ï¼Œå…¶å®æ¯ä¸ªå¼€æºè½¯ä»¶éƒ½æ˜¯æœ‰å¼€æºè®¸å¯è¯çš„ï¼Œåˆšæ‰æˆ‘ä»¬èŠ MongoDB çš„æ—¶å€™ä¹Ÿæåˆ°äº†ï¼Œå®ƒçš„è®¸å¯è¯æ˜¯ä¸è¢«è®¤å¯çš„ã€‚ &lt;strong>å¼€æºè½¯ä»¶æ ¸å¿ƒä»·å€¼è§‚å°±æ˜¯ä¸æ­§è§†ã€ä¸­ç«‹ã€å¼€æ”¾ã€‚&lt;/strong>&lt;/p>
&lt;p>ç›®å‰å›½å†…å¼€æºç”Ÿæ€æ•´ä½“å‘å¥½ï¼Œæœ‰å¾ˆå¤šè¿›å…¥å¼€æºè½¯ä»¶åŸºé‡‘ä¼šçš„é¡¹ç›®ï¼Œæ— è®ºæ˜¯è¿›å…¥ Apache è½¯ä»¶åŸºé‡‘ä¼šï¼Œè¿˜æ˜¯ CNCFï¼Œäº¦æˆ– Linux çš„åŸºé‡‘ä¼šã€‚å…¶ä¸­æœ‰å¾ˆå¤šçš„é¡¹ç›®ä¾‹å¦‚ ApacheAPISIX å°±æ˜¯ Apache åŸºé‡‘ä¼šæ——ä¸‹çš„é¡¶çº§å¼€æºé¡¹ç›®ï¼Œé€šè¿‡ Apache-2.0 License è¿›è¡Œåˆ†å‘ï¼Œè¿™æ˜¯ä¸€ç§éå¸¸å¼€æ”¾ä¸”å‹å¥½çš„åè®®ã€‚&lt;/p>
&lt;h1 id="å¦‚ä½•å‚ä¸å¼€æº">å¦‚ä½•å‚ä¸å¼€æº&lt;/h1>
&lt;p>å¾ˆå¤šäººå¯¹äºå‚ä¸å¼€æºæœ‰ä¸€äº›è¯¯è§£ã€‚æœ‰äº›äººè®¤ä¸ºï¼Œæˆ‘åœ¨ä½¿ç”¨ä¸€ä¸ªå¼€æºè½¯ä»¶ï¼Œå¹¶ä¸”åœ¨å®ƒçš„ GitHub ä¸Šé¢æäº¤äº† issueï¼Œæäº¤äº† pull request ä¹‹ç±»çš„ï¼Œè®¤ä¸ºå°±æ˜¯åœ¨å‚ä¸å¼€æºé¡¹ç›®äº†ã€‚è¿˜æœ‰ä¸€äº›äººè®¤ä¸ºï¼Œæˆ‘å†™äº†ä¸€ä¸ªè½¯ä»¶æˆ–è€…ç¨‹åºï¼Œæˆ‘æŠŠå®ƒæ”¾åœ¨ GitHub ä¸Šé¢ï¼Œä»£ç æ˜¯å…¬å¼€çš„ï¼Œè®¤ä¸ºè‡ªå·±åœ¨åšå¼€æºäº†ã€‚å…¶å®ä¸ç„¶ï¼ˆå°½ç®¡æˆ‘ä»¬ä¹Ÿè®¤å¯ä¸ºå¼€æºé¡¹ç›®æ‰€åšçš„è´¡çŒ®ï¼‰ã€‚&lt;/p>
&lt;p>&lt;strong>åšå¼€æºçš„å‰ææ˜¯åŸºäºä½ å¯¹å¼€æºæ–‡åŒ–çš„è®¤åŒã€‚&lt;/strong>&lt;/p>
&lt;p>&lt;img src="https://i.loli.net/2021/08/27/qn5g4yIlRzjLX61.png" alt="img">&lt;/p>
&lt;p>å¼€æºæ–‡åŒ–çš„æœ€ä¸»è¦æ˜¯å¹³ç­‰ã€ä¸­ç«‹ã€å¼€æ”¾ã€ä¸€è‡´ã€æ–‡æ¡£ä¼˜å…ˆã€‚ä¸€è‡´æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿæ„å‘³ç€ä½ çš„è½¯ä»¶åœ¨è¿™ä¸ªç¯å¢ƒå’Œåœ¨å¦å¤–ä¸€ä¸ªç¯å¢ƒå½“ä¸­äº§ç”Ÿçš„ç»“æœæ˜¯ä¸€æ ·çš„ã€‚&lt;/p>
&lt;p>é‚£ä¹ˆå¦‚ä½•é€‰æ‹©ä¸€ä¸ªå¼€æºé¡¹ç›®å‘¢ï¼Ÿ&lt;/p>
&lt;p>ä»æˆ‘ä¸ªäººè§’åº¦æ¥è®²ï¼Œ &lt;strong>é¦–å…ˆä¸€å®šæ˜¯å…´è¶£ä½¿ç„¶çš„&lt;/strong>ã€‚æˆ‘ä¸ä¼šé€‰æ‹©ä¸€ä¸ªè‡ªå·±å¹¶ä¸å¤ªæ„Ÿå…´è¶£çš„é¡¹ç›®å»å‚ä¸ã€‚å› ä¸ºè¿™æ ·å­æ˜¯ä¸å¯æŒç»­çš„ã€‚ä¹Ÿæœ‰å¾ˆå¤šäººé—®è¿‡æˆ‘ï¼Œå‚ä¸å¼€æºä½ èƒ½æ”¶è·ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆä½ æ„¿æ„èŠ±è´¹é‚£ä¹ˆå¤šçš„æ—¶é—´å’Œç²¾åŠ›åœ¨è¿™ä¸ªäº‹æƒ…ä¸Šé¢ï¼Ÿåœ¨å‚ä¸å¼€æºé¡¹ç›®çš„å‰æœŸï¼Œæˆ–è€…å¾ˆé•¿çš„ä¸€æ®µæ—¶é—´ï¼Œå…¶å®æ²¡æœ‰ä»»ä½•æ”¶è·ï¼Œå°¤å…¶æ˜¯ç‰©è´¨ä¸Šçš„æ”¶è·ä¸€ç‚¹éƒ½æ²¡æœ‰ã€‚æ‰€ä»¥è¿™ä¹Ÿæ˜¯æˆ‘ä¸ºä»€ä¹ˆæäº†ä¸€å®šæ˜¯è¦è‡ªå·±æ„Ÿå…´è¶£çš„ã€‚&lt;/p>
&lt;p>&lt;strong>å…¶æ¬¡ï¼ŒæŒç»­æŠ•å…¥éå¸¸é‡è¦ã€‚&lt;/strong> åœ¨ä¸€ä¸ªå¼€æºé¡¹ç›®ä¸­ï¼Œå¦‚æœä½ åªæ˜¯æƒ³èµ·æ¥äº†å‚ä¸ä¸€ä¸‹ï¼Œè€Œä¸æ˜¯æŒç»­åœ°æŠ•å…¥ï¼Œä¹Ÿä¸ä¼šæœ‰è¾ƒé«˜çš„ä»·å€¼äº§ç”Ÿã€‚&lt;/p>
&lt;p>&lt;strong>æœ€åï¼Œåº”è¯¥é€‰æ‹©ä¸€ä¸ªæ¯”è¾ƒæ´»è·ƒçš„ç¤¾åŒºã€‚&lt;/strong> å¦‚æœé¡¹ç›®çš„ç¤¾åŒºå·²ç»éå¸¸çš„ä¸æ´»è·ƒï¼Œä½ å‚ä¸åˆ°è¿™ä¸ªé¡¹ç›®å½“ä¸­å°±å¾ˆéš¾ã€‚æ¯”å¦‚ä½ æäº¤ issueï¼Œæäº¤ pull requestï¼Œå¾ˆå°‘æœ‰äººä¼šç»™ä½ å¯¹åº”çš„å›å¤ã€‚&lt;/p>
&lt;p>&lt;img src="https://i.loli.net/2021/08/27/oYwRbz7d85uq9mj.png" alt="img">&lt;/p>
&lt;p>è¿™é‡Œæˆ‘é€‰å–äº†ä¸‰ä¸ªé¡¹ç›®åšå¯¹æ¯”ï¼ŒApacheAPISIXã€Kong å’Œ tykã€‚ç›®å‰å¯ä»¥çœ‹åˆ°æ´»è·ƒåº¦æœ€é«˜çš„æ˜¯ Apache APISIXï¼Œæ¯å¤©éƒ½æœ‰å¾ˆå¤šçš„å¼€å‘è€…ä¼šå‚ä¸åˆ° Apache APISIX çš„ç¤¾åŒºä¸­ï¼Œå¸®åŠ©åˆ«äººè§£ç­”é—®é¢˜ï¼Œæˆ–è€…ä¸º Apache APISIX æäº¤ PR ç­‰ï¼Œå¤§å®¶å½¼æ­¤éƒ½ä¼šåœ¨è¿™ä¹ˆæ´»è·ƒçš„ç¤¾åŒºä¸­æˆé•¿å’Œæ”¶è·ã€‚&lt;/p>
&lt;p>&lt;strong>å¼€æºåä½œçš„ä¸­ç«‹ä¹Ÿæ˜¯ä¸€ç§å¾ˆé‡è¦çš„ä»·å€¼è§‚ã€‚&lt;/strong> æ— è®ºä½ æ˜¯æäº¤ä»£ç ï¼Œæˆ–è€…å›å¤åˆ«äººçš„ issueï¼Œè¿™äº›æˆ‘è®¤ä¸ºæ˜¯å…¶æ¬¡çš„ã€‚æœ€é‡è¦çš„æ˜¯åº”è¯¥åŸºäºå¹³ç­‰ã€å°Šé‡ã€ä¸­ç«‹çš„å¿ƒæ€å»å‚ä¸åˆ°é¡¹ç›®å½“ä¸­ã€‚&lt;/p>
&lt;p>æˆ‘ç°åœ¨ä¸»è¦å‚ä¸çš„æ˜¯ Apache APISIX å½“ä¸­çš„ä¸€ä¸ªå­é¡¹ç›® APISIX ingressï¼Œè¿˜æœ‰ä¸€ä¸ªæ˜¯ Kubernetes ingress-nginxã€‚è¿™ä¸¤ä¸ªé¡¹ç›®éƒ½æ˜¯ Kubernetes controller çš„é¡¹ç›®ï¼Œåšçš„äº‹æƒ…æ˜¯ç±»ä¼¼çš„ï¼Œä½†æ˜¯å‚ä¸å¼€æºé¡¹ç›®è¿‡ç¨‹ä¸­ï¼Œæˆ‘å§‹ç»ˆä¿æŒç€ä¸­ç«‹çš„æ€åº¦ï¼Œè€Œä¸ä¼šå› ä¸ºæˆ‘åœ¨æ”¯æµç§‘æŠ€å°±å¤§åŠ›å‘å±• APISIX ingress é¡¹ç›®ï¼Œé™åˆ¶ ingress-nginx é¡¹ç›®çš„å‘å±•ï¼Œè¿™æ˜¯ä¸å­˜åœ¨çš„ã€‚æ‰€ä»¥å¿ƒæ€å¾ˆé‡è¦ï¼Œåªæœ‰ä¿æŒä¸­ç«‹çš„å¿ƒæ€æ‰èƒ½æŒç»­åœ°å‚ä¸åˆ°å¼€æºé¡¹ç›®å½“ä¸­ã€‚&lt;/p>
&lt;h1 id="èŠèŠæˆ‘çš„æ•…äº‹">èŠèŠæˆ‘çš„æ•…äº‹&lt;/h1>
&lt;h2 id="æˆ‘çš„èŒä¸šè·¯å¾„">æˆ‘çš„èŒä¸šè·¯å¾„&lt;/h2>
&lt;p>æ¥ä¸‹æ¥èŠä¸€ä¸‹æˆ‘å‘å±•çš„è¿‡ç¨‹å’ŒèŒä¸šè§„åˆ’ä¸Šçš„é€‰æ‹©ã€‚&lt;/p>
&lt;p>æˆ‘çš„ç¬¬ä¸€ä»½å·¥ä½œ title æ˜¯ Web å¼€å‘å·¥ç¨‹å¸ˆï¼Œä¸»è¦æ˜¯åœ¨åšåç«¯å¼€å‘ï¼Œä¹Ÿä¼šå…¼é¡¾ä¸€éƒ¨åˆ†çš„å‰ç«¯å¼€å‘å·¥ä½œï¼Œä»¥åŠè¿ç»´åŠ DBA çš„ä»»åŠ¡ã€‚ç¬¬äºŒä»½å·¥ä½œæ˜¯åœ¨åšè¿ç»´å¼€å‘ï¼Œä¼šæ¶‰åŠä¸€éƒ¨åˆ†çš„è¿ç»´å·¥ä½œï¼Œä¸»ä¸šä¹Ÿè¿˜æ˜¯åœ¨åšå¼€å‘ã€‚å†åæ¥å°±æ˜¯åšå®¹å™¨åŒ–çš„å¼€å‘ï¼Œç°åœ¨æˆ‘æ˜¯æ”¯æµç§‘æŠ€çš„æŠ€æœ¯ä¸“å®¶ï¼Œåšçš„äº‹æƒ…ä¸»è¦æ˜¯åšå¼€æºåŸºç¡€è½¯ä»¶ã€‚è¿™äº›å¹´å‰ç«¯ã€åç«¯ã€è¿ç»´ã€æ•°æ®åº“ã€ä¸­é—´ä»¶ï¼ŒåŸºç¡€è½¯ä»¶ï¼Œå®¹å™¨åŒ–æŠ€æœ¯åŸºæœ¬éƒ½æœ‰æ¶‰åŠåˆ°ï¼Œè¿™æ˜¯æˆ‘çš„èŒä¸šæ•´ä½“è·¯çº¿ã€‚&lt;/p>
&lt;p>å¾ˆå¤šäººé—®è¿‡æˆ‘è¿™æ ·çš„é—®é¢˜ï¼Œç‰¹åˆ«æ˜¯åœ¨è·Ÿ HR æ²Ÿé€šçš„æ—¶å€™ã€‚ä»–ä»¬ä¼šé—®æˆ‘ï¼Œä½ ä¸ºä»€ä¹ˆä» Web å¼€å‘åšäº†è¿ç»´å¼€å‘ï¼Œè¿™æ˜¯ç¬¬ä¸€ä¸ªæ—¶é—´ç‚¹ã€‚ç¬¬äºŒä¸ªæ—¶é—´ç‚¹ï¼Œä¸ºä»€ä¹ˆä»è¿ç»´å¼€å‘ï¼Œåˆ°åšåŸºç¡€è½¯ä»¶ä»¥åŠå…¨èŒåšå¼€æºçš„äº‹æƒ…ã€‚&lt;/p>
&lt;p>æˆ‘åš Web å¼€å‘ï¼Œå¤§æ¦‚æ˜¯ä¸ƒå…«å¹´å‰ï¼Œé‚£ä¸ªæ—¶å€™åƒæœåŠ¡å™¨é€šå¸¸æ˜¯ 32G æˆ–è€… 64G çš„å†…å­˜ã€‚ä½†æ˜¯ç°åœ¨ï¼Œæˆ‘çš„ç¬”è®°æœ¬å·²ç»æ˜¯ 32G çš„å†…å­˜äº†ï¼Œå¯ä»¥æƒ³è±¡å½“æ—¶ç¡¬ä»¶èµ„æºæ˜¯æ¯”è¾ƒç´§å¼ çš„ã€‚åœ¨å®é™…åšåç«¯å¼€å‘ä¸­ï¼Œå½“ä¸šåŠ¡é‡ä¸Šæ¥çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¼šå»åšå¾ˆå¤šæ€§èƒ½ä¼˜åŒ–ç›¸å…³çš„å·¥ä½œã€‚&lt;/p>
&lt;p>é‚£ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬ä¼šèŠ±å¾ˆå¤šçš„æ—¶é—´å»åšä¼˜åŒ–ï¼Œç°åœ¨é‡åˆ°æ€§èƒ½çš„é—®é¢˜å¯èƒ½å¾ˆç®€å•ï¼ŒåŠ ä¸€å°æœºå™¨æ‰©å®¹ä¸€ä¸‹å°±æå®šäº†ã€‚ä½†åœ¨é‚£ä¸ªæ—¶å€™å¤§å®¶çš„ç¬¬ä¸€æƒ³æ³•å°±æ˜¯åšæ€§èƒ½ä¼˜åŒ–ï¼Œæ€ä¹ˆæ ·å¯ä»¥å……åˆ†åœ°å‹æ¦¨èµ„æºï¼Œè¿™æ˜¯æˆ‘ä»¬å½“æ—¶åšçš„äº‹æƒ…ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹å½“ä¸­ï¼Œååº•å±‚çš„äº‹æƒ…æˆ‘åšå¾—æ›´å¤šäº›ã€‚&lt;/p>
&lt;p>åœ¨ 2014 å¹´ï¼Œæˆ‘å¼€å§‹æ¥è§¦ Dockerã€‚2013 å¹´Docker é¦–æ¬¡å¼€æºï¼Œæˆ‘åœ¨å›½å†…ç®—æ˜¯æ¯”è¾ƒæ—©ä¸€æ‰¹æ¥è§¦åˆ° Docker çš„ã€‚æˆ‘å¾ˆå–œæ¬¢è¿™äº›åº•å±‚çš„æŠ€æœ¯ï¼ŒåŒ…æ‹¬å®¹å™¨åŒ–çš„æŠ€æœ¯ã€‚åœ¨èŒä¸šé€‰æ‹©çš„æ—¶å€™ï¼Œæˆ‘å°±ä» Web å¼€å‘è½¬å‘äº†è¿ç»´å¼€å‘ã€‚åšè¿ç»´å¼€å‘çš„æ—¶å€™ï¼Œå‰æœŸæ˜¯åšè¿ç»´å¹³å°åŒ–çš„å¼€å‘ï¼Œè¿ç»´å¹³å°åŒ–ã€è¿ç»´è‡ªåŠ¨åŒ–ã€åŒ…æ‹¬ GitOps å’ŒChatOps ç­‰ç­‰ã€‚&lt;/p>
&lt;p>éšç€ Kubernetes åœ¨å®¹å™¨åŒ–ç¼–æ’æŠ€æœ¯äº‰å¤ºæˆ˜ä¸­æˆä¸ºäº†ç‹è€…ã€‚å¾ˆå¤šå…¬å¸å¼€å§‹åšå®¹å™¨åŒ–æ”¹é€ ï¼Œæˆ‘ä»¬ä¹Ÿé€‰æ‹©äº† Kubernetes åšè‡ªå·±çš„å®¹å™¨å¹³å°ã€‚è¿™ä¸ªæ—¶å€™ï¼Œç”±äºæˆ‘åœ¨å®¹å™¨åŒ–æŠ€æœ¯è¿™æ–¹é¢ï¼Œç§¯æ·€ç›¸å¯¹æ¯”è¾ƒå¤šä¸€äº›ï¼Œè‡ªç„¶ä¹Ÿå°±æ‰¿æ‹…äº†ç›¸å…³çš„å·¥ä½œå†…å®¹ã€‚&lt;/p>
&lt;p>å†åæ¥å·¥ä½œçš„é€‰æ‹©ï¼Œå› ä¸ºæˆ‘æƒ³è¦æ›´å¤šçš„è‡ªç”±ï¼Œä¹Ÿæƒ³æ›´å€¾å‘äºè‡ªå·±çš„å…´è¶£ï¼Œè€Œåœ¨å…¬å¸åšé¡¹ç›®çš„è¯ï¼Œç¡®å®ä¸å¤Ÿè‡ªç”±ï¼Œæ‰€ä»¥æˆ‘ç°åœ¨çš„å·¥ä½œæ˜¯å…¨èŒåšå¼€æºï¼Œæˆ‘å¯ä»¥åœ¨ä»»ä½•ä¸€ä¸ªæˆ‘å–œæ¬¢å·¥ä½œçš„æ—¶é—´ï¼Œæˆ–è€…æƒ³è¦å·¥ä½œçš„æ—¶é—´å»å·¥ä½œã€‚&lt;/p>
&lt;p>&lt;strong>æœ‰ä¸€äº›äººè¯„ä»·æˆ‘è¯´ï¼Œæˆ‘æ˜¯æŠŠæˆ‘çš„å…´è¶£åšæˆäº†æˆ‘çš„å·¥ä½œ&lt;/strong>ã€‚ å…¶å®æ˜¯çš„ï¼Œå³ä½¿æ²¡æœ‰è¿™ä»½å·¥ä½œï¼Œæˆ‘ä¹Ÿä¼šæŒç»­åœ°å»åšå¼€æºã€‚å·¥ä½œæ—¶é—´åšå¼€æºï¼Œé—²æš‡çš„æ—¶é—´ä¹Ÿåœ¨åšå¼€æºï¼Œè¿™ä¸ªæœ¬èº«æ¥è®²ä¹Ÿæ²¡æœ‰ä»€ä¹ˆç•Œé™ã€‚è¿™æ˜¯æˆ‘ç›®å‰çš„ç°çŠ¶ï¼Œè‡ªç”±ã€å…¨èŒåšå¼€æºçš„å·¥ç¨‹å¸ˆã€‚&lt;/p>
&lt;h2 id="èŒä¸šè§„åˆ’">èŒä¸šè§„åˆ’&lt;/h2>
&lt;p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹èŒä¸šè§„åˆ’ã€‚å¤§å®¶å¯èƒ½å¯¹äºæˆ‘åˆ°åº•æ˜¯ä»€ä¹ˆæ ·çš„æƒ…å†µå¹¶ä¸å…³å¿ƒï¼Œæ›´åº”è¯¥æƒ³çŸ¥é“åœ¨å¼€æºçš„åœºæ™¯é‡Œå¦‚ä½•åšèŒä¸šè§„åˆ’ã€‚&lt;/p>
&lt;p>æˆ‘ç°åœ¨ä¸€æ–¹é¢æ˜¯åšå¼€æºç›¸å…³çš„å·¥ä½œï¼Œå†æœ‰ä¸€æ–¹é¢ï¼Œä¹Ÿåœ¨åšè‡ªåª’ä½“ã€‚ &lt;strong>æˆ‘è®¤ä¸ºåšèŒä¸šè§„åˆ’æœ€é‡è¦çš„ä¸€ç‚¹æ˜¯åŸºäºè‡ªå·±çš„å…´è¶£ã€‚&lt;/strong> ä¸€å¤©ä¸€å…±å°± 24 å°æ—¶ï¼Œé™¤å»ç¡è§‰çš„æ—¶é—´ï¼Œå‰©ä¸‹çš„å‡ ä¸ªå°æ—¶å¦‚æœåšçš„æ˜¯è‡ªå·±ä¸æ„Ÿå…´è¶£çš„å·¥ä½œï¼Œä¸€ç›´å¤„äºä¸å¼€å¿ƒçš„çŠ¶æ€ï¼Œé‚£çœŸæ˜¯å¤ªæƒ¨äº†ã€‚ &lt;strong>æ‰€ä»¥ä¸€å®šè¦é€‰æ‹©è‡ªå·±å–œæ¬¢çš„æ„Ÿå…´è¶£çš„å·¥ä½œï¼Œè¿™æ˜¯ç¬¬ä¸€ç‚¹ã€‚&lt;/strong>&lt;/p>
&lt;p>&lt;strong>ç¬¬äºŒç‚¹å°±æ˜¯æ ¸å¿ƒç«äº‰åŠ›ã€‚&lt;/strong> æ—¢ç„¶æ˜¯ç¨‹åºå‘˜ï¼Œæ— è®ºæ˜¯å‰ç«¯ã€åç«¯ã€è¿ç»´ï¼Œè¿˜æ˜¯å…¶ä»–å¼€å‘ï¼Œè‡ªèº«çš„æŠ€æœ¯å®åŠ›æ‰æ˜¯æ ¸å¿ƒç«äº‰åŠ›ã€‚ç°åœ¨æœ‰ä¸ªè¯å¾ˆæµè¡Œï¼Œé‚£å°±æ˜¯â€œå†…å·â€ï¼Œä¸ºä»€ä¹ˆå†…å·ä¼šè®©äººäº§ç”Ÿç„¦è™‘æ„Ÿå‘¢ï¼Ÿç„¦è™‘åˆ°åº•æ˜¯æ€ä¹ˆæ¥çš„ï¼Ÿ&lt;/p>
&lt;p>æˆ‘æ˜¯è¿™ä¹ˆç†è§£çš„ï¼Œç„¦è™‘å°±æ˜¯åˆ«äººåœ¨å­¦ï¼Œæˆ‘ä¸å­¦ï¼Œæˆ‘å¯èƒ½ä¼šå¾ˆç„¦è™‘ï¼›åˆ«äººä¼šï¼Œæˆ‘ä¸ä¼šï¼Œæˆ‘ä¹Ÿä¼šç„¦è™‘ï¼›åˆ«äººçŸ¥é“ï¼Œæˆ‘ä¸çŸ¥é“ï¼Œé‚£æ›´ç„¦è™‘ï¼›è¿˜æœ‰å°±æ˜¯åˆ«äººåœ¨èŠè¿™äº›ï¼Œæˆ‘å¬çš„ä¸€è„¸æ‡µé€¼ï¼Œè¿™äº›éƒ½æ˜¯ç„¦è™‘çš„äº§ç”ŸåŸå› ã€‚&lt;/p>
&lt;p>é‚£å¦‚ä½•åº”å¯¹è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿé‚£å°±æ˜¯æå‡ä½ çš„æ ¸å¿ƒç«äº‰åŠ›ã€‚é¦–å…ˆé€‰ä¸€ä¸ªè‡ªå·±æœ€æ„Ÿå…´è¶£çš„æ–¹å‘ï¼Œæå‡è‡ªå·±çš„æŠ€æœ¯æ·±åº¦ï¼Œè¿™æ ·æ‰èƒ½æŒç»­åœ°æå‡è‡ªå·±çš„æ ¸å¿ƒç«äº‰åŠ›ã€‚æŠ€æœ¯æ·±åº¦å°±è·Ÿæµ·é¢ä¸Šçš„å†°å±±å·®ä¸å¤šï¼Œæµ·é¢ä¸Šä½ å¯ä»¥çœ‹åˆ°çš„åªæœ‰é‚£ä¹ˆä¸€å°ç‚¹ï¼Œä½†åœ¨æµ·é¢ä¹‹ä¸‹è¿˜æœ‰å¾ˆå¤šå¾ˆå¤šã€‚&lt;/p>
&lt;p>æŠ€æœ¯çš„æ·±åº¦æ˜¯æ— é™çš„ï¼Œå½“ä½ æŠŠæŠ€æœ¯æ·±åº¦æå‡åˆ°ä¸€å®šç¨‹åº¦ä¹‹åï¼Œä½ ä¼šå‘ç°å¥½åƒæˆ‘ä¸çŸ¥é“çš„ä¸œè¥¿è¶Šæ¥è¶Šå¤šï¼Œè¿™æ˜¯ä¸€ä¸ªæŠ€æœ¯äººå¸¸å¸¸ä¼šæœ‰çš„æ„Ÿè§‰ã€‚å¦‚æœä½ å¾ˆé•¿æ—¶é—´æ²¡æœ‰è¿™ç§æ„Ÿè§‰äº†ï¼Œè®¤ä¸ºå¥½åƒæ‰€æœ‰çš„ä¸œè¥¿æˆ‘éƒ½çŸ¥é“ï¼Œæ‰€æœ‰é¢ä¸´çš„é—®é¢˜æˆ‘éƒ½èƒ½è§£å†³ã€‚è¿™ä¸ªæƒ…å†µæˆ‘è®¤ä¸ºï¼Œä½ å¯èƒ½éœ€è¦å»å‚ä¸ä¸€äº›å¼€æºé¡¹ç›®ï¼Œæˆ–è€…å‡ºå»è·Ÿåˆ«äººäº¤æµä¸€ä¸‹ï¼Œæˆ–è€…æ¢ä¸€ä»½å·¥ä½œï¼Œå¼€é˜”ä¸€ä¸‹è‡ªå·±çš„çœ¼ç•Œã€‚ &lt;strong>å½“ä½ çš„æŠ€æœ¯æ·±åº¦åˆ°äº†ä¸€å®šç¨‹åº¦ï¼Œä¾‹å¦‚èƒ½ cover ä½é¢ä¸´çš„ç»å¤§å¤šæ•°é—®é¢˜æ—¶å€™ï¼Œæˆ‘å»ºè®®ä½ åœ¨è¿™ä¸ªæ—¶å€™å°½é‡æå‡ä¸€ä¸‹è‡ªå·±çš„æŠ€æœ¯å¹¿åº¦ã€‚&lt;/strong>&lt;/p>
&lt;p>&lt;strong>ç¬¬ä¸‰ç‚¹æˆ‘è¦è¯´çš„æ˜¯ä»·å€¼ã€‚&lt;/strong> ä»·å€¼è¿™ä¸ªæ¦‚å¿µéå¸¸å®½æ³›ï¼Œåœ¨åšå·¥ä½œä¸­æœ€ç›´è§‚ä½“ç°ä»·å€¼çš„ï¼Œé‚£å°±æ˜¯è–ªèµ„ã€‚å½“ç„¶ï¼Œè–ªèµ„åªæ˜¯ä¸€æ–¹é¢ï¼Œå¦ä¸€æ–¹é¢åœ¨äºä½ èƒ½å¤Ÿæ”¶è·åˆ°ä»€ä¹ˆã€‚&lt;/p>
&lt;p>æˆ‘ä»¬å›åˆ°åˆšæ‰ç¬¬ä¸€ç‚¹ï¼Œä¹Ÿå°±æ˜¯å·¥ä½œå¼€ä¸å¼€å¿ƒçš„äº‹æƒ…ã€‚å¦‚æœè¯´ä½ çš„å·¥ä½œè–ªèµ„æ˜¯ä»¤äººæ»¡æ„çš„ï¼ŒåŒæ—¶ä½ åˆèƒ½æ”¶è·ä¸€äº›å¼€å¿ƒï¼Œé‚£å°±èµšåˆ°äº†ã€‚å› ä¸ºå…¬å¸æœ¬æ¥ç»™ä½ æä¾›çš„ï¼Œæ˜¯ä¸€ç§é›‡ä½£å…³ç³»ï¼Œä»–ç»™åˆ°ä½ çš„æœ¬è´¨ä¸Šæ¥è®²åªæœ‰ä½ çš„è–ªèµ„ã€‚è€Œä½ åšè¿™ä»½å·¥ä½œçš„åŒæ—¶ï¼Œæ”¶è·äº†ä¸€äº›ä¹è¶£ï¼Œå…¶å®ä¹Ÿå°±æ˜¯èµšåˆ°äº†ã€‚ &lt;strong>æ”¶è·å¼€å¿ƒï¼Œè¿™æ˜¯æˆ‘è¦æåˆ°ä»·å€¼å½“ä¸­çš„ç¬¬ä¸€ç‚¹ã€‚&lt;/strong>&lt;/p>
&lt;p>æ­¤å¤–ï¼Œåœ¨å·¥ä½œçš„è¿‡ç¨‹å½“ä¸­ï¼Œä½ è‚¯å®šä¸æ˜¯ä¸€ä¸ªäººåœ¨ç‹¬è‡ªæˆ˜æ–—ï¼Œ &lt;strong>ä½ ä¹Ÿä¼šæ”¶è·åˆ°ä¸€äº›ä¼™ä¼´ï¼Œè¿™æ˜¯ç¬¬äºŒç‚¹&lt;/strong>ã€‚&lt;/p>
&lt;p>ç¬¬ä¸‰ç‚¹ï¼Œåœ¨è¿™ä»½å·¥ä½œå½“ä¸­ï¼Œä½ è¿˜å®ç°è‡ªå·±ä»·å€¼çš„æå‡ã€‚è¿™äº›ä»·å€¼å¯ä»¥ç†è§£ä¸ºå¿ƒç†å­¦å½“ä¸­æˆ–è€…ç¤¾ä¼šå­¦å½“ä¸­æåˆ°çš„è®¤å¯ï¼Œ &lt;strong>å½“ä½ è·å¾—åˆ«äººæˆ–è€…ç¤¾ä¼šçš„ä¸€äº›è®¤å¯&lt;/strong>ã€‚è¿™ä¹Ÿæ˜¯ä»·å€¼çš„ä¸€éƒ¨åˆ†ã€‚&lt;/p>
&lt;h2 id="ç¨‹åºå‘˜çš„å‰¯ä¸š">ç¨‹åºå‘˜çš„å‰¯ä¸š&lt;/h2>
&lt;p>æœ€åæˆ‘ä»¬æ¥èŠèŠç¨‹åºå‘˜çš„å‰¯ä¸šï¼Œè¿™ä¸ªäº‹æƒ…ä¹Ÿè®¸å¤§å®¶ä¼šæ¯”è¾ƒæ„Ÿå…´è¶£ä¸€äº›ã€‚åœ¨è°ˆåˆ°å‰¯ä¸šçš„æ—¶å€™ï¼Œä½ è¦å…ˆè¯„ä¼°ä¸€ä¸‹è‡ªå·±èƒ½åšä»€ä¹ˆï¼Œé‡åŠ›è€Œè¡Œåœ¨ä»»ä½•æƒ…å†µä¸‹éƒ½æ˜¯æ¯”è¾ƒæ­£ç¡®çš„ã€‚æ‰¿è®¤è‡ªå·±åœ¨æŸäº›æ–¹é¢ä¸æ“…é•¿ï¼Œæˆ–è€…æŸäº›æ–¹é¢ä¸å¤ªæ‡‚è¿™ä¸ªäº‹æƒ…å…¶å®æ²¡æœ‰ä»€ä¹ˆçš„ï¼Œå¦‚æœå¼ºè¡Œåšä¸æ“…é•¿çš„äº‹æƒ…ï¼Œå¯èƒ½å¾—åˆ°çš„ç»“æœå¹¶ä¸å¤ªå¥½ã€‚&lt;/p>
&lt;p>æˆ‘æ¥èŠä¸€ä¸‹æˆ‘è‡ªå·±ä¸ªäººåšçš„ä¸€äº›ä¸œè¥¿ã€‚æˆ‘ä¹‹å‰å†™äº†ä¸€ä¸ªä¸“æ ï¼Œå« ã€ŠKubernetes ä¸Šæ‰‹å®è·µã€‹ã€‚åæ¥åˆå†™äº†ä¸€ä¸ªä¸“æ ï¼Œå«åš ã€ŠDocker æ ¸å¿ƒçŸ¥è¯†å¿…ä¼šã€‹ã€‚æˆ‘è‡ªå·±åœ¨è¿™æ–¹é¢ç›¸å¯¹æ¥è¯´ç§¯ç´¯æ¯”è¾ƒå¤šä¸€ç‚¹ï¼Œè¿™é‡Œå°±ä¸å¤šè¯´äº†ï¼Œè¯´å¤šäº†å°±å˜æˆå¹¿å‘Šäº†ï¼ˆç¬‘ï¼‰ï¼Œä¸è¿‡ä½ å¯ä»¥å…³æ³¨ä¸‹æˆ‘çš„å…¬ä¼—å·ï¼šMoeLove ï¼Œæˆ‘ä¼šè·Ÿä½ åˆ†äº«ä¸€äº›æœ‰ä»·å€¼çš„æŠ€æœ¯å’Œå†…å®¹ã€‚&lt;/p>
&lt;p>å¾ˆå¤šäººå¯èƒ½ä¼šé—®æˆ‘èƒ½åšä»€ä¹ˆï¼Ÿæˆ‘è®¤ä¸ºå…¶å®è¿˜æ˜¯æœ‰å¾ˆå¤šçš„äº‹æƒ…å¯ä»¥åšï¼Œå…·ä½“è‚¯å®šçœ‹ä¸ªäººçš„é€‰æ‹©ã€‚åšå‰¯ä¸šèƒ½ä¸ºè‡ªå·±å¸¦æ¥æœ€ç›´è§‚çš„ï¼Œå¤§å®¶å¯èƒ½è®¤ä¸ºæ˜¯é‡‘é’±æ”¶ç›Šã€‚ä½†å®é™…ä¸Šå¦‚æœä½ æŠŠè€—è´¹çš„æ—¶é—´ç²¾åŠ›æŠ˜ç®—ä¸€ä¸‹ï¼Œå¯èƒ½ä¼šå‘ç°è¿™ä¸ªäº‹æƒ…æ”¶ç›Šå¾ˆå°‘ã€‚é™ªé™ªå®¶äººã€è·Ÿçˆ±äººçº¦ä¸ªä¼šï¼Œå‡ºå»ç©ä¸€è¶Ÿï¼Œå¯èƒ½èƒ½æ”¶è·çš„æ›´å¤šã€‚ç°åœ¨æ•´ä½“æ¥è¯´å°±æ˜¯ä¸¤ç§é€‰æ‹©ï¼Œä¸€æ˜¯ç”¨æ—¶é—´æ¢é’±ï¼Œå¦ä¸€ç§æ˜¯ç”¨é’±æ¢æ—¶é—´ã€‚å¾ˆå¤šäº‹æƒ…å¦‚æœå¹´è½»çš„æ—¶å€™é”™è¿‡äº†è¿˜æ˜¯ä¼šå¾ˆé—æ†¾çš„ã€‚æ‰€ä»¥è¿˜æ˜¯è¦å»ºè®®å¤§å®¶æ ¹æ®è‡ªå·±çš„æƒ…å†µè¡¡é‡ä¸€ä¸‹ã€‚&lt;/p>
&lt;p>ä»¥ä¸Šæ˜¯ä»Šå¤©çš„å…¨éƒ¨åˆ†äº«å†…å®¹ï¼Œæ¥ç®€å•æ€»ç»“ä¸‹ï¼šç¬¬ä¸€éƒ¨åˆ†èŠäº†å¹³ç­‰ã€ä¸­ç«‹ã€è‡ªç”±çš„å¼€æºæ–‡åŒ–ï¼›æ¥ç€è°ˆäº†å¦‚ä½•å‚ä¸å¼€æºï¼Œå¿ƒæ€ä¸€å®šè¦æ‘†æ­£ï¼ŒåŒæ—¶è¦åŸºäºè‡ªå·±ä¸ªäººçš„å…´è¶£ï¼›æœ€åèŠåˆ°ä¸€äº›ä¸ªäººæˆé•¿ï¼Œè¿˜æ˜¯å»ºè®®å¤§å®¶åº”æ ¹æ®è‡ªå·±çš„å®é™…æƒ…å†µï¼Œåˆç†åœ°è§„åˆ’ä¸€ä¸‹è‡ªå·±çš„çš„èŒä¸šç”Ÿæ¶¯ï¼Œè°¢è°¢å¤§å®¶ã€‚&lt;/p>
&lt;p>è§†é¢‘å›æ”¾ï¼šhttps://www.upyun.com/opentalk/463.html&lt;/p>
&lt;hr>
&lt;p>æ¬¢è¿è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://gitee.com/tlrr/awesome/raw/master/2020-9-9/1599632564572-mp-qrcode.png" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category><category domain="https://moelove.info/tags/OpenSource/">OpenSource</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| Kubernetes v1.22.0 æ­£å¼å‘å¸ƒï¼Œæ–°ç‰¹æ€§ä¸€è§ˆï¼</title><link>https://moelove.info/2021/08/05/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Kubernetes-v1.22.0-%E6%AD%A3%E5%BC%8F%E5%8F%91%E5%B8%83%E6%96%B0%E7%89%B9%E6%80%A7%E4%B8%80%E8%A7%88/</link><guid isPermaLink="true">https://moelove.info/2021/08/05/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Kubernetes-v1.22.0-%E6%AD%A3%E5%BC%8F%E5%8F%91%E5%B8%83%E6%96%B0%E7%89%B9%E6%80%A7%E4%B8%80%E8%A7%88/</guid><pubDate>Thu, 05 Aug 2021 05:23:50 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container" title="k8sç”Ÿæ€">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;p>Kubernetes v1.22 å·²ç»åœ¨ä»Šå¤©æ­£å¼å‘å¸ƒäº†ï¼Œè¿™æ˜¯ 2021 å¹´çš„ç¬¬äºŒä¸ªæ­£å¼å‘å¸ƒçš„ç‰ˆæœ¬ã€‚æ­¤ç‰ˆæœ¬ä¸­å…±åŒ…å« 53 é¡¹å¢å¼ºæ›´æ–°ï¼Œå…¶ä¸­ 13 é¡¹è¾¾åˆ° stableï¼Œ24 é¡¹è¾¾åˆ° beta è¿˜æœ‰ 16 é¡¹ä¸º alphaã€‚å½“ç„¶ï¼Œä¹Ÿæœ‰ 3 é¡¹ç‰¹æ€§è¢«æ ‡è®°ä¸ºåºŸå¼ƒã€‚&lt;/p>
&lt;p>ä»ä»Šå¹´çš„ 4 æœˆä»½ï¼ŒKubernetes çš„å‘å¸ƒèŠ‚å¥ç”±åŸæ¥çš„æ¯ 3 ä¸ªæœˆä¸€ä¸ªç‰ˆæœ¬ä¿®æ”¹æˆäº†æ¯ 4 ä¸ªæœˆä¸€ä¸ªç‰ˆæœ¬ï¼Œè¿™ä¹Ÿæ˜¯ç¬¬ä¸€ä¸ªåº”ç”¨äº†æ­¤èŠ‚å¥çš„é•¿å‘¨æœŸç‰ˆæœ¬ã€‚æˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹æœ‰å“ªäº›å€¼å¾—æ³¨æ„çš„å˜æ›´å§ï¼&lt;/p>
&lt;h3 id="server-side-apply-ç‰¹æ€§è¾¾åˆ°-ga">Server-side Apply ç‰¹æ€§è¾¾åˆ° GA&lt;/h3>
&lt;p>&lt;a href="https://kubernetes.io/docs/reference/using-api/server-side-apply/">Server-side Apply&lt;/a> è¿™ä¸ªç‰¹æ€§ä¸»è¦ç›®æ ‡æ˜¯æŠŠé€»è¾‘ä» &lt;code>kubectl apply&lt;/code> ç§»åŠ¨åˆ° kube-apiserver ä¸­ï¼Œè¿™å¯ä»¥ä¿®å¤å½“å‰é‡åˆ°çš„å¾ˆå¤šæœ‰å…³æ‰€æœ‰æƒå†²çªçš„é—®é¢˜ã€‚&lt;/p>
&lt;p>è¿˜è®°å¾—åœ¨ä¹‹å‰çš„ã€K8Sç”Ÿæ€å‘¨æŠ¥ã€ä¸­æˆ‘æ›¾ä¸ºä½ ä»‹ç»è¿‡ Kubernetes æ–°å¢çš„ &lt;code>.meta.managedFields&lt;/code> å—ï¼ŸServer-side Apply å½“å‰å°±æ˜¯é€šè¿‡æ­¤ç‰¹æ€§æ¥è·Ÿè¸ªå¯¹è±¡å­—æ®µçš„æ›´æ”¹çš„ã€‚&lt;/p>
&lt;p>åŒæ—¶æ­¤ç‰¹æ€§çš„å¥½å¤„åœ¨ä¸ä½ å¯ä»¥ç›´æ¥é€šè¿‡ API å®Œæˆå£°æ˜å¼é…ç½®çš„æ“ä½œï¼Œè€Œæ— éœ€ä¾èµ–äºç‰¹å®šçš„ &lt;code>kubectl apply&lt;/code> å‘½ä»¤ï¼Œæ¯”å¦‚ç›´æ¥é€šè¿‡ &lt;code>curl&lt;/code> å³å¯å®Œæˆã€‚&lt;/p>
&lt;p>æ­¤åŠŸèƒ½çš„ç”¨æ³•å¦‚ä¸‹ï¼š&lt;/p>
&lt;pre>&lt;code>kubectl apply --server-side [--dry-run=server]
&lt;/code>&lt;/pre>&lt;h3 id="pod-security-policy-çš„æ›¿ä»£å“">Pod Security Policy çš„æ›¿ä»£å“&lt;/h3>
&lt;p>&lt;a href="https://github.com/kubernetes/website/blob/dev-1.22/content/en/docs/concepts/security/pod-security-admission.md">PodSecurity admission controller&lt;/a> æ˜¯&lt;a href="https://sysdig.com/blog/kubernetes-1-21-whats-new/#5">åœ¨ Kubernets v1.21 ä¸­è¢«åºŸå¼ƒçš„ Pod Security Policies &lt;/a> çš„æ›¿ä»£å“ã€‚&lt;/p>
&lt;p>è¿™ä¸ª admission controller å¯ä»¥æŒ‰ namespace çº§åˆ«å¯ç”¨ &lt;a href="https://kubernetes.io/docs/concepts/security/pod-security-standards/">Pod Security Standards&lt;/a> ï¼Œå¯ä»¥æœ‰ä»¥ä¸‹ä¸‰ç§æ¨¡å¼ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;strong>enforce&lt;/strong>: è¿åç­–ç•¥çš„ Pod å°†è¢«æ‹’ç»ï¼›&lt;/li>
&lt;li>&lt;strong>audit&lt;/strong>ï¼šè¿åç­–ç•¥çš„ Pod å°†ä¼šæ·»åŠ å®¡è®¡æ³¨é‡Šï¼Œä½†å…¶ä»–æƒ…å†µä¸‹éƒ½å…è®¸ï¼›&lt;/li>
&lt;li>&lt;strong>warn&lt;/strong>ï¼šè¿åç­–ç•¥çš„ Pod å°†ä¼šè§¦å‘é¢å‘ç”¨æˆ·çš„è­¦å‘Šï¼›&lt;/li>
&lt;/ul>
&lt;p>å¯é€šè¿‡å¦‚ä¸‹é…ç½®æ–‡ä»¶è¿›è¡Œæ§åˆ¶ï¼š&lt;/p>
&lt;pre>&lt;code>apiVersion: apiserver.config.k8s.io/v1
kind: AdmissionConfiguration
plugins:
- name: PodSecurity
configuration:
defaults: # Defaults applied when a mode label is not set.
enforce: &amp;lt;default enforce policy level&amp;gt;
enforce-version: &amp;lt;default enforce policy version&amp;gt;
audit: &amp;lt;default audit policy level&amp;gt;
audit-version: &amp;lt;default audit policy version&amp;gt;
warn: &amp;lt;default warn policy level&amp;gt;
warn-version: &amp;lt;default warn policy version&amp;gt;
exemptions:
usernames: [ &amp;lt;array of authenticated usernames to exempt&amp;gt; ]
runtimeClassNames: [ &amp;lt;array of runtime class names to exempt&amp;gt; ]
namespaces: [ &amp;lt;array of namespaces to exempt&amp;gt; ]
&lt;/code>&lt;/pre>&lt;h3 id="node-swap-æ”¯æŒ">Node swap æ”¯æŒ&lt;/h3>
&lt;p>æ­¤ç‰¹æ€§ç°åœ¨æ˜¯ Alpha é˜¶æ®µã€‚&lt;/p>
&lt;p>è™½ç„¶ swap å¹¶ä¸å¤Ÿå¿«ï¼Œä½†æ˜¯ç°åœ¨æœ‰å¾ˆå¤šåœºæ™¯éƒ½æ˜¯éœ€è¦ç”¨åˆ°å®ƒçš„ï¼Œå°¤å…¶æ˜¯ä¸€äº› Java å’Œ Node åº”ç”¨ã€‚&lt;/p>
&lt;p>åœ¨ Kubernetes çš„ issue åˆ—è¡¨ä¸­æœ‰ä¸€ä¸ªå­˜åœ¨äº† 5 å¹´å·¦å³çš„è®¨è®ºï¼Œå°±æ˜¯é’ˆå¯¹äºèƒ½å¦å¼€å¯ swap æ”¯æŒçš„ã€‚å½“å‰è¿™ä¸ªç‰¹æ€§ä¸€æ—¦å¼€å¯å°±æ˜¯é’ˆå¯¹äºæ•´ä¸ª Node çš„ï¼Œå¹¶ä¸èƒ½ç²¾ç¡®åˆ°æŸä¸ª Pod ä¸­ã€‚&lt;/p>
&lt;p>ä½ å¯ä»¥é€šè¿‡å¦‚ä¸‹æ­¥éª¤å¯ç”¨æ­¤ç‰¹æ€§ï¼š&lt;/p>
&lt;ul>
&lt;li>åœ¨ Node ä¸­å¯ç”¨ swapï¼›&lt;/li>
&lt;li>å¼€å¯ kubelet çš„ &lt;code>NodeMemorySwap&lt;/code> ç‰¹æ€§ï¼›&lt;/li>
&lt;li>è®¾ç½® &lt;code>--fail-on-swap=false&lt;/code>&lt;/li>
&lt;li>å¯é€‰åœ¨ Kubelet çš„é…ç½®ä¸­å¢åŠ  &lt;code>MemorySwap.SwapBehavior=UnlimitedSwap&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>æ›´å¤šå†…å®¹å¯å‚è€ƒï¼šhttps://github.com/kubernetes/enhancements/tree/master/keps/sig-node/2400-node-swap&lt;/p>
&lt;h3 id="å¤–éƒ¨å®¢æˆ·ç«¯å‡­è¯æä¾›å·¥å…·">å¤–éƒ¨å®¢æˆ·ç«¯å‡­è¯æä¾›å·¥å…·&lt;/h3>
&lt;p>è¿™ä¸ªåŠŸèƒ½å…è®¸ client-go ä½¿ç”¨å¤–éƒ¨å·¥å…·è¿›è¡Œèº«ä»½éªŒè¯ï¼Œæ¯”å¦‚ LDAPã€Kerberosã€OAuth2ã€SAML ç­‰ã€‚è¿™ä¸ªç‰¹æ€§æ˜¯ä» v1.10 å¼€å§‹å¼•å…¥çš„ã€‚&lt;/p>
&lt;p>ä½¿ç”¨æ­¤ç‰¹æ€§çš„è¯ï¼Œéœ€è¦ä½ åœ¨ kubeconfig é…ç½®æ–‡ä»¶ä¸­ä½œä¸º user å­—æ®µä¸‹çš„å­—æ®µè¿›è¡Œé…ç½®ã€‚æ¯”å¦‚ï¼š&lt;/p>
&lt;pre>&lt;code>apiVersion: v1
kind: Config
users:
- name: my-user
user:
exec:
command: &amp;quot;example-client-go-exec-plugin&amp;quot;
apiVersion: &amp;quot;client.authentication.k8s.io/v1beta1&amp;quot;
env:
- name: &amp;quot;FOO&amp;quot;
value: &amp;quot;bar&amp;quot;
args:
- &amp;quot;arg1&amp;quot;
- &amp;quot;arg2&amp;quot;
provideClusterInfo: true
clusters:
...
&lt;/code>&lt;/pre>&lt;p>åœ¨ &lt;code>user.exec&lt;/code>å­—æ®µä¸‹é…ç½®å¯ç”¨çš„ client-go-exec plugin å³å¯ã€‚ç°åœ¨ä¹Ÿæœ‰ä¸€ä¸ªç¤ºä¾‹é¡¹ç›®å¯ä¾›å‚è€ƒ &lt;a href="https://github.com/ankeesler/sample-exec-plugin">https://github.com/ankeesler/sample-exec-plugin&lt;/a>&lt;/p>
&lt;h3 id="å¯ç´¢å¼•çš„-job-api">å¯ç´¢å¼•çš„ Job API&lt;/h3>
&lt;p>åœ¨ Kubernetes v1.21 ä¸­æ–°å¢çš„å¯ç´¢å¼• Job API å¯ä»¥æ›´åŠ æ–¹ä¾¿çš„è°ƒåº¦å¹¶è¡ŒåŒ–çš„ Jobã€‚ä½ å¯ä»¥ä½¿ç”¨å¦‚ä¸‹çš„æ–¹å¼é€šè¿‡ç¯å¢ƒå˜é‡è®© Job ä¸­çš„ Pod çŸ¥é“è‡ªå·±çš„ç´¢å¼•ï¼š&lt;/p>
&lt;pre>&lt;code>[...]
spec:
subdomain: my-job-svc
containers:
- name: task
image: registry.example.com/processing-image
command: [&amp;quot;./process&amp;quot;, &amp;quot;--index&amp;quot;, &amp;quot;$JOB_COMPLETION_INDEX&amp;quot;, &amp;quot;--hosts-pattern&amp;quot;, &amp;quot;my-job-{{.id}}.my-job-svc&amp;quot;]
&lt;/code>&lt;/pre>&lt;h3 id="ä¸º-job-api-å¢åŠ -suspend-å­—æ®µ">ä¸º Job API å¢åŠ  suspend å­—æ®µ&lt;/h3>
&lt;p>è‡ª v1.21 èµ·ï¼ŒJob å¯ä»¥é€šè¿‡è®¾ç½® &lt;code>.spec.suspend=true&lt;/code> å­—æ®µæ¥ä¸´æ—¶çš„æŒ‚èµ·ã€‚å¯ä»¥æ¯”è¾ƒæ–¹ä¾¿çš„å»è¿›è¡Œæ§åˆ¶ï¼Œç±»ä¼¼ Argo workflow ä¸­ï¼Œä¹Ÿå¯ä»¥å¯¹æŸä¸ª workflow è¿›è¡ŒæŒ‚èµ·æ“ä½œã€‚&lt;/p>
&lt;h3 id="csr-çš„æœ‰æ•ˆæœŸ">CSR çš„æœ‰æ•ˆæœŸ&lt;/h3>
&lt;p>é€šè¿‡åœ¨ &lt;code>CertificateSigningRequestSpec&lt;/code> ä¸­å¢åŠ çš„ &lt;code>ExpirationSeconds&lt;/code> å¯ä»¥æ¥å—çš„æœ€å°å€¼æ˜¯ 600ï¼ˆ10åˆ†é’Ÿï¼‰ï¼Œè¿™æ ·å°±å¯ä»¥å¾ˆå¥½çš„æ§åˆ¶å…¶æœ‰æ•ˆæœŸäº†ã€‚ç°åœ¨é»˜è®¤çš„æ˜¯ 1 å¹´ã€‚&lt;/p>
&lt;h3 id="å†…å­˜èµ„æºçš„-qos">å†…å­˜èµ„æºçš„ QoS&lt;/h3>
&lt;p>ä¹‹å‰ Kubernetes åœ¨ä½¿ç”¨ cgroups v1 ï¼Œå¯¹äº Pod çš„ QoS å…¶å®åªé€‚ç”¨äº CPU èµ„æºã€‚Kubernetes v1.22 ä¸­é€šè¿‡å¼•å…¥ cgroups v2 æ¥æä¾›äº†ä¸€ä¸ª alpha ç‰¹æ€§ï¼Œå…è®¸å¯¹å†…å­˜èµ„æºä¹Ÿæä¾› QoSã€‚ï¼ˆå¦‚æœæ²¡è®°é”™ï¼Œè²Œä¼¼æ˜¯è…¾è®¯äº‘å›¢é˜Ÿæäº¤çš„ KEP å§ï¼‰&lt;/p>
&lt;p>å…¶ä»–å€¼å¾—æ³¨æ„çš„å˜æ›´ï¼Œè¯·å‚è€ƒä¹‹å‰å‘å¸ƒçš„æ¯æœŸã€K8Sç”Ÿæ€å‘¨æŠ¥ã€åŠ &lt;a href="https://zhuanlan.zhihu.com/p/384599279">ã€ŠK8S ç”Ÿæ€å‘¨æŠ¥| Kubernetes v1.22.0-beta.0 å‘å¸ƒã€‹&lt;/a>&lt;/p>
&lt;p>å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥é€šè¿‡KIND ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æ¥å¿«é€Ÿçš„ä½“éªŒ Kubernetes v1.22 ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">kind create cluster --image&lt;span class="o">=&lt;/span>kindest/node:v1.22.0@sha256:b8bda84bb3a190e6e028b1760d277454a72267a5454b57db34437c34a588d047
&lt;/code>&lt;/pre>&lt;/div>&lt;hr>
&lt;p>æ¬¢è¿è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://gitee.com/tlrr/awesome/raw/master/2020-9-9/1599632564572-mp-qrcode.png" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>Redis å®¹å™¨åŒ–æŠ€æœ¯é€‰å‹ï¼ŒK8S å¹¶éå”¯ä¸€</title><link>https://moelove.info/2021/07/02/Redis-%E5%AE%B9%E5%99%A8%E5%8C%96%E6%8A%80%E6%9C%AF%E9%80%89%E5%9E%8BK8S-%E5%B9%B6%E9%9D%9E%E5%94%AF%E4%B8%80/</link><guid isPermaLink="true">https://moelove.info/2021/07/02/Redis-%E5%AE%B9%E5%99%A8%E5%8C%96%E6%8A%80%E6%9C%AF%E9%80%89%E5%9E%8BK8S-%E5%B9%B6%E9%9D%9E%E5%94%AF%E4%B8%80/</guid><pubDate>Fri, 02 Jul 2021 12:39:40 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;p>&lt;strong>æœ¬æ–‡æ ¹æ®æˆ‘åœ¨ã€–deeplusç›´æ’­ç¬¬247æœŸã€—çº¿ä¸Šåˆ†äº«æ¼”è®²å†…å®¹æ•´ç†è€Œæˆã€‚&lt;/strong>&lt;/p>
&lt;p>ä»Šå¤©å°†åˆ†äº«çš„å†…å®¹åˆ†ä¸ºä»¥ä¸‹4ä¸ªæ–¹é¢ï¼š&lt;/p>
&lt;ul>
&lt;li>ä¸€ã€ç¼˜èµ·&lt;/li>
&lt;li>äºŒã€ä»‹ç»å¤šæ ·çš„å®¹å™¨åŒ–æŠ€æœ¯&lt;/li>
&lt;li>ä¸‰ã€Redisä»‹ç»&lt;/li>
&lt;li>å››ã€Rediså®¹å™¨åŒ–æ–¹æ¡ˆçš„å¯¹æ¯”&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>ä¸€ã€ç¼˜èµ·&lt;/strong>&lt;/p>
&lt;p>é¦–å…ˆæˆ‘ä»¬å…ˆèŠä¸€ä¸‹ä¸ºä»€ä¹ˆä»Šå¤©æˆ‘ä¼šåˆ†äº«è¿™ä¸ªä¸»é¢˜ã€‚æˆ‘å’Œæœ‹å‹ä¸€èµ·ç»„ç»‡äº†ä¸€ä¸ª RedisæŠ€æœ¯äº¤æµç¾¤ï¼Œåˆ°ç°åœ¨å·²ç»ç»è¥äº†6å¹´å·¦å³çš„æ—¶é—´ï¼Œå…¶ä¸­æŸä¸€å¤©åœ¨ç¾¤é‡Œæœ‰ä¸€ä¸ªå°ä¼™ä¼´å°±æŠ›å‡ºæ¥ä¸€ä¸ªé—®é¢˜ï¼š&lt;/p>
&lt;p>&lt;img src="https://moelove.info/img/redis/640.webp" alt="å›¾ç‰‡">&lt;/p>
&lt;p>ä»–é—®å¤§å®¶çº¿ä¸Šçš„Redisæœ‰æ²¡æœ‰ä½¿ç”¨Dockerå®‰è£…ï¼ŸDockerä½¿ç”¨Hostçš„ç½‘ç»œæ¨¡å¼ã€ç£ç›˜ä½¿ç”¨æœ¬åœ°æŒ‚è½½æ¨¡å¼è¿™ç§æ–¹æ¡ˆæ€ä¹ˆæ ·ï¼Ÿè¿™é‡Œçš„è¯æˆ‘ä»¬æš‚æ—¶å…ˆä¸è¯´è¿™ä¸ªæ–¹æ¡ˆå¦‚ä½•ï¼Œå› ä¸ºåœ¨ä»Šå¤©çš„åˆ†äº«ä¹‹åï¼Œæˆ‘ç›¸ä¿¡å¤§å®¶å¯¹äºè¿™ä¸ªæ–¹æ¡ˆåº”è¯¥ä¼šæœ‰ä¸€ä¸ªæ›´æ¸…æ™°çš„è®¤è¯†å’Œè¯„ä»·ã€‚&lt;/p>
&lt;p>&lt;strong>äºŒã€ä»‹ç»å¤šæ ·çš„å®¹å™¨åŒ–æŠ€æœ¯&lt;/strong>&lt;/p>
&lt;p>&lt;strong>1ã€chrootå’Œjails&lt;/strong>&lt;/p>
&lt;p>åœ¨å®¹å™¨åŒ–æŠ€æœ¯æ–¹é¢ï¼Œå…¶å®å†å²å¾ˆä¹…è¿œäº†ã€‚è™½ç„¶æˆ‘ä»¬ç°åœ¨ç”¨çš„å®¹å™¨åŒ–æŠ€æœ¯ï¼Œæˆ–è€…è¯´ k8sï¼Œè¿˜æœ‰äº‘åŸç”Ÿçš„æ¦‚å¿µæ˜¯è¿‘å‡ å¹´æ‰ç«èµ·æ¥çš„ï¼Œä½†æ˜¯å®é™…ä¸Šå°±å®¹å™¨åŒ–æŠ€æœ¯çš„å‘å±•æ¥è¯´ï¼Œå…¶å®æ˜¯å¾ˆæ—©çš„äº†ã€‚æ¯”å¦‚è¯´æœ€æ—©çš„æ—¶å€™æ¥è‡ªchrootï¼Œchrootå¤§å®¶å¯èƒ½éƒ½ç”¨è¿‡ï¼Œæˆ–è€…éƒ½æœ‰äº†è§£è¿‡ï¼Œåœ¨1979å¹´çš„æ—¶å€™å®ƒæ˜¯æ¥è‡ªUnixï¼Œå®ƒä¸»è¦çš„åŠŸèƒ½æ˜¯å¯ä»¥ä¿®æ”¹è¿›ç¨‹å’Œå­è¿›ç¨‹çš„/ã€‚&lt;/p>
&lt;p>é€šè¿‡ä½¿ç”¨chrootè¾¾åˆ°ä»€ä¹ˆæ ·æ•ˆæœå‘¢ï¼Ÿä½¿ç”¨chrootåŠ æŸä¸€ä¸ªç›®å½•ï¼Œç„¶åå†å¯åŠ¨ä¸€ä¸ªè¿›ç¨‹ï¼Œé‚£ä¹ˆè¿™ä¸ªè¿›ç¨‹è‡ªå·±æ‰€çœ‹åˆ°çš„ / ,å°±æ˜¯æˆ‘ä»¬å¹³æ—¶æ‰€è¯´çš„ / ç›®å½•ï¼Œè¿™ä¸ª / å°±ä¼šæ˜¯æˆ‘ä»¬åˆšæ‰æŒ‡å®šçš„æ–‡ä»¶å¤¹ï¼Œæˆ–è€…è¯´åˆšæ‰æŒ‡å®šçš„è·¯å¾„ã€‚è¿™æ ·å­çš„è¯å¯ä»¥æœ‰æ•ˆçš„ä¿æŠ¤æˆ‘ä»¬æ“ä½œç³»ç»Ÿä¸Šé¢çš„ä¸€äº›æ–‡ä»¶ï¼Œæˆ–è€…è¯´æƒé™å’Œå®‰å…¨ç›¸å…³çš„ä¸œè¥¿ã€‚&lt;/p>
&lt;p>åœ¨2000å¹´çš„æ—¶å€™ï¼Œå‡ºç°äº†ä¸€ä¸ªæ–°çš„æŠ€æœ¯ï¼Œå«åšjailsï¼Œå…¶å®å®ƒå·²ç»å…·å¤‡äº†sandboxï¼Œå°±æ˜¯æ²™ç®±ç¯å¢ƒçš„é›å½¢ã€‚ä½¿ç”¨jailsçš„è¯ï¼Œå¯ä»¥è®©ä¸€ä¸ªè¿›ç¨‹æˆ–è€…è¯´åˆ›å»ºçš„ç¯å¢ƒæ‹¥æœ‰ç‹¬ç«‹çš„ç½‘ç»œæ¥å£å’ŒIPåœ°å€ï¼Œè€Œå½“æˆ‘ä»¬æåˆ°ä½¿ç”¨jailsçš„è¯ï¼Œæˆ‘ä»¬è‚¯å®šä¼šæƒ³åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯å¦‚æœä½ æœ‰äº†ç‹¬ç«‹çš„ç½‘ç»œæ¥å£å’ŒIPåœ°å€ï¼Œè¿™æ ·çš„è¯å°±ä¸èƒ½å‘åŸå§‹çš„å¥—æ¥å­—ï¼Œé€šå¸¸è·ŸåŸå§‹çš„å¥—æ¥å­—æ¥è§¦å¾—æ¯”è¾ƒå¤šçš„å°±æ˜¯æˆ‘ä»¬ä½¿ç”¨çš„Pingå‘½ä»¤ã€‚é»˜è®¤çš„æƒ…å†µä¸‹ï¼Œè¿™æ ·å­æ˜¯ä¸å…è®¸ä½¿ç”¨åŸå§‹çš„å¥—æ¥å­—çš„ï¼Œè€Œæœ‰è‡ªå·±çš„ç½‘ç»œæ¥å£å’ŒIPåœ°å€ï¼Œè¿™ä¸ªæ„Ÿè§‰ä¸Šå°±åƒæ˜¯æˆ‘ä»¬å¸¸ç”¨çš„è™šæ‹Ÿæœºã€‚&lt;/p>
&lt;p>&lt;img src="https://moelove.info/img/redis/2.webp" alt="å›¾ç‰‡">&lt;/p>
&lt;p>&lt;strong>2ã€Linux VServerå’ŒOpenVZ&lt;/strong>&lt;/p>
&lt;p>æ¥ä¸‹æ¥åœ¨2001å¹´çš„æ—¶å€™ï¼Œåœ¨Linuxç¤¾åŒºå½“ä¸­å°±å‡ºç°äº†ä¸€ä¸ªæ–°çš„æŠ€æœ¯å«åšLinux VServerã€‚Linux VServeræœ‰æ—¶å€™å¯ä»¥ç®€å†™æˆlvsï¼Œä½†æ˜¯å’Œæˆ‘ä»¬å¹³æ—¶ç”¨åˆ°çš„4å±‚çš„ä»£ç†lvså…¶å®æ˜¯ä¸ä¸€æ ·çš„ã€‚å®ƒå…¶å®æ˜¯å¯¹Linuxå†…æ ¸çš„ä¸€ç§Patchï¼Œå®ƒæ˜¯éœ€è¦ä¿®æ”¹Linuxå†…æ ¸ï¼Œä¿®æ”¹å®Œæˆä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥è®©å®ƒæ”¯æŒç³»ç»Ÿçº§çš„è™šæ‹ŸåŒ–ï¼ŒåŒæ—¶ä½¿ç”¨Linux VServerçš„è¯ï¼Œå®ƒå¯ä»¥å…±äº«ç³»ç»Ÿè°ƒç”¨ï¼Œå®ƒæ˜¯æ²¡æœ‰ä»¿çœŸå¼€é”€çš„ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¸¸ç”¨çš„ä¸€äº›ç³»ç»Ÿè°ƒç”¨ã€ç³»ç»Ÿè°ƒç”¨çš„ä¸€äº›å‡½æ•°éƒ½æ˜¯å¯ä»¥å…±äº«çš„ã€‚&lt;/p>
&lt;p>åœ¨2005å¹´çš„æ—¶å€™ï¼Œå‡ºç°çš„ä¸€ä¸ªæ–°çš„æŠ€æœ¯â€”OpenVZã€‚OpenVZå…¶å®å’ŒLinux VServeræœ‰å¾ˆå¤§çš„ç›¸ä¼¼ç‚¹ï¼Œå®ƒä¹Ÿæ˜¯å¯¹å†…æ ¸çš„ä¸€ç§Patchï¼Œè¿™ä¸¤ç§æŠ€æœ¯æœ€å¤§çš„å˜åŒ–å°±æ˜¯å®ƒå¯¹Linuxæ‰“äº†å¾ˆå¤šçš„Patchï¼ŒåŠ äº†å¾ˆå¤šæ–°çš„åŠŸèƒ½ï¼Œä½†æ˜¯åœ¨2005å¹´çš„æ—¶å€™ï¼Œæ²¡æœ‰æŠŠè¿™äº›å…¨éƒ¨éƒ½åˆå¹¶åˆ°Linuxçš„ä¸»å¹²å½“ä¸­ï¼Œè€Œä¸”åœ¨ä½¿ç”¨OpenVZçš„æ—¶å€™ï¼Œå®ƒå¯ä»¥å…è®¸æ¯ä¸ªè¿›ç¨‹å¯ä»¥æœ‰è‡ªå·±çš„/procæˆ–è€…è¯´è‡ªå·±çš„/sysã€‚&lt;/p>
&lt;p>å…¶å®æˆ‘ä»¬å¤§å®¶éƒ½çŸ¥é“åœ¨Linuxå½“ä¸­ï¼Œæ¯”å¦‚è¯´å¯åŠ¨ä¸€ä¸ªè¿›ç¨‹ï¼Œä½ åœ¨ä»–çš„/proc/selfä¸‹é¢ï¼Œä½ å°±å¯ä»¥çœ‹åˆ°è¿›ç¨‹ç›¸å…³çš„ä¿¡æ¯ã€‚å¦‚æœä½ æœ‰äº†è‡ªå·±ç‹¬ç«‹çš„/procï¼Œå…¶å®ä½ å°±å¯ä»¥è¾¾åˆ°å’Œå…¶ä»–çš„è¿›ç¨‹éš”ç¦»å¼€çš„æ•ˆæœã€‚&lt;/p>
&lt;p>æ¥ä¸‹æ¥å¦å¤–ä¸€ä¸ªæ˜¾è‘—çš„ç‰¹ç‚¹å°±æ˜¯å®ƒæœ‰ç‹¬ç«‹çš„userså’Œgroupsï¼Œä¹Ÿå°±æ˜¯è¯´ä½ å¯ä»¥æœ‰ç‹¬ç«‹çš„ç”¨æˆ·æˆ–è€…ç‹¬ç«‹çš„ç»„ï¼Œè€Œä¸”è¿™ä¸ªæ˜¯å¯ä»¥å’Œç³»ç»Ÿå½“ä¸­å…¶ä»–çš„ç”¨æˆ·æˆ–è€…ç»„ç‹¬ç«‹å¼€çš„ã€‚&lt;/p>
&lt;p>å…¶æ¬¡çš„è¯OpenVZæ˜¯æœ‰å•†ä¸šä½¿ç”¨çš„ï¼Œå°±æ˜¯æœ‰å¾ˆå¤šå›½å¤–çš„ä¸»æœºå’Œå„ç§VPSéƒ½æ˜¯ç”¨OpenVZè¿™ç§æŠ€æœ¯æ–¹æ¡ˆã€‚&lt;/p>
&lt;p>&lt;img src="https://moelove.info/img/redis/3.webp" alt="å›¾ç‰‡">&lt;/p>
&lt;p>&lt;strong>3ã€namespace å’Œ cgroups&lt;/strong>&lt;/p>
&lt;p>åˆ°äº†2002å¹´çš„æ—¶å€™ï¼Œæ–°çš„æŠ€æœ¯æ˜¯namespaceã€‚åœ¨Linuxå½“ä¸­æˆ‘ä»¬æœ‰äº†æ–°çš„æŠ€æœ¯å«åšnamespaceï¼Œnamespaceå¯ä»¥è¾¾åˆ°è¿›ç¨‹ç»„å†…çš„ç‰¹å®šèµ„æºçš„éš”ç¦»ã€‚å› ä¸ºæˆ‘ä»¬å¹³æ—¶ç”¨åˆ°çš„namespaceå…¶å®æœ‰å¾ˆå¤šç§ï¼Œæ¯”å¦‚è¯´æœ‰PIDã€netç­‰ï¼Œè€Œä¸”å¦‚æœä½ ä¸åœ¨ç›¸åŒçš„namespaceä¸‹é¢çš„è¯ï¼Œæ˜¯çœ‹ä¸åˆ°å…¶ä»–è¿›ç¨‹ç‰¹å®šçš„èµ„æºçš„ã€‚&lt;/p>
&lt;p>åˆ°äº†2013å¹´çš„æ—¶å€™ï¼Œäº§ç”Ÿäº†ä¸€ä¸ªæ–°çš„namespaceçš„ç‰¹æ€§ï¼Œå°±æ˜¯user namespaceã€‚å…¶å®å½“æœ‰äº†user namespaceï¼Œå°±å’Œä¸Šæ–‡æåˆ°çš„OpenVZå®ç°çš„ç‹¬ç«‹ç”¨æˆ·å’Œç»„çš„åŠŸèƒ½æ˜¯æ¯”è¾ƒåƒçš„ã€‚&lt;/p>
&lt;p>å¯¹äºnamespaceçš„æ“ä½œå½“ä¸­ï¼Œé€šå¸¸ä¼šæœ‰ä¸‰ç§ã€‚&lt;/p>
&lt;p>&lt;strong>1ï¼‰Clone&lt;/strong>&lt;/p>
&lt;p>å¯ä»¥æŒ‡å®šå­è¿›ç¨‹åœ¨ä»€ä¹ˆnamespaceä¸‹é¢ã€‚&lt;/p>
&lt;p>&lt;strong>2ï¼‰Unshare&lt;/strong>&lt;/p>
&lt;p>å®ƒæ˜¯ä¸å…¶ä»–è¿›ç¨‹ä¸å…±äº«çš„ï¼Œunshareå†åŠ ä¸€ä¸ª-netï¼Œå°±å¯ä»¥ä¸å…¶ä»–çš„è¿›ç¨‹ç‹¬ç«‹å¼€ï¼Œä¸å…±äº«è‡ªå·±çš„netï¼Œä¸å…±äº«è‡ªå·±çš„ç½‘ç»œçš„namespaceã€‚&lt;/p>
&lt;p>&lt;strong>3ï¼‰Setns&lt;/strong>&lt;/p>
&lt;p>å°±æ˜¯ä¸ºè¿›ç¨‹è®¾ç½® namespaceã€‚&lt;/p>
&lt;p>åˆ°äº†2008å¹´ï¼Œcgroupså¼€å§‹è¢«å¼•å…¥åˆ°Linuxå†…æ ¸å½“ä¸­ï¼Œå®ƒå¯ä»¥ç”¨äºéš”ç¦»è¿›ç¨‹ç»„çš„èµ„æºä½¿ç”¨ï¼Œæ¯”å¦‚è¯´å¯ä»¥éš”ç¦»CPUã€å†…å­˜ã€ç£ç›˜ï¼Œè¿˜æœ‰ç½‘ç»œï¼Œå°¤å…¶æ˜¯ä»–åœ¨2013å¹´å’Œuser namespaceè¿›è¡Œäº†ä¸€æ¬¡ç»„åˆä¹‹åï¼Œå¹¶ä¸”è¿›è¡Œäº†é‡æ–°çš„è®¾è®¡ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œå°±å˜å¾—æ›´ç°ä»£åŒ–äº†ï¼Œå°±åƒæˆ‘ä»¬ç°åœ¨ç»å¸¸ä½¿ç”¨åˆ°çš„Dockerçš„ç›¸å…³ç‰¹æ€§ï¼Œå…¶å®éƒ½æ¥è‡ªäºè¿™ä¸ªæ—¶å€™ã€‚æ‰€ä»¥è¯´cgroupså’Œnamespaceæ„æˆç°ä»£å®¹å™¨æŠ€æœ¯çš„åŸºç¡€ã€‚&lt;/p>
&lt;p>&lt;img src="https://moelove.info/img/redis/4.webp" alt="å›¾ç‰‡">&lt;/p>
&lt;p>&lt;strong>4ã€LXC å’Œ CloudFoundry&lt;/strong>&lt;/p>
&lt;p>åœ¨2008å¹´çš„æ—¶å€™ï¼Œæ–°çš„ä¸€é¡¹æŠ€æœ¯å«åšLXC, æˆ‘ä»¬ä¹Ÿä¼šå«ä»–Linux Containerï¼ˆä»¥ä¸‹å‡ç®€ç§°LXCï¼‰ã€‚ä¸Šæ–‡æˆ‘ä»¬æåˆ°äº†å¾ˆå¤šå®¹å™¨åŒ–çš„æŠ€æœ¯ï¼Œæ¯”å¦‚Linux VServerã€OpenVZï¼Œä½†æ˜¯è¿™äº›éƒ½æ˜¯é€šè¿‡æ‰“Patchæ¥å®ç°çš„ï¼Œè€ŒLXCæ˜¯é¦–ä¸ªå¯ä»¥ç›´æ¥å’Œä¸Šæ¸¸çš„Linuxå†…æ ¸å…±åŒå·¥ä½œçš„ã€‚&lt;/p>
&lt;p>LXCæ˜¯å¯ä»¥æ”¯æŒç‰¹æƒå®¹å™¨çš„ï¼Œæ„æ€å°±æ˜¯è¯´å¯ä»¥åœ¨æœºå™¨ä¸Šé¢å»åšuid mapã€gid mapï¼Œå»åšæ˜ å°„ï¼Œè€Œä¸”ä¸éœ€è¦éƒ½æ‹¿rootç”¨æˆ·å»å¯åŠ¨ï¼Œè¿™æ ·å­å°±å…·å¤‡äº†å¾ˆå¤§çš„ä¾¿åˆ©æ€§ã€‚è€Œä¸”è¿™ç§æ–¹å¼å¯ä»¥è®©ä½ çš„è¢«æ”»å‡»é¢å¤§å¤§ç¼©å°ã€‚LXCæ”¯æŒçš„è¿™å‡ ç§æ¯”è¾ƒå¸¸è§„çš„æ“ä½œï¼Œå°±æ˜¯LXC-startï¼Œå¯ä»¥ç”¨æ¥å¯åŠ¨containerï¼ŒLXC-attachå°±å¯ä»¥è¿›å…¥containerå½“ä¸­ã€‚&lt;/p>
&lt;p>åˆ°2011å¹´çš„æ—¶å€™ï¼ŒCloudFoundryå¼€å§‹å‡ºç°äº†ï¼Œä»–å®é™…ä¸Šæ˜¯ä½¿ç”¨äº†LXCå’Œ Wardenè¿™ä¸¤é¡¹æŠ€æœ¯çš„ç»„åˆï¼Œåœ¨è¿™ä¸ªæ—¶å€™ä¸å¾—ä¸æåˆ°çš„ï¼Œå°±æ˜¯ä»–çš„æŠ€æœ¯æ¶æ„æ˜¯CSçš„æ¨¡å¼ï¼Œä¹Ÿå°±æ˜¯è¯´è¿˜æœ‰ä¸€ä¸ªå®¢æˆ·ç«¯å’Œserverç«¯ï¼Œè€Œ Wardenå®¹å™¨ï¼Œå®ƒé€šå¸¸æ˜¯æœ‰ä¸¤å±‚ï¼Œä¸€å±‚æ˜¯åªè¯»osçš„ï¼Œå°±æ˜¯åªè¯»çš„æ“ä½œç³»ç»Ÿçš„æ–‡ä»¶ç³»ç»Ÿï¼Œå¦å¤–ä¸€å±‚æ˜¯ç”¨äºåº”ç”¨ç¨‹åºå’Œå…¶ä¾èµ–çš„éæŒä¹…åŒ–çš„è¯»å†™å±‚ï¼Œå°±æ˜¯è¿™ä¸¤å±‚çš„ç»„åˆã€‚&lt;/p>
&lt;p>æˆ‘ä»¬ä¹‹å‰æåˆ°çš„æŠ€æœ¯ï¼Œå¤§å¤šæ•°éƒ½æ˜¯é’ˆå¯¹äºæŸä¸€å°æœºå™¨çš„ï¼Œå°±æ˜¯å¯¹äºå•æœºçš„ã€‚CloudFoundryå®ƒæœ€å¤§çš„ä¸åŒå°±æ˜¯å®ƒå¯ä»¥ç®¡ç†è·¨è®¡ç®—æœºçš„å®¹å™¨é›†ç¾¤ï¼Œè¿™å…¶å®å°±å·²ç»æœ‰äº†ç°ä»£å®¹å™¨æŠ€æœ¯çš„ç›¸å…³ç‰¹æ€§äº†ã€‚&lt;/p>
&lt;p>&lt;img src="https://moelove.info/img/redis/5.webp" alt="å›¾ç‰‡">&lt;/p>
&lt;p>&lt;strong>5ã€LMCTFYå’Œsystemd-nspawn&lt;/strong>&lt;/p>
&lt;p>åœ¨2013å¹´çš„æ—¶å€™ï¼Œ Googleå¼€æºäº†è‡ªå·±çš„å®¹å™¨åŒ–çš„è§£å†³æ–¹æ¡ˆï¼Œå«åšLMCTFYã€‚è¿™ä¸ªæ–¹æ¡ˆæ˜¯å¯ä»¥æ”¯æŒCPUã€å†…å­˜è¿˜æœ‰è®¾å¤‡çš„éš”ç¦»ã€‚è€Œä¸”å®ƒæ˜¯æ”¯æŒå­å®¹å™¨çš„ï¼Œå¯ä»¥è®©åº”ç”¨ç¨‹åºå»æ„ŸçŸ¥åˆ°è‡ªå·±å½“å‰æ˜¯å¤„åœ¨å®¹å™¨å½“ä¸­çš„ã€‚å¦å¤–è¿˜å¯ä»¥å†ä¸ºè‡ªå·±åˆ›å»ºä¸€ä¸ªå­å®¹å™¨ï¼Œä½†æ˜¯éšç€2013å¹´å‘å±•ä¹‹åï¼Œå®ƒé€æ¸å‘ç°åªä¾é è‡ªå·±ä¸åœçš„åšè¿™äº›æŠ€æœ¯ï¼Œå°±ç›¸å½“äºå•æ‰“ç‹¬æ–—ï¼Œå‘å±•å§‹ç»ˆæ˜¯æœ‰é™çš„ï¼Œæ‰€ä»¥å®ƒé€æ­¥çš„å°†è‡ªå·±çš„ä¸»è¦ç²¾åŠ›æ”¾åœ¨æŠ½è±¡å’Œç§»æ¤ä¸Šï¼ŒæŠŠè‡ªå·±çš„æ ¸å¿ƒç‰¹æ€§éƒ½ç§»æ¤åˆ°äº†libcontainerã€‚è€Œlibcontainerä¹‹åå°±æ˜¯Dockerçš„è¿è¡Œæ—¶çš„ä¸€ä¸ªæ ¸å¿ƒï¼Œå†ä¹‹åå°±æ˜¯è¢«Dockeræåˆ°äº†OCIï¼Œå†ç„¶åå°±å‘å±•åˆ°äº†runCã€‚è¿™éƒ¨åˆ†å†…å®¹æˆ‘ä»¬ç¨åå†è¯¦ç»†è®²è§£ã€‚&lt;/p>
&lt;p>å¤§å®¶éƒ½çŸ¥é“æœåŠ¡å™¨å®ƒè‚¯å®šæ˜¯æœ‰ä¸€ä¸ª PIDä¸º1çš„è¿›ç¨‹ã€‚å°±æ˜¯å®ƒçš„åˆå§‹è¿›ç¨‹ã€å®ˆæŠ¤è¿›ç¨‹ï¼Œè€Œç°ä»£çš„æ“ä½œç³»ç»Ÿçš„è¯ï¼Œå¤§å¤šæ•°å¤§å®¶éƒ½ä½¿ç”¨çš„æ˜¯systemdï¼ŒåŒæ ·systemdå®ƒä¹Ÿæä¾›äº†ä¸€ç§å®¹å™¨åŒ–çš„è§£å†³æ–¹æ¡ˆï¼Œå«åš systemd-nspawnã€‚è¿™ä¸ªæŠ€æœ¯çš„è¯ï¼Œå®ƒæ˜¯å¯ä»¥å’Œsystemdç›¸å…³çš„å·¥å…·é“¾è¿›è¡Œç»“åˆçš„ã€‚&lt;/p>
&lt;p>systemdé™¤äº†æœ‰æˆ‘ä»¬å¹³æ—¶ç”¨åˆ°çš„systemctlä¹‹ç±»çš„ï¼Œè¿˜æœ‰systemd machine ctlï¼Œå®ƒå¯ä»¥å»ç®¡ç†æœºå™¨ï¼Œè¿™ä¸ªæœºå™¨æ”¯æŒä¸¤ç§ä¸»è¦çš„æ¥å£ï¼Œä¸€ç§æ˜¯ç®¡ç†å®¹å™¨ç›¸å…³çš„æ¥å£ï¼Œå¦å¤–ä¸€ç§æ˜¯ç®¡ç†è™šæ‹Ÿæœºç›¸å…³çš„æ¥å£ã€‚&lt;/p>
&lt;p>è€Œæˆ‘ä»¬é€šå¸¸æ¥è®²ï¼Œå°±æ˜¯è¯´systemdæä¾›çš„å®¹å™¨æŠ€æœ¯è§£å†³æ–¹æ¡ˆï¼Œå®ƒæ˜¯å…è®¸æˆ‘ä»¬é€šè¿‡machine ctlå»å®¹å™¨å»è¿›è¡Œäº¤äº’çš„ï¼Œæ¯”å¦‚è¯´ä½ å¯ä»¥é€šè¿‡machine ctl startï¼Œå»å¯åŠ¨ä¸€ä¸ªsystemdæ”¯æŒçš„å®¹å™¨ï¼Œæˆ–è€…é€šè¿‡ machine ctl stopï¼Œå»å…³æ‰å®ƒï¼Œè€Œåœ¨è¿™ç§æŠ€æœ¯ä¸‹ï¼Œå®ƒæ˜¯æ”¯æŒèµ„æºè¿˜æœ‰ç½‘ç»œç­‰éš”ç¦»çš„ï¼Œå…¶å®å®ƒæœ€ä¸»è¦çš„æ˜¯systemd nsï¼Œå®ƒå…¶å®æ˜¯ä½¿ç”¨namespaceå»åšéš”ç¦»ã€‚å¯¹äºèµ„æºæ–¹é¢æ˜¯æ¥è‡ªäºsystemdï¼Œsystemdæ˜¯å¯ä»¥ä½¿ç”¨cgroupså»åšèµ„æºéš”ç¦»çš„ï¼Œå…¶å®è¿™ä¹Ÿæ˜¯è¿™ä¸¤ç§ä¸¤ç§æŠ€æœ¯æ–¹æ¡ˆçš„ç»„åˆã€‚&lt;/p>
&lt;p>&lt;img src="https://moelove.info/img/redis/6.webp" alt="å›¾ç‰‡">&lt;/p>
&lt;p>&lt;strong>6ã€Docker&lt;/strong>&lt;/p>
&lt;p>è€Œåœ¨2013å¹´Dockerä¹Ÿå‡ºç°äº†ã€‚é€šå¸¸æ¥è®²ï¼ŒDockeræ˜¯å®¹å™¨æ—¶ä»£çš„å¼•é¢†è€…ï¼Œä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Ÿå› ä¸ºDockeråœ¨2013å¹´å‡ºç°çš„æ—¶å€™ï¼Œä»–é¦–å…ˆæåˆ°äº†æ ‡å‡†åŒ–çš„éƒ¨ç½²å•å…ƒï¼Œå°±æ˜¯Docker imageã€‚åŒæ—¶å®ƒè¿˜æ¨å‡ºäº†DockerHubï¼Œå°±æ˜¯ä¸­å¤®é•œåƒä»“åº“ã€‚å…è®¸æ‰€æœ‰äººé€šè¿‡DockerHubå»ä¸‹è½½é¢„å…ˆå·²ç»æ„å»ºå¥½çš„Docker imageï¼Œå¹¶ä¸”é€šè¿‡ä¸€è¡ŒDocker runå°±å¯ä»¥å¯åŠ¨è¿™ä¸ªå®¹å™¨ã€‚&lt;/p>
&lt;p>åœ¨ä¼—å¤šä½¿ç”¨èµ·æ¥æ¯”è¾ƒç¹çã€æ¯”è¾ƒå¤æ‚çš„æŠ€æœ¯ä¸‹ï¼ŒDockerè¿™æ—¶æå‡ºæ¥ï¼Œä½ åªéœ€è¦ä¸€è¡ŒDocker runï¼Œå°±å¯ä»¥å¯åŠ¨ä¸€ä¸ªå®¹å™¨ï¼Œå®ƒå¤§å¤§ç®€åŒ–äº†å¤§å®¶å¯åŠ¨å®¹å™¨çš„å¤æ‚åº¦ï¼Œæå‡äº†ä¾¿æ·æ€§ã€‚&lt;/p>
&lt;p>æ‰€ä»¥Dockerè¿™é¡¹æŠ€æœ¯å°±å¼€å§‹é£é¡å…¨çƒã€‚è€ŒDockerå®ƒä¸»è¦æä¾›çš„ä¸€äº›åŠŸèƒ½æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæ¯”å¦‚è¯´èµ„æºçš„éš”ç¦»å’Œç®¡ç†ã€‚è€Œä¸”Dockeråœ¨0.9ä¹‹å‰ï¼Œå®ƒçš„å®¹å™¨è¿è¡Œæ—¶æ˜¯LXCï¼Œåœ¨0.9ä¹‹åï¼Œä»–å°±å¼€å§‹æŠŠLXCæ›¿æ¢æ‰ï¼Œæ›¿æ¢æˆäº†libcontainerï¼Œè€Œè¿™ä¸ªlibcontainerå…¶å®å°±æ˜¯æˆ‘ä»¬åœ¨ä¸Šæ–‡æåˆ°çš„Googleçš„ LMCTFYã€‚å†ä¹‹ålibcontaineræç»™äº†OCIã€‚è€Œé‚£ä¹‹åDockerç°åœ¨çš„å®¹å™¨è¿è¡Œæ—¶æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæ˜¯containerdã€‚containerdçš„æ›´ä¸‹å±‚æ˜¯runcï¼Œruncçš„æ ¸å¿ƒå…¶å®å°±æ˜¯libcontainerã€‚&lt;/p>
&lt;p>è€Œåˆ°äº†2014å¹´çš„æ—¶å€™ï¼Œ Googleå‘ç°å¤§å¤šæ•°çš„å®¹å™¨åŒ–è§£å†³æ–¹æ¡ˆï¼Œå…¶å®éƒ½åªæä¾›äº†å•æœºçš„è§£å†³æ–¹æ¡ˆï¼ŒåŒæ—¶ç”±äºDockerä¹Ÿæ˜¯CSæ¶æ„çš„ï¼Œæ‰€ä»¥å®ƒéœ€è¦æœ‰ä¸€ä¸ªDocker demandï¼Œå®ƒæ˜¯éœ€è¦æœ‰å®ˆæŠ¤è¿›ç¨‹å­˜åœ¨çš„ï¼Œè€Œè¿™ä¸ªå®ˆæŠ¤è¿›ç¨‹çš„è¯ï¼Œæ˜¯éœ€è¦ç”¨rootç”¨æˆ·å»å¯åŠ¨çš„ï¼Œè€Œrootç”¨æˆ·å¯åŠ¨çš„å®ˆæŠ¤è¿›ç¨‹ï¼Œå…¶å®æ˜¯å¢åŠ äº†è¢«æ”»å‡»é¢ï¼Œæ‰€ä»¥ Dockerçš„å®‰å…¨é—®é¢˜ä¹Ÿè¢«å¾ˆå¤šäººè¯Ÿç—…ã€‚&lt;/p>
&lt;p>åœ¨è¿™ä¸ªæ—¶å€™ Googleå°±å‘ç°äº†è¿™ä¸ªç‚¹ï¼Œå¹¶ä¸”æŠŠè‡ªå·±çš„Borgç³»ç»Ÿå»åšäº†å¼€æºï¼Œå¼€æºç‰ˆæœ¬å°±æ˜¯Kubernetesã€‚Googleè¿˜è”åˆäº†ä¸€äº›å…¬å¸ï¼Œç»„å»ºäº†ä¸€ä¸ªäº‘åŸç”ŸåŸºé‡‘ä¼šï¼ˆCNCFï¼‰ã€‚&lt;/p>
&lt;p>&lt;img src="https://moelove.info/img/redis/7.webp" alt="å›¾ç‰‡">&lt;/p>
&lt;p>&lt;strong>7ã€Kubernetes&lt;/strong>&lt;/p>
&lt;p>é€šå¸¸æ¥è®²Kubernetesæ˜¯äº‘åŸç”Ÿåº”ç”¨çš„åŸºçŸ³ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨Kuberneteså‡ºç°ä¹‹åï¼Œæˆ‘ä»¬çš„äº‘åŸç”ŸæŠ€æœ¯å¼€å§‹é€æ­¥åœ°å‘å±•èµ·æ¥ï¼Œé€æ­¥åœ°å¼•é¢†äº†æ½®æµï¼ŒKubernetesæä¾›äº†ä¸€äº›ä¸»è¦çš„ç‰¹æ€§ã€‚&lt;/p>
&lt;p>å®ƒå¯ä»¥æ”¯æŒæ¯”è¾ƒçµæ´»çš„è°ƒåº¦ã€æ§åˆ¶å’Œç®¡ç†ï¼Œè€Œè¿™ä¸ªè°ƒåº¦ç¨‹åºçš„è¯ï¼Œé™¤äº†å®ƒé»˜è®¤çš„ä»¥å¤–ï¼Œä¹Ÿå¯ä»¥æ¯”è¾ƒæ–¹ä¾¿çš„å»å¯¹å®ƒåšæ‰©å±•ï¼Œæ¯”å¦‚è¯´æˆ‘ä»¬å¯ä»¥è‡ªå·±å»å†™è‡ªå·±çš„è°ƒåº¦ç¨‹åºï¼Œæˆ–è€…è¯´äº²å’Œæ€§ã€åäº²å’Œæ€§ï¼Œè¿™äº›å…¶å®éƒ½æ˜¯æˆ‘ä»¬æ¯”è¾ƒå¸¸ç”¨åˆ°çš„ä¸€äº›ç‰¹æ€§ã€‚&lt;/p>
&lt;p>è¿˜æœ‰åŒ…æ‹¬ä»–æä¾›çš„ä¸€äº›æœåŠ¡ï¼Œæ¯”å¦‚è¯´å†…ç½®çš„ DNSã€kube-DNSæˆ–è€…è¯´ç°åœ¨çš„CoreDNSï¼Œé€šè¿‡åŸŸåçš„æ–¹å¼å»åšæœåŠ¡å‘ç°ï¼Œä»¥åŠKuberneteså½“ä¸­æœ‰å¾ˆå¤šçš„æ§åˆ¶å™¨ã€‚å®ƒå¯ä»¥å°†é›†ç¾¤çš„çŠ¶æ€è°ƒæ•´è‡³æˆ‘ä»¬é¢„æœŸçš„çŠ¶æ€ï¼Œå°±æ¯”å¦‚è¯´æœ‰ä¸€ä¸ªpodæŒ‚æ‰äº†ï¼Œå®ƒå¯ä»¥è‡ªåŠ¨çš„æŠŠå®ƒå†æ¢å¤åˆ°æˆ‘ä»¬é¢„æœŸæƒ³è¦çš„æ ·å­ã€‚&lt;/p>
&lt;p>å¦å¤–å°±æ˜¯å®ƒæ”¯æŒä¸°å¯Œçš„èµ„æºç§ç±»ï¼Œæ¯”å¦‚è¯´å‡ ä¸ªä¸»è¦çš„å±‚çº§ï¼Œæœ€å°çš„æ˜¯podï¼Œå†å¾€ä¸Šæœ‰deploymentï¼Œæˆ–è€…æœ‰StatefulSetsï¼Œç±»ä¼¼äºè¿™æ ·å­çš„èµ„æºã€‚&lt;/p>
&lt;p>æœ€åä¸€ç‚¹æ˜¯å®ƒè®©æˆ‘ä»¬æ›´åŠ å–œæ¬¢å®ƒçš„å› ç´ ï¼Œå°±æ˜¯å®ƒæœ‰ä¸°å¯Œçš„CRDçš„æ‹“å±•ï¼Œå³å¯ä»¥é€šè¿‡è‡ªå·±å»å†™ä¸€äº›è‡ªå®šä¹‰çš„èµ„æºï¼Œç„¶åå¯¹å®ƒè¿›è¡Œæ‰©å±•ï¼Œæ¯”å¦‚CRDã€‚&lt;/p>
&lt;p>&lt;img src="https://moelove.info/img/redis/8.webp" alt="å›¾ç‰‡">&lt;/p>
&lt;p>&lt;strong>8ã€æ›´å¤šçš„å®¹å™¨åŒ–æŠ€æœ¯&lt;/strong>&lt;/p>
&lt;p>é™¤äº†åˆšæ‰æˆ‘ä»¬æåˆ°çš„è¿™äº›ä¸»è¦çš„æŠ€æœ¯ä»¥å¤–ï¼Œå…¶å®è¿˜æœ‰å¾ˆå¤šæˆ‘ä»¬æ²¡æœ‰æåˆ°çš„ä¸€äº›å®¹å™¨åŒ–çš„æŠ€æœ¯ï¼Œæ¯”å¦‚è¯´åƒruncï¼Œä¸Šæ–‡æˆ‘ä»¬æ²¡æœ‰å¤ªå¤šçš„ä»‹ç»ï¼Œè¿˜æœ‰containerdã€‚containerdå…¶å®ä¹Ÿæ˜¯Dockerå¼€æºå‡ºæ¥çš„è‡ªå·±çš„æ ¸å¿ƒï¼Œä»–çš„ç›®æ ‡æ˜¯åšä¸€ä¸ªæ ‡å‡†åŒ–å·¥ä¸šå¯ç”¨çš„å®¹å™¨è¿è¡Œæ—¶ï¼Œè¿˜æœ‰CoreOSå¼€æºå‡ºæ¥çš„è§£å†³æ–¹æ¡ˆå«åšrktã€‚è€Œrktç„å‡†çš„ç‚¹å°±æ˜¯ä¸Šæ–‡æåˆ°çš„Dockerç›¸å…³çš„å®‰å…¨é—®é¢˜ã€‚ä½†æ˜¯rktç°åœ¨é¡¹ç›®å·²ç»ç»ˆæ­¢äº†ã€‚&lt;/p>
&lt;p>è¿˜æœ‰çº¢å¸½(Red Hat)å¼€æºå‡ºæ¥çš„ podmanï¼Œ podmanæ˜¯ä¸€ç§å¯ä»¥ç”¨å®ƒæ¥å¯åŠ¨å®¹å™¨ï¼Œå¯ä»¥ç”¨å®ƒå»ç®¡ç†å®¹å™¨ï¼Œè€Œä¸”æ²¡æœ‰å®ˆæŠ¤è¿›ç¨‹ï¼Œæ‰€ä»¥å°±å®‰å…¨æ€§æ¥è®²çš„è¯ï¼Œpodmanå¯ä»¥è¯´æ¯”Dockerçš„å®‰å…¨æ€§ç›´è§‚ä¸Šæ¥çœ‹çš„è¯ä¼šå¥½ä¸€äº›ï¼Œä½†æ˜¯å®ƒçš„ä¾¿æ·æ€§æ¥è®²çš„è¯ï¼Œå°±è¦å¤§æ‰“æŠ˜æ‰£äº†ã€‚æ¯”å¦‚è¯´å®¹å™¨çš„é‡å¯ã€å¼€æœºèµ·ä¹‹ç±»çš„ï¼Œä½†æ˜¯æˆ‘ä»¬éƒ½æ˜¯æœ‰ä¸€äº›ä¸åŒçš„è§£å†³æ–¹æ¡ˆçš„ã€‚&lt;/p>
&lt;p>åœ¨2017å¹´çš„æ—¶å€™ï¼Œè¿™ä¸ªæ—¶å€™æœ‰ä¸€ä¸ª Kata Containerï¼Œè€Œè¿™ä¸ªKata Containerå®ƒæœ‰ä¸€æ®µå‘å±•è¿‡ç¨‹ï¼Œæœ€å¼€å§‹æ˜¯è‹±ç‰¹å°”ï¼Œè‹±ç‰¹å°”åœ¨æè‡ªå·±çš„å®¹å™¨è¿è¡Œæ—¶ï¼Œè¿˜æœ‰ä¸€å®¶åˆåˆ›å…¬å¸å«åšhyper.shï¼Œè¿™å®¶å…¬å¸ä¹Ÿåœ¨æè‡ªå·±çš„å®¹å™¨è¿è¡Œæ—¶ï¼Œè¿™ä¸¤å®¶å…¬å¸ç„å‡†çš„éƒ½æ˜¯åšæ›´å®‰å…¨çš„å®¹å™¨ï¼Œä»–ä»¬ä½¿ç”¨çš„åº•å±‚çš„æŠ€æœ¯éƒ½æ˜¯åŸºäºK8Sã€‚è€Œä¹‹åè¿™ä¸¤å®¶å…¬å¸åšäº†åˆå¹¶ï¼Œhyper.shå®ƒå¼€æºå‡ºæ¥çš„ä¸€ä¸ªè§£å†³æ–¹æ¡ˆæ˜¯runvï¼Œè¢«è‹±ç‰¹å°”çœ‹ä¸Šäº†ä¹‹åå°±è¯ç”Ÿäº† Kata Containerã€‚åœ¨2018å¹´çš„æ—¶å€™ï¼ŒAWSå¼€æºå‡ºæ¥è‡ªå·±çš„Firecrackerã€‚&lt;/p>
&lt;p>è¿™ä¸¤é¡¹æŠ€æœ¯å’Œæˆ‘ä»¬ä¸Šæ–‡æåˆ°çš„æœºå™¨ä¸Šçš„å®¹å™¨åŒ–æŠ€æœ¯å…¶å®å¤§æœ‰ä¸åŒï¼Œå› ä¸ºå®ƒçš„åº•å±‚å…¶å®ç›¸å½“äºæ˜¯è™šæ‹Ÿæœºï¼Œè€Œæˆ‘ä»¬é€šå¸¸æ¥è®²ï¼Œéƒ½è®¤ä¸ºå®ƒæ˜¯è½»é‡çº§è™šæ‹Ÿæœºçš„ä¸€ç§å®¹å™¨åŒ–çš„æŠ€æœ¯ã€‚ä»¥ä¸Šå°±æ˜¯å…³äºå¤šæ ·çš„å®¹å™¨åŒ–æŠ€æœ¯çš„ä»‹ç»ã€‚&lt;/p>
&lt;p>&lt;strong>ä¸‰ã€Redisä»‹ç»&lt;/strong>&lt;/p>
&lt;p>æ¥ä¸‹æ¥è¿›å…¥å…³äºRedisç›¸å…³çš„ä»‹ç»ï¼Œä»¥ä¸‹æ˜¯ä»Redisçš„å®˜ç½‘ä¸Šé¢æ‘˜æŠ„çš„ä¸€æ®µä»‹ç»ã€‚&lt;/p>
&lt;p>&lt;strong>1ã€Redisä½¿ç”¨çš„ä¸»è¦åœºæ™¯&lt;/strong>&lt;/p>
&lt;p>å…¶å®Redisç°åœ¨æ˜¯ä½¿ç”¨æœ€å¹¿æ³›çš„ä¸€ç§KVå‹æ•°æ®åº“ã€‚è€Œæˆ‘ä»¬åœ¨ä½¿ç”¨å®ƒçš„æ—¶å€™ï¼Œä¸»è¦çš„ä½¿ç”¨åœºæ™¯å¯èƒ½æœ‰ä»¥ä¸‹å‡ ç§ï¼š&lt;/p>
&lt;ul>
&lt;li>æŠŠå®ƒå½“ç¼“å­˜ä½¿ç”¨ï¼ŒæŠŠå®ƒæ”¾åœ¨æ•°æ®åº“ä¹‹å‰ï¼ŒæŠŠå®ƒå½“åšç¼“å­˜å»ä½¿ç”¨ï¼›&lt;/li>
&lt;li>æŠŠå®ƒå½“DBæ¥ç”¨ï¼Œè¿™ç§å°±æ˜¯éœ€è¦æŠŠçœŸæ­£çš„æ‹¿å®ƒæ¥å­˜æ•°æ®åšæŒä¹…åŒ–ã€‚&lt;/li>
&lt;li>åšæ¶ˆæ¯é˜Ÿåˆ—ï¼Œå®ƒæ”¯æŒçš„æ•°æ®ç±»å‹ä¹Ÿæ¯”è¾ƒå¤šï¼Œè¿™é‡Œå°±ä¸å†åšä»‹ç»äº†ã€‚&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>2ã€Redisçš„ç‰¹ç‚¹&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>
&lt;p>å®ƒæ˜¯ä¸€ä¸ªå•çº¿ç¨‹çš„æ¨¡å‹ï¼Œå®ƒå…¶å®æ˜¯å¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹çš„ï¼Œä½†æ˜¯å®ƒçš„workerçº¿ç¨‹åªæœ‰ä¸€ä¸ªï¼Œåœ¨Redis6.0å¼€å§‹ï¼Œå®ƒæ”¯æŒäº†ioå¤šçº¿ç¨‹ï¼Œä½†ioå¤šçº¿ç¨‹åªæ˜¯å¯ä»¥æœ‰å¤šçº¿ç¨‹å»å¤„ç†æœ‰ç½‘ç»œç›¸å…³çš„éƒ¨åˆ†ï¼Œå®é™…ä¸Šä½ çœŸæ­£å»å¤„ç†æ•°æ®è¿˜æ˜¯å•çº¿ç¨‹ï¼Œæ‰€ä»¥æ•´ä½“è€Œè¨€ï¼Œæˆ‘ä»¬ä»ç„¶æŠŠå®ƒå«åšå•çº¿ç¨‹æ¨¡å‹ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Redisçš„æ•°æ®å…¶å®éƒ½åœ¨å†…å­˜é‡Œå¤´ï¼Œå®ƒæ˜¯ä¸€ä¸ªå†…å­˜å‹çš„æ•°æ®åº“ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä¸HAç›¸å…³ï¼Œ Redisæƒ³è¦åšHAï¼Œæˆ‘ä»¬ä»¥å‰åœ¨åš Redisçš„HAä¸»è¦é Redis sentinelï¼Œè€Œåé¢åœ¨Rediså‡ºæ¥clusterä¹‹åï¼Œæˆ‘ä»¬ä¸»è¦é Redis clusterå»åšHA,è¿™æ˜¯ä¸¤ç§ä¸»è¦HAçš„è§£å†³æ–¹æ¡ˆã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://moelove.info/img/redis/9.webp" alt="å›¾ç‰‡">&lt;/p>
&lt;p>&lt;strong>å››ã€Rediså®¹å™¨åŒ–æ–¹æ¡ˆçš„å¯¹æ¯”&lt;/strong>&lt;/p>
&lt;p>å½“æˆ‘ä»¬æåˆ°åš Redisè¿ç»´ç›¸å…³çš„æ—¶å€™ï¼Œæˆ‘ä»¬æœ‰å“ªäº›éœ€è¦è€ƒè™‘çš„ç‚¹ï¼š&lt;/p>
&lt;ul>
&lt;li>éƒ¨ç½²ï¼Œå¦‚ä½•å¿«é€Ÿçš„éƒ¨ç½²ï¼Œå¦‚ä½•èƒ½å¤Ÿå¿«é€Ÿçš„éƒ¨ç½²ï¼Œè€Œä¸”è¿˜è¦å»ç®¡ç†ç›‘å¬çš„ç«¯å£ï¼Œè®©ç«¯å£ä¸èµ·å†²çª,è¿˜æœ‰æ—¥å¿—å’ŒæŒä¹…åŒ–æ–‡ä»¶ä¹‹ç±»çš„,è¿™éƒ¨åˆ†éƒ½å±äºéƒ¨ç½²ç›¸å…³çš„å†…å®¹ï¼›&lt;/li>
&lt;li>æ‰©/ç¼©å®¹ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°çš„é—®é¢˜ï¼›&lt;/li>
&lt;li>ç›‘æ§å’ŒæŠ¥è­¦ï¼›&lt;/li>
&lt;li>æ•…éšœå’Œæ¢å¤ã€‚&lt;/li>
&lt;/ul>
&lt;p>ä»¥ä¸Šéƒ½æ˜¯æˆ‘ä»¬æœ€å…³æ³¨çš„å‡ ä¸ªæ–¹é¢ã€‚æˆ‘æ¥ä¸‹æ¥å°±å¯¹è¿™å‡ ä¸ªæ–¹é¢å»åšä¸€äº›ä»‹ç»ã€‚&lt;/p>
&lt;p>&lt;strong>1ã€éƒ¨ç½²&lt;/strong>&lt;/p>
&lt;p>å½“æˆ‘ä»¬æåˆ°å»åšå•æœºå¤šå®ä¾‹çš„æ—¶å€™ï¼ŒRedisä½œå•æœºå¤šå®ä¾‹å»éƒ¨ç½²çš„æ—¶å€™ï¼Œé¦–å…ˆç¬¬ä¸€ç‚¹å°±æ˜¯æˆ‘ä»¬å¸Œæœ›èƒ½å¤Ÿæœ‰è¿›ç¨‹çº§åˆ«çš„èµ„æºéš”ç¦»ï¼Œæˆ‘ä»¬æŸä¸€ä¸ªèŠ‚ç‚¹ä¸Šé¢æ‰€æœ‰éƒ¨ç½²çš„Rediså®ä¾‹ï¼Œå¯ä»¥æœ‰è‡ªå·±çš„èµ„æºï¼Œå¯ä»¥ä¸å—åˆ«çš„å®ä¾‹çš„å½±å“ï¼Œè¿™å°±æ˜¯å¯¹äºè¿›ç¨‹çº§åˆ«çš„èµ„æºéš”ç¦»ã€‚&lt;/p>
&lt;p>è¿›ç¨‹çº§åˆ«çš„èµ„æºéš”ç¦»ï¼Œå®ƒå…¶å®ä¸»è¦åˆ†ä¸ºä¸¤ä¸ªæ–¹é¢ï¼Œä¸€æ–¹é¢æ˜¯CPUï¼Œå¦ä¸€æ–¹é¢æ˜¯å†…å­˜ï¼Œå…¶æ¬¡çš„è¯æˆ‘ä»¬å¸Œæœ›åœ¨å•æœºä¸Šé¢æˆ‘ä»¬ä¹Ÿå¯ä»¥æœ‰è‡ªå·±çš„ç«¯å£ç®¡ç†ï¼Œæˆ–è€…è¯´æˆ‘ä»¬å¯ä»¥æœ‰ç‹¬ç«‹çš„ç½‘ç»œèµ„æºéš”ç¦»çš„ç›¸å…³çš„æŠ€æœ¯ã€‚&lt;/p>
&lt;p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé¦–å…ˆæˆ‘ä»¬æåˆ°è¯´è¿›ç¨‹çº§åˆ«çš„èµ„æºéš”ç¦»ï¼Œæˆ‘ä»¬ä»‹ç»äº†é‚£ä¹ˆå¤šçš„å®¹å™¨åŒ–ç›¸å…³æŠ€æœ¯ï¼Œæˆ‘ä»¬å·²ç»çŸ¥é“äº†ï¼Œæ”¯æŒè¿›ç¨‹çº§åˆ«çš„èµ„æºéš”ç¦»çš„è¯ï¼Œæœ‰æœ€ç®€å•çš„ä¸€ç§æ–¹æ¡ˆå°±æ˜¯ç”¨cgroupsï¼Œå¦‚æœæƒ³è¦å»åšç½‘ç»œèµ„æºéš”ç¦»çš„è¯ï¼Œæˆ‘ä»¬æœ‰namespaceï¼Œä¹Ÿå°±æ˜¯è¯´æ‰€æœ‰æ”¯æŒcgroupså’Œ namespaceçš„è¿™ç§è®¡åˆ’çš„è§£å†³æ–¹æ¡ˆï¼Œéƒ½å¯ä»¥æ»¡è¶³æˆ‘ä»¬è¿™ä¸ªåœ°æ–¹çš„éœ€æ±‚ã€‚&lt;/p>
&lt;p>å†æœ‰ä¸€ç§æ–¹æ¡ˆå°±æ˜¯è™šæ‹ŸåŒ–çš„æ–¹æ¡ˆï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¸Šæ–‡æåˆ°æ¯”å¦‚è¯´Kata Containerï¼ŒKata Containerè¿™ç§åŸºäºè™šæ‹ŸåŒ–çš„æ–¹å¼ï¼Œå› ä¸ºè™šæ‹ŸåŒ–çš„æ–¹æ¡ˆå…¶å®å¤§å®¶éƒ½æœ‰æ‰€æ¥è§¦ï¼Œå¤§å®¶éƒ½çŸ¥é“å°±æ˜¯è™šæ‹ŸåŒ–çš„è¿™ç§æŠ€æœ¯ï¼Œå…¶å®é»˜è®¤æƒ…å†µä¸‹ï¼Œåˆšå¼€å§‹å…¨éƒ¨éƒ½åšéš”ç¦»ã€‚&lt;/p>
&lt;p>æ‰€ä»¥å¯¹äºéƒ¨ç½²è€Œè¨€ï¼Œå¦‚æœä½ ä½¿ç”¨çš„æ˜¯æ¯”å¦‚è¯´åƒDockerï¼Œæ¯”å¦‚è¯´ä½ æƒ³ä½¿ç”¨çš„åƒ systemd-nspawnè¿™äº›å®ƒéƒ½å¯ä»¥æ—¢ç”¨åˆ°cgroupsï¼Œåˆç”¨åˆ°äº† namespaceï¼Œæ˜¯éƒ½å¯ä»¥å»ç”¨çš„ï¼Œåªä¸è¿‡æ˜¯ä½ éœ€è¦è€ƒè™‘ä¸€äº›ä¾¿æ·æ€§ï¼Œæ¯”å¦‚è¯´ä½ å¦‚æœæ˜¯ä½¿ç”¨Dockerçš„è¯ï¼Œè¿›è¡Œä¸€ä¸ªDockerå‘½ä»¤è·‘è¿‡å»ï¼Œç„¶ååªè¦è®©å®ƒæ˜ å°„åˆ°ä¸åŒçš„ç«¯å£ï¼Œå…¶å®å°±ç»“æŸäº†ã€‚&lt;/p>
&lt;p>å¦‚æœä½ ä½¿ç”¨æ˜¯systemd-nspawnï¼Œè¿™æ ·å­çš„è¯ï¼Œä½ éœ€è¦å»å†™ä¸€äº›é…ç½®æ–‡ä»¶ã€‚å¦‚æœä½ è¦æ˜¯å»ç”¨ä¸€äº›è™šæ‹ŸåŒ–çš„è§£å†³æ–¹æ¡ˆçš„è¯ï¼ŒåŒæ ·çš„ä¹Ÿéœ€è¦å»å‡†å¤‡ä¸€äº›é•œåƒã€‚&lt;/p>
&lt;p>&lt;img src="https://moelove.info/img/redis/10.webp" alt="å›¾ç‰‡">&lt;/p>
&lt;p>&lt;strong>2ã€æ‰©/ç¼©å®¹&lt;/strong>&lt;/p>
&lt;p>å…³äºæ‰©/ç¼©å®¹ï¼Œå…¶å®ä¼šæœ‰ä¸¤ç§æœ€ä¸»è¦çš„åœºæ™¯ï¼Œä¸€ç§åœºæ™¯å°±æ˜¯å•å®ä¾‹ maxmemory è°ƒæ•´ï¼Œå°±æ˜¯æˆ‘ä»¬æœ€å¤§å†…å­˜çš„è°ƒæ•´ã€‚è¿˜æœ‰ä¸€ç§æ˜¯å¯¹äºæˆ‘ä»¬çš„é›†ç¾¤åŒ–çš„é›†ç¾¤è§£å†³æ–¹æ¡ˆï¼Œå°±æ˜¯Redis Clusterã€‚å¯¹äºè¿™ç§é›†ç¾¤è§„æ¨¡ï¼Œæˆ‘ä»¬æœ‰æ‰©/ç¼©å®¹çš„è¯ï¼Œä¼šæœ‰ä¸¤æ–¹é¢çš„å˜åŒ–ã€‚&lt;/p>
&lt;p>ä¸€æ–¹é¢æ˜¯ Nodeï¼Œå°±æ˜¯æˆ‘ä»¬çš„èŠ‚ç‚¹çš„å˜æ›´ï¼Œå¦‚æœä¼šæ–°å¢èŠ‚ç‚¹ï¼Œä¹Ÿå¯èƒ½ä¼šå»ç§»é™¤èŠ‚ç‚¹ã€‚&lt;/p>
&lt;p>å¦å¤–ä¸€ç§å°±æ˜¯Slotçš„å˜æ›´ï¼Œå°±æ˜¯å¸Œæœ›æŠŠæˆ‘çš„ slot å»åšä¸€äº›è¿ç§»ï¼Œå½“ç„¶è¿™äº›å’ŒNodeèŠ‚ç‚¹ä¼šæ˜¯ç›¸å…³çš„ï¼Œå› ä¸ºå½“æˆ‘ä»¬å»åšæ‰©å®¹çš„æ—¶å€™ï¼Œæˆ‘ä»¬æŠŠRedis Clusterå½“ä¸­çš„ä¸€äº›NodeèŠ‚ç‚¹å¢å¤šï¼Œå¢å¤šäº†ä¹‹åï¼Œå°±å¯ä»¥ä¸ç»™ä»–åˆ†é…Slotï¼Œæˆ–è€…è¯´æˆ‘æƒ³è¦è®©æŸäº›Sloté›†ä¸­åˆ°æŸäº›èŠ‚ç‚¹ä¸Šé¢ï¼Œå…¶å®è¿™äº›éœ€æ±‚ä¹Ÿæ˜¯åŒæ ·å­˜åœ¨çš„ã€‚&lt;/p>
&lt;p>é‚£æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ï¼Œå¦‚æœä½ å½“æ—¶æƒ³è¦å»åšmaxmemoryçš„è°ƒæ•´ï¼Œå¦‚æœæˆ‘ä»¬æ˜¯å‰æå·²ç»åšäº†å®¹å™¨åŒ–ï¼Œæƒ³é€šè¿‡ cgroupså»å¯¹å®ƒåšèµ„æºçš„é™åˆ¶ï¼Œå°±éœ€è¦æœ‰ä¸€ä¸ªå¯ä»¥æ”¯æŒåŠ¨æ€è°ƒæ•´ cgroupsé…é¢çš„è§£å†³æ–¹æ¡ˆã€‚&lt;/p>
&lt;p>æ¯”å¦‚è¯´æˆ‘ä»¬ç”¨åˆ°Docker updateï¼Œå®ƒæ˜¯å¯ä»¥ç›´æ¥ä¿®æ”¹æŸä¸ªå®ä¾‹ï¼Œæˆ–è€…è¯´å…¶ä¸­çš„æŸä¸€ä¸ªå®¹å™¨çš„cgroupsèµ„æºçš„ä¸€äº›é™åˆ¶ï¼Œæ¯”å¦‚è¯´æˆ‘ä»¬å¯ä»¥Docker updateï¼Œç»™å®ƒæŒ‡å®šæ–°çš„å†…å­˜ï¼Œå¯ä»¥é™åˆ¶å®ƒæœ€å¤§å¯ç”¨å†…å­˜ï¼Œå½“ä½ æŠŠå®ƒçš„å¯ç”¨å†…å­˜æ•°è°ƒå¤§ï¼Œæ¥ä¸‹æ¥ä½ å°±å¯ä»¥å¯¹å®ä¾‹å»è°ƒæ•´å®ƒçš„ maxmemory ï¼Œä¹Ÿå°±æ˜¯è¯´å¯¹äºå•å®ä¾‹ maxmemoryï¼Œå…¶å®æœ€ä¸»è¦çš„å°±æ˜¯éœ€è¦æœ‰cgroupsçš„æŠ€æœ¯ï¼Œå‘cgroupsçš„æŠ€æœ¯æä¾›ä¸€äº›æ”¯æŒã€‚&lt;/p>
&lt;p>å¯¹äºé›†ç¾¤èŠ‚ç‚¹çš„å˜æ›´çš„è¯ï¼Œè¿™ä¸ªéƒ¨åˆ†ç¨åå†åšè¯¦ç»†ä»‹ç»ã€‚&lt;/p>
&lt;p>&lt;img src="https://moelove.info/img/redis/11.webp" alt="å›¾ç‰‡">&lt;/p>
&lt;p>&lt;strong>3ã€ç›‘æ§æŠ¥è­¦&lt;/strong>&lt;/p>
&lt;p>ç¬¬ä¸‰ç‚¹å°±æ˜¯ç›‘æ§æŠ¥è­¦ï¼Œä¸ç®¡æ˜¯ä½¿ç”¨ç‰©ç†æœºä¹Ÿå¥½ï¼Œæˆ–è€…ä½¿ç”¨äº‘ç¯å¢ƒä¹Ÿå¥½ï¼Œæˆ–è€…ä½¿ç”¨ä»»ä½•è§£å†³æ–¹æ¡ˆéƒ½å¥½ï¼Œç›‘æ§æŠ¥è­¦æˆ‘ä»¬æœ€æƒ³è¦å¾—åˆ°çš„æ•ˆæœå°±æ˜¯ï¼Œå®ƒå¯ä»¥è‡ªåŠ¨å‘ç°ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬å¸Œæœ›å½“å¯åŠ¨ä¸€ä¸ªå®ä¾‹ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥ç«‹é©¬çŸ¥é“è¿™ä¸ªå®ä¾‹Aä»–å·²ç»èµ·æ¥äº†ï¼Œå¹¶ä¸”çŸ¥é“ä»–çš„çŠ¶æ€æ˜¯ä»€ä¹ˆï¼Œè€Œç›‘æ§æŠ¥è­¦çš„è¯ï¼Œè¿™éƒ¨åˆ†å…¶å®æ˜¯ä¸ä¾èµ–äºç‰¹å®šçš„å®¹å™¨åŒ–æŠ€æœ¯çš„ï¼Œå°±å³ä½¿æ˜¯åœ¨çº¯ç²¹çš„ç‰©ç†æœºä¸Šéƒ¨ç½²ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ä¸€äº›è§£å†³æ–¹æ¡ˆè‡ªåŠ¨çš„å‘ç°å®ƒï¼Œè‡ªåŠ¨çš„æŠŠå®ƒæ³¨å†Œåˆ°æˆ‘ä»¬çš„ç›‘æ§ç³»ç»Ÿå½“ä¸­å»ï¼Œæ‰€ä»¥å®ƒæ˜¯å±äºç›‘æ§æŠ¥è­¦çš„è¿™éƒ¨åˆ†ï¼Œå…¶å®å®ƒæ˜¯ä¸ä¾èµ–äºç‰¹å®šçš„å®¹å™¨æŠ€æœ¯çš„ï¼Œä½†å”¯ä¸€çš„ä¸€ä¸ªé—®é¢˜å°±æ˜¯è¯´å‡å¦‚è¯´ä½¿ç”¨äº†å®¹å™¨åŒ–çš„æ–¹æ¡ˆï¼Œå¯ä»¥è®©å¸¸ç”¨çš„ Redis exporterï¼Œé…åˆPrometheuså»åšç›‘æ§ï¼Œå¯ä»¥è®© Redis exporterå’Œ Redis serverï¼Œè¿™ä¸¤ä¸ªè¿›ç¨‹å¯ä»¥å¤„äºåŒä¸€ä¸ªç½‘ç»œçš„å‘½åç©ºé—´ã€‚&lt;/p>
&lt;p>å¦‚æœä»–ä»¬ä¸¤ä¸ªå¤„äºåŒä¸€ä¸ªç½‘ç»œçš„å‘½åç©ºé—´çš„è¯ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡127.0.0.1:6379ï¼Œç„¶åç›´æ¥å»è”é€šå®ƒ,å¦‚æœæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯k8sçš„è¯ï¼Œå¯ä»¥ç›´æ¥æŠŠå®ƒä¿©æ”¾åˆ°ä¸€ä¸ªpodå½“ä¸­ï¼Œä½†æ˜¯è¿™äº›éƒ½æ— å…³ç´§è¦ï¼Œå› ä¸ºå®ƒæ˜¯ä¸ä¾èµ–äºç‰¹å®šçš„å®¹å™¨åŒ–æŠ€æœ¯çš„ï¼Œä½ å¯ä»¥ä½¿ç”¨ä»»ä½•ä½ æƒ³è¦ç”¨çš„æŠ€æœ¯ï¼Œéƒ½å¯ä»¥å»åšç›‘æ§å’ŒæŠ¥è­¦ã€‚&lt;/p>
&lt;p>&lt;img src="https://moelove.info/img/redis/12.webp" alt="å›¾ç‰‡">&lt;/p>
&lt;p>&lt;strong>4ã€æ•…éšœæ¢å¤&lt;/strong>&lt;/p>
&lt;p>æœ€åæˆ‘ä»¬æåˆ°çš„éƒ¨åˆ†æ˜¯æ•…éšœå’Œæ¢å¤ã€‚åœ¨è¿™ä¸ªéƒ¨åˆ†æˆ‘è®¤ä¸ºæœ€ä¸»è¦çš„æœ‰ä¸‰ä¸ªæ–¹é¢ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;strong>ç¬¬ä¸€ä¸ªæ˜¯å®ä¾‹çš„é‡å¯ã€‚&lt;/strong>&lt;/li>
&lt;/ul>
&lt;p>æœ‰å¯èƒ½åœ¨æŸäº›æƒ…å†µä¸‹ï¼ŒæŸäº›åœºæ™¯ä¸‹ï¼Œä½ çš„å®ä¾‹åœ¨è¿è¡Œè¿‡ç¨‹å½“ä¸­å®ƒå¯èƒ½ä¼šå®•æ‰ï¼Œå¦‚æœä½ æƒ³è®©ä»–è‡ªåŠ¨é‡å¯çš„è¯ï¼Œä½ éœ€è¦æœ‰ä¸€ä¸ªè¿›ç¨‹ç®¡ç†çš„å·¥å…·ã€‚å¯¹äºæˆ‘ä»¬è€Œè¨€ï¼Œä¸Šæ–‡æˆ‘ä»¬æåˆ°äº†systemdï¼Œsystemdæ˜¯å¯ä»¥æ”¯æŒå¯¹äºæŸä¸€ä¸ªè¿›ç¨‹çš„è‡ªåŠ¨æ‹‰èµ·çš„ï¼Œè¿˜å¯ä»¥æ”¯æŒè¿›ç¨‹æŒ‚æ‰ä¹‹åè‡ªåŠ¨æ‹‰èµ·ï¼Œ å¯ä»¥ restartï¼Œæˆ–è€…ä½ ä½¿ç”¨Dockerï¼Œå®ƒä¹Ÿæœ‰ä¸€ä¸ªrestart policyï¼Œå¯ä»¥æŒ‡å®šä»–ä¸º alwaysæˆ–è€…æŒ‡å®šä¸ºon-failureï¼Œç„¶åè®©å®ƒåœ¨æŒ‚æ‰çš„æ—¶å€™å†æŠŠå®ƒç»™æ‹‰èµ·æ¥ã€‚&lt;/p>
&lt;p>å¦‚æœä½ ä½¿ç”¨çš„æ˜¯k8sï¼Œé‚£ä¹ˆå°±æ›´ç®€å•äº†ï¼Œå¯ä»¥è‡ªåŠ¨æ‹‰èµ·æ¥ã€‚&lt;/p>
&lt;ul>
&lt;li>&lt;strong>ç¬¬äºŒä¸ªæ˜¯ä¸»ä»åˆ‡æ¢ã€‚&lt;/strong>&lt;/li>
&lt;/ul>
&lt;p>ä¸»ä»åˆ‡æ¢ç›¸å¯¹æ¥è¯´æ˜¯ä¸€ä¸ªå¸¸æ€ï¼Œä½†åœ¨è¿™é‡Œæˆ‘ä¹ŸæŠŠå®ƒåˆ—åˆ°æ•…éšœæ¢å¤å½“ä¸­ï¼Œæ˜¯å› ä¸ºå¯èƒ½åœ¨ä¸»ä»åˆ‡æ¢çš„è¿‡ç¨‹å½“ä¸­ï¼Œæœ‰å¯èƒ½ä½ çš„é›†ç¾¤çŠ¶å†µå·²ç»ä¸å¥åº·äº†ï¼Œæ˜¯ä¼šæœ‰è¿™ç§æƒ…å†µå­˜åœ¨çš„ã€‚é‚£ä¸»ä»åˆ‡æ¢çš„æ—¶å€™æˆ‘ä»¬éœ€è¦åšä»€ä¹ˆï¼Ÿç¬¬ä¸€æ–¹é¢ï¼Œéœ€è¦è®©ä»–èƒ½å¤Ÿæœ‰æ•°æ®çš„æŒä¹…åŒ–ï¼Œå¦ä¸€æ–¹é¢åœ¨ä¸»ä»åˆ‡æ¢çš„æ—¶å€™ï¼Œæœ‰å¯èƒ½ä¼šé‡åˆ°ä¸€ç§æƒ…å†µï¼Œå°±æ˜¯èµ„æºä¸å¤Ÿï¼Œå¯¼è‡´ä¸»ä»åˆ‡æ¢å¤±è´¥ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå…¶å®å’Œæˆ‘ä»¬ä¸Šæ–‡å‰é¢æåˆ°çš„æ‰©/ç¼©å®¹å…¶å®æ˜¯ç›¸å…³çš„ï¼Œæ‰€ä»¥åœ¨è¿™ç§æƒ…å†µä¸‹å°±å¿…é¡»å¾—ç»™ä»–åŠ èµ„æºï¼Œè€Œæœ€å¥½çš„åŠæ³•æ˜¯å¯ä»¥è‡ªåŠ¨ç»™ä»–åŠ èµ„æºã€‚&lt;/p>
&lt;p>åœ¨k8så½“ä¸­ï¼Œæƒ³è¦è®©å®ƒè‡ªåŠ¨åŠ èµ„æºï¼Œæˆ‘ä»¬é€šå¸¸ä¼šç»™ä»–è®¾ç½®å®ƒçš„requestå’Œlimitï¼Œå°±æ˜¯èµ„æºçš„é…é¢ï¼Œå¸Œæœ›å®ƒèƒ½è‡ªåŠ¨çš„åŠ èµ·æ¥ï¼Œæˆ‘ä»¬é€šå¸¸æŠŠä»–å«åšvpaã€‚&lt;/p>
&lt;ul>
&lt;li>&lt;strong>ç¬¬ä¸‰ä¸ªæ˜¯æ•°æ®æ¢å¤ã€‚&lt;/strong>&lt;/li>
&lt;/ul>
&lt;p>é€šå¸¸æ¥è®²ï¼Œæ¯”å¦‚è¯´æˆ‘ä»¬å¼€äº† RDBå’ŒAOFï¼Œè€Œä¸”å¸Œæœ›æˆ‘ä»¬çš„æ•°æ®å¯ä»¥ä¿å­˜ä¸‹æ¥ï¼Œä»¥ä¾¿äºåœ¨æˆ‘ä»¬æ•°æ®æ¢å¤çš„æ—¶å€™å¯ä»¥ç›´æ¥å¼€å§‹ä½¿ç”¨ã€‚æ‰€ä»¥æ•°æ®æŒä¹…åŒ–ä¹Ÿæ˜¯ä¸€æ–¹é¢ã€‚&lt;/p>
&lt;p>&lt;img src="https://moelove.info/img/redis/13.webp" alt="å›¾ç‰‡">&lt;/p>
&lt;p>æˆ‘ä»¬å»åšå®¹å™¨åŒ–çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦è€ƒè™‘å“ªäº›ç‚¹ï¼Ÿå¦‚æœè¯´ä½ æ˜¯ä½¿ç”¨Dockerçš„è¯ï¼Œä½ éœ€è¦å»æŒ‚ä¸€ä¸ªåˆ¸ï¼Œç„¶åä½ å¯ä»¥æŠŠè¿™ä¸ªæ•°æ®å»åšæŒä¹…åŒ–ï¼Œæ¯”å¦‚è¯´ä½ ä½¿ç”¨systemd-nspawnä¹Ÿéœ€è¦æœ‰ä¸€ä¸ªæ–‡ä»¶ç›®å½•å»æŠŠè¿™ä¸ªæ•°æ®åšæŒç»­åŒ–ã€‚&lt;/p>
&lt;p>å¦‚æœä½ ä½¿ç”¨çš„æ˜¯k8sçš„è¯ï¼Œåœ¨æŒ‚åˆ¸çš„æ—¶å€™ï¼Œä½ ä¼šæœ‰å„ç§å„æ ·çš„é€‰æ‹©ï¼Œæ¯”å¦‚è¯´ä½ å¯ä»¥å»æŒ‚ cephçš„RDBã€s3æˆ–è€…ä¸€ä¸ªæœ¬åœ°çš„æŸä¸€ä¸ªæ–‡ä»¶ç›®å½•ã€‚ä½†æ˜¯ä¸ºäº†æ›´é«˜çš„å¯é æ€§ï¼Œå¯èƒ½ä¼šä½¿ç”¨å‰¯æœ¬æ•°æ›´å¤šçš„åˆ†å¸ƒå¼å­˜å‚¨ã€‚&lt;/p>
&lt;p>&lt;strong>5ã€NodeèŠ‚ç‚¹å˜æ›´&lt;/strong>&lt;/p>
&lt;p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥èŠä¸€ä¸‹ä¸Šæ–‡æˆ‘ä»¬åœ¨æåˆ°æœåŠ¡æ‰©/ç¼©å®¹çš„æ—¶å€™ï¼Œæåˆ°çš„å…³äºNodeèŠ‚ç‚¹å˜æ›´ï¼Œæ¯”å¦‚è¯´æˆ‘æƒ³è¦è®©æˆ‘çš„æŸä¸€ä¸ªRedis clusterï¼Œå»æ‰©å……ä¸€äº›èŠ‚ç‚¹ï¼Œæ‰©å……èŠ‚ç‚¹çš„æ—¶å€™ï¼Œé‚£å°±æ„å‘³ç€ä½ å¿…é¡»èƒ½å¤ŸåŠ å…¥é›†ç¾¤ï¼Œèƒ½å¤Ÿå’Œé›†ç¾¤æ­£å¸¸é€šä¿¡ï¼Œè¿™æ‰è¯´æ˜ä½ çœŸæ­£çš„åŠ å…¥åˆ°äº†é›†ç¾¤å½“ä¸­ã€‚&lt;/p>
&lt;p>è€Œæˆ‘ä»¬ä¹ŸçŸ¥é“åœ¨Redis clusterå½“ä¸­ï¼Œä½ è¦å»åšé›†ç¾¤ï¼Œæœ€å¤§çš„ä¸€ä¸ªé—®é¢˜å°±æ˜¯k8sï¼Œk8så½“ä¸­åšæœåŠ¡å‘ç°å…¶å®å®ƒéƒ½æ˜¯å¤§å¤šæ•°é€šè¿‡ä¸€ä¸ªåŸŸåï¼Œè€Œæˆ‘ä»¬çš„Rediså½“ä¸­ï¼Œæ¯”å¦‚è¯´æˆ‘ä»¬çš„NodeIPï¼Œå®ƒå…¶å®åªæ”¯æŒIPï¼Œå®ƒå¹¶ä¸æ”¯æŒæˆ‘ä»¬çš„åŸŸåã€‚&lt;/p>
&lt;p>æ‰€ä»¥å¦‚æœè¯´NodeèŠ‚ç‚¹å˜æ›´ï¼Œéœ€è¦åšçš„äº‹æƒ…å°±æ˜¯å…è®¸æˆ‘ä»¬åŠ¨æ€åœ°å»æŠŠNodeIPå†™åˆ°æˆ‘ä»¬çš„é›†ç¾¤é…ç½®å½“ä¸­ã€‚&lt;/p>
&lt;p>å¦‚æœæƒ³è¦è®©å®ƒæœ‰ä¸€ä¸ªå®Œæ•´çš„ç”Ÿå‘½å‘¨æœŸï¼Œä»¥ä¸‹æˆªå›¾æ˜¯æ¥è‡ªäºä¸€ä¸ªå«Kubedbçš„operatorï¼Œåœ¨ä¸‹å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼ŒRedisè¿™ä¸ªåœ°æ–¹æä¾›äº†æœ€ä¸»è¦çš„ä¸‰ä¸ªéƒ¨åˆ†ï¼š&lt;/p>
&lt;ul>
&lt;li>PVCsï¼ŒPVCså°±æ˜¯åšæ•°æ®çš„æŒä¹…åŒ–ã€‚&lt;/li>
&lt;li>Servicesï¼ŒServiceså°±æ˜¯åšæœåŠ¡å‘ç°ã€‚&lt;/li>
&lt;li>StatefulSetsï¼ŒStatefulSetså…¶å®å°±æ˜¯k8så½“ä¸­çš„ä¸€ç§èµ„æºï¼Œè€Œè¿™èµ„æºå®ƒå¯¹äºæˆ‘ä»¬çš„æœ‰çŠ¶æ€åº”ç”¨ä¼šæ›´å‹å¥½ä¸€äº›ã€‚&lt;/li>
&lt;/ul>
&lt;p>å…¶å®åœ¨æ•´ä¸ªå†…å®¹å½“ä¸­è¿˜æœ‰ä¸€ç‚¹æ²¡æœ‰ä»‹ç»çš„æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå°±æ˜¯RedisèƒŒåçš„å…¬å¸å«åšRedis Labsï¼Œå®ƒæä¾›äº†ä¸€ç§å•†ä¸šåŒ–çš„æ–¹æ¡ˆï¼Œå°±æ˜¯Redis Enterpriseä¸€ç§è§£å†³æ–¹æ¡ˆã€‚å…¶å®ä¹Ÿæ˜¯åœ¨k8sçš„è§£å†³æ–¹æ¡ˆä¹‹ä¸Šçš„ï¼Œä¹Ÿæ˜¯ç”¨äº†Redis operatorã€‚ä»–çš„æ–¹æ¡ˆå’ŒKubedbè¿™ç§æ–¹æ¡ˆåŸºæœ¬ç±»ä¼¼ï¼Œå› ä¸ºæ ¸å¿ƒè¿˜éƒ½æ˜¯ç”¨çš„StatefulSetsï¼Œç„¶åå†åŠ ä¸Šè‡ªå·±çš„Controllerï¼Œå»å®Œæˆè¿™ä¸ªäº‹æƒ…ã€‚&lt;/p>
&lt;p>&lt;img src="https://moelove.info/img/redis/14.webp" alt="å›¾ç‰‡">&lt;/p>
&lt;p>&lt;strong>äº”ã€æ€»ç»“&lt;/strong>&lt;/p>
&lt;p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ä»Šå¤©çš„æ€»ç»“ã€‚å¦‚æœæ˜¯æˆ‘ä»¬å•æœºä½¿ç”¨çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥äº¤ç»™Dockeræˆ–è€…å…¶ä»–æ”¯æŒcgroupsæˆ–è€…namespaceèµ„æºç®¡ç†çš„å·¥å…·ã€‚å› ä¸ºå½“ä½ ä½¿ç”¨äº†cgroupsã€namespaceçš„è¯ï¼Œä½ å¯ä»¥åšåˆ°èµ„æºçš„éš”ç¦»ï¼Œå¯ä»¥é¿å…ç½‘ç»œçš„ç«¯å£çš„å†²çªä¹‹ç±»çš„äº‹æƒ…éƒ½å¯ä»¥å®ç°ã€‚&lt;/p>
&lt;p>è€Œå¦‚æœæ˜¯åƒæˆ‘åœ¨ä¸Šæ–‡æåˆ°çš„å°ä¼™ä¼´æåˆ°çš„é‚£ä¸ªé—®é¢˜ï¼šä»–æ‰“ç®—ä½¿ç”¨ä¸»æœºçš„ç½‘ç»œï¼Œä»…ä»…æ˜¯æƒ³è®©Dockerå»åšä¸€ä¸ªè¿›ç¨‹ç®¡ç†ï¼Œè€Œä¸”ä½ ä¹Ÿä¸å¸Œæœ›å¼•å…¥æ–°çš„å†…å®¹ã€‚é‚£ä¹ˆsystemdæˆ–è€…systemd-nspawnéƒ½æ˜¯å¯ä»¥è€ƒè™‘çš„ï¼Œå› ä¸ºè¿™ä¹Ÿæ˜¯å®¹å™¨åŒ–çš„è§£å†³æ–¹æ¡ˆã€‚&lt;/p>
&lt;p>å¦‚æœæ˜¯åœ¨å¤æ‚åœºæ™¯ä¸‹çš„è°ƒåº¦å’Œç®¡ç†çš„è¯ï¼Œæ¯”å¦‚æƒ³è¦æœ‰å¾ˆå¤§çš„è§„æ¨¡ï¼Œå¹¶ä¸”æƒ³è¦æœ‰æ›´çµæ´»çš„è°ƒåº¦å’Œç®¡ç†ï¼Œæˆ‘æ¨èä½ ä½¿ç”¨çš„æ˜¯Kubernetes operatorï¼Œæ¯”å¦‚è¯´Kubedbï¼Œå…¶å®ä¹Ÿæ˜¯ä¸€ç§è§£å†³æ–¹æ¡ˆã€‚å¦‚æœä½ çš„åœºæ™¯æ²¡æœ‰é‚£ä¹ˆå¤æ‚ï¼Œæ¯”è¾ƒç®€å•ï¼Œå…¶å®åŸç”Ÿçš„Kubernetes StatefulSetsç¨å¾®åšä¸€äº›è°ƒæ•´å’Œä¿®æ”¹ï¼Œä¹Ÿæ˜¯å¯ä»¥æ»¡è¶³ä½ çš„éœ€æ±‚ã€‚&lt;/p>
&lt;p>&lt;img src="https://moelove.info/img/redis/15.webp" alt="å›¾ç‰‡">&lt;/p>
&lt;p>ä»¥ä¸Šå°±æ˜¯æˆ‘ä»Šå¤©åˆ†äº«çš„ä¸»è¦å†…å®¹äº†ï¼Œæ„Ÿè°¢å¤§å®¶çš„å‚ä¸ã€‚&lt;/p>
&lt;p>&lt;strong>&amp;gt;&amp;gt;&amp;gt;&amp;gt;&lt;/strong>&lt;/p>
&lt;p>&lt;strong>Q&amp;amp;A&lt;/strong>&lt;/p>
&lt;p>&lt;strong>Q1ï¼šè¯·é—®Redisé›†ç¾¤å‡å¦‚ç”¨ä¸‰å°ç‰©ç†æœºåšï¼Œæ¯å°è¿è¡Œ2ä¸ªå®ä¾‹ï¼Œå¦‚ä½•ä¿éšœæ¯å°ç‰©ç†æœºçš„å®ä¾‹ä¸æ˜¯äº’ä¸ºä¸»ä»çš„ï¼Ÿ&lt;/strong>&lt;/p>
&lt;p>&lt;strong>A1 ï¼š&lt;/strong> è¿™ä¸ªé—®é¢˜å…¶å®æˆ‘ä»¬é€šå¸¸æƒ…å†µä¸‹å¤§å®¶ä¹Ÿéƒ½ä¼šé‡åˆ°ã€‚ç¬¬ä¸€ç‚¹å¦‚æœä½ æ˜¯ä½¿ç”¨ç‰©ç†æœºæ¥åšï¼Œå¹¶ä¸”ä½ æ¯å°æœºå™¨ä¸Šé¢è¿è¡Œä¸¤ä¸ªå®ä¾‹ï¼Œä¸‰å°æœºå™¨æ¯ä¸ªæœºå™¨ä¸Šé¢è¿è¡Œ2ä¸ªå®ä¾‹ï¼Œä¸€å…±æœ‰6ä¸ªå®ä¾‹ã€‚è¿™6ä¸ªå®ä¾‹ä½ æ˜¯å¦å¯ä»¥ä¿è¯å®ƒæ¯ä¸ªäº’ç›¸éƒ½ä¸ä¸ºä¸»ä»çš„ï¼Œå…¶å®æ˜¯å¯ä»¥ç›´æ¥ä¿è¯ã€‚&lt;/p>
&lt;p>å”¯ä¸€çš„é—®é¢˜å°±æ˜¯å‡å¦‚è¯´è¿™æ˜¯ä¸€ä¸ªé›†ç¾¤ï¼Œç„¶åå‘ç”Ÿæ•…éšœè½¬ç§»ï¼Œå‘ç”ŸèŠ‚ç‚¹çš„ä¸»åŠ¨åˆ‡æ¢ï¼Œå°±éå¸¸æœ‰å¯èƒ½å­˜åœ¨ä½ çš„ä¸»ä»å‘ç”Ÿäº†å˜æ›´ã€‚å…¶å®è¿™ä¸ªåœ°æ–¹çš„è¯å…¶å®æˆ‘æ›´åŠ å»ºè®®ï¼Œå¦‚æœä½ å‘ç°äº†è¿™ç§é—®é¢˜çš„è¯ï¼Œä½ æ‰‹åŠ¨å»åšåˆ‡æ¢ï¼Œå› ä¸ºç‰©ç†æœºç¯å¢ƒå»åšè¿™ä¸ªäº‹æƒ…ï¼Œç›®å‰æˆ‘è¿˜æ²¡çœ‹åˆ°æœ‰ä»€ä¹ˆç‰¹åˆ«å¥½çš„è§£å†³åŠæ³•ã€‚&lt;/p>
&lt;p>&lt;strong>Q2 : è¯·é—®k8s ä¸­æ‰©å®¹æ—¶ï¼Œå¦‚ä½•å¢åŠ æ–°èŠ‚ç‚¹ã€‚æ‰©å®¹å’Œåˆ†é…slotçš„æ­¥éª¤å¦‚ä½•è‡ªåŠ¨åŒ–çš„è¿›è¡Œï¼Ÿ&lt;/strong>&lt;/p>
&lt;p>&lt;strong>A2 ï¼š&lt;/strong> æˆ‘ä»¬åˆ†å¼€ä¸¤æ­¥æ¥è®²ï¼Œç¬¬ä¸€éƒ¨åˆ†æ˜¯å¢åŠ æ–°èŠ‚ç‚¹ï¼Œå¢åŠ æ–°èŠ‚ç‚¹çš„è¯ï¼Œåˆšæ‰æˆ‘å…¶å®åœ¨è¿‡ç¨‹é‡Œå¤´å·²ç»æåˆ°äº†ï¼Œå¢åŠ å®Œæ–°çš„èŠ‚ç‚¹ä¹‹åï¼Œé¦–å…ˆä½ ä¸€å®šè¦è®©å®ƒèƒ½å¤Ÿå’Œé›†ç¾¤å»åšé€šä¿¡ï¼Œç„¶è€Œè¿™ä¸ªåœ°æ–¹å°±æ˜¯éœ€è¦ä½ å»ä¿®æ”¹é›†ç¾¤çš„é…ç½®æ–‡ä»¶ï¼Œç„¶åä½ éœ€è¦ä»–æœ‰ä¸€ä¸ªNodeIPï¼Œå› ä¸ºä¹‹é—´æ˜¯é€šè¿‡IPå»åšé€šä¿¡çš„ï¼Œæ‰€ä»¥ä½ éœ€è¦å»ä¿®æ”¹å®ƒçš„é…ç½®æ–‡ä»¶ï¼ŒæŠŠå®ƒçš„ NodeIPåŠ è¿›å»ï¼Œè¿™æ ·å­ä»–æ‰å¯ä»¥å’Œé›†ç¾¤å½“ä¸­çš„å…¶ä»–èŠ‚ç‚¹å»åšé€šä¿¡ï¼Œç„¶è€Œè¿™ä¸ªéƒ¨åˆ†çš„è¯ï¼Œæˆ‘æ›´æ¨èçš„æ˜¯ç”¨operatorå»åšã€‚&lt;/p>
&lt;p>&lt;strong>Q3 : è¯·é—®å¦‚æœä¸ç”¨Redis operatorï¼Œä¹Ÿä¸ä½¿ç”¨åˆ†å¸ƒå¼å­˜å‚¨ï¼Œk8så¦‚ä½•éƒ¨ç½²clusteré›†ç¾¤å‘¢ï¼Ÿ&lt;/strong>&lt;/p>
&lt;p>&lt;strong>A3 ï¼š&lt;/strong> ä¸ç”¨Redis operatorå…¶å®ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œåˆšæ‰æˆ‘ä¹Ÿä»‹ç»è¿‡ï¼Œæœ‰ä¸¤ç§æ¨¡å¼ï¼Œä¸€ç§æ¨¡å¼å°±æ˜¯ç”¨StatefulSetsï¼Œè¿™ç§æ¨¡å¼çš„è¯ç›¸å¯¹æ¥è¯´ä¼šæ¯”è¾ƒç¨³å¦¥ä¸€äº›ã€‚åŒæ—¶å®ƒçš„æœ€ä¸»è¦çš„éƒ¨åˆ†ä»ç„¶æ˜¯ä¿®æ”¹é…ç½®ï¼Œä½ éœ€è¦åœ¨ä½ çš„Redisçš„å®¹å™¨é•œåƒå½“ä¸­ï¼Œä½ å¯ä»¥ç»™å®ƒåŠ ä¸€ä¸ªinitå®¹å™¨ï¼Œç„¶åå¯ä»¥åœ¨è¿™ä¸ªéƒ¨åˆ†å…ˆç»™ä»–åšä¸€æ¬¡ä¿®æ”¹é…ç½®çš„æ“ä½œï¼Œè¿™æ˜¯å¯ä»¥çš„ã€‚ä¿®æ”¹å®Œé…ç½®çš„æ“ä½œä¹‹åï¼Œå†æŠŠå®ƒç»™æ‹‰èµ·æ¥ï¼Œè¿™æ ·å­ä»–æ‰å¯ä»¥åŠ å…¥åˆ°é›†ç¾¤å½“ä¸­ã€‚&lt;/p>
&lt;p>&lt;strong>Q4 : è¯·é—®ç½‘ç»œå»¶è¿Ÿåœ¨ä¸åŒç½‘ç»œæ¨¡å‹ä¸‹æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ&lt;/strong>&lt;/p>
&lt;p>&lt;strong>A4 ï¼š&lt;/strong> å¦‚æœæˆ‘ä»¬ç›´æ¥ä½¿ç”¨ç‰©ç†æœºçš„ç½‘ç»œï¼Œé€šå¸¸æ¥è®²ï¼Œæˆ‘ä»¬ä¸è®¤ä¸ºè¿™ç§æ–¹å¼æœ‰å»¶è¿Ÿï¼Œå°±æ˜¯ä¸»æœºç½‘ç»œä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬ä¼šå¿½ç•¥æ‰å®ƒçš„å»¶è¿Ÿï¼Œä½†æ˜¯å¦‚æœä½ ä½¿ç”¨çš„æ˜¯overlayçš„è¿™ç§ç½‘ç»œæ¨¡å‹çš„è¯ï¼Œå› ä¸ºå®ƒæ˜¯è¦†ç›–å±‚çš„ç½‘ç»œï¼Œæ‰€ä»¥ä½ åœ¨å»åšå‘åŒ…è§£åŒ…çš„æ—¶å€™ï¼Œå½“ç„¶æ˜¯ä¼šæœ‰ä¸åŒçš„èµ„æºçš„æŸè€—ï¼Œæ€§èƒ½çš„æŸè€—éƒ½æ˜¯æœ‰çš„ã€‚&lt;/p>
&lt;p>&lt;strong>Q5 : è¯·é—®ä¸€èˆ¬å»ºè®®å…¬å¸å…¬ç”¨ä¸€ä¸ªRedisé›†ç¾¤ï¼Œè¿˜æ˜¯å„ç³»ç»Ÿç‹¬ç«‹é›†ç¾¤ï¼Ÿ&lt;/strong>&lt;/p>
&lt;p>&lt;strong>A5 ï¼š&lt;/strong> è¿™ä¸ªé—®é¢˜å½“ç„¶æ˜¯å»ºè®®å„ä¸ªç³»ç»Ÿç‹¬ç«‹é›†ç¾¤äº†ï¼Œæˆ‘ä»¬æ¥ä¸¾ä¸€ä¸ªæœ€ç®€å•çš„ä¾‹å­ï¼Œæ¯”å¦‚è¯´ä½ åœ¨å…¶ä¸­ç”¨åˆ°äº†listï¼Œæˆ‘ä»¬éƒ½çŸ¥é“Rediså°±æœ‰ä¸€ä¸ªziplistçš„é…ç½®é¡¹ï¼Œä»–å…¶å®è·Ÿä½ çš„å­˜å‚¨å’Œä½ çš„æ€§èƒ½æ˜¯æœ‰å…³ç³»çš„ã€‚å¦‚æœä½ æ˜¯å…¬å¸çš„æ‰€æœ‰çš„ä¸œè¥¿éƒ½ç”¨åŒä¸€ä¸ªé›†ç¾¤ï¼Œé‚£ä½ ä¿®æ”¹äº†Redisé›†ç¾¤çš„é…ç½®çš„è¯ï¼Œå¾ˆå¯èƒ½ä¼šå½±å“åˆ°æ‰€æœ‰çš„æœåŠ¡ã€‚ä½†å¦‚æœä½ æ˜¯æ¯ä¸ªç³»ç»Ÿç‹¬ç«‹ç”¨ä¸€ä¸ªRedisç¾¤çš„è¯ï¼Œå½¼æ­¤ä¹‹é—´äº’ä¸å½±å“ï¼Œä¹Ÿä¸ä¼šå‡ºç°æŸä¸€ä¸ªåº”ç”¨ä¸å°å¿ƒæŠŠé›†ç¾¤ç»™æ‰“æŒ‚äº†ï¼Œç„¶åé€ æˆè¿é”ååº”çš„æƒ…å†µã€‚&lt;/p>
&lt;p>&lt;strong>Q6 : è¯·é—®RedisæŒä¹…åŒ–ï¼Œåœ¨ç”Ÿäº§ä¸­å¦‚ä½•è€ƒè™‘å‘¢ï¼Ÿ&lt;/strong>&lt;/p>
&lt;p>&lt;strong>A6 ï¼š&lt;/strong> è¿™éƒ¨åˆ†ä¸œè¥¿æˆ‘æ˜¯è¿™æ ·æƒ³çš„ã€‚å¦‚æœä½ çœŸçš„éœ€è¦å»åšæŒä¹…åŒ–ï¼Œä¸€æ–¹é¢Redisæä¾›äº†ä¸¤ç§æ ¸å¿ƒï¼Œä¸€ç§æ˜¯ RDBï¼Œå¦å¤–ä¸€ç§æ˜¯AOFï¼Œå¦‚æœè¯´ä½ çš„æ•°æ®å¾ˆå¤šçš„è¯ï¼Œç›¸åº”ä½ çš„RDBå¯èƒ½ä¼šå˜å¾—å¾ˆå¤§ã€‚å¦‚æœä½ æ˜¯å»åšæŒä¹…åŒ–ï¼Œæˆ‘é€šå¸¸å»ºè®®å°±æ˜¯ä¸¤ä¸ªé‡Œå¤´å»åšä¸€æ¬¡æƒè¡¡ã€‚å› ä¸ºé€šå¸¸æ¥è®²ï¼Œå³ä½¿ä½ æ˜¯ä½¿ç”¨ç‰©ç†æœºçš„ç¯å¢ƒï¼Œæˆ‘ä¹Ÿå»ºè®®ä½ çš„å­˜å‚¨ç›®å½•å¯ä»¥æ”¾åˆ°ä¸€ä¸ªç‹¬ç«‹çš„ç›˜é‡Œå¤´ï¼Œæˆ–è€…è¯´ä½ å¯ä»¥å»æŒ‚åœ¨ä¸€ä¸ªåˆ†å¸ƒå¼çš„å­˜å‚¨ï¼Œä½†æ˜¯å‰ææ˜¯ä½ éœ€è¦ä¿è¯å®ƒçš„æ€§èƒ½ï¼Œå› ä¸ºä½ ä¸èƒ½å› ä¸ºå®ƒçš„å†™å…¥æ€§èƒ½è€Œæ‹–ç´¯ä½ çš„é›†ç¾¤ï¼Œæ‰€ä»¥æ›´åŠ æ¨èçš„å°±æ˜¯ä½ å¯ä»¥å…¨éƒ½æŠŠå®ƒä»¬æ‰“å¼€ï¼Œä½†æ˜¯å¦‚æœä½ æ•°æ®å…¶å®æ²¡é‚£ä¹ˆé‡è¦ï¼Œä½ å¯ä»¥ä½ åªå¼€AOFã€‚&lt;/p>
&lt;p>&lt;strong>Q7 : è¯·é—®ç”Ÿäº§çº§åˆ«çš„cephå¯é ä¸ï¼Ÿ&lt;/strong>&lt;/p>
&lt;p>&lt;strong>A7 ï¼š&lt;/strong> å…¶å®cephçš„å¯é æ€§è¿™ä¸ªé—®é¢˜ï¼Œå¾ˆå¤šäººéƒ½è®¨è®ºè¿‡ï¼Œå°±æˆ‘ä¸ªäººè€Œè¨€ï¼Œceph çš„å¯é æ€§æ˜¯æœ‰ä¿è¯çš„ã€‚æˆ‘è¿™è¾¹åœ¨ç”¨çš„ ceph å¾ˆå¤šï¼Œå¹¶ä¸”å­˜äº†å¾ˆå¤šæ¯”è¾ƒæ ¸å¿ƒçš„æ•°æ®ï¼Œceph çš„å¯é æ€§æ˜¯ ok çš„ã€‚&lt;/p>
&lt;p>é‡ç‚¹åœ¨äºè¯´ä½ èƒ½ä¸èƒ½æå¾—å®šä»–ï¼Œè€Œä¸”æœ‰ä¸€å®¶å…¬å¸å…¶å®å¤§å®¶å¯èƒ½æœ‰æ‰€äº†è§£ï¼Œå«åšSUSEï¼Œå°±æ˜¯ä¸€ä¸ªLinuxçš„ä¸€ä¸ªå‘è¡Œç‰ˆï¼Œè¿™å®¶å…¬å¸å…¶å®æä¾›äº†ä¸€ä¸ªä¼ä¸šçº§çš„å­˜å‚¨è§£å†³æ–¹æ¡ˆï¼Œå¹¶ä¸”å®ƒçš„åº•å±‚å…¶å®è¿˜æ˜¯ç”¨çš„cephï¼Œå…¶å®è¿™ä¹Ÿæ˜¯æ­£å¸¸çš„ï¼Œåªè¦æœ‰ä¸“äººå»æè¿™ä¸ªäº‹æƒ…ï¼Œç„¶åæŠŠå®ƒè§£å†³æ‰ï¼Œæˆ‘è§‰å¾—cephè¶³å¤Ÿç¨³å®šçš„ã€‚&lt;/p>
&lt;p>é¡ºä¾¿æä¸€ä¸‹ï¼Œå¦‚æœä½ ä½¿ç”¨çš„æ˜¯ k8s çš„è¯ï¼Œç°åœ¨æœ‰ä¸€ä¸ªé¡¹ç›®å«åš rookï¼Œå®ƒå…¶å®æä¾›äº†ä¸€ä¸ª ceph çš„ operatorï¼Œè¿™ç§æ–¹æ¡ˆå…¶å®ç°åœ¨å·²ç»ç®—æ˜¯ç›¸å¯¹æ¥è¯´æ¯”è¾ƒå¾ˆç¨³å®šçš„äº†ï¼Œæ¨èå¤§å®¶å°è¯•ä¸€ä¸‹ã€‚&lt;/p>
&lt;p>&lt;strong>Q8: è¯·é—®ç”³è¯·å†…å­˜ã€é™åˆ¶å†…å­˜ã€è¿˜æœ‰æœ¬èº«Rediså†…å­˜æ€ä¹ˆé…ç½®æ¯”è¾ƒå¥½ï¼Ÿ&lt;/strong>&lt;/p>
&lt;p>&lt;strong>A8ï¼š&lt;/strong> è¿™é‡Œéœ€è¦è€ƒè™‘å‡ ä¸ªé—®é¢˜ï¼Œé¦–å…ˆæˆ‘ä»¬å…ˆè¯´Redisæœ¬èº«çš„å†…å­˜ï¼Œå…¶å®è¦çœ‹ä½ çš„å®é™…ä¸šåŠ¡çš„ä½¿ç”¨åœºæ™¯ï¼Œæˆ–è€…è¯´ä½ ä¸šåŠ¡çš„å®é™…éœ€æ±‚ï¼Œä½ è‚¯å®šä¸å¯èƒ½è®©ä½ çš„Redisçš„å®ä¾‹æˆ–è€…Redisé›†ç¾¤çš„å†…å­˜éƒ½å æ»¡ã€‚&lt;/p>
&lt;p>å¦‚æœæ˜¯å æ»¡çš„è¯ï¼Œä½ å°±éœ€è¦å¼€å¯lruå»åšé©±é€ä¹‹ç±»çš„äº‹æƒ…ï¼Œè¿™æ˜¯ä¸€æ–¹é¢ã€‚å¦ä¸€æ–¹é¢å°±æ˜¯ç”³è¯·å†…å­˜ï¼Œå…¶å®æˆ‘ç†è§£ä½ è¿™ä¸ªåœ°æ–¹è¦é—®çš„é—®é¢˜åº”è¯¥æ˜¯æŒ‡ï¼Œåœ¨k8sç¯å¢ƒä¸‹é¢ï¼Œåœ¨k8sä¸‹é¢ä¸€ä¸ªæ˜¯requestçš„ï¼Œä¸€ä¸ªæ˜¯limitï¼Œlimitè‚¯å®šæ˜¯ä½ çš„å¯ç”¨é™åˆ¶çš„å†…å­˜ï¼Œé™åˆ¶å†…å­˜ä½ ä¸€å®šéœ€è¦è€ƒè™‘åˆ°Redisæœ¬èº«è¿˜è¦ç”¨åˆ°çš„ä¸€äº›å†…å­˜ã€‚&lt;/p>
&lt;hr>
&lt;p>æ¬¢è¿è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://gitee.com/tlrr/awesome/raw/master/2020-9-9/1599632564572-mp-qrcode.png" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category><category domain="https://moelove.info/tags/Docker/">Docker</category><category domain="https://moelove.info/tags/Redis/">Redis</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| Kubernetes v1.22.0-beta.0 å‘å¸ƒ</title><link>https://moelove.info/2021/06/27/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Kubernetes-v1.22.0-beta.0-%E5%8F%91%E5%B8%83/</link><guid isPermaLink="true">https://moelove.info/2021/06/27/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Kubernetes-v1.22.0-beta.0-%E5%8F%91%E5%B8%83/</guid><pubDate>Sun, 27 Jun 2021 05:52:12 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container" title="k8sç”Ÿæ€">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="runc-v10-æ­£å¼å‘å¸ƒ">runc v1.0 æ­£å¼å‘å¸ƒ&lt;/h2>
&lt;p>ä» 2016 å¹´ 6 æœˆå‘å¸ƒ v1.0-rc1 ç‰ˆæœ¬å¼€å§‹ï¼Œè‡³ä»Šå·²æ•´æ•´ 5 å¹´æ—¶é—´ï¼Œrunc å†ç»å¤šä¸ª rc ç‰ˆæœ¬ç»ˆäºå‘å¸ƒäº† v1.0 ç‰ˆæœ¬ã€‚æ•´ä¸ªè¿‡ç¨‹åŠå…¶æ€è€ƒè¯·å‚è€ƒæˆ‘ä¹‹å‰çš„æ–‡ç«  &lt;a href="https://zhuanlan.zhihu.com/p/383133561">ã€Šå¼€æºé¡¹ç›®çš„ 5 å¹´é•¿è·‘ï¼Œrunc v1.0 ç»ˆäºæ­£å¼å‘å¸ƒï¼ã€‹&lt;/a> ã€‚è¿™é‡Œæˆ‘ä»¬æ¥çœ‹çœ‹ v1.0 æ–°ç‰ˆæœ¬ä¸­å¸¦æ¥äº†å“ªäº›å€¼å¾—æ³¨æ„çš„å˜æ›´ã€‚&lt;/p>
&lt;h3 id="ç ´åŒ–æ€§å˜æ›´">ç ´åŒ–æ€§å˜æ›´&lt;/h3>
&lt;ul>
&lt;li>&lt;a href="https://github.com/opencontainers/runc/pull/2999">#2999&lt;/a> åˆ é™¤äº† &lt;code>libcontainer/configs.Device*&lt;/code> æ ‡è¯†ï¼Œè¯·ä½¿ç”¨ &lt;code>libcontainer/devices.*&lt;/code> æ¥æ›¿ä»£ï¼ˆæ˜¯è‡ª v1.0-rc94 å¼€å§‹åºŸå¼ƒçš„ï¼‰ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/opencontainers/runc/pull/2999">#2999&lt;/a> åˆ é™¤äº† &lt;code>libcontainer/system.RunningInUserNS&lt;/code> å‡½æ•°ï¼Œè¯·ä½¿ç”¨ &lt;code>libcontainer/userns.RunningInUserNS&lt;/code> å‡½æ•°ä»£æ›¿ï¼ˆåŒæ ·æ˜¯è‡ª v1.0-rc94 å¼€å§‹åºŸå¼ƒçš„ï¼‰ï¼›&lt;/li>
&lt;/ul>
&lt;h3 id="æ”¹è¿›">æ”¹è¿›&lt;/h3>
&lt;ul>
&lt;li>&lt;a href="https://github.com/opencontainers/runc/pull/2994">#2994&lt;/a> åœ¨ &lt;code>runc update&lt;/code> çš„æ—¶å€™è®¾ç½®äº† &lt;code>SkipDevices&lt;/code> ï¼Œæ‰€ä»¥åœ¨æ­¤æœŸé—´æˆ‘ä»¬å°±ä¸ä¼šæ›´æ–° cgroups äº†ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/opencontainers/runc/pull/3010">#3010&lt;/a> cgroup1 ç›¸å…³çš„ blkio æ”¯æŒ BFQ weight äº†ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ &lt;strong>2018 å¹´ CFQ å·²ç»ä» Linux åˆ é™¤ï¼Œ22019 å¹´å‘å¸ƒçš„ RHEL 8.0 å’Œ Ubuntu 19.01 ç­‰å‘è¡Œç‰ˆä¸­ä¹Ÿå‡ä½¿ç”¨ BFQ æ›¿ä»£äº† CFQ&lt;/strong> ã€‚å…³äº Linux å†…æ ¸çš„ BFQ å’Œ CFQ è¿™é‡Œå°±ä¸å†å±•å¼€äº†ï¼Œåªéœ€è¦çŸ¥é“ BFQ ç›¸æ¯” CFQ åšåˆ°äº†ä½å»¶è¿Ÿå’Œååå³å¯ï¼›&lt;/li>
&lt;/ul>
&lt;p>æ›´å¤šå…³äºæ­¤ç‰ˆæœ¬çš„å˜æ›´ï¼Œè¯·å‚è€ƒå…¶ &lt;a href="https://github.com/opencontainers/runc/releases/tag/v1.0.0">ReleaseNote&lt;/a> ï¼Œç°åœ¨ Docker/containerd ç­‰é¡¹ç›®å·²å°† runc ä¾èµ–å‡çº§åˆ°äº† v1.0 ï¼ŒK8S é¡¹ç›®å°šæœªåˆå¹¶ã€‚&lt;/p>
&lt;h2 id="prometheus-v228-æ­£å¼å‘å¸ƒ">Prometheus v2.28 æ­£å¼å‘å¸ƒ&lt;/h2>
&lt;p>Prometheus v2.28 åœ¨ä½¿ç”¨ä½“éªŒä¸Šæœ‰äº†é‡å¤§æå‡ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹æœ‰å“ªäº›å€¼å¾—å…³æ³¨çš„å†…å®¹ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>PromQL ç¼–è¾‘å™¨é»˜è®¤å°†ä¼šå¼€å¯ï¼Œ è¿™ä¸ªç¼–è¾‘å™¨æˆ‘åœ¨ä¹‹å‰çš„ k8sç”Ÿæ€ä¸­ä»‹ç»è¿‡äº†ï¼Œè¿™é‡Œè´´ä¸ªå›¾ï¼Œçœ‹çœ‹å®ƒçš„è‡ªåŠ¨è¡¥é½, é™¤æ­¤ä¹‹å¤–è¿˜æœ‰é«˜äº®å’Œ linting çš„èƒ½åŠ›ã€‚&lt;/p>
&lt;p>&lt;img src="https://i.loli.net/2021/06/27/imhyDQjLgdO4uYq.png" alt="">&lt;/p>
&lt;/li>
&lt;li>
&lt;p>è¿˜æœ‰ metrics çš„æµè§ˆçª—å£ï¼Œä¸ºä»€ä¹ˆä¼šå†æ¬¡æè¿™ä¸ªåŠŸèƒ½å‘¢ï¼Ÿå› ä¸ºæˆ‘è§‰å¾—å®ƒå¾ˆå®ç”¨ã€‚åœ¨ä¹‹å‰çš„ç‰ˆæœ¬ï¼Œæˆ‘è¦ä¹ˆæ˜¯éœ€è¦æå‰è®°ä½æœ‰å“ªäº› metricsï¼Œè¦ä¹ˆå°±æ˜¯ç›´æ¥å» curl è¯·æ±‚ä¸‹ metrics æ¥å£ï¼Œçœ‹çœ‹æœ‰å“ªäº› metrics å¯ç”¨ã€‚ç°åœ¨çš„è¯ï¼Œç›´æ¥æµè§ˆå³å¯ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://i.loli.net/2021/06/27/NuVM7F9dYZcEjJR.png" alt="">&lt;/p>
&lt;ul>
&lt;li>
&lt;p>å¯ä»¥å±•ç¤º trace exemplar äº†ï¼Œæ•ˆæœå¦‚ä¸‹ï¼š&lt;/p>
&lt;p>&lt;img src="https://i.loli.net/2021/06/28/ykStjmwAJGKN9zP.jpg" alt="">&lt;/p>
&lt;p>è¿™ä¸ªåŠŸèƒ½è¿˜æ˜¯è›®æ–¹ä¾¿çš„ï¼Œæœ‰ç©ºäº†æˆ‘å¯ä»¥è¯¦ç»†ä»‹ç»ä¸‹ã€‚ï¼ˆflag+1ï¼‰&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æ–°å¢äº†ä¸€ä¸ªåŸºäº HTTP çš„ service discovery ï¼Œè¿™ä¸ªåŠŸèƒ½æ¯”è¾ƒå®ç”¨ï¼Œä¸å†è¦æ±‚éè¦ç‰¹å®šäºä½¿ç”¨æŸä¸ªç»„ä»¶ï¼Œåªè¦ HTTP æ¥å£è¿”å›çš„å†…å®¹ç¬¦åˆå…¶è¦æ±‚çš„æ ¼å¼ï¼Œå³å¯æ³¨å†Œåˆ° Prometheus ä¸­ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>åœ¨ Kubernetes SD ä¸­ï¼Œå¢åŠ äº†ä¸€ä¸ª ingress class name çš„å­—æ®µï¼Œæ¯”å¦‚ä½ åœ¨ä½¿ç”¨ Apache APISIX Ingress controller çš„æ—¶å€™ï¼Œé€šè¿‡æ–°ç‰ˆçš„ Prometheus é‡‡é›†ï¼Œå°±ä¼šçœ‹åˆ°ä¸€ä¸ª &lt;code>{__meta_kubernetes_ingress_class_name: apisix}&lt;/code> çš„å­—æ®µäº†ï¼›&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>æ›´å¤šå…³äºæ­¤ç‰ˆæœ¬çš„å˜æ›´ï¼Œè¯·æŸ¥çœ‹å…¶ &lt;a href="https://github.com/prometheus/prometheus/releases/tag/v2.28.0">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="kubernetes-v1220-beta0httpsgithubcomkuberneteskubernetesreleasestagv1220-beta0-å‘å¸ƒ">&lt;a href="https://github.com/kubernetes/kubernetes/releases/tag/v1.22.0-beta.0">Kubernetes v1.22.0-beta.0&lt;/a> å‘å¸ƒ&lt;/h2>
&lt;p>Kubernetes v1.22 æ­£åœ¨æŒç»­çš„è¿›è¡Œè¿­ä»£å’Œå‘å¸ƒï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹ v1.22.0-beta.0 ä¸­æœ‰å“ªäº›å€¼å¾—å…³æ³¨çš„å˜æ›´å§ï¼&lt;/p>
&lt;h3 id="åºŸå¼ƒ">åºŸå¼ƒ&lt;/h3>
&lt;ul>
&lt;li>&lt;code>--hard-pod-affinity-symmetric-weight&lt;/code> å’Œ &lt;code>--scheduler-name&lt;/code> å·²ç»ä» kube-scheduler ä¸­ç§»é™¤ï¼ˆè‡ª v1.18 åºŸå¼ƒï¼‰ï¼›&lt;/li>
&lt;/ul>
&lt;h3 id="api-å˜æ›´">API å˜æ›´&lt;/h3>
&lt;ul>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/pull/99597">#99597&lt;/a> kube-scheduler component config ç°åœ¨å¼€å§‹ç”¨ v1beta2 API ï¼Œè¿™æ„å‘³ç€ä¸‰ä¸ªæ’ä»¶è¢«åºŸå¼ƒï¼Œåˆ†åˆ«æ˜¯ NodeLabel, ServiceAffinity, NodePreferAvoidPodsï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/pull/102834">#102834&lt;/a> Network Policy EndPort å·²è¾¾åˆ° beta çº§åˆ«ï¼Œå¹¶å°†é»˜è®¤å¼€å¯ä½¿ç”¨ï¼›&lt;/li>
&lt;/ul>
&lt;h3 id="ç‰¹æ€§">ç‰¹æ€§&lt;/h3>
&lt;ul>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/pull/101316">#101316&lt;/a> &lt;strong>ä¸º StatefulSet å¢åŠ äº†ä¸€ä¸ª minReadySeconds å‚æ•°&lt;/strong>ï¼Œé€šè¿‡æ­¤å‚æ•°å¯ä»¥è®¾ç½® sts çš„æœ€å°å°±ç»ªæ—¶é—´ï¼Œä¸ä¼šè¿‡æ—©çš„åœ¨ Pod å°±ç»ªå‰å°±æŠŠæµé‡å¼•å…¥ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/pull/102722">#102722&lt;/a> ä¸º kubeadm åœ¨ &lt;code>kubeadm init&lt;/code> å¢åŠ äº† &lt;code>--dry-run&lt;/code> çš„é€‰é¡¹ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/pull/102466">#102466&lt;/a> å°† kubeadm éƒ¨ç½²ç”¨çš„ CoreDNS å‡çº§åˆ°äº† v1.8.4 åŒæ—¶ä¹Ÿæˆäºˆäº†å…¶ &lt;code>EndpointSlice&lt;/code> çš„ list å’Œ watch æƒé™ï¼›&lt;/li>
&lt;/ul>
&lt;h3 id="bugfix">bugfix&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>&lt;a href="https://github.com/kubernetes/kubernetes/pull/102840">102840&lt;/a> æ›´æ”¹äº† Graceful Node Shutdown Pod çš„ Reason å’Œ Messageï¼Œå˜æ›´å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-diff" data-lang="diff">&lt;span class="gd">- nodeShutdownReason = &amp;#34;Shutdown&amp;#34;
&lt;/span>&lt;span class="gd">- nodeShutdownMessage = &amp;#34;Node is shutting, evicting pods&amp;#34;
&lt;/span>&lt;span class="gd">- nodeShutdownNotAdmitMessage = &amp;#34;Node is in progress of shutting down, not admitting any new pods&amp;#34;
&lt;/span>&lt;span class="gd">&lt;/span>&lt;span class="gi">+ nodeShutdownReason = &amp;#34;Terminated&amp;#34;
&lt;/span>&lt;span class="gi">+ nodeShutdownMessage = &amp;#34;Pod was terminated in response to imminent node shutdown.&amp;#34;
&lt;/span>&lt;span class="gi">+ nodeShutdownNotAdmittedReason = &amp;#34;NodeShutdown&amp;#34;
&lt;/span>&lt;span class="gi">+ nodeShutdownNotAdmittedMessage = &amp;#34;Pod was rejected as the node is shutting down.&amp;#34;
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul>
&lt;p>æ›´å¤šå…³äºæ­¤ç‰ˆæœ¬çš„å˜æ›´è¯·å‚è€ƒå…¶ &lt;a href="https://github.com/kubernetes/kubernetes/blob/master/CHANGELOG/CHANGELOG-1.22.md#changelog-since-v1220-alpha3">ReleaseNote&lt;/a>&lt;/p>
&lt;hr>
&lt;p>æ¬¢è¿è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://gitee.com/tlrr/awesome/raw/master/2020-9-9/1599632564572-mp-qrcode.png" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>æ›´ä¼˜é›…çš„ Kubernetes é›†ç¾¤äº‹ä»¶åº¦é‡æ–¹æ¡ˆ</title><link>https://moelove.info/2021/06/25/%E6%9B%B4%E4%BC%98%E9%9B%85%E7%9A%84-Kubernetes-%E9%9B%86%E7%BE%A4%E4%BA%8B%E4%BB%B6%E5%BA%A6%E9%87%8F%E6%96%B9%E6%A1%88/</link><guid isPermaLink="true">https://moelove.info/2021/06/25/%E6%9B%B4%E4%BC%98%E9%9B%85%E7%9A%84-Kubernetes-%E9%9B%86%E7%BE%A4%E4%BA%8B%E4%BB%B6%E5%BA%A6%E9%87%8F%E6%96%B9%E6%A1%88/</guid><pubDate>Fri, 25 Jun 2021 05:53:03 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å¼ æ™‹æ¶›ã€‚&lt;/p>
&lt;p>&lt;img src="https://i.loli.net/2021/06/25/294ohZRewN7c8qI.jpg" alt="">&lt;/p>
&lt;p>ç¾¤é‡Œæœ‰ä¸ªå°ä¼™ä¼´é—®äº†æˆ‘ä¸Šå›¾ä¸­è¿™ä¸ªé—®é¢˜ï¼Œå¦‚ä½•åº¦é‡æ»šåŠ¨å‡çº§è¿™ä¸ªè¿‡ç¨‹çš„æ—¶é—´ã€‚&lt;/p>
&lt;p>è¿™ä¸ªé—®é¢˜å¯ä»¥æŠ½è±¡ä¸ºä¸€ç§é€šç”¨éœ€æ±‚ï¼Œé€‚ç”¨äºå¤šç§åœºæ™¯ã€‚&lt;/p>
&lt;ul>
&lt;li>æ¯”å¦‚ä½ æ˜¯ Kubernetes é›†ç¾¤çš„ç®¡ç†å‘˜ï¼Œä½ æƒ³åº¦é‡è¿™ä¸ªè¿‡ç¨‹ä¸­çš„è€—æ—¶ï¼Œä»¥ä¾¿å‘ç°ä¼˜åŒ–ç‚¹ï¼›&lt;/li>
&lt;li>æ¯”å¦‚ä½ æ˜¯åœ¨åš CI/CD ï¼Œä½ æƒ³é€šè¿‡åº¦é‡è¿™ä¸ªè¿‡ç¨‹çš„è€—æ—¶ï¼Œæ¥ç»™å‡º CI/CD è¿‡ç¨‹çš„è€—æ—¶ï¼›&lt;/li>
&lt;/ul>
&lt;h2 id="ç°æœ‰æ–¹æ¡ˆ">ç°æœ‰æ–¹æ¡ˆ&lt;/h2>
&lt;p>Kubernetes å·²ç»æä¾›äº†å¾ˆæ–¹ä¾¿çš„åŠæ³•æ¥è§£å†³æ­¤é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯æˆ‘å›å¤ä¸­è°ˆåˆ°çš„ï¼Œé€šè¿‡ event æ¥åº¦é‡å³å¯ã€‚&lt;/p>
&lt;p>æ¯”å¦‚ï¼Œæˆ‘ä»¬åœ¨ K8S ä¸­ï¼Œåˆ›å»ºä¸€ä¸ª deploymentï¼Œçœ‹çœ‹è¿™ä¸ªè¿‡ç¨‹ä¸­çš„ event ä¿¡æ¯ï¼š&lt;/p>
&lt;pre>&lt;code>âœ ~ kubectl create ns moelove
namespace/moelove created
âœ ~ kubectl -n moelove create deployment redis --image=ghcr.io/moelove/redis:alpine
deployment.apps/redis created
âœ ~ kubectl -n moelove get deploy
NAME READY UP-TO-DATE AVAILABLE AGE
redis 1/1 1 1 16s
âœ ~ kubectl -n moelove get events
LAST SEEN TYPE REASON OBJECT MESSAGE
27s Normal Scheduled pod/redis-687967dbc5-gsz5n Successfully assigned moelove/redis-687967dbc5-gsz5n to kind-control-plane
27s Normal Pulled pod/redis-687967dbc5-gsz5n Container image &amp;quot;ghcr.io/moelove/redis:alpine&amp;quot; already present on machine
27s Normal Created pod/redis-687967dbc5-gsz5n Created container redis
27s Normal Started pod/redis-687967dbc5-gsz5n Started container redis
27s Normal SuccessfulCreate replicaset/redis-687967dbc5 Created pod: redis-687967dbc5-gsz5n
27s Normal ScalingReplicaSet deployment/redis Scaled up replica set redis-687967dbc5 to 1
&lt;/code>&lt;/pre>&lt;p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬ä¸»è¦å…³æ³¨çš„ä¸€äº›äº‹ä»¶å‡å·²ç»æœ‰è®°å½•äº†ã€‚ä½†æ˜¯æ€»ä¸èƒ½æ¯æ¬¡éƒ½é€šè¿‡ kubectl è¿™ä¹ˆæ¥çœ‹å§ï¼Œæœ‰ç‚¹æµªè´¹æ—¶é—´ã€‚&lt;/p>
&lt;p>æˆ‘ä¹‹å‰çš„ä¸€ç§åšæ³•æ˜¯åœ¨ K8S ä¸­å†™äº†ä¸€ä¸ªç¨‹åºï¼ŒæŒç»­çš„ç›‘å¬&amp;amp;æ”¶é›† K8S é›†ç¾¤ä¸­çš„ event ï¼Œå¹¶å°†å®ƒå†™å…¥åˆ°æˆ‘å¦å¤–å¼€å‘çš„ä¸€å¥—ç³»ç»Ÿä¸­è¿›è¡Œå­˜å‚¨å’Œå¯è§†åŒ–ã€‚ä½†è¿™ç§æ–¹æ³•éœ€è¦åšé¢å¤–çš„å¼€å‘ä¹Ÿå¹¶ä¸æ™®é€‚ã€‚è¿™é‡Œæˆ‘æ¥ä»‹ç»å¦ä¸€ä¸ªæ›´ä¼˜çš„è§£å†³æ–¹æ¡ˆã€‚&lt;/p>
&lt;h2 id="æ›´ä¼˜é›…çš„æ–¹æ¡ˆ">æ›´ä¼˜é›…çš„æ–¹æ¡ˆ&lt;/h2>
&lt;p>K8S ä¸­çš„è¿™äº›äº‹ä»¶ï¼Œéƒ½å¯¹åº”ç€æˆ‘ä»¬çš„ä¸€ä¸ªæ“ä½œï¼Œæ¯”å¦‚ä¸Šæ–‡ä¸­æ˜¯åˆ›å»ºäº†ä¸€ä¸ª deployment ï¼Œå®ƒäº§ç”Ÿäº†å‡ ä¸ª event ï¼Œ åŒ…æ‹¬ &lt;code>Scheduled&lt;/code> , &lt;code>Pulled&lt;/code> ï¼Œ&lt;code>Created&lt;/code> ç­‰ã€‚æˆ‘ä»¬å°†å…¶è¿›è¡ŒæŠ½è±¡ï¼Œæ˜¯ä¸æ˜¯å’Œæˆ‘ä»¬åšçš„é“¾è·¯è¿½è¸ªï¼ˆtracingï¼‰å¾ˆåƒå‘¢ï¼Ÿ&lt;/p>
&lt;p>è¿™é‡Œæˆ‘ä»¬ä¼šç”¨åˆ°ä¸€ä¸ª CNCF çš„æ¯•ä¸šé¡¹ç›® &lt;a href="https://www.jaegertracing.io/" title="Jaeger">Jaeger&lt;/a> ï¼Œåœ¨ä¹‹å‰çš„ &lt;a href="https://zhuanlan.zhihu.com/container">K8Sç”Ÿæ€å‘¨æŠ¥&lt;/a> ä¸­æˆ‘æœ‰å¤šæ¬¡ä»‹ç»å®ƒï¼ŒJaeger æ˜¯ä¸€æ¬¾å¼€æºçš„ï¼Œç«¯å¯¹ç«¯çš„åˆ†å¸ƒå¼ tracing ç³»ç»Ÿã€‚ä¸è¿‡æœ¬æ–‡é‡ç‚¹ä¸æ˜¯ä»‹ç»å®ƒï¼Œæ‰€ä»¥æˆ‘ä»¬&lt;a href="https://www.jaegertracing.io/docs/1.23/getting-started/">æŸ¥çœ‹å…¶æ–‡æ¡£&lt;/a>ï¼Œå¿«é€Ÿçš„éƒ¨ç½²ä¸€ä¸ª Jaeger å³å¯ã€‚å¦ä¸€ä¸ª CNCF çš„ sandbox çº§åˆ«çš„é¡¹ç›®æ˜¯ &lt;a href="https://opentelemetry.io/" title="OpenTelemetry">OpenTelemetry&lt;/a> æ˜¯ä¸€ä¸ªäº‘åŸç”Ÿè½¯ä»¶çš„å¯è§‚æµ‹æ¡†æ¶ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå®ƒè·Ÿ Jaeger ç»“åˆèµ·æ¥ä½¿ç”¨ã€‚ä¸è¿‡æœ¬æ–‡çš„é‡ç‚¹ä¸æ˜¯ä»‹ç»è¿™ä¿©é¡¹ç›®ï¼Œè¿™é‡Œæš‚ä¸”ç•¥è¿‡ã€‚&lt;/p>
&lt;p>æ¥ä¸‹æ¥ä»‹ç»æˆ‘ä»¬è¿™ç¯‡æ–‡ç« çš„ç”¨åˆ°çš„ä¸»è¦é¡¹ç›®ï¼Œæ˜¯æ¥è‡ª Weaveworks å¼€æºçš„ä¸€ä¸ªé¡¹ç›®ï¼Œåå« &lt;a href="https://github.com/weaveworks-experiments/kspan">kspan&lt;/a> ï¼Œå®ƒçš„ä¸»è¦åšæ³•å°±æ˜¯å°† K8S ä¸­çš„ event ä½œä¸º trace ç³»ç»Ÿä¸­çš„ span è¿›è¡Œç»„ç»‡ã€‚&lt;/p>
&lt;h3 id="éƒ¨ç½²-kspan">éƒ¨ç½² kspan&lt;/h3>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="nn">---&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ServiceAccount&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">kspan&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nn">---&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">rbac.authorization.k8s.io/v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ClusterRoleBinding&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">creationTimestamp&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">kspan-admin&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">roleRef&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">apiGroup&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">rbac.authorization.k8s.io&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ClusterRole&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">cluster-admin&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">subjects&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>- &lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ServiceAccount&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">kspan&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">namespace&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">default&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nn">---&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Pod&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">labels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">run&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">kspan&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">kspan&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">containers&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">image&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">docker.io/weaveworks/kspan:v0.0&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">kspan&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">resources&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>{}&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">dnsPolicy&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ClusterFirst&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">restartPolicy&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Always&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">serviceAccountName&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">kspan&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¯ä»¥ç›´æ¥ä½¿ç”¨æˆ‘è¿™é‡Œæä¾›çš„ YAML è¿›è¡Œéƒ¨ç½²æµ‹è¯•ï¼Œ&lt;strong>ä½†æ³¨æ„ä¸Šè¿°é…ç½®æ–‡ä»¶åˆ«ç”¨åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ï¼Œ RBAC æƒé™éœ€è¦ä¿®æ”¹&lt;/strong> ã€‚&lt;/p>
&lt;p>å®ƒé»˜è®¤ä¼šä½¿ç”¨ &lt;code>otlp-collector.default:55680&lt;/code> ä¼ é€’ span ï¼Œæ‰€æœ‰ä½ éœ€è¦ç¡®ä¿æœ‰è¿™ä¸ª svc å­˜åœ¨ã€‚ä»¥ä¸Šæ‰€æœ‰å†…å®¹éƒ¨ç½²å®Œæˆåä½ å¤§æ¦‚ä¼šæ˜¯è¿™æ ·ï¼š&lt;/p>
&lt;pre>&lt;code>âœ ~ kubectl get all
NAME READY STATUS RESTARTS AGE
pod/jaeger-76c84457fb-89s5v 1/1 Running 0 64m
pod/kspan 1/1 Running 0 35m
pod/otel-agent-sqlk6 1/1 Running 0 59m
pod/otel-collector-69985cc444-bjb92 1/1 Running 0 56m
NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE
service/jaeger-collector ClusterIP 10.96.47.12 &amp;lt;none&amp;gt; 14250/TCP 60m
service/kubernetes ClusterIP 10.96.0.1 &amp;lt;none&amp;gt; 443/TCP 39h
service/otel-collector ClusterIP 10.96.231.43 &amp;lt;none&amp;gt; 4317/TCP,14250/TCP,14268/TCP,9411/TCP,8888/TCP 59m
service/otlp-collector ClusterIP 10.96.79.181 &amp;lt;none&amp;gt; 55680/TCP 52m
NAME DESIRED CURRENT READY UP-TO-DATE AVAILABLE NODE SELECTOR AGE
daemonset.apps/otel-agent 1 1 1 1 1 &amp;lt;none&amp;gt; 59m
NAME READY UP-TO-DATE AVAILABLE AGE
deployment.apps/jaeger 1/1 1 1 73m
deployment.apps/otel-collector 1/1 1 1 59m
NAME DESIRED CURRENT READY AGE
replicaset.apps/jaeger-6f77c67c44 0 0 0 73m
replicaset.apps/jaeger-76c84457fb 1 1 1 64m
replicaset.apps/otel-collector-69985cc444 1 1 1 59m
&lt;/code>&lt;/pre>&lt;h3 id="ä¸Šæ‰‹å®è·µ">ä¸Šæ‰‹å®è·µ&lt;/h3>
&lt;p>è¿™é‡Œæˆ‘ä»¬å…ˆåˆ›å»ºä¸€ä¸ª namespace ç”¨äºæµ‹è¯•ï¼š&lt;/p>
&lt;pre>&lt;code>âœ ~ kubectl create ns moelove
namespace/moelove created
&lt;/code>&lt;/pre>&lt;p>åˆ›å»ºä¸€ä¸ª Deployment&lt;/p>
&lt;pre>&lt;code>âœ ~ kubectl -n moelove create deployment redis --image=ghcr.io/moelove/redis:alpine
deployment.apps/redis created
âœ ~ kubectl -n moelove get pods
NAME READY STATUS RESTARTS AGE
redis-687967dbc5-xj2zs 1/1 Running 0 10s
&lt;/code>&lt;/pre>&lt;p>åœ¨ Jaeger ä¸Šè¿›è¡ŒæŸ¥çœ‹ï¼š&lt;/p>
&lt;p>&lt;img src="https://i.loli.net/2021/06/25/FhyKx2c3wpSjqMl.png" alt="">&lt;/p>
&lt;p>ç‚¹å¼€çœ‹è¯¦ç»†å†…å®¹&lt;/p>
&lt;p>&lt;img src="https://i.loli.net/2021/06/25/cIyzN5Himdb6GEW.png" alt="">&lt;/p>
&lt;p>å¯ä»¥çœ‹åˆ°ï¼Œå’Œæ­¤åˆ›å»º deploy æœ‰å…³çš„ event å‡è¢«å½’åˆ°äº†ä¸€èµ·ï¼Œåœ¨æ—¶é—´çº¿ä¸Šå¯ä»¥çœ‹åˆ°å…¶è€—æ—¶ç­‰è¯¦ç»†ä¿¡æ¯ã€‚&lt;/p>
&lt;h2 id="æ€»ç»“">æ€»ç»“&lt;/h2>
&lt;p>æœ¬æ–‡ä»‹ç»äº†å¦‚ä½•ç»“åˆ Jaeger åˆ©ç”¨ tracing çš„æ–¹å¼æ¥é‡‡é›† K8S ä¸­çš„ events ï¼Œä»¥ä¾¿æ›´å¥½çš„æŒæ¡ K8S é›†ç¾¤ä¸­æ‰€æœ‰äº‹ä»¶çš„è€—æ—¶ç‚¹ï¼Œæ›´æ˜“äºæ‰¾åˆ°ä¼˜åŒ–çš„æ–¹å‘åŠåº¦é‡ç»“æœã€‚&lt;/p>
&lt;hr>
&lt;p>æ¬¢è¿è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://gitee.com/tlrr/awesome/raw/master/2020-9-9/1599632564572-mp-qrcode.png" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Jaeger/">Jaeger</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>å¼€æºé¡¹ç›®çš„ 5 å¹´é•¿è·‘ï¼Œrunc v1.0 ç»ˆäºæ­£å¼å‘å¸ƒï¼</title><link>https://moelove.info/2021/06/23/%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE%E7%9A%84-5-%E5%B9%B4%E9%95%BF%E8%B7%91runc-v1.0-%E7%BB%88%E4%BA%8E%E6%AD%A3%E5%BC%8F%E5%8F%91%E5%B8%83/</link><guid isPermaLink="true">https://moelove.info/2021/06/23/%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE%E7%9A%84-5-%E5%B9%B4%E9%95%BF%E8%B7%91runc-v1.0-%E7%BB%88%E4%BA%8E%E6%AD%A3%E5%BC%8F%E5%8F%91%E5%B8%83/</guid><pubDate>Wed, 23 Jun 2021 02:08:20 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>æœ¬æ–‡æˆ‘æ¥åˆ†äº«ä¸‹ä¸æˆ‘ä»¬ï¼ˆæå®¹å™¨åŒ–/K8S ä»ä¸šè€…ï¼‰æ¯æ¯ç›¸å…³çš„ä¸€ä¸ªåŸºç¡€é¡¹ç›® &lt;a href="https://github.com/opencontainers/runc" title="runc">runc&lt;/a> æ˜¯å¦‚ä½•è‡ª 2016 å¹´å‘å¸ƒäº† v1.0.0-rc1 åˆ°ç°åœ¨å†ç» 5 å¹´é•¿è·‘ï¼Œä» rc1 ä¸€ç›´åˆ° rc95 ï¼Œå¦‚ä»Šç»ˆäºæ­£å¼å‘å¸ƒ v1.0 ç‰ˆæœ¬çš„è¿‡ç¨‹ï¼ŒåŠè¿™ä¸­é—´çš„æ•…äº‹ã€‚&lt;/p>
&lt;/blockquote>
&lt;p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å¼ æ™‹æ¶›ã€‚&lt;/p>
&lt;p>åœ¨ 2018 å¹´ 11 æœˆåº•æ—¶ï¼Œæˆ‘å†™äº†ä¸€ç¯‡æ–‡ç«  &lt;a href="https://zhuanlan.zhihu.com/p/50923312" title="runc-1.0-rc6-å‘å¸ƒä¹‹é™…">ã€Šrunc 1.0-rc6 å‘å¸ƒä¹‹é™…ã€‹&lt;/a> , é‚£åº”è¯¥æ˜¯æˆ‘ç¬¬ä¸€æ¬¡å…¬å¼€ä»‹ç» runcã€‚å¦‚æœä½ è¿˜ä¸äº†è§£ runc æ˜¯ä»€ä¹ˆï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨å®ƒï¼Œè¯·å‚è€ƒæˆ‘é‚£ç¯‡æ–‡ç« ã€‚æœ¬æ–‡ä¸­ä¸å†å¯¹å…¶æ¦‚å¿µå’Œç”¨æ³•ç­‰è¿›è¡Œè¯´æ˜ã€‚&lt;/p>
&lt;p>åœ¨ 2019 å¹´ 3 æœˆåº•æ—¶ï¼Œæˆ‘å†™äº†å¦ä¸€ç¯‡æ–‡ç«  &lt;a href="https://zhuanlan.zhihu.com/p/60981504" title="runc 1.0-rc7 å‘å¸ƒä¹‹é™…">ã€Šrunc 1.0-rc7 å‘å¸ƒä¹‹é™…ã€‹&lt;/a>ï¼Œä»‹ç» runc 1.0-rc7 å‘å¸ƒçš„åŸå› ï¼ŒåŠé‚£ä¸ªç‰ˆæœ¬ä¸­æœ€ä¸»è¦çš„ä¿®å¤ &lt;strong>&lt;a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-5736">&lt;code>CVE-2019-5736&lt;/code>&lt;/a>&lt;/strong> ã€‚å…¶ä¸­ä¹Ÿä»‹ç»äº†å…³äº runc/Docker ç­‰å¯¹äº Linux å†…æ ¸å…¼å®¹æ€§çš„é—®é¢˜ï¼Œæ„Ÿå…´è¶£çš„å°ä¼™ä¼´å¯ä»¥çœ‹çœ‹ã€‚&lt;/p>
&lt;p>å…³æ³¨æˆ‘çš„æœ‹å‹ä»¬ï¼Œåº”è¯¥ä¹Ÿåœ¨ &lt;a href="https://zhuanlan.zhihu.com/container" title="K8S ç”Ÿæ€">K8S ç”Ÿæ€å‘¨æŠ¥&lt;/a> ä¸­å¤šæ¬¡çœ‹åˆ°è¿‡æˆ‘å¯¹ runc çš„ä»‹ç»ï¼ŒåŒ…æ‹¬å…¶ç‰¹æ€§åŠå®‰å…¨æ¼æ´ç­‰æ–¹é¢ã€‚&lt;/p>
&lt;p>åœ¨ 2015 å¹´ 6 æœˆï¼Œ Docker ï¼ŒCoreOS å’Œå…¶ä»–ä¸€äº›å…¬å¸å…±åŒæˆç«‹äº† &lt;a href="https://opencontainers.org/">OCI ï¼ˆå¼€æ”¾å®¹å™¨è®¡åˆ’ï¼‰&lt;/a> ç»„ç»‡ï¼Œå…¶æœ€ä¸»è¦çš„å†…å®¹æœ‰ä¸¤ä¸ªï¼š&lt;/p>
&lt;ul>
&lt;li>å®¹å™¨è¿è¡Œæ—¶è§„èŒƒ&lt;/li>
&lt;li>å®¹å™¨é•œåƒè§„èŒƒ&lt;/li>
&lt;/ul>
&lt;p>Docker å°†å…¶è¿è¡Œæ—¶æèµ ç»™äº† OCI ï¼Œä½œä¸ºå®¹å™¨è¿è¡Œæ—¶è§„èŒƒçš„åŸºç¡€å®ç°ï¼Œæ‰˜ç®¡åœ¨äº† &lt;a href="https://github.com/opencontainers/runc">https://github.com/opencontainers/runc&lt;/a> ä¹Ÿå°±æ˜¯ç°åœ¨å¤§å®¶çœ‹åˆ°çš„ runc äº†ã€‚&lt;/p>
&lt;h2 id="å‘å¸ƒå†ç¨‹">å‘å¸ƒå†ç¨‹&lt;/h2>
&lt;p>æˆ‘ä»¬æ¥çœ‹çœ‹ runc ç‰ˆæœ¬å‘å¸ƒçš„å†ç¨‹ï¼Œä»¥ä¾¿äº†è§£å®ƒä¸ºä½•é•¿è·‘ 5 å¹´ã€‚&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align:center">runc version&lt;/th>
&lt;th style="text-align:center">release time&lt;/th>
&lt;th style="text-align:center">runtime-spec version&lt;/th>
&lt;th style="text-align:center">å¤‡æ³¨&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align:center">runc v1.0-rc1&lt;/td>
&lt;td style="text-align:center">2016.06.04&lt;/td>
&lt;td style="text-align:center">v1.0.0-rc1&lt;/td>
&lt;td style="text-align:center">&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">runc v1.0-rc2&lt;/td>
&lt;td style="text-align:center">2016.10.01&lt;/td>
&lt;td style="text-align:center">v1.0.0-rc2-38-g1c7c27d&lt;/td>
&lt;td style="text-align:center">&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">runc v1.0-rc3&lt;/td>
&lt;td style="text-align:center">2017.03.22&lt;/td>
&lt;td style="text-align:center">&lt;a href="https://github.com/opencontainers/runc/pull/1370">v1.0.0-rc5&lt;/a>&lt;/td>
&lt;td style="text-align:center">&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">runc v1.0-rc4&lt;/td>
&lt;td style="text-align:center">2017.08.09&lt;/td>
&lt;td style="text-align:center">v1.0.0&lt;/td>
&lt;td style="text-align:center">runtime-spec é¦–æ¬¡å‘å¸ƒ v1.0&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">runc v1.0-rc5&lt;/td>
&lt;td style="text-align:center">2018.02.27&lt;/td>
&lt;td style="text-align:center">v1.0.0&lt;/td>
&lt;td style="text-align:center">é¦–æ¬¡è®¡åˆ’ä½œä¸ºæœ€åä¸€ä¸ª rc ç‰ˆæœ¬&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">runc v1.0-rc6&lt;/td>
&lt;td style="text-align:center">2018.11.21&lt;/td>
&lt;td style="text-align:center">v1.0.1-49-g5684b8a&lt;/td>
&lt;td style="text-align:center">è®¡åˆ’æ˜¯ 1.0 ä¹‹å‰çš„æœ€åä¸€ä¸ªåŠŸèƒ½ç‰ˆæœ¬ï¼ŒåŒ…å«äº†ä¸€äº›è§„èŒƒåˆè§„æ€§çš„ä¿®æ­£&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">runc v1.0-rc7&lt;/td>
&lt;td style="text-align:center">2019.03.28&lt;/td>
&lt;td style="text-align:center">v1.0.1-59-g29686db&lt;/td>
&lt;td style="text-align:center">ä¿®å¤ CVE-2019-5736&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">runc v1.0-rc8&lt;/td>
&lt;td style="text-align:center">2019.04.26&lt;/td>
&lt;td style="text-align:center">v1.0.1-59-g29686db&lt;/td>
&lt;td style="text-align:center">ä¿®å¤ v1.0.0-rc7&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">runc v1.0-rc9&lt;/td>
&lt;td style="text-align:center">2019.10.05&lt;/td>
&lt;td style="text-align:center">v1.0.1-59-g29686db&lt;/td>
&lt;td style="text-align:center">ä¿®å¤ CVE-2019-16884&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">runc v1.0-rc10&lt;/td>
&lt;td style="text-align:center">2020.01.23&lt;/td>
&lt;td style="text-align:center">v1.0.1-59-g29686db&lt;/td>
&lt;td style="text-align:center">ä¿®å¤ CVE-2019-19921&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">runc v1.0-rc90&lt;/td>
&lt;td style="text-align:center">2020.05.12&lt;/td>
&lt;td style="text-align:center">v1.0.1-59-g29686db&lt;/td>
&lt;td style="text-align:center">ä¸ runc v1.0-rc10 ç›¸åŒï¼Œæ˜¯ä¸ºäº†ä¿®æ­£ version scheme&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">runc v1.0-rc91&lt;/td>
&lt;td style="text-align:center">2020.07.02&lt;/td>
&lt;td style="text-align:center">v1.0.2-8-g237cc4f&lt;/td>
&lt;td style="text-align:center">å¼€å§‹æ”¯æŒ cgroup v2 ï¼›ä¸€äº›è§„èŒƒæ€§çš„é—®é¢˜å¾—åˆ°è§£å†³&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">runc v1.0-rc92&lt;/td>
&lt;td style="text-align:center">2020.08.06&lt;/td>
&lt;td style="text-align:center">v1.0.2-23-g4d89ac9&lt;/td>
&lt;td style="text-align:center">ä¿®å¤æˆ‘åœ¨ runc v1.0-rc91 ä¸­å‘ç°çš„ bug&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">runc v1.0-rc93&lt;/td>
&lt;td style="text-align:center">2021.02.04&lt;/td>
&lt;td style="text-align:center">v1.0.2-35-ge6143ca&lt;/td>
&lt;td style="text-align:center">cgroup v2 å¾—åˆ°ç¨³å®šæ”¯æŒï¼Œ&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">runc v1.0-rc94&lt;/td>
&lt;td style="text-align:center">2021.05.10&lt;/td>
&lt;td style="text-align:center">v1.0.2-57-g1c3f411&lt;/td>
&lt;td style="text-align:center">ä¿®å¤ runc v1.0-rc93 ä¸­çš„ regressions&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">runc v1.0-rc95&lt;/td>
&lt;td style="text-align:center">2021.05.19&lt;/td>
&lt;td style="text-align:center">v1.0.2-57-g1c3f411&lt;/td>
&lt;td style="text-align:center">ä¿®å¤ &lt;a href="https://github.com/opencontainers/runc/security/advisories/GHSA-c3xm-pvg7-gh7r">CVE-2021-30465&lt;/a>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">runc v1.0&lt;/td>
&lt;td style="text-align:center">2021.06.22&lt;/td>
&lt;td style="text-align:center">v1.0.2-57-g1c3f411&lt;/td>
&lt;td style="text-align:center">&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>æˆ‘åœ¨ä¸Šé¢çš„è¡¨æ ¼ä¸­ï¼Œä¸“é—¨å¢åŠ äº†ä¸€åˆ— &lt;strong>runtime-spec version&lt;/strong> ï¼Œè¡¨ç¤º OCI ç»„ç»‡ä¸­çš„å®¹å™¨è¿è¡Œæ—¶è§„èŒƒçš„ç‰ˆæœ¬ã€‚æˆ‘ä»¬æ¥æ€»ç»“ä¸‹è¿™ä¸ªå‘å¸ƒè¿›ç¨‹ï¼š&lt;/p>
&lt;ul>
&lt;li>åœ¨ runc v1.0-rc5 ä¹‹å‰ï¼Œrunc å…¶å®ä¹Ÿæ²¡æ‰“ç®—å‘å¸ƒæ­£å¼ç‰ˆï¼Œæ¯•ç«Ÿæ ‡å‡†è¿˜æ²¡æ­£å¼å®Œæˆå‘¢ï¼Œå®ç°ä¹Ÿä¸å¯èƒ½å…ˆå‡ºç¨³å®šç‰ˆï¼›&lt;/li>
&lt;li>runc v1.0-rc7 , rc 9 ~ rc 10 å‡æ˜¯ä¸ºäº†ä¿®æ­£ä¸¥é‡çš„å®‰å…¨é—®é¢˜ï¼›&lt;/li>
&lt;li>runc v1.0-rc90 çº¯ç²¹æ˜¯è§£å†³ version scheme çš„é—®é¢˜ï¼›&lt;/li>
&lt;li>runc v1.0-rc91~rc93 ä¸»è¦åŠŸèƒ½ç‚¹æ˜¯åœ¨ cgroup v2 çš„æ”¯æŒï¼Œä»¥åŠä¸€äº›è·Ÿè§„èŒƒé›†æˆçš„é—®é¢˜ï¼›&lt;/li>
&lt;li>runc v1.0-93 ä¹‹åï¼Œå…¶å®å°±åŸºæœ¬æ§åˆ¶ä»£ç å†»ç»“äº†ï¼Œç›´åˆ° runc v1.0-rc95 ä¿®å¤äº†ä¸€ä¸ªå®‰å…¨æ¼æ´ï¼›&lt;/li>
&lt;li>ç›®å‰ä¸»è¦çš„å‡ ä¸ªä»“åº“ä¹Ÿéƒ½å·²ç»æµ‹è¯•äº†è·Ÿ runc ä»£ç ä»“åº“ä¸­æœ€æ–°ä»£ç çš„é›†æˆï¼Œç›¸å…³çš„é—®é¢˜ä¹Ÿå·²ç»ä¿®å¤ã€‚&lt;/li>
&lt;/ul>
&lt;p>ä»è¿™é‡Œçœ‹åˆ°çš„ä¸‰ä¸ªä¸»è¦è€—æ—¶çš„ç‚¹å¦‚ä¸‹ï¼š&lt;/p>
&lt;ul>
&lt;li>runtime-spec å°šæœªæ­£å¼å‘å¸ƒ v1.0 ç‰ˆæœ¬ï¼›&lt;/li>
&lt;li>ä¿®å¤å®‰å…¨æ¼æ´å’Œè‡ªèº«çš„ bug ï¼›&lt;/li>
&lt;li>å®Œæˆæ–°ç‰¹æ€§çš„è€—æ—¶ï¼›&lt;/li>
&lt;/ul>
&lt;p>è§„èŒƒæœªå‘å¸ƒ v1.0 è€—æ—¶çš„éƒ¨åˆ†è¿™é‡Œå°±ä¸å¤šè¯´äº†ï¼Œè¿™ä¹Ÿæ˜¯ä¸ªä¾èµ–é¡¹ï¼Œå¯¹äºå¤§å¤šæ•°çš„é¡¹ç›®/è½¯ä»¶å¼€å‘éƒ½ä¼šæœ‰ç±»ä¼¼çš„æƒ…å†µï¼Œåªèƒ½å»æ¨åŠ¨è§„èŒƒçš„å‘å¸ƒäº†ï¼›&lt;/p>
&lt;p>è‡³äºç‰¹æ€§ï¼Œbug å’Œå®‰å…¨æ¼æ´ç­‰çš„è€—æ—¶ï¼Œè¿™å…¶å®è·Ÿ runc é¡¹ç›®çš„åŠŸèƒ½å’Œå…¶å®šä½æœ‰å…³ã€‚runc ååº•å±‚äº†ä¸€äº›ï¼Œè¿™å°±éœ€è¦æœ‰æ›´å¤šç›¸å…³é¢†åŸŸçš„çŸ¥è¯†æ¥æ”¯æ’‘ã€‚å°±æ‹¿æˆ‘åœ¨ runc v1.0-rc 91 ä¸­å‘ç°çš„é‚£ä¸ªbug æ¥è¯´ï¼Œå¯¹ Linux å†…æ ¸æºç ä¸å¤ªäº†è§£çš„äººï¼Œç¡®å®ä¼šèŠ±è´¹æ¯”è¾ƒå¤šæ—¶é—´çš„ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-diff" data-lang="diff">&lt;span class="gd">- switch {
&lt;/span>&lt;span class="gd">- case mode&amp;amp;unix.S_IFBLK == unix.S_IFBLK:
&lt;/span>&lt;span class="gd">&lt;/span>&lt;span class="gi">+ switch mode &amp;amp; unix.S_IFMT {
&lt;/span>&lt;span class="gi">+ case unix.S_IFBLK:
&lt;/span>&lt;span class="gi">&lt;/span> devType = configs.BlockDevice
&lt;span class="gd">- case mode&amp;amp;unix.S_IFCHR == unix.S_IFCHR:
&lt;/span>&lt;span class="gd">&lt;/span>&lt;span class="gi">+ case unix.S_IFCHR:
&lt;/span>&lt;span class="gi">&lt;/span> devType = configs.CharDevice
&lt;span class="gd">- case mode&amp;amp;unix.S_IFIFO == unix.S_IFIFO:
&lt;/span>&lt;span class="gd">&lt;/span>&lt;span class="gi">+ case unix.S_IFIFO:
&lt;/span>&lt;span class="gi">&lt;/span> devType = configs.FifoDevice
default:
return nil, ErrNotADevice
&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ­¤å¤–ä¸å¾—ä¸æçš„å°±æ˜¯åœ¨ runc è¿™äº›ç‰ˆæœ¬ä¸­è¿˜æœ‰ä¸€å¤§æ‰¹æ¯”è¾ƒè€—è´¹æ—¶é—´å’Œç²¾åŠ›çš„å·¥ä½œï¼ŒåŒ…æ‹¬æ·»åŠ æµ‹è¯•ï¼Œä»¥åŠæ€§èƒ½ä¼˜åŒ–ç­‰ï¼Œä½œä¸ºåº•å±‚çš„åŸºç¡€è½¯ä»¶ï¼Œæ€§èƒ½ä¼˜åŒ–å¯¹äºä¸Šå±‚çš„åº”ç”¨/å¹³å°è€Œè¨€å½±å“é‡å¤§ã€‚&lt;/p>
&lt;p>æœ‰è¶£çš„æ˜¯ runc v1.0 ç‰ˆæœ¬ Release çš„æ ‡é¢˜æ˜¯ &lt;strong>&amp;quot;A wizard is never late, nor is he early, he arrives precisely when he means to.&amp;quot;&lt;/strong> è¿™å¤§æ¦‚ä¹Ÿå¾ˆç¬¦åˆ runc çš„å‘å¸ƒå†ç¨‹äº†å§ :)&lt;/p>
&lt;p>&lt;strong>ä½†æ— è®ºå¦‚ä½•ï¼Œrunc ç»è¿‡ 5 å¹´é•¿è·‘ï¼Œç»ˆäºå‘å¸ƒäº† v1.0 ç‰ˆæœ¬ï¼æ„Ÿè°¢æ¯ä¸€ä¸ªä¸ºä¹‹ä»˜å‡ºè¿‡çš„å°ä¼™ä¼´ï¼&lt;/strong>&lt;/p>
&lt;p>æ¬¢è¿å¤§å®¶ä¸‹è½½æ›´æ–°ï¼ &lt;a href="https://github.com/opencontainers/runc/releases/tag/v1.0.0">https://github.com/opencontainers/runc/releases/tag/v1.0.0&lt;/a>&lt;/p>
&lt;hr>
&lt;p>æ¬¢è¿è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://gitee.com/tlrr/awesome/raw/master/2020-9-9/1599632564572-mp-qrcode.png" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Docker/">Docker</category><category domain="https://moelove.info/tags/Container/">Container</category><category domain="https://moelove.info/tags/runc/">runc</category></item><item><title>ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦ä¸€ä¸ªå®¹å™¨é•œåƒçš„åŒ…ç®¡ç†å™¨</title><link>https://moelove.info/2021/06/17/%E4%B8%BA%E4%BB%80%E4%B9%88%E6%88%91%E4%BB%AC%E9%9C%80%E8%A6%81%E4%B8%80%E4%B8%AA%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F%E7%9A%84%E5%8C%85%E7%AE%A1%E7%90%86%E5%99%A8/</link><guid isPermaLink="true">https://moelove.info/2021/06/17/%E4%B8%BA%E4%BB%80%E4%B9%88%E6%88%91%E4%BB%AC%E9%9C%80%E8%A6%81%E4%B8%80%E4%B8%AA%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F%E7%9A%84%E5%8C%85%E7%AE%A1%E7%90%86%E5%99%A8/</guid><pubDate>Thu, 17 Jun 2021 23:55:43 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;h2 id="tldr">TL;DR&lt;/h2>
&lt;ul>
&lt;li>æˆ‘ä»¬éœ€è¦å¯¹ container ä¾›åº”é“¾è¿›è¡Œæ›´å¥½çš„å…ƒæ•°æ®ç®¡ç†ï¼Œä»¥ä¾¿æ›´å¥½åœ°è¿›è¡Œåˆ†æ;&lt;/li>
&lt;li>OCI è§„èŒƒç›®å‰æ²¡æœ‰åŠæ³•æ‰“åŒ…å®¹å™¨é•œåƒå·¥ä»¶æˆ–ä¸€ç»„å®¹å™¨é•œåƒã€‚ä½†ä»–ä»¬ä¼šæ…¢æ…¢åšåˆ°è¿™ä¸€ç‚¹ï¼›&lt;/li>
&lt;li>åŒæ—¶ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªç”¨äºå®¹å™¨é•œåƒçš„åŒ…ç®¡ç†å™¨ï¼›&lt;/li>
&lt;/ul>
&lt;h2 id="ä¸€äº›èƒŒæ™¯">ä¸€äº›èƒŒæ™¯&lt;/h2>
&lt;p>æˆ‘ç»´æŠ¤ç€ä¸€ä¸ªå«åš &lt;a href="https://github.com/vmware/tern" title="Tern">Tern&lt;/a> çš„å¼€æºé¡¹ç›®ï¼Œè¿™ä¸ªé¡¹ç›®æ˜¯ä¸ºå®¹å™¨é•œåƒç”Ÿæˆä¸€ä¸ªè½¯ä»¶ææ–™æ¸…å•ï¼ˆSBOMï¼‰ã€‚å¾ˆå¤šå®‰è£…åœ¨å®¹å™¨é•œåƒä¸­çš„ç»„ä»¶éƒ½æ˜¯ç‹¬ç«‹å®‰è£…çš„ï¼Œè€Œéé€šè¿‡åŒ…ç®¡ç†å™¨ã€‚è¿™ä½¿å¾—æˆ‘ä»¬å¾ˆéš¾å¼„æ¸…æ¥šåˆ›å»ºè¿™ä¸ªå®¹å™¨é•œåƒçš„ä½œè€…çš„æ„å›¾ã€‚å®ƒä¹Ÿæ²¡æœ‰æä¾›æ›´å¤šå…³äºå®¹å™¨é•œåƒè´¡çŒ®è€…çš„ä¿¡æ¯ã€‚å¤§å¤šæ•°å®¹å™¨é•œåƒéƒ½æ˜¯åŸºäºä¹‹å‰å·²æœ‰çš„å®¹å™¨é•œåƒï¼Œé€šè¿‡å®¢æˆ·ç«¯å·¥å…·æˆ–è€…é•œåƒä»“åº“éƒ½å¾ˆéš¾çœ‹åˆ°è¿™äº›ä¿¡æ¯ã€‚&lt;/p>
&lt;p>æˆ‘æƒ³å¦‚æœæœ‰ä¸€ä¸ªâ€œå®¹å™¨é•œåƒâ€çš„åŒ…ç®¡ç†å™¨ï¼Œåº”è¯¥èƒ½è§£å†³è¿™ä¸ªé—®é¢˜ã€‚å› æ­¤ï¼Œæˆ‘æ—©åœ¨ &lt;a href="https://youtu.be/WY3s_cG9ia8" title="KubeCon 2018">KubeCon 2018&lt;/a> çš„æ—¶å€™å°±æå‡ºäº† &amp;quot;æ‰“åŒ…&amp;quot; çš„æƒ³æ³•ï¼Œæˆ‘é—®å®¹å™¨é•œåƒçš„ manifest æ˜¯å¦å¯ä»¥ä¿å­˜è¿™äº›ä¿¡æ¯ï¼Œä»¥ä¾¿å·¥å…·å¯ä»¥æ ¹æ®å®¹å™¨é•œåƒçš„ä¾›åº”é“¾æ¥è¿›è¡Œåˆ†æã€‚&lt;/p>
&lt;p>äº‹å®è¯æ˜ï¼Œç¤¾åŒºå·²ç»åœ¨è€ƒè™‘å¦‚ä½•ç®¡ç† helm chartã€OPA ç­–ç•¥ã€æ–‡ä»¶ç³»ç»Ÿå’Œç­¾åç­‰äº‹æƒ…äº†ã€‚è¿™å°±æ˜¯æˆ‘å‚ä¸ &lt;a href="https://opencontainers.org/">å¼€æ”¾å®¹å™¨è®¡åˆ’ï¼ˆOCIï¼‰ç»„ç»‡ &lt;/a> çš„åŸå› ï¼ˆæˆ‘è¿˜æ¬  @vbatts ä¸€ä¸ªä»‹ç»æˆ‘çš„äººæƒ…ï¼‰ã€‚å½“æ—¶çš„ç†è§£æ˜¯ï¼Œå®¹å™¨é•œåƒé™¤äº†éœ€è¦é€šè¿‡æ‘˜è¦æ¥è¿›è¡Œè¯†åˆ«å¤–ï¼Œä¸éœ€è¦è¿›è¡Œå…¶ä»–ç®¡ç†ã€‚ä¹Ÿä¸éœ€è¦ç®¡ç†ä¾èµ–ï¼Œå› ä¸ºæ‰€æœ‰çš„ä¾èµ–éƒ½è¢«æ‰“åŒ…è¿›äº†å®¹å™¨é•œåƒä¸­ã€‚é€šè¿‡å†æ¬¡é‡å»ºå®¹å™¨å’Œä¿æŒä¸€ä¸ªä¸‹æ¸¸æ¶ˆè´¹è€…å¯ä»¥ pull çš„æ»šåŠ¨æ ‡ç­¾æ¥å¤„ç†æ›´æ–°ã€‚&lt;/p>
&lt;p>ç„¶è€Œï¼Œå®¹å™¨ç”Ÿæ€é™¤äº†å¯ç§»æ¤æ€§å¤–ï¼Œå¹¶æ²¡æœ‰æä¾›å¤ªå¤šä¸œè¥¿ã€‚å’Œå®¹å™¨é•œåƒä¸€èµ·ç®¡ç†å®¹å™¨å…ƒæ•°æ®å¯ä»¥ä¸ºä½¿ç”¨è€…å’Œè´¡çŒ®è€…æä¾›æ›´å¤šå…³äºä¾›åº”é“¾çš„å®è´µä¿¡æ¯ã€‚ç»è¿‡äº†ä¸¤å¹´æ—¶é—´å’Œå‡ æ¬¡ä¾›åº”é“¾æ”»å‡»ä¹‹åï¼Œæˆ‘ä»¬ä»ç„¶åœ¨è®¨è®ºï¼Œå¦‚ä½•æœ€å¥½çš„åšåˆ°è¿™ä¸€ç‚¹ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘è¯•å›¾å°†ä¸€äº›æè®®çš„æ¦‚å¿µå½’çº³èµ·æ¥ï¼Œçœ‹çœ‹å®ƒä»¬å¦‚ä½•æ»¡è¶³æˆ‘ä»¬å¯¹å…ƒæ•°æ®ç®¡ç†çš„è¦æ±‚ã€‚&lt;/p>
&lt;h2 id="å›åˆ°èµ·ç‚¹">å›åˆ°èµ·ç‚¹&lt;/h2>
&lt;p>æˆ‘ä»¬å†™ä¸€ä¸ªåŒ…ç®¡ç†å™¨ä¸»è¦æœ‰ä»¥ä¸‹ä¸‰ä¸ªåŸå› ï¼š&lt;/p>
&lt;ol>
&lt;li>æ ‡è¯† - ä¸ºä½ çš„æ–°æ–‡ä»¶æˆ–è€…åŒ…æä¾›ä¸€ä¸ªåå­—å’Œå…¶ä»–å”¯ä¸€å¯è¯†åˆ«çš„ç‰¹å¾ï¼›&lt;/li>
&lt;li>ä¸Šä¸‹æ–‡ - äº†è§£ä½ çš„åŒ…å’Œå…¶ä»–åŒ…çš„å…³ç³»ï¼ˆå³ï¼Œä¾èµ–æ€§ç®¡ç†ï¼‰ï¼›&lt;/li>
&lt;li>æ–°é²œåº¦ - ç¡®ä¿ä½ çš„åŒ…åœ¨å…¶ç”Ÿæ€ç³»ç»Ÿä¸­å¯ç»´æŠ¤å¹¶ä¿æŒæ›´æ–°ï¼›&lt;/li>
&lt;/ol>
&lt;p>å®é™…ä¸Šè¿˜æœ‰ç¬¬4ä¸ªåŸå› ï¼Œâ€œæ„å»ºçš„å¯é‡å¤æ€§â€ - æˆ‘è®¤ä¸ºå®ƒå±äºâ€œä¸Šä¸‹æ–‡â€ï¼Œä½†åœ¨è¿™é‡Œï¼Œå®ƒç¡®å®å€¼å¾—ä¸€æï¼Œå› ä¸ºäº†è§£ä½ çš„åŒ…åœ¨ç‰¹å®šæ—¶é—´çš„çŠ¶æ€æ˜¯å¾ˆå¿…è¦çš„ã€‚è¿™æ ·ä½ æ‰èƒ½åˆ†æå‡ºè¿‡å»çš„â€œå¥½â€çŠ¶æ€ï¼Œå’Œç°åœ¨â€œä¸é‚£ä¹ˆå¥½â€çš„çŠ¶æ€ï¼Œå³ï¼šä½¿ç”¨äºŒç­‰åˆ†çš„æ–¹æ³•åˆ†ææ„å»ºã€‚&lt;/p>
&lt;p>ç”±äºä¸€äº›ï¼ˆå–„æ„çš„ï¼‰å‡è®¾ï¼Œå®¹å™¨é•œåƒç”Ÿæ€å¹¶æ²¡æœ‰è¿™äº›åŠŸèƒ½ã€‚ä¸€ä¸ªå®¹å™¨å¯ä»¥é€šè¿‡å®ƒçš„æ‘˜è¦ï¼ˆdigestï¼‰è¢«æ ‡è¯†ã€‚ä½ ä¸éœ€è¦ç®¡ç†ç”Ÿæ€ï¼Œå› ä¸ºæ•´ä¸ªç”Ÿæ€å·²ç»å­˜åœ¨äºä¸€ä¸ªå•å…ƒä¸­äº†ã€‚ä½ ä¸éœ€è¦æ›´æ–°å®¹å™¨ - åªéœ€è¦æ„å»ºä¸€ä¸ªæ–°çš„é•œåƒï¼Œæ‰€æœ‰éœ€è¦æ›´æ–°çš„å†…å®¹éƒ½å°†è¢«æ›´æ–°ã€‚åªè¦ä½ çš„åº”ç”¨ç¨‹åºæ²¡é—®é¢˜ï¼Œé‚£å®ƒä¾¿å¯ä»¥æ­£å¸¸å·¥ä½œã€‚ç„¶è€Œï¼Œå¦‚æœä½ æ‰“ç®—é•¿æœŸç»´æŠ¤ä½ çš„åº”ç”¨ç¨‹åºï¼Œä½ å¿…é¡»å‡†å¤‡å¥½å¤„ç†å †æ ˆæ›´æ–°å’Œé‡å¤§ç‰ˆæœ¬ã€‚æˆ‘ä»¬å½“å‰é™¤äº†â€œä¸‹è½½æœ€æ–°ç‰ˆæœ¬â€å¤–æ²¡æœ‰å…¶ä»–å¥½çš„åŠæ³•æ¥ç®¡ç†å †æ ˆæ›´æ–°ï¼ˆä¸€ä¸ªå€¼å¾—æ³¨æ„çš„ä¾‹å¤–æ˜¯ Cloud Native Buildpacks ï¼Œä½†æˆ‘ä»¬æ­¤å¤„å°†ä¸“æ³¨äºé€šç”¨æ¡ˆä¾‹ï¼‰ã€‚å †æ ˆçš„ç ´åæ€§å˜æ›´å¯èƒ½ä¼šé˜»å¡ä½ é‡æ–°æ„å»ºé•œåƒï¼Œè¿™è¿«ä½¿ä½ éœ€è¦ä¿ç•™ä¸€ä¸ªæ—§ç‰ˆæœ¬çš„é•œåƒï¼Œå› ä¸ºä½ å·²ç»çŸ¥é“è¿™ä¸ªé•œåƒå¯ä»¥å·¥ä½œã€‚ä½ å¯ä»¥æƒ³è±¡åˆ°ï¼Œç»´æŠ¤ä¸€ç»„å®¹å™¨é•œåƒå°†å˜å¾—æ›´åŠ è´¹åŠ›ã€‚å¦‚æœç»´æŠ¤ä¸€ç»„å®¹å™¨é•œåƒæ‰€éœ€çš„ä¿¡æ¯æ˜¯å†…ç½®çš„ï¼Œå¹¶åœ¨éœ€è¦æ—¶å¯ç”¨ï¼Œé‚£å°±çœŸçš„å¤ªå¥½äº†ã€‚&lt;/p>
&lt;h2 id="ç”¨äºç®¡ç†å…ƒæ•°æ®çš„é•œåƒä»“åº“">ç”¨äºç®¡ç†å…ƒæ•°æ®çš„é•œåƒä»“åº“&lt;/h2>
&lt;p>æˆ‘ä»¬å¯ä»¥å»ºç«‹ä¸€ä¸ªå•ç‹¬çš„å…ƒæ•°æ®å­˜å‚¨è§£å†³æ–¹æ¡ˆï¼Œä½†ç°åœ¨æˆ‘ä»¬å·²ç»æœ‰é•œåƒä»“åº“äº†ã€‚é€šè¿‡ä¸€äº›æ”¹è¿›ï¼Œå®ƒä»¬å¯ä»¥è¢«ç”¨æ¥å’Œå®¹å™¨é•œåƒä¸€èµ·å­˜å‚¨è¡¥å……å…ƒæ•°æ®ã€‚ç»„ç»‡å·²ç»å¯¹åŒ…å«æº tarball çš„æºé•œåƒå’Œç­¾å payloadï¼ˆæ­£å¦‚ cosign æ‰€åšçš„é‚£æ ·ï¼‰ æ‰§è¡Œæ­¤æ“ä½œã€‚&lt;/p>
&lt;p>ä½¿ç”¨é•œåƒä»“åº“çš„å¥½å¤„åœ¨äºå…ƒæ•°æ®å¯ä»¥å’Œç›®æ ‡é•œåƒä¸€èµ·å­˜å‚¨ã€‚å¯¹ OCI è§„èŒƒçš„å»ºè®®ä¸»è¦æ¶‰åŠç»“æ„åŒ–å’Œå¼•ç”¨è¿™äº›æ•°æ®ã€‚è¿™åŸºæœ¬ä¸Šæ˜¯æœåŠ¡ç«¯çš„åŒ…ç®¡ç†ï¼Œè®©è¿™äº›å»ºè®®è¢«åˆå¹¶æ˜¯å¾ˆå›°éš¾çš„ï¼Œå› ä¸ºç›®å‰å­˜åœ¨çš„å®¢æˆ·ç«¯-æœåŠ¡ç«¯å…³ç³»æ˜¯å¾ˆç´§å¯†çš„ï¼Œå¯¹æœåŠ¡ç«¯çš„ä»»ä½•æ”¹å˜éƒ½ä¼šå½±å“åˆ°å®¢æˆ·ç«¯ï¼Œå¯¹å®¢æˆ·ç«¯æ‰“åŒ…æœºåˆ¶çš„ä»»ä½•å˜æ›´ä¹Ÿéƒ½ä¼šå½±å“åˆ°æœåŠ¡ç«¯ã€‚å› æ­¤ï¼Œç›®å‰çš„ OCI è§„èŒƒé™¤äº†æ‰©å±•ä¸å½“å‰ Docker å®¢æˆ·ç«¯å’Œ Docker registry å·¥ä½œæ–¹å¼ä¿æŒåŒæ­¥çš„è§„èŒƒå¤–ï¼Œè¿˜ä¸èƒ½åŒ…æ‹¬å¢å¼ºåŠŸèƒ½ã€‚&lt;/p>
&lt;p>è¿™ç¯‡æ–‡ç« å¹¶ä¸æ˜¯è¦æ‰¹è¯„å½“å‰çš„ç”Ÿæ€ï¼Œè€Œæ˜¯æƒ³è¦æŠŠå¯¹è¯å¼•åˆ°ä¸€ä¸ªç¤¾åŒºå¯ä»¥æ›´å¯æŒç»­çš„ç»´æŠ¤å®ƒä»¬çš„å®¹å™¨é•œåƒçš„ä½ç½®ã€‚å°±æˆ‘ä¸ªäººè€Œè¨€ï¼Œæˆ‘ä¹Ÿæƒ³è¯æ˜åœ¨å®¹å™¨é•œåƒé¢†åŸŸæ˜¯éœ€è¦ä¸€ä¸ªåŒ…ç®¡ç†å™¨çš„ï¼Œå°½ç®¡é•œåƒä»“åº“å¯ä»¥æ”¯æŒç›¸å…³ artifacts å’Œå®¹å™¨é•œåƒçš„é“¾æ¥ï¼Œä¹Ÿå¯ä»¥æ”¯æŒåœ¨å®¹å™¨é•œåƒä¹‹é—´è¿›è¡Œé“¾æ¥ã€‚&lt;/p>
&lt;p>å…¶ä»–ç”Ÿæ€ç³»ç»Ÿä¸­çš„åŒ…ç®¡ç†å™¨ä¹Ÿæœ‰å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„å…³ç³»ï¼Œæ‰€ä»¥åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¹‹é—´åˆ†æ‘Šå‹åŠ›çš„æ¶æ„å¹¶ä¸æ–°é²œã€‚åªä¸è¿‡åœ¨å½“å‰åœºæ™¯ä¸‹ï¼Œè¿™ç§å…³ç³»ç•¥æœ‰ä¸åŒã€‚&lt;/p>
&lt;h2 id="identification-è¯†åˆ«">Identification ï¼ˆè¯†åˆ«ï¼‰&lt;/h2>
&lt;p>å®¹å™¨é•œåƒçš„å·¥ä½œæ–¹å¼æœ‰ç‚¹åƒ &lt;a href="https://en.wikipedia.org/wiki/Merkle_tree" title="Merkle Tree">Merkle Tree&lt;/a> æœ‰ä¸€ä¸ª&lt;a href="https://github.com/opencontainers/image-spec/blob/master/config.md">é•œåƒé…ç½®&lt;/a>çš„æ•°æ®å—ï¼Œä»¥åŠä»£è¡¨å®¹å™¨æ–‡ä»¶ç³»ç»Ÿçš„ä¸€ä¸ªæˆ–å¤šä¸ªæ•°æ®å—ã€‚æ¯ä¸ªæ•°æ®å—éƒ½ç»è¿‡äº†å“ˆå¸Œå¤„ç†ï¼Œå¹¶ä¸”æ”¾åœ¨äº†ç»è¿‡å“ˆå¸Œå¤„ç†è¿‡çš„ &lt;a href="https://github.com/opencontainers/image-spec/blob/master/manifest.md">Image Manifest&lt;/a> ä¸­ã€‚&lt;/p>
&lt;p>&lt;img src="https://i.loli.net/2021/06/19/41Hgwj56GamYzC3.png" alt="img">&lt;/p>
&lt;p>ç°åœ¨å¯ä»¥å¾ˆå¥½çš„ä¸“é—¨è¯†åˆ«è¿™ä¸ªåŒ…ï¼Œä½†å®ƒç¼ºå°‘å…¶ä»–å¯è¯†åˆ«çš„ç‰¹å¾ï¼Œæœ€æ˜æ˜¾çš„æ˜¯åç§°å’Œç‰ˆæœ¬ã€‚åœ¨å®¹å™¨ä¸–ç•Œé‡Œï¼Œåå­—é€šå¸¸æ˜¯ä¸€ä¸ªé•œåƒä»“åº“çš„åç§°ï¼Œè€Œç‰ˆæœ¬åˆ™é€šå¸¸æ˜¯ä¸€ä¸ª tag ã€‚&lt;/p>
&lt;p>&lt;img src="https://i.loli.net/2021/06/19/zPdF2feEk3HJXiu.png" alt="img">&lt;/p>
&lt;p>å°±åƒ Git ä¸€æ ·ï¼Œæ‰€æœ‰å¯¹æ–‡ä»¶é›†çš„å¼•ç”¨éƒ½æ˜¯å“ˆå¸Œå€¼ï¼Œå…¶ä»–å¼•ç”¨å¯ä»¥æŒ‡å‘å®ƒä»¬ï¼Œä¾‹å¦‚ &lt;code>HEAD&lt;/code>ï¼Œ&lt;code>FETCH_HEAD&lt;/code> æˆ– tagã€‚tag å¯ä»¥éµå¾ªè¯­ä¹‰ç‰ˆæœ¬æ§åˆ¶ï¼Œå¯ä»¥è¢«ç§»åˆ°å¦ä¸€ä¸ªæäº¤ä¸­ã€‚åœ¨å¼€æºçš„ä¸–ç•Œé‡Œæ²¡æœ‰äººè¿™æ ·åšï¼Œå› ä¸ºè¿™ä¼šç ´åé¡¹ç›®ç»´æŠ¤è€…å’Œç¤¾åŒºå…¶ä»–æˆå‘˜é—´çš„å›ºæœ‰å¥‘çº¦ã€‚å®¹å™¨é•œåƒçš„ tag å¹¶æ²¡æœ‰éœ€è¦éµå¾ªè¯­ä¹‰ç‰ˆæœ¬æ§åˆ¶çš„è§„åˆ™ï¼Œä½†å¾ˆå¤šè¯­è¨€åŒ…ç®¡ç†å™¨éƒ½ä¾èµ–å®ƒï¼Œå› æ­¤ä½¿ç”¨è¯­ä¹‰åŒ–ç‰ˆæœ¬æ§åˆ¶å®¹å™¨é•œåƒæ˜¯æœ‰ä¸€å®šçš„å¸Œæœ›çš„ã€‚&lt;/p>
&lt;p>æ— è®ºå¦‚ä½•ï¼Œå“ˆå¸Œå€¼å¯¹å®¹å™¨é•œåƒè€Œè¨€æ˜¯ç›¸å½“å¥½çš„ä¸€ä¸ªæ ‡è¯†ç¬¦ã€‚&lt;/p>
&lt;p>é‚£ä¹ˆå…¶ä»–å¯è¯†åˆ«çš„ç‰¹å¾å‘¢ï¼Ÿä»¥ä¸‹æ˜¯ä¸€äº›å…¶ä»–åŒ…ç®¡ç†å™¨ä½¿ç”¨çš„ç‰¹å¾ï¼š&lt;/p>
&lt;ul>
&lt;li>è®¸å¯è¯å’Œç‰ˆæƒä¿¡æ¯&lt;/li>
&lt;li>ä½œè€…/ä¾›åº”å•†&lt;/li>
&lt;li>å‘å¸ƒæ—¥æœŸ&lt;/li>
&lt;li>æŒ‡å‘æºä»£ç çš„é“¾æ¥&lt;/li>
&lt;li>ç¬¬ä¸‰æ–¹ç»„ä»¶çš„åˆ—è¡¨ï¼ˆä½¿ç”¨çš„æ“ä½œç³»ç»Ÿï¼Œéœ€è¦é¢„å®‰è£…çš„åŒ…ç­‰ï¼‰&lt;/li>
&lt;/ul>
&lt;p>æœ€åä¸€é¡¹å¯èƒ½ä¼šå˜å¾—ç›¸å½“é•¿ï¼Œå› ä¸ºåˆ›å»ºä¸€ä¸ªå®¹å™¨é•œåƒå®é™…éœ€è¦çš„ç¬¬ä¸‰æ–¹ç»„ä»¶å¯èƒ½è¾¾åˆ°æ•°ç™¾ä¸ªã€‚æœ€è¿‘æˆ‘ä¸€ç›´ä¸»å¼ å°†è¿™äº›ä¿¡æ¯è·Ÿéšå®¹å™¨é•œåƒæ”¾å…¥ä¸€ä¸ª SBOMï¼ˆè½¯ä»¶ææ–™æ¸…å•ï¼‰ä¸­ï¼Œå®¹å™¨é•œåƒç­¾åæ˜¯å¦ä¸€ä¸ªå¯ä»¥å’Œå®¹å™¨é•œåƒä¸€èµ·ä¼ æ’­çš„å·¥ä»¶ï¼Œä¾‹å¦‚é•œåƒæ¸…å•çš„åˆ†ç¦»å¼å‰é¢ï¼Œæˆ–è€…ä¸€ä¸ªç­¾åè·è½½ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬ç°åœ¨æœ‰å¤šä¸ªå®¹å™¨é•œåƒçš„è¯†åˆ«å·¥ä»¶ï¼Œæˆ‘ä»¬å¸Œæœ›å°†å®ƒä»¬ä¸å®¹å™¨é•œåƒè”ç³»èµ·æ¥ã€‚å½“å‰çš„ OCI å»ºè®®ä½¿ç”¨ &lt;em>references&lt;/em> (å¼•ç”¨)ï¼Œä¸€ä¸ªå¼•ç”¨æ˜¯åŒ…å«äº† blob å“ˆå¸Œå’Œå…¶å¼•ç”¨æ¸…å•çš„å“ˆå¸Œç»„æˆçš„æ¸…å•ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œå¼•ç”¨æ˜¯å›¾åƒæ¸…å•çš„å“ˆå¸Œå€¼ã€‚&lt;/p>
&lt;p>&lt;img src="https://i.loli.net/2021/06/21/FMaW6LcVEhb84xi.png" alt="img">&lt;/p>
&lt;p>è¿™ç§å¸ƒå±€è¿˜å­˜åœ¨ä¸€äº›é—®é¢˜ï¼š&lt;/p>
&lt;ol>
&lt;li>registry å¯èƒ½åªè¯†åˆ«è¢«æ ‡è®°çš„å·¥ä»¶ï¼Œå› æ­¤ä¼šåˆ é™¤ä»»ä½•æ²¡æœ‰è¢«æ ‡è®°çš„ä¸œè¥¿ï¼›&lt;/li>
&lt;li>åˆ é™¤é•œåƒä¼šå¯¼è‡´ç©ºå¼•ç”¨ï¼›&lt;/li>
&lt;/ol>
&lt;p>ä¸€ä¸ªå¿«é€Ÿçš„è§£å†³æ–¹æ¡ˆå¯èƒ½æ˜¯æ ‡è®°æ‰€æœ‰çš„æ¸…å•ã€‚&lt;/p>
&lt;p>&lt;img src="https://i.loli.net/2021/06/21/4d61DjGVgEasOcw.png" alt="img">&lt;/p>
&lt;p>è¿™æ„å‘³ç€éœ€è¦æœ‰ä¸œè¥¿èƒ½å¤Ÿè·Ÿè¸ªæ ‡ç­¾å’Œå®ƒä»¬ä¹‹é—´çš„å…³ç³»ï¼ŒåŒæ—¶è·Ÿè¸ªæ‰€æœ‰å·¥ä»¶çš„ç‰ˆæœ¬ã€‚&lt;/p>
&lt;p>ä¸€ä¸ªé•¿æœŸçš„è§£å†³æ–¹æ¡ˆå¯èƒ½æ˜¯å®šä¹‰ä¸€ä¸ªè§„èŒƒçš„å·¥ä»¶æ¸…å•ï¼Œregistry å°†è¯†åˆ«å¹¶å°†å…¶è§†ä¸ºç‰¹æ®Šçš„å­˜åœ¨ã€‚å¦‚æœæ˜¯è¿™æ ·çš„è¯ï¼Œé‚£å°±éœ€è¦è®¡ç®—æˆ–è€…è·Ÿè¸ªä¸æ¯ä¸ªæ¸…å•å…³è”çš„å¼•ç”¨æ•°é‡äº†ã€‚&lt;/p>
&lt;p>&lt;img src="https://i.loli.net/2021/06/21/vS1MjlQ4GhEC9OA.png" alt="img">&lt;/p>
&lt;p>registry å®ç°è€…å¯ä»¥æŒ‰ç…§ä»–ä»¬æƒ³è¦çš„ä»»ä½•æ–¹å¼æ¥è·Ÿè¸ªå›¾ä¸­çš„é“¾æ¥ã€‚ä¾‹å¦‚ï¼Œåœ¨è¿™ä¸ªå›¾ä¸­ï¼Œå¯¹æ¯ä¸ªæ¸…å•çš„å¼•ç”¨æ•°é‡éƒ½ä¼šè¢«è·Ÿè¸ªï¼ˆå‡å»å“ˆå¸Œï¼‰ï¼Œä½†é•œåƒæ¸…å•è¢«åˆ é™¤æ—¶ï¼Œæ“ä½œå°†ä¼šæ²¿ç€æ ‘å‘ä¸‹èµ°åˆ°æ¯ä¸ªå¼•ç”¨çš„æœ«ç«¯ï¼Œå¹¶æŒ‰ç…§ä¸€å®šçš„é¡ºåºå»åˆ é™¤å®ƒä»¬ï¼Œç›´åˆ°å¼•ç”¨æ•°ä¸º 0ã€‚&lt;/p>
&lt;p>&lt;img src="https://i.loli.net/2021/06/21/nPazC5dcS6H4prI.png" alt="">&lt;/p>
&lt;p>ä½†åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä¸ºäº†è¿½è¸ªæ‰€æœ‰çš„ç›¸å…³å¯¹è±¡ï¼Œæ­£åœ¨è¿›å…¥ä¸€äº›å¤æ‚çš„è¿½è¸ªç³»ç»Ÿã€‚è¿™æ˜¯åœ¨ registry ç«¯å®Œæˆçš„åŒ…ç®¡ç†ã€‚å¯ä»¥æå‡ºä¸€ä¸ªè®ºç‚¹ï¼Œå®ç°ä¸€ä¸ªä¸­ç«‹çš„åƒåœ¾æ”¶é›†å™¨ï¼Œå®ƒå¯ä»¥è¢« registry æˆ–å®¢æˆ·ç«¯ä½¿ç”¨ï¼Œä½†æˆ‘ä»¬ç°åœ¨è®²çš„æœ‰ç‚¹è¶…å‰äº†ã€‚&lt;/p>
&lt;p>æˆ‘å¸Œæœ›è¿™è¶³ä»¥è¯´æ˜æœ‰å¿…è¦å¯¹å·¥ä»¶çš„é›†åˆè¿›è¡Œè¿½è¸ªï¼Œæ— è®ºæ˜¯åœ¨å®¢æˆ·ç«¯è¿˜æ˜¯æœåŠ¡ç«¯ï¼Œæˆ–æ˜¯ä¸¤è€…éƒ½æœ‰ã€‚&lt;/p>
&lt;h2 id="context">Context&lt;/h2>
&lt;p>æ®äº†è§£ï¼Œä¸€ä¸ªå®¹å™¨åœ¨è¿è¡Œæ—¶æ²¡æœ‰å¤–éƒ¨ä¾èµ–æ€§ã€‚ä½†æ˜¯åœ¨æ„å»ºæ—¶ï¼Œæœ€ç»ˆçš„å®¹å™¨é•œåƒç¡®å®å–å†³äºåˆå§‹å®¹å™¨é•œåƒçš„çŠ¶æ€ï¼Œé€šå¸¸æ˜¯ Dockerfile ä¸­çš„ &lt;code>FROM&lt;/code> è¯­å¥æ‰€å®šä¹‰çš„é•œåƒã€‚ç”±äº Merkle Trees çš„é­”åŠ›ï¼Œè¡ç”Ÿçš„é•œåƒä¸ä¹‹å‰çš„é•œåƒä¹‹é—´æ²¡æœ‰ä»»ä½•è”ç³»ã€‚å› æ­¤ï¼Œæ‰€æœ‰å¯¹æ—§é•œåƒçš„å¼•ç”¨éƒ½éœ€è¦ä¸ºæ–°é•œåƒåˆ›å»ºä¸€æ¬¡ï¼ŒåŒæ—¶éœ€è¦æ·»åŠ ä¸€äº›é¢å¤–çš„å·¥ä»¶ã€‚&lt;/p>
&lt;p>&lt;img src="https://i.loli.net/2021/06/21/TPSYrqUw64eaxnW.png" alt="img">&lt;/p>
&lt;p>ä¸æ™®é€šçš„å¼•ç”¨æœºåˆ¶ç›¸æ¯”ï¼Œå·¥ä»¶æ¸…å•æœºåˆ¶å¯èƒ½æœ‰ä¸€ä¸ªä¼˜åŠ¿ï¼Œå› ä¸ºåœ¨å·¥ä»¶å…ƒæ•°æ®è¢«æ›´æ–°çš„åŒæ—¶ï¼Œå¼•ç”¨çš„æ•°é‡è¢«ä¿æŒåœ¨æœ€ä½æ°´å¹³ã€‚&lt;/p>
&lt;p>&lt;img src="https://i.loli.net/2021/06/21/cTY7PR5A4ohjNUw.png" alt="img">&lt;/p>
&lt;p>è¿™ä¸¤ç§æœºåˆ¶éƒ½æ”¯æŒä¾›åº”é“¾å®‰å…¨ï¼Œç›‘ç®¡é“¾å’Œç³»è°±æ£€æŸ¥ç­‰è¦æ±‚ã€‚è¿™ä¸¤ç§æœºåˆ¶éƒ½éœ€è¦&lt;strong>å¼•ç”¨ç®¡ç†&lt;/strong> ã€‚ åœ¨å‰è€…ä¸­ï¼Œå®¢æˆ·ç«¯å°†ä¼šæ‹·è´åŸå§‹é•œåƒçš„ SBOM å’Œç­¾åæ¸…å•ï¼Œæ›´æ–°å®ƒçš„å¼•ç”¨ï¼Œå’Œå¢åŠ æ–°çš„æ¸…å•ã€‚åœ¨åè€…ä¸­ï¼Œå®¢æˆ·ç«¯å¿…é¡»ä¸‹è½½å·¥ä»¶æ¸…å•ï¼Œå¯¹å…¶è¿›è¡Œè¡¥å……ï¼Œå¹¶ä¸æ–°çš„å®¹å™¨é•œåƒä¸€èµ·æ¨é€ã€‚æ— è®ºå“ªç§æ–¹å¼ï¼Œå®¢æˆ·ç«¯éƒ½éœ€è¦ç†è§£ä¸€äº›è¯­æ³•ï¼Œæ— è®ºæ˜¯ tag åç§°ï¼Œå·¥ä»¶ç»“æ„æˆ–è€…å·¥ä»¶ç±»å‹ï¼Œæ›´ä¸ç”¨è¯´å¯¹å·¥ä»¶æ¥è‡ªçš„ç”Ÿæ€ç³»ç»Ÿçš„ä¸€äº›ç†è§£ã€‚ï¼ˆSBOMs å’Œç­¾ååªæ˜¯å…¶ä¸­ä¸¤ç§å¸¸è§çš„å·¥ä½œç±»å‹ï¼Œå¯ä»¥åŒ…æ‹¬åœ¨å†…ï¼‰ã€‚&lt;/p>
&lt;p>æˆ‘ä¸€ç›´åœ¨è€ƒè™‘çš„ä¸€ä¸ªç”¨ä¾‹æ˜¯å¦‚ä½•å°†ä¸€ç³»åˆ—çš„é•œåƒé“¾æ¥åˆ°ä¸€èµ·ï¼Œæ¥æè¿°ä¸€ä¸ªäº‘åŸç”Ÿåº”ç”¨ã€‚ä¾‹å¦‚ï¼Œjaeger åº”ç”¨ç¨‹åºå®é™…ä¸Šæ˜¯æœ‰è‡ªå·±ä¾èµ–å…³ç³»å›¾çš„å®¹å™¨é›†åˆï¼Œ&lt;/p>
&lt;p>å¦‚æœèƒ½ä»¥ä¸€ç§å¯ä»¥ä¸Šä¼ åˆ° registry çš„æ ¼å¼æ¥æè¿°è¿™äº›é“¾æ¥ï¼Œè¿™æ ·æ•´ä¸ªé•œåƒå°±å¯ä»¥å’Œå®ƒçš„è¡¥å……å·¥ä»¶ï¼Œä¸€èµ·åœ¨ registry ä¹‹é—´è¿›è¡Œè½¬ç§»ã€‚&lt;/p>
&lt;p>&lt;img src="https://i.loli.net/2021/06/21/xFzrKSBLMwt8GmN.png" alt="img">&lt;/p>
&lt;p>è¿™æ˜¯å¤„äºæˆ‘æƒ³è±¡åŠ›è¾¹ç¼˜çš„éƒ¨åˆ†ï¼ˆæˆ‘çš„å›¾å¤ªå¤æ‚äº†ï¼‰ï¼Œä½†æˆ‘å¸Œæœ›è¿™äº›ç”¨ä¾‹èƒ½è¯´æ˜ï¼Œå¦‚æœç°åœ¨ä¸éœ€è¦åŒ…ç®¡ç†å™¨ï¼Œé‚£ä¹ˆå¾ˆå¿«å°±éœ€è¦å®ƒæ¥ç®¡ç†è¿™äº›é«˜å±‚æ¬¡çš„å…³ç³»ã€‚&lt;/p>
&lt;h2 id="æ›´æ–°">æ›´æ–°&lt;/h2>
&lt;p>è¿™æ˜¯æˆ‘å¸Œæœ›è¯­ä¹‰ç‰ˆæœ¬æ§åˆ¶èƒ½å¤Ÿå¾—åˆ°æ›´è®¤çœŸå¯¹å¾…çš„ä¸€ä¸ªåœ°æ–¹ã€‚è½¯ä»¶åŒ…ç®¡ç†å™¨ä½¿ç”¨è¯­ä¹‰ç‰ˆæœ¬æ§åˆ¶æ¥å…è®¸ä¸€ç³»åˆ—åœ¨æ•´ä¸ªå †æ ˆä¸­å…¼å®¹çš„ç‰ˆæœ¬ã€‚è¿™ä½¿å¾—ä¸‹æ¸¸æ¶ˆè´¹è€…èƒ½ä»¥æœ€å°çš„å¹²æ‰°æ¥é€‚åº”æ›´æ–°ã€‚ç›®å‰ï¼Œç”±äºå®¹å™¨é•œåƒåªèƒ½é€šè¿‡å…¶æ‘˜è¦è¿›è¡Œè¯†åˆ«ï¼Œtag æ˜¯æ ‡è¯†å®¹å™¨é•œåƒå¤„äºä»€ä¹ˆç‰ˆæœ¬çš„å”¯ä¸€åŠæ³•ï¼Œè¿™å°±æ˜¯åŒ…ç®¡ç†å™¨çœŸæ­£æœ‰ç”¨çš„åœ°æ–¹ã€‚&lt;/p>
&lt;p>é€šå¸¸æƒ…å†µä¸‹ï¼Œå®¢æˆ·ç«¯æŸ¥è¯¢æœåŠ¡å™¨ï¼Œçœ‹çœ‹å®ƒä»¬åº”ç”¨ç¨‹åºæ‰€éœ€çš„ä»»ä½•åŒ…æ˜¯å¦æœ‰æ›´æ–°ã€‚ç„¶åå®¢æˆ·ç«¯å‘Šè¯‰ç”¨æˆ·å®ƒä»¬æƒ³ä¸‹è½½çš„æ›´æ–°æ˜¯å¯ç”¨çš„ï¼Œå¦‚æœç”¨æˆ·æœ‰ä¸€ä¸ªä»–ä»¬çš„åº”ç”¨ç¨‹åºå…¼å®¹çš„ç‰ˆæœ¬èŒƒå›´ï¼Œå®¢æˆ·ç«¯å°±ä¼šåœ¨è¿™ä¸ªèŒƒå›´å†…ä¸‹è½½æ–°ç‰ˆæœ¬ã€‚&lt;/p>
&lt;p>å½“å‰çš„ distribution SPEC æ”¯æŒåˆ—å‡º tags ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œregistry æ²¡æœ‰æä¾›ä»»ä½•ç®¡ç†æ›´æ–°çš„æ–¹å¼ï¼Œä¹Ÿè®¸è¿™å°±æ˜¯ registry ç«¯æ‰€éœ€è¦çš„ä¸€åˆ‡ã€‚è¿™ä¹Ÿæ„å‘³ç€ï¼Œæ£€æŸ¥å’Œæ›´æ–°çš„å·¥ä½œï¼Œä¸»è¦è½åœ¨äº†å®¢æˆ·ç«¯ã€‚&lt;/p>
&lt;h2 id="ä¸‹ä¸€æ­¥">ä¸‹ä¸€æ­¥&lt;/h2>
&lt;p>ç¤¾åŒºä¸€è‡´è®¤ä¸ºï¼Œè¿™äº›æè®®å¯¹äºå½“å‰çš„ SPEC é¡¹ç›®è€Œè¨€ï¼Œè¦æ¥å—çš„è¯æ˜¯è¿‡äºå¤§äº† ã€‚ç„¶è€Œï¼ˆå¸Œæœ›ï¼‰èƒ½æœ‰ä¸€åœºå…¬å¼€çš„å¯¹è¯ï¼Œè¯•å›¾å°†è¿™äº›å˜åŒ–åˆ†è§£ä¸ºå¯å¸çº³çš„éƒ¨åˆ†ï¼Œä»è€Œå…è®¸å‘åå…¼å®¹å½“å‰çš„çŠ¶æ€ï¼Œå¹¶æ¨åŠ¨è§„èŒƒå‘å‰å‘å±•ã€‚&lt;/p>
&lt;p>å¯èƒ½åœ¨å°†æ¥ï¼Œå¹¶ä¸éœ€è¦æœ‰ä¸€ä¸ªåŒ…ç®¡ç†å™¨ï¼Œå› ä¸º registry ï¼Œé•œåƒå’Œ artifacts æ ¼å¼ï¼Œå°†è´Ÿè´£æä¾›æ¨ç†ä¾›åº”é“¾æ‰€éœ€çš„æ‰€æœ‰ä¿¡æ¯ã€‚ä½†é‚£æ˜¯ä¸€ä¸ªé¥è¿œçš„æœªæ¥ï¼Œåœ¨æ­¤æœŸé—´ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªä¸œè¥¿æ¥å¡«è¡¥ç©ºç™½ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªåŒ…ç®¡ç†å™¨ã€‚&lt;/p>
&lt;p>&lt;em>æœ¬æ–‡åŸä½œè€… nishakm åŸæ–‡åœ°å€ï¼šhttps://nishakm.github.io/code/metadata/ ç»æˆæƒç¿»è¯‘&lt;/em>&lt;/p>
&lt;hr>
&lt;p>æ¬¢è¿è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://gitee.com/tlrr/awesome/raw/master/2020-9-9/1599632564572-mp-qrcode.png" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Docker/">Docker</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| Docker v20.10.7 å‘å¸ƒï¼Œä¿®å¤äº†æ­»é”å’Œå®¹å™¨å¯åŠ¨å¤±è´¥çš„é—®é¢˜</title><link>https://moelove.info/2021/06/14/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Docker-v20.10.7-%E5%8F%91%E5%B8%83%E4%BF%AE%E5%A4%8D%E4%BA%86%E6%AD%BB%E9%94%81%E5%92%8C%E5%AE%B9%E5%99%A8%E5%90%AF%E5%8A%A8%E5%A4%B1%E8%B4%A5%E7%9A%84%E9%97%AE%E9%A2%98/</link><guid isPermaLink="true">https://moelove.info/2021/06/14/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Docker-v20.10.7-%E5%8F%91%E5%B8%83%E4%BF%AE%E5%A4%8D%E4%BA%86%E6%AD%BB%E9%94%81%E5%92%8C%E5%AE%B9%E5%99%A8%E5%90%AF%E5%8A%A8%E5%A4%B1%E8%B4%A5%E7%9A%84%E9%97%AE%E9%A2%98/</guid><pubDate>Mon, 14 Jun 2021 00:37:32 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container" title="k8sç”Ÿæ€">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="docker-v20107-æ­£å¼å‘å¸ƒ">Docker v20.10.7 æ­£å¼å‘å¸ƒ&lt;/h2>
&lt;p>Docker åœ¨è¿‘æœŸä¹Ÿå‘å¸ƒäº† v20.10.7 ç‰ˆæœ¬ï¼Œè¿™ä¸ªç‰ˆæœ¬ä¸­ä¸»è¦éƒ½æ˜¯ä¾§é‡åœ¨ç¨³å®šæ€§å’Œå®‰å…¨æ€§ä¸Šï¼Œæˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹å…·ä½“æœ‰å“ªäº›å€¼å¾—å…³æ³¨çš„å†…å®¹å§ï¼&lt;/p>
&lt;h3 id="cli">CLI&lt;/h3>
&lt;p>CLI æ–¹é¢ä¸»è¦æ˜¯ç§»é™¤æ‰äº†ä¸€ç›´ä»¥æ¥å­˜åœ¨çš„ &lt;code>WARNING: No kernel memory limit support&lt;/code> è¿™ä¸ª &lt;em>Warning&lt;/em> ä¿¡æ¯ï¼ŒåŒæ—¶åœ¨ cgroup v2 ä¸‹ä¹Ÿä¸ä¼šå†æ˜¾ç¤º &lt;code>WARNING: No oom kill disable support&lt;/code> çš„ Warning ä¿¡æ¯äº†ã€‚&lt;/p>
&lt;p>ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ&lt;strong>å› ä¸º oom kill disable åœ¨ cgroup v2 ä¸‹ä¸å¯ç”¨&lt;/strong>ã€‚ å¦‚æœä½ åœ¨ cgroup v2 ä¸‹ä½¿ç”¨äº† &lt;code>--oom-kill-disable&lt;/code> é€‰é¡¹å°±ä¼šçœ‹åˆ°å¦‚ä¸‹æç¤ºï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">âœ ~ docker info &lt;span class="p">|&lt;/span>grep Cgroup
Cgroup Driver: systemd
Cgroup Version: &lt;span class="m">2&lt;/span>
âœ ~ docker run --rm -it --oom-kill-disable -m 6m alpine sh
WARNING: Your kernel does not support OomKillDisable. OomKillDisable discarded.
&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™é‡Œå¦‚æœè¦ä»‹ç» cgroup v2 é‚£å†…å®¹å°±å¤ªå¤šäº†ï¼Œ&lt;a href="https://gitchat.csdn.net/columnTopic/5e215c4ee8f01d4213867952">æˆ‘åœ¨ 2019 å¹´æ¥å—è®¿è°ˆèŠå®¹å™¨æŠ€æœ¯è¶‹åŠ¿çš„æ—¶å€™&lt;/a>å°±åšäº†å¦‚ä¸‹é¢„æµ‹ï¼š&lt;/p>
&lt;blockquote>
&lt;p>ä»åº•å±‚æ¬¡æŠ€æœ¯çš„è§’åº¦æ¥çœ‹ï¼Œcgroup v2 å°†é€æ­¥æ™®åŠï¼Œè¿›è€Œå–ä»£ cgroup v1ï¼Œä½†è¿™ä¸ªè¿‡ç¨‹å¯èƒ½éœ€è¦ä¸¤ä¸‰å¹´å·¦å³ã€‚&lt;/p>
&lt;p>æ•´ä½“è€Œè¨€ï¼Œç¨³å®šæ€§å’Œæ€§èƒ½ä¼˜åŒ–å°†ä¼šæ˜¯æœªæ¥çš„ä¸»æ—‹å¾‹ã€‚&lt;/p>
&lt;/blockquote>
&lt;p>ç°åœ¨å·²ç»è¿‡å»äº†ä¸€å¹´å¤šçš„æ—¶é—´ï¼Œ&lt;strong>å®Œå…¨ç¬¦åˆæˆ‘å½“æ—¶çš„é¢„æµ‹ã€‚&lt;/strong> ç°åœ¨åŒ…æ‹¬ runcã€containerdã€Dockerã€Kubernetes ç­‰ç»„ä»¶å·²ç»å…¨éƒ¨éƒ½æ”¯æŒäº† cgroup v2 ï¼ŒåŒ…æ‹¬ Fedora ç­‰æ“ä½œç³»ç»Ÿä¹Ÿå·²å°† cgroup v2 è®¾ç½®æˆäº†ç³»ç»Ÿé»˜è®¤é€‰é¡¹ã€‚å„å…¬å¸ä¹Ÿéƒ½é€æ­¥åœ¨å¾€ cgroup v2 ä¸Šè¿›è¡Œäº†è¿ç§»ã€‚&lt;/p>
&lt;h3 id="networking">Networking&lt;/h3>
&lt;p>åœ¨æ­¤ç‰ˆæœ¬ä¸­ï¼Œä¸»è¦è§£å†³äº†ä¸¤ä¸ªç½‘ç»œç›¸å…³çš„é—®é¢˜ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ä¿®å¤äº†ä¸€ä¸ªå¯èƒ½å¯¼è‡´ Docker DNS æ— æ³•è§£æçš„ deadlock é—®é¢˜ï¼Œ&lt;strong>æ­¤é—®é¢˜ä¸»è¦æ˜¯åœ¨ä½¿ç”¨ Swarm é›†ç¾¤æ—¶æ‰ä¼šé‡åˆ°&lt;/strong> ï¼Œå…¶ä»–ç›´æ¥ä½¿ç”¨ Docker æˆ–è€…å°† Docker ä½œä¸º Kubernetes å®¹å™¨è¿è¡Œæ—¶çš„ç”¨æˆ·ä¸å—å½±å“ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ç”±äºåœ¨ Docker v20.10.6 ç‰ˆæœ¬ä¸­å¤„ç†äº†é’ˆå¯¹æœ‰ IPv6 ç½‘ç»œæœºå™¨ä¸Šå®¹å™¨ç«¯å£æ˜ å°„ API çš„é—®é¢˜ï¼Œè¯¦æƒ…è¯·å‚è€ƒæˆ‘&lt;a href="https://zhuanlan.zhihu.com/p/368003878">ä¹‹å‰çš„ K8S ç”Ÿæ€å‘¨æŠ¥ - Docker v20.10.6 å‘å¸ƒä¸€æ–‡çš„å†…å®¹&lt;/a> ã€‚ä½†æ˜¯è¿™é‡Œæ²¡æœ‰æ­£ç¡®çš„å¤„ç†å½“å†…æ ¸å¸¦æœ‰ &lt;code>ipv6.disable=1&lt;/code> é€‰é¡¹å¯åŠ¨æ—¶çš„é—®é¢˜ï¼Œè¿™ä¼šå¯¼è‡´ &lt;strong>å½“æœåŠ¡å™¨å¯åŠ¨æ—¶å€™ï¼Œå¦‚æœè®¾ç½®äº† ipv6.disable=1 å‚æ•°ä¸”è¿›è¡Œäº†ç«¯å£æ˜ å°„ï¼Œåˆ™å®¹å™¨æ— æ³•æ­£å¸¸å¯åŠ¨&lt;/strong> ã€‚&lt;/p>
&lt;p>è§£å†³åŠæ³•æœ‰ 3 ç§ï¼š&lt;/p>
&lt;ul>
&lt;li>å–æ¶ˆ &lt;code>ipv6.disable=1&lt;/code> é€‰é¡¹çš„è®¾ç½®ï¼ˆä½†é€šå¸¸è¿™ä¹ˆè®¾ç½®äº†åº”è¯¥æ˜¯æœ‰ç‰¹å®šåŸå› çš„ï¼‰ï¼›&lt;/li>
&lt;li>&lt;strong>å‡çº§åˆ° Docker v20.10.7 ç‰ˆæœ¬&lt;/strong>ï¼›&lt;/li>
&lt;li>åœ¨è¿›è¡Œç«¯å£æ˜ å°„çš„æ—¶å€™ï¼Œæ‰‹åŠ¨æŒ‡å®šå…¶ç»‘å®šçš„ IPv4 åœ°å€ï¼Œä¾‹å¦‚ &lt;code>docker run -d -p 0.0.0.0:6379:6379 ghcr.io/moelove/redis:alpine&lt;/code> ï¼›&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="å…¶ä»–">å…¶ä»–&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>é»˜è®¤ä½¿ç”¨ containerd v1.4.6 å’Œ runc v1.0.0-rc95 ä»¥ä¾¿äºè§£å†³ &lt;a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-30465">CVE-2021-30465&lt;/a> æ¼æ´ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>docker scan æ›´æ–°åˆ°äº† v0.8 ï¼›&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">âœ ~ docker scan --version
Version: v0.8.0
Git commit: 35651ca
Provider: Snyk &lt;span class="o">(&lt;/span>1.563.0 &lt;span class="o">(&lt;/span>standalone&lt;span class="o">))&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul>
&lt;p>è¿™ä¸ªç‰ˆæœ¬æˆ‘æ˜¯æ¨èå¤§å®¶è¿›è¡Œæ›´æ–°çš„ï¼Œå°¤å…¶æ˜¯å¦‚æœä½ å—åˆ°äº†æ–‡ä¸­æåˆ°çš„ v20.10.6 ç‰ˆæœ¬ç›¸å…³é—®é¢˜å½±å“çš„è¯ï¼Œé‚£æ›´åŠ å€¼å¾—å‡çº§äº†ã€‚&lt;/p>
&lt;h2 id="docker-desktop-340-å‘å¸ƒ">Docker Desktop 3.4.0 å‘å¸ƒ&lt;/h2>
&lt;p>è¿™ä¸ªç‰ˆæœ¬å¯¹å¤§å¤šæ•°ç”¨æˆ·è€Œè¨€ï¼Œéœ€è¦å…³æ³¨çš„ç‚¹ä¸»è¦æœ‰ä¸¤ä¸ªï¼š&lt;/p>
&lt;ul>
&lt;li>Docker Inc. ç§¯æå¬å–ç¤¾åŒºç”¨æˆ·çš„åé¦ˆï¼Œ&lt;strong>è·³è¿‡æ›´æ–°çš„åŠŸèƒ½ï¼Œä¸å†æ˜¯ä»˜è´¹ç”¨æˆ·ä¸“æœ‰äº†ï¼Œå¯ä»¥æ”¾å¿ƒé€‰æ‹©å‡çº§/è·³è¿‡å‡çº§&lt;/strong> ï¼Œè¿™ä¸ªäº‹æƒ…çš„èƒŒæ™¯å¯ä»¥å‚è€ƒ&lt;a href="https://zhuanlan.zhihu.com/p/371258358">æˆ‘å‰ä¸¤æœŸçš„ K8S ç”Ÿæ€å‘¨æŠ¥&lt;/a> ;&lt;/li>
&lt;li>è¿™ä¸ªç‰ˆæœ¬ä¸­å¯¹ç›¸å…³ç»„ä»¶éƒ½è¿›è¡Œäº†å‡çº§ï¼ŒåŒ…æ‹¬ Docker Engine å‡çº§åˆ°äº† v20.10.7 ï¼ŒKubernetes å‡çº§åˆ°äº† v1.21.1 ç­‰ï¼›&lt;/li>
&lt;/ul>
&lt;h2 id="rook-v165-å‘å¸ƒ">Rook v1.6.5 å‘å¸ƒ&lt;/h2>
&lt;p>è¿™æ˜¯ä¸€ä¸ª patch release ï¼Œå˜åŠ¨ä¸å¤§ï¼Œä½†è¿™ä¸ªç‰ˆæœ¬ä¸­æœ‰ä¸ªå€¼å¾—å…³æ³¨çš„å†…å®¹ï¼š&lt;/p>
&lt;ul>
&lt;li>ç°åœ¨å¯ä»¥é€šè¿‡ Helm chart æ¥é…ç½® CephCluster è¿™ä¸ª CR äº†ï¼›&lt;/li>
&lt;/ul>
&lt;p>ä½ å¯ä»¥ä½¿ç”¨ç±»ä¼¼ä¸‹é¢çš„å‘½ä»¤æ¥è¿›è¡Œé…ç½®ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">helm repo add rook-master https://charts.rook.io/master
helm install --create-namespace --namespace rook-ceph rook-ceph-cluster &lt;span class="se">\
&lt;/span>&lt;span class="se">&lt;/span> --set &lt;span class="nv">operatorNamespace&lt;/span>&lt;span class="o">=&lt;/span>rook-ceph rook-master/rook-ceph-cluster -f values-override.yaml
&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™ç§æ–¹å¼ç›¸æ¯”ä¹‹å‰æ¯æ¬¡éƒ½è¦å†™ä¸ª YAML è¦æ–¹ä¾¿å¤šäº†ï¼Œå¦å¤–å€¼å¾—æ³¨æ„çš„ä¸€ç‚¹æ˜¯ &lt;strong>å½“å‰çš„ Helm chart æ˜¯å®éªŒæ€§çš„ï¼Œé¢„è®¡åœ¨ v1.7 ä¸­è¾¾åˆ° stable&lt;/strong> ã€‚&lt;/p>
&lt;h2 id="thanos-v021-å‘å¸ƒ">Thanos v0.21 å‘å¸ƒ&lt;/h2>
&lt;p>Thanos æ˜¯ä¸€ä¸ªå®Œæ•´çš„ Prometheus HA å’ŒæŒä¹…åŒ–å­˜å‚¨çš„æ–¹æ¡ˆã€‚æˆ‘åœ¨ä¹‹å‰çš„æ–‡ç« ä¸­å·²ç»ä»‹ç»è¿‡å¤šæ¬¡ï¼ˆæœäº†ä¸‹ä» 2019 å¹´ Thanos æˆä¸º CNCF sandbox é¡¹ç›®å¼€å§‹å°±å·²ç»åœ¨æŒç»­ä»‹ç»å®ƒäº†ï¼‰&lt;/p>
&lt;p>æ­¤æ¬¡æ›´æ–°æœ€ä¸»è¦çš„ç‰¹æ€§åªæœ‰ä¸€ä¸ªï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;strong>ä¸º Thanos API å¢åŠ äº† TLS å’Œ basic auth è®¤è¯&lt;/strong> ã€‚&lt;/li>
&lt;/ul>
&lt;p>è¿™å…¶å®ä¹Ÿæ˜¯ä¼—å¤šç›‘æ§é¡¹ç›®çš„ä¸€ä¸ªå‘å±•è¶‹åŠ¿ï¼Œè¿˜è®°å¾—æˆ‘ä¹‹å‰å†™çš„æ–‡ç« ã€Š &lt;a href="https://zhuanlan.zhihu.com/p/144048025">ä¸º Prometheus Node Exporter åŠ ä¸Šè®¤è¯&lt;/a> ã€‹å—ï¼Ÿæ—©æœŸè§£å†³äº†æœ‰æ²¡æœ‰åŠæ™®åŠåº¦çš„é—®é¢˜åï¼Œå°±ä¼šé€æ­¥å°†æ³¨æ„åŠ›å¾€å®‰å…¨æ€§ä¸Šæ”¾äº†ã€‚&lt;/p>
&lt;h2 id="kubernetes-ingress-nginx-v047-å‘å¸ƒ">Kubernetes Ingress-NGINX v0.47 å‘å¸ƒ&lt;/h2>
&lt;p>è¿™ä¸ªç‰ˆæœ¬çš„å‘å¸ƒä¸»è¦æ˜¯ä¸ºäº†è§£å†³ä¸¤ä¸ªé—®é¢˜ï¼š&lt;/p>
&lt;ul>
&lt;li>ä¿®å¤ NGINX v1.20 çš„ CVE æ¼æ´ï¼Œå°†å…¶æ›´æ–°åˆ°äº† v1.20.1 ç‰ˆæœ¬ï¼›&lt;/li>
&lt;li>ä¸ºåç»­ç‰ˆæœ¬åšå‡†å¤‡ã€‚åœ¨åç»­ç‰ˆæœ¬ä¸­ï¼Œæˆ‘ä»¬è®¡åˆ’é€æ­¥æ”¾å¼ƒå¯¹æ—§çš„ Kubernetes ç‰ˆæœ¬çš„æ”¯æŒï¼›&lt;/li>
&lt;/ul>
&lt;p>å…¼å®¹è¯´æ˜å¦‚ä¸‹ï¼š&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align:center">Kubernetes ç‰ˆæœ¬&lt;/th>
&lt;th style="text-align:center">Ingress-NGINX ç‰ˆæœ¬&lt;/th>
&lt;th style="text-align:center">æ”¯æŒè¯´æ˜&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align:center">1.22&lt;/td>
&lt;td style="text-align:center">TBD&lt;/td>
&lt;td style="text-align:center">è¿›è¡Œä¸­&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">1.21&lt;/td>
&lt;td style="text-align:center">v0.47.0&lt;/td>
&lt;td style="text-align:center">ä»…æ”¯æŒ CVE å’Œ crash ä¿®æ­£&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">1.20&lt;/td>
&lt;td style="text-align:center">v0.47.0&lt;/td>
&lt;td style="text-align:center">ä»…æ”¯æŒ CVE å’Œ crash ä¿®æ­£&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">1.19&lt;/td>
&lt;td style="text-align:center">v0.47.0&lt;/td>
&lt;td style="text-align:center">åœ¨ v1.22 å‘å¸ƒå 6 ä¸ªæœˆåºŸå¼ƒ&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>å¦å¤–å€¼å¾—ä¸€æçš„æ˜¯ï¼Œè¿™ä¸ªç‰ˆæœ¬æ˜¯æˆ‘å’Œå¦å¤–ä¸¤ä¸ªç»´æŠ¤è€…ä¸€èµ·å‘å¸ƒçš„ã€‚æˆ‘ä»¬ä¸‰ä¸ªäººè€—è´¹äº†å°†è¿‘ 2 ä¸ªå°æ—¶æ‰å®Œæˆäº†æ­¤æ¬¡ç‰ˆæœ¬çš„å‘å¸ƒï¼Œè·¨æ—¶åŒºåä½œå…¶å®è›®ç´¯çš„ã€‚&lt;/p>
&lt;h2 id="ä¸Šæ¸¸è¿›å±•">ä¸Šæ¸¸è¿›å±•&lt;/h2>
&lt;ul>
&lt;li>
&lt;p>&lt;a href="https://github.com/kubernetes/kubernetes/pull/102489">#102489 Â· kubernetes/kubernetes&lt;/a> &lt;strong>åœ¨æ–°å‘å¸ƒçš„å‡ ä¸ª patch release ä¸­ï¼ŒåŒ…å«äº†ä¸€é¡¹ regressionï¼Œä¼šå¯¼è‡´ kubelet crashï¼Œå»ºè®®å¤§å®¶ä¸è¦å‡çº§ï¼&lt;/strong> æœ€æ–°çš„ä¿®æ­£ç‰ˆæœ¬æœ¬å‘¨å°†ä¼šå‘å¸ƒã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a href="https://github.com/kubernetes/kubernetes/pull/100142">#100142 Â· kubernetes/kubernetes&lt;/a> åœ¨ &lt;code>kubectl get pods&lt;/code> çš„è¾“å‡ºä¸­æ·»åŠ äº† &lt;code>LAST RESTART&lt;/code> åˆ—ï¼Œä¾‹å¦‚ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">$ kubectl get pods -A
NAMESPACE NAME READY STATUS RESTARTS LAST RESTART AGE
kube-system coredns-74ff55c5b-6qp7j 1/1 Running &lt;span class="m">7&lt;/span> 23h 7d3h
kube-system coredns-74ff55c5b-z79st 1/1 Running &lt;span class="m">7&lt;/span> 23h 7d3h
kube-system etcd-jjacobelli-lt 1/1 Running &lt;span class="m">6&lt;/span> 23h 7d3h
kube-system kube-apiserver-jjacobelli-lt 1/1 Running &lt;span class="m">0&lt;/span> &amp;lt;none&amp;gt; 57s
kube-system kube-controller-manager-jjacobelli-lt 0/1 Running &lt;span class="m">8&lt;/span> 61s 7d3h
kube-system kube-flannel-ds-c8d66 1/1 Running &lt;span class="m">7&lt;/span> 8h 7d3h
kube-system kube-proxy-r9nrx 1/1 Running &lt;span class="m">6&lt;/span> 23h 7d3h
kube-system kube-scheduler-jjacobelli-lt 0/1 Running &lt;span class="m">8&lt;/span> 62s 7d3h
&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™æ ·åšçš„å¥½å¤„åœ¨äºï¼Œç”¨æˆ·å¯ä»¥å¾ˆå¿«çš„å‘ç° Pod ä¸Šæ¬¡é‡å¯/æ¢å¤çš„æ—¶é—´ï¼Œè€Œä¸éœ€è¦å»æŸ¥çœ‹æ—¥å¿—ï¼Œæ–¹ä¾¿äº†å¾ˆå¤šã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a href="https://github.com/kubernetes/kubernetes/pull/102529/files">#102529 Â· kubernetes/kubernetes&lt;/a> CronJobControllerV2 è¾¾åˆ° GA ï¼æˆ‘åœ¨ã€Š&lt;a href="https://zhuanlan.zhihu.com/p/364074085">K8S ç”Ÿæ€å‘¨æŠ¥| Kubernetes v1.21 å‘å¸ƒ, å¸¦æ¥æ–°çš„å†…å­˜ç®¡ç†å™¨&lt;/a>ã€‹ä¸­æ›¾ä»‹ç»è¿‡å®ƒï¼Œæ„Ÿå…´è¶£çš„å°ä¼™ä¼´å¯ä»¥çœ‹çœ‹ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä¸€ä¸ªæœ‰è¶£çš„ææ¡ˆ &lt;a href="https://github.com/kubernetes/enhancements/pull/2777">KEP 2775&lt;/a> , è¿™ä¸ªææ¡ˆä¸»è¦ç›®çš„æ˜¯ &lt;strong>ä¸ºäº†ä¿æŠ¤é›†ç¾¤èµ„æºï¼Œä»¥åŠå…å—å…³è”åˆ é™¤çš„å½±å“&lt;/strong> ï¼Œæå‡ºå¸Œæœ›å¢åŠ äº¤äº’å¼åˆ é™¤æˆ–è€…å»¶è¿Ÿåˆ é™¤çš„åŠŸèƒ½ï¼Œæœ‰å…´è¶£çš„å°ä¼™ä¼´å¯ä»¥å»è¿™ä¸ª KEP ä¸‹ç•™è¨€ï¼Œè®¨è®ºï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>GKE Dataplane V2 å·²äºæ—¥å‰ GA ï¼Œ è¯·å‚è€ƒæˆ‘ä¹‹å‰çš„ä¸¤ç¯‡æ–‡ç« äº†è§£å…¶èƒŒæ™¯ ã€Š&lt;a href="https://zhuanlan.zhihu.com/p/195759300">K8S ç”Ÿæ€å‘¨æŠ¥| Google é€‰æ‹© Cilium ä½œä¸º GKE ä¸‹ä¸€ä»£æ•°æ®é¢&lt;/a>ã€‹ å’Œ ã€Š&lt;a href="https://zhuanlan.zhihu.com/p/213745089">è¢« Google é€‰æ‹©çš„ä¸‹ä¸€ä»£æ•°æ®é¢ Cilium æ˜¯ä»€ä¹ˆ&lt;/a>ã€‹ ã€‚ç›®å‰å®ƒ GA ä¹Ÿæ ‡å¿—ç€ Cilium çš„åˆä¸€å¤§å‘å±•ï¼&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Grafana v8.0 æ­£å¼å‘å¸ƒäº†ï¼Œåœ¨è¿™ä¸ªç‰ˆæœ¬ä¸­å¢åŠ äº† AlertManger çš„æ•°æ®æºï¼Œåœ¨å‘Šè­¦æ–¹é¢çš„ä¸€å¤§è¿›æ­¥ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="é¡¹ç›®æ¨è">é¡¹ç›®æ¨è&lt;/h2>
&lt;h3 id="apisix-mesh-agent----å°†-apache-apisix-ç”¨äºæ•°æ®é¢ä¸-istio-ç­‰æ§åˆ¶é¢ç»“åˆä½¿ç”¨çš„-service-mesh-é¡¹ç›®-åˆ©ç›Šç›¸å…³æˆ‘æ˜¯-api7-å›¢é˜Ÿçš„ä¸€å‘˜">apisix-mesh-agent - å°† Apache APISIX ç”¨äºæ•°æ®é¢ï¼Œä¸ Istio ç­‰æ§åˆ¶é¢ç»“åˆä½¿ç”¨çš„ service mesh é¡¹ç›®ã€‚ &lt;em>åˆ©ç›Šç›¸å…³ï¼šæˆ‘æ˜¯ api7 å›¢é˜Ÿçš„ä¸€å‘˜&lt;/em>&lt;/h3>
&lt;p>æ¨èæ­¤é¡¹ç›®ä¸»è¦åŸå› å¦‚ä¸‹ï¼š&lt;/p>
&lt;ul>
&lt;li>Envoy é¡¹ç›®çš„ä¸Šæ‰‹å­¦ä¹ æˆæœ¬è¾ƒå¤§ã€‚ Apache APISIX ç›¸æ¯”ä¹‹ä¸‹æ›´æ˜“ä¸Šæ‰‹å’Œè¿›è¡Œæ‰©å±•ï¼›&lt;/li>
&lt;li>Apache APISIX çš„æ€§èƒ½ç›¸è¾ƒ Envoy æ¥è¯´æ˜¯æå¤§çš„ä¼˜åŠ¿ï¼›&lt;/li>
&lt;/ul>
&lt;p>å¦‚æœä½ æ­£åœ¨ä½¿ç”¨ Istio ä½†è‹¦äº Envoy çš„ä¸Šæ‰‹/äºŒæ¬¡å¼€å‘éš¾åº¦å¤§ï¼Œé‚£ä¹ˆæˆ‘æ¨èä½ å¯ä»¥å»äº†è§£ä¸‹æ­¤é¡¹ç›®ã€‚ä¸è¿‡æ­¤é¡¹ç›®å½“å‰åªå‘å¸ƒäº† v0.6 ç‰ˆæœ¬ï¼Œè¿˜éœ€è¦æŒç»­çš„æ‰“ç£¨ï¼Œæ¬¢è¿å‚ä¸ï¼&lt;/p>
&lt;p>&lt;img src="https://i.loli.net/2021/06/14/7qioUAjnCBl2VLG.png" alt="apisix-mesh-overview">&lt;/p>
&lt;hr>
&lt;p>æ¬¢è¿è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://gitee.com/tlrr/awesome/raw/master/2020-9-9/1599632564572-mp-qrcode.png" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| Cilium v1.10.0 å¸¦æ¥ Egress Gateway ç­‰ç‰¹æ€§</title><link>https://moelove.info/2021/05/24/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Cilium-v1.10.0-%E5%B8%A6%E6%9D%A5-Egress-Gateway-%E7%AD%89%E7%89%B9%E6%80%A7/</link><guid isPermaLink="true">https://moelove.info/2021/05/24/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Cilium-v1.10.0-%E5%B8%A6%E6%9D%A5-Egress-Gateway-%E7%AD%89%E7%89%B9%E6%80%A7/</guid><pubDate>Mon, 24 May 2021 06:48:53 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container" title="k8sç”Ÿæ€">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="kind-v0110-æ­£å¼å‘å¸ƒ">KIND v0.11.0 æ­£å¼å‘å¸ƒ&lt;/h2>
&lt;p>&lt;a href="https://github.com/kubernetes-sigs/kind" title="KIND é¡¹ç›®">KIND (Kubernetes In Docker)&lt;/a> å…³æ³¨æˆ‘çš„å°ä¼™ä¼´æƒ³å¿…å·²ç»éƒ½å¾ˆç†Ÿæ‚‰äº†ï¼Œè¿™æ˜¯æˆ‘ä¸€ç›´éƒ½åœ¨å‚ä¸ä¹Ÿç”¨çš„éå¸¸å¤šçš„ä¸€ä¸ªé¡¹ç›®ï¼Œå®ƒå¯ä»¥å¾ˆæ–¹ä¾¿çš„ä½¿ç”¨ Docker å®¹å™¨ä½œä¸º Kubernetes çš„ Node ï¼Œå¿«é€Ÿçš„å¯åŠ¨ä¸€ä¸ª/æˆ–å¤šä¸ªæµ‹è¯•é›†ç¾¤ã€‚è‡ªä¸Šä¸ªç‰ˆæœ¬å‘å¸ƒä»¥æ¥å·²ç»è¿‡äº† 4 ä¸ªæœˆï¼Œæˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹è¿™ä¸ªç‰ˆæœ¬ä¸­æœ‰å“ªäº›å€¼å¾—æ³¨æ„çš„å˜æ›´å§ï¼&lt;/p>
&lt;h3 id="ç ´åæ€§å˜æ›´">ç ´åæ€§å˜æ›´&lt;/h3>
&lt;ul>
&lt;li>åœ¨è¿™ä¸ªç‰ˆæœ¬ä¸­é»˜è®¤çš„ k8s ç‰ˆæœ¬ä¸º v1.21.1;&lt;/li>
&lt;li>ç§»é™¤æ‰äº†ä½¿ç”¨ &lt;code>bazel&lt;/code> æ„å»ºé•œåƒçš„æ–¹å¼ï¼Œ&lt;code>kind build node-image&lt;/code> çš„ &lt;code>--type&lt;/code> å‚æ•°å·²åºŸå¼ƒï¼›&lt;/li>
&lt;li>&lt;code>kind build node-image&lt;/code> çš„ &lt;code>--kube-root&lt;/code> å‚æ•°å·²åºŸå¼ƒï¼Œå°†ä¼šæŒ‰ç…§æ ‡å‡†æ¨¡å¼å¯»æ‰¾ k8s çš„ä»£ç ç›®å½•çš„ä½ç½®ï¼›&lt;/li>
&lt;/ul>
&lt;h3 id="æ–°ç‰¹æ€§">æ–°ç‰¹æ€§&lt;/h3>
&lt;ul>
&lt;li>&lt;code>kind build node-image&lt;/code> æ–°å¢äº†ä¸€ä¸ª &lt;code>--arch&lt;/code> çš„å‚æ•°ï¼Œå¯æ”¯æŒæ„å»ºå¤šæ¶æ„çš„é•œåƒäº†ï¼›&lt;/li>
&lt;li>KIND å½“å‰å‘å¸ƒçš„é¢„æ„å»ºé•œåƒï¼Œå·²ç»éƒ½æ˜¯ multi-arch çš„äº†ï¼Œå¯è¿è¡Œåœ¨ amd64 å’Œ arm64 æ¶æ„ä¸Šï¼›&lt;/li>
&lt;li>å½“å‰ KIND å·²ç»å¯ä»¥è¿è¡Œåœ¨ rootless æ¨¡å¼ä¸‹çš„ Docker å’Œ rootless æ¨¡å¼ä¸‹çš„ Podman ä¸­äº†ï¼Œè¯¦ç»†æŒ‡å—è¯·å‚è€ƒ &lt;a href="https://kind.sigs.k8s.io/docs/user/rootless/" title="KIND with rootless">KIND è¿è¡Œåœ¨ rootless æ¨¡å¼&lt;/a> ;&lt;/li>
&lt;li>&lt;strong>KIND é»˜è®¤çš„ CNI kindnetd å·²ç»æ”¯æŒäº†åŒæ ˆç½‘ç»œ, å¹¶åœ¨ v1.21 ç‰ˆæœ¬çš„ k8s ä¸­é»˜è®¤å¯ç”¨&lt;/strong> ;&lt;/li>
&lt;/ul>
&lt;p>ä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹ä»»æ„æ–¹å¼å®‰è£…æœ€æ–°ç‰ˆçš„ KIND ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;code>GO111MODULE=&amp;quot;on&amp;quot; go get sigs.k8s.io/kind@v0.11.0&lt;/code>;&lt;/li>
&lt;li>&lt;code>wget -O kind https://kind.sigs.k8s.io/dl/v0.11.0/kind-linux-amd64&lt;/code>;&lt;/li>
&lt;li>clone &lt;a href="https://github.com/kubernetes-sigs/kind">KIND çš„ä»£ç ä»“åº“&lt;/a>åï¼Œæ‰§è¡Œ &lt;code>make build&lt;/code> ;&lt;/li>
&lt;/ul>
&lt;p>æ›´å¤šå…³äº KIND çš„ä½¿ç”¨åŠè¯´æ˜è¯·å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼šhttps://kind.sigs.k8s.io/ æ¬¢è¿ä¸‹è½½ä½¿ç”¨ã€‚&lt;/p>
&lt;h2 id="apisix-ingress-controller-v060-å‘å¸ƒ">apisix-ingress-controller v0.6.0 å‘å¸ƒ&lt;/h2>
&lt;p>&lt;a href="https://github.com/apache/apisix-ingress-controller/" title="Apache APISIX Ingress controller">Apache APISIX Ingress controller&lt;/a> æ˜¯ Apache APISIX çš„æ§åˆ¶é¢ç»„ä»¶ï¼Œå¯ä»¥å°†å…¶è‡ªå®šä¹‰èµ„æºï¼ˆCRï¼‰åŠ Kubernetes ä¸­åŸç”Ÿçš„ Ingress èµ„æºå‘å¸ƒè‡³ APISIX ä¸­ï¼Œè¿›è€Œåˆ©ç”¨ APISIX ä½œä¸ºå…¥å£ç½‘å…³ç®¡ç†å—åŒ—å‘çš„æµé‡ã€‚ æˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹æœ¬æ¬¡å‘å¸ƒçš„ v0.6.0 ç‰ˆæœ¬ä¸­å¸¦æ¥äº†å“ªäº›å€¼å¾—æ³¨æ„çš„å˜æ›´å§ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://github.com/apache/apisix-ingress-controller/issues/115">#115&lt;/a> æ”¯æŒäº† TCP ä»£ç†ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/apache/apisix-ingress-controller/issues/242">#242&lt;/a> ä¸ºå·²ç»è¢« ingress controller æ¨é€çš„èµ„æºå¢åŠ äº† labelï¼›&lt;/li>
&lt;li>ä¸º &lt;code>ApisixUpstream&lt;/code> å’Œ &lt;code>ApisixTls&lt;/code> å¢åŠ äº† jsonschema æ ¡éªŒï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/apache/apisix-ingress-controller/issues/394">#394&lt;/a> è®°å½•äº†èµ„æºå¤„ç†æ—¶çš„ Kubernetes events;&lt;/li>
&lt;li>&lt;a href="https://github.com/apache/apisix-ingress-controller/issues/395">#395&lt;/a> æ”¯æŒä¸ŠæŠ¥èµ„æºçš„ status;&lt;/li>
&lt;li>&lt;a href="https://github.com/apache/apisix-ingress-controller/issues/402">#402&lt;/a> ä¸º cluster çº§åˆ«çš„æ’ä»¶å¢åŠ  global_rules é…ç½®;&lt;/li>
&lt;/ul>
&lt;h2 id="cilium-v1100-æ­£å¼å‘å¸ƒ">Cilium v1.10.0 æ­£å¼å‘å¸ƒ&lt;/h2>
&lt;p>&lt;img src="https://cilium.io/static/c7f92a7f0c898d4ccae30eb23c559bfd/a3ebb/intro.png" alt="Cilium v1.10.0 - https://moelove.info">&lt;/p>
&lt;p>Cilium æˆ‘åœ¨ä¹‹å‰çš„æ–‡ç« ä¸­å·²ç»ä»‹ç»è¿‡å¾ˆå¤šæ¬¡äº†ï¼Œå®ƒåŸºäº eBPF æŠ€æœ¯ï¼Œå¯ä»¥ä¸º Kubernetes ä¸­åº”ç”¨ç¨‹åºæœåŠ¡é—´ç½‘ç»œå’Œ API è¿æ¥æä¾›é€æ˜ä»£ç†å’Œä¿æŠ¤ã€‚ æƒ³å¿«é€Ÿäº†è§£ Cilium å¯ä»¥å‚è€ƒæˆ‘ä¹‹å‰å†™çš„ &lt;a href="https://zhuanlan.zhihu.com/p/213745089">ã€ŠCilium å¿«é€Ÿä¸Šæ‰‹ã€‹&lt;/a> æƒ³å¿«é€Ÿäº†è§£ eBPF ä¹Ÿå¯ä»¥çœ‹çœ‹æˆ‘åœ¨ PyCon China 2020 ä¸Šåšçš„åˆ†äº«ã€‚&lt;/p>
&lt;p>Cilium v1.10 ç‰ˆæœ¬æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¤§çš„ç‰¹æ€§ç‰ˆæœ¬ï¼Œåœ¨è¿™ä¸ªç‰ˆæœ¬ä¸­å¸¦æ¥äº†ä¼—å¤šå€¼å¾—å…³æ³¨çš„ç‰¹æ€§ï¼Œæˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹å§ï¼&lt;/p>
&lt;h3 id="egress-ip-gateway">Egress IP Gateway&lt;/h3>
&lt;p>åœ¨å‡ ä¹æ‰€æœ‰ç½‘ç»œç»„ä»¶éƒ½åœ¨åšå…¥å£ç½‘å…³çš„æ—¶å€™ï¼Œ Cilium å‘ç°å½“æŠŠäº‘åŸç”Ÿåº”ç”¨å’Œä¼ ç»Ÿåº”ç”¨é›†æˆæ—¶ï¼Œä¼ ç»Ÿåº”ç”¨å¤§å¤šé€šè¿‡ IP ç™½åå•çš„æ–¹å¼è¿›è¡Œæˆæƒ, åŠ ä¸Š Pod IP çš„åŠ¨æ€æ€§ï¼Œå¯¹ IP åœ°å€çš„ç®¡ç†å°±æˆä¸ºäº†ä¸€ä¸ªç—›ç‚¹ã€‚&lt;/p>
&lt;p>ç°åœ¨ Cilium æ–°ç‰ˆæœ¬ä¸­ï¼Œé€šè¿‡æ–°çš„ Kubernetes CRD ï¼Œå¯ä»¥åœ¨æ•°æ®åŒ…ç¦»å¼€ Kubernetes é›†ç¾¤æ—¶å°†é™æ€ IP ä¸æµé‡ç›¸å…³è”ï¼Œè¿™ä½¿å¾—å¤–éƒ¨é˜²ç«å¢™ä¼šä½¿ç”¨æ­¤ä¸€è‡´çš„é™æ€ IP å»è¯†åˆ« Pod æµé‡ã€‚&lt;/p>
&lt;p>å…¶å®å°±æ˜¯ Cilium å¸®å¿™åšäº† NAT ï¼Œä½¿ç”¨èµ·æ¥ä¹Ÿå¾ˆç®€å•ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">cilium.io/v2alpha1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">CiliumEgressNATPolicy&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">egress-sample&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">egress&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">podSelector&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">matchLabels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># The following label selects default namespace&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">io.kubernetes.pod.namespace&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">default&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">destinationCIDRs&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="m">192.168.33.13&lt;/span>&lt;span class="l">/32&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">egressSourceIP&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;192.168.33.100&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¸Šè¿°çš„é…ç½®å°±æ˜¯è¯´ï¼šä½¿ç”¨ &lt;code>egressSourceIP&lt;/code> ä¸­é…ç½®çš„ IP æ¥å¤„ç†æ¥è‡ªäº default å‘½åç©ºé—´ä¸­ Pod çš„å‡ºå£æµé‡äº†ã€‚&lt;/p>
&lt;h3 id="bgp-é›†æˆçš„æ”¯æŒ">BGP é›†æˆçš„æ”¯æŒ&lt;/h3>
&lt;p>å¾ˆå¤šå°ä¼™ä¼´æ”¾å¼ƒ Cilium çš„ä¸€å¤§åŸå› å¯èƒ½æ˜¯å› ä¸º BGP çš„æ”¯æŒï¼Œä½†ä»è¿™ä¸ªç‰ˆæœ¬å¼€å§‹å°±ä¸ç”¨æ‹…å¿ƒäº†ï¼&lt;/p>
&lt;p>Cilium é€šè¿‡é›†æˆ MetalLB æ¥è¿›è¡Œçš„ï¼Œä»¥æ­¤æ¥è¾¾åˆ° BGP L3 åè®®æ”¯æŒï¼Œè¿™æ · Cilium å¯ä»¥ä¸º LoadBalancer ç±»å‹çš„æœåŠ¡åˆ†é… IP ï¼Œå¹¶é€šè¿‡ BGP å°†å…¶é€šå‘Šçš„è·¯ç”±å™¨ï¼Œè¿™æ ·å¤–éƒ¨çš„æµé‡å°±å¯ä»¥æ­£å¸¸çš„è®¿é—®åˆ°æœåŠ¡äº†ã€‚&lt;/p>
&lt;p>é…ç½® BGP æ”¯æŒçš„æ–¹å¼ä¹Ÿå¾ˆç®€å•ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ConfigMap&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">bgp-config&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">namespace&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">kube-system&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">data&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">config.yaml&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">|&lt;/span>&lt;span class="sd">
&lt;/span>&lt;span class="sd"> peers:
&lt;/span>&lt;span class="sd"> - peer-address: 10.0.0.1
&lt;/span>&lt;span class="sd"> peer-asn: 64512
&lt;/span>&lt;span class="sd"> my-asn: 64512
&lt;/span>&lt;span class="sd"> address-pools:
&lt;/span>&lt;span class="sd"> - name: default
&lt;/span>&lt;span class="sd"> protocol: bgp
&lt;/span>&lt;span class="sd"> addresses:
&lt;/span>&lt;span class="sd"> - 192.0.2.0/24&lt;/span>&lt;span class="w">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¸»è¦å°±æ˜¯ &lt;code>peers&lt;/code> ç”¨äºå’Œç½‘ç»œä¸­ç°æœ‰çš„ BGP è·¯ç”±å™¨äº’è”ï¼Œ&lt;code>address-pools&lt;/code> åˆ™æ˜¯ Cilium ä¸º LoadBalancer åˆ†é…çš„ IP æ± ã€‚&lt;/p>
&lt;h3 id="åŸºäº-xdp-çš„ç‹¬ç«‹è´Ÿè½½å‡è¡¡">åŸºäº XDP çš„ç‹¬ç«‹è´Ÿè½½å‡è¡¡&lt;/h3>
&lt;p>Cilium åŸºäº eBPF çš„è´Ÿè½½å‡è¡¡å™¨æœ€è¿‘å¢åŠ äº†å¯¹ Maglev ä¸€è‡´æ€§å“ˆå¸Œçš„æ”¯æŒï¼Œä»¥åŠ eXpress(XDP) å±‚ä¸Šè½¬å‘å¹³é¢çš„åŠ é€Ÿï¼Œè¿™äº›ç‰¹æ€§ä½¿å¾—å®ƒä¹Ÿå¯ä»¥ä½œä¸ºç‹¬ç«‹çš„ 4 å±‚è´Ÿè½½å‡è¡¡å­˜åœ¨ã€‚&lt;/p>
&lt;p>Cilium XDP L4LB å…·æœ‰å®Œæ•´çš„ IPv4/IPv6 åŒæ ˆæ”¯æŒï¼Œå¯ä»¥ç‹¬ç«‹äº Kubernetes é›†ç¾¤ç‹¬ç«‹éƒ¨ç½²ï¼Œä½œä¸ºä¸€ä¸ªå¯ç¼–ç¨‹çš„ L4 LB å­˜åœ¨ã€‚&lt;/p>
&lt;h3 id="å…¶ä»–">å…¶ä»–&lt;/h3>
&lt;p>å¦å¤–å°±æ˜¯å¢åŠ äº†å¯¹ Wireguard çš„æ”¯æŒï¼Œè¿›è¡Œ Pod é—´æµé‡çš„åŠ å¯†ï¼›å¢åŠ äº†ä¸€ä¸ªæ–°çš„ Cilium CLI ï¼Œç”¨äºç®¡ç† Cilium é›†ç¾¤ï¼›ä»¥åŠ &lt;strong>æ¯”ä»¥å¾€æ›´åŠ ä¼˜å¼‚çš„æ€§èƒ½ï¼&lt;/strong>&lt;/p>
&lt;p>æ›´å¤šå…³äº Cilium é¡¹ç›®çš„å˜æ›´ï¼Œè¯·å‚è€ƒå…¶ &lt;a href="https://github.com/cilium/cilium/releases/tag/v1.10.0">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="ä¸Šæ¸¸è¿›å±•">ä¸Šæ¸¸è¿›å±•&lt;/h2>
&lt;ul>
&lt;li>
&lt;p>runc å‘å¸ƒäº† v1.0-rc95 ç‰ˆæœ¬ï¼Œå¤§æ¦‚æ˜¯ v1.0 å‰çš„æœ€åä¸€ä¸ªç‰ˆæœ¬äº†ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>CNCF ç½‘ç»œå°ç»„å®šä¹‰äº†ä¸€å¥— &lt;a href="https://smp-spec.io/" title="Service Mesh Performance çš„è§„èŒƒ">Service Mesh Performance çš„è§„èŒƒ&lt;/a>ï¼Œé€šè¿‡æ­¤è§„èŒƒæ¥è¾¾æˆä¸€ä¸ªç»Ÿä¸€çš„æ ‡å‡†ï¼Œç”¨æ¥è¡¡é‡ Service Mesh çš„æ€§èƒ½æƒ…å†µï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>CNCF ç½‘ç»œå°ç»„å®šä¹‰äº†ä¸€å¥— Service Mesh Performance çš„è§„èŒƒï¼Œé€šè¿‡æ­¤è§„èŒƒæ¥è¾¾æˆä¸€ä¸ªç»Ÿä¸€çš„æ ‡å‡†ï¼Œç”¨æ¥è¡¡é‡ Service Mesh çš„æ€§èƒ½æƒ…å†µï¼›&lt;/p>
&lt;/li>
&lt;/ul>
&lt;hr>
&lt;p>æ¬¢è¿è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://gitee.com/tlrr/awesome/raw/master/2020-9-9/1599632564572-mp-qrcode.png" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| Rancher Desktop v0.1.0 æŠ¢å…ˆä¸€è§ˆ</title><link>https://moelove.info/2021/04/30/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Rancher-Desktop-v0.1.0-%E6%8A%A2%E5%85%88%E4%B8%80%E8%A7%88/</link><guid isPermaLink="true">https://moelove.info/2021/04/30/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Rancher-Desktop-v0.1.0-%E6%8A%A2%E5%85%88%E4%B8%80%E8%A7%88/</guid><pubDate>Fri, 30 Apr 2021 17:01:30 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container" title="k8sç”Ÿæ€">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="trivy-v017-æ­£å¼å‘å¸ƒ">Trivy v0.17 æ­£å¼å‘å¸ƒ&lt;/h2>
&lt;p>&lt;a href="https://github.com/aquasecurity/trivy">Trivy&lt;/a> æ˜¯ä¸€æ¬¾ç”± Aqua Security å¼€æºçš„é•œåƒæ¼æ´å®‰å…¨æ‰«æç¨‹åºï¼Œåœ¨ä¹‹å‰çš„å‘¨æŠ¥ä¸­æˆ‘å·²ç»ä»‹ç»è¿‡å®ƒå¾ˆå¤šæ¬¡äº†ï¼Œç‰¹åˆ«æ–¹ä¾¿ä½¿ç”¨ï¼ï¼ˆåƒæˆ‘å®‰åˆ©ï¼ï¼‰æœ¬å‘¨ Trivy å‘å¸ƒäº† v0.17 ç‰ˆæœ¬ï¼Œæˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹æœ¬æ¬¡å€¼å¾—å…³æ³¨çš„å˜æ›´ã€‚&lt;/p>
&lt;h3 id="ç ´åæ€§å˜æ›´">ç ´åæ€§å˜æ›´&lt;/h3>
&lt;p>Trivy åœ¨ä¹‹å‰çš„ç‰ˆæœ¬ä¸­ï¼Œå…è®¸ä¸º &lt;code>--skip-dirs&lt;/code> å‚æ•°é€šè¿‡é€—å·ï¼ˆ,ï¼‰åˆ†å‰²ï¼Œè®¾å®šå¤šä¸ªç›®å½•ã€‚è‡ªæ­¤ç‰ˆæœ¬ä¸­ï¼Œå°†éµå¾ªå¤§å¤šæ•°è½¯ä»¶çš„é»˜è®¤è¡Œä¸ºï¼Œé€šè¿‡å¤šæ¬¡ä¼ é€’&lt;code>--skip-dirs&lt;/code> æ¥ä¼ é€’å¤šä¸ªå€¼ï¼Œæ¯ä¸ªå‚æ•°åªå¤„ç†ä¸€ä¸ªç›®å½•ã€‚&lt;/p>
&lt;p>v0.17 ç‰ˆæœ¬ä¹‹å‰ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">trivy image --skip-dirs &lt;span class="s2">&amp;#34;/usr/lib/ruby/gems,/etc&amp;#34;&lt;/span> fluent/fluentd:edge
&lt;/code>&lt;/pre>&lt;/div>&lt;p>v0.17 ç‰ˆæœ¬åŠä¹‹åï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">trivy image --skip-dirs /usr/lib/ruby/gems --skip-dirs &lt;span class="s2">&amp;#34;/etc&amp;#34;&lt;/span> fluent/fluentd:edge
&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¦‚æœæœ‰åœ¨ä½¿ç”¨æ­¤ç‰¹æ€§çš„å°ä¼™ä¼´ï¼Œåœ¨å‡çº§æ—¶éœ€è¦æ ¼å¤–æ³¨æ„ï¼ä»¥å…å½±å“åˆ°è‡ªå·±çš„å·¥ä½œæµ.&lt;/p>
&lt;h3 id="æ–°å¢ç‰¹æ€§">æ–°å¢ç‰¹æ€§&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>å¯ä»¥æ”¯æŒ Go äºŒè¿›åˆ¶æ–‡ä»¶æ‰«æäº†ã€‚ä¸»è¦å®ç°æ–¹å¼å¯ä»¥å‚è€ƒæˆ‘ä¹‹å‰å†™çš„æ–‡ç« &lt;a href="https://zhuanlan.zhihu.com/p/351354405" title="é€†å‘ Go äºŒè¿›åˆ¶æ–‡ä»¶">ã€Šé€†å‘ Go äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè·å–å…¶ä¾èµ–ä¿¡æ¯ã€‹&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¯ä»¥æ”¯æŒ JAVA ç›¸å…³å½’æ¡£æ–‡ä»¶çš„æ¼æ´æ‰«æäº†ï¼Œæ¯”å¦‚ JARï¼ŒWAR å’Œ EAR ç­‰æ ¼å¼ã€‚
ä½†è¯·æ³¨æ„ï¼š &lt;strong>æ­¤åŠŸèƒ½ç›®å‰æ— æ³•åœ¨ç¦»çº¿ç¯å¢ƒä¸­ä½¿ç”¨&lt;/strong> ï¼Œéœ€è¦å‘é€ HTTP è¯·æ±‚ä»¥ä¾¿æ‹¿åˆ°æ›´å¤šä¿¡æ¯ã€‚æ‰€ä»¥å¦‚æœç½‘ç»œç¯å¢ƒè¾ƒå·®ï¼Œå¯èƒ½æ­¤è¿‡ç¨‹ä¼šè€—æ—¶ä¹…ä¸€äº›ï¼Œå¯ä»¥é€šè¿‡å¢åŠ  &lt;code>--timeout&lt;/code> å‚æ•°æ¥æ§åˆ¶è¶…æ—¶æ—¶é—´ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>æ–°å¢äº† Plugin æœºåˆ¶&lt;/strong>ï¼Œä½¿ç”¨ç±»ä¼¼ kubectl å’Œ Helm çš„ &lt;a href="https://aquasecurity.github.io/trivy/v0.17.0/plugins/">Plugin æœºåˆ¶&lt;/a>ã€‚ &lt;em>æé—®ï¼šå¦‚æœ trivy é›†æˆäº† kubectl ä½œä¸º plugin ï¼Œè€Œ kubectl åˆç”¨ trivy åšäº† plugin é‚£ä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿ&lt;/em> æ¬¢è¿ç•™è¨€è®¨è®ºï½&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Sprig å‡½æ•°å¯ä»¥åœ¨ trivy çš„è‡ªå®šä¹‰æ¨¡æ¿ä¸­ä½¿ç”¨äº†ã€‚æœ‰æ²¡æœ‰å¾ˆçœ¼ç†Ÿï¼Ÿä¹‹å‰çš„å‘¨æŠ¥ä¸­ä»‹ç»è¿‡ Helm 3.5 ä¹Ÿæ”¯æŒäº†åŒæ ·çš„å†…å®¹ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>æ›´å¤šå…³äºæ­¤ç‰ˆæœ¬çš„è¯¦ç»†ä¿¡æ¯è¯·å‚è€ƒå…¶ &lt;a href="https://github.com/aquasecurity/trivy/discussions/966">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="alertmanager-v0220-rc0-å‘å¸ƒ">Alertmanager v0.22.0-rc.0 å‘å¸ƒ&lt;/h2>
&lt;p>ä½¿ç”¨ Prometheus çš„å°ä¼™ä¼´å¯¹ Alertmanager åº”è¯¥éƒ½ä¸é™Œç”Ÿï¼Œæ­¤ç‰ˆæœ¬ä¸­å¢åŠ äº†å¾ˆå¤šå®ç”¨çš„ç‰¹æ€§ï¼š&lt;/p>
&lt;ul>
&lt;li>æœ‰äº†æ–°çš„åˆ›å»º Silence çš„å½¢å¼ï¼Œæ–°æ—¥å†ï¼›&lt;/li>
&lt;li>Routes å¯ä»¥æŒ‰æ—¶é—´è¿›è¡Œè®¾ç½®äº†ï¼Œ è¿™ä¹Ÿå°±å¯ä»¥è§£å†³å¾ˆå¤šâ€œéå·¥ä½œæ—¶é—´ï¼Œä¸å¯¹æµ‹è¯•ç¯å¢ƒæŠ¥è­¦â€ä¹‹ç±»çš„éœ€æ±‚äº†ï¼›&lt;/li>
&lt;li>åœ¨ç•Œé¢ä¸Šç­›é€‰çš„æ—¶å€™ï¼Œå¯ä»¥æ”¯æŒ â€œéâ€ çš„åŒ¹é…æ¡ä»¶äº†ï¼Œ æ¯”å¦‚æˆ‘ä»¬å¯ä»¥ç›´æ¥åšå¦‚ä¸‹æ“ä½œï¼šâ€œéç”Ÿäº§ç¯å¢ƒï¼Œéƒ½å…³é—­â€ï¼›&lt;/li>
&lt;li>Web ç•Œé¢åŸç”Ÿæ”¯æŒ TLS å’Œ basic auth ï¼›&lt;/li>
&lt;li>å¢åŠ äº† OAuth2.0/OIDC æ”¯æŒï¼›&lt;/li>
&lt;li>è‹¹æœ M1 æ”¯æŒï¼›&lt;/li>
&lt;/ul>
&lt;p>æ›´å¤šå…³äºæ­¤ç‰ˆæœ¬çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è€ƒå…¶ &lt;a href="https://github.com/prometheus/alertmanager/releases/tag/v0.22.0-rc.0">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="rancher-desktop-v010-å‘å¸ƒ">Rancher Desktop v0.1.0 å‘å¸ƒ&lt;/h2>
&lt;p>Rancher æœ€è¿‘æ¨å‡ºäº†ä¸€ä¸ªåŸºäº electron æ„å»ºçš„æ¡Œé¢å·¥å…·ï¼Œç”¨äºåœ¨ Windows å’Œ macOS ç­‰æ¡Œé¢ç¯å¢ƒä¸‹ç®¡ç† Kubernetes å’Œå®¹å™¨ç­‰ã€‚å®ƒçš„æ ¸å¿ƒç‰¹æ€§å¦‚ä¸‹ï¼š&lt;/p>
&lt;ul>
&lt;li>æ”¯æŒè‡ªé€‰ Kubernetes ç‰ˆæœ¬ï¼ˆé€šè¿‡ k3s æä¾›æ”¯æŒï¼‰ï¼›&lt;/li>
&lt;li>å¯æµ‹è¯• Kubernetes ç‰ˆæœ¬å‡çº§æ—¶ï¼Œåº”ç”¨è´Ÿè½½çš„å˜åŒ–ï¼ˆä¹Ÿé€šè¿‡ k3s æä¾›ï¼‰ï¼›&lt;/li>
&lt;li>å®¹å™¨é•œåƒçš„ build/pull/push ç­‰ï¼ˆé€šè¿‡ &lt;a href="https://github.com/rancher/kim">kim&lt;/a> å’Œ BuildKit ç­‰å®ç°ï¼‰ï¼›&lt;/li>
&lt;li>æ”¯æŒæœ¬åœ°ç«¯å£æ˜ å°„ï¼ˆé€šè¿‡ kubectl port-forward å®ç°ï¼‰ï¼›&lt;/li>
&lt;/ul>
&lt;p>è¿™é‡Œç®€å•æ¥èŠèŠæˆ‘å¯¹è¿™ä¸ªå·¥å…·çš„çœ‹æ³•å§ã€‚ä»ä¸Šé¢çš„ä»‹ç»æ¥çœ‹ï¼Œå…¶å®å¾ˆå®¹æ˜“å°±èƒ½å‘ç°ï¼Œè¿™æ˜¯å¥”ç€ Docker Desktop çš„å¸‚åœºæ¥çš„ã€‚åˆ°ç›®å‰ä¸ºæ­¢ï¼Œå¸‚é¢ä¸Šæ‰€æœ‰å·¥å…·ä¸­ï¼Œèƒ½å®Œå…¨æ¶µç›–å’Œæ›¿æ¢ Docker Desktop çš„è¿˜æ²¡æœ‰ã€‚æ— è®ºè¯´å®¹å™¨&amp;amp;é•œåƒç®¡ç†ï¼Œé•œåƒå®‰å…¨æ‰«æï¼Œå†…ç½® k8s é›†ç¾¤ç­‰è¿™äº›å·¥å…·éƒ½èƒ½ä¸ºå¼€å‘è€…æä¾›æå¤§çš„ä¾¿åˆ©æ€§ã€‚è¿™ä¹Ÿæ˜¯ Docker ä»ç„¶èƒ½åœ¨å¼€å‘è€…å·¥å…·ä¸­å æœ‰å¤§é‡å¸‚åœºçš„ä¸€ä¸ªä¸»è¦åŸå› ã€‚&lt;/p>
&lt;p>å…¶æ¬¡ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªå·¥å…·æ¨å‡ºçš„æ—¶æœºã€‚æœ€è¿‘ Docker Desktop ç”±äºåœ¨æ–°ç‰ˆæœ¬ä¸­å°†â€œå…³é—­æ›´æ–°æé†’â€çš„åŠŸèƒ½è®¾ç½®æˆäº†ä»˜è´¹ç”¨æˆ·å¯ç”¨ï¼Œè€Œé­åˆ°äº†å¤§é‡çš„æ‰¹åˆ¤ã€‚è¿™ä¸ªå·¥å…·é€‰æ‹©åœ¨æ­¤æ—¶å‘å¸ƒç¬¬ä¸€ä¸ªç‰ˆæœ¬ï¼Œä¹Ÿè®¸æ˜¯å‡‘å·§ï¼Œä¹Ÿè®¸å°±æ°å¥½ç»™ä¸€äº›äººå¤šäº†ä¸ªé€‰æ‹©ã€‚&lt;/p>
&lt;p>é¢å¤–å¤šè¯´ä¸€ç‚¹ï¼ŒDocker Desktop æ–°ç‰ˆæœ¬ä¸­é‚£ä¸ªåŠŸèƒ½å˜æ›´çš„äº‹æƒ…ï¼Œå…¶å®åœ¨å„å¤§ç¤¾äº¤åª’ä½“/è®ºå›ä¸Šéƒ½æœ‰è¿‡å¾ˆå¤šè®¨è®ºäº†ï¼Œå°±æˆ‘ä¸ªäººè€Œè¨€ï¼Œæˆ‘è§‰å¾—è¿™ä¸ªå†³å®šæ˜¯åˆç†çš„ï¼Œä¹Ÿæ˜¯ Docker Inc. å¿…é¡»å¾—åšçš„ã€‚è¿™ä¸ªå…¬å¸åœ¨å¼€æºæ–¹é¢å·²ç»åšäº†è¶³å¤Ÿå¤šäº†ï¼Œå¦‚æœåœ¨è‡ªå·±çš„é—­æºäº§å“ä¸Šï¼Œä¹Ÿä¸åšäº›ç­–ç•¥ï¼Œé‚£å°±çœŸçš„å±é™©äº†ã€‚&lt;/p>
&lt;h2 id="ä¸Šæ¸¸è¿›å±•">ä¸Šæ¸¸è¿›å±•&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/pull/101093">#101093 Â· kubernetes/kubernetes&lt;/a> åœ¨ä»Šå¹´å¹´åˆçš„ &lt;a href="https://github.com/kubernetes/kubernetes/pull/98571">#98571&lt;/a>ä¸­ä¸ºäº†åœ¨ Pod ä¼˜é›…é€€å‡ºæ—¶å€™åœæ­¢ probe æ‰€ä»¥å¼•å…¥äº†éé¢„æœŸè¡Œä¸ºã€‚æ­¤ PR ä¸­å¯¹å…¶è¿›è¡Œäº†ä¿®å¤ã€‚è¯¥é—®é¢˜çš„åœºæ™¯æ˜¯ Pod åœ¨é‡å¯å &lt;code>startupProbe&lt;/code> ä¸èƒ½æ­£å¸¸çš„æ‰§è¡Œã€‚&lt;/li>
&lt;/ul>
&lt;hr>
&lt;p>æ¬¢è¿è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://gitee.com/tlrr/awesome/raw/master/2020-9-9/1599632564572-mp-qrcode.png" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| Docker v20.10.6 å‘å¸ƒï¼Œ ä¿®æ­£äº† K8S ä¸­ dind çš„å¼‚å¸¸è¡Œä¸º</title><link>https://moelove.info/2021/04/18/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Docker-v20.10.6-%E5%8F%91%E5%B8%83-%E4%BF%AE%E6%AD%A3%E4%BA%86-K8S-%E4%B8%AD-dind-%E7%9A%84%E5%BC%82%E5%B8%B8%E8%A1%8C%E4%B8%BA/</link><guid isPermaLink="true">https://moelove.info/2021/04/18/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Docker-v20.10.6-%E5%8F%91%E5%B8%83-%E4%BF%AE%E6%AD%A3%E4%BA%86-K8S-%E4%B8%AD-dind-%E7%9A%84%E5%BC%82%E5%B8%B8%E8%A1%8C%E4%B8%BA/</guid><pubDate>Sun, 18 Apr 2021 09:20:05 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container" title="k8sç”Ÿæ€">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="docker-v20106-å‘å¸ƒ">Docker v20.10.6 å‘å¸ƒ&lt;/h2>
&lt;p>è·ç¦»ä¸Šä¸ªç‰ˆæœ¬å·²ç»è¿‡å»äº†ä¸€ä¸ªå¤šæœˆï¼ŒDocker äºè¿‘æ—¥å‘å¸ƒäº† v20.10.6 ç‰ˆæœ¬ï¼Œè¿˜æœ‰ Docker Desktop ä¹Ÿå‘å¸ƒäº†æ–°ç‰ˆã€‚è¿™ä¸ªç‰ˆæœ¬ä¸­é™¤äº†å¸¦æ¥äº† M1 çš„æ”¯æŒå¤–ï¼Œè¿˜å¸¦æ¥äº†å¾ˆå¤šå€¼å¾—å…³æ³¨çš„å†…å®¹ï¼Œæˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹å§ï¼&lt;/p>
&lt;h3 id="cli-å’Œæ„å»ºå™¨">CLI å’Œæ„å»ºå™¨&lt;/h3>
&lt;p>åœ¨ Docker v1.7 ç‰ˆæœ¬ä¹‹å‰ï¼ŒDocker CLI åœ¨æ‰§è¡Œå®Œ docker login åï¼Œä¼šå°†ç›¸å…³ä¿¡æ¯å­˜å‚¨åˆ°æœ¬åœ°çš„ &lt;code>~/.dockercfg&lt;/code> é…ç½®æ–‡ä»¶ä¸­ã€‚è‡ªä» v1.7 ç‰ˆæœ¬å¼€å§‹ï¼ŒDocker å¼•å…¥äº†æ–°çš„é…ç½®æ–‡ä»¶ &lt;code>~/.docker/config.json&lt;/code>ï¼Œä¸ºäº†ä¿æŒå…¼å®¹æ€§ï¼ŒDocker ä¸€ç›´åœ¨åŒæ—¶æ”¯æŒè¿™ä¸¤ç§é…ç½®æ–‡ä»¶ã€‚&lt;/p>
&lt;p>ä»å½“å‰ç‰ˆæœ¬å¼€å§‹ï¼Œå¦‚æœå‘ç°è¿˜åœ¨ç”¨ &lt;code>~/.dockercfg&lt;/code> åˆ™ä¼šè¾“å‡ºä¸€è¡Œè­¦å‘Šä¿¡æ¯ã€‚æé†’ç”¨æˆ·è¯¥é…ç½®æ–‡ä»¶å°†åœ¨åç»­ç‰ˆæœ¬ä¸­åˆ é™¤ï¼Œè¯·ä½¿ç”¨æ–°çš„é…ç½®æ–‡ä»¶è·¯å¾„&amp;amp;æ ¼å¼ã€‚&lt;/p>
&lt;p>æ­¤å¤–ï¼Œä»è¿™ä¸ªç‰ˆæœ¬å¼€å§‹ï¼Œå¦‚æœåœ¨ä½¿ç”¨æ—§ç‰ˆçš„ builder å¹¶ä¸”åœ¨ Dockerfile ä¸­æœ‰å…¶ä¸æ”¯æŒçš„å‘½ä»¤æˆ–å‚æ•°ï¼Œåˆ™ä¼šæ‰“å°ç›¸å…³æŠ¥é”™ï¼Œå¹¶æç¤ºä½¿ç”¨ BuildKit æ¥å®Œæˆæ„å»ºã€‚è¿™ä¹Ÿæ˜¯ Docker ç¤¾åŒºæƒ³è¦å°† BuildKit æå‡ä¸ºé»˜è®¤æ„å»ºå™¨çš„è¿›ä¸€æ­¥ä¸¾æªã€‚&lt;/p>
&lt;h3 id="æ—¥å¿—">æ—¥å¿—&lt;/h3>
&lt;p>&lt;a href="https://github.com/moby/moby/pull/42174">#42174 Â· moby/moby&lt;/a>ä¿®æ­£äº† Docker v20.10 ç‰ˆæœ¬ä¸­ï¼Œå½“ä½¿ç”¨é»˜è®¤çš„ json-file æ—¥å¿—é©±åŠ¨æ—¶ï¼Œå¶å‘ä¼šé‡åˆ° io.UnexpectedEOF çš„é”™è¯¯ã€‚&lt;/p>
&lt;p>&lt;strong>åœ¨å®é™…æµ‹è¯•ä¸­ï¼Œåœ¨å¤§é‡æ—¥å¿—æŒç»­è¾“å‡ºçš„æƒ…å†µä¸‹ï¼Œæ¯”è¾ƒå®¹æ˜“å¤ç°æ­¤é—®é¢˜ã€‚&lt;/strong>&lt;/p>
&lt;h3 id="ç½‘ç»œ">ç½‘ç»œ&lt;/h3>
&lt;p>æ­¤ç‰ˆæœ¬ä¸­ä¿®æ­£äº† v20.10 ä¸­ï¼Œå½“å®¹å™¨åœæ­¢å iptables è§„åˆ™æ— æ³•è‡ªåŠ¨æ¸…ç†çš„é—®é¢˜ï¼›åŒæ—¶ä¹Ÿè§£å†³äº† Docker åœ¨æœ‰ IPv6 ç½‘ç»œæœºå™¨ä¸Šï¼Œæš´éœ²ç«¯å£æ—¶ï¼Œè™½ç„¶å¯ä»¥åŒæ—¶é€šè¿‡ IPv4 å’Œ IPv6 çš„åœ°å€è®¿é—®è¯¥ç«¯å£ï¼Œä½†æ˜¯ docker inspect çš„ API ä¸­é»˜è®¤ä¸è¿”å› IPv6 åœ°å€ä¿¡æ¯çš„é—®é¢˜ã€‚&lt;/p>
&lt;h3 id="å…¶ä»–">å…¶ä»–&lt;/h3>
&lt;p>åœ¨è¿™ä¸ªç‰ˆæœ¬ä¸­ï¼Œå¦‚æœä½¿ç”¨ Docker å®˜æ–¹æºè¿›è¡Œ Docker CE å®‰è£…çš„è¯ï¼Œé»˜è®¤ä¼šå»ºè®®å®‰è£… docker-scan-plugin åŒ…ï¼Œè¿™æ˜¯ä¸€ä¸ª docker CLI çš„æ’ä»¶ï¼Œå¯ç”¨äºæ‰«æé•œåƒæ¼æ´ã€‚&lt;/p>
&lt;p>è¯¥æ’ä»¶æˆ‘åœ¨ä¹‹å‰çš„ K8S ç”Ÿæ€å‘¨æŠ¥ä¸­å·²ç»ä»‹ç»è¿‡äº†ï¼Œæœ€åˆå…ˆå¼•å…¥åˆ°äº† Docker Desktop ä¸­ï¼Œè¿™ä¸ªæ’ä»¶è¿˜æ˜¯å¾ˆæ–¹ä¾¿çš„ã€‚&lt;/p>
&lt;p>å¦å¤–ï¼Œ &lt;strong>è¿™ä¸ªç‰ˆæœ¬ä¹Ÿè§£å†³äº†ä¸€ä¸ªæ¯”è¾ƒä¸¥é‡çš„é—®é¢˜&lt;/strong> ã€‚ è™½ç„¶æ­¤é—®é¢˜å¹¶é Docker è‡ªèº«å¯¼è‡´çš„ï¼Œä½†æ˜¯åœ¨ä½¿ç”¨ Docker In Docker æ¨¡å¼æ—¶ï¼Œä¼šè§¦å‘åˆ°ï¼Œæ‰€ä»¥åœ¨æ­¤è¿›è¡Œé¢å¤–çš„è¯´æ˜ã€‚&lt;/p>
&lt;p>å½“åœ¨ Kubernetes ä¸­ä½¿ç”¨ Docker In Docker v20.10 ç‰ˆæœ¬æ—¶å€™ï¼Œç”±äº Kubernetes æœ‰ QoS çš„æœºåˆ¶ï¼Œå®ƒç¡®å®šäº† Pod çš„è°ƒåº¦å’Œé©±é€ä¼˜å…ˆçº§ã€‚å®é™…ä¸Šï¼ŒKubelet æ˜¯é€šè¿‡åˆ¤æ–­ Pod çš„ oom_score_adj æ¥åˆ¤å®šä½•æ—¶å¯¹å®ƒè¿›è¡Œ OOM ã€‚å…³äºå®¹å™¨èµ„æºç®¡ç†çš„éƒ¨åˆ†ï¼Œè¯·å‚è€ƒæˆ‘ä¹‹å‰çš„æ–‡ç« &lt;a href="https://zhuanlan.zhihu.com/p/104207255">ã€ŠèŠèŠå®¹å™¨èµ„æºç®¡ç†ã€‹&lt;/a>&lt;/p>
&lt;p>å¦‚æœæ˜¯ BestEffort QoS çš„ Podï¼Œåˆ™ Kubernetes ä¼šå°†å®ƒçš„ oom_score_adj è®¾ç½®ä¸º 1000 ï¼Œä½†æ˜¯ containerd ä¸ºäº†èƒ½é¿å… shim ä¸è‡³äºåœ¨å­è¿›ç¨‹ä¹‹å‰æ¨å‡ºï¼Œæ‰€ä»¥åœ¨ &lt;code>AdjustOOMScore&lt;/code> å‡½æ•°ä¸­ï¼Œè¿›è¡Œäº†å¯¹ oom_score_adj åŠ  1 çš„è¡Œä¸ºã€‚ä¼šå¯¼è‡´å¦‚ä¸‹æŠ¥é”™ä¿¡æ¯ï¼š&lt;/p>
&lt;pre>&lt;code>docker: Error response from daemon: io.containerd.runc.v2: failed to adjust OOM score for shim: set shim OOM score: write /proc/211/oom_score_adj: invalid argument
&lt;/code>&lt;/pre>&lt;p>å‰é¢ä¹Ÿå·²ç»è¯´åˆ°äº† Besteffort QoS ä¸ºå®ƒè®¾ç½®çš„æ˜¯ 1000ï¼Œ è¿™å·²ç»æ˜¯è¯¥å€¼çš„æœ€å¤§å€¼å•¦ï¼Œè¦ +1 è‡ªç„¶ä¹Ÿå°±æŠ¥é”™äº†ã€‚&lt;/p>
&lt;p>å¯¹åº”çš„ä¿®æ­£æ–¹æ³•å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-diff" data-lang="diff">&lt;span class="gh">diff --git a/sys/oom_unix.go b/sys/oom_unix.go
&lt;/span>&lt;span class="gh">index d49d5bc8d..c381e1a7e 100644
&lt;/span>&lt;span class="gh">&lt;/span>&lt;span class="gd">--- a/sys/oom_unix.go
&lt;/span>&lt;span class="gd">&lt;/span>&lt;span class="gi">+++ b/sys/oom_unix.go
&lt;/span>&lt;span class="gi">&lt;/span>&lt;span class="gu">@@ -26,8 +26,12 @@ import (
&lt;/span>&lt;span class="gu">&lt;/span> &amp;#34;strings&amp;#34;
)
&lt;span class="gd">-// OOMScoreMaxKillable is the maximum score keeping the process killable by the oom killer
&lt;/span>&lt;span class="gd">-const OOMScoreMaxKillable = -999
&lt;/span>&lt;span class="gd">&lt;/span>&lt;span class="gi">+const (
&lt;/span>&lt;span class="gi">+ // OOMScoreMaxKillable is the maximum score keeping the process killable by the oom killer
&lt;/span>&lt;span class="gi">+ OOMScoreMaxKillable = -999
&lt;/span>&lt;span class="gi">+ // OOMScoreAdjMax is from OOM_SCORE_ADJ_MAX https://github.com/torvalds/linux/blob/master/include/uapi/linux/oom.h
&lt;/span>&lt;span class="gi">+ OOMScoreAdjMax = 1000
&lt;/span>&lt;span class="gi">+)
&lt;/span>&lt;span class="gi">&lt;/span>
&lt;span class="gh">diff --git a/runtime/v2/shim/util_unix.go b/runtime/v2/shim/util_unix.go
&lt;/span>&lt;span class="gh">index 2b0d0ada3..9fb7cc573 100644
&lt;/span>&lt;span class="gh">&lt;/span>&lt;span class="gd">--- a/runtime/v2/shim/util_unix.go
&lt;/span>&lt;span class="gd">&lt;/span>&lt;span class="gi">+++ b/runtime/v2/shim/util_unix.go
&lt;/span>&lt;span class="gi">&lt;/span>&lt;span class="gu">@@ -53,6 +53,7 @@ func SetScore(pid int) error {
&lt;/span>&lt;span class="gu">&lt;/span>
// AdjustOOMScore sets the OOM score for the process to the parents OOM score +1
// to ensure that they parent has a lower* score than the shim
&lt;span class="gi">+// if not already at the maximum OOM Score
&lt;/span>&lt;span class="gi">&lt;/span> func AdjustOOMScore(pid int) error {
parent := os.Getppid()
score, err := sys.GetOOMScoreAdj(parent)
&lt;span class="gu">@@ -60,6 +61,9 @@ func AdjustOOMScore(pid int) error {
&lt;/span>&lt;span class="gu">&lt;/span> return errors.Wrap(err, &amp;#34;get parent OOM score&amp;#34;)
}
shimScore := score + 1
&lt;span class="gi">+ if shimScore &amp;gt; sys.OOMScoreAdjMax {
&lt;/span>&lt;span class="gi">+ shimScore = sys.OOMScoreAdjMax
&lt;/span>&lt;span class="gi">+ }
&lt;/span>&lt;span class="gi">&lt;/span> if err := sys.SetOOMScore(pid, shimScore); err != nil {
return errors.Wrap(err, &amp;#34;set shim OOM score&amp;#34;)
}
&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¯ä»¥çœ‹åˆ°ï¼Œå°±æ˜¯åœ¨ AdjustOOMScore ä¸­ï¼Œå¦‚æœå‘ç°å‘ç°è°ƒæ•´åçš„ oom_score_adj å¤§äºäº†ç³»ç»Ÿé»˜è®¤çš„æœ€å¤§å€¼ï¼Œåˆ™å°†å®ƒè®¾ç½®ä¸ºç³»ç»Ÿçš„æœ€å¤§å€¼ã€‚&lt;/p>
&lt;p>å¦‚æœåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ containerd åŠ Docker In Docker çš„ï¼Œå»ºè®®å‡çº§åˆ°æ­¤ç‰ˆæœ¬è¿›è¡Œè§£å†³ã€‚&lt;/p>
&lt;p>å¥½äº†ï¼Œä»¥ä¸Šå°±æ˜¯æ­¤ç‰ˆæœ¬ä¸­éœ€è¦æ³¨æ„çš„å†…å®¹ï¼Œæ›´å¤šè¯¦ç»†çš„å˜æ›´ï¼Œè¯·æŸ¥çœ‹å…¶ &lt;a href="https://docs.docker.com/engine/release-notes/#20106">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="kube-state-metrics-v20-å‘å¸ƒ">kube-state-metrics v2.0 å‘å¸ƒ&lt;/h2>
&lt;p>åš Kubernetes é›†ç¾¤ç›‘æ§çš„å°ä¼™ä¼´ï¼Œå¤§å¤šå¯¹è¿™ä¸ªé¡¹ç›®éƒ½ä¸é™Œç”Ÿã€‚kube-state-metrics å¯ä»¥æ ¹æ® Kubernetes çš„èµ„æºçŠ¶æ€æ¥ç”Ÿæˆ Prometheus æ ¼å¼ï¼Œæå¤§çš„æ»¡è¶³äº†æˆ‘ä»¬å¯¹é›†ç¾¤å¯è§‚æµ‹æ€§çš„éœ€æ±‚ã€‚&lt;/p>
&lt;p>è¿™ä¸ªç‰ˆæœ¬ä¸»è¦æ˜¯å°†ä¸€äº› metrics çš„åå­—åšäº†æ›¿æ¢ï¼Œæ›¿æ¢æˆäº†æ›´åŠ æ ‡å‡†å’Œç»Ÿä¸€çš„æ ¼å¼ã€‚&lt;/p>
&lt;p>åŒæ—¶ï¼Œå°†é•œåƒçš„ä½ç½®ä» Quay.io è¿ç§»åˆ°äº† k8s.gcr.io/kube-state-metrics/kube-state-metrics ä¸­ã€‚&lt;/p>
&lt;p>æ›´å¤šå…³äºæ­¤ç‰ˆæœ¬çš„å˜æ›´ï¼Œè¯·æŸ¥çœ‹å…¶ &lt;a href="https://github.com/kubernetes/kube-state-metrics/blob/master/CHANGELOG.md">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="ä¸Šæ¸¸è¿›å±•">ä¸Šæ¸¸è¿›å±•&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/pull/99839">#99839 Â· kubernetes/kubernetes&lt;/a> ä¿®æ­£äº† port-forward çš„å†…å­˜æ³„æ¼é—®é¢˜ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/pull/99963">#99963 Â· kubernetes/kubernetes&lt;/a> ç¡®ä¿ job controller å¯ä»¥åœ¨ Pod å®Œæˆåæ¸…ç†æ‰å®ƒï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/pull/100644">#100644 Â· kubernetes/kubernetes&lt;/a> å°† KubeConfig æš´éœ²åœ¨ scheduler framework ä¸­ï¼Œä»¥ä¾¿äºæ ‘å¤–æ’ä»¶ä½¿ç”¨ã€‚&lt;/li>
&lt;/ul>
&lt;hr>
&lt;p>æ¬¢è¿è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://gitee.com/tlrr/awesome/raw/master/2020-9-9/1599632564572-mp-qrcode.png" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| Kubernetes v1.21 å‘å¸ƒ, å¸¦æ¥æ–°çš„å†…å­˜ç®¡ç†å™¨</title><link>https://moelove.info/2021/04/10/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Kubernetes-v1.21-%E5%8F%91%E5%B8%83-%E5%B8%A6%E6%9D%A5%E6%96%B0%E7%9A%84%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86%E5%99%A8/</link><guid isPermaLink="true">https://moelove.info/2021/04/10/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Kubernetes-v1.21-%E5%8F%91%E5%B8%83-%E5%B8%A6%E6%9D%A5%E6%96%B0%E7%9A%84%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86%E5%99%A8/</guid><pubDate>Sat, 10 Apr 2021 13:02:19 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container" title="k8sç”Ÿæ€">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="kubernetes-v121-æ­£å¼å‘å¸ƒ">Kubernetes v1.21 æ­£å¼å‘å¸ƒ&lt;/h2>
&lt;p>ä½œä¸º 2021 å¹´çš„é¦–ä¸ªç‰ˆæœ¬ï¼Œ Kubernetes v1.21 ä»¬å¸¦æ¥äº†ä¼—å¤šå¾ˆæ£’çš„ç‰¹æ€§ï¼Œå…±è®¡ 51 é¡¹ç‰¹æ€§å˜æ›´ï¼Œå…¶ä¸­ 13 é¡¹å‡çº§åˆ° Stableï¼Œ 16 é¡¹ç›®å‡çº§åˆ° Betaï¼Œ20 é¡¹æˆä¸º alphaï¼Œä»¥åŠ 2 é¡¹å°†è¢«åºŸå¼ƒã€‚æˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹æˆ‘è®¤ä¸ºæ¯”è¾ƒé‡è¦çš„ä¸€äº›å†…å®¹ã€‚&lt;/p>
&lt;h3 id="cronjob-å‡çº§åˆ°-stable">CronJob å‡çº§åˆ° Stable&lt;/h3>
&lt;p>CronJob é¡¾åæ€ä¹‰å°±æ˜¯å®šæ—¶/å‘¨æœŸæ€§ä»»åŠ¡ï¼ŒCronJob ä» Kubernetes v1.4 å¼€å§‹å¼•å…¥ï¼Œåˆ° v1.8 æ—¶è¿›å…¥åˆ° Beta é˜¶æ®µã€‚äº‹å®ä¸Šåœ¨ 2021 å¹´ 2 æœˆä»½çš„æ—¶å€™ï¼Œ&lt;a href="https://github.com/kubernetes/kubernetes/pull/98878">CronJobV2 controller å·²ç»æˆä¸ºäº†å®ƒé»˜è®¤çš„æ§åˆ¶å™¨ç‰ˆæœ¬&lt;/a>ï¼Œä¹Ÿå°±æ˜¯è¯´å½“ä½ åœ¨ Kubernetes v1.21 ç‰ˆæœ¬ä¸­ä½¿ç”¨ CronJob æ—¶ï¼Œå¦‚æœä¸æƒ³ä½¿ç”¨ CronJobV2 çš„æ§åˆ¶å™¨ï¼Œè€Œæƒ³è¦æ¢å›åŸå§‹çš„æ§åˆ¶å™¨æ—¶ï¼Œé‚£ä½ éœ€è¦æ˜¾å¼çš„å°†å®ƒç¦ç”¨æ‰ï¼Œæ¯”å¦‚ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">--feature-gates&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;CronJobControllerV2=false&amp;#34;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä½†æˆ‘ä¸ªäººè¿˜æ˜¯å»ºè®®ä½¿ç”¨ CronJobV2 controller ï¼Œè¿™ä¸ªç‰ˆæœ¬ç”¨äº†å»¶è¿Ÿé˜Ÿåˆ—å’Œ informer ç¼“å­˜ï¼ŒåŸå§‹ç‰ˆæœ¬çš„æ§åˆ¶å™¨ç®€é™‹äº†äº›ï¼Œä¹Ÿä¼šå¸¦æ¥ä¸€äº›é—®é¢˜ï¼Œæ¯”å¦‚å½“é•œåƒ/æœåŠ¡ä¸å¯ç”¨æ—¶ï¼Œä¼šäº§ç”Ÿæ— é™çš„ Pod æ³„æ¼çš„é—®é¢˜ã€‚&lt;/p>
&lt;p>æˆ‘åœ¨ç”Ÿäº§ç”¨ CronJob è¿˜è›®å¤šçš„ï¼Œå¤‡ä»½/åŒæ­¥ä»»åŠ¡ç­‰ï¼Œå½“ç„¶ä¹Ÿè¸©è¿‡ä¸Šé¢æåˆ°çš„å‘ï¼Œä½†æ•´ä½“æ¥è¯´ï¼ŒCronJob æ˜¯ä¸ªæŒºæœ‰ç”¨çš„ç‰¹æ€§ã€‚&lt;/p>
&lt;h3 id="å†…å­˜ç®¡ç†å™¨kubelet">å†…å­˜ç®¡ç†å™¨ï¼ˆkubeletï¼‰&lt;/h3>
&lt;p>åœ¨ Kubernetes v1.21 ä¸­åœ¨ kubelet ç»„ä»¶ç”Ÿæ€ä¸­æ–°å¢äº†ä¸€ä¸ª &lt;strong>å†…å­˜ç®¡ç†å™¨&lt;/strong> ï¼Œåœ¨ Linux ç³»ç»Ÿä¸­ï¼Œä¸ºéœ€è¦ä¿è¯ QoS çš„ Pod åœ¨å¤š NUMA èŠ‚ç‚¹ä¿éšœå†…å­˜å’Œå¤§å†…å­˜é¡µåˆ†é…ã€‚è¿™ä¸ªç‰¹æ€§éå¸¸æœ‰ç”¨ï¼Œå°¤å…¶æ˜¯å½“æ•°æ®åº“ç±»æˆ–è€…ä½¿ç”¨ DPDK è¿›è¡Œé«˜æ€§èƒ½æ•°æ®åŒ…å¤„ç†çš„åº”ç”¨è¦éƒ¨ç½²åˆ° Kubernetes ä¸­æ—¶ï¼Œå†…å­˜å¯¹å…¶æ€§èƒ½å½±å“è‡³å…³é‡è¦ã€‚&lt;/p>
&lt;p>è¿™é‡Œç¨å¾®èŠç‚¹å’Œ NUMA ç›¸å…³çš„å†…å®¹ã€‚ç®€å•æ¥è¯´å°±æ˜¯åœ¨å¤š NUMA ç»“æ„ä¸‹ï¼Œä¸ºäº†ä¿è¯æ•ˆç‡ï¼Œæ‰€ä»¥ä¼šæŒ‰å†…å­˜å’Œ CPU çš„ç›¸å¯¹è·ç¦»æ¥æŒ‰ node å®šä¹‰æ˜¯å¦ä¸º local memory æˆ–è€…è¯´æœ¬åœ°å†…å­˜ï¼ŒåŒæ—¶ç”±äºå®é™…ä½ç½®ä¸åŒï¼Œæ‰€ä»¥å°±å¯èƒ½ä¼šäº§ç”Ÿå†…å­˜åˆ†é…ä¸å‡åŒ€çš„æƒ…å†µäº†ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ numactl ç®¡ç†å·¥å…·æŸ¥çœ‹ä¸‹å½“å‰æœºå™¨ä¸Šçš„æƒ…å†µï¼š&lt;/p>
&lt;pre>&lt;code>[tao@moelove ~]# numactl -H
available: 2 nodes (0-1)
node 0 cpus: 0 1 2 3 4 5 6 7 8 9 20 21 22 23 24 25 26 27 28 29
node 0 size: 65186 MB
node 0 free: 9769 MB
node 1 cpus: 10 11 12 13 14 15 16 17 18 19 30 31 32 33 34 35 36 37 38 39
node 1 size: 65536 MB
node 1 free: 15206 MB
node distances:
node 0 1
0: 10 21
1: 21 10
&lt;/code>&lt;/pre>&lt;p>å¯ä»¥çœ‹åˆ°åœ¨æˆ‘å½“å‰çš„è¿™å°æœºå™¨ä¸Šå°±å­˜åœ¨ç€æ¯”è¾ƒæ˜æ˜¾çš„å†…å­˜åˆ†é…ä¸å‡çš„æƒ…å†µã€‚æ‰€ä»¥å½“æŸä¸ªè¿›ç¨‹è¾¾åˆ°äº†å…¶ local memory çš„ä¸Šé™ï¼Œé‚£è‡ªç„¶å°±ä¼šå½±å“åˆ°å®ƒçš„æ€§èƒ½ã€‚æˆ‘æœ€æ—©æŠ˜è…¾ NUMA ç›¸å…³é—®é¢˜æ˜¯åœ¨å‰äº›å¹´å¤§é‡ä½¿ç”¨ MongoDB çš„æ—¶å€™ï¼Œåœ¨è¿™ä¸Šé¢ä¹ŸèŠ±äº†äº›æ—¶é—´ï¼Œä¸è¿‡è¿™ä¹Ÿä¸å½±å“æˆ‘å¯¹ MongoDB çš„å–œçˆ±~&lt;/p>
&lt;p>è¿™æ¬¡åœ¨ kubelet ä¸­å¢åŠ çš„å†…å­˜ç®¡ç†å™¨ä¾¿å¯ä»¥å¾ˆå¥½çš„è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥åœ¨å¯åŠ¨ kubelet çš„æ—¶å€™é€šè¿‡ &lt;code>--reserved-memory&lt;/code> ä»¥åŠé…åˆ &lt;code>--memory-manager-policy&lt;/code> ç­‰å‚æ•°æ¥ä¸€èµ·è®¾ç½®ã€‚ä¾‹å¦‚ï¼š&lt;/p>
&lt;pre>&lt;code>--memory-manager-policy static --reserved-memory 0:memory=1Gi,hugepages-1M=2Gi --reserved-memory 1:memory=2Gi
&lt;/code>&lt;/pre>&lt;p>æ³¨æ„ï¼š&lt;code>memory-manager-policy&lt;/code> å¿…é¡»è®¾ç½®ä¸º staticï¼Œå¦‚æœä¸è®¾ç½®åˆ™é»˜è®¤ä¸º noneï¼Œå³ä¸é‡‡å–ä»»ä½•è¡Œä¸ºã€‚&lt;/p>
&lt;p>ä¸è¿‡è¿™ä¸ªç‰¹æ€§è¿˜åœ¨è¾ƒæ—©æœŸçš„é˜¶æ®µï¼Œç›®å‰åªä¸º &lt;code>Guaranteed&lt;/code> QoS ç±»çš„ Pod æä¾›æ”¯æŒã€‚å¦å¤–ï¼Œå¦‚æœæ­£ç¡®å¯ç”¨äº†æ­¤ç‰¹æ€§ï¼Œåˆ™åœ¨æœºå™¨çš„ /var/lib/kubelet/memory_manager_state å¯ä»¥çœ‹åˆ°å…¶è¯¦ç»†ä¿¡æ¯ã€‚&lt;/p>
&lt;p>&lt;img src="https://github.com/kubernetes/enhancements/raw/master/keps/sig-node/1769-memory-manager/mm_tm_diagram.png" alt="å†…å­˜ç®¡ç†å™¨çš„è®¾è®¡ - https://moelove.info">&lt;/p>
&lt;p>æœ€ç»ˆå°†ä¼šå½±å“åˆ°æ‹“æ‰‘ç®¡ç†å™¨ã€‚&lt;/p>
&lt;h3 id="replicaset-ç¼©å®¹ç®—æ³•è°ƒæ•´">ReplicaSet ç¼©å®¹ç®—æ³•è°ƒæ•´&lt;/h3>
&lt;p>å½“å‰çš„ç¼©å®¹ç®—æ³•ï¼Œä¸»è¦æ˜¯ä¼˜å…ˆåˆ é™¤ç”Ÿå‘½å‘¨æœŸæœ€çŸ­çš„ Podï¼Œæœ¬æ¬¡ä¿®æ”¹ä¸»è¦æ˜¯ä¸ºäº†é¿å…æŸäº›åœºæ™¯ï¼š&lt;/p>
&lt;p>æ¯”å¦‚åœ¨ç¼©å®¹çš„æ—¶å€™ï¼Œä¸€æ¬¡æ€§æŠŠæ–°æ‰©å®¹çš„æ‰€æœ‰çš„ Pod ç»™åˆ æ‰äº†ä¹‹ç±»çš„ã€‚æ‰€ä»¥è®¡åˆ’å¯¹ä»–ä»¬è¿›è¡Œå¯¹æ•°è®¡ç®—ï¼Œä¹Ÿå¯ä»¥ç®€å•çš„ç†è§£ä¸ºæƒ³è¦ç›¸å¯¹éšæœºçš„å¯¹ Pod è¿›è¡Œæ¸…ç†ã€‚&lt;/p>
&lt;p>è¿™ä¸ªè°ƒæ•´ç¡®å®èƒ½é¿å…æ‰ä¸Šè¿°æåˆ°çš„é‚£ç§åœºæ™¯ï¼Œä¸è¿‡ä¹Ÿå¯èƒ½ä¼šå¸¦æ¥ä¸€äº›å…¶ä»–çš„å…³äºæœåŠ¡å¯ç”¨æ€§ç›¸å…³çš„é—®é¢˜ï¼Œæ¯”å¦‚é€šå¸¸æƒ…å†µä¸‹è¿è¡Œæ—¶é—´è¶Šä¹…çš„ Pod å¯èƒ½å½“å‰æœåŠ¡çš„ç”¨æˆ·æ•°å°±è¶Šå¤šï¼Œè¿æ¥é”€æ¯æ—¶ï¼Œå¯èƒ½å°±ä¼šæ¯”æ–° Pod å¸¦æ¥çš„å½±å“å¤§ä¸€äº›äº†ã€‚å½“ç„¶ï¼Œè¿™äº›ä¹Ÿéƒ½æ˜¯å¯ä»¥é€šè¿‡å…¶ä»–çš„æ–¹å¼æ¥é¿å…çš„ï¼Œæ„Ÿå…´è¶£çš„å°ä¼™ä¼´å¯ä»¥ç»™æˆ‘ç•™è¨€ï¼Œä¸€èµ·è®¨è®ºã€‚&lt;/p>
&lt;p>å…¶ä»–çš„ä¸€äº›å€¼å¾—å…³æ³¨çš„å˜æ›´ï¼Œæˆ‘åœ¨æ¯å‘¨çš„ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€ä¸­éƒ½æœ‰ä»‹ç»è¿‡äº†ï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°å•¦ï¼Œæ„Ÿå…´è¶£çš„å°ä¼™ä¼´å¯ä»¥ç¿»çœ‹æ¯æœŸã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€ä¸­ â€œä¸Šæ¸¸è¿›å±•â€ çš„éƒ¨åˆ†ã€‚å…³äºæ­¤ç‰ˆæœ¬ä¸­çš„å…¶ä»–å˜æ›´ï¼Œå¯å‚è€ƒå…¶ &lt;a href="https://github.com/kubernetes/kubernetes/releases/tag/v1.21.0">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="containerd-v150-rc0-å‘å¸ƒ">containerd v1.5.0-rc.0 å‘å¸ƒ&lt;/h2>
&lt;p>æœ¬å‘¨ containerd å‘å¸ƒäº† v1.5.0-rc.0 ç‰ˆæœ¬ï¼Œè¿™æ˜¯ containerd çš„ç¬¬å…­ä¸ªå¤§ç‰ˆæœ¬ï¼Œå¸¦æ¥äº†ä¼—å¤šå€¼å¾—å…³æ³¨çš„å˜æ›´ï¼š&lt;/p>
&lt;h3 id="runtime">runtime&lt;/h3>
&lt;ul>
&lt;li>&lt;a href="https://github.com/containerd/containerd/pull/4647">#4647&lt;/a> ç”±äº CRI-API çš„æ›´æ–°ï¼Œå¯ä»¥åœ¨ task update çš„ API ä¸­æ·»åŠ  annotations äº†ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/containerd/containerd/pull/4502">#4502&lt;/a> å½“ terminal ä¸º true æ—¶ï¼Œæ·»åŠ äºŒè¿›åˆ¶æ—¥å¿—çš„æ”¯æŒï¼›&lt;/li>
&lt;/ul>
&lt;h3 id="distribution">Distribution&lt;/h3>
&lt;ul>
&lt;li>&lt;a href="https://github.com/containerd/containerd/pull/4523">#4523&lt;/a> åœ¨æ—¥å¿—ä¸­è®°å½• registry è¿”å›çš„å¼‚å¸¸çŠ¶æ€ç ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/containerd/containerd/pull/4653">#4653&lt;/a> æ”¹è¿›äº†åœ¨ registry ä¸º HTTP 1.1 åè®®ä¸‹ pull image çš„æ€§èƒ½ï¼›&lt;/li>
&lt;/ul>
&lt;h3 id="cri">CRI&lt;/h3>
&lt;ul>
&lt;li>&lt;a href="https://github.com/containerd/cri/pull/1552">cri#1552&lt;/a> å®éªŒæ€§çš„æ·»åŠ äº† NRIï¼ˆNode Resource Interfaceï¼‰ çš„æ³¨å…¥ç‚¹;&lt;/li>
&lt;li>&lt;a href="https://github.com/containerd/containerd/pull/4978/files">#4978&lt;/a> å…è®¸ä¸º CRI çš„ registry é…ç½®ç±»ä¼¼ docker çš„ &lt;code>/etc/docker/certs.d&lt;/code> ç›®å½•ï¼Œå¯ä»¥è¿›è¡Œæ›´æ–¹ä¾¿çš„é…ç½®ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/containerd/containerd/pull/5135/files">#5135&lt;/a> é»˜è®¤å¼€å¯ ocicrypt æ”¯æŒï¼›&lt;/li>
&lt;/ul>
&lt;p>æ›´å¤šå…³äºæ­¤ç‰ˆæœ¬çš„å˜æ›´ï¼Œè¯·æŸ¥çœ‹å…¶ &lt;a href="https://github.com/containerd/containerd/releases/tag/v1.5.0-rc.0">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="cilium-v1100-rc0-å‘å¸ƒ">Cilium v1.10.0-rc0 å‘å¸ƒ&lt;/h2>
&lt;p>Cilium æˆ‘å·²ç»å¤šæ¬¡ä»‹ç»è¿‡äº†ï¼Œæ„Ÿå…´è¶£çš„å°ä¼™ä¼´å¯ä»¥æŸ¥çœ‹æˆ‘ä¹‹å‰çš„æ–‡ç« ã€Š&lt;a href="https://zhuanlan.zhihu.com/p/213745089">è¢« Google é€‰æ‹©çš„ä¸‹ä¸€ä»£æ•°æ®é¢ Cilium æ˜¯ä»€ä¹ˆ&lt;/a>ã€‹ã€‚è¯¥é¡¹ç›®äºè¿‘æœŸå‘å¸ƒäº† v1.10.0-rc0 ç‰ˆæœ¬ï¼Œæˆ‘ä»¬çœ‹çœ‹ä¸»è¦çš„å˜æ›´ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://github.com/cilium/cilium/pull/13670">#13670 Â· cilium/cilium&lt;/a> æ·»åŠ äº† &lt;code>--datapath-mode=lb-only&lt;/code> é€‰é¡¹ï¼Œä»¥æ”¯æŒä»… LB æ¨¡å¼ï¼Œè¿™æ ·å°±å¯ä»¥è®© cilium-agent ä½œä¸ºä¸€ä¸ªç‹¬ç«‹çš„ loadbalancer è¿è¡Œäº†ï¼Œä¸éœ€è¦è¿æ¥ kube-apiserver æˆ–è€… kvstore ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/cilium/cilium/pull/14858">#14858 Â· cilium/cilium&lt;/a> åœ¨ wireguard, tun ç­‰æ— äºŒå±‚è®¾å¤‡ä¸Šæ·»åŠ  NodePort BPF æ”¯æŒï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/cilium/cilium/pull/14207">#14207 Â· cilium/cilium&lt;/a> æ·»åŠ  arm64 æ”¯æŒï¼›&lt;/li>
&lt;/ul>
&lt;p>æ›´å¤šå…³äºæ­¤ç‰ˆæœ¬çš„å˜æ›´ï¼Œè¯·æŸ¥çœ‹å…¶ &lt;a href="https://github.com/cilium/cilium/releases/tag/v1.10.0-rc0">ReleaseNote&lt;/a>&lt;/p>
&lt;hr>
&lt;p>æ¬¢è¿è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://gitee.com/tlrr/awesome/raw/master/2020-9-9/1599632564572-mp-qrcode.png" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| Prometheus v2.26 å‘å¸ƒ, å¸¦æ¥ä¼—å¤šå®ç”¨ç‰¹æ€§</title><link>https://moelove.info/2021/04/01/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Prometheus-v2.26-%E5%8F%91%E5%B8%83-%E5%B8%A6%E6%9D%A5%E4%BC%97%E5%A4%9A%E5%AE%9E%E7%94%A8%E7%89%B9%E6%80%A7/</link><guid isPermaLink="true">https://moelove.info/2021/04/01/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Prometheus-v2.26-%E5%8F%91%E5%B8%83-%E5%B8%A6%E6%9D%A5%E4%BC%97%E5%A4%9A%E5%AE%9E%E7%94%A8%E7%89%B9%E6%80%A7/</guid><pubDate>Thu, 01 Apr 2021 08:09:27 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container" title="k8sç”Ÿæ€">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="prometheus-v2260-æ­£å¼å‘å¸ƒ">Prometheus v2.26.0 æ­£å¼å‘å¸ƒ&lt;/h2>
&lt;p>Prometheus æœ¬å‘¨å‘å¸ƒäº† v2.26.0 ç‰ˆæœ¬ï¼Œé™¤äº† &lt;strong>ä»æ­¤ç‰ˆæœ¬å¼€å§‹é»˜è®¤ä½¿ç”¨ Alertmanager v2 API&lt;/strong> å¤–ï¼Œè¿˜å¸¦æ¥äº†ä¼—å¤šå€¼å¾—å…³æ³¨çš„æ›´æ–°ï¼Œæˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹å§ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://github.com/prometheus/prometheus/pull/8542">#8542&lt;/a> Prometheus å’Œ Promtool ç°åœ¨å°†æŠŠ &lt;code>--help&lt;/code> ä¿¡æ¯æ‰“å°åˆ° stdout è€ŒéåŸæ¥çš„ stderr ï¼Œè¿™æ ·ä»¥åå°±å¯ä»¥å¾ˆç›´æ¥çš„ grep æœç´¢äº†ï¼Œè€Œä¸éœ€é‡å®šå‘äº†ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/prometheus/prometheus/pull/8509">#8509&lt;/a> remote write ä¸­æ·»åŠ äº†å¯¹ AWS SigV4 è®¤è¯æ–¹æ³•çš„æ”¯æŒï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/prometheus/prometheus/pull/8487">#8487&lt;/a> å…è®¸ä½¿ç”¨ &lt;code>--enable-feature=promql-negative-offset&lt;/code> æ ‡å¿—æ¥å¯ç”¨è´Ÿåç§»é‡ï¼Œè´Ÿåç§»é‡çš„å®é™…å«ä¹‰ä¹Ÿå°±æ˜¯ â€œå°†æ¥â€ï¼Œæˆ‘æš‚æ—¶è¿˜æ²¡ä½¿ç”¨å®ƒçš„éœ€æ±‚ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/prometheus/prometheus/pull/6635">#6635&lt;/a> å…è®¸ä½¿ç”¨ &lt;code>--enable-feature=exemplar-storage&lt;/code> æ ‡å¿—æ¥å¯ç”¨å†…å­˜æ ·æœ¬å­˜å‚¨ã€‚å…¶å®æ·±æŒ–è¿™ä¸ªç‰¹æ€§çš„è¯ï¼ŒèƒŒååŒ…å«äº†ä¸€å¥—ç›¸å¯¹å®Œæ•´çš„ç†è®ºï¼Œè¿™ä¸ªæŠ€æœ¯æœ€åˆæ˜¯ 2018 å¹´ Google åœ¨&lt;a href="https://www.youtube.com/watch?v=TzFjweKACMY">ä¸€æ¬¡åˆ†äº«ä¸­å…¬å¼€çš„&lt;/a>ï¼Œä¸»è¦æ˜¯ä¸ºäº†èƒ½æ›´å¥½çš„åº¦é‡ç³»ç»Ÿçš„ç‰¹å®šåŸŸå†…çš„æ€§èƒ½æŒ‡æ ‡ï¼Œç®€å•æ¥è¯´å°±å½“ä½œæ˜¯ metrics ç³»ç»Ÿä¸ trace ç³»ç»Ÿç»“åˆçš„ä¸€ç§æ–¹å¼å§ï¼Œæœ‰å…´è¶£çš„å°ä¼™ä¼´å¯ä»¥æ·±å…¥äº†è§£ä¸‹ã€‚å°±ç›®å‰è€Œè¨€ï¼Œè¿˜æœ‰ä¸€äº›é—®é¢˜éœ€è¦è§£å†³ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/prometheus/prometheus/pull/8634">#8634&lt;/a> UI éƒ¨åˆ†åœ¨è¾“å…¥æ¡†ä¸º PromQL å¢åŠ äº†é«˜çº§çš„è‡ªåŠ¨è¡¥å…¨ï¼Œè¯­æ³•é«˜äº®å’Œ lint ï¼Œå†™è¡¨è¾¾å¼çš„æ—¶å€™å°±æ›´æ–¹ä¾¿å•¦ã€‚æ³¨æ„éœ€è¦å‹¾é€‰ â€œUse experimental editorâ€&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://moelove.info/img/prometheus-226-editor.png" alt="Prometheus New UI - https://moelove.info">&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;a href="https://github.com/prometheus/prometheus/pull/8457">#8457&lt;/a> PromQL å¢åŠ äº†å‡ ä¸ªæœ‰ç”¨çš„æ–°å‡½æ•°ï¼š&lt;/p>
&lt;ul>
&lt;li>clampï¼šé™å®š metrics çš„å€¼åœ¨ç¡®å®šåŒºé—´å†…ï¼›&lt;/li>
&lt;li>last_over_timeï¼šå®ƒçš„è¡Œä¸ºå¾ˆåƒæ˜¯ offsetï¼Œä½†å…¶å®å®ƒåªè¿”å›æŒ‡å®šåŒºé—´çš„æœ€åä¸€ä¸ªå€¼ï¼Œå¯ä»¥å‚è€ƒ max_over_time å‡½æ•°ï¼›&lt;/li>
&lt;li>sgnï¼šå®ƒæ˜¯å®šä¹‰äº†ä¸€ä¸ªå‘é‡ï¼Œå¦‚æœå€¼ä¸ºæ­£ï¼Œåˆ™è¿”å› 1ï¼Œå¦‚æœå€¼ä¸ºè´Ÿåˆ™è¿”å› -1 ï¼Œå¦‚æœå€¼ä¸º 0 åˆ™è¿”å› 0ï¼›&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;a href="https://github.com/prometheus/prometheus/pull/8512">#8512&lt;/a> Prometheus çš„ Authorization å¤´ï¼Œç°åœ¨å¯ä»¥ç›´æ¥ä½¿ç”¨ Bearer Token äº†ã€‚ä¾‹å¦‚ï¼š&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>åŸå…ˆï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-yaml" data-lang="yaml">- &lt;span class="nt">job_name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;moelove&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">bearer_token&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;5YWs5LyX5Y+3IE1vZUxvdmUK&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">static_configs&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">targets&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="s1">&amp;#39;localhost:9999&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç°åœ¨ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-yaml" data-lang="yaml">- &lt;span class="nt">job_name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;moelove&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">authorization&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">credentials&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;5YWs5LyX5Y+3IE1vZUxvdmUK&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">static_configs&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">targets&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="s1">&amp;#39;localhost:9999&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™æ ·å¯ä»¥æ›´çµæ´»ç‚¹ï¼Œä¹Ÿæ–¹ä¾¿ä»¥åçš„æ‰©å±•ã€‚&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://github.com/prometheus/prometheus/pull/8546">#8546&lt;/a> æ·»åŠ äº†ä¸€ä¸ª follow_redirects çš„é€‰é¡¹ï¼Œå¯ä»¥ç”¨æ¥ç¦ç”¨é‡å®šå‘è·Ÿéšã€‚&lt;/li>
&lt;/ul>
&lt;p>æ›´å¤šå…³äºæ­¤ç‰ˆæœ¬çš„å…¶ä»–å˜æ›´ï¼Œè¯·å‚è€ƒå…¶ &lt;a href="https://github.com/prometheus/prometheus/releases/tag/v2.26.0" title="Prometheus v2.26.0">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="docker-8-å‘¨å²å•¦">Docker 8 å‘¨å²å•¦ï¼&lt;/h2>
&lt;p>æ¯å¹´ Docker ç¤¾åŒºéƒ½ä¼šä¸º Docker çš„ç”Ÿæ—¥å‡†å¤‡ä¸€æ¬¡ç‰¹æ®Šçš„åº†ç¥æ´»åŠ¨ï¼Œä»Šå¹´ä¹Ÿä¸ä¾‹å¤–ã€‚å»å¹´æˆ‘ä»¬å‡†å¤‡äº†ä¸€æ¬¡çº¿ä¸Šçš„äº¤æµï¼Œä»Šå¹´åˆ™æ˜¯é‡‡ç”¨äº†å‡†å¤‡äº† 8 ä¸ªæœ‰è¶£çš„ç­”é¢˜ç¯èŠ‚ï¼Œæœ‰å…´è¶£çš„å°ä¼™ä¼´å¯ä»¥è®¿é—® &lt;a href="https://www.docker.com/blog/a-birthday-challenge-as-docker-turns-8/">Docker 8 å‘¨å¹´ç‰¹åˆ«åœ°å€&lt;/a>å‚ä¸æ´»åŠ¨ã€‚&lt;/p>
&lt;p>&lt;img src="https://i0.wp.com/www.docker.com/blog/wp-content/uploads/2021/03/Docker-8-year-Birthday.png?w=1024&amp;amp;ssl=1" alt="Docker 8 - https://moelove.info">&lt;/p>
&lt;h2 id="podman-v310-æ­£å¼å‘å¸ƒ">Podman v3.1.0 æ­£å¼å‘å¸ƒ&lt;/h2>
&lt;p>Podman çš„æ›´æ–°é¢‘ç‡è¿˜æ˜¯è›®å¿«çš„ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªç‰ˆæœ¬ä¸­æ¯”è¾ƒå€¼å¾—å…³æ³¨çš„ä¸€äº›ç‰¹æ€§å§ï¼&lt;/p>
&lt;ul>
&lt;li>æ–°å¢äº†ä¸€ç»„ secret å‘½ä»¤ã€‚ä¾‹å¦‚ &lt;code>podman secret create&lt;/code> ï¼Œ &lt;code>podman secret inspect&lt;/code> ç­‰ï¼Œå…è®¸åœ¨ &lt;code>podman run&lt;/code> é€šè¿‡ &lt;code>--secret&lt;/code> é€‰é¡¹è¿›è¡Œä¼ é€’ï¼›&lt;/li>
&lt;li>å¢åŠ äº†ä¸€ä¸ªæ¸…ç†ç½‘ç»œçš„å‘½ä»¤ï¼Œ &lt;code>podman network prune&lt;/code>ï¼›&lt;/li>
&lt;li>æ–°å¢ &lt;code>podman network exists&lt;/code>, &lt;code>podman volume exists&lt;/code> å’Œ &lt;code>podman manifest exists&lt;/code> ç­‰å‘½ä»¤ï¼Œæ¥åˆ¤æ–­å¯¹åº”èµ„æºæ˜¯å¦å­˜åœ¨ï¼›&lt;/li>
&lt;/ul>
&lt;p>æ›´å¤šå…³äºæ­¤ç‰ˆæœ¬çš„å…¶ä»–å˜æ›´ï¼Œè¯·å‚è€ƒå…¶ &lt;a href="https://github.com/containers/podman/releases/tag/v3.1.0" title="Podman v3.1.0">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="ä¸Šæ¸¸è¿›å±•">ä¸Šæ¸¸è¿›å±•&lt;/h2>
&lt;ul>
&lt;li>Kubernetes v1.21 å³å°†å‘å¸ƒï¼Œå°†å¸¦æ¥ä¼—å¤šæœ‰ç”¨çš„æ›´æ–°ï¼Œæ•¬è¯·æœŸå¾…ï¼›&lt;/li>
&lt;li>PodSecurityPolicyï¼ˆPSPï¼‰åœ¨ v1.21 ä¸­å·²å¼ƒç”¨ï¼Œ&lt;a href="https://github.com/kubernetes/enhancements/issues/2579">KEP 2579&lt;/a> æ˜¯ç›¸å¯¹åº”çš„å¢å¼ºå»ºè®®ï¼Œå…³äº PSP ç›¸å…³çš„å†…å®¹å¯å‚è€ƒ k8s å®˜æ–¹çš„åšå®¢å†…å®¹ &lt;a href="https://kubernetes.io/blog/2021/04/06/podsecuritypolicy-deprecation-past-present-and-future/" title="PodSecurityPolicy Deprecation: Past, Present, and Future">PodSecurityPolicy Deprecation: Past, Present, and Future | Kubernetes&lt;/a>&lt;/li>
&lt;/ul>
&lt;hr>
&lt;p>æ¬¢è¿è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://gitee.com/tlrr/awesome/raw/master/2020-9-9/1599632564572-mp-qrcode.png" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>ä¸‡å­—é•¿æ–‡ï¼šå½»åº•ææ‡‚å®¹å™¨é•œåƒæ„å»º</title><link>https://moelove.info/2021/03/14/%E4%B8%87%E5%AD%97%E9%95%BF%E6%96%87%E5%BD%BB%E5%BA%95%E6%90%9E%E6%87%82%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F%E6%9E%84%E5%BB%BA/</link><guid isPermaLink="true">https://moelove.info/2021/03/14/%E4%B8%87%E5%AD%97%E9%95%BF%E6%96%87%E5%BD%BB%E5%BA%95%E6%90%9E%E6%87%82%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F%E6%9E%84%E5%BB%BA/</guid><pubDate>Sun, 14 Mar 2021 23:36:58 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å¼ æ™‹æ¶›ã€‚&lt;/p>
&lt;p>æˆ‘å°†åœ¨è¿™ç¯‡æ–‡ç« ä¸­æ·±å…¥ Docker çš„æºç ï¼Œä¸ä½ èŠèŠé•œåƒæ„å»ºçš„åŸç†ã€‚&lt;/p>
&lt;h2 id="docker-æ¶æ„">Docker æ¶æ„&lt;/h2>
&lt;p>è¿™é‡Œæˆ‘ä»¬å…ˆä»å®è§‚ä¸Šå¯¹ &lt;code>Docker&lt;/code> æœ‰ä¸ªå¤§æ¦‚çš„è®¤è¯†ï¼Œå®ƒæ•´ä½“ä¸Šæ˜¯ä¸ª C/S æ¶æ„ï¼›æˆ‘ä»¬å¹³æ—¶ä½¿ç”¨çš„ &lt;code>docker&lt;/code> å‘½ä»¤å°±æ˜¯å®ƒçš„ CLI å®¢æˆ·ç«¯ï¼Œè€Œå®ƒçš„æœåŠ¡ç«¯æ˜¯ &lt;code>dockerd&lt;/code> åœ¨ Linux ç³»ç»Ÿä¸­ï¼Œé€šå¸¸æˆ‘ä»¬æ˜¯ä½¿ç”¨ &lt;code>systemd&lt;/code> è¿›è¡Œç®¡ç†ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ &lt;code>systemctl start docker&lt;/code> æ¥å¯åŠ¨æœåŠ¡ã€‚ï¼ˆä½†æ˜¯è¯·æ³¨æ„ï¼Œ&lt;code>dockerd&lt;/code> æ˜¯å¦èƒ½è¿è¡Œä¸ &lt;code>systemd&lt;/code> å¹¶æ— ä»»ä½•å…³ç³»ï¼Œä½ å¯ä»¥åƒå¹³æ—¶æ‰§è¡Œä¸€ä¸ªæ™®é€šçš„äºŒè¿›åˆ¶ç¨‹åºä¸€æ ·ï¼Œç›´æ¥é€šè¿‡ &lt;code>dockerd&lt;/code> æ¥å¯åŠ¨æœåŠ¡ï¼Œæ³¨æ„éœ€è¦ root æƒé™ï¼‰&lt;/p>
&lt;p>å®é™…ä¸Šä¹Ÿå°±æ˜¯&lt;/p>
&lt;p>&lt;img src="https://docs.docker.com/engine/images/engine-components-flow.png" alt="Docker æ¶æ„">&lt;/p>
&lt;p>(å›¾ç‰‡æ¥æºï¼šdocker overview)&lt;/p>
&lt;p>&lt;code>docker&lt;/code> CLI ä¸ &lt;code>dockerd&lt;/code> çš„äº¤äº’æ˜¯é€šè¿‡ REST API æ¥å®Œæˆçš„ï¼Œå½“æˆ‘ä»¬æ‰§è¡Œ &lt;code>docker version&lt;/code> çš„æ—¶å€™è¿‡æ»¤ API å¯ä»¥çœ‹åˆ°å¦‚ä¸‹è¾“å‡ºï¼š&lt;/p>
&lt;pre>&lt;code>âœ ~ docker version |grep API
API version: 1.41
API version: 1.41 (minimum version 1.12)
&lt;/code>&lt;/pre>&lt;p>ä¸Šé¢ä¸€è¡Œæ˜¯ &lt;code>docker&lt;/code> CLI çš„ API ç‰ˆæœ¬ï¼Œä¸‹é¢åˆ™ä»£è¡¨äº† &lt;code>dockerd&lt;/code> çš„ API ç‰ˆæœ¬ï¼Œå®ƒçš„åé¢è¿˜æœ‰ä¸ªæ‹¬å·ï¼Œæ˜¯å› ä¸º Docker å…·å¤‡äº†å¾ˆè‰¯å¥½çš„å…¼å®¹æ€§ï¼Œè¿™é‡Œè¡¨ç¤ºå®ƒæœ€å°å¯å…¼å®¹çš„ API ç‰ˆæœ¬æ˜¯ 1.12 ã€‚&lt;/p>
&lt;p>å¯¹äºæˆ‘ä»¬è¿›è¡Œ C/S æ¶æ„çš„é¡¹ç›®å¼€å‘è€Œè¨€ï¼Œä¸€èˆ¬éƒ½æ˜¯ API å…ˆè¡Œ, æ‰€ä»¥æˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹ API çš„éƒ¨åˆ†ã€‚&lt;/p>
&lt;p>å½“ç„¶ï¼Œæœ¬æ–‡çš„ä¸»ä½“æ˜¯æ„å»ºç³»ç»Ÿç›¸å…³çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±ç›´æ¥æ¥çœ‹æ„å»ºç›¸å…³çš„ API å³å¯ã€‚&lt;/p>
&lt;p>æ¥ä¸‹æ¥ä¼šè¯´ CLIï¼Œä»£ç ä»¥ v20.10.5 ä¸ºå‡†ã€‚æœ€åè¯´æœåŠ¡ç«¯ Dockerd ã€‚&lt;/p>
&lt;h2 id="api">API&lt;/h2>
&lt;p>Docker ç»´æŠ¤å›¢é˜Ÿåœ¨æ¯ä¸ªç‰ˆæœ¬æ­£å¼å‘å¸ƒä¹‹åï¼Œéƒ½ä¼šå°† API æ–‡æ¡£å‘å¸ƒå‡ºæ¥ï¼Œå¯ä»¥é€šè¿‡ &lt;a href="https://docs.docker.com/engine/api/v1.41/">Docker Engine API åœ¨çº¿æµè§ˆ&lt;/a>ï¼Œä¹Ÿå¯ä»¥è‡ªè¡Œæ„å»º API æ–‡æ¡£ã€‚&lt;/p>
&lt;p>é¦–å…ˆ clone Docker çš„æºä»£ç ä»“åº“, è¿›å…¥é¡¹ç›®ä»“åº“å†…æ‰§è¡Œ &lt;code>make swagger-docs&lt;/code> å³å¯åœ¨å¯åŠ¨ä¸€ä¸ªå®¹å™¨åŒæ—¶å°†ç«¯å£æš´éœ²è‡³æœ¬åœ°çš„ &lt;code>9000&lt;/code> ç«¯å£ï¼Œ ä½ å¯ä»¥ç›´æ¥é€šè¿‡ &lt;a href="http://127.0.0.1:9000">http://127.0.0.1:9000&lt;/a> è®¿é—®æœ¬åœ°çš„ API æ–‡æ¡£ã€‚&lt;/p>
&lt;pre>&lt;code>(MoeLove) âœ git clone https://github.com/docker/docker.git docker
(MoeLove) âœ cd docker
(MoeLove) âœ docker git:(master) git checkout -b v20.10.5 v20.10.5
(MoeLove) âœ docker git:(v20.10.5) make swagger-docs
API docs preview will be running at http://localhost:9000
&lt;/code>&lt;/pre>&lt;p>æ‰“å¼€ &lt;a href="http://127.0.0.1:9000/#operation/ImageBuild">http://127.0.0.1:9000/#operation/ImageBuild&lt;/a> è¿™ä¸ªåœ°å€å°±å¯ä»¥çœ‹åˆ° 1.41 ç‰ˆæœ¬çš„æ„å»ºé•œåƒæ‰€éœ€çš„ API äº†ã€‚æˆ‘ä»¬å¯¹æ­¤ API è¿›è¡Œä¸‹åˆ†æã€‚&lt;/p>
&lt;h3 id="è¯·æ±‚åœ°å€å’Œæ–¹æ³•">è¯·æ±‚åœ°å€å’Œæ–¹æ³•&lt;/h3>
&lt;p>æ¥å£åœ°å€æ˜¯ &lt;code>/v1.41/build&lt;/code> æ–¹æ³•æ˜¯ &lt;code>POST&lt;/code> ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªè¾ƒæ–°ç‰ˆæœ¬çš„ &lt;code>curl&lt;/code> å·¥å…·æ¥éªŒè¯ä¸‹æ­¤æ¥å£ï¼ˆéœ€è¦ä½¿ç”¨ &lt;code>--unix-socket&lt;/code> è¿æ¥ Docker ç›‘å¬çš„ UNIX Domain Socket ï¼‰ã€‚&lt;code>dockerd&lt;/code> é»˜è®¤æƒ…å†µä¸‹ç›‘å¬åœ¨ &lt;code>/var/run/docker.sock&lt;/code> ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥ç»™ &lt;code>dockerd&lt;/code> ä¼ é€’ &lt;code>--host&lt;/code> å‚æ•°ç”¨äºç›‘å¬ HTTP ç«¯å£æˆ–è€…å…¶ä»–è·¯å¾„çš„ unix socket .&lt;/p>
&lt;pre>&lt;code>/ # curl -X POST --unix-socket /var/run/docker.sock localhost/v1.41/build
{&amp;quot;message&amp;quot;:&amp;quot;Cannot locate specified Dockerfile: Dockerfile&amp;quot;}
&lt;/code>&lt;/pre>&lt;p>ä»ä¸Šé¢çš„è¾“å‡ºæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬ç¡®å®è®¿é—®åˆ°äº†è¯¥æ¥å£ï¼ŒåŒæ—¶è¯¥æ¥å£çš„å“åº”æ˜¯æç¤ºéœ€è¦ &lt;code>Dockerfile&lt;/code> .&lt;/p>
&lt;h3 id="è¯·æ±‚ä½“">è¯·æ±‚ä½“&lt;/h3>
&lt;blockquote>
&lt;p>A tar archive compressed with one of the following algorithms: identity (no compression), gzip, bzip2, xz.
string &lt;binary>&lt;/p>
&lt;/blockquote>
&lt;p>è¯·æ±‚ä½“æ˜¯ä¸€ä¸ª &lt;code>tar&lt;/code> å½’æ¡£æ–‡ä»¶ï¼Œå¯é€‰æ‹©æ— å‹ç¼©ã€&lt;code>gzip&lt;/code>ã€&lt;code>bzip2&lt;/code>ã€&lt;code>xz&lt;/code> å‹ç¼©ç­‰å½¢å¼ã€‚å…³äºè¿™å‡ ç§å‹ç¼©æ ¼å¼å°±ä¸å†å±•å¼€ä»‹ç»äº†ï¼Œä½†å€¼å¾—æ³¨æ„çš„æ˜¯ &lt;strong>å¦‚æœä½¿ç”¨äº†å‹ç¼©ï¼Œåˆ™ä¼ è¾“ä½“ç§¯ä¼šå˜å°ï¼Œå³ç½‘ç»œæ¶ˆè€—ä¼šç›¸åº”å‡å°‘ã€‚ä½†å‹ç¼©/è§£å‹ç¼©éœ€è¦è€—è´¹ CPU ç­‰è®¡ç®—èµ„æº&lt;/strong> è¿™åœ¨æˆ‘ä»¬å¯¹å¤§è§„æ¨¡é•œåƒæ„å»ºåšä¼˜åŒ–æ—¶æ˜¯ä¸ªå€¼å¾—æƒè¡¡çš„ç‚¹ã€‚&lt;/p>
&lt;h3 id="è¯·æ±‚å¤´">è¯·æ±‚å¤´&lt;/h3>
&lt;p>å› ä¸ºè¦å‘é€çš„æ˜¯ä¸ª &lt;code>tar&lt;/code> å½’æ¡£æ–‡ä»¶ï¼Œ&lt;code>Content-type&lt;/code> é»˜è®¤æ˜¯ &lt;code>application/x-tar&lt;/code> ã€‚å¦ä¸€ä¸ªä¼šå‘é€çš„å¤´æ˜¯ &lt;code>X-Registry-Config&lt;/code>ï¼Œè¿™æ˜¯ä¸€ä¸ªç”± Base64 ç¼–ç åçš„ Docker Registry çš„é…ç½®ä¿¡æ¯ï¼Œå†…å®¹ä¸ &lt;code>$HOME/.docker/config.json&lt;/code> ä¸­çš„ &lt;code>auths&lt;/code> å†…çš„ä¿¡æ¯ä¸€è‡´ã€‚&lt;/p>
&lt;p>è¿™äº›é…ç½®ä¿¡æ¯ï¼Œåœ¨ä½ æ‰§è¡Œ &lt;code>docker login&lt;/code> åä¼šè‡ªåŠ¨å†™å…¥åˆ° &lt;code>$HOME/.docker/config.json&lt;/code> æ–‡ä»¶å†…çš„ã€‚è¿™äº›ä¿¡æ¯è¢«ä¼ è¾“åˆ° &lt;code>dockerd&lt;/code> åœ¨æ„å»ºè¿‡ç¨‹ä¸­ä½œä¸ºæ‹‰å–é•œåƒçš„è®¤è¯ä¿¡æ¯ä½¿ç”¨ã€‚&lt;/p>
&lt;h3 id="è¯·æ±‚å‚æ•°">è¯·æ±‚å‚æ•°&lt;/h3>
&lt;p>æœ€åå°±æ˜¯è¯·æ±‚å‚æ•°äº†ï¼Œå‚æ•°æœ‰å¾ˆå¤šï¼Œé€šè¿‡ &lt;code>docker build --help&lt;/code> åŸºæœ¬éƒ½å¯ä»¥çœ‹åˆ°å¯¹åº”å«ä¹‰çš„ï¼Œè¿™é‡Œä¸å†ä¸€ä¸€å±•å¼€äº†ï¼Œåé¢ä¼šæœ‰ä¸€äº›å…³é”®å‚æ•°çš„ä»‹ç»ã€‚&lt;/p>
&lt;h3 id="å°ç»“">å°ç»“&lt;/h3>
&lt;p>ä¸Šé¢æˆ‘ä»¬ä»‹ç»äº† &lt;code>Docker&lt;/code> æ„å»ºé•œåƒç›¸å…³çš„ APIï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥è®¿é—®&lt;a href="https://docs.docker.com/engine/api/v1.41/">Docker Engine çš„ API æ–‡æ¡£&lt;/a>ã€‚æˆ–è€…é€šè¿‡æºç ä»“åº“ï¼Œè‡ªå·±æ¥æ„å»ºä¸€ä¸ªæœ¬åœ°çš„ API æ–‡æ¡£æœåŠ¡ï¼Œä½¿ç”¨æµè§ˆå™¨è¿›è¡Œè®¿é—®ã€‚&lt;/p>
&lt;p>é€šè¿‡ API æˆ‘ä»¬ä¹ŸçŸ¥é“äº†è¯¥æ¥å£æ‰€éœ€çš„è¯·æ±‚ä½“æ˜¯ä¸€ä¸ª &lt;code>tar&lt;/code> å½’æ¡£æ–‡ä»¶ï¼ˆå¯é€‰æ‹©å‹ç¼©ç®—æ³•è¿›è¡Œå‹ç¼©ï¼‰ï¼ŒåŒæ—¶å®ƒçš„è¯·æ±‚å¤´ä¸­ä¼šæºå¸¦ç”¨æˆ·åœ¨é•œåƒä»“åº“ä¸­çš„è®¤è¯ä¿¡æ¯ã€‚è¿™æé†’æˆ‘ä»¬ï¼Œ &lt;strong>å¦‚æœåœ¨ä½¿ç”¨è¿œç¨‹ &lt;code>Dockerd&lt;/code> æ„å»ºæ—¶ï¼Œè¯·æ³¨æ„å®‰å…¨ï¼Œå°½é‡ä½¿ç”¨ &lt;code>tls&lt;/code> è¿›è¡ŒåŠ å¯†ï¼Œä»¥å…æ•°æ®æ³„æ¼ã€‚&lt;/strong>&lt;/p>
&lt;h2 id="cli">CLI&lt;/h2>
&lt;p>API å·²ç»ä»‹ç»å®Œäº†ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹ &lt;code>docker&lt;/code> CLIï¼Œæˆ‘ä»¥å‰çš„æ–‡ç« ä¸­ä»‹ç»è¿‡ç°åœ¨ Docker ä¸­æœ‰ä¸¤ä¸ªæ„å»ºç³»ç»Ÿï¼Œä¸€ä¸ªæ˜¯ v1 ç‰ˆæœ¬çš„ &lt;code>builder&lt;/code> å¦ä¸€ä¸ªæ˜¯ v2 ç‰ˆæœ¬çš„å³ &lt;code>BuildKit&lt;/code> æˆ‘ä»¬æ¥åˆ†åˆ«æ·±å…¥æºç æ¥çœ‹çœ‹åœ¨æ„å»ºé•œåƒæ—¶ï¼Œä»–ä»¬å„è‡ªçš„è¡Œä¸ºå§ã€‚&lt;/p>
&lt;h3 id="å‡†å¤‡ä»£ç ">å‡†å¤‡ä»£ç &lt;/h3>
&lt;p>CLI çš„ä»£ç ä»“åº“åœ¨ &lt;a href="https://github.com/docker/cli">https://github.com/docker/cli&lt;/a> æœ¬æ–‡çš„ä»£ç ä»¥ &lt;code>v20.10.5&lt;/code> ä¸ºå‡†ã€‚&lt;/p>
&lt;p>é€šè¿‡ä»¥ä¸‹æ­¥éª¤ä½¿ç”¨æ­¤ç‰ˆæœ¬çš„ä»£ç ï¼š&lt;/p>
&lt;pre>&lt;code>(MoeLove) âœ git clone https://github.com/docker/cli.git
(MoeLove) âœ cd cli
(MoeLove) âœ cli git:(master) git checkout -b v20.10.5 v20.10.5
&lt;/code>&lt;/pre>&lt;h3 id="é€æ­¥åˆ†è§£">é€æ­¥åˆ†è§£&lt;/h3>
&lt;p>&lt;code>docker&lt;/code> æ˜¯æˆ‘ä»¬æ‰€ä½¿ç”¨çš„å®¢æˆ·ç«¯å·¥å…·ï¼Œç”¨äºä¸ &lt;code>dockerd&lt;/code> è¿›è¡Œäº¤äº’ã€‚å…³äºæ„å»ºç›¸å…³çš„éƒ¨åˆ†ï¼Œ æˆ‘ä»¬æ‰€ç†ŸçŸ¥çš„ä¾¿æ˜¯ &lt;code>docker build&lt;/code> æˆ–è€…æ˜¯ &lt;code>docker image build&lt;/code>ï¼Œåœ¨ 19.03 ä¸­æ–°å¢çš„æ˜¯ &lt;code>docker builder build&lt;/code> ï¼Œä½†å…¶å®ä»–ä»¬éƒ½æ˜¯åŒä¸€ä¸ªåªæ˜¯åšäº†ä¸ª alias ç½¢äº†ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="c1">// cmd/docker/docker.go#L237
&lt;/span>&lt;span class="c1">&lt;/span>&lt;span class="k">if&lt;/span> &lt;span class="nx">v&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">ok&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">aliasMap&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s">&amp;#34;builder&amp;#34;&lt;/span>&lt;span class="p">];&lt;/span> &lt;span class="nx">ok&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">aliases&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nb">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">aliases&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="p">[&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">][]&lt;/span>&lt;span class="kt">string&lt;/span>&lt;span class="p">{{&lt;/span>&lt;span class="s">&amp;#34;build&amp;#34;&lt;/span>&lt;span class="p">},&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="nx">v&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;build&amp;#34;&lt;/span>&lt;span class="p">}},&lt;/span>
&lt;span class="p">[&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">][]&lt;/span>&lt;span class="kt">string&lt;/span>&lt;span class="p">{{&lt;/span>&lt;span class="s">&amp;#34;image&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;build&amp;#34;&lt;/span>&lt;span class="p">},&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="nx">v&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;build&amp;#34;&lt;/span>&lt;span class="p">}},&lt;/span>
&lt;span class="p">)&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>çœŸæ­£çš„å…¥å£å‡½æ•°å…¶å®åœ¨ &lt;code>cli/command/image/build.go&lt;/code>ï¼›åŒºåˆ†å¦‚ä½•è°ƒç”¨çš„é€»è¾‘å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="kd">func&lt;/span> &lt;span class="nf">runBuild&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">dockerCli&lt;/span> &lt;span class="nx">command&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Cli&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">options&lt;/span> &lt;span class="nx">buildOptions&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="kt">error&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">buildkitEnabled&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">command&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">BuildKitEnabled&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">dockerCli&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">ServerInfo&lt;/span>&lt;span class="p">())&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="nx">err&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">buildkitEnabled&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="nf">runBuildBuildKit&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">dockerCli&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">options&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="c1">// çœç•¥æ‰äº†å¯¹äº builder çš„å®é™…é€»è¾‘
&lt;/span>&lt;span class="c1">&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™é‡Œå°±æ˜¯åˆ¤æ–­ä¸‹æ˜¯å¦æ”¯æŒ &lt;code>buildkit&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="c1">// cli/command/cli.go#L176
&lt;/span>&lt;span class="c1">&lt;/span>&lt;span class="kd">func&lt;/span> &lt;span class="nf">BuildKitEnabled&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">si&lt;/span> &lt;span class="nx">ServerInfo&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="kt">bool&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kt">error&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">buildkitEnabled&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">si&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">BuildkitVersion&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="nx">types&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">BuilderBuildKit&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">buildkitEnv&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">os&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Getenv&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;DOCKER_BUILDKIT&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span> &lt;span class="nx">buildkitEnv&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="s">&amp;#34;&amp;#34;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="kd">var&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="kt">error&lt;/span>
&lt;span class="nx">buildkitEnabled&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">strconv&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">ParseBool&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">buildkitEnv&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="kc">false&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">errors&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Wrap&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">err&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;DOCKER_BUILDKIT environment variable expects boolean value&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="nx">buildkitEnabled&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kc">nil&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>å½“ç„¶ï¼Œä»è¿™é‡Œå¯ä»¥å¾—åˆ°ä¸¤ä¸ªä¿¡æ¯ï¼š&lt;/p>
&lt;ul>
&lt;li>é€šè¿‡ &lt;code>dockerd&lt;/code> çš„é…ç½®å¯å¼€å¯ &lt;code>buildkit&lt;/code> ã€‚åœ¨ &lt;code>/etc/docker/daemon.json&lt;/code> ä¸­æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼Œå¹¶é‡å¯ &lt;code>dockerd&lt;/code> å³å¯ï¼š&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-json" data-lang="json">&lt;span class="p">{&lt;/span>
&lt;span class="nt">&amp;#34;features&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nt">&amp;#34;buildkit&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">true&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>åœ¨ &lt;code>docker&lt;/code> CLI ä¸Šä¹Ÿå¯å¼€å¯ &lt;code>buildkit&lt;/code> çš„æ”¯æŒï¼Œå¹¶ä¸” CLI çš„é…ç½®å¯è¦†ç›–æœåŠ¡ç«¯é…ç½®ã€‚é€šè¿‡ &lt;code>export DOCKER_BUILDKIT=1&lt;/code> å³å¯å¼€å¯ &lt;code>buildkit&lt;/code> çš„æ”¯æŒï¼Œè®¾ç½®ä¸º 0 åˆ™å…³é—­ï¼ˆ0/false/f/F ä¹‹ç±»çš„ä¹Ÿéƒ½æ˜¯ç›¸åŒçš„ç»“æœï¼‰&lt;/li>
&lt;/ul>
&lt;p>ä»ä¸Šé¢çš„ä»‹ç»ä¹Ÿçœ‹åˆ°äº†ï¼Œå¯¹äºåŸæœ¬é»˜è®¤çš„ builder è€Œè¨€ï¼Œ å…¥å£é€»è¾‘åœ¨ &lt;code>runBuild&lt;/code> ä¸­ï¼Œ è€Œå¯¹äºä½¿ç”¨ buildkit çš„åˆ™æ˜¯ &lt;code>runBuildBuildKit&lt;/code> æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¯¹ä¸¤è€…è¿›è¡Œé€æ­¥åˆ†è§£ã€‚&lt;/p>
&lt;h3 id="builder-v1">builder v1&lt;/h3>
&lt;p>åœ¨ &lt;code>runBuild&lt;/code> å‡½æ•°ä¸­ï¼Œå¤§è‡´ç»å†äº†ä»¥ä¸‹é˜¶æ®µï¼š&lt;/p>
&lt;h4 id="å‚æ•°å¤„ç†">å‚æ•°å¤„ç†&lt;/h4>
&lt;p>æœ€å¼€å§‹çš„éƒ¨åˆ†æ˜¯ä¸€äº›å¯¹å‚æ•°çš„å¤„ç†å’Œæ ¡éªŒã€‚&lt;/p>
&lt;ul>
&lt;li>&lt;strong>&lt;code>stream&lt;/code> å’Œ &lt;code>compress&lt;/code> ä¸å¯åŒæ—¶ä½¿ç”¨ã€‚&lt;/strong>&lt;/li>
&lt;/ul>
&lt;p>å› ä¸ºå¦‚æœæˆ‘ä»¬æŒ‡å®šäº† &lt;code>compress&lt;/code> çš„è¯ï¼Œåˆ™ CLI ä¼šä½¿ç”¨ &lt;code>gzip&lt;/code> å°†æ„å»ºä¸Šä¸‹æ–‡è¿›è¡Œå‹ç¼©ï¼Œè¿™æ ·ä¹Ÿå°±æ²¡æ³•å¾ˆå¥½çš„é€šè¿‡ &lt;code>stream&lt;/code> çš„æ¨¡å¼æ¥å¤„ç†æ„å»ºçš„ä¸Šä¸‹æ–‡äº†ã€‚&lt;/p>
&lt;p>å½“ç„¶ä½ ä¹Ÿå¯èƒ½ä¼šæƒ³ï¼Œä»æŠ€æœ¯ä¸Šæ¥è®²ï¼Œå‹ç¼©å’Œæµå¼æ²¡æœ‰ä»€ä¹ˆå¿…ç„¶çš„å†²çªï¼Œæ˜¯å¯å®ç°çš„ã€‚äº‹å®çš„ç¡®å¦‚æ­¤ï¼Œå¦‚æœä»æŠ€æœ¯çš„è§’åº¦ä¸Šæ¥è®²ä¸¤è€…å¹¶éå®Œå…¨ä¸èƒ½ä¸€èµ·å­˜åœ¨ï¼Œæ— éå°±æ˜¯å¢åŠ è§£å‹ç¼©çš„åŠ¨ä½œã€‚ä½†æ˜¯å½“å¼€å¯ &lt;code>stream&lt;/code> æ¨¡å¼ï¼Œå¯¹æ¯ä¸ªæ–‡ä»¶éƒ½è¿›è¡Œå‹ç¼©å’Œè§£å‹çš„æ“ä½œé‚£å°†ä¼šæ˜¯å¾ˆå¤§çš„èµ„æºæµªè´¹ï¼ŒåŒæ—¶ä¹Ÿå¢åŠ äº†å…¶å¤æ‚åº¦ï¼Œæ‰€ä»¥åœ¨ CLI ä¸­ä¾¿ç›´æ¥è¿›è¡Œäº†é™åˆ¶ï¼Œä¸å…è®¸åŒæ—¶ä½¿ç”¨ &lt;code>compress&lt;/code> å’Œ &lt;code>stream&lt;/code>&lt;/p>
&lt;ul>
&lt;li>&lt;strong>ä¸å¯åŒæ—¶ä½¿ç”¨ &lt;code>stdin&lt;/code> è¯»å– &lt;code>Dockerfile&lt;/code> å’Œ &lt;code>build context&lt;/code>ã€‚&lt;/strong>&lt;/li>
&lt;/ul>
&lt;p>åœ¨è¿›è¡Œæ„å»ºæ—¶ï¼Œå¦‚æœæˆ‘ä»¬å°† &lt;code>Dockerfile&lt;/code> çš„åå­—ä¼ é€’ä¸º &lt;code>-&lt;/code> æ—¶ï¼Œè¡¨ç¤ºä» &lt;code>stdin&lt;/code> è¯»å–å…¶å†…å®¹ã€‚&lt;/p>
&lt;p>ä¾‹å¦‚ï¼ŒæŸä¸ªç›®å½•ä¸‹æœ‰ä¸‰ä¸ªæ–‡ä»¶ &lt;code>foo&lt;/code> &lt;code>bar&lt;/code> å’Œ &lt;code>Dockerfile&lt;/code>ï¼Œé€šè¿‡ç®¡é“å°† &lt;code>Dockerfile&lt;/code> çš„å†…å®¹é€šè¿‡ &lt;code>stdin&lt;/code> ä¼ é€’ç»™ &lt;code>docker build&lt;/code>&lt;/p>
&lt;pre>&lt;code>(MoeLove) âœ x ls
bar Dockerfile foo
(MoeLove) âœ x cat Dockerfile | DOCKER_BUILDKIT=0 docker build -f - .
Sending build context to Docker daemon 15.41kB
Step 1/3 : FROM scratch
---&amp;gt;
Step 2/3 : COPY foo foo
---&amp;gt; a2af45d66bb5
Step 3/3 : COPY bar bar
---&amp;gt; cc803c675dd2
Successfully built cc803c675dd2
&lt;/code>&lt;/pre>&lt;p>å¯ä»¥çœ‹åˆ°é€šè¿‡ &lt;code>stdin&lt;/code> ä¼ é€’ &lt;code>Dockerfile&lt;/code> çš„æ–¹å¼èƒ½æˆåŠŸçš„æ„å»ºé•œåƒã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å°è¯•é€šè¿‡ &lt;code>stdin&lt;/code> å°† &lt;code>build context&lt;/code> ä¼ é€’è¿›å»ã€‚&lt;/p>
&lt;pre>&lt;code>(MoeLove) âœ x tar -cvf x.tar foo bar Dockerfile
foo
bar
Dockerfile
(MoeLove) âœ x cat x.tar| DOCKER_BUILDKIT=0 docker build -f Dockerfile -
Sending build context to Docker daemon 10.24kB
Step 1/3 : FROM scratch
---&amp;gt;
Step 2/3 : COPY foo foo
---&amp;gt; 09319712e220
Step 3/3 : COPY bar bar
---&amp;gt; ce88644a7395
Successfully built ce88644a7395
&lt;/code>&lt;/pre>&lt;p>å¯ä»¥çœ‹åˆ°é€šè¿‡ &lt;code>stdin&lt;/code> ä¼ é€’ &lt;code>build context&lt;/code> çš„æ–¹å¼ä¹Ÿå¯ä»¥æˆåŠŸæ„å»ºé•œåƒã€‚&lt;/p>
&lt;p>ä½†å¦‚æœ &lt;code>Dockerfile&lt;/code> çš„åç§°ä¸æ„å»ºçš„ä¸Šä¸‹æ–‡éƒ½æŒ‡å®šä¸º &lt;code>-&lt;/code> å³ &lt;code>docker build -f - -&lt;/code> æ—¶ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿ&lt;/p>
&lt;pre>&lt;code>(MoeLove) âœ x DOCKER_BUILDKIT=0 docker build -f - -
invalid argument: can't use stdin for both build context and dockerfile
&lt;/code>&lt;/pre>&lt;p>å°±ä¼šæŠ¥é”™äº†ã€‚æ‰€ä»¥ï¼Œ &lt;strong>ä¸èƒ½åŒæ—¶ä½¿ç”¨ &lt;code>stdin&lt;/code> è¯»å– &lt;code>Dockerfile&lt;/code> å’Œ &lt;code>build context&lt;/code>&lt;/strong> ã€‚&lt;/p>
&lt;ul>
&lt;li>&lt;strong>&lt;code>build context&lt;/code> æ”¯æŒå››ç§è¡Œä¸ºã€‚&lt;/strong>&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="k">switch&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">case&lt;/span> &lt;span class="nx">options&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">contextFromStdin&lt;/span>&lt;span class="p">():&lt;/span>
&lt;span class="c1">// çœç•¥
&lt;/span>&lt;span class="c1">&lt;/span>&lt;span class="k">case&lt;/span> &lt;span class="nf">isLocalDir&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">specifiedContext&lt;/span>&lt;span class="p">):&lt;/span>
&lt;span class="c1">// çœç•¥
&lt;/span>&lt;span class="c1">&lt;/span>&lt;span class="k">case&lt;/span> &lt;span class="nx">urlutil&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">IsGitURL&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">specifiedContext&lt;/span>&lt;span class="p">):&lt;/span>
&lt;span class="c1">// çœç•¥
&lt;/span>&lt;span class="c1">&lt;/span>&lt;span class="k">case&lt;/span> &lt;span class="nx">urlutil&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">IsURL&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">specifiedContext&lt;/span>&lt;span class="p">):&lt;/span>
&lt;span class="c1">// çœç•¥
&lt;/span>&lt;span class="c1">&lt;/span>&lt;span class="k">default&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="nx">errors&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Errorf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;unable to prepare context: path %q not found&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">specifiedContext&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä» &lt;code>stdin&lt;/code> ä¼ å…¥ï¼Œä¸Šæ–‡å·²ç»æ¼”ç¤ºè¿‡äº†ï¼Œä¼ é€’ç»™ &lt;code>stdin&lt;/code> çš„æ˜¯ &lt;code>tar&lt;/code> å½’æ¡£æ–‡ä»¶ã€‚å½“ç„¶ä¹Ÿå¯ä»¥æ˜¯æŒ‡å®šä¸€ä¸ªå…·ä½“çš„ &lt;code>PATH&lt;/code>ï¼Œæˆ‘ä»¬é€šå¸¸ä½¿ç”¨çš„ &lt;code>docker build .&lt;/code> ä¾¿æ˜¯è¿™ç§ç”¨æ³•ï¼›&lt;/p>
&lt;p>æˆ–è€…å¯ä»¥æŒ‡å®šä¸€ä¸ª &lt;code>git&lt;/code> ä»“åº“çš„åœ°å€ï¼ŒCLI ä¼šè°ƒç”¨ &lt;code>git&lt;/code> å‘½ä»¤å°†ä»“åº“ &lt;code>clone&lt;/code> è‡³ä¸€ä¸ªä¸´æ—¶ç›®å½•ï¼Œè¿›è¡Œä½¿ç”¨ï¼›&lt;/p>
&lt;p>æœ€åä¸€ç§æ˜¯ï¼Œç»™å®šä¸€ä¸ª &lt;code>URL&lt;/code> åœ°å€ï¼Œè¯¥åœ°å€å¯ä»¥æ˜¯ &lt;strong>ä¸€ä¸ªå…·ä½“çš„ Dockerfile æ–‡ä»¶åœ°å€&lt;/strong> æˆ–è€…æ˜¯ &lt;strong>ä¸€ä¸ª &lt;code>tar&lt;/code> å½’æ¡£æ–‡ä»¶çš„ä¸‹è½½åœ°å€&lt;/strong> ã€‚&lt;/p>
&lt;p>è¿™å‡ ç§åŸºæœ¬å°±æ˜¯å­—é¢ä¸Šçš„åŒºåˆ«ï¼Œè‡³äº CLI çš„è¡Œä¸ºå·®å¼‚ï¼Œä¸»è¦æ˜¯æœ€åä¸€ç§ï¼Œå½“ &lt;code>URL&lt;/code> åœ°å€æ˜¯ä¸€ä¸ªå…·ä½“çš„ &lt;code>Dockerfile&lt;/code> æ–‡ä»¶åœ°å€ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ &lt;code>build context&lt;/code> ç›¸å½“äºåªæœ‰ &lt;code>Dockerfile&lt;/code> è‡ªèº«ï¼Œæ‰€ä»¥å¹¶ä¸èƒ½ä½¿ç”¨ &lt;code>COPY&lt;/code> ä¹‹ç±»çš„æŒ‡å®šï¼Œè‡³äº &lt;code>ADD&lt;/code> ä¹Ÿåªèƒ½ä½¿ç”¨å¯è®¿é—®çš„å¤–éƒ¨åœ°å€ã€‚&lt;/p>
&lt;ul>
&lt;li>&lt;strong>å¯ä½¿ç”¨ &lt;code>.dockerignore&lt;/code> å¿½ç•¥ä¸éœ€è¦çš„æ–‡ä»¶&lt;/strong>&lt;/li>
&lt;/ul>
&lt;p>æˆ‘åœ¨ä¹‹å‰çš„æ–‡ç« ä¸­æœ‰åˆ†äº«è¿‡ç›¸å…³çš„å†…å®¹ã€‚è¿™é‡Œæˆ‘ä»¬çœ‹çœ‹å®ƒçš„å®ç°é€»è¾‘ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="c1">// cli/command/image/build/dockerignore.go#L13
&lt;/span>&lt;span class="c1">&lt;/span>&lt;span class="kd">func&lt;/span> &lt;span class="nf">ReadDockerignore&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">contextDir&lt;/span> &lt;span class="kt">string&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">([]&lt;/span>&lt;span class="kt">string&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kt">error&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="kd">var&lt;/span> &lt;span class="nx">excludes&lt;/span> &lt;span class="p">[]&lt;/span>&lt;span class="kt">string&lt;/span>
&lt;span class="nx">f&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">os&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Open&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">filepath&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Join&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">contextDir&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;.dockerignore&amp;#34;&lt;/span>&lt;span class="p">))&lt;/span>
&lt;span class="k">switch&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">case&lt;/span> &lt;span class="nx">os&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">IsNotExist&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">err&lt;/span>&lt;span class="p">):&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="nx">excludes&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kc">nil&lt;/span>
&lt;span class="k">case&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="kc">nil&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="k">defer&lt;/span> &lt;span class="nx">f&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Close&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="nx">dockerignore&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">ReadAll&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">f&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>
&lt;p>&lt;code>.dockerignore&lt;/code> æ˜¯ä¸€ä¸ªå›ºå®šçš„æ–‡ä»¶åï¼Œå¹¶ä¸”éœ€è¦æ”¾åœ¨ &lt;code>build context&lt;/code> çš„æ ¹ç›®å½•ä¸‹ã€‚ç±»ä¼¼å‰é¢æåˆ°çš„ï¼Œä½¿ç”¨ä¸€ä¸ª &lt;code>Dockerfile&lt;/code> æ–‡ä»¶çš„ URL åœ°å€ä½œä¸º &lt;code>build context&lt;/code> ä¼ å…¥çš„æ–¹å¼ï¼Œä¾¿æ— æ³•ä½¿ç”¨ &lt;code>.dockerignore&lt;/code> ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>.dockerignore&lt;/code> æ–‡ä»¶å¯ä»¥ä¸å­˜åœ¨ï¼Œä½†åœ¨è¯»å–çš„æ—¶å€™å¦‚æœé‡åˆ°é”™è¯¯ï¼Œä¾¿ä¼šæŠ›å‡ºé”™è¯¯ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>é€šè¿‡ &lt;code>.dockerignore&lt;/code> å°†ä¼šè¿‡æ»¤æ‰ä¸å¸Œæœ›åŠ å…¥åˆ°é•œåƒå†…ï¼Œæˆ–è€…è¿‡æ»¤æ‰ä¸é•œåƒæ— å…³çš„å†…å®¹ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>æœ€å CLI ä¼šå°† &lt;code>build context&lt;/code> ä¸­çš„å†…å®¹ç»è¿‡ &lt;code>.dockerignore&lt;/code> è¿‡æ»¤åï¼Œæ‰“åŒ…æˆä¸ºçœŸæ­£çš„ &lt;code>build context&lt;/code> å³çœŸæ­£çš„æ„å»ºä¸Šä¸‹æ–‡ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæœ‰æ—¶å€™ä½ å‘ç°è‡ªå·±æ˜æ˜åœ¨ &lt;code>Dockerfile&lt;/code> é‡Œé¢å†™äº† &lt;code>COPY xx xx&lt;/code> ä½†æ˜¯æœ€åæ²¡æœ‰å‘ç°è¯¥æ–‡ä»¶çš„æƒ…å†µã€‚ å¾ˆå¯èƒ½å°±æ˜¯è¢« &lt;code>.dockerignore&lt;/code> ç»™å¿½ç•¥æ‰äº†ã€‚ &lt;strong>è¿™æ ·æœ‰åˆ©äºä¼˜åŒ– CLI ä¸ &lt;code>dockerd&lt;/code> ä¹‹é—´çš„ä¼ è¾“å‹åŠ›ä¹‹ç±»çš„ã€‚&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>&lt;code>docker&lt;/code> CLI è¿˜ä¼šå»è¯»å– &lt;code>~/.docker/config.json&lt;/code> ä¸­çš„å†…å®¹ã€‚&lt;/li>
&lt;/ul>
&lt;p>è¿™ä¸å‰é¢ API éƒ¨åˆ†æ‰€æè¿°çš„å†…å®¹åŸºæœ¬æ˜¯ä¸€è‡´çš„ã€‚å°†è®¤è¯ä¿¡æ¯é€šè¿‡ &lt;code>X-Registry-Config&lt;/code> å¤´ä¼ é€’ç»™ &lt;code>dockerd&lt;/code> ç”¨äºåœ¨éœ€è¦æ‹‰å–é•œåƒæ—¶è¿›è¡Œèº«ä»½æ ¡éªŒã€‚&lt;/p>
&lt;ul>
&lt;li>&lt;strong>è°ƒç”¨ API è¿›è¡Œå®é™…æ„å»ºä»»åŠ¡&lt;/strong>&lt;/li>
&lt;/ul>
&lt;p>å½“ä¸€åˆ‡æ‰€éœ€çš„æ ¡éªŒå’Œä¿¡æ¯éƒ½å‡†å¤‡å°±ç»ªä¹‹åï¼Œåˆ™å¼€å§‹è°ƒç”¨ &lt;code>dockerCli.Client&lt;/code> å°è£…çš„ API æ¥å£ï¼Œå°†è¯·æ±‚å‘é€è‡³ &lt;code>dockerd&lt;/code>ï¼Œè¿›è¡Œå®é™…çš„æ„å»ºä»»åŠ¡ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="nx">response&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">dockerCli&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Client&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="nf">ImageBuild&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">ctx&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">body&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">buildOptions&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">options&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">quiet&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Fprintf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">dockerCli&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Err&lt;/span>&lt;span class="p">(),&lt;/span> &lt;span class="s">&amp;#34;%s&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">progBuff&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="nf">cancel&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="nx">err&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="k">defer&lt;/span> &lt;span class="nx">response&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Body&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Close&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>åˆ°è¿™é‡Œå…¶å®ä¸€æ¬¡æ„å»ºçš„è¿‡ç¨‹ä¸­ CLI æ‰€å¤„ç†çš„æµç¨‹å°±åŸºæœ¬ç»“æŸäº†ï¼Œä¹‹åä¾¿æ˜¯æŒ‰ç…§ä¼ é€’çš„å‚æ•°è¿›è¡Œè¿›åº¦çš„è¾“å‡ºæˆ–æ˜¯å°†é•œåƒ ID å†™å…¥åˆ°æ–‡ä»¶ä¹‹ç±»çš„ã€‚ è¿™éƒ¨åˆ†å°±ä¸è¿›è¡Œå±•å¼€äº†ã€‚&lt;/p>
&lt;h4 id="å°ç»“-1">å°ç»“&lt;/h4>
&lt;p>æ•´ä¸ªè¿‡ç¨‹å¤§è‡´å¦‚ä¸‹å›¾ï¼š&lt;/p>
&lt;p>&lt;img src="https://images.gitbook.cn/6a69dde0-933a-11e9-8825-e7da71af5ddb" alt="docker builder å¤„ç†æµç¨‹">&lt;/p>
&lt;p>ä»å…¥å£å‡½æ•° &lt;code>runBuild&lt;/code> å¼€å§‹ï¼Œç»è¿‡åˆ¤æ–­æ˜¯å¦æ”¯æŒ &lt;code>buildkit&lt;/code> ï¼Œå¦‚æœä¸æ”¯æŒ &lt;code>buildkit&lt;/code> åˆ™ç»§ç»­ä½¿ç”¨ v1 çš„ &lt;code>builder&lt;/code>ã€‚æ¥ä¸‹æ¥è¯»å–å„ç±»å‚æ•°ï¼ŒæŒ‰ç…§ä¸åŒçš„å‚æ•°æ‰§è¡Œå„ç±»ä¸åŒçš„å¤„ç†é€»è¾‘ã€‚è¿™é‡Œéœ€è¦æ³¨æ„çš„å°±æ˜¯ &lt;code>Dockerfile&lt;/code> åŠ &lt;code>build context&lt;/code> éƒ½å¯æ”¯æŒä»æ–‡ä»¶æˆ–è€… &lt;code>stdin&lt;/code> ç­‰è¯»å…¥ï¼Œå…·ä½“ä½¿ç”¨æ—¶ï¼Œéœ€è¦æ³¨æ„ã€‚å¦å¤– &lt;code>.dockerignore&lt;/code> æ–‡ä»¶å¯è¿‡æ»¤æ‰ &lt;code>build context&lt;/code> ä¸­çš„ä¸€äº›æ–‡ä»¶ï¼Œåœ¨ä½¿ç”¨æ—¶ï¼Œå¯é€šè¿‡æ­¤æ–¹æ³•è¿›è¡Œæ„å»ºæ•ˆç‡çš„ä¼˜åŒ–ï¼Œå½“ç„¶ä¹Ÿéœ€è¦æ³¨æ„ï¼Œåœ¨é€šè¿‡ URL è·å– &lt;code>Dockerfile&lt;/code> çš„æ—¶å€™ï¼Œæ˜¯ä¸å­˜åœ¨ &lt;code>build context&lt;/code> çš„ï¼Œæ‰€ä»¥ç±»ä¼¼ &lt;code>COPY&lt;/code> è¿™æ ·çš„å‘½ä»¤ä¹Ÿå°±æ— æ³•ä½¿ç”¨äº†ã€‚å½“æ‰€æœ‰çš„ &lt;code>build context&lt;/code> å’Œå‚æ•°éƒ½å‡†å¤‡å°±ç»ªåï¼Œæ¥ä¸‹æ¥è°ƒç”¨å°è£…å¥½çš„å®¢æˆ·ç«¯ï¼Œå°†è¿™äº›è¯·æ±‚æŒ‰ç…§æœ¬æ–‡å¼€å§‹ä¹‹åˆä»‹ç»çš„ API å‘é€ç»™ &lt;code>dockerd&lt;/code> ï¼Œç”±å…¶è¿›è¡ŒçœŸæ­£çš„æ„å»ºé€»è¾‘ã€‚&lt;/p>
&lt;p>æœ€åå½“æ„å»ºç»“æŸåï¼ŒCLI æ ¹æ®å‚æ•°å†³å®šæ˜¯å¦è¦æ˜¾ç¤ºæ„å»ºè¿›åº¦æˆ–è€…ç»“æœã€‚&lt;/p>
&lt;h3 id="buildkit">buildkit&lt;/h3>
&lt;p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹çœ‹ &lt;code>buildkit&lt;/code> å¦‚ä½•æ¥æ‰§è¡Œæ„å»ºï¼Œæ–¹æ³•å…¥å£ä¸ &lt;code>builder&lt;/code> ä¸€è‡´ï¼Œä½†æ˜¯åœ¨ &lt;code>buildkitEnabled&lt;/code> å¤„ï¼Œç”±äºå¼€å¯äº† &lt;code>buildkit&lt;/code> æ”¯æŒï¼Œæ‰€ä»¥è·³è½¬åˆ°äº† &lt;code>runBuildBuildKit&lt;/code>ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="kd">func&lt;/span> &lt;span class="nf">runBuild&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">dockerCli&lt;/span> &lt;span class="nx">command&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Cli&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">options&lt;/span> &lt;span class="nx">buildOptions&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="kt">error&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">buildkitEnabled&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">command&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">BuildKitEnabled&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">dockerCli&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">ServerInfo&lt;/span>&lt;span class="p">())&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="nx">err&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">buildkitEnabled&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="nf">runBuildBuildKit&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">dockerCli&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">options&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="c1">// çœç•¥æ‰äº†å¯¹äº builder çš„å®é™…é€»è¾‘
&lt;/span>&lt;span class="c1">&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="åˆ›å»ºä¼šè¯">åˆ›å»ºä¼šè¯&lt;/h4>
&lt;p>ä½†æ˜¯ä¸ &lt;code>builder&lt;/code> ä¸åŒçš„æ˜¯ï¼Œè¿™é‡Œå…ˆæ‰§è¡Œäº†ä¸€æ¬¡ &lt;code>trySession&lt;/code> å‡½æ•°ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="c1">// cli/command/image/build_buildkit.go#L50
&lt;/span>&lt;span class="c1">&lt;/span>&lt;span class="nx">s&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nf">trySession&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">dockerCli&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">options&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">context&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kc">false&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="nx">err&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">s&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="nx">errors&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Errorf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;buildkit not supported by daemon&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™ä¸ªå‡½æ•°æ˜¯ç”¨æ¥åšä»€ä¹ˆçš„å‘¢ï¼Ÿæˆ‘ä»¬æ¥æ‰¾åˆ°è¯¥å‡½æ•°æ‰€åœ¨çš„æ–‡ä»¶ &lt;code>cli/command/image/build_session.go&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="c1">// cli/command/image/build_session.go#L29
&lt;/span>&lt;span class="c1">&lt;/span>&lt;span class="kd">func&lt;/span> &lt;span class="nf">trySession&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">dockerCli&lt;/span> &lt;span class="nx">command&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Cli&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">contextDir&lt;/span> &lt;span class="kt">string&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">forStream&lt;/span> &lt;span class="kt">bool&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="nx">session&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Session&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kt">error&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="p">!&lt;/span>&lt;span class="nf">isSessionSupported&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">dockerCli&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">forStream&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="kc">nil&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kc">nil&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="nx">sharedKey&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nf">getBuildSharedKey&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">contextDir&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="nx">s&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">session&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">NewSession&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">context&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Background&lt;/span>&lt;span class="p">(),&lt;/span> &lt;span class="nx">filepath&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Base&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">contextDir&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="nx">sharedKey&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="kc">nil&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">errors&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Wrap&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">err&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;failed to create session&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="nx">s&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kc">nil&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>å½“ç„¶è¿˜åŒ…æ‹¬å®ƒå…¶ä¸­æœ€ä¸»è¦çš„ &lt;code>isSessionSupported&lt;/code> å‡½æ•°ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="c1">// cli/command/image/build_session.go#L22
&lt;/span>&lt;span class="c1">&lt;/span>&lt;span class="kd">func&lt;/span> &lt;span class="nf">isSessionSupported&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">dockerCli&lt;/span> &lt;span class="nx">command&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Cli&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">forStream&lt;/span> &lt;span class="kt">bool&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="kt">bool&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="p">!&lt;/span>&lt;span class="nx">forStream&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="nx">versions&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">GreaterThanOrEqualTo&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">dockerCli&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Client&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="nf">ClientVersion&lt;/span>&lt;span class="p">(),&lt;/span> &lt;span class="s">&amp;#34;1.39&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="kc">true&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="nx">dockerCli&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">ServerInfo&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="nx">HasExperimental&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="nx">versions&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">GreaterThanOrEqualTo&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">dockerCli&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Client&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="nf">ClientVersion&lt;/span>&lt;span class="p">(),&lt;/span> &lt;span class="s">&amp;#34;1.31&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>isSessionSupported&lt;/code> å¾ˆæ˜æ˜¾æ˜¯ç”¨äºåˆ¤æ–­æ˜¯å¦æ”¯æŒ &lt;code>Session&lt;/code>ï¼Œè¿™é‡Œç”±äºæˆ‘ä»¬ä¼šä¼ å…¥ &lt;code>forStream&lt;/code> ä¸º &lt;code>false&lt;/code> ï¼Œè€Œä¸”å½“å‰çš„ API ç‰ˆæœ¬æ˜¯ 1.41 æ¯” 1.39 å¤§ï¼Œæ‰€ä»¥æ­¤å‡½æ•°ä¼šè¿”å› &lt;code>true&lt;/code> ã€‚å…¶å®åœ¨ &lt;code>builder&lt;/code> ä¸­ä¹Ÿæ‰§è¡Œè¿‡ç›¸åŒçš„é€»è¾‘ï¼Œåªä¸è¿‡æ˜¯åœ¨ä¼ é€’äº† &lt;code>--stream&lt;/code> å‚æ•°åï¼Œä½¿ç”¨ &lt;code>Session&lt;/code> è·å–ä¸€ä¸ªé•¿è¿æ¥ä»¥è¾¾åˆ° &lt;code>stream&lt;/code> çš„å¤„ç†èƒ½åŠ›ã€‚&lt;/p>
&lt;p>è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆä¼šæœ‰ä¸‹é¢ &lt;code>dockerCli.ServerInfo().HasExperimental &amp;amp;&amp;amp; versions.GreaterThanOrEqualTo(dockerCli.Client().ClientVersion(), &amp;quot;1.31&amp;quot;)&lt;/code> è¿™ä¸ªåˆ¤æ–­å­˜åœ¨çš„åŸå› äº†ã€‚&lt;/p>
&lt;p>å½“ç¡®è®¤æ”¯æŒ &lt;code>Session&lt;/code> æ—¶ï¼Œåˆ™ä¼šè°ƒç”¨ &lt;code>session.NewSession&lt;/code> åˆ›å»ºä¸€ä¸ªæ–°çš„ä¼šè¯ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="c1">// github.com/moby/buildkit/session/session.go#L47
&lt;/span>&lt;span class="c1">&lt;/span>&lt;span class="kd">func&lt;/span> &lt;span class="nf">NewSession&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">ctx&lt;/span> &lt;span class="nx">context&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Context&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">name&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">sharedKey&lt;/span> &lt;span class="kt">string&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="nx">Session&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kt">error&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">id&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">identity&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">NewID&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="kd">var&lt;/span> &lt;span class="nx">unary&lt;/span> &lt;span class="p">[]&lt;/span>&lt;span class="nx">grpc&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">UnaryServerInterceptor&lt;/span>
&lt;span class="kd">var&lt;/span> &lt;span class="nx">stream&lt;/span> &lt;span class="p">[]&lt;/span>&lt;span class="nx">grpc&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">StreamServerInterceptor&lt;/span>
&lt;span class="nx">serverOpts&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="p">[]&lt;/span>&lt;span class="nx">grpc&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">ServerOption&lt;/span>&lt;span class="p">{}&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">span&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">opentracing&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">SpanFromContext&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">ctx&lt;/span>&lt;span class="p">);&lt;/span> &lt;span class="nx">span&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">tracer&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">span&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Tracer&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="nx">unary&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nb">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">unary&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">otgrpc&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">OpenTracingServerInterceptor&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">tracer&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nf">traceFilter&lt;/span>&lt;span class="p">()))&lt;/span>
&lt;span class="nx">stream&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nb">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">stream&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">otgrpc&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">OpenTracingStreamServerInterceptor&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">span&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Tracer&lt;/span>&lt;span class="p">(),&lt;/span> &lt;span class="nf">traceFilter&lt;/span>&lt;span class="p">()))&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="nx">unary&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nb">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">unary&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">grpcerrors&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">UnaryServerInterceptor&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="nx">stream&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nb">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">stream&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">grpcerrors&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">StreamServerInterceptor&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nb">len&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">unary&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mi">1&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">serverOpts&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nb">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">serverOpts&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">grpc&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">UnaryInterceptor&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">unary&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]))&lt;/span>
&lt;span class="p">}&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="nb">len&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">unary&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">&amp;gt;&lt;/span> &lt;span class="mi">1&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">serverOpts&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nb">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">serverOpts&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">grpc&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">UnaryInterceptor&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">grpc_middleware&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">ChainUnaryServer&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">unary&lt;/span>&lt;span class="o">...&lt;/span>&lt;span class="p">)))&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nb">len&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">stream&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mi">1&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">serverOpts&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nb">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">serverOpts&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">grpc&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">StreamInterceptor&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">stream&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]))&lt;/span>
&lt;span class="p">}&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="nb">len&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">stream&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">&amp;gt;&lt;/span> &lt;span class="mi">1&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">serverOpts&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nb">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">serverOpts&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">grpc&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">StreamInterceptor&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">grpc_middleware&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">ChainStreamServer&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">stream&lt;/span>&lt;span class="o">...&lt;/span>&lt;span class="p">)))&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="nx">s&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="o">&amp;amp;&lt;/span>&lt;span class="nx">Session&lt;/span>&lt;span class="p">{&lt;/span>
&lt;span class="nx">id&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nx">id&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="nx">name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nx">name&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="nx">sharedKey&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nx">sharedKey&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="nx">grpcServer&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nx">grpc&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">NewServer&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">serverOpts&lt;/span>&lt;span class="o">...&lt;/span>&lt;span class="p">),&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="nx">grpc_health_v1&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">RegisterHealthServer&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">s&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">grpcServer&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">health&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">NewServer&lt;/span>&lt;span class="p">())&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="nx">s&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kc">nil&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>å®ƒåˆ›å»ºäº†ä¸€ä¸ªé•¿è¿æ¥ä¼šè¯ï¼Œæ¥ä¸‹æ¥çš„æ“ä½œä¹Ÿéƒ½ä¼šåŸºäºè¿™ä¸ªä¼šè¯æ¥åšã€‚æ¥ä¸‹æ¥çš„æ“ä½œä¸ &lt;code>builder&lt;/code> å¤§ä½“ä¸€è‡´ï¼Œå…ˆåˆ¤æ–­ &lt;code>context&lt;/code> æ˜¯ä»¥å“ªç§å½¢å¼æä¾›çš„ï¼›å½“ç„¶å®ƒä¹Ÿä¸ &lt;code>builder&lt;/code> ä¸€æ ·ï¼Œæ˜¯ä¸å…è®¸åŒæ—¶ä» &lt;code>stdin&lt;/code> è·å– &lt;code>Dockerfile&lt;/code> å’Œ &lt;code>build context&lt;/code> ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="k">switch&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">case&lt;/span> &lt;span class="nx">options&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">contextFromStdin&lt;/span>&lt;span class="p">():&lt;/span>
&lt;span class="c1">// çœç•¥å¤„ç†é€»è¾‘
&lt;/span>&lt;span class="c1">&lt;/span>&lt;span class="k">case&lt;/span> &lt;span class="nf">isLocalDir&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">options&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">context&lt;/span>&lt;span class="p">):&lt;/span>
&lt;span class="c1">// çœç•¥å¤„ç†é€»è¾‘
&lt;/span>&lt;span class="c1">&lt;/span>&lt;span class="k">case&lt;/span> &lt;span class="nx">urlutil&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">IsGitURL&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">options&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">context&lt;/span>&lt;span class="p">):&lt;/span>
&lt;span class="c1">// çœç•¥å¤„ç†é€»è¾‘
&lt;/span>&lt;span class="c1">&lt;/span>&lt;span class="k">case&lt;/span> &lt;span class="nx">urlutil&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">IsURL&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">options&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">context&lt;/span>&lt;span class="p">):&lt;/span>
&lt;span class="c1">// çœç•¥å¤„ç†é€»è¾‘
&lt;/span>&lt;span class="c1">&lt;/span>&lt;span class="k">default&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="nx">errors&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Errorf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;unable to prepare context: path %q not found&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">options&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">context&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™é‡Œçš„å¤„ç†é€»è¾‘ä¸ v1 &lt;code>builder&lt;/code> ä¿æŒä¸€è‡´çš„åŸå› ï¼Œä¸»è¦åœ¨äºç”¨æˆ·ä½“éªŒä¸Šï¼Œå½“å‰çš„ CLI çš„åŠŸèƒ½å·²ç»åŸºæœ¬ç¨³å®šï¼Œç”¨æˆ·ä¹Ÿå·²ç»ä¹ æƒ¯ï¼Œæ‰€ä»¥å³ä½¿æ˜¯å¢åŠ äº† &lt;code>BuildKit&lt;/code> ä¹Ÿå¹¶æ²¡æœ‰å¯¹ä¸»ä½“çš„æ“ä½œé€»è¾‘é€ æˆå¤šå¤§æ”¹å˜ã€‚&lt;/p>
&lt;h4 id="é€‰æ‹©è¾“å‡ºæ¨¡å¼">é€‰æ‹©è¾“å‡ºæ¨¡å¼&lt;/h4>
&lt;p>&lt;code>BuildKit&lt;/code> æ”¯æŒäº†ä¸‰ç§ä¸åŒçš„è¾“å‡ºæ¨¡å¼ &lt;code>local&lt;/code> &lt;code>tar&lt;/code> å’Œæ­£å¸¸æ¨¡å¼ï¼ˆå³å­˜å‚¨åœ¨ &lt;code>dockerd&lt;/code> ä¸­ï¼‰ï¼Œ æ ¼å¼ä¸º &lt;code>-o type=local,dest=path&lt;/code> å¦‚æœéœ€è¦å°†æ„å»ºçš„é•œåƒè¿›è¡Œåˆ†å‘ï¼Œæˆ–æ˜¯éœ€è¦è¿›è¡Œé•œåƒå†…æ–‡ä»¶æµè§ˆçš„è¯ï¼Œä½¿ç”¨è¿™ä¸ªæ–¹å¼ä¹Ÿæ˜¯å¾ˆæ–¹ä¾¿çš„ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="nx">outputs&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nf">parseOutputs&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">options&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">outputs&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="nx">errors&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Wrapf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">err&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;failed to parse outputs&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="k">for&lt;/span> &lt;span class="nx">_&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">out&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="k">range&lt;/span> &lt;span class="nx">outputs&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">switch&lt;/span> &lt;span class="nx">out&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Type&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">case&lt;/span> &lt;span class="s">&amp;#34;local&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="c1">// çœç•¥
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="k">case&lt;/span> &lt;span class="s">&amp;#34;tar&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="c1">// çœç•¥
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="p">}&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>å…¶å®å®ƒæ”¯æŒçš„æ¨¡å¼è¿˜æœ‰ç¬¬ 4 ç§ï¼Œ åä¸º &lt;code>cacheonly&lt;/code> ä½†å®ƒå¹¶ä¸ä¼šåƒå‰é¢æåˆ°çš„ä¸‰ç§æ¨¡å¼ä¸€æ ·ï¼Œæœ‰ä¸ªå¾ˆç›´è§‚çš„è¾“å‡ºï¼Œè€Œä¸”ç”¨çš„äººå¯èƒ½ä¼šå¾ˆå°‘ï¼Œæ‰€ä»¥å°±æ²¡æœ‰å•ç‹¬å†™äº†ã€‚&lt;/strong>&lt;/p>
&lt;h4 id="è¯»å–è®¤è¯ä¿¡æ¯">è¯»å–è®¤è¯ä¿¡æ¯&lt;/h4>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="nx">dockerAuthProvider&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">authprovider&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">NewDockerAuthProvider&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">os&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Stderr&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="nx">s&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Allow&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">dockerAuthProvider&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™é‡Œçš„è¡Œä¸ºä¸ä¸Šé¢æåˆ°çš„ &lt;code>builder&lt;/code> çš„è¡Œä¸ºåŸºæœ¬ä¸€è‡´ï¼Œè¿™é‡Œä¸»è¦æœ‰ä¸¤ä¸ªéœ€è¦æ³¨æ„çš„ç‚¹ï¼š&lt;/p>
&lt;ul>
&lt;li>Allow() å‡½æ•°&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="kd">func&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">s&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">Session&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="nf">Allow&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">a&lt;/span> &lt;span class="nx">Attachable&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">a&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Register&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">s&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">grpcServer&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™ä¸ª &lt;code>Allow&lt;/code> å‡½æ•°å°±æ˜¯å…è®¸é€šè¿‡ä¸Šé¢æåˆ°çš„ grpc ä¼šè¯è®¿é—®ç»™å®šçš„æœåŠ¡ã€‚&lt;/p>
&lt;ul>
&lt;li>&lt;code>authprovider&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>&lt;code>authprovider&lt;/code> æ˜¯ &lt;code>BuildKit&lt;/code> æä¾›çš„ä¸€ç»„æŠ½è±¡æ¥å£é›†åˆï¼Œé€šè¿‡å®ƒä»¬å¯ä»¥è®¿é—®åˆ°æœºå™¨ä¸Šçš„é…ç½®æ–‡ä»¶ï¼Œè¿›è€Œæ‹¿åˆ°è®¤è¯ä¿¡æ¯ï¼Œè¡Œä¸ºä¸ &lt;code>builder&lt;/code> åŸºæœ¬ä¸€è‡´ã€‚&lt;/p>
&lt;h4 id="é«˜é˜¶ç‰¹æ€§mount-secrets-å’Œ-ssh">é«˜é˜¶ç‰¹æ€§ï¼šmount &lt;code>secrets&lt;/code> å’Œ &lt;code>ssh&lt;/code>&lt;/h4>
&lt;p>æˆ‘å…¶ä»–çš„æ–‡ç« è®²è¿‡è¿™ä¸¤ç§é«˜é˜¶ç‰¹æ€§çš„ä½¿ç”¨äº†ï¼Œæœ¬ç¯‡ä¸­å°±ä¸å†å¤šä½¿ç”¨è¿›è¡Œè¿‡å¤šè¯´æ˜äº†ï¼Œåªæ¥å¤§ä½“çœ‹ä¸‹è¯¥éƒ¨åˆ†çš„åŸç†å’Œé€»è¾‘ã€‚&lt;/p>
&lt;p>&lt;code>secretsprovider&lt;/code> å’Œ &lt;code>sshprovider&lt;/code> éƒ½æ˜¯ &lt;code>buildkit&lt;/code> åœ¨æä¾›çš„ï¼Œåˆ©ç”¨è¿™ä¸¤ç§ç‰¹æ€§å¯ä»¥åœ¨ Docker é•œåƒè¿›è¡Œæ„å»ºæ—¶æ›´åŠ å®‰å…¨ï¼Œä¸”æ›´åŠ çµæ´»ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="kd">func&lt;/span> &lt;span class="nf">parseSecretSpecs&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">sl&lt;/span> &lt;span class="p">[]&lt;/span>&lt;span class="kt">string&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">session&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Attachable&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kt">error&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">fs&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nb">make&lt;/span>&lt;span class="p">([]&lt;/span>&lt;span class="nx">secretsprovider&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Source&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nb">len&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">sl&lt;/span>&lt;span class="p">))&lt;/span>
&lt;span class="k">for&lt;/span> &lt;span class="nx">_&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">v&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="k">range&lt;/span> &lt;span class="nx">sl&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">s&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nf">parseSecret&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">v&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="kc">nil&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="nx">fs&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nb">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">fs&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">s&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="nx">store&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">secretsprovider&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">NewStore&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">fs&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="kc">nil&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="nx">secretsprovider&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">NewSecretProvider&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">store&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="kc">nil&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>å…³äº &lt;code>secrets&lt;/code> æ–¹é¢ï¼Œæœ€ç»ˆçš„ &lt;code>parseSecret&lt;/code> ä¼šå®Œæˆæ ¼å¼ç›¸å…³çš„æ ¡éªŒä¹‹ç±»çš„ï¼›&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="kd">func&lt;/span> &lt;span class="nf">parseSSHSpecs&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">sl&lt;/span> &lt;span class="p">[]&lt;/span>&lt;span class="kt">string&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">session&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Attachable&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kt">error&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">configs&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nb">make&lt;/span>&lt;span class="p">([]&lt;/span>&lt;span class="nx">sshprovider&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">AgentConfig&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nb">len&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">sl&lt;/span>&lt;span class="p">))&lt;/span>
&lt;span class="k">for&lt;/span> &lt;span class="nx">_&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">v&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="k">range&lt;/span> &lt;span class="nx">sl&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">c&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nf">parseSSH&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">v&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="nx">configs&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nb">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">configs&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">c&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="nx">sshprovider&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">NewSSHAgentProvider&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">configs&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>è€Œå…³äº &lt;code>ssh&lt;/code> æ–¹é¢ï¼Œåˆ™ä¸ä¸Šæ–¹çš„ &lt;code>secrets&lt;/code> åŸºæœ¬ä¸€è‡´ï¼Œé€šè¿‡ &lt;code>sshprovider&lt;/code> å…è®¸è¿›è¡Œ ssh è½¬å‘ä¹‹ç±»çš„ï¼Œè¿™é‡Œä¸å†æ·±å…¥å±•å¼€äº†ã€‚&lt;/p>
&lt;h4 id="è°ƒç”¨-api-å‘é€æ„å»ºè¯·æ±‚">è°ƒç”¨ API å‘é€æ„å»ºè¯·æ±‚&lt;/h4>
&lt;p>è¿™é‡Œä¸»è¦æœ‰ä¸¤ç§æƒ…å†µã€‚&lt;/p>
&lt;ul>
&lt;li>å½“ &lt;code>build context&lt;/code> æ˜¯ä» &lt;code>stdin&lt;/code> è¯»ï¼Œå¹¶ä¸”æ˜¯ä¸€ä¸ª &lt;code>tar&lt;/code> æ–‡ä»¶æ—¶&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="nx">buildID&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">stringid&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">GenerateRandomID&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">body&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">eg&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Go&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kd">func&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="kt">error&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">buildOptions&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">types&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">ImageBuildOptions&lt;/span>&lt;span class="p">{&lt;/span>
&lt;span class="nx">Version&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nx">types&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">BuilderBuildKit&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="nx">BuildID&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nx">uploadRequestRemote&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s">&amp;#34;:&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="nx">buildID&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="nx">response&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">dockerCli&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Client&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="nf">ImageBuild&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">context&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Background&lt;/span>&lt;span class="p">(),&lt;/span> &lt;span class="nx">body&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">buildOptions&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="nx">err&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="k">defer&lt;/span> &lt;span class="nx">response&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Body&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Close&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="kc">nil&lt;/span>
&lt;span class="p">})&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>å®ƒä¼šæ‰§è¡Œä¸Šè¿°è¿™éƒ¨åˆ†é€»è¾‘ï¼Œä½†åŒæ—¶ä¹Ÿè¦æ³¨æ„ï¼Œè¿™æ˜¯ä½¿ç”¨çš„æ˜¯ Golang çš„ &lt;code>goroutine&lt;/code>ï¼Œåˆ°è¿™é‡Œä¹Ÿå¹¶ä¸æ˜¯ç»“æŸï¼Œè¿™éƒ¨åˆ†ä»£ç ä¹‹åçš„ä»£ç ä¹ŸåŒæ ·ä¼šè¢«æ‰§è¡Œã€‚è¿™å°±è¯´åˆ°äº†å¦ä¸€ç§æƒ…å†µäº†(é€šå¸¸æƒ…å†µ)ã€‚&lt;/p>
&lt;ul>
&lt;li>ä½¿ç”¨ &lt;code>doBuild&lt;/code> å®Œæˆé€»è¾‘&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="nx">eg&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Go&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kd">func&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="kt">error&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">defer&lt;/span> &lt;span class="kd">func&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">s&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Close&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="p">}()&lt;/span>
&lt;span class="nx">buildOptions&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nf">imageBuildOptions&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">dockerCli&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">options&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="nx">buildOptions&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Version&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">types&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">BuilderBuildKit&lt;/span>
&lt;span class="nx">buildOptions&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Dockerfile&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">dockerfileName&lt;/span>
&lt;span class="nx">buildOptions&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">RemoteContext&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">remote&lt;/span>
&lt;span class="nx">buildOptions&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">SessionID&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">s&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">ID&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="nx">buildOptions&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">BuildID&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">buildID&lt;/span>
&lt;span class="nx">buildOptions&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Outputs&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">outputs&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="nf">doBuild&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">ctx&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">eg&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">dockerCli&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">stdoutUsed&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">options&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">buildOptions&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">})&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>é‚£ &lt;code>doBuild&lt;/code> ä¼šåšäº›ä»€ä¹ˆå‘¢ï¼Ÿå®ƒåŒæ ·ä¹Ÿè°ƒç”¨äº† API å‘ &lt;code>dockerd&lt;/code> å‘èµ·äº†æ„å»ºè¯·æ±‚ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="kd">func&lt;/span> &lt;span class="nf">doBuild&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">ctx&lt;/span> &lt;span class="nx">context&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Context&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">eg&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">errgroup&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Group&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">dockerCli&lt;/span> &lt;span class="nx">command&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Cli&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">stdoutUsed&lt;/span> &lt;span class="kt">bool&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">options&lt;/span> &lt;span class="nx">buildOptions&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">buildOptions&lt;/span> &lt;span class="nx">types&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">ImageBuildOptions&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">at&lt;/span> &lt;span class="nx">session&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Attachable&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">finalErr&lt;/span> &lt;span class="kt">error&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">response&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">dockerCli&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Client&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="nf">ImageBuild&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">context&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Background&lt;/span>&lt;span class="p">(),&lt;/span> &lt;span class="kc">nil&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">buildOptions&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="nx">err&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="k">defer&lt;/span> &lt;span class="nx">response&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Body&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Close&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="c1">// çœç•¥
&lt;/span>&lt;span class="c1">&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä»ä»¥ä¸Šçš„ä»‹ç»æˆ‘ä»¬å¯ä»¥å…ˆåšä¸ªå°çš„æ€»ç»“ã€‚ &lt;strong>å½“ &lt;code>build context&lt;/code> ä» &lt;code>stdin&lt;/code> è¯»ï¼Œå¹¶ä¸”æ˜¯ä¸ª &lt;code>tar&lt;/code> å½’æ¡£æ—¶ï¼Œå®é™…ä¼šå‘ &lt;code>dockerd&lt;/code> å‘èµ·ä¸¤æ¬¡ &lt;code>/build&lt;/code> è¯·æ±‚&lt;/strong> è€Œä¸€èˆ¬æƒ…å†µä¸‹åªä¼šå‘é€ä¸€æ¬¡è¯·æ±‚ã€‚&lt;/p>
&lt;p>é‚£è¿™é‡Œä¼šæœ‰ä»€ä¹ˆå·®åˆ«å‘¢ï¼Ÿæ­¤å¤„å…ˆä¸å±•å¼€ï¼Œæˆ‘ä»¬ç•™åˆ°ä¸‹é¢è®² &lt;code>dockerd&lt;/code> æœåŠ¡ç«¯çš„æ—¶å€™å†æ¥è§£é‡Šã€‚&lt;/p>
&lt;h4 id="å°ç»“-2">å°ç»“&lt;/h4>
&lt;p>è¿™é‡Œæˆ‘ä»¬å¯¹å¼€å¯äº† &lt;code>buildkit&lt;/code> æ”¯æŒçš„ CLI æ„å»ºé•œåƒçš„è¿‡ç¨‹è¿›è¡Œäº†åˆ†æï¼Œå¤§è‡´è¿‡ç¨‹å¦‚ä¸‹ï¼š&lt;/p>
&lt;p>ä»å…¥å£å‡½æ•° &lt;code>runBuild&lt;/code> å¼€å§‹ï¼Œåˆ¤æ–­æ˜¯å¦æ”¯æŒ &lt;code>buildkit&lt;/code> ï¼Œå¦‚æœæ”¯æŒ &lt;code>buildkit&lt;/code> åˆ™è°ƒç”¨ &lt;code>runBuildBuildKit&lt;/code>ã€‚ä¸ v1 çš„ &lt;code>builder&lt;/code> ä¸åŒçš„æ˜¯ï¼Œå¼€å¯äº† &lt;code>buildkit&lt;/code> åï¼Œä¼šé¦–å…ˆåˆ›å»ºä¸€ä¸ªé•¿è¿æ¥çš„ä¼šè¯ï¼Œå¹¶ä¸€ç›´ä¿æŒã€‚å…¶æ¬¡ï¼Œä¸ &lt;code>builder&lt;/code> ç›¸åŒï¼Œåˆ¤æ–­ &lt;code>build context&lt;/code> çš„æ¥æºï¼Œæ ¼å¼ä¹‹ç±»çš„ï¼Œæ ¡éªŒå‚æ•°ç­‰ã€‚å½“ç„¶ï¼Œ&lt;code>buildkit&lt;/code> æ”¯æŒä¸‰ç§ä¸åŒçš„è¾“å‡ºæ ¼å¼ &lt;code>tar&lt;/code>, &lt;code>local&lt;/code> æˆ–æ­£å¸¸çš„å­˜å‚¨äº Docker çš„ç›®å½•ä¸­ã€‚å¦å¤–æ˜¯åœ¨ &lt;code>buildkit&lt;/code> ä¸­æ–°å¢çš„é«˜é˜¶ç‰¹æ€§ï¼Œå¯ä»¥é…ç½® &lt;code>secrets&lt;/code> å’Œ &lt;code>ssh&lt;/code> å¯†é’¥ç­‰åŠŸèƒ½ã€‚æœ€åï¼Œå†è°ƒç”¨ API ä¸ &lt;code>dockerd&lt;/code> äº¤äº’å®Œæˆé•œåƒçš„æ„å»ºã€‚&lt;/p>
&lt;h2 id="æœåŠ¡ç«¯dockerd">æœåŠ¡ç«¯ï¼šdockerd&lt;/h2>
&lt;p>ä¸Šé¢åˆ†åˆ«ä»‹ç»äº† APIï¼Œ CLI çš„ v1 &lt;code>builder&lt;/code> å’Œ &lt;code>buildkit&lt;/code> ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹æœåŠ¡ç«¯çš„å…·ä½“åŸç†å’Œé€»è¾‘ã€‚&lt;/p>
&lt;h3 id="client-å‡½æ•°">Client å‡½æ•°&lt;/h3>
&lt;p>è¿˜è®°å¾—ä¸Šé¢éƒ¨åˆ†ä¸­æœ€åé€šè¿‡ API ä¸æœåŠ¡ç«¯äº¤äº’çš„ &lt;code>ImageBuild&lt;/code> å‡½æ•°å—ï¼Ÿåœ¨å¼€å§‹ &lt;code>dockerd&lt;/code> çš„ä»‹ç»å‰ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹è¿™ä¸ªå®¢æˆ·ç«¯æ¥å£çš„å…·ä½“å†…å®¹ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="c1">// github.com/docker/docker/client/image_build.go#L20
&lt;/span>&lt;span class="c1">&lt;/span>&lt;span class="kd">func&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">cli&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">Client&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="nf">ImageBuild&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">ctx&lt;/span> &lt;span class="nx">context&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Context&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">buildContext&lt;/span> &lt;span class="nx">io&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Reader&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">options&lt;/span> &lt;span class="nx">types&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">ImageBuildOptions&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">types&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">ImageBuildResponse&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kt">error&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">query&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">cli&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">imageBuildOptionsToQuery&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">options&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="nx">types&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">ImageBuildResponse&lt;/span>&lt;span class="p">{},&lt;/span> &lt;span class="nx">err&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="nx">headers&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">http&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Header&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">make&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kd">map&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="kt">string&lt;/span>&lt;span class="p">][]&lt;/span>&lt;span class="kt">string&lt;/span>&lt;span class="p">))&lt;/span>
&lt;span class="nx">buf&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">json&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Marshal&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">options&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">AuthConfigs&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="nx">types&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">ImageBuildResponse&lt;/span>&lt;span class="p">{},&lt;/span> &lt;span class="nx">err&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="nx">headers&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;X-Registry-Config&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">base64&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">URLEncoding&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">EncodeToString&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">buf&lt;/span>&lt;span class="p">))&lt;/span>
&lt;span class="nx">headers&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Set&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Content-Type&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;application/x-tar&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="nx">serverResp&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">cli&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">postRaw&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">ctx&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;/build&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">query&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">buildContext&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">headers&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="nx">types&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">ImageBuildResponse&lt;/span>&lt;span class="p">{},&lt;/span> &lt;span class="nx">err&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="nx">osType&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nf">getDockerOS&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">serverResp&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">header&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Server&amp;#34;&lt;/span>&lt;span class="p">))&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="nx">types&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">ImageBuildResponse&lt;/span>&lt;span class="p">{&lt;/span>
&lt;span class="nx">Body&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nx">serverResp&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">body&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="nx">OSType&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nx">osType&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="p">},&lt;/span> &lt;span class="kc">nil&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ²¡æœ‰ä»€ä¹ˆå¤ªç‰¹åˆ«çš„åœ°æ–¹ï¼Œè¡Œä¸ºä¸ API ä¸€è‡´ã€‚ é€šè¿‡è¿™é‡Œæˆ‘ä»¬ç¡®è®¤å®ƒç¡®å®è®¿é—®çš„ &lt;code>/build&lt;/code> æ¥å£ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹ &lt;code>dockerd&lt;/code> çš„ &lt;code>/build&lt;/code> æ¥å£ï¼Œçœ‹çœ‹å®ƒåœ¨æ„å»ºé•œåƒçš„æ—¶å€™åšäº†ä»€ä¹ˆã€‚&lt;/p>
&lt;h3 id="dockerd">&lt;code>dockerd&lt;/code>&lt;/h3>
&lt;p>ç”±äºæœ¬æ–‡é›†ä¸­è®¨è®ºçš„æ˜¯æ„å»ºç³»ç»Ÿç›¸å…³çš„éƒ¨åˆ†ï¼Œæ‰€ä»¥ä¹Ÿå°±ä¸å†è¿‡å¤šèµ˜è¿°ä¸æ„å»ºæ— å…³çš„å†…å®¹äº†ï¼Œæˆ‘ä»¬ç›´æ¥æ¥çœ‹ï¼Œå½“ CLI é€šè¿‡ &lt;code>/build&lt;/code> æ¥å£å‘é€è¯·æ±‚åï¼Œä¼šå‘ç”Ÿä»€ä¹ˆã€‚&lt;/p>
&lt;p>å…ˆæ¥çœ‹è¯¥ API çš„å…¥å£ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="c1">// api/server/router/build/build.go#L32
&lt;/span>&lt;span class="c1">&lt;/span>&lt;span class="kd">func&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">r&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">buildRouter&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="nf">initRoutes&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">r&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">routes&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="p">[]&lt;/span>&lt;span class="nx">router&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Route&lt;/span>&lt;span class="p">{&lt;/span>
&lt;span class="nx">router&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">NewPostRoute&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;/build&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">r&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">postBuild&lt;/span>&lt;span class="p">),&lt;/span>
&lt;span class="nx">router&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">NewPostRoute&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;/build/prune&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">r&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">postPrune&lt;/span>&lt;span class="p">),&lt;/span>
&lt;span class="nx">router&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">NewPostRoute&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;/build/cancel&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">r&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">postCancel&lt;/span>&lt;span class="p">),&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>dockerd&lt;/code> æä¾›äº†ä¸€å¥—ç±» RESTful çš„åç«¯æ¥å£æœåŠ¡ï¼Œå¤„ç†é€»è¾‘çš„å…¥å£ä¾¿æ˜¯ä¸Šé¢çš„ &lt;code>postBuild&lt;/code> å‡½æ•°ã€‚&lt;/p>
&lt;p>è¯¥å‡½æ•°çš„å†…å®¹è¾ƒå¤šï¼Œæˆ‘ä»¬æ¥åˆ†è§£ä¸‹å®ƒçš„ä¸»è¦æ­¥éª¤ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="nx">buildOptions&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nf">newImageBuildOptions&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">ctx&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">r&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="nf">errf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">err&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>&lt;code>newImageBuildOptions&lt;/code> å‡½æ•°å°±æ˜¯æ„é€ æ„å»ºå‚æ•°çš„ï¼Œå°†é€šè¿‡ API æäº¤è¿‡æ¥çš„å‚æ•°è½¬æ¢ä¸ºæ„å»ºåŠ¨ä½œå®é™…éœ€è¦çš„å‚æ•°å½¢å¼ã€‚&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="nx">buildOptions&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">AuthConfigs&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nf">getAuthConfigs&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">r&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Header&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>&lt;code>getAuthConfigs&lt;/code> å‡½æ•°ç”¨äºä»è¯·æ±‚å¤´æ‹¿åˆ°è®¤è¯ä¿¡æ¯&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="nx">imgID&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">br&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">backend&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Build&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">ctx&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">backend&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">BuildConfig&lt;/span>&lt;span class="p">{&lt;/span>
&lt;span class="nx">Source&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nx">body&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="nx">Options&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nx">buildOptions&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="nx">ProgressWriter&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nf">buildProgressWriter&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">out&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">wantAux&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">createProgressReader&lt;/span>&lt;span class="p">),&lt;/span>
&lt;span class="p">})&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="nf">errf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">err&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™é‡Œå°±éœ€è¦æ³¨æ„äº†: çœŸæ­£çš„æ„å»ºè¿‡ç¨‹è¦å¼€å§‹äº†ã€‚&lt;strong>ä½¿ç”¨ backend çš„ &lt;code>Build&lt;/code> å‡½æ•°æ¥å®ŒæˆçœŸæ­£çš„æ„å»ºè¿‡ç¨‹&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="c1">// api/server/backend/build/backend.go#L53
&lt;/span>&lt;span class="c1">&lt;/span>&lt;span class="kd">func&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">b&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">Backend&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="nf">Build&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">ctx&lt;/span> &lt;span class="nx">context&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Context&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">config&lt;/span> &lt;span class="nx">backend&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">BuildConfig&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="kt">string&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kt">error&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">options&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">config&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Options&lt;/span>
&lt;span class="nx">useBuildKit&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">options&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Version&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="nx">types&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">BuilderBuildKit&lt;/span>
&lt;span class="nx">tagger&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nf">NewTagger&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">b&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">imageComponent&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">config&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">ProgressWriter&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">StdoutFormatter&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">options&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Tags&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="s">&amp;#34;&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="kd">var&lt;/span> &lt;span class="nx">build&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">builder&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Result&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">useBuildKit&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">build&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">b&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">buildkit&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Build&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">ctx&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">config&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="s">&amp;#34;&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="p">}&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">build&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">b&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">builder&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Build&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">ctx&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">config&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="s">&amp;#34;&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">build&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="s">&amp;#34;&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kc">nil&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="kd">var&lt;/span> &lt;span class="nx">imageID&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">build&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">ImageID&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">options&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Squash&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">imageID&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nf">squashBuild&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">build&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">b&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">imageComponent&lt;/span>&lt;span class="p">);&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="s">&amp;#34;&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">config&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">ProgressWriter&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">AuxFormatter&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">config&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">ProgressWriter&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">AuxFormatter&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Emit&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;moby.image.id&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">types&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">BuildResult&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="nx">ID&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nx">imageID&lt;/span>&lt;span class="p">});&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="s">&amp;#34;&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="p">!&lt;/span>&lt;span class="nx">useBuildKit&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">stdout&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">config&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">ProgressWriter&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">StdoutFormatter&lt;/span>
&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Fprintf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">stdout&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;Successfully built %s\n&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">stringid&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">TruncateID&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">imageID&lt;/span>&lt;span class="p">))&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">imageID&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="s">&amp;#34;&amp;#34;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">err&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">tagger&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">TagImages&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">image&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">ID&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">imageID&lt;/span>&lt;span class="p">))&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="nx">imageID&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™ä¸ªå‡½æ•°çœ‹ç€æ¯”è¾ƒé•¿ï¼Œä½†ä¸»è¦åŠŸèƒ½å°±ä»¥ä¸‹ä¸‰ç‚¹ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;code>NewTagger&lt;/code> æ˜¯ç”¨äºç»™é•œåƒæ‰“æ ‡ç­¾ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„ &lt;code>-t&lt;/code> å‚æ•°ç›¸å…³çš„å†…å®¹ï¼Œè¿™é‡Œä¸åšå±•å¼€ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>é€šè¿‡åˆ¤æ–­æ˜¯å¦ä½¿ç”¨äº† &lt;code>buildkit&lt;/code> æ¥è°ƒç”¨ä¸åŒçš„æ„å»ºåç«¯ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="nx">useBuildKit&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">options&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Version&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="nx">types&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">BuilderBuildKit&lt;/span>
&lt;span class="kd">var&lt;/span> &lt;span class="nx">build&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">builder&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Result&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">useBuildKit&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">build&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">b&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">buildkit&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Build&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">ctx&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">config&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="s">&amp;#34;&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="p">}&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">build&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">b&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">builder&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Build&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">ctx&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">config&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="s">&amp;#34;&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>å¤„ç†æ„å»ºå®Œæˆåçš„åŠ¨ä½œã€‚&lt;/li>
&lt;/ul>
&lt;p>åˆ°è¿™ä¸ªå‡½æ•°ä¹‹åï¼Œå°±åˆ†åˆ«æ˜¯ v1 &lt;code>builder&lt;/code> ä¸ &lt;code>buildkit&lt;/code> å¯¹ &lt;code>Dockerfile&lt;/code> çš„è§£æï¼Œä»¥åŠå¯¹ &lt;code>build context&lt;/code> çš„æ“ä½œäº†ã€‚&lt;/p>
&lt;p>è¿™é‡Œæ¶‰åŠåˆ°çš„å†…å®¹ä¸æˆ‘ä¸‹ä¸€ç¯‡æ–‡ç« ã€Šé«˜æ•ˆæ„å»º Docker é•œåƒçš„æœ€ä½³å®è·µã€‹çš„å†…éƒ¨å…³è”æ¯”è¾ƒå¤§ï¼Œæ­¤å¤„å°±ä¸å†è¿›è¡Œå±•å¼€äº†ã€‚æ•¬è¯·æœŸå¾…ä¸‹ä¸€ç¯‡æ–‡ç« ã€‚&lt;/p>
&lt;h2 id="æ€»ç»“">æ€»ç»“&lt;/h2>
&lt;p>æœ¬æ–‡é¦–å…ˆä»‹ç»äº† Docker çš„ C/S æ¶æ„ï¼Œä»‹ç»äº†æ„å»ºé•œåƒæ‰€ç”¨çš„ API , API æ–‡æ¡£å¯ä»¥åœ¨çº¿æŸ¥çœ‹æˆ–è€…æœ¬åœ°æ„å»ºã€‚ä¹‹åæ·±å…¥åˆ° Docker CLI çš„æºç ä¸­ï¼Œé€æ­¥åˆ†è§£ v1 &lt;code>builder&lt;/code> ä¸ &lt;code>buildkit&lt;/code> åœ¨æ„å»ºé•œåƒæ—¶æ‰§è¡Œçš„è¿‡ç¨‹çš„å·®å¼‚ã€‚æœ€åï¼Œæˆ‘ä»¬æ·±å…¥åˆ° &lt;code>dockerd&lt;/code> çš„æºç ä¸­ï¼Œäº†è§£åˆ°äº†å¯¹ä¸åŒæ„å»ºåç«¯çš„è°ƒç”¨ã€‚è‡³æ­¤ï¼ŒDocker æ„å»ºé•œåƒçš„åŸç†åŠä¸»ä½“ä»£ç å°±ä»‹ç»å®Œæ¯•ã€‚&lt;/p>
&lt;p>ä½†è¿™è¿˜å¹¶ä¸æ˜¯ç»“æŸï¼Œæˆ‘ä¼šåœ¨åç»­æ–‡ç« ä¸­åˆ†äº«é•œåƒæ„å»ºçš„ç›¸å…³å®è·µï¼Œæ•¬è¯·æœŸå¾…ï¼&lt;/p>
&lt;hr>
&lt;p>æ¬¢è¿è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://gitee.com/tlrr/awesome/raw/master/2020-9-9/1599632564572-mp-qrcode.png" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Docker/">Docker</category><category domain="https://moelove.info/tags/golang/">golang</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| Docker v20.10.5 å‘å¸ƒï¼Œä¿®å¤ Bug åŠæå‡ç¨³å®šæ€§</title><link>https://moelove.info/2021/02/28/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Docker-v20.10.5-%E5%8F%91%E5%B8%83%E4%BF%AE%E5%A4%8D-Bug-%E5%8F%8A%E6%8F%90%E5%8D%87%E7%A8%B3%E5%AE%9A%E6%80%A7/</link><guid isPermaLink="true">https://moelove.info/2021/02/28/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Docker-v20.10.5-%E5%8F%91%E5%B8%83%E4%BF%AE%E5%A4%8D-Bug-%E5%8F%8A%E6%8F%90%E5%8D%87%E7%A8%B3%E5%AE%9A%E6%80%A7/</guid><pubDate>Sun, 28 Feb 2021 22:10:50 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container" title="k8sç”Ÿæ€">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="docker-v20105-å‘å¸ƒ">Docker v20.10.5 å‘å¸ƒ&lt;/h2>
&lt;p>è¿™é‡Œæˆ‘åŒæ—¶ä»‹ç»ä¸‹ Docker v20.10.4 å’Œ v20.10.5 ä¸­å€¼å¾—æ³¨æ„çš„å˜æ›´ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://github.com/docker/cli/pull/2959">cli#2959&lt;/a> ä¿®å¤äº†ä¸€ä¸ªåœ¨ &lt;code>docker login&lt;/code> æ—¶ï¼Œå¯èƒ½è§¦å‘çš„ panic ã€‚è¿™ä¸ªé—®é¢˜å¯èƒ½ä¼šå‘ç”Ÿåœ¨ä½¿ç”¨ Debian ç³»ç»Ÿå…¨æ–°å®‰è£… Docker v20.10.[0~3] ç‰ˆæœ¬ï¼Œå¹¶ä¸”é€šè¿‡ apt å®‰è£…äº† docker-compose çš„åœºæ™¯ä¸‹ã€‚è§£å†³åŠæ³•ï¼Œè¦ä¹ˆå‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬ï¼Œè¦ä¹ˆå°±éœ€è¦æ‰‹åŠ¨åˆ›å»º &lt;code>~/.docker/config.json&lt;/code> æ–‡ä»¶ã€‚ &lt;strong>å¯¹äºç»å¤§å¤šæ•°çš„ç”¨æˆ·åº”è¯¥éƒ½ä¸ä¼šå—åˆ°æ­¤é—®é¢˜å½±å“&lt;/strong>ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/moby/moby/pull/42049">#42049&lt;/a> ä¿®å¤äº†ä¸€ä¸ªä»…åœ¨ v20.10 ç‰ˆæœ¬ä¸‹ï¼ŒåŒæ­¥ pull å¤±è´¥çš„æƒ…å†µã€‚è¿™ä¸ªé—®é¢˜åªæœ‰åœ¨ v20.10 ç‰ˆæœ¬ï¼Œä¸”å¯ç”¨äº† BuildKit ï¼Œå¹¶ä¸”åœ¨æ„å»ºé•œåƒæ—¶å€™å­˜åœ¨å¹¶å‘ pull çš„æƒ…å†µä¸‹æ‰ä¼šè§¦å‘ï¼Œç®—æ˜¯è§¦å‘æ¦‚ç‡æä½çš„æƒ…å†µäº†ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/docker/cli/pull/2987">cli#2987&lt;/a> ä¿®å¤äº† &lt;code>docker start -a&lt;/code> å¯èƒ½ hang ä½çš„é—®é¢˜ã€‚è¯´å®è¯ï¼Œè¦ä¸æ˜¯æŸ¥è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘å·²ç»åŸºæœ¬å¿˜è®°äº† docker start æœ‰ä¸ª &lt;code>-a&lt;/code> çš„é€‰é¡¹äº†ã€‚æˆ‘é€šå¸¸ä¼šç›´æ¥ç”¨ &lt;code>docker run&lt;/code> å¯åŠ¨å½“å‰è¦ç”¨çš„å®¹å™¨ï¼Œæˆ–è€… &lt;code>docker start&lt;/code> åï¼Œå† &lt;code>docker exec&lt;/code> ï¼Œ &lt;strong>attach&lt;/strong> ç›¸å…³çš„å‘½ä»¤å’Œå‚æ•°åŸºæœ¬éƒ½æ²¡æœ‰å†ç”¨äº†ã€‚&lt;/li>
&lt;/ul>
&lt;p>æ›´å¤šå…³äº Docker v20.10 çš„ç›¸å…³å†…å®¹ï¼Œè¯·æŸ¥çœ‹å…¶ &lt;a href="https://github.com/moby/moby/releases" title="Docker ReleaseNote">ReleaseNote&lt;/a>ã€‚&lt;/p>
&lt;h2 id="coredns-v183-å‘å¸ƒ">CoreDNS v1.8.3 å‘å¸ƒ&lt;/h2>
&lt;p>åœ¨ä¹‹å‰çš„æ–‡ç«  &lt;a href="https://zhuanlan.zhihu.com/p/278701087">K8S ç”Ÿæ€å‘¨æŠ¥| Helm v3.4 å‘å¸ƒ&lt;/a> ä¸­æˆ‘ä»‹ç»äº† CoreDNS v1.8.0 ç‰ˆæœ¬ç›¸å…³çš„ç‰¹æ€§åŠå˜æ›´,æ„Ÿå…´è¶£çš„å°ä¼™ä¼´å¯ä»¥å¤ä¹ ä¸€ä¸‹ã€‚æœ¬æ¬¡æˆ‘æ¥ä»‹ç»ä¸‹è‡ª CoreDNS v1.8.1 åˆ° v1.8.3 ä¹‹é—´æœ‰å“ªäº›å€¼å¾—å…³æ³¨çš„å˜æ›´ã€‚&lt;/p>
&lt;ul>
&lt;li>æ–°å¢äº†ä¸€ä¸ªåä¸º &lt;a href="https://coredns.io/plugins/local/">local&lt;/a> çš„ pluginï¼Œç”¨äºå“åº” local çš„è¯·æ±‚ã€‚å³ï¼šæ‰€æœ‰ &lt;code>localhost.&amp;lt;domain&amp;gt;&lt;/code> çš„è¯·æ±‚éƒ½ä¼šè§£æä¸º 127.0.0.1 ä¾‹å¦‚ï¼š&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">âœ ~ dig +short @127.0.0.1 -p &lt;span class="m">9987&lt;/span> localhost.moelove.info
127.0.0.1
&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¦‚æœ Corefile ä¸­å¯ç”¨äº† &lt;code>debug&lt;/code> å’Œ &lt;code>log&lt;/code> plugin çš„è¯ï¼Œä¼šçœ‹åˆ°ç±»ä¼¼çš„è¾“å‡ºï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="o">[&lt;/span>DEBUG&lt;span class="o">]&lt;/span> plugin/local: Intercepting localhost query &lt;span class="k">for&lt;/span> &lt;span class="s2">&amp;#34;localhost.moelove.info.&amp;#34;&lt;/span> A, from 127.0.0.1
&lt;span class="o">[&lt;/span>INFO&lt;span class="o">]&lt;/span> 127.0.0.1:37324 - &lt;span class="m">17796&lt;/span> &lt;span class="s2">&amp;#34;A IN localhost.moelove.info. udp 63 false 4096&amp;#34;&lt;/span> NOERROR qr,rd &lt;span class="m">78&lt;/span> 0.000327638s
&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¸»è¦æ˜¯ä¸ºäº†è§£æ localhost åè·Ÿä»»æ„çš„ domain name çš„è¯·æ±‚ã€‚æ›´å…·ä½“çš„èƒŒæ™¯è¯·å‚è€ƒ &lt;a href="https://github.com/coredns/coredns/issues/4260">issue #4260&lt;/a>ã€‚&lt;/p>
&lt;ul>
&lt;li>ä¿®æ­£äº† file plugin ä¸­å¯¹äºé“¾å¼ CNAME æŸ¥è¯¢æ—¶çš„è¿”å›å€¼ã€‚æ ¹æ® &lt;a href="https://tools.ietf.org/html/rfc6604#section-3" title="RFC 6604">RFC 6604&lt;/a> ä¸­çš„è¯´æ˜ï¼Œå½“éµå¾ªé“¾å¼æŸ¥è¯¢æ—¶ï¼Œè¿”å›å€¼åº”è¯¥ä¸æœ€åä¸€æ¬¡çš„æŸ¥è¯¢ç»“æœç›¸åŒã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“å‡ºç° &amp;quot;A CNAME B&amp;quot; ä½†æ˜¯ B ä¸å­˜åœ¨çš„æƒ…å†µæ—¶ï¼Œåº”å½“è¿”å› &lt;code>NXDOMAIN&lt;/code> è€Œä¸æ˜¯ &lt;code>NOERROR&lt;/code>ã€‚&lt;/li>
&lt;/ul>
&lt;p>æˆ‘ç”¨ä¸‹é¢çš„é…ç½®è¿›è¡Œè¯´æ˜ï¼Œé¦–å…ˆå†™ä¸€ä¸ª zone æ–‡ä»¶ï¼Œå¹¶å‘½åä¸º test.moelove.info.txt ï¼š&lt;/p>
&lt;pre>&lt;code>$ORIGIN moelove.info.
@ 3600 SOA ns1.foo.com. (
zone-admin.foo.com. ; address of responsible party
2016072701 ; serial number
3600 ; refresh period
600 ; retry period
604800 ; expire time
1800 ) ; minimum ttl
86400 NS ns1.foo.com.
86400 NS ns2.foo.com.
3600 MX 10 mail.moelove.info.
60 A 10.10.10.10
3600 TXT &amp;quot;v=moe includemoelove.info ~all&amp;quot;
mail 14400 A 11.11.11.11
www 43200 CNAME moelove.info.
b.c 43200 CNAME c.c.moelove.info.
c.c 43200 CNAME d.c.moelove.info.
&lt;/code>&lt;/pre>&lt;p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œå°† &lt;code>b.c&lt;/code> CNAME åˆ° &lt;code>c.c&lt;/code> ï¼Œ&lt;code>c.c&lt;/code> CNAME åˆ° &lt;code>d.c&lt;/code> ï¼Œä½†æ˜¯ &lt;code>d.c&lt;/code> å¹¶ä¸å­˜åœ¨ã€‚&lt;/p>
&lt;p>CoreDNS ç”¨ä¸‹é¢çš„å†…å®¹ä½œä¸ºé…ç½®ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="l">moelove.info {&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">file test.moelove.info.txt&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">log&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">debug&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>}&lt;span class="w">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åˆ†åˆ«ä½¿ç”¨ CoreDNS v1.7.1 å’Œ v1.8.3 è¿›è¡Œæµ‹è¯•ï¼š&lt;/p>
&lt;p>&lt;strong>v1.7.1&lt;/strong>&lt;/p>
&lt;pre>&lt;code>âœ ~ ./coredns-v1.7 -conf Corefile -dns.port 9987
&lt;/code>&lt;/pre>&lt;p>ä½¿ç”¨ dig è¿›è¡Œæµ‹è¯•ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">âœ ~ dig @127.0.0.1 -p &lt;span class="m">9987&lt;/span> b.c.moelove.info
&lt;span class="p">;&lt;/span> &amp;lt;&amp;lt;&amp;gt;&amp;gt; DiG 9.11.27-RedHat-9.11.27-1.fc32 &amp;lt;&amp;lt;&amp;gt;&amp;gt; @127.0.0.1 -p &lt;span class="m">9987&lt;/span> b.c.moelove.info
&lt;span class="p">;&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">1&lt;/span> server found&lt;span class="o">)&lt;/span>
&lt;span class="p">;;&lt;/span> global options: +cmd
&lt;span class="p">;;&lt;/span> Got answer:
&lt;span class="p">;;&lt;/span> -&amp;gt;&amp;gt;HEADER&lt;span class="s">&amp;lt;&amp;lt;- opco&lt;/span>de: QUERY, status: NOERROR, id: &lt;span class="m">14077&lt;/span>
&lt;span class="p">;;&lt;/span> flags: qr aa rd&lt;span class="p">;&lt;/span> QUERY: 1, ANSWER: 2, AUTHORITY: 2, ADDITIONAL: &lt;span class="m">1&lt;/span>
&lt;span class="p">;;&lt;/span> WARNING: recursion requested but not available
&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¯ä»¥çœ‹åˆ°è¿”å›ä¸­ &lt;code>status: NOERROR&lt;/code> ã€‚&lt;/p>
&lt;p>&lt;strong>v1.8.3&lt;/strong>&lt;/p>
&lt;pre>&lt;code>âœ ~ ./coredns-v1.8 -conf Corefile -dns.port 9988
&lt;/code>&lt;/pre>&lt;p>ä½¿ç”¨ dig è¿›è¡Œæµ‹è¯•ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">âœ ~ dig @127.0.0.1 -p &lt;span class="m">9988&lt;/span> b.c.moelove.info
&lt;span class="p">;&lt;/span> &amp;lt;&amp;lt;&amp;gt;&amp;gt; DiG 9.11.27-RedHat-9.11.27-1.fc32 &amp;lt;&amp;lt;&amp;gt;&amp;gt; @127.0.0.1 -p &lt;span class="m">9988&lt;/span> b.c.moelove.info
&lt;span class="p">;&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">1&lt;/span> server found&lt;span class="o">)&lt;/span>
&lt;span class="p">;;&lt;/span> global options: +cmd
&lt;span class="p">;;&lt;/span> Got answer:
&lt;span class="p">;;&lt;/span> -&amp;gt;&amp;gt;HEADER&lt;span class="s">&amp;lt;&amp;lt;- opco&lt;/span>de: QUERY, status: NXDOMAIN, id: &lt;span class="m">832&lt;/span>
&lt;span class="p">;;&lt;/span> flags: qr aa rd&lt;span class="p">;&lt;/span> QUERY: 1, ANSWER: 2, AUTHORITY: 2, ADDITIONAL: &lt;span class="m">1&lt;/span>
&lt;span class="p">;;&lt;/span> WARNING: recursion requested but not available
&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¯ä»¥çœ‹åˆ°è¿”å›ä¸­æ˜¯ &lt;code>status: NXDOMAIN&lt;/code> ã€‚&lt;/p>
&lt;p>è¿™ä¸ªä¿®æ­£å¯¹äºæˆ‘ä»¬åˆ¤æ–­ DNS è®°å½•æ˜¯å¦æ­£ç¡®/å·¥ä½œæ˜¯å¦æ­£å¸¸ï¼Œæœ‰å¾ˆå¤§çš„å¸®åŠ©ã€‚&lt;/p>
&lt;p>æ›´å¤šå…³äº CoreDNS v1.8+ ç‰ˆæœ¬çš„ç‰¹æ€§å˜æ›´ï¼Œè¯·å‚è€ƒå…¶ &lt;a href="https://coredns.io/2021/02/24/coredns-1.8.3-release/" title="CoreDNS ReleaseNote">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="ä¸Šæ¸¸è¿›å±•">ä¸Šæ¸¸è¿›å±•&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/pull/99561">#99561&lt;/a> æ­£å¼ç§»é™¤äº† Bazel æ„å»ºç³»ç»Ÿï¼è¿™æ˜¯ä¸€ä¸ªéå¸¸å¤§çš„å˜æ›´ï¼Œæ¶‰åŠåˆ°çš„å†…å®¹å¾ˆå¹¿ï¼Œä½†æ²¡ä»€ä¹ˆå¤ªéœ€è¦ä»‹ç»çš„ï¼Œè¿™ä¸€å¤©ç»ˆäºæ¥å•¦ï¼Œè½»æ¾äº†å¾ˆå¤šï¼&lt;/li>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/pull/99158">#99158&lt;/a> æ”¯æŒä¸º Pod è®¾ç½® Sysctls çš„ç‰¹æ€§ç°åœ¨å·²ç» GAï¼Œ è¿™æ˜¯ä¸€ä¸ªä» K8S v1.4 ç‰ˆæœ¬å¼€å§‹çš„åŠŸèƒ½ï¼Œåˆ° v1.11 çš„æ—¶å€™è¿›å…¥ Betaï¼Œå¦‚ä»Šæ­£å¼ GAï¼Œå¹¶å°†åœ¨ v1.21 ä¸­å…¬å¸ƒï¼Œä¸”ä¼šé»˜è®¤å¯ç”¨æ­¤ç‰¹æ€§ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/pull/97099">#97099&lt;/a> &lt;strong>ç”¨æˆ·å¯ä»¥é€šè¿‡ &lt;code>kubectl.kubernetes.io/default-container&lt;/code> å£°æ˜ kubectl exec æ—¶çš„é»˜è®¤å®¹å™¨äº†&lt;/strong>ï¼Œè¿™ä¸ªåŠŸèƒ½ç±»ä¼¼äº &lt;code>kubectl.kubernetes.io/default-logs-container&lt;/code> çš„å£°æ˜ï¼Œæˆ‘ä»¬å¯ä»¥å°†ä¸»ä½“å®¹å™¨ä½œä¸ºé»˜è®¤å®¹å™¨ï¼Œè¿™æ · exec æˆ–è€… logs çš„æ—¶å€™ï¼Œå°±ä¸éœ€è¦å†å»æŒ‡å®šå®¹å™¨åç§°äº†ï¼Œéå¸¸å®ç”¨ï¼ å½“ç„¶ï¼Œ&lt;code>kubectl cp&lt;/code> ä¹Ÿä¼šéµå¾ªæ­¤è¡Œä¸ºã€‚&lt;/li>
&lt;/ul>
&lt;hr>
&lt;p>æ¬¢è¿è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://gitee.com/tlrr/awesome/raw/master/2020-9-9/1599632564572-mp-qrcode.png" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| Helm v3.5 æ­£å¼å‘å¸ƒï¼Œå¸¦æ¥å®Œå¤‡çš„ OCI æ”¯æŒ</title><link>https://moelove.info/2021/02/21/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Helm-v3.5-%E6%AD%A3%E5%BC%8F%E5%8F%91%E5%B8%83%E5%B8%A6%E6%9D%A5%E5%AE%8C%E5%A4%87%E7%9A%84-OCI-%E6%94%AF%E6%8C%81/</link><guid isPermaLink="true">https://moelove.info/2021/02/21/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Helm-v3.5-%E6%AD%A3%E5%BC%8F%E5%8F%91%E5%B8%83%E5%B8%A6%E6%9D%A5%E5%AE%8C%E5%A4%87%E7%9A%84-OCI-%E6%94%AF%E6%8C%81/</guid><pubDate>Sun, 21 Feb 2021 22:25:43 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container" title="k8sç”Ÿæ€">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="kind-v010-æ­£å¼å‘å¸ƒ">KIND v0.10 æ­£å¼å‘å¸ƒ&lt;/h2>
&lt;p>KIND ï¼ˆKubernetes In Docker ï¼‰æ˜¯æˆ‘å¾ˆå–œæ¬¢ä¹Ÿä¸€ç›´åœ¨å‚ä¸è´¡çŒ®çš„ Kubernetes SIG å­é¡¹ç›®ï¼Œæœ¬å‘¨ KIND å‘å¸ƒäº† v0.10 ç‰ˆæœ¬ï¼Œè·ç¦»ä¸Šæ¬¡ v0.9 ç‰ˆæœ¬å·²è¿‡å»äº† 4 ä¸ªå¤šæœˆï¼Œåœ¨æ­¤æœŸé—´ï¼Œæˆ‘ä»¬åšäº†å¾ˆå¤šçš„ä¼˜åŒ–å’Œæ”¹è¿›ã€‚ä¸‹é¢æˆ‘æ¥å…·ä½“ä»‹ç»ä¸‹ï¼š&lt;/p>
&lt;h3 id="ç ´åæ€§å˜æ›´">ç ´åæ€§å˜æ›´&lt;/h3>
&lt;p>è¿™ä¸ªéƒ¨åˆ†æ˜¾ç„¶æ˜¯å¤§å®¶æœ€ä¸ºå…³å¿ƒçš„ï¼Œè¿™é‡Œæœ‰ä¸‰ä¸ªéœ€è¦æ³¨æ„çš„ç‚¹ï¼š&lt;/p>
&lt;ul>
&lt;li>é»˜è®¤çš„ Node é•œåƒç‰ˆæœ¬å·²ç»æ›´æ–°ä¸ºäº† Kubernetes v1.20.2 ç‰ˆæœ¬ï¼Œæ‰€ä»¥ä¸ªåˆ«æœ‰å…³ Kubernetes è‡ªèº«ç‰¹æ€§å˜æ›´çš„æ–¹é¢éœ€è¦æ³¨æ„ä¸‹ï¼›&lt;/li>
&lt;li>IPv6 Pod å­ç½‘é»˜è®¤ä» /64 ä¿®æ”¹æˆäº† /56 ï¼Œè¿™é‡Œçš„ä¿®æ”¹å‚è€ƒäº†&lt;a href="https://www.ripe.net/publications/docs/ripe-690#4--size-of-end-user-prefix-assignment---48---56-or-something-else-" title="ç»ˆç«¯ç”¨æˆ·çš„ IPv6 å­ç½‘åˆ’åˆ†æœ€ä½³å®è·µ"> RIPE çš„ä¸€ç¯‡å…³äº IPv6 å­ç½‘è§„åˆ’çš„æœ€ä½³å®è·µ&lt;/a>ï¼Œæœ‰å…´è¶£çš„æœ‹å‹å¯ä»¥äº†è§£ä¸‹ï¼›&lt;/li>
&lt;li>æˆ‘ä»¬ç›®å‰èƒ½ä¿éšœ KIND ä¸ v1.14.0+ çš„ Kubernetes å®Œå¤‡çš„å…¼å®¹ï¼Œä½†å¯¹äº v1.13.x ç‰ˆæœ¬æˆ‘ä»¬åªèƒ½å°½é‡åšåˆ°æœ€å¥½ï¼›&lt;/li>
&lt;/ul>
&lt;h3 id="æ–°ç‰¹æ€§">æ–°ç‰¹æ€§&lt;/h3>
&lt;ul>
&lt;li>å½“æ„å»º v1.19+ ç‰ˆæœ¬çš„ Kubernetes é•œåƒæ—¶ï¼Œå¯ä»¥ä¸æ„å»º dockershim ç»„ä»¶ï¼Œä»¥ä¾¿å‡å°é•œåƒçš„ä½“ç§¯ï¼›&lt;/li>
&lt;li>é€šè¿‡ä¼˜åŒ–ç¼–è¯‘å‚æ•°ï¼Œæ˜¾è‘—çš„å‡å°‘äº† KIND äºŒè¿›åˆ¶æ–‡ä»¶çš„ä½“ç§¯ï¼ˆ~7MBï¼‰ï¼›&lt;/li>
&lt;li>&lt;code>kind export logs&lt;/code> å¯¼å‡ºçš„ log ä¸­å°†åŒ…å« KIND çš„ç‰ˆæœ¬ä¿¡æ¯ï¼Œä»¥ä¾¿äºæ›´å¥½çš„å®šä½é—®é¢˜ï¼›&lt;/li>
&lt;li>å®éªŒæ€§ä½¿ç”¨ GitHub Action CI æä¾› docker/podman/cgroup v2 ç­‰ç¯å¢ƒçš„æ”¯æŒï¼›&lt;/li>
&lt;li>æ–‡æ¡£å†…å®¹çš„ä¼˜åŒ–å’Œå®Œå–„ï¼ŒåŒ…æ‹¬ WSL2ï¼Œè´Ÿè½½å‡è¡¡ç­‰æ–¹é¢ï¼›&lt;/li>
&lt;/ul>
&lt;h3 id="ä¿®æ­£">ä¿®æ­£&lt;/h3>
&lt;ul>
&lt;li>ä¼˜åŒ–äº† cgroups ç›¸å…³çš„å¤„ç†é€»è¾‘ï¼›&lt;/li>
&lt;li>ä¼˜åŒ–äº†ä¸€äº›é”™è¯¯ä¿¡æ¯çš„å†…å®¹ï¼›&lt;/li>
&lt;/ul>
&lt;p>å¤§å®¶å¯ä»¥ç›´æ¥åœ¨&lt;a href="https://github.com/kubernetes-sigs/kind/releases/tag/v0.10.0" title="KIND v0.10.0 Release"> KIND v0.10.0 ç‰ˆæœ¬çš„ Release é¡µé¢&lt;/a>ä¸‹è½½é¢„ç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶æ–‡ä»¶è¿›è¡Œä½“éªŒï¼Œæœ‰ä»»ä½•é—®é¢˜æ¬¢è¿éšæ—¶åé¦ˆã€‚&lt;/p>
&lt;h2 id="helm-v35-æ­£å¼å‘å¸ƒ">Helm v3.5 æ­£å¼å‘å¸ƒ&lt;/h2>
&lt;p>Helm v3.5 æ˜¯ Helm çš„ä¸€ä¸ªç‰¹æ€§ç‰ˆæœ¬ï¼Œæ­¤ç‰ˆæœ¬çš„ç‰¹æ€§ä¸»è¦é›†ä¸­åœ¨ OCI æ”¯æŒå’Œæ¨¡æ¿å‡½æ•°ï¼Œä»¥ä¸‹æ˜¯æˆ‘è®¤ä¸ºå€¼å¾—å…³æ³¨çš„ä¸€äº›å˜æ›´ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;a href="https://github.com/helm/helm/pull/9126">#9126&lt;/a> Helm çš„ template ä¸­æ–°å¢åŠ äº†è¶…è¿‡ 20 ä¸ªçš„å‡½æ•°æ”¯æŒï¼Œå…·ä½“å‡½æ•°åˆ—è¡¨å¯&lt;a href="https://github.com/Masterminds/sprig/releases/tag/v3.2.0" title="Helm v3.5 æ–°å¢å‡½æ•°è¯´æ˜">å‚è€ƒ sprig çš„åˆ—è¡¨&lt;/a>ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a href="https://github.com/helm/helm/pull/8843">#8843&lt;/a> å…è®¸åœ¨è®¾ç½®äº† &lt;code>HELM_EXPERIMENTAL_OCI&lt;/code> ç¯å¢ƒå˜é‡çš„å‰æä¸‹ï¼Œé€šè¿‡ &lt;code>helm pull oci://&lt;/code> çš„æ–¹å¼æ¥ä¸‹è½½ OCI ä»“åº“ä¸­ä¸‹è½½ Chart å’Œæ›´æ–°ä¾èµ–ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a href="https://github.com/helm/helm/pull/8886">#8886&lt;/a> ä¸º &lt;code>helm dep build&lt;/code> å¢åŠ äº†ä¸€ä¸ª &lt;code>--skip-refresh&lt;/code> çš„å‚æ•°ï¼Œè¿™æ ·å°±ä¸ä¼šåˆ·æ–°æœ¬åœ°ä»“åº“ä¸­çš„ cache äº†ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a href="https://github.com/helm/helm/pull/8363">#8363&lt;/a> æ·»åŠ äº†ä¸€ä¸ª &lt;code>wait-for-jobs&lt;/code> çš„å‚æ•°ï¼Œå½“åŒæ—¶è®¾ç½®äº† &lt;code>--wait&lt;/code> æ—¶å€™ï¼Œ&lt;code>helm install&lt;/code> ç­‰å‘½ä»¤å°†ä¼šç­‰å¾…æ‰€æœ‰çš„ Job éƒ½æ‰§è¡Œå®Œæˆåï¼Œæ‰ä¼šè®¤ä¸ºæœ¬æ¬¡æ“ä½œå®Œæˆã€‚å½“ç„¶ï¼Œå®ƒä¹Ÿä¼šå—åˆ° &lt;code>--timeout&lt;/code> å‚æ•°çš„å½±å“ï¼Œæœ€å¤šç­‰å¾…æ—¶é—´ä¸ä¼šè¶…è¿‡ timeout è®¾ç½®çš„æ—¶é—´ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a href="https://github.com/helm/helm/pull/8958">#8958&lt;/a> æ·»åŠ äº† &lt;code>--kube-cafile&lt;/code> çš„å‚æ•°å’Œç­‰ä»·çš„ &lt;code>HELM_KUBECAFILE&lt;/code> ç¯å¢ƒå˜é‡ï¼Œç”¨æ¥æŒ‡å®šè¿æ¥ Kubernetes æ—¶çš„ CA ã€‚åœ¨æ­¤å˜æ›´ä¹‹å‰ï¼Œå¦‚æœ Kubernetes é›†ç¾¤çš„è¯ä¹¦æœªåœ¨ç³»ç»Ÿå±‚ä¿¡ä»»çš„è¯ï¼Œå°±ä¼šå‡ºç°å¤±è´¥çš„æƒ…å†µï¼Œæç¤º &lt;code>x509: certificate signed by unknown authority&lt;/code> ä¹‹ç±»çš„ã€‚ä»¥ä¸‹æ˜¯ä¸‰ç§å¯ç”¨çš„è§£å†³æ–¹æ¡ˆï¼š&lt;/p>
&lt;ul>
&lt;li>åœ¨ç³»ç»Ÿå±‚ä¿¡ä»»è¯ä¹¦ï¼Œè¿™ä¸ªå°±ä¸å¤šè¯´äº†ï¼›&lt;/li>
&lt;li>Kubeconfig å¢åŠ  certificate-authorityï¼š&lt;/li>
&lt;/ul>
&lt;pre>&lt;code>KUBECONFIG=~/.mycustomkubeconfig
kubectl config set-cluster internal.company --server=https://internal.company:443 --certificate-authority=/tmp/ca.crt
kubectl config set-context some-context --cluster=internal.company --namespace=myns
kubectl config use-context some-context
HELM_NAMESPACE=myns HELM_KUBEAPISERVER=https://internal.company:443 helm install --kubeconfig=&amp;quot;${KUBECONFIG}&amp;quot; some-app company/some-app
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>é€šè¿‡æ­¤å¤„æä¾›çš„ &lt;code>HELM_KUBECAFILE&lt;/code> çš„ç¯å¢ƒå˜é‡ï¼š&lt;/li>
&lt;/ul>
&lt;pre>&lt;code>HELM_NAMESPACE=myns HELM_KUBEAPISERVER=https://internal.company:443 HELM_KUBECAFILE=/tmp/ca.crt helm install some-app company/some-app
&lt;/code>&lt;/pre>&lt;p>å¯ä»¥çœ‹åˆ°ï¼Œæ–¹ä¾¿äº†å¾ˆå¤šã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a href="https://github.com/helm/helm/pull/8626">#8626&lt;/a> ç”¨ Artifact Hub æ›¿ä»£äº† Helm Hub ã€‚æˆ‘åœ¨å»å¹´çš„ &lt;a href="https://zhuanlan.zhihu.com/p/267670759" title="Helm Hub è¿ç§»åˆ° Artifact Hub">K8S ç”Ÿæ€å‘¨æŠ¥| Helm äº”å‘¨å²å•¦ï¼&lt;/a> ä¸­æ›¾å…·ä½“ä»‹ç»è¿‡æ­¤äº‹ï¼Œæ„Ÿå…´è¶£çš„å°ä¼™ä¼´å¯ä»¥çœ‹çœ‹å…·ä½“å†…å®¹ï¼›&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>æ›´å¤šå…³äºæ­¤ç‰ˆæœ¬çš„å˜æ›´ï¼Œè¯·å‚è€ƒå…¶ &lt;a href="https://github.com/helm/helm/releases/tag/v3.5.0" title="Helm v3.5 Release">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="äº‹ä»¶">äº‹ä»¶&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://www.docker.com/blog/donating-docker-distribution-to-the-cncf/" title="Docker æŠŠ Distribution æç»™äº† CNCF">Docker æŠŠ Distribution æç»™äº† CNCF&lt;/a>ï¼ŒDocker Distribution æ˜¯ Docker Hub åŠä¼—å¤šé•œåƒä»“åº“çš„åº•å±‚å®ç°ï¼Œæç»™ CNCF æœ‰æœ›ä¸ºå…¶å¸¦æ¥æ›´å¼ºå¤§çš„ç”Ÿå‘½åŠ›ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/docker/hub-tool">Docker Hub Tool å¼€æºå•¦&lt;/a> å¯ä»¥åœ¨æˆ‘ä¹‹å‰çš„&lt;a href="https://zhuanlan.zhihu.com/p/339131328">Docker Hub Tool æ–‡ç« &lt;/a>ä¸­äº†è§£å…¶å…·ä½“ç‰¹æ€§ï¼›&lt;/li>
&lt;/ul>
&lt;h2 id="ä¸Šæ¸¸è¿›å±•">ä¸Šæ¸¸è¿›å±•&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/pull/96021">#96021&lt;/a> å½“å¾€ CSI å·ä¸Šåˆ›å»ºå·æ•°æ®æ–‡ä»¶æœŸé—´å¦‚æœå‘ç”Ÿå¼‚å¸¸ï¼Œä¸ä¼šå†è‡ªåŠ¨åˆ é™¤å…¨éƒ¨æ•°æ®äº†ï¼Œç°åœ¨ä»…åˆ é™¤æ•°æ®æ–‡ä»¶å’Œå·è·¯å¾„ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/pull/98678">#98678&lt;/a> TTLAfterFinished ç‰¹æ€§å°†é»˜è®¤å¯ç”¨ï¼Œå¹¶ä¸”å‡çº§è‡³ beta ã€‚æ­¤ç‰¹æ€§æ˜¯ç”¨äºæ§åˆ¶ Job å’Œ Pod å®Œæˆåçš„æ¸…ç†æ—¶é—´ï¼Œé€šè¿‡ &lt;code>.spec.ttlSecondsAfterFinished&lt;/code> è¿›è¡Œè®¾ç½®ï¼Œåœ¨èµ„æºåˆ›å»ºæˆ–å®Œæˆåéƒ½å¯ä»¥ä¿®æ”¹è¿™ä¸ªå€¼ï¼Œä½†æ˜¯ä¸€æ—¦è¶…è¿‡ TTLï¼Œå¹¶ä¸” K8S è®¤ä¸ºå¯åˆ é™¤èµ„æºçš„æ—¶å€™ï¼Œå†ä¿®æ”¹è¿™ä¸ª TTL ä¹Ÿæ²¡æœ‰æ•ˆæœäº†ï¼›&lt;/li>
&lt;/ul>
&lt;hr>
&lt;p>æ¬¢è¿è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://gitee.com/tlrr/awesome/raw/master/2020-9-9/1599632564572-mp-qrcode.png" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>ä» Go çš„äºŒè¿›åˆ¶æ–‡ä»¶ä¸­è·å–å…¶ä¾èµ–çš„æ¨¡å—ä¿¡æ¯</title><link>https://moelove.info/2021/02/17/%E4%BB%8E-Go-%E7%9A%84%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%96%87%E4%BB%B6%E4%B8%AD%E8%8E%B7%E5%8F%96%E5%85%B6%E4%BE%9D%E8%B5%96%E7%9A%84%E6%A8%A1%E5%9D%97%E4%BF%A1%E6%81%AF/</link><guid isPermaLink="true">https://moelove.info/2021/02/17/%E4%BB%8E-Go-%E7%9A%84%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%96%87%E4%BB%B6%E4%B8%AD%E8%8E%B7%E5%8F%96%E5%85%B6%E4%BE%9D%E8%B5%96%E7%9A%84%E6%A8%A1%E5%9D%97%E4%BF%A1%E6%81%AF/</guid><pubDate>Wed, 17 Feb 2021 23:44:41 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å¼ æ™‹æ¶›ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬ç”¨ Go æ„å»ºçš„äºŒè¿›åˆ¶æ–‡ä»¶ä¸­é»˜è®¤åŒ…å«äº†å¾ˆå¤šæœ‰ç”¨çš„ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥è·å–æ„å»ºç”¨çš„ Go ç‰ˆæœ¬ï¼š&lt;/p>
&lt;p>(è¿™é‡Œæˆ‘ä½¿ç”¨æˆ‘ä¸€ç›´å‚ä¸çš„ä¸€ä¸ªå¼€æºé¡¹ç›® &lt;a href="https://github.com/kubernetes-sigs/kind" title="KIND é¡¹ç›®åœ°å€">KIND&lt;/a> ä¸ºä¾‹)&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">âœ kind git:&lt;span class="o">(&lt;/span>master&lt;span class="o">)&lt;/span> âœ— go version ./bin/kind
./bin/kind: go1.16
&lt;/code>&lt;/pre>&lt;/div>&lt;p>æˆ–è€…ä¹Ÿå¯ä»¥è·å–è¯¥äºŒè¿›åˆ¶æ‰€ä¾èµ–çš„æ¨¡å—ä¿¡æ¯ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">âœ kind git:&lt;span class="o">(&lt;/span>master&lt;span class="o">)&lt;/span> âœ— go version -m ./bin/kind
./bin/kind: go1.16
path sigs.k8s.io/kind
mod sigs.k8s.io/kind &lt;span class="o">(&lt;/span>devel&lt;span class="o">)&lt;/span>
dep github.com/BurntSushi/toml v0.3.1
dep github.com/alessio/shellescape v1.4.1
dep github.com/evanphx/json-patch/v5 v5.2.0
dep github.com/mattn/go-isatty v0.0.12
dep github.com/pelletier/go-toml v1.8.1 h1:1Nf83orprkJyknT6h7zbuEGUEjcyVlCxSUGTENmNCRM&lt;span class="o">=&lt;/span>
dep github.com/pkg/errors v0.9.1
dep github.com/spf13/cobra v1.1.1
dep github.com/spf13/pflag v1.0.5
dep golang.org/x/sys v0.0.0-20210124154548-22da62e12c0c h1:VwygUrnw9jn88c4u8GD3rZQbqrP/tgas88tPUbBxQrk&lt;span class="o">=&lt;/span>
dep gopkg.in/yaml.v2 v2.2.8
dep gopkg.in/yaml.v3 v3.0.0-20210107192922-496545a6307b h1:h8qDotaEPuJATrMmW04NCwg7v22aHH28wwpauUhK9Oo&lt;span class="o">=&lt;/span>
dep k8s.io/apimachinery v0.20.2
dep sigs.k8s.io/yaml v1.2.0
&lt;/code>&lt;/pre>&lt;/div>&lt;p>æŸ¥çœ‹ KIND ä»£ç ä»“åº“ä¸­çš„ &lt;a href="https://github.com/kubernetes-sigs/kind/blob/f291e2baed5346e139afa802453eab85bb30215e/go.mod#L5-L18">go.mod&lt;/a>æ–‡ä»¶ï¼Œéƒ½åŒ…å«åœ¨å†…äº†ã€‚&lt;/p>
&lt;p>å…¶å® Linux ç³»ç»Ÿä¸­äºŒè¿›åˆ¶æ–‡ä»¶åŒ…å«é¢å¤–çš„ä¿¡æ¯å¹¶é Go æ‰€ç‰¹æœ‰çš„ï¼Œä¸‹é¢æˆ‘å°†å…·ä½“ä»‹ç»å…¶å†…éƒ¨åŸç†å’Œå®ç°ã€‚å½“ç„¶ï¼Œç”¨ Go æ„å»ºçš„äºŒè¿›åˆ¶æ–‡ä»¶ä»æ˜¯æœ¬æ–‡çš„ä¸»è§’ã€‚&lt;/p>
&lt;h2 id="linux-elf-æ ¼å¼">Linux ELF æ ¼å¼&lt;/h2>
&lt;p>ELF æ˜¯ Executable and Linkable Format çš„ç¼©å†™ï¼Œæ˜¯ä¸€ç§ç”¨äºå¯æ‰§è¡Œæ–‡ä»¶ã€ç›®æ ‡æ–‡ä»¶ã€å…±äº«åº“å’Œæ ¸å¿ƒè½¬å‚¨(core dump)çš„æ ‡å‡†æ–‡ä»¶æ ¼å¼ã€‚ELF æ–‡ä»¶ &lt;strong>é€šå¸¸&lt;/strong> æ˜¯ç¼–è¯‘å™¨ä¹‹ç±»çš„è¾“å‡ºï¼Œå¹¶ä¸”æ˜¯äºŒè¿›åˆ¶æ ¼å¼ã€‚ä»¥ Go ç¼–è¯‘å‡ºçš„å¯æ‰§è¡Œæ–‡ä»¶ä¸ºä¾‹ï¼Œæˆ‘ä»¬ä½¿ç”¨ file å‘½ä»¤å³å¯çœ‹åˆ°å…¶å…·ä½“ç±»å‹ &lt;code>ELF 64-bit LSB executable&lt;/code> ï¼š&lt;/p>
&lt;pre>&lt;code>âœ kind git:(master) âœ— file ./bin/kind
./bin/kind: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), statically linked, not stripped
&lt;/code>&lt;/pre>&lt;p>æœ¬æ–‡ä¸­æˆ‘ä»¬æ¥å…·ä½“çœ‹çœ‹ 64 ä½å¯æ‰§è¡Œæ–‡ä»¶ä½¿ç”¨çš„ ELF æ–‡ä»¶æ ¼å¼çš„ç»“æ„å’Œ Linux å†…æ ¸æºç ä¸­å¯¹å®ƒçš„å®šä¹‰ã€‚&lt;/p>
&lt;p>ä½¿ç”¨ ELF æ–‡ä»¶æ ¼å¼çš„å¯æ‰§è¡Œæ–‡ä»¶æ˜¯ç”± &lt;strong>ELF å¤´ï¼ˆELF Headerï¼‰&lt;/strong> å¼€å§‹ï¼Œåè·Ÿ &lt;strong>ç¨‹åºå¤´ï¼ˆProgram Headerï¼‰&lt;/strong> æˆ– &lt;strong>èŠ‚å¤´ï¼ˆSection Headerï¼‰&lt;/strong> æˆ–ä¸¤è€…å‡æœ‰ç»„æˆçš„ã€‚&lt;/p>
&lt;h3 id="elf-å¤´">ELF å¤´&lt;/h3>
&lt;p>&lt;strong>ELF å¤´å§‹ç»ˆä½äºæ–‡ä»¶çš„é›¶åç§»ï¼ˆzero offsetï¼‰å¤„ï¼ˆå³ï¼šèµ·ç‚¹ä½ç½®ï¼‰ï¼ŒåŒæ—¶åœ¨ ELF å¤´ä¸­è¿˜å®šä¹‰äº†ç¨‹åºå¤´å’ŒèŠ‚å¤´çš„åç§»é‡ã€‚&lt;/strong>&lt;/p>
&lt;p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ readelf å‘½ä»¤æŸ¥çœ‹å¯æ‰§è¡Œæ–‡ä»¶çš„ ELF å¤´ï¼Œå¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="l">âœ kind git:(master) âœ— readelf -h ./bin/kind &lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">ELF Header&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">Magic&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">7f 45 4c 46 02 01 01 00 00 00 00 00 00 00 00 00 &lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">Class&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ELF64&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">Data&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">2&lt;/span>&lt;span class="l">&amp;#39;s complement, little endian&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">Version&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">1&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">(current)&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">OS/ABI&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">UNIX - System V&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">ABI Version&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">0&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">Type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">EXEC (Executable file)&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">Machine&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Advanced Micro Devices X86-64&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">Version&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">0x1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">Entry point address&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">0x46c460&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">Start of program headers&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">64&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">(bytes into file)&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">Start of section headers&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">400&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">(bytes into file)&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">Flags&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">0x0&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">Size of this header&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">64&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">(bytes)&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">Size of program headers&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">56&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">(bytes)&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">Number of program headers&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">6&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">Size of section headers&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">64&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">(bytes)&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">Number of section headers&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">15&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">Section header string table index&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">3&lt;/span>&lt;span class="w">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä»ä¸Šé¢çš„è¾“å‡ºæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒELF å¤´æ˜¯ä»¥æŸä¸ª Magic å¼€å§‹çš„ï¼Œæ­¤ Magic æ ‡è¯†äº†æœ‰å…³æ–‡ä»¶çš„ä¿¡æ¯ï¼Œå³ï¼šå‰å››ä¸ª 16 è¿›åˆ¶æ•°ï¼Œè¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ª ELF æ–‡ä»¶ã€‚å…·ä½“æ¥è¯´ï¼Œå°†å®ƒä»¬æ¢ç®—æˆå…¶å¯¹åº”çš„ ASCII ç å³å¯ï¼š&lt;/p>
&lt;p>45 = E&lt;/p>
&lt;p>4c = L&lt;/p>
&lt;p>46 = F&lt;/p>
&lt;p>7f æ˜¯å…¶å‰ç¼€ï¼Œå½“ç„¶ï¼Œä¹Ÿå¯ä»¥ç›´æ¥åœ¨ &lt;a href="https://github.com/torvalds/linux/blob/2c85ebc57b3e1817b6ce1a6b703928e113a90442/include/uapi/linux/elf.h#L340-L343" title="ELF Magic å†…æ ¸æºç ">Linux å†…æ ¸æºç &lt;/a>ä¸­æ‹¿åˆ°æ­¤å¤„çš„å…·ä½“å®šä¹‰ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-c" data-lang="c">&lt;span class="c1">// include/uapi/linux/elf.h#L340-L343
&lt;/span>&lt;span class="c1">&lt;/span>&lt;span class="cp">#define ELFMAG0 0x7f &lt;/span>&lt;span class="cm">/* EI_MAG */&lt;/span>&lt;span class="cp">
&lt;/span>&lt;span class="cp">#define ELFMAG1 &amp;#39;E&amp;#39;
&lt;/span>&lt;span class="cp">#define ELFMAG2 &amp;#39;L&amp;#39;
&lt;/span>&lt;span class="cp">#define ELFMAG3 &amp;#39;F&amp;#39;
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ¥ä¸‹æ¥çš„æ•° 02 æ˜¯ä¸ Class å­—æ®µç›¸å¯¹åº”çš„ï¼Œè¡¨ç¤ºå…¶ä½“ç³»ç»“æ„ï¼Œå®ƒå¯ä»¥æ˜¯ 32 ä½ï¼ˆ=01ï¼‰ æˆ–æ˜¯ 64 ä½ï¼ˆ=02ï¼‰çš„ï¼Œæ­¤å¤„æ˜¾ç¤º 02 è¡¨ç¤ºæ˜¯ 64 ä½çš„ï¼Œå†æœ‰ readelf å°†å…¶è½¬æ¢ä¸º ELF64 è¿›è¡Œå±•ç¤ºã€‚è¿™é‡Œçš„å–å€¼åŒæ ·å¯ä»¥åœ¨ &lt;a href="https://github.com/torvalds/linux/blob/2c85ebc57b3e1817b6ce1a6b703928e113a90442/include/uapi/linux/elf.h#L347-L350" title="ELF Class å†…æ ¸å®šä¹‰">Linux å†…æ ¸æºç &lt;/a>ä¸­æ‰¾åˆ°ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-c" data-lang="c">&lt;span class="c1">// include/uapi/linux/elf.h#L347-L349
&lt;/span>&lt;span class="c1">&lt;/span>&lt;span class="cp">#define ELFCLASSNONE 0 &lt;/span>&lt;span class="cm">/* EI_CLASS */&lt;/span>&lt;span class="cp">
&lt;/span>&lt;span class="cp">#define ELFCLASS32 1
&lt;/span>&lt;span class="cp">#define ELFCLASS64 2
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å†åé¢çš„ä¸¤ä¸ª 01 01 åˆ™æ˜¯ä¸ Data å­—æ®µå’Œ Version å­—æ®µç›¸å¯¹åº”çš„ï¼ŒData æœ‰ä¸¤ä¸ªå–å€¼åˆ†åˆ«æ˜¯ LSBï¼ˆ01ï¼‰å’Œ MSBï¼ˆ02ï¼‰ï¼Œè¿™é‡Œå€’æ²¡ä»€ä¹ˆå¿…è¦å±•å¼€ã€‚å¦å¤–å°±æ˜¯ Version å½“å‰åªæœ‰ä¸€ä¸ªå–å€¼ï¼Œå³ 01 ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-c" data-lang="c">&lt;span class="c1">// include/uapi/linux/elf.h#L352-L358
&lt;/span>&lt;span class="c1">&lt;/span>&lt;span class="cp">#define ELFDATANONE 0 &lt;/span>&lt;span class="cm">/* e_ident[EI_DATA] */&lt;/span>&lt;span class="cp">
&lt;/span>&lt;span class="cp">#define ELFDATA2LSB 1
&lt;/span>&lt;span class="cp">#define ELFDATA2MSB 2
&lt;/span>&lt;span class="cp">&lt;/span>
&lt;span class="cp">#define EV_NONE 0 &lt;/span>&lt;span class="cm">/* e_version, EI_VERSION */&lt;/span>&lt;span class="cp">
&lt;/span>&lt;span class="cp">#define EV_CURRENT 1
&lt;/span>&lt;span class="cp">#define EV_NUM 2
&lt;/span>&lt;span class="cp">&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ¥ä¸‹æ¥éœ€è¦æ³¨æ„çš„å°±æ˜¯æˆ‘å‰é¢æåˆ°çš„å…³äºåç§»é‡çš„å†…å®¹ï¼Œå³è¾“å‡ºä¸­çš„ä»¥ä¸‹å†…å®¹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh"> Start of program headers: &lt;span class="m">64&lt;/span> &lt;span class="o">(&lt;/span>bytes into file&lt;span class="o">)&lt;/span>
Start of section headers: &lt;span class="m">400&lt;/span> &lt;span class="o">(&lt;/span>bytes into file&lt;span class="o">)&lt;/span>
Flags: 0x0
Size of this header: &lt;span class="m">64&lt;/span> &lt;span class="o">(&lt;/span>bytes&lt;span class="o">)&lt;/span>
Size of program headers: &lt;span class="m">56&lt;/span> &lt;span class="o">(&lt;/span>bytes&lt;span class="o">)&lt;/span>
Number of program headers: &lt;span class="m">6&lt;/span>
Size of section headers: &lt;span class="m">64&lt;/span> &lt;span class="o">(&lt;/span>bytes&lt;span class="o">)&lt;/span>
Number of section headers: &lt;span class="m">15&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>ELF å¤´æ€»æ˜¯åœ¨èµ·ç‚¹ï¼Œåœ¨æ­¤ä¾‹ä¸­æ¥ä¸‹æ¥æ˜¯ç¨‹åºå¤´ï¼ˆProgram Headerï¼‰ï¼Œéšåæ˜¯èŠ‚å¤´ï¼ˆSection Headerï¼‰ï¼Œè¿™é‡Œçš„è¾“å‡ºæ˜¾ç¤ºç¨‹åºå¤´æ˜¯ä» 64 å¼€å§‹çš„ï¼Œæ‰€ä»¥èŠ‚å¤´çš„ä½ç½®å°±æ˜¯ï¼š&lt;/p>
&lt;pre>&lt;code>64 + 56 * 6 = 400
&lt;/code>&lt;/pre>&lt;p>ä¸ä¸Šè¿°è¾“å‡ºç¬¦åˆï¼ŒåŒç†ï¼ŒèŠ‚å¤´çš„ç»“æŸä½ç½®æ˜¯ï¼š&lt;/p>
&lt;pre>&lt;code>400 + 15 * 64 = 1360
&lt;/code>&lt;/pre>&lt;p>ä¸‹ä¸€èŠ‚å†…å®¹ä¸­å°†ç”¨åˆ°è¿™éƒ¨åˆ†çŸ¥è¯†ã€‚&lt;/p>
&lt;h3 id="ç¨‹åºå¤´">ç¨‹åºå¤´&lt;/h3>
&lt;p>é€šè¿‡ &lt;code>readelf -l&lt;/code> å¯ä»¥çœ‹åˆ°å…¶ç¨‹åºå¤´ï¼ŒåŒ…å«äº†è‹¥å¹²æ®µï¼ˆSegmentï¼‰ï¼Œå†…æ ¸çœ‹åˆ°è¿™äº›æ®µæ—¶ï¼Œå°†è°ƒç”¨ mmap syscall æ¥ä½¿ç”¨å®ƒä»¬æ˜ å°„åˆ°è™šæ‹Ÿåœ°å€ç©ºé—´ã€‚è¿™éƒ¨åˆ†ä¸æ˜¯æœ¬æ–‡çš„é‡ç‚¹ï¼Œæˆ‘ä»¬æš‚ä¸”è·³è¿‡æœ‰ä¸ªå°è±¡å³å¯ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">âœ kind git:&lt;span class="o">(&lt;/span>master&lt;span class="o">)&lt;/span> âœ— readelf -l ./bin/kind
Elf file &lt;span class="nb">type&lt;/span> is EXEC &lt;span class="o">(&lt;/span>Executable file&lt;span class="o">)&lt;/span>
Entry point 0x46c460
There are &lt;span class="m">6&lt;/span> program headers, starting at offset &lt;span class="m">64&lt;/span>
Program Headers:
Type Offset VirtAddr PhysAddr
FileSiz MemSiz Flags Align
PHDR 0x0000000000000040 0x0000000000400040 0x0000000000400040
0x0000000000000150 0x0000000000000150 R 0x1000
LOAD 0x0000000000000000 0x0000000000400000 0x0000000000400000
0x0000000000333a75 0x0000000000333a75 R E 0x1000
LOAD 0x0000000000334000 0x0000000000734000 0x0000000000734000
0x00000000002b3be8 0x00000000002b3be8 R 0x1000
LOAD 0x00000000005e8000 0x00000000009e8000 0x00000000009e8000
0x0000000000020ac0 0x00000000000552d0 RW 0x1000
GNU_STACK 0x0000000000000000 0x0000000000000000 0x0000000000000000
0x0000000000000000 0x0000000000000000 RW 0x8
LOOS+0x5041580 0x0000000000000000 0x0000000000000000 0x0000000000000000
0x0000000000000000 0x0000000000000000 0x8
Section to Segment mapping:
Segment Sections...
&lt;span class="m">00&lt;/span>
&lt;span class="m">01&lt;/span> .text
&lt;span class="m">02&lt;/span> .rodata .typelink .itablink .gosymtab .gopclntab
&lt;span class="m">03&lt;/span> .go.buildinfo .noptrdata .data .bss .noptrbss
&lt;span class="m">04&lt;/span>
&lt;span class="m">05&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="èŠ‚å¤´">èŠ‚å¤´&lt;/h3>
&lt;p>ä½¿ç”¨ &lt;code>readelf -S&lt;/code> å³å¯æŸ¥çœ‹å…¶èŠ‚å¤´ï¼Œå…¶ç»“æ„å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-c" data-lang="c">&lt;span class="c1">// include/uapi/linux/elf.h#L317-L328
&lt;/span>&lt;span class="c1">&lt;/span>&lt;span class="k">typedef&lt;/span> &lt;span class="k">struct&lt;/span> &lt;span class="n">elf64_shdr&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="n">Elf64_Word&lt;/span> &lt;span class="n">sh_name&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="cm">/* Section name, index in string tbl */&lt;/span>
&lt;span class="n">Elf64_Word&lt;/span> &lt;span class="n">sh_type&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="cm">/* Type of section */&lt;/span>
&lt;span class="n">Elf64_Xword&lt;/span> &lt;span class="n">sh_flags&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="cm">/* Miscellaneous section attributes */&lt;/span>
&lt;span class="n">Elf64_Addr&lt;/span> &lt;span class="n">sh_addr&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="cm">/* Section virtual addr at execution */&lt;/span>
&lt;span class="n">Elf64_Off&lt;/span> &lt;span class="n">sh_offset&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="cm">/* Section file offset */&lt;/span>
&lt;span class="n">Elf64_Xword&lt;/span> &lt;span class="n">sh_size&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="cm">/* Size of section in bytes */&lt;/span>
&lt;span class="n">Elf64_Word&lt;/span> &lt;span class="n">sh_link&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="cm">/* Index of another section */&lt;/span>
&lt;span class="n">Elf64_Word&lt;/span> &lt;span class="n">sh_info&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="cm">/* Additional section information */&lt;/span>
&lt;span class="n">Elf64_Xword&lt;/span> &lt;span class="n">sh_addralign&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="cm">/* Section alignment */&lt;/span>
&lt;span class="n">Elf64_Xword&lt;/span> &lt;span class="n">sh_entsize&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="cm">/* Entry size if section holds table */&lt;/span>
&lt;span class="p">}&lt;/span> &lt;span class="n">Elf64_Shdr&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¯¹ç…§å®é™…çš„å‘½ä»¤è¾“å‡ºï¼Œå«ä¹‰å°±å¾ˆæ˜æ˜¾äº†ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">âœ kind git:&lt;span class="o">(&lt;/span>master&lt;span class="o">)&lt;/span> âœ— readelf -S ./bin/kind
There are &lt;span class="m">15&lt;/span> section headers, starting at offset 0x190:
Section Headers:
&lt;span class="o">[&lt;/span>Nr&lt;span class="o">]&lt;/span> Name Type Address Offset
Size EntSize Flags Link Info Align
&lt;span class="o">[&lt;/span> 0&lt;span class="o">]&lt;/span> NULL &lt;span class="m">0000000000000000&lt;/span> &lt;span class="m">00000000&lt;/span>
&lt;span class="m">0000000000000000&lt;/span> &lt;span class="m">0000000000000000&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="m">0&lt;/span>
&lt;span class="o">[&lt;/span> 1&lt;span class="o">]&lt;/span> .text PROGBITS &lt;span class="m">0000000000401000&lt;/span> &lt;span class="m">00001000&lt;/span>
0000000000332a75 &lt;span class="m">0000000000000000&lt;/span> AX &lt;span class="m">0&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="m">32&lt;/span>
&lt;span class="o">[&lt;/span> 2&lt;span class="o">]&lt;/span> .rodata PROGBITS &lt;span class="m">0000000000734000&lt;/span> &lt;span class="m">00334000&lt;/span>
000000000011f157 &lt;span class="m">0000000000000000&lt;/span> A &lt;span class="m">0&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="m">32&lt;/span>
&lt;span class="o">[&lt;/span> 3&lt;span class="o">]&lt;/span> .shstrtab STRTAB &lt;span class="m">0000000000000000&lt;/span> &lt;span class="m">00453160&lt;/span>
00000000000000a4 &lt;span class="m">0000000000000000&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="m">1&lt;/span>
&lt;span class="o">[&lt;/span> 4&lt;span class="o">]&lt;/span> .typelink PROGBITS &lt;span class="m">0000000000853220&lt;/span> &lt;span class="m">00453220&lt;/span>
00000000000022a0 &lt;span class="m">0000000000000000&lt;/span> A &lt;span class="m">0&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="m">32&lt;/span>
&lt;span class="o">[&lt;/span> 5&lt;span class="o">]&lt;/span> .itablink PROGBITS 00000000008554c0 004554c0
&lt;span class="m">0000000000000978&lt;/span> &lt;span class="m">0000000000000000&lt;/span> A &lt;span class="m">0&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="m">32&lt;/span>
&lt;span class="o">[&lt;/span> 6&lt;span class="o">]&lt;/span> .gosymtab PROGBITS 0000000000855e38 00455e38
&lt;span class="m">0000000000000000&lt;/span> &lt;span class="m">0000000000000000&lt;/span> A &lt;span class="m">0&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="m">1&lt;/span>
&lt;span class="o">[&lt;/span> 7&lt;span class="o">]&lt;/span> .gopclntab PROGBITS 0000000000855e40 00455e40
0000000000191da8 &lt;span class="m">0000000000000000&lt;/span> A &lt;span class="m">0&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="m">32&lt;/span>
&lt;span class="o">[&lt;/span> 8&lt;span class="o">]&lt;/span> .go.buildinfo PROGBITS 00000000009e8000 005e8000
&lt;span class="m">0000000000000020&lt;/span> &lt;span class="m">0000000000000000&lt;/span> WA &lt;span class="m">0&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="m">16&lt;/span>
&lt;span class="o">[&lt;/span> 9&lt;span class="o">]&lt;/span> .noptrdata PROGBITS 00000000009e8020 005e8020
&lt;span class="m">0000000000017240&lt;/span> &lt;span class="m">0000000000000000&lt;/span> WA &lt;span class="m">0&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="m">32&lt;/span>
&lt;span class="o">[&lt;/span>10&lt;span class="o">]&lt;/span> .data PROGBITS 00000000009ff260 005ff260
&lt;span class="m">0000000000009850&lt;/span> &lt;span class="m">0000000000000000&lt;/span> WA &lt;span class="m">0&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="m">32&lt;/span>
&lt;span class="o">[&lt;/span>11&lt;span class="o">]&lt;/span> .bss NOBITS 0000000000a08ac0 00608ac0
000000000002f170 &lt;span class="m">0000000000000000&lt;/span> WA &lt;span class="m">0&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="m">32&lt;/span>
&lt;span class="o">[&lt;/span>12&lt;span class="o">]&lt;/span> .noptrbss NOBITS 0000000000a37c40 00637c40
&lt;span class="m">0000000000005690&lt;/span> &lt;span class="m">0000000000000000&lt;/span> WA &lt;span class="m">0&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="m">32&lt;/span>
&lt;span class="o">[&lt;/span>13&lt;span class="o">]&lt;/span> .symtab SYMTAB &lt;span class="m">0000000000000000&lt;/span> &lt;span class="m">00609000&lt;/span>
0000000000030a20 &lt;span class="m">0000000000000018&lt;/span> &lt;span class="m">14&lt;/span> &lt;span class="m">208&lt;/span> &lt;span class="m">8&lt;/span>
&lt;span class="o">[&lt;/span>14&lt;span class="o">]&lt;/span> .strtab STRTAB &lt;span class="m">0000000000000000&lt;/span> 00639a20
000000000004178d &lt;span class="m">0000000000000000&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="m">1&lt;/span>
Key to Flags:
W &lt;span class="o">(&lt;/span>write&lt;span class="o">)&lt;/span>, A &lt;span class="o">(&lt;/span>alloc&lt;span class="o">)&lt;/span>, X &lt;span class="o">(&lt;/span>execute&lt;span class="o">)&lt;/span>, M &lt;span class="o">(&lt;/span>merge&lt;span class="o">)&lt;/span>, S &lt;span class="o">(&lt;/span>strings&lt;span class="o">)&lt;/span>, I &lt;span class="o">(&lt;/span>info&lt;span class="o">)&lt;/span>,
L &lt;span class="o">(&lt;/span>link order&lt;span class="o">)&lt;/span>, O &lt;span class="o">(&lt;/span>extra OS processing required&lt;span class="o">)&lt;/span>, G &lt;span class="o">(&lt;/span>group&lt;span class="o">)&lt;/span>, T &lt;span class="o">(&lt;/span>TLS&lt;span class="o">)&lt;/span>,
C &lt;span class="o">(&lt;/span>compressed&lt;span class="o">)&lt;/span>, x &lt;span class="o">(&lt;/span>unknown&lt;span class="o">)&lt;/span>, o &lt;span class="o">(&lt;/span>OS specific&lt;span class="o">)&lt;/span>, E &lt;span class="o">(&lt;/span>exclude&lt;span class="o">)&lt;/span>,
l &lt;span class="o">(&lt;/span>large&lt;span class="o">)&lt;/span>, p &lt;span class="o">(&lt;/span>processor specific&lt;span class="o">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="go-äºŒè¿›åˆ¶æ–‡ä»¶æ¢ç§˜">Go äºŒè¿›åˆ¶æ–‡ä»¶æ¢ç§˜&lt;/h2>
&lt;p>&lt;strong>æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬é‡ç‚¹å…³æ³¨åä¸º &lt;code>.go.buildinfo&lt;/code> çš„éƒ¨åˆ†ã€‚&lt;/strong> ä½¿ç”¨ objdump æŸ¥çœ‹å…¶å…·ä½“å†…å®¹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">âœ kind git:&lt;span class="o">(&lt;/span>master&lt;span class="o">)&lt;/span> âœ— objdump -s -j .go.buildinfo ./bin/kind
./bin/kind: file format elf64-x86-64
Contents of section .go.buildinfo:
9e8000 ff20476f &lt;span class="m">20627569&lt;/span> 6c64696e 663a0800 . Go buildinf:..
9e8010 a0fc9f00 &lt;span class="m">00000000&lt;/span> e0fc9f00 &lt;span class="m">00000000&lt;/span> ................
&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™é‡Œæˆ‘ä»¬æŒ‰é¡ºåºæ¥ï¼Œå…ˆçœ‹åˆ°ç¬¬ä¸€è¡Œçš„ 16 ä¸ªå­—èŠ‚ã€‚&lt;/p>
&lt;p>&lt;img src="https://moelove.info/img/elf-go-buildinfo.png" alt="">&lt;/p>
&lt;ul>
&lt;li>å‰ 14 ä¸ªå­—èŠ‚æ˜¯é­”æœ¯å­—èŠ‚ï¼Œå¿…é¡»ä¸º &lt;code>\xff Go buildinf:&lt;/code> ï¼›&lt;/li>
&lt;li>ç¬¬ 15 å­—èŠ‚è¡¨ç¤ºå…¶æŒ‡é’ˆå¤§å°ï¼Œè¿™é‡Œçš„å€¼ä¸º &lt;code>0x08&lt;/code>ï¼Œè¡¨ç¤º 8 ä¸ªå­—èŠ‚ï¼›&lt;/li>
&lt;li>ç¬¬ 16 å­—èŠ‚ç”¨äºåˆ¤æ–­å­—èŠ‚åºæ˜¯å¤§ç«¯æ¨¡å¼è¿˜æ˜¯å°ç«¯æ¨¡å¼ï¼Œé 0 ä¸ºå¤§ç«¯æ¨¡å¼ï¼Œ0 ä¸ºå°ç«¯æ¨¡å¼ã€‚&lt;/li>
&lt;/ul>
&lt;p>æˆ‘ä»¬ç»§ç»­çœ‹ç¬¬ 17 å­—èŠ‚å¼€å§‹çš„å†…å®¹ã€‚&lt;/p>
&lt;h3 id="go-ç‰ˆæœ¬ä¿¡æ¯">Go ç‰ˆæœ¬ä¿¡æ¯&lt;/h3>
&lt;p>å‰é¢æˆ‘ä»¬ä¹Ÿçœ‹åˆ°äº†å½“å‰ä½¿ç”¨çš„å­—èŠ‚åºæ˜¯å°ç«¯æ¨¡å¼ï¼Œè¿™é‡Œçš„åœ°å€åº”è¯¥æ˜¯ &lt;code>0x009ffca0&lt;/code> ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬æ¥å–å‡º 16 å­—èŠ‚çš„å†…å®¹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">âœ kind git:&lt;span class="o">(&lt;/span>master&lt;span class="o">)&lt;/span> âœ— objdump -s --start-address 0x009ffca0 --stop-address 0x009ffcb0 ./bin/kind
./bin/kind: file format elf64-x86-64
Contents of section .data:
9ffca0 f5027d00 &lt;span class="m">00000000&lt;/span> &lt;span class="m">06000000&lt;/span> &lt;span class="m">00000000&lt;/span> ..&lt;span class="o">}&lt;/span>.............
&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™é‡Œå‰é¢çš„ 8 ä¸ªå­—èŠ‚æ˜¯ Go ç‰ˆæœ¬çš„ä¿¡æ¯ï¼Œå 8 ä¸ªå­—èŠ‚æ˜¯ç‰ˆæœ¬æ‰€å çš„å¤§å°ï¼ˆè¿™é‡Œè¡¨ç¤ºå  6 ä¸ªå­—èŠ‚ï¼‰ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">âœ kind git:&lt;span class="o">(&lt;/span>master&lt;span class="o">)&lt;/span> âœ— objdump -s --start-address 0x007d02f5 --stop-address 0x007d02fb ./bin/kind
./bin/kind: file format elf64-x86-64
Contents of section .rodata:
7d02f5 676f31 2e3136 go1.16
&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ‰€ä»¥ï¼Œå¦‚ä¸Šæ‰€ç¤ºï¼Œæˆ‘ä»¬æ‹¿åˆ°äº†æ„å»ºæ­¤äºŒè¿›åˆ¶æ–‡ä»¶æ‰€ç”¨çš„ Go ç‰ˆæœ¬çš„ä¿¡æ¯ï¼Œæ˜¯ç”¨ Go 1.16 è¿›è¡Œæ„å»ºçš„ã€‚&lt;/p>
&lt;h3 id="go-module-ä¿¡æ¯">Go Module ä¿¡æ¯&lt;/h3>
&lt;p>å‰é¢æˆ‘ä»¬ä½¿ç”¨äº† 17~24 å­—èŠ‚çš„ä¿¡æ¯ï¼Œè¿™æ¬¡æˆ‘ä»¬ç»§ç»­å¾€åä½¿ç”¨ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">âœ kind git:&lt;span class="o">(&lt;/span>master&lt;span class="o">)&lt;/span> âœ— objdump -s --start-address 0x009ffce0 --stop-address 0x009ffcf0 ./bin/kind
./bin/kind: file format elf64-x86-64
Contents of section .data:
9ffce0 5a567e00 &lt;span class="m">00000000&lt;/span> e6020000 &lt;span class="m">00000000&lt;/span> ZV~.............
&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¸å‰é¢è·å– Go ç‰ˆæœ¬ä¿¡æ¯æ—¶ç›¸åŒï¼Œå‰ 8 ä¸ªå­—èŠ‚æ˜¯æŒ‡é’ˆï¼Œå 8 ä¸ªå­—èŠ‚æ˜¯å…¶å¤§å°ã€‚ä¹Ÿå°±æ˜¯è¯´ä» &lt;code>0x007e565a&lt;/code> å¼€å§‹ï¼Œå¤§å°ä¸º &lt;code>0x000002e6&lt;/code> ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ‹¿åˆ°ä»¥ä¸‹å†…å®¹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">âœ kind git:&lt;span class="o">(&lt;/span>master&lt;span class="o">)&lt;/span> âœ— objdump -s --start-address 0x007e565a --stop-address 0x7e5940 ./bin/kind
./bin/kind: file format elf64-x86-64
Contents of section .rodata:
7e565a &lt;span class="m">3077&lt;/span> af0c9274 080241e1 c107e6d6 18e6 0w...t..A.......
7e566a &lt;span class="m">7061&lt;/span> &lt;span class="m">74680973&lt;/span> 6967732e 6b38732e 696f path.sigs.k8s.io
7e567a 2f6b 696e640a 6d6f6409 &lt;span class="m">73696773&lt;/span> 2e6b /kind.mod.sigs.k
7e568a &lt;span class="m">3873&lt;/span> 2e696f2f 6b696e64 &lt;span class="m">09286465&lt;/span> &lt;span class="m">7665&lt;/span> 8s.io/kind.&lt;span class="o">(&lt;/span>deve
7e569a 6c29 090a6465 &lt;span class="m">70096769&lt;/span> &lt;span class="m">74687562&lt;/span> 2e63 l&lt;span class="o">)&lt;/span>..dep.github.c
7e56aa 6f6d 2f427572 6e745375 7368692f 746f om/BurntSushi/to
7e56ba 6d6c 0976302e 332e3109 0a646570 &lt;span class="m">0967&lt;/span> ml.v0.3.1..dep.g
7e56ca &lt;span class="m">6974&lt;/span> 6875622e 636f6d2f 616c6573 &lt;span class="m">7369&lt;/span> ithub.com/alessi
7e56da 6f2f 7368656c 6c657363 &lt;span class="m">61706509&lt;/span> &lt;span class="m">7631&lt;/span> o/shellescape.v1
7e56ea 2e34 2e31090a &lt;span class="m">64657009&lt;/span> &lt;span class="m">67697468&lt;/span> &lt;span class="m">7562&lt;/span> .4.1..dep.github
7e56fa 2e63 6f6d2f65 76616e70 68782f6a 736f .com/evanphx/jso
7e570a 6e2d &lt;span class="m">70617463&lt;/span> 682f7635 0976352e 322e n-patch/v5.v5.2.
7e571a &lt;span class="m">3009&lt;/span> 0a646570 &lt;span class="m">09676974&lt;/span> 6875622e 636f 0..dep.github.co
7e572a 6d2f 6d617474 6e2f676f 2d697361 &lt;span class="m">7474&lt;/span> m/mattn/go-isatt
7e573a &lt;span class="m">7909&lt;/span> 76302e30 2e313209 0a646570 &lt;span class="m">0967&lt;/span> y.v0.0.12..dep.g
7e574a &lt;span class="m">6974&lt;/span> 6875622e 636f6d2f 70656c6c &lt;span class="m">6574&lt;/span> ithub.com/pellet
7e575a &lt;span class="m">6965&lt;/span> 722f676f 2d746f6d 6c097631 2e38 ier/go-toml.v1.8
7e576a 2e31 0968313a 314e6638 336f7270 726b .1.h1:1Nf83orprk
7e577a 4a79 6b6e5436 68377a62 &lt;span class="m">75454755&lt;/span> 456a JyknT6h7zbuEGUEj
7e578a &lt;span class="m">6379&lt;/span> 566c4378 &lt;span class="m">53554754&lt;/span> 454e6d4e &lt;span class="m">4352&lt;/span> cyVlCxSUGTENmNCR
7e579a 4d3d 0a646570 &lt;span class="m">09676974&lt;/span> 6875622e 636f &lt;span class="nv">M&lt;/span>&lt;span class="o">=&lt;/span>.dep.github.co
7e57aa 6d2f 706b672f 6572726f &lt;span class="m">72730976&lt;/span> 302e m/pkg/errors.v0.
7e57ba 392e 31090a64 &lt;span class="m">65700967&lt;/span> &lt;span class="m">69746875&lt;/span> 622e 9.1..dep.github.
7e57ca 636f 6d2f7370 6631332f 636f6272 &lt;span class="m">6109&lt;/span> com/spf13/cobra.
7e57da &lt;span class="m">7631&lt;/span> 2e312e31 090a6465 &lt;span class="m">70096769&lt;/span> &lt;span class="m">7468&lt;/span> v1.1.1..dep.gith
7e57ea &lt;span class="m">7562&lt;/span> 2e636f6d 2f737066 31332f70 666c ub.com/spf13/pfl
7e57fa &lt;span class="m">6167&lt;/span> 0976312e 302e3509 0a646570 &lt;span class="m">0967&lt;/span> ag.v1.0.5..dep.g
7e580a 6f6c 616e672e 6f72672f 782f7379 &lt;span class="m">7309&lt;/span> olang.org/x/sys.
7e581a &lt;span class="m">7630&lt;/span> 2e302e30 2d323032 &lt;span class="m">31303132&lt;/span> &lt;span class="m">3431&lt;/span> v0.0.0-202101241
7e582a &lt;span class="m">3534&lt;/span> 3534382d &lt;span class="m">32326461&lt;/span> &lt;span class="m">36326531&lt;/span> &lt;span class="m">3263&lt;/span> 54548-22da62e12c
7e583a &lt;span class="m">3063&lt;/span> 0968313a &lt;span class="m">56777967&lt;/span> 55726e77 396a 0c.h1:VwygUrnw9j
7e584a 6e38 &lt;span class="m">38633475&lt;/span> &lt;span class="m">38474433&lt;/span> 725a5162 &lt;span class="m">7172&lt;/span> n88c4u8GD3rZQbqr
7e585a 502f &lt;span class="m">74676173&lt;/span> &lt;span class="m">38387450&lt;/span> &lt;span class="m">55624278&lt;/span> &lt;span class="m">5172&lt;/span> P/tgas88tPUbBxQr
7e586a 6b3d 0a646570 09676f70 6b672e69 6e2f &lt;span class="nv">k&lt;/span>&lt;span class="o">=&lt;/span>.dep.gopkg.in/
7e587a &lt;span class="m">7961&lt;/span> 6d6c2e76 &lt;span class="m">32097632&lt;/span> 2e322e38 090a yaml.v2.v2.2.8..
7e588a &lt;span class="m">6465&lt;/span> 7009676f 706b672e 696e2f79 616d dep.gopkg.in/yam
7e589a 6c2e &lt;span class="m">76330976&lt;/span> 332e302e 302d3230 &lt;span class="m">3231&lt;/span> l.v3.v3.0.0-2021
7e58aa &lt;span class="m">3031&lt;/span> &lt;span class="m">30373139&lt;/span> &lt;span class="m">32393232&lt;/span> 2d343936 &lt;span class="m">3534&lt;/span> 0107192922-49654
7e58ba &lt;span class="m">3561&lt;/span> &lt;span class="m">36333037&lt;/span> &lt;span class="m">62096831&lt;/span> 3a683871 446f 5a6307b.h1:h8qDo
7e58ca &lt;span class="m">7461&lt;/span> 4550754a 4154724d 6d573034 4e43 taEPuJATrMmW04NC
7e58da &lt;span class="m">7767&lt;/span> &lt;span class="m">37763232&lt;/span> &lt;span class="m">61484832&lt;/span> &lt;span class="m">38777770&lt;/span> &lt;span class="m">6175&lt;/span> wg7v22aHH28wwpau
7e58ea &lt;span class="m">5568&lt;/span> 4b394f6f 3d0a6465 70096b38 732e &lt;span class="nv">UhK9Oo&lt;/span>&lt;span class="o">=&lt;/span>.dep.k8s.
7e58fa 696f 2f617069 6d616368 696e6572 &lt;span class="m">7909&lt;/span> io/apimachinery.
7e590a &lt;span class="m">7630&lt;/span> 2e32302e 32090a64 &lt;span class="m">65700973&lt;/span> &lt;span class="m">6967&lt;/span> v0.20.2..dep.sig
7e591a 732e 6b38732e 696f2f79 616d6c09 &lt;span class="m">7631&lt;/span> s.k8s.io/yaml.v1
7e592a 2e32 2e30090a f9324331 &lt;span class="m">86182072&lt;/span> &lt;span class="m">0082&lt;/span> .2.0...2C1.. r..
7e593a &lt;span class="m">4210&lt;/span> 4116d8f2 B.A...
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>æˆ‘ä»¬æˆåŠŸçš„æ‹¿åˆ°äº†å…¶æ‰€ä¾èµ–çš„ Modules ç›¸å…³çš„ä¿¡æ¯ï¼Œ&lt;/strong>
è¿™ä¸æˆ‘ä»¬åœ¨æ–‡ç« å¼€å¤´æ‰§è¡Œ &lt;code>go version -m ./bin/kind&lt;/code> æ˜¯å¯ä»¥åŒ¹é…ä¸Šçš„ï¼Œåªä¸è¿‡è¿™é‡Œçš„å†…å®¹ç›¸å½“äºæ˜¯åšäº†åºåˆ—åŒ–ã€‚&lt;/p>
&lt;h2 id="å…·ä½“å®ç°">å…·ä½“å®ç°&lt;/h2>
&lt;p>åœ¨å‰é¢çš„å†…å®¹ä¸­ï¼Œå…³äºå¦‚ä½•ä½¿ç”¨ readelf å’Œ objdump å‘½ä»¤è·å–äºŒè¿›åˆ¶æ–‡ä»¶çš„çš„ Go ç‰ˆæœ¬å’Œ Module ä¿¡æ¯å°±å·²ç»æ¶‰åŠåˆ°äº†å…¶å…·ä½“çš„åŸç†ã€‚è¿™é‡Œæˆ‘æ¥ä»‹ç»ä¸‹ Go ä»£ç çš„å®ç°ã€‚&lt;/p>
&lt;p>èŠ‚å¤´çš„åç§°æ˜¯&lt;a href="https://github.com/golang/go/blob/f21be2fdc6f1becdbed1592ea0b245cdeedc5ac8/src/cmd/go/internal/version/exe.go#L106-L110">ç¡¬ç¼–ç åœ¨ä»£ç &lt;/a>ä¸­çš„&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="c1">//src/cmd/go/internal/version/exe.go#L106-L110
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="nx">_&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">s&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="k">range&lt;/span> &lt;span class="nx">x&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">f&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Sections&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">s&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Name&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s">&amp;#34;.go.buildinfo&amp;#34;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="nx">s&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Addr&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>åŒæ—¶ï¼Œé­”æœ¯å­—èŠ‚ä¹Ÿæ˜¯é€šè¿‡å¦‚ä¸‹å®šä¹‰ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="kd">var&lt;/span> &lt;span class="nx">buildInfoMagic&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="p">[]&lt;/span>&lt;span class="nb">byte&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;\xff Go buildinf:&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>è·å– Version å’Œ Module ç›¸å…³ä¿¡æ¯çš„é€»è¾‘å¦‚ä¸‹ï¼Œåœ¨å‰é¢çš„å†…å®¹ä¸­ä¹Ÿå·²ç»åŸºæœ¬ä»‹ç»è¿‡äº†ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„çš„ä¹Ÿå°±æ˜¯å­—èŠ‚åºç›¸å…³çš„éƒ¨åˆ†äº†ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-go" data-lang="go"> &lt;span class="nx">ptrSize&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nb">int&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">data&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">14&lt;/span>&lt;span class="p">])&lt;/span>
&lt;span class="nx">bigEndian&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">data&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">15&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;span class="kd">var&lt;/span> &lt;span class="nx">bo&lt;/span> &lt;span class="nx">binary&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">ByteOrder&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">bigEndian&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">bo&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">binary&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">BigEndian&lt;/span>
&lt;span class="p">}&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">bo&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">binary&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">LittleEndian&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="kd">var&lt;/span> &lt;span class="nx">readPtr&lt;/span> &lt;span class="kd">func&lt;/span>&lt;span class="p">([]&lt;/span>&lt;span class="kt">byte&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="kt">uint64&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">ptrSize&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mi">4&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">readPtr&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="kd">func&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">b&lt;/span> &lt;span class="p">[]&lt;/span>&lt;span class="kt">byte&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="kt">uint64&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="nb">uint64&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">bo&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Uint32&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">b&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="p">}&lt;/span>
&lt;span class="p">}&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">readPtr&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">bo&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Uint64&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="nx">vers&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nf">readString&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">x&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">ptrSize&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">readPtr&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nf">readPtr&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">data&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">16&lt;/span>&lt;span class="p">:]))&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">vers&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s">&amp;#34;&amp;#34;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">return&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="nx">mod&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nf">readString&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">x&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">ptrSize&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">readPtr&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nf">readPtr&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">data&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">16&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="nx">ptrSize&lt;/span>&lt;span class="p">:]))&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nb">len&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">mod&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">&amp;gt;=&lt;/span> &lt;span class="mi">33&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="nx">mod&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nb">len&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">mod&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">17&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="sc">&amp;#39;\n&amp;#39;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="c1">// Strip module framing.
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="nx">mod&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">mod&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">16&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="nb">len&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">mod&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">16&lt;/span>&lt;span class="p">]&lt;/span>
&lt;span class="p">}&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">mod&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s">&amp;#34;&amp;#34;&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="æ€»ç»“">æ€»ç»“&lt;/h2>
&lt;p>æˆ‘åœ¨è¿™ç¯‡æ–‡ç« ä¸­åˆ†äº«äº†å¦‚ä½•ä» Go çš„äºŒè¿›åˆ¶æ–‡ä»¶ä¸­è·å–æ„å»ºå®ƒæ—¶æ‰€ç”¨çš„ Go ç‰ˆæœ¬åŠå®ƒä¾èµ–çš„æ¨¡å—ä¿¡æ¯ã€‚å¦‚æœå¯¹åŸç†ä¸æ„Ÿå…´è¶£çš„è¯ï¼Œç›´æ¥é€šè¿‡ &lt;code>go version -m äºŒè¿›åˆ¶æ–‡ä»¶&lt;/code> å³å¯è·å–ç›¸å…³çš„ä¿¡æ¯ã€‚&lt;/p>
&lt;p>å…·ä½“å®ç°è¿˜æ˜¯ä¾èµ–äº ELF æ–‡ä»¶æ ¼å¼ä¸­çš„ç›¸å…³ä¿¡æ¯ï¼ŒåŒæ—¶ä¹Ÿä»‹ç»äº† readelf å’Œ objdump å·¥å…·çš„åŸºæœ¬ä½¿ç”¨ï¼ŒELF æ ¼å¼é™¤äº†æœ¬æ–‡ä»‹ç»çš„è¿™ç§åœºæ™¯å¤–ï¼Œè¿˜æœ‰å¾ˆå¤šæœ‰è¶£çš„åœºæ™¯å¯ç”¨ï¼Œæ¯”å¦‚ä¸ºäº†å®‰å…¨è¿›è¡Œé€†å‘ä¹‹ç±»çš„ã€‚&lt;/p>
&lt;p>å¦å¤–ï¼Œä½ å¯èƒ½ä¼šå¥½å¥‡ä» Go çš„äºŒè¿›åˆ¶æ–‡ä»¶è·å–è¿™äº›ä¿¡æ¯æœ‰ä»€ä¹ˆä½œç”¨ã€‚æœ€ç›´æ¥çš„æ¥è¯´ï¼Œå¯ä»¥ç”¨äºå®‰å…¨æ¼æ´æ‰«æï¼Œæ¯”å¦‚æ£€æŸ¥å…¶ä¾èµ–é¡¹æ˜¯å¦æœ‰å®‰å…¨æ¼æ´ï¼›æˆ–æ˜¯å¯ä»¥å¯¹ä¾èµ–è¿›è¡Œåˆ†æï¼ˆä¸»è¦æŒ‡ï¼šæ¥è§¦ä¸åˆ°æºä»£ç çš„åœºæ™¯ä¸‹ï¼‰ä¼šæ¯”è¾ƒæœ‰ç”¨ã€‚&lt;/p>
&lt;hr>
&lt;p>æ¬¢è¿è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://gitee.com/tlrr/awesome/raw/master/2020-9-9/1599632564572-mp-qrcode.png" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Go/">Go</category><category domain="https://moelove.info/tags/Linux/">Linux</category></item><item><title>æ–°æ™‹ç¨‹åºå‘˜å¥¶çˆ¸çš„äº‘åŸç”Ÿä¹‹è·¯</title><link>https://moelove.info/2021/01/01/%E6%96%B0%E6%99%8B%E7%A8%8B%E5%BA%8F%E5%91%98%E5%A5%B6%E7%88%B8%E7%9A%84%E4%BA%91%E5%8E%9F%E7%94%9F%E4%B9%8B%E8%B7%AF/</link><guid isPermaLink="true">https://moelove.info/2021/01/01/%E6%96%B0%E6%99%8B%E7%A8%8B%E5%BA%8F%E5%91%98%E5%A5%B6%E7%88%B8%E7%9A%84%E4%BA%91%E5%8E%9F%E7%94%9F%E4%B9%8B%E8%B7%AF/</guid><pubDate>Fri, 01 Jan 2021 08:14:53 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ä¸€çœ¨çœ¼å·²ç» 2021 å¹´äº†ï¼Œè™½ç„¶æˆ‘æ¯å¹´ä¹Ÿéƒ½ä¼šæƒ¯ä¾‹çš„åšä¸ªå°å›é¡¾ï¼Œä½† 2020 å¹´å¯¹æˆ‘æ„ä¹‰æ›´åŠ ä¸åŒã€‚æˆ‘æ‰“ç®—æ¢ä¸ªæ–¹å¼æ¥èŠã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="ç”Ÿæ´»">ç”Ÿæ´»&lt;/h2>
&lt;p>å¾ˆå¤šäººè¯´ 2020 å¹´è¿‡äºé­”å¹»ï¼Œè¿™ä¸€å¹´ç¡®å®å‘ç”Ÿäº†å¾ˆå¤šäº‹æƒ…ï¼Œç–«æƒ…ã€å±±ç«ã€è—ç¾ã€æ´ªæ°´ç­‰ã€‚&lt;/p>
&lt;p>è€Œè¿™ä¸€å¹´å¯¹æˆ‘æ¥è¯´æ„ä¹‰æ›´åŠ éå‡¡ã€‚æ­£å¦‚æˆ‘åœ¨&lt;a href="https://zhuanlan.zhihu.com/p/100618036" title="2019 å°å›é¡¾">å»å¹´çš„æ€»ç»“æ–‡&lt;/a>åˆ†äº«çš„é‚£æ ·ï¼Œæˆ‘æ˜¯åœ¨ 2019 å¹´å’Œæˆ‘çš„å°å¯çˆ±ç»“å©šçš„ï¼Œ2020 å¹´æˆ‘ä¿©çš„å®å®å‡ºç”Ÿå•¦ï¼&lt;/p>
&lt;p>æˆ‘ç°åœ¨å¯¹é‚£å¤©ä»è®°å¿†çŠ¹æ–°ã€‚é‚£å¤©æ™šä¸Šæˆ‘æ€»è§‰å¾—å¥½åƒéœ€è¦åšç‚¹ä»€ä¹ˆï¼Œä½†å…¶å®é‚£ç§æ„Ÿè§‰ä¹Ÿæè¿°ä¸å‡ºæ¥ã€‚æœ€ç»ˆæˆ‘æ˜¯æ‰“å¼€ç”µè„‘çœ‹äº†å‡ éå­•å¦‡å­¦æ ¡è€å¸ˆç»™çš„å…³äºä¸´äº§å‰å‡†å¤‡å·¥ä½œè§†é¢‘åç¡è§‰çš„ã€‚å½“æ—¶å°å¯çˆ±è¿˜ç¬‘æˆ‘æ˜¯ä¸æ˜¯å¤ªç´§å¼ äº†ã€‚å‡Œæ™¨æ—¶æˆ‘ä»¬ä¸€èµ·å»äº†åŒ»é™¢ï¼Œç»è¿‡å°å¯çˆ±çš„ä¸€ç•ªåŠªåŠ›ï¼Œä»æ­¤æˆ‘ä¹Ÿå°±å¢åŠ äº†æ–°çš„è§’è‰²ï¼Œ æˆä¸ºäº†ä¸€åå¥¶çˆ¸ï¼Œè°¢è°¢æˆ‘çš„å°å¯çˆ±ï¼&lt;/p>
&lt;p>æœ‰äº†å­©å­ä¹‹åï¼Œç”Ÿæ´»è‡ªç„¶ä¹Ÿå°±ä¸åƒä¹‹å‰äº†ï¼Œå¾ˆå¤šæ—¶å€™è¦è€ƒè™‘å­©å­çš„æƒ…å†µï¼Œæ¯”å¦‚åŠå¤œéœ€è¦å“„ä»–ï¼Œæ¯å¤©ä¸ºä»–æ´—æ¾¡ä¹‹ç±»çš„ã€‚ç­‰ç¨å¾®å¤§ç‚¹ä¹‹åå¥½äº†ä¸å°‘ï¼Œä¹Ÿå˜å¾—æ›´åŠ æœ‰è¶£äº†ã€‚å‘¨æœ«ä¼šå¸¦ä»–å»æ—©æ•™ä¸­å¿ƒï¼Œå…¶å®ä¸»è¦å°±æ˜¯å¸¦ä»–å»ç©ï¼Œèƒ½çœ‹è§å…¶ä»–å°æœ‹å‹ï¼Œè·Ÿå…¶ä»–å°æœ‹å‹æ‰“æ‹›å‘¼ä¹‹ç±»çš„ï¼Œæ¯æ¬¡ä»–éƒ½å¾ˆå¼€å¿ƒã€‚&lt;/p>
&lt;p>åœ¨ä½œä¸ºâ€œå¥¶çˆ¸â€è¿™ä¸ªè§’è‰²ä¸Šï¼Œæˆ‘æ²¡æœ‰ç»éªŒï¼Œä¹Ÿè¿˜åœ¨å­¦ä¹ å’Œæ‘¸ç´¢ä¸­ã€‚ï¼ˆå¾ˆæ—©ä»¥å‰æˆ‘å’Œå‡ ä¸ªå¥½æœ‹å‹ä¸€èµ·èŠè¿‡ï¼Œæ˜¯ä¸æ˜¯å¤§å®¶åº”è¯¥ç»„ç¾¤ä¸€èµ·èŠèŠå¥¶çˆ¸å¿ƒå¾—ä¹‹ç±»çš„ï¼Œäº¤æµä¸‹ç»éªŒ~ å“ˆå“ˆå“ˆï¼‰&lt;/p>
&lt;p>æ­£å¦‚æˆ‘ 7 æœˆä»½åœ¨æ¥å—æ€å¦ç¤¾åŒºè®¿è°ˆæ—¶è¯´çš„é‚£æ ·ï¼Œ &lt;a href="https://segmentfault.com/a/1190000023260535">æ€å¦æœ‰çº¦ä¸¨å¼ æ™‹æ¶›ï¼šä¸€ç›´åœ¨å­¦ä¹ ï¼ŒåŒ…æ‹¬æ›´å¥½çš„å·¥ä½œå’Œå¦‚ä½•æˆä¸ºåˆæ ¼çš„çˆ¶äº²&lt;/a>ã€‚å¯¹äºåè€…ï¼Œè¿™é‡Œæˆ‘å°±ä¸èŠå¤ªå¤šäº†ï¼Œåˆšåˆšèµ·æ­¥ï¼Œä»¥åçš„è·¯è¿˜é•¿ç€å‘¢~&lt;/p>
&lt;h2 id="ä¸ªäººå­¦ä¹ å’Œæˆé•¿">ä¸ªäººå­¦ä¹ å’Œæˆé•¿&lt;/h2>
&lt;p>æ¥ä¸‹æ¥å°±èŠèŠä¸ªäººå­¦ä¹ å’Œæˆé•¿ç›¸å…³çš„éƒ¨åˆ†å§ã€‚&lt;/p>
&lt;p>ä»Šå¹´çš„ä¸»è¦ç ”ç©¶æ–¹å‘ä»ç„¶ä¸“æ³¨äºå®¹å™¨è¿è¡Œæ—¶ï¼ŒKubernetes ä»¥åŠ Prometheus ç­‰äº‘åŸç”Ÿç›¸å…³çš„æŠ€æœ¯ã€‚&lt;/p>
&lt;p>åœ¨å®¹å™¨è¿è¡Œæ—¶æ–¹é¢å‚ä¸å¼€æºç¤¾åŒºæœ€å¤šï¼ŒDocker v20.10 ä¹Ÿæ˜¯æˆ‘èŠ±æ—¶é—´ç²¾åŠ›æœ€å¤šçš„ä¸€ä¸ªç‰ˆæœ¬ï¼Œ å…³äº &lt;a href="https://zhuanlan.zhihu.com/p/341163077">Docker v20.10 ç›¸å…³çš„ä»‹ç»è¯·å‚è€ƒæˆ‘ä¹‹å‰çš„æ–‡ç« &lt;/a>ã€‚åœ¨æ­¤è¿‡ç¨‹ä¸­ï¼Œæˆ‘å¯¹ containerd, runcï¼Œfirecracker ç­‰æŠ€æœ¯ä¹Ÿéƒ½åœ¨æºç å±‚æœ‰äº†æ›´æ·±çš„ç†è§£ä»¥åŠåšäº†ä¸€äº›ç›¸å…³å®è·µå’Œå°è¯•ã€‚&lt;/p>
&lt;p>å¯¹äº Kubernetes æ¥è¯´ï¼Œä»Šå¹´ä»£ç æäº¤æ–¹é¢è¡¨ç°ä¸€èˆ¬ã€‚å¤šæ•°æ—¶é—´èŠ±åœ¨äº†ç†æ¸…å…¶æŸäº›åŠŸèƒ½çš„è®¾è®¡åŠæ¼”è¿›è¿‡ç¨‹ç­‰æ–¹é¢ï¼Œç§¯ç´¯äº†ä¸€äº›å¥‡å¥‡æ€ªæ€ªçš„çŸ¥è¯†ï¼Œå¦‚æœå¤§å®¶æ„Ÿå…´è¶£çš„è¯ï¼Œä»¥åæˆ‘å¯ä»¥è€ƒè™‘å†™ä¸€äº›æ–‡ç« æ¥èŠèŠï¼Œä»¥åŠå¯¹ Kubernetes ä¸€äº›å‘¨è¾¹æŠ€æœ¯è¿›è¡Œäº†æ¢ç´¢å’Œå®è·µã€‚&lt;/p>
&lt;p>è‡³äº Prometheus çš„è¯ï¼Œæœ‰å‡ ç¯‡è§„åˆ’ä¸­çš„æ–‡ç« æ²¡æ¥å¾—åŠå†™ã€‚åå€’æ˜¯ç»™ &lt;a href="https://book.douban.com/subject/35239877/">Prometheusäº‘åŸç”Ÿç›‘æ§ï¼š è¿ç»´ä¸å¼€å‘å®æˆ˜&lt;/a> è¿™æœ¬ä¹¦å†™äº†ä¸ªæ¨èè¯­ã€‚
åŒæ—¶ Prometheus åœ¨æˆ‘å¸ä¹Ÿæ­£é€æ­¥è½åœ°æ¨è¿›ï¼Œä½†å—èµ„æºå’ŒäººåŠ›ç­‰å› ç´ çš„é™åˆ¶ï¼Œè¿œæ²¡è¾¾åˆ°æˆ‘é¢„æœŸçš„æ•ˆæœï¼Œè¿˜æœ‰å¾ˆé•¿çš„è·¯è¦èµ°ã€‚
2021 å¹´æˆ‘è®¡åˆ’è¦æŠŠå®ƒæ•´ä½“æ¶æ„åŠå‘¨è¾¹åŸºç¡€è®¾æ–½å®Œå–„ä¸‹ï¼Œå¸Œæœ›èƒ½è¿ˆå…¥ä¸€ä¸ªæ–°çš„é˜¶æ®µã€‚&lt;/p>
&lt;p>é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€äº›å€¼å¾—è®°å½•çš„å†…å®¹ã€‚&lt;/p>
&lt;p>2020 å¹´å¹´åˆï¼Œæ›´æ–°å®Œäº†æˆ‘åœ¨ GitChat ä¸Šçš„ä¸“æ  &lt;a href="https://gitbook.cn/gitchat/column/5d70cfdc4dc213091bfca46f">Docker æ ¸å¿ƒçŸ¥è¯†å¿…çŸ¥å¿…ä¼š&lt;/a> ï¼ŒæŒ‰ç…§ GitChat ä¸Šçš„å­—æ•°ç»Ÿè®¡ï¼Œè¿™ä¸ªä¸“æ æœ‰å°†è¿‘ 10w å­—ï¼Œæ¶‰åŠåˆ°äº† Docker åŸç†çš„æ–¹æ–¹é¢é¢ã€‚ä»å¼€å§‹ç­–åˆ’åˆ°å…¨éƒ¨æ›´æ–°å®Œæˆï¼Œè¿™æœŸé—´ä¸€å…±æ¢äº† 3 ä½ç¼–è¾‘ï¼ˆå‰ 2 ä½ç¦»èŒäº†ï¼‰ï¼Œè€—æ—¶åŠå¹´ï¼Œæ„Ÿè°¢å„ä½ç¼–è¾‘å’Œè¯»è€…ä»¬çš„æ”¯æŒï¼æ„Ÿè°¢æˆ‘çš„å°å¯çˆ±å‚¬ç¨¿ï¼è®©æˆ‘ç»ˆäºèƒ½æŒ‰æ—¶å®Œç¨¿ã€‚
æ›´æ–°ä¸“æ çš„é‚£äº›å¤©ï¼Œè¦ä¹ˆæ˜¯å†™åˆ°å‡Œæ™¨ï¼Œè¦ä¹ˆæ˜¯å‡Œæ™¨èµ·åºŠå°±å¼€å§‹å†™ï¼Œæ„Ÿè§‰è¿˜æ˜¯è›®è¾›è‹¦çš„ã€‚ä½†å®Œç¨¿ä¹‹åï¼Œå›å¤´æ¥çœ‹ï¼Œå¥½åƒä¹Ÿè¿˜å¥½ã€‚æœç„¶ä¸€ä¸ªäººçš„ä¸Šé™æ˜¯éœ€è¦é€¼è‡ªå·±ä¸€ä¸‹çš„ã€‚&lt;/p>
&lt;p>æ­¤å¤–ï¼Œè‡ª 2019 å¹´ 3 æœˆä»½å¼€å§‹ï¼Œæˆ‘ä¹Ÿä¸€ç›´åœ¨æ›´æ–°ç€ &lt;a href="https://zhuanlan.zhihu.com/container" title="K8Sç”Ÿæ€å‘¨æŠ¥">ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€&lt;/a> åœ¨ 2020 å¹´æ¨é€äº† 44 ç¯‡ï¼Œä¸­é—´æœ‰å‡ ç¯‡æ–­æ›´ï¼Œæ„Ÿè°¢å„ä½æ–°è€è¯»è€…æœ‹å‹ä»¬çš„æ”¯æŒï¼æœªæ¥ä¼šç»§ç»­ä¿æŒæ›´æ–°ã€‚&lt;/p>
&lt;p>æˆ‘çš„å°å¯çˆ±&lt;a href="https://space.bilibili.com/20831032" title="bilibili: æ— å°½çš„èƒ–">åœ¨ 2020 å¹´ä¹Ÿå¼€å§‹äº†è§†é¢‘ç‰ˆçš„è¾“å‡º&lt;/a>ã€‚å°å¯çˆ±æ¯”æˆ‘è¦è®¤çœŸï¼Œè§†é¢‘ç‰ˆæ¯”æ–‡å­—ç‰ˆè¦è¯¦ç»†çš„å¤šï¼ŒåŒ…æ‹¬å…·ä½“çš„æ“ä½œæ¼”ç¤ºä¹‹ç±»çš„ã€‚æ­¤å¤–ï¼Œè§†é¢‘ä¸­ä¹Ÿä¼šæœ‰äº›å½©è›‹ï¼Œå–œæ¬¢çœ‹è§†é¢‘çš„å°ä¼™ä¼´å¯ä»¥æ¥ä¸€æ³¢å…³æ³¨~&lt;/p>
&lt;p>é™¤äº†&lt;a href="https://zhuanlan.zhihu.com/container">ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€&lt;/a>å¤–ï¼Œ2020 å¹´æˆ‘ä¸€å…±å†™äº† 15 ç¯‡åšå®¢ï¼Œæœ‰ä¸ªåˆ«å‡ ç¯‡æœªå…¬å¼€ï¼Œä»Šå¹´ä¿®æ”¹æ¶¦è‰²åä¼šå…¬å¼€å‘å¸ƒï¼Œæ­¤å¤–ä¹ŸæŠŠåšå®¢é‡æ–°æ•´ç†äº†ä¸‹ï¼Œæ¢äº†ä¸ªä¸»é¢˜ï¼Œæ¸…çˆ½äº†ä¸€äº›ï¼Œæ¬¢è¿å¤§å®¶è®¿é—® &lt;a href="https://moelove.info/">https://moelove.info/&lt;/a>&lt;/p>
&lt;p>&lt;img src="https://moelove.info/img/2020-posts.png" alt="2020 å¹´åšå®¢æˆªå›¾">&lt;/p>
&lt;p>2020 å¹´å¦å¤–çš„å‡ ä»¶äº‹æƒ…ï¼š&lt;/p>
&lt;ul>
&lt;li>æ”¶åˆ°äº†å…¬å¸ç¬¬ä¸€ä»½éåˆåŒåˆ¶çš„è˜ä¹¦ TM599&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://moelove.info/img/TM599.jpg" alt="ç½‘æ˜“TM599è˜ä¹¦">&lt;/p>
&lt;ul>
&lt;li>
&lt;p>åšäº† 5 æ¬¡å…¬å¼€çš„æŠ€æœ¯åˆ†äº«ï¼š&lt;/p>
&lt;ul>
&lt;li>7 æœˆåˆåœ¨å…¬å¸çš„ Tech Talk Time åˆ†äº« Docker æ„å»ºä¼˜åŒ–ï¼›&lt;/li>
&lt;li>7 æœˆåº•åœ¨ Python Meetup åˆ†äº« Docker å’Œ Kubernetesï¼›&lt;/li>
&lt;li>&lt;a href="https://dbaplus.cn/activity-12-1063-1.html">9 æœˆä»½åœ¨ dbplus åˆ†äº« Redis å®¹å™¨åŒ–çš„æŠ€æœ¯é€‰å‹å’Œå¯¹æ¯”&lt;/a>ï¼›&lt;/li>
&lt;li>&lt;a href="https://segmentfault.com/area/pyconchina-2020">11 æœˆåœ¨ PyCon China åˆ†äº«ä½¿ç”¨ eBPF æŠ€æœ¯è°ƒè¯•å®¹å™¨&lt;/a>ï¼›&lt;/li>
&lt;li>&lt;a href="https://shangzhibo.tv/watch/10226294">12 æœˆåœ¨ Upyun Open Talk Time åˆ†äº« containerd çš„ä¸Šæ‰‹å®è·µ&lt;/a>;&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>ä¸ŠåŠå¹´å…¶å®è¿˜æœ‰ä¸€ä¸ª RedHat çš„ Open TestCon ï¼Œä¸è¿‡å—ç–«æƒ…å½±å“å–æ¶ˆäº†ã€‚ä¸‹åŠå¹´åŸºæœ¬ä¿æŒæ¯æœˆ 1 æ¬¡çš„èŠ‚å¥ã€‚æ ¹æ®ä¸»åŠæ–¹æ•°æ®å’Œå‚ä¼šè€…çš„åé¦ˆæ¥çœ‹ï¼Œæ•ˆæœè¿˜ä¸é”™ï¼Œæ„Ÿè°¢å¤§å®¶çš„æ”¯æŒï¼è¿™äº›åˆ†äº«çš„ PPT ï¼Œå¯ä»¥ç›´æ¥&lt;a href="https://github.com/tao12345666333/slides" title="æŠ€æœ¯åˆ†äº«çš„ PPT">åœ¨æˆ‘çš„ GitHub ä»“åº“ä¸­ä¸‹è½½&lt;/a>ã€‚&lt;/p>
&lt;p>è¿™å‡ æ¬¡åˆ†äº«ï¼Œå¤§å®¶å…¶å®ä¹Ÿå¯ä»¥çœ‹åˆ°ï¼Œæ¯æ¬¡éƒ½æ˜¯ä¸ä¸€æ ·çš„ï¼Œæœ‰å„è‡ªä¸åŒçš„ä¾§é‡ï¼ŒåŒ…æ‹¬å®¹å™¨åŒ–/Kubernetesï¼Œå®¹å™¨è¿è¡Œæ—¶ï¼ŒeBPF ç­‰æŠ€æœ¯ã€‚ &lt;strong>PS: æˆ‘åšä¿¡ï¼Œè¿‘äº”å¹´ eBPF æŠ€æœ¯ä¼šæœ‰æ›´å¤§è§„æ¨¡çš„ç”Ÿäº§å®è·µï¼Œå®ƒä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„çªç ´å£ã€‚&lt;/strong> é™¤ Cilium å¤–ï¼Œæˆ‘ä¹Ÿè®¡åˆ’ä¹‹ååˆ†äº«æ›´å¤šå¥½ç©å’Œå®ç”¨çš„ eBPF å®è·µï¼Œå½“ç„¶ï¼Œæˆ‘ä¹Ÿè®¡åˆ’åœ¨æˆ‘å¸çš„ç¯å¢ƒä¸­ï¼Œåšä¸€äº›å…¶ä»–çš„å°è¯•ã€‚&lt;/p>
&lt;p>æ—¢ç„¶æ˜¯å¹´åº¦çš„æ€»ç»“å’Œå›é¡¾ï¼Œæˆ‘ä¹Ÿæ¥èŠä¸€äº›ä¸é‚£ä¹ˆæ»¡æ„å’Œåšçš„ä¸å¥½çš„åœ°æ–¹å§ã€‚&lt;/p>
&lt;p>å°±æˆ‘ä¸ªäººè€Œè¨€ï¼Œ2020 å¹´ä¸ŠåŠå¹´æœ‰è¿‡ä¸€å°æ®µæ—¶é—´çš„è¿·èŒ«ï¼Œæˆ–è€…è¯´â€œæ³¨æ„åŠ›åˆ†æ•£â€ã€‚å„ç±»æŠ€æœ¯å±‚å‡ºä¸ç©·ï¼Œæ›´æ–°ä¹Ÿå¾ˆé¢‘ç¹ï¼Œå”¯æœ‰æŒç»­å­¦ä¹ å’Œè·Ÿè¿›ã€‚å…³æ³¨å¤ªå¤šä¸œè¥¿ï¼Œè™½ç„¶èƒ½è®©è‡ªå·±ä¿æŒæ•é”çš„åˆ¤æ–­ &amp;amp; æ›´è½»æ¾çš„è§£å†³é—®é¢˜ï¼Œç„¶è€Œä¸ªäººç²¾åŠ›æœ‰é™ï¼ŒæŒç»­è¿™æ ·ä¼šåˆ†æ•£å¾ˆå¤šæ³¨æ„åŠ›ã€‚&lt;/p>
&lt;p>æ‰€ä»¥æˆ‘ä¸»åŠ¨çš„å±è”½æ‰äº†ä¸€äº›ä¿¡æ¯ &amp;amp; å¯¹ç›¸å…³å†…å®¹åšäº†åˆ†çº§ï¼Œå°†è‡ªå·±çš„æ³¨æ„åŠ›æ›´å¥½çš„é›†ä¸­åœ¨å‡ ä¸ªä¸»è¦çš„é¢†åŸŸå†…ï¼Œå…¶ä»–å†…å®¹å‘¨æœŸæ€§çš„å›é¡¾ä¸‹ï¼Œä¹Ÿæœªå°ä¸å¯ã€‚è¿™ä¹Ÿå°±æ˜¯æˆ‘åœ¨å¼€å¤´æåˆ°çš„ä¸»è¦ç ”ç©¶æ–¹å‘ã€‚&lt;/p>
&lt;p>å¦ä¸€æ–¹é¢åˆ™æ˜¯å¯¹å›¢é˜Ÿ/ç³»ç»Ÿç›¸å…³çš„ï¼Œå½“å‰é¢ä¸´è¾ƒå¤§çš„é—®é¢˜æ˜¯ä¿¡æ¯å­¤å²›ï¼ˆinformation islandï¼‰ï¼Œè™½è¯´ä¿¡æ¯å­¤å²›æ˜¯æŠ€æœ¯äº§ä¸šå‘å±•ä¸­ä¸å¯é¿å…çš„ä¸€ä¸ªé—®é¢˜ï¼Œä½†ç°åœ¨å¯èƒ½å‡ºç°çš„æ—©äº†ç‚¹ï¼Œä¹Ÿä¸¥é‡äº†ç‚¹ã€‚å¯¼è‡´äº†å¾ˆå¤šå­¤ç«‹çš„ç³»ç»Ÿ &amp;amp; ä¿¡æ¯é—­å¡ã€‚å¸Œæœ›æ˜å¹´é€šè¿‡å¹³å°å»ºè®¾èƒ½æ”¹å–„ä¸€äº›è¿™ç§é—®é¢˜ã€‚&lt;/p>
&lt;h2 id="flag">flag&lt;/h2>
&lt;p>2019 å¹´ï¼Œåœ¨ &lt;a href="https://mp.weixin.qq.com/s?__biz=MzIyMjYyMzg3MA==&amp;amp;mid=2247491168&amp;amp;idx=4&amp;amp;sn=99c75223a96c3f0a4ba4802162a7176b&amp;amp;chksm=e82bff71df5c7667eeeabc6a12c1ed5d7e2589dd6d81c015a9fdf4896af0d99019c71182ab27&amp;amp;mpshare=1&amp;amp;scene=1&amp;amp;srcid=&amp;amp;sharer_sharetime=1577896952072&amp;amp;sharer_shareid=ca2e51094588e06bf753d47ce6ce6894&amp;amp;exportkey=AeBs7IZvP2YDdO0PAERxHsc%3D&amp;amp;pass_ticket=sUqDG7gi77aHI1AzhT8QG4acbC2iGtoHfL5dhjaRgAIB%2BMOsBIpQ8jHnQ671eH1e#rd">GitChat çš„è®¿è°ˆä¸­&lt;/a> è®©æˆ‘èŠ 2020 å¹´å®¹å™¨çš„æŠ€æœ¯è¶‹åŠ¿ã€‚æˆ‘å½“æ—¶çš„ä¸»è¦è§‚ç‚¹å¦‚ä¸‹ï¼š&lt;/p>
&lt;blockquote>
&lt;p>ä½œä¸ºäº‘åŸç”ŸæŠ€æœ¯çš„åŸºçŸ³ï¼ŒKubernetes åœ¨ 2020 å¹´çš„çƒ­åº¦å°†ä¼šæŒç»­ä¸Šå‡ã€‚è€Œå„ä¸ªå…¬å¸çš„é›†ç¾¤è§„æ¨¡ï¼Œä»¥åŠå¯¹å®¹å™¨æŠ€æœ¯çš„æ¨è¿›éƒ½å°†ä¼šæŒç»­åŠ å¤§ã€‚åœ¨ç»å†äº†åˆæ­¥å®¹å™¨åŒ–åï¼Œæ›´å¤šçš„å…¬å¸å°†é¢ä¸´çš„é—®é¢˜æ˜¯ç¨³å®šæ€§å’Œæ€§èƒ½ä¼˜åŒ–é—®é¢˜ã€‚ä¸æ­¤åŒæ—¶ï¼Œservice meshï¼Œserverless ç­‰æŠ€æœ¯ä¹Ÿéƒ½ä¼šé€æ­¥å¾—åˆ°æ™®éåº”ç”¨ã€‚
ä»åº•å±‚æ¬¡æŠ€æœ¯çš„è§’åº¦æ¥çœ‹ï¼Œcgroups v2 å°†é€æ­¥æ™®åŠï¼Œè¿›è€Œå–ä»£ cgroups v1ï¼Œä½†è¿™ä¸ªè¿‡ç¨‹å¯èƒ½éœ€è¦ä¸¤ä¸‰å¹´å·¦å³ã€‚
æ•´ä½“è€Œè¨€ï¼Œç¨³å®šæ€§å’Œæ€§èƒ½ä¼˜åŒ–å°†ä¼šæ˜¯æœªæ¥çš„ä¸»æ—‹å¾‹ã€‚&lt;/p>
&lt;/blockquote>
&lt;p>å›è¿‡å¤´æ¥çœ‹ï¼Œç¡®å® 2020 å¹´ Kubernetes çƒ­åº¦æ˜¯åœ¨æŒç»­ä¸Šå‡ã€‚å…³äºç¨³å®šæ€§æ–¹é¢ï¼Œçœ‹çœ‹ Chaos Engineering å»å¹´åœ¨å„å…¬å¸ Kubernetes ä¸­çš„ç›¸å…³å®è·µï¼ŒåŸºæœ¬ä¹Ÿå¾—åˆ°å°è¯ã€‚&lt;/p>
&lt;p>è‡³äºæ€§èƒ½ä¼˜åŒ–ï¼Œæ— è®ºæ˜¯é˜¿é‡Œï¼Œè…¾è®¯ï¼Œç½‘æ˜“ç­‰å„å®¶ä¹Ÿéƒ½å¯¹å¤–å…¬å¼€åˆ†äº«äº†åŸºäº eBPF ç­‰æŠ€æœ¯çš„ç›¸å…³ä¼˜åŒ–å’Œå®è·µï¼Œè¿™ç‚¹ä¹Ÿæ²¡é—®é¢˜ã€‚&lt;/p>
&lt;p>cgroups v2 2020 å¹´æ— è®ºæ˜¯ runc, containerd, Docker ç­‰å‡å·²ç»å¢åŠ äº†ç›¸å…³çš„æ”¯æŒï¼Œä¹ŸåŸºæœ¬å¾—åˆ°äº†å°è¯ã€‚&lt;/p>
&lt;p>&lt;strong>å”¯ä¸€æ²¡æœ‰æåˆ°çš„ï¼Œå¯èƒ½æ˜¯å®‰å…¨æ€§ç›¸å…³çš„éƒ¨åˆ†ã€‚&lt;/strong> åœ¨ 2020 å¹´ï¼ŒKubernetes/å®¹å™¨åŒ–æŠ€æœ¯æ–¹é¢çš„å®‰å…¨æ€§ï¼Œä¹Ÿè¿›ä¸€æ­¥å¾—åˆ°äº†é‡è§†ã€‚ï¼ˆè¿™å’Œå„ç§å‰æœŸæ²¡æœ‰å¤ªåœ¨æ„çš„å®‰å…¨æ¼æ´è¢«å‘ç°ä¹Ÿæœ‰å¾ˆå¤§å…³ç³»ï¼‰ã€‚&lt;/p>
&lt;p>å†æ¥çœ‹çœ‹å¹´åˆç«‹çš„ flag å§ï¼š&lt;/p>
&lt;ul>
&lt;li>å·¥ä½œæ–¹é¢å¸Œæœ›èƒ½æ¨åŠ¨æ›´å¤šä¸šåŠ¡çš„æ”¹é€ å’Œæ¥å…¥ï¼Œç®—æ˜¯ä¸ªé•¿çº¿è®¡åˆ’ï¼›&lt;/li>
&lt;li>ç¤¾åŒºæ´»åŠ¨æ–¹é¢ï¼Œä»Šå¹´å¸Œæœ›å¤šå‚ä¸ä¸€äº›ï¼ŒæŠŠä¸€äº›ç†å¿µå’Œå®è·µç»éªŒ push åˆ°ç¤¾åŒºï¼Œä¹Ÿèƒ½ä»ä¸­å­¦ä¹ åˆ°ç¤¾åŒºçš„ä¸€äº›ç»éªŒï¼›&lt;/li>
&lt;li>ç¤¾åŒºè´¡çŒ®æ–¹é¢ï¼Œä¼šç»§ç»­æŠ•å…¥æ›´å¤šç²¾åŠ›æ¥åšï¼Œä½†ä¸ 2019 å¹´çš„é‡ç‚¹å¯èƒ½ä¼šç¨æœ‰ä¸åŒï¼›&lt;/li>
&lt;li>ç”Ÿæ´»æ–¹é¢ï¼Œå¸Œæœ›å®å®å¥åº·çš„å‡ºç”Ÿï¼Œå’Œæˆ‘çš„å°å¯çˆ±å…±åŒç»è¥å¥½æˆ‘ä»¬çš„å®¶åº­ã€‚&lt;/li>
&lt;/ul>
&lt;p>åŸºæœ¬ç¬¦åˆé¢„æœŸã€‚å·¥ä½œæ–¹é¢ä¸šåŠ¡æ–¹å’ŒåŒäº‹ä»¬éƒ½æ¯”è¾ƒé…åˆï¼Œæ¨è¿›ä¹Ÿè¾ƒä¸ºé¡ºåˆ©ã€‚ç¤¾åŒºæ´»åŠ¨æ–¹é¢ï¼Œè°¢è°¢æ¯ä¸ªå‚ä¸è€…ï¼ç”Ÿæ´»æ–¹é¢ï¼Œè°¢è°¢æˆ‘çš„å°å¯çˆ±ï¼æ„Ÿè°¢æ¯ä¸ªå®¶äººï¼&lt;/p>
&lt;p>æƒ¯ä¾‹è´´ä¸€å¼ å›¾:&lt;/p>
&lt;p>&lt;img src="https://moelove.info/img/2020-oss.png" alt="2020 overview - https://moelove.info">&lt;/p>
&lt;p>è‡³äº 2021 å¹´çš„å°ç›®æ ‡ï¼Œè¿™æ¬¡å°±ä¸å†™äº†ã€‚æ„¿ï¼šå¹³å®‰å–œä¹ï¼&lt;/p>
&lt;p>è¿˜æœ‰æ–‡ç« å‰çš„ä½ ï¼Œæ„Ÿè°¢ä½ çš„å…³æ³¨å’Œæ”¯æŒï¼Œå¸Œæœ›æˆ‘ä»¬èƒ½å„æœ‰æ”¶è·ï¼&lt;/p>
&lt;hr>
&lt;p>æ¬¢è¿è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://gitee.com/tlrr/awesome/raw/master/2020-9-9/1599632564572-mp-qrcode.png" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Life/">Life</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| å¹´ç»ˆå¤§æ”¾é€ï¼Docker v20.10</title><link>https://moelove.info/2020/12/28/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-%E5%B9%B4%E7%BB%88%E5%A4%A7%E6%94%BE%E9%80%81Docker-v20.10/</link><guid isPermaLink="true">https://moelove.info/2020/12/28/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-%E5%B9%B4%E7%BB%88%E5%A4%A7%E6%94%BE%E9%80%81Docker-v20.10/</guid><pubDate>Mon, 28 Dec 2020 01:53:25 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container" title="k8sç”Ÿæ€">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="docker-v2010-ä¸»è¦ç‰¹æ€§ä¸€è§ˆ">Docker v20.10 ä¸»è¦ç‰¹æ€§ä¸€è§ˆ&lt;/h2>
&lt;p>åœ¨ä¹‹å‰çš„ &lt;a href="https://zhuanlan.zhihu.com/p/268647812" title="K8S ç”Ÿæ€å‘¨æŠ¥| Docker v20.10.0-beta1 å‘å¸ƒ">K8S ç”Ÿæ€å‘¨æŠ¥| Docker v20.10.0-beta1 å‘å¸ƒ&lt;/a> ä¸€æ–‡ä¸­ï¼Œæˆ‘æ›¾ä¸ºä½ ä»‹ç»è¿‡ Docker v20.10.0-beta1 å‘å¸ƒç›¸å…³çš„ä¿¡æ¯ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰å…·ä½“ä»‹ç» Docker v20.10 ç‰ˆæœ¬çš„å…·ä½“åŠŸèƒ½ç‰¹æ€§ç­‰ç»†èŠ‚ã€‚&lt;/p>
&lt;blockquote>
&lt;p>Docker v20.10 ç‰ˆæœ¬ï¼Œå˜åŒ–éå¸¸çš„å¤§ã€‚æä¾›äº† CGroup v2 çš„æ”¯æŒï¼Œå¢å¼ºäº† rootless æ¨¡å¼çš„æ”¯æŒï¼ŒåŒæ ˆæ—¥å¿—ï¼Œæ›´çµæ´»çš„å†…ç½® DNS ç­‰ï¼Œæˆ‘åœ¨è¿™ä¸ªç‰ˆæœ¬ä¸­ä¹ŸèŠ±è´¹äº†å¾ˆå¤šæ—¶é—´ã€‚&lt;/p>
&lt;p>è¯¦ç»†çš„å˜æ›´ï¼Œæˆ‘ä¼šåœ¨ v20.10 æ­£å¼å‘å¸ƒåå†è¿›è¡Œä»‹ç»ã€‚æ¬¢è¿å¤§å®¶è¿›è¡Œæµ‹è¯•å’Œåé¦ˆï¼Œç›®å‰å·²ç»æ”¶åˆ°äº†ä¸€äº›åé¦ˆçš„å»ºè®®ã€‚æˆ‘ä»¬ä¼šå°½å¿«ä¿®æ­£å¹¶å‘å¸ƒä¸‹ä¸ªç‰ˆæœ¬ã€‚&lt;/p>
&lt;/blockquote>
&lt;p>&lt;strong>æ­£å¦‚æˆ‘å½“æ—¶æ‰¿è¯ºçš„é‚£æ ·ï¼Œä½œä¸º 2020 å¹´æœ€åä¸€ç¯‡å‘¨æŠ¥ï¼Œæˆ‘æ¥åœ¨æœ¬ç¯‡å‘¨æŠ¥ä¸­è¯¦ç»†ä»‹ç»ä¸‹ Docker v20.10 ç‰ˆæœ¬ã€‚&lt;/strong>&lt;/p>
&lt;h3 id="å®‰è£…">å®‰è£…&lt;/h3>
&lt;p>Docker v20.10 å‘å¸ƒäº 2020 å¹´ 12 æœˆ 8 æ—¥ï¼Œæ˜¯è‡ª Docker v19.03 ï¼ˆ2019 å¹´ 7 æœˆï¼‰åå‘å¸ƒçš„é¦–ä¸ªå¤§ç‰ˆæœ¬ã€‚ä½ å¯ä»¥ç›´æ¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ¥è‡ªåŠ¨åŒ–çš„å®‰è£… Docker v20.10ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">âœ ~ curl -fsSL https://get.docker.com &lt;span class="p">|&lt;/span>sh
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="cgroup-v2-æ”¯æŒ">cgroup v2 æ”¯æŒ&lt;/h3>
&lt;p>Docker v19.03 æ˜¯æ²¡æœ‰ cgroup v2 æ”¯æŒçš„ï¼Œä½†è‡ªä» Fedora 31 å¼€å§‹ï¼Œè¿™æˆä¸ºäº† Fedora ä¸Šçš„é»˜è®¤ cgroup ç‰ˆæœ¬ã€‚åœ¨ Docker v20.10 å‘å¸ƒä¹‹å‰ï¼ŒFedora 31 åŠä»¥ä¸Šç”¨æˆ·ï¼Œéœ€è¦å°†ç³»ç»Ÿçš„ cgroup è®¾ç½®ä¸º v1 æ‰èƒ½æ­£å¸¸è¿è¡Œ Docker ã€‚&lt;/p>
&lt;p>å…¶å®è¿™é‡Œé¢æ¶‰åŠåˆ°äº†å¤§é‡çš„ä¿®æ”¹ï¼ŒåŒ…æ‹¬ runcï¼Œ containerd ç›´åˆ° Docker éƒ½æ·»åŠ äº† cgroup v2 çš„æ”¯æŒï¼Œæ­¤åŠŸèƒ½æ‰èƒ½çœŸæ­£ç»™ç”¨æˆ·ä½¿ç”¨ã€‚&lt;/p>
&lt;p>åœ¨æ­¤è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä¹Ÿå‘ç°äº† runc v1.0-rc91 ä¸­éšè—çš„ bug ï¼Œä¼šå¯¼è‡´ Docker æ— æ³•æ­£å¸¸é€šè¿‡å¢åŠ  &lt;code>--privileged&lt;/code> å‚æ•°ä»¥ç‰¹æƒæ¨¡å¼è¿è¡Œå®¹å™¨ã€‚åæ¥å¯¹ runc è¿›è¡Œäº†ä¿®æ”¹ï¼Œå‘å¸ƒäº† runc v1.0-rc92 ï¼Œè‡³æ­¤æ‰ä½¿å¾— Docker ä¸­çš„ cgroup v2 ç‰¹æ€§å¾—ä»¥é¡ºåˆ©å®Œæˆã€‚&lt;/p>
&lt;p>å…³äºæ­¤å¤„æ›´è¯¦ç»†çš„å†…å®¹ï¼Œæˆ‘åœ¨ &lt;a href="https://zhuanlan.zhihu.com/p/178227659" title="K8S ç”Ÿæ€å‘¨æŠ¥| runc v1.0-rc92 å‘å¸ƒ">ã€ŠK8S ç”Ÿæ€å‘¨æŠ¥| runc v1.0-rc92 å‘å¸ƒã€‹&lt;/a> ä¸­å·²åšäº†è¯¦ç»†ä»‹ç»ï¼Œæ„Ÿå…´è¶£çš„å°ä¼™ä¼´å¯ä»¥çœ‹çœ‹ã€‚&lt;/p>
&lt;h3 id="rootless-mode-ga">rootless mode GA&lt;/h3>
&lt;p>Docker æœ‰ä¸ªä¸€ç›´è¢«äººè¯Ÿç—…çš„ç‚¹ï¼Œå°±åœ¨äº docker daemon å¿…é¡»æ˜¯ä»¥ root æƒé™æ¥å¯åŠ¨ï¼Œè¿™æ ·æ‰å¯ä»¥ä½¿ç”¨å®ƒçš„å…¨éƒ¨ç‰¹æ€§ã€‚è¿™ä¹Ÿå°±æ„å‘³ç€ï¼Œå‡¡æ˜¯å¯ä»¥æ“ä½œ docker daemon çš„ç”¨æˆ·ï¼Œä¹Ÿå°±æœ‰æœºä¼šè·å–æ“ä½œç³»ç»Ÿçš„ root æƒé™ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬åœ¨ Docker v19.03 ç‰ˆæœ¬ä¸­æä¾›äº†å®éªŒæ€§çš„ rootless mode çš„æ”¯æŒï¼Œå…è®¸ç”¨æˆ·æ— éœ€ root æƒé™å³å¯è¿è¡Œ docker daemon ã€‚è¿™å¤§å¤§æå‡äº†ç³»ç»Ÿçš„å®‰å…¨æ€§ã€‚ä½†å½“æ—¶è¿˜å¤„äºå®éªŒé˜¶æ®µï¼Œæœ‰éƒ¨åˆ†åŠŸèƒ½ç¼ºå¤±ã€‚&lt;/p>
&lt;p>&lt;strong>æˆ‘æƒ³è¶æ­¤æ¬¡ Docker v20.10 å‘å¸ƒï¼Œæ­£å¼ä¸ºä½ ä»‹ç»ä¸‹ Docker çš„ rootless mode ï¼Œå¹¶ä¸”ï¼Œå®ƒå·²ç»è¾¾åˆ° GA ä»å®éªŒæ€§æ¯•ä¸šäº†ï¼Œå¹¶ä¸”ä¹Ÿæä¾›äº†å¾ˆå¤šåŠŸèƒ½ã€‚&lt;/strong>&lt;/p>
&lt;p>&lt;strong>rootless mode æ˜¯åœ¨ç”¨æˆ·åç§°ç©ºé—´ä¸­è¿è¡Œ docker daemon å’Œå®¹å™¨ï¼Œå®Œå…¨ä¸éœ€è¦ root æƒé™ã€‚&lt;/strong>&lt;/p>
&lt;p>ä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤å®‰è£… Docker rootless æ¨¡å¼ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">âœ ~ curl -fsSL https://get.docker.com/rootless &lt;span class="p">|&lt;/span> sh
&lt;/code>&lt;/pre>&lt;/div>&lt;p>æˆ–è€…ç›´æ¥é€šè¿‡ Docker å®˜æ–¹çš„ RPM/DEB åŒ…è¿›è¡Œå®‰è£…ã€‚å®‰è£…å®Œä¹‹åï¼Œé€šè¿‡ &lt;code>systemctl&lt;/code> ç®¡ç† Docker æœåŠ¡å³å¯ã€‚&lt;/p>
&lt;pre>&lt;code>âœ ~ systemctl --user start docker
&lt;/code>&lt;/pre>&lt;p>æ›´å¤šå…³äº rootless mode çš„è¯¦ç»†ç”¨æ³•åŠæœ€ä½³å®è·µï¼Œè¯·å‚è€ƒ &lt;a href="https://docs.docker.com/engine/security/rootless/#best-practices" title="Docker å®˜æ–¹æ–‡æ¡£ï¼šä»¥é root ç”¨æˆ·è¿è¡Œ docker daemon">Docker å®˜æ–¹æ–‡æ¡£ï¼šä»¥é root ç”¨æˆ·è¿è¡Œ docker daemon&lt;/a>&lt;/p>
&lt;h3 id="dockerfile-run---mounttypesshsecretcache-ç­‰ç‰¹æ€§è¾¾åˆ°-ga">Dockerfile: RUN --mount=type=(ssh|secret|cache) ç­‰ç‰¹æ€§è¾¾åˆ° GA&lt;/h3>
&lt;p>Docker v18.06 å¼€å§‹å®éªŒæ€§çš„æ·»åŠ äº† &lt;code>RUN --mount=type=cache&lt;/code> è¯¥ç‰¹æ€§å¯ç”¨äºåœ¨æ„å»ºè¿‡ç¨‹ä¸­ï¼Œä¿ç•™åŒ…ç®¡ç†å™¨çš„ç¼“å­˜æ–‡ä»¶ã€‚&lt;/p>
&lt;p>ä¹‹ååœ¨ v18.09 ä¸­åˆå¢åŠ äº† &lt;code>RUN --mount=type=ssh&lt;/code> å’Œ &lt;code>RUN --mount=type=secret&lt;/code> ç”¨äºåœ¨æ„å»ºè¿‡ç¨‹ä¸­ï¼Œä¼ é€’å¯†é’¥æˆ–è€…ç”¨æˆ·å‡­è¯ç­‰ç§å¯†ä¿¡æ¯ï¼Œä»¥é˜²æ­¢æ³„æ¼ç­‰ã€‚è¿™äº›é«˜çº§ç‰¹æ€§ï¼Œåœ¨æˆ‘ä¹‹å‰çš„æ–‡ç«  &lt;a href="https://gitbook.cn/books/5cf02802ff33b82ee0eb425d/index.html#-3">ã€Šè¿›é˜¶ï¼šDockerfile é«˜é˜¶ä½¿ç”¨æŒ‡å—åŠé•œåƒä¼˜åŒ–ã€‹&lt;/a> æ›¾è¯¦ç»†ä»‹ç»è¿‡ã€‚&lt;/p>
&lt;p>è¿™äº›ç‰¹æ€§éå¸¸æœ‰ç”¨ï¼ŒåŸºæœ¬æ¶µç›–äº†ä½ æ„å»ºé•œåƒæ—¶å…³äºå®‰å…¨æ€§æ–¹é¢çš„ç»å¤§å¤šæ•°çš„éœ€æ±‚ã€‚å¤§å®¶å¦‚æœæ„Ÿå…´è¶£ï¼Œæ¬¢è¿éšæ—¶ä¸æˆ‘äº¤æµï¼Œåç»­æˆ‘ä¹Ÿå¯èƒ½ä¼šå†å†™ç›¸å…³çš„æ–‡ç« è¿›è¡Œä»‹ç»ã€‚&lt;/p>
&lt;h3 id="å…¶ä»–">å…¶ä»–&lt;/h3>
&lt;ul>
&lt;li>æ­¤æ¬¡è¿˜ä¼˜åŒ–äº†å†…ç½® DNS ç›¸å…³çš„é€»è¾‘ï¼Œå¯ä»¥æä¾›æ›´å¥½çš„æ€§èƒ½ï¼›&lt;/li>
&lt;li>docker build å¯æ”¯æŒç›´æ¥ ssh è¿œç¨‹æ„å»ºç§æœ‰ä»“åº“çš„é•œåƒäº†ï¼›&lt;/li>
&lt;/ul>
&lt;p>æ›´å¤šå…³äºæ­¤ç‰ˆæœ¬çš„å˜æ›´ï¼Œå¯ä»¥å‚è€ƒå…¶ &lt;a href="https://docs.docker.com/engine/release-notes/#20100" title="Docker v20.10 ReleaseNote">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="rook-v154-å‘å¸ƒ">Rook v1.5.4 å‘å¸ƒ&lt;/h2>
&lt;p>å…³äºæ­¤ç‰ˆæœ¬æœ‰ä¸¤ä¸ªæ ¼å¤–éœ€è¦æ³¨æ„çš„ä¿¡æ¯ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://github.com/rook/rook/issues/6849">#6849&lt;/a> æœ€æ–°ç‰ˆçš„ Ceph ä¸æ”¯æŒä½¿ç”¨åˆ†åŒºçš„ OSD äº†ã€‚å°±æˆ‘ä¸ªäººç»éªŒï¼Œæˆ‘å€’æ˜¯åŸºæœ¬æ²¡æœ‰æŠŠ OSD è£…åˆ°è¿‡æŸä¸ªåˆ†åŒºä¸­ï¼Œä¸€èˆ¬éƒ½ç›´æ¥ä½¿ç”¨æ•´å—ç›˜ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/rook/rook/pull/6769">#6769&lt;/a> Ceph-CSI é»˜è®¤æ›´æ–°åˆ°äº† v3.2.0;&lt;/li>
&lt;/ul>
&lt;p>æ›´å¤šå…³äºæ­¤ç‰ˆæœ¬çš„ä¿¡æ¯ï¼Œè¯·å‚è€ƒå…¶ &lt;a href="https://github.com/rook/rook/releases/tag/v1.5.4" title="Rook v1.5.4 RelaseNote">ReleaseNote&lt;/a> ã€‚&lt;/p>
&lt;h2 id="etcd-ä»-cncf-æ­£å¼æ¯•ä¸š">etcd ä» CNCF æ­£å¼æ¯•ä¸š&lt;/h2>
&lt;p>etcd æƒ³å¿…å¤§å®¶ä¸ä¼šé™Œç”Ÿï¼Œæˆ‘åœ¨ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€ä¸­ä¹Ÿæ›¾å¤šæ¬¡ä»‹ç»å®ƒï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°äº†ã€‚&lt;/p>
&lt;p>æ„Ÿå…´è¶£çš„å°ä¼™ä¼´å¯æŸ¥çœ‹å®˜æ–¹å…¬å‘Šï¼š &lt;a href="https://www.cncf.io/announcements/2020/11/24/cloud-native-computing-foundation-announces-etcd-graduation/" title="CNCF å®£å¸ƒ etcd æ­£å¼æ¯•ä¸š">CNCF å®£å¸ƒ etcd æ­£å¼æ¯•ä¸š&lt;/a>&lt;/p>
&lt;p>å†æ¬¡æ­å–œ etcd !&lt;/p>
&lt;h2 id="é¢˜å¤–è¯">é¢˜å¤–è¯&lt;/h2>
&lt;p>ä»Šå¹´æ˜¯ 2020 å¹´é˜³å†çš„æœ€åä¸€å¤©äº†ï¼Œ &lt;strong>æ„Ÿè°¢å¤§å®¶çš„å…³æ³¨å’Œæ”¯æŒï¼&lt;/strong>&lt;/p>
&lt;p>&lt;strong>æ¥ä¸‹æ¥ï¼Œæˆ‘å°†ä¼šå‘å¸ƒä¸€ä»½ â€œ2020 å¹´ K8S ç”Ÿæ€æ¼”è¿›æŠ¥å‘Šâ€ ä¸ä½ åˆ†äº«åœ¨ 2020 å¹´ K8S ç”Ÿæ€ç›¸å…³ä¸å®¹é”™è¯¯çš„ä¿¡æ¯ï¼Œä»¥åŠ 2021 å¹´ K8S ç”Ÿæ€ç›¸å…³çš„å±•æœ›åŠå‘å±•æ–¹å‘ï¼Œæ•¬è¯·æœŸå¾…ï¼&lt;/strong>&lt;/p>
&lt;hr>
&lt;p>æ¬¢è¿è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://gitee.com/tlrr/awesome/raw/master/2020-9-9/1599632564572-mp-qrcode.png" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>Docker æ–°å‘å¸ƒçš„ hub-tool å¯ç›´æ¥æŸ¥çœ‹è´¦æˆ·é…é¢</title><link>https://moelove.info/2020/12/19/Docker-%E6%96%B0%E5%8F%91%E5%B8%83%E7%9A%84-hub-tool-%E5%8F%AF%E7%9B%B4%E6%8E%A5%E6%9F%A5%E7%9C%8B%E8%B4%A6%E6%88%B7%E9%85%8D%E9%A2%9D/</link><guid isPermaLink="true">https://moelove.info/2020/12/19/Docker-%E6%96%B0%E5%8F%91%E5%B8%83%E7%9A%84-hub-tool-%E5%8F%AF%E7%9B%B4%E6%8E%A5%E6%9F%A5%E7%9C%8B%E8%B4%A6%E6%88%B7%E9%85%8D%E9%A2%9D/</guid><pubDate>Sat, 19 Dec 2020 23:58:34 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;p>Docker Desktop v3.0 å·²äºå‰ä¸¤å‘¨æ­£å¼å‘å¸ƒï¼Œä»è¿™ä¸ªç‰ˆæœ¬èµ·ï¼ŒDocker å®˜æ–¹æ‰¿è¯ºæ¯æ¬¡çš„æ›´æ–°å°†ä»¥å¢é‡æ›´æ–°çš„æ–¹å¼æ¥æä¾›ï¼Œä»¥ä¾¿å‡å°‘ä¸‹è½½åŒ…çš„ä½“ç§¯ï¼Œæå‡æ•ˆç‡ã€‚&lt;/p>
&lt;p>é™¤äº†å°† Docker Engine æ›´æ–°è‡³ v20.10.0 å¤–ï¼Œä¹Ÿå¯¹å…¶ä»–çš„ä¾èµ–åšäº†æ›´æ–°ï¼Œå¦‚ä¸‹å›¾ï¼š&lt;/p>
&lt;p>&lt;img src="https://moelove.info/img/docker-desktop-version.png" alt="Docker Desktop v3.0">&lt;/p>
&lt;p>æœ€å¸å¼•æˆ‘çš„æ˜¯æœ¬æ¬¡æ–°å¢çš„ &lt;a href="https://github.com/docker/roadmap/issues/117" title="Docker Hub CLI">Docker Hub Tool v0.2.0&lt;/a> ï¼Œå®ƒæ˜¯ Docker å®˜æ–¹æä¾›çš„ Docker Hub CLI å·¥å…·ï¼Œå…·å¤‡ç®¡ç† DockerHub ä¸Šçš„å¸å·ï¼Œé•œåƒç­‰ç›¸å…³èµ„æºçš„èƒ½åŠ›ã€‚&lt;/p>
&lt;p>ä»¥ä¸‹ï¼Œæˆ‘æ¥ä¸ºä½ ä»‹ç»ä¸‹ Hub Tool çš„ä¸»è¦åŠŸèƒ½ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ hub-tool -h
A tool to manage your Docker Hub images
Usage:
hub-tool
hub-tool &lt;span class="o">[&lt;/span>command&lt;span class="o">]&lt;/span>
Available Commands:
account Manage your account
&lt;span class="nb">help&lt;/span> Help about any &lt;span class="nb">command&lt;/span>
login Login to the Hub
&lt;span class="nb">logout&lt;/span> Logout of the Hub
org Manage organizations
repo Manage repositories
tag Manage tags
token Manage Personal Access Tokens
version Version information about this tool
Flags:
-h, --help &lt;span class="nb">help&lt;/span> &lt;span class="k">for&lt;/span> hub-tool
--verbose Print logs
--version Display the version of this tool
Use &lt;span class="s2">&amp;#34;hub-tool [command] --help&amp;#34;&lt;/span> &lt;span class="k">for&lt;/span> more information about a command.
&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä»ä¸€çº§èœå•æ¥çœ‹ï¼Œä¸»è¦åŠŸèƒ½åŒ…æ‹¬ï¼š&lt;/p>
&lt;ul>
&lt;li>ç™»å½•/ç™»å‡º DockerHub;&lt;/li>
&lt;li>è´¦æˆ·ç›¸å…³ç®¡ç†åŠŸèƒ½ï¼›&lt;/li>
&lt;li>ç»„ç»‡ç›¸å…³ç®¡ç†åŠŸèƒ½ï¼›&lt;/li>
&lt;li>ä»“åº“å’Œ tag çš„ç›¸å…³ç®¡ç†åŠŸèƒ½ï¼›&lt;/li>
&lt;li>token çš„ç›¸å…³ç®¡ç†åŠŸèƒ½ï¼›&lt;/li>
&lt;/ul>
&lt;p>å½“å‰æˆ‘ä½¿ç”¨çš„æ˜¯æœ€æ–°ç‰ˆæœ¬ v0.2.0 ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ hub-tool version
Version: v0.2.0
Git commit: 0edf43ac9091e7cac892cbc4cbc6efbafb665aa4
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="ç™»å½•é€€å‡º">ç™»å½•/é€€å‡º&lt;/h2>
&lt;p>ç™»å½•/é€€å‡ºåªè¦æ‰§è¡Œ &lt;code>hub-tool login&lt;/code> æˆ–è€… &lt;code>hub-tool logout&lt;/code> å³å¯ã€‚&lt;/p>
&lt;p>ä½†è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ &lt;strong>Hub Tool å¹¶æ²¡æœ‰ä½¿ç”¨ Docker Desktop é»˜è®¤çš„ç”¨æˆ·å‡­è¯&lt;/strong>ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå³ä½¿ä½ åœ¨ Docker Desktop ä¸­å·²ç»ç™»å½•äº†å¸å·ï¼Œä½ åŒæ ·è¿˜æ˜¯éœ€è¦å†æ¬¡åœ¨ç»ˆç«¯ä¸‹æ‰§è¡Œ login æ“ä½œã€‚&lt;/p>
&lt;p>å…³äºä¸ºä½•æ²¡æœ‰å…±ç”¨ç”¨æˆ·å‡­è¯çš„é—®é¢˜ï¼Œæˆ‘è·Ÿ Docker Inc. çš„äº§å“ç»ç†èŠè¿‡ï¼Œæ˜¯å› ä¸ºå½“å‰ Hub Tool è¿˜æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ CLI å·¥å…·ï¼Œå¹¶æ²¡æœ‰ä¸ docker CLI è¿›è¡Œé›†æˆï¼Œä¹Ÿæš‚æ—¶æ²¡æƒ³å¥½è¦å¦‚ä½•é›†æˆã€‚ç­‰çœŸæ­£è¦é›†æˆè¿› docker CLI çš„æ—¶å€™ï¼Œå°±ä¼šç›´æ¥å…±ç”¨ç”¨æˆ·å‡­è¯äº†ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ hub-tool login
Username: moelove
Password:
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="è´¦æˆ·ç®¡ç†">è´¦æˆ·ç®¡ç†&lt;/h2>
&lt;p>è´¦æˆ·ç®¡ç†çš„ä¸¤ä¸ªåŠŸèƒ½ï¼š&lt;/p>
&lt;ul>
&lt;li>æŸ¥çœ‹è´¦æˆ·ä¿¡æ¯ï¼›&lt;/li>
&lt;li>&lt;strong>æŸ¥çœ‹å½“å‰è´¦æˆ·ä¸‹çš„æµé‡é™åˆ¶&lt;/strong> , è¿™æ˜¯æˆ‘ä¸ªäººè§‰å¾—æ¯”è¾ƒæœ‰ç”¨çš„ä¸€ä¸ªåŠŸèƒ½ï¼›&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ hub-tool account
Manage your account
Usage:
hub-tool account
hub-tool account &lt;span class="o">[&lt;/span>command&lt;span class="o">]&lt;/span>
Available Commands:
info Print the account information
rate-limiting Print the rate limiting information
Flags:
-h, --help &lt;span class="nb">help&lt;/span> &lt;span class="k">for&lt;/span> account
Global Flags:
--verbose Print logs
Use &lt;span class="s2">&amp;#34;hub-tool account [command] --help&amp;#34;&lt;/span> &lt;span class="k">for&lt;/span> more information about a command.
&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ hub-tool account rate-limiting
Limit: 200, &lt;span class="m">6&lt;/span> hours window
Remaining: 200, &lt;span class="m">6&lt;/span> hours window
&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ hub-tool account info
Username: moelove.info
Full name: Jintao Zhang
Company:
Location:
Joined: &lt;span class="m">6&lt;/span> years ago
Plan: free
Limits:
Seats: &lt;span class="m">1&lt;/span>
Private repositories: &lt;span class="m">1&lt;/span>
Parallel builds: &lt;span class="m">1&lt;/span>
Collaborators: unlimited
Teams: unlimited
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="ç»„ç»‡ç®¡ç†">ç»„ç»‡ç®¡ç†&lt;/h2>
&lt;p>å¯ä»¥çœ‹åˆ°ï¼Œ&lt;code>hub-tool org&lt;/code> çš„åŠŸèƒ½å°±æ˜¯å±•ç¤ºä¸€äº›ç›¸å…³ä¿¡æ¯äº†ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ hub-tool org
Manage organizations
Usage:
hub-tool org
hub-tool org &lt;span class="o">[&lt;/span>command&lt;span class="o">]&lt;/span>
Available Commands:
ls List all the organizations
members List all the members in an organization
teams List all the teams in an organization
Flags:
-h, --help &lt;span class="nb">help&lt;/span> &lt;span class="k">for&lt;/span> org
Global Flags:
--verbose Print logs
Use &lt;span class="s2">&amp;#34;hub-tool org [command] --help&amp;#34;&lt;/span> &lt;span class="k">for&lt;/span> more information about a command.
&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ hub-tool org ls
NAMESPACE NAME MY ROLE TEAMS MEMBERS
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="ä»“åº“å’Œ-tag-ç®¡ç†">ä»“åº“å’Œ tag ç®¡ç†&lt;/h2>
&lt;p>ç”±äºè¿™ä¸¤ä¸ªéƒ½å’Œé•œåƒæœ‰ç›´æ¥çš„å…³ç³»ï¼Œæˆ‘å°±èšåˆåˆ°ä¸€èµ·ä»‹ç»äº†ã€‚&lt;/p>
&lt;ul>
&lt;li>å¯¹ repo çš„æŸ¥è¯¢å’Œåˆ é™¤åŠŸèƒ½ï¼š&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ hub-tool repo -h
Manage repositories
Usage:
hub-tool repo
hub-tool repo &lt;span class="o">[&lt;/span>command&lt;span class="o">]&lt;/span>
Available Commands:
ls List all the repositories from your account or an organization
rm Delete a repository
Flags:
-h, --help &lt;span class="nb">help&lt;/span> &lt;span class="k">for&lt;/span> repo
Global Flags:
--verbose Print logs
Use &lt;span class="s2">&amp;#34;hub-tool repo [command] --help&amp;#34;&lt;/span> &lt;span class="k">for&lt;/span> more information about a command.
&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ hub-tool repo ls
REPOSITORY DESCRIPTION LAST UPDATE PULLS STARS PRIVATE
taobeier/saythx-work &lt;span class="m">2&lt;/span> years ago &lt;span class="m">56989&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="nb">false&lt;/span>
...
&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ hub-tool repo ls -h
List all the repositories from your account or an organization
Usage:
hub-tool repo ls &lt;span class="o">[&lt;/span>ORGANIZATION&lt;span class="o">]&lt;/span>
Aliases:
ls, list
Flags:
--all Fetch all available repositories
--format string Print values using a custom format &lt;span class="o">(&lt;/span>&lt;span class="s2">&amp;#34;json&amp;#34;&lt;/span>&lt;span class="o">)&lt;/span>
-h, --help &lt;span class="nb">help&lt;/span> &lt;span class="k">for&lt;/span> ls
Global Flags:
--verbose Print logs
&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>å¯¹ tag çš„åˆ—è¡¨ï¼ŒæŸ¥è¯¢ï¼ŒæŸ¥çœ‹è¯¦ç»†ç­‰åŠŸèƒ½ã€‚ è¿™é‡Œ &lt;strong>å¯ä»¥çœ‹åˆ° tag æœ€è¿‘ä¸€æ¬¡çš„ Push/Pull æ“ä½œï¼Œå¦‚æœæ˜å¹´ Docker å¼€å§‹å®è¡Œé•œåƒä¿ç•™ç­–ç•¥çš„è¯ï¼Œæˆ‘å»ºè®®ä½ å…³æ³¨ä¸€ä¸‹&lt;/strong> ï¼›&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ hub-tool tag
Manage tags
Usage:
hub-tool tag &lt;span class="o">[&lt;/span>flags&lt;span class="o">]&lt;/span>
hub-tool tag &lt;span class="o">[&lt;/span>command&lt;span class="o">]&lt;/span>
Available Commands:
inspect Show the details of an image in the registry
ls List all the images in a repository
rm Delete a tag in a repository
Flags:
-h, --help &lt;span class="nb">help&lt;/span> &lt;span class="k">for&lt;/span> tag
Global Flags:
--verbose Print logs
Use &lt;span class="s2">&amp;#34;hub-tool tag [command] --help&amp;#34;&lt;/span> &lt;span class="k">for&lt;/span> more information about a command.
See &lt;span class="s1">&amp;#39;hub-tool tag ls --help&amp;#39;&lt;/span>.
Usage: hub-tool tag ls &lt;span class="o">[&lt;/span>OPTION&lt;span class="o">]&lt;/span> REPOSITORY
List all the images in a repository
&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ hub-tool tag ls taobeier/saythx-work
TAG DIGEST STATUS LAST UPDATE LAST PUSHED LAST PULLED SIZE
taobeier/saythx-work:latest sha256:3133a607d062dd3a8b46f38c8271099c258f5e59cecd652bebddf6e15789cb32 active &lt;span class="m">2&lt;/span> years ago &lt;span class="m">2&lt;/span> years &lt;span class="m">6&lt;/span> days 52.94MB
taobeier/saythx-work:1.0 sha256:3133a607d062dd3a8b46f38c8271099c258f5e59cecd652bebddf6e15789cb32 active &lt;span class="m">2&lt;/span> years ago &lt;span class="m">2&lt;/span> years &lt;span class="m">6&lt;/span> days 52.94MB
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="token-ç›¸å…³ç®¡ç†åŠŸèƒ½">Token ç›¸å…³ç®¡ç†åŠŸèƒ½&lt;/h2>
&lt;p>å¯¹ä¸ªäºº Token çš„åˆ›å»º/åˆ é™¤ï¼Œæ¿€æ´»/å¤±æ•ˆï¼Œåˆ—è¡¨ï¼ŒæŸ¥è¯¢è¯¦ç»†ç­‰åŠŸèƒ½ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ hub-tool token -h
Manage Personal Access Tokens
Usage:
hub-tool token &lt;span class="o">[&lt;/span>flags&lt;span class="o">]&lt;/span>
hub-tool token &lt;span class="o">[&lt;/span>command&lt;span class="o">]&lt;/span>
Available Commands:
activate Activate a Personal Access Token
create Create a Personal Access Token
deactivate Deactivate a Personal Access Token
inspect Inspect a Personal Access Token
ls List all the Personal Access Tokens
rm Delete a Personal Access Token
Flags:
-h, --help &lt;span class="nb">help&lt;/span> &lt;span class="k">for&lt;/span> token
Global Flags:
--verbose Print logs
Use &lt;span class="s2">&amp;#34;hub-tool token [command] --help&amp;#34;&lt;/span> &lt;span class="k">for&lt;/span> more information about a command.
&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ hub-tool token ls
DESCRIPTION UUID LAST USED CREATED ACTIVE
test-docker-token xxxxxxxx-xxxx-xxxx-xxxx-moelove.info &lt;span class="m">9&lt;/span> months ago &lt;span class="m">9&lt;/span> months &lt;span class="nb">true&lt;/span>
&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ hub-tool token inspect xxxxxxxx-xxxx-xxxx-xxxx-moelove.info
Token:
UUID: xxxxxxxx-xxxx-xxxx-xxxx-moelove.info
Description: test-docker-token
Is Active: &lt;span class="nb">true&lt;/span>
Created: &lt;span class="m">9&lt;/span> months ago
Last Used: &lt;span class="m">9&lt;/span> months ago
Creator User Agent: Mozilla/5.0 &lt;span class="o">(&lt;/span>X11&lt;span class="p">;&lt;/span> Fedora&lt;span class="p">;&lt;/span> Linux x86_64&lt;span class="o">)&lt;/span> AppleWebKit/537.36 &lt;span class="o">(&lt;/span>KHTML, like Gecko&lt;span class="o">)&lt;/span> Chrome/80.0.4103.116 Safari/537.36
Creator IP: 100.000.000.00
Generated: By user via Web UI
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="æ€»ç»“">æ€»ç»“&lt;/h2>
&lt;p>ä»¥ä¸Šå°±æ˜¯å…³äº Docker æ–°å‘å¸ƒçš„ Hub Tool çš„å…¨éƒ¨åŠŸèƒ½ä»‹ç»äº†ã€‚
å½“å‰å®ƒæ˜¯éšç€ Docker Desktop ä¸€èµ·å‘è¡Œçš„ï¼Œæ‰€ä»¥ Linux ä¸‹æš‚æ—¶æ²¡æœ‰ã€‚ä½†æ˜¯è®¡åˆ’ä¼šå°½å¿«å¼€æºã€‚æ•¬è¯·æœŸå¾…ï¼&lt;/p>
&lt;hr>
&lt;p>æ¬¢è¿è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://gitee.com/tlrr/awesome/raw/master/2020-9-9/1599632564572-mp-qrcode.png" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Docker/">Docker</category><category domain="https://moelove.info/tags/DockerHub/">DockerHub</category><category domain="https://moelove.info/tags/Container/">Container</category></item><item><title>Go 1.16 ä¸­å…³äº go get å’Œ go install ä½ éœ€è¦æ³¨æ„çš„åœ°æ–¹</title><link>https://moelove.info/2020/12/19/Go-1.16-%E4%B8%AD%E5%85%B3%E4%BA%8E-go-get-%E5%92%8C-go-install-%E4%BD%A0%E9%9C%80%E8%A6%81%E6%B3%A8%E6%84%8F%E7%9A%84%E5%9C%B0%E6%96%B9/</link><guid isPermaLink="true">https://moelove.info/2020/12/19/Go-1.16-%E4%B8%AD%E5%85%B3%E4%BA%8E-go-get-%E5%92%8C-go-install-%E4%BD%A0%E9%9C%80%E8%A6%81%E6%B3%A8%E6%84%8F%E7%9A%84%E5%9C%B0%E6%96%B9/</guid><pubDate>Sat, 19 Dec 2020 02:27:18 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;p>Go (golang) å·²äº 18 æ—¥å‘å¸ƒäº† 1.16 beta1 ç‰ˆæœ¬ï¼Œè‡³æ­¤å…¶ä¸»ä½“åŠŸèƒ½å·²ç»åŸºæœ¬ç¡®å®šã€‚æˆ‘çœ‹å¤§å¤šæ•°äººéƒ½åœ¨å…³æ³¨ Go åœ¨è‹¹æœ(Apple) M1 ä¸Šçš„æ”¯æŒï¼Œç”šè‡³ Go å®˜æ–¹åšå®¢ä¸­ä¹Ÿæœ‰ä¸€ç¯‡ä¸“é—¨çš„è¯´æ˜ &lt;a href="https://blog.golang.org/ports" title="Go on ARM and Beyond">Go on ARM and Beyond&lt;/a> ï¼Œæ¥ä»‹ç» Go åœ¨æ­¤æ–¹é¢çš„æ”¯æŒã€‚&lt;/p>
&lt;p>æˆ‘å°±ä¸å‡‘çƒ­é—¹äº†ï¼Œæˆ‘æ¥èŠèŠ Go 1.16 ä¸­å…³äº &lt;code>go get&lt;/code> å’Œ &lt;code>go install&lt;/code> ä½ éœ€è¦æ³¨æ„çš„åœ°æ–¹ã€‚&lt;/p>
&lt;p>ç›®å‰ Docker å®˜æ–¹é•œåƒå°šæœªå‘å¸ƒï¼Œæˆ‘æ˜¯æœ¬åœ°æ„å»ºäº†ä¸ªé•œåƒæ¥ä½¿ç”¨ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ go version
go version go1.16beta1 linux/amd64
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="æ¦‚è§ˆ">æ¦‚è§ˆ&lt;/h2>
&lt;p>Go 1.16 ä¸­åŒ…å«ç€å¤§é‡çš„ Modules ç›¸å…³çš„æ›´æ–°ï¼Œè¯¦ç»†å†…å®¹å¯ç›´æ¥æŸ¥çœ‹å…¶ &lt;a href="https://tip.golang.org/doc/go1.16#tools" title="Go 1.16 Release Note">Release Note&lt;/a>ã€‚æ•´ä½“è€Œè¨€ï¼ŒåŒ…å«ä»¥ä¸‹è¦ç‚¹ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;code>GO111MODULE&lt;/code> é»˜è®¤ä¸º &lt;code>on&lt;/code> ï¼Œå¦‚æœè¦æ¢å¤åˆ°ä¹‹å‰çš„è¡Œä¸ºï¼Œåˆ™éœ€è¦å°† &lt;code>GO111MODULE&lt;/code> è®¾ç½®ä¸º &lt;code>auto&lt;/code> ï¼Œè¿™æ ·å·®ä¸å¤šæ„å‘³ç€ GOPATH æ¨¡å¼è¦é€æ­¥æ·¡å‡ºäººä»¬çš„è§†é‡äº†ï¼›&lt;/li>
&lt;li>&lt;code>go install&lt;/code> å‘½ä»¤å¯ä»¥æ¥å—ä¸€ä¸ªç‰ˆæœ¬åç¼€äº†ï¼Œï¼ˆä¾‹å¦‚ï¼Œgo install &lt;a href="mailto:sigs.k8s.io/kind@v0.9.0">sigs.k8s.io/kind@v0.9.0&lt;/a>ï¼‰ï¼Œå¹¶ä¸”å®ƒæ˜¯åœ¨æ¨¡å—æ„ŸçŸ¥çš„æ¨¡å¼ä¸‹è¿è¡Œï¼Œå¯å¿½ç•¥å½“å‰ç›®å½•æˆ–ä¸Šå±‚ç›®å½•çš„ &lt;code>go.mod&lt;/code> æ–‡ä»¶ã€‚è¿™å¯¹äºåœ¨ä¸å½±å“ä¸»æ¨¡å—ä¾èµ–çš„æƒ…å†µä¸‹ï¼Œå®‰è£…äºŒè¿›åˆ¶å¾ˆæ–¹ä¾¿ï¼›&lt;/li>
&lt;li>åœ¨å°†æ¥ï¼Œ&lt;code>go install&lt;/code> è¢«è®¾è®¡ä¸ºâ€œç”¨äºæ„å»ºå’Œå®‰è£…äºŒè¿›åˆ¶æ–‡ä»¶â€ï¼Œ &lt;code>go get&lt;/code> åˆ™è¢«è®¾è®¡ä¸º â€œç”¨äºç¼–è¾‘ go.mod å˜æ›´ä¾èµ–â€ï¼Œå¹¶ä¸”ä½¿ç”¨æ—¶ï¼Œåº”è¯¥ä¸ &lt;code>-d&lt;/code> å‚æ•°å…±ç”¨ï¼Œåœ¨å°†æ¥ç‰ˆæœ¬ä¸­ &lt;code>-d&lt;/code> å¯èƒ½ä¼šé»˜è®¤å¯ç”¨ï¼›&lt;/li>
&lt;li>&lt;code>go build&lt;/code> å’Œ &lt;code>go test&lt;/code> é»˜è®¤æƒ…å†µä¸‹ä¸å†ä¿®æ”¹ &lt;code>go.mod&lt;/code> å’Œ &lt;code>go.sum&lt;/code>ã€‚å¯é€šè¿‡ &lt;code>go mod tidy&lt;/code> ï¼Œ&lt;code>go get&lt;/code> æˆ–è€…æ‰‹åŠ¨å®Œæˆï¼›&lt;/li>
&lt;/ul>
&lt;p>æ€»ç»“è€Œè¨€ï¼Œå…³äº &lt;code>go install&lt;/code> å’Œ &lt;code>go get&lt;/code> å¿…é¡»è¦æ³¨æ„çš„æ˜¯ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>åŸºæœ¬ä¸Š &lt;code>go install &amp;lt;package&amp;gt;@&amp;lt;version&amp;gt;&lt;/code> æ˜¯ç”¨äºå‘½ä»¤çš„å…¨å±€å®‰è£…ï¼š&lt;/p>
&lt;ul>
&lt;li>ä¾‹å¦‚ï¼š&lt;code>go install sigs.k8s.io/kind@v0.9.0&lt;/code>;&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;code>go get&lt;/code> å®‰è£…äºŒè¿›åˆ¶çš„åŠŸèƒ½ï¼Œåç»­ç‰ˆæœ¬å°†ä¼šåˆ é™¤ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>go get&lt;/code> ä¸»è¦è¢«è®¾è®¡ä¸ºä¿®æ”¹ &lt;code>go.mod&lt;/code> è¿½åŠ ä¾èµ–ä¹‹ç±»çš„ï¼Œä½†è¿˜å­˜åœ¨ç±»ä¼¼ &lt;code>go mod tidy&lt;/code> ä¹‹ç±»çš„å‘½ä»¤ï¼Œæ‰€ä»¥ä½¿ç”¨é¢‘ç‡å¯èƒ½ä¸ä¼šå¾ˆé«˜ï¼›&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="go-116-ä¸­å·²è§£å†³çš„å·¥å…·å®‰è£…é—®é¢˜">Go 1.16 ä¸­å·²è§£å†³çš„å·¥å…·å®‰è£…é—®é¢˜&lt;/h2>
&lt;p>åˆ°ç›®å‰ä¸ºæ­¢ï¼ŒGo ä¸€ç›´ä½¿ç”¨ &lt;code>go get&lt;/code> å‘½ä»¤ï¼Œå°†æˆ‘ä»¬éœ€è¦çš„å·¥å…·å®‰è£…åˆ° &lt;code>$GOPATH/bin&lt;/code> ç›®å½•ä¸‹ï¼Œä½†è¿™ç§æ–¹å¼å­˜åœ¨ä¸€ä¸ªå¾ˆä¸¥é‡çš„é—®é¢˜ã€‚&lt;code>go get&lt;/code> ç”±äºå…·å¤‡æ›´æ”¹ &lt;code>go.mod&lt;/code> æ–‡ä»¶çš„èƒ½åŠ›ï¼Œå› æ­¤æˆ‘ä»¬ &lt;strong>å¿…é¡»è¦é¿å…æ‰§è¡Œ &lt;code>go get&lt;/code> å‘½ä»¤æ—¶ï¼Œè®©å®ƒæ¥è§¦åˆ°æˆ‘ä»¬çš„ &lt;code>go.mod&lt;/code> æ–‡ä»¶&lt;/strong> ï¼Œå¦åˆ™å®ƒä¼šå°†æˆ‘ä»¬å®‰è£…çš„å·¥å…·ä½œä¸ºä¸€ä¸ªä¾èµ–ã€‚&lt;/p>
&lt;p>ç›®å‰çš„è§£å†³æ–¹æ¡ˆé€šå¸¸æ˜¯ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ &lt;span class="nb">cd&lt;/span> &lt;span class="k">$(&lt;/span>mktemp -d&lt;span class="k">)&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="nv">GO111MODULE&lt;/span>&lt;span class="o">=&lt;/span>on go get sigs.k8s.io/kind@v0.9.0
&lt;/code>&lt;/pre>&lt;/div>&lt;p>è‡ª 1.16 å¼€å§‹ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨ä¸‹é¢çš„æ–¹å¼ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ go install sigs.k8s.io/kind@v0.9.0
&lt;/code>&lt;/pre>&lt;/div>&lt;p>éå¸¸çš„ç®€å•ç›´è§‚ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ &lt;code>go install &amp;lt;package&amp;gt;@&amp;lt;version&amp;gt;&lt;/code> æ˜¯ä» 1.16 å¼€å§‹å¢åŠ çš„ï¼Œæ— è®ºä½ å½“å‰æ˜¯å¦åœ¨ä¸€ä¸ªæ¨¡å—ä¸‹ï¼Œæ­¤å‘½ä»¤éƒ½ä¼šåœ¨ &lt;code>$GOPATH/bin&lt;/code> ä¸‹å®‰è£…æŒ‡å®šç‰ˆæœ¬çš„å·¥å…·ã€‚&lt;/p>
&lt;p>æ­¤å¤–ç”±äº Go 1.16 ä¸­ &lt;code>GO111MODULE&lt;/code> é»˜è®¤æ˜¯æ‰“å¼€çš„ï¼Œ&lt;code>go install&lt;/code> ä¸ä¼šä¿®æ”¹ &lt;code>go.mod&lt;/code> ä¹‹ç±»çš„æ–‡ä»¶ï¼Œä¸ä¼šé€ æˆä»»ä½•æ„å¤–ã€‚&lt;/p>
&lt;p>æ³¨æ„ï¼š&lt;/p>
&lt;p>&lt;code>@version&lt;/code> åªèƒ½å®‰è£…ä¸»è½¯ä»¶åŒ…ã€‚éä¸»ç¨‹åºåŒ…ä¸å—æ­¤æ ¼å¼çº¦æŸã€‚&lt;/p>
&lt;h3 id="å…³äºä¸å¸¦-version-çš„-go-install">å…³äºä¸å¸¦ &lt;code>@version&lt;/code> çš„ &lt;code>go install&lt;/code>&lt;/h3>
&lt;ul>
&lt;li>åœ¨æ¨¡å—å¤–ï¼Œä¸å¸¦ &lt;code>@version&lt;/code> æ˜¯æ— æ³•å®‰è£…çš„ï¼Œä¼šæœ‰å¦‚ä¸‹é”™è¯¯:&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ go install -v sigs.k8s.io/kind
go install: version is required when current directory is not in a module
Try &lt;span class="s1">&amp;#39;go install sigs.k8s.io/kind@latest&amp;#39;&lt;/span> to install the latest version
&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>å¦‚æœä½ åœ¨æ¨¡å—ç›®å½•ä¸­ï¼Œå¹¶ä¸”ä½ ä¸å¸¦ &lt;code>@version&lt;/code> æ‰§è¡Œå®‰è£…çš„è¯ï¼Œåªèƒ½å®‰è£… &lt;code>go.mod&lt;/code> ä¸­å·²ç»åŒ…å«çš„ç‰ˆæœ¬ã€‚å¹¶ä¸”ä¸èƒ½å®‰è£…æœªå‡ºç°åœ¨ &lt;code>go.mod&lt;/code> ä¸­çš„åŒ…ã€‚&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ mkdir -p /go/src/github.com/moelove/iris
&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ &lt;span class="nb">cd&lt;/span> /go/src/github.com/moelove/iris
&lt;span class="c1"># åˆå§‹åŒ–æ¨¡å—&lt;/span>
&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ /go/src/github.com/moelove/iris go mod init
go: creating new go.mod: module github.com/moelove/iris
&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ /go/src/github.com/moelove/iris cat go.mod
module github.com/moelove/iris
go 1.16
&lt;span class="c1"># ä¸å¸¦ @version æ— æ³•å®‰è£…&lt;/span>
&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ /go/src/github.com/moelove/iris go install -v sigs.k8s.io/kind
no required module provides package sigs.k8s.io/kind&lt;span class="p">;&lt;/span> try &lt;span class="s1">&amp;#39;go get -d sigs.k8s.io/kind&amp;#39;&lt;/span> to add it
&lt;span class="c1"># ç”¨ go get -d ä¸‹è½½&lt;/span>
&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ /go/src/github.com/moelove/iris go get -d sigs.k8s.io/kind
go get: added sigs.k8s.io/kind v0.9.0
&lt;span class="c1"># å¯ä»¥çœ‹åˆ°å·²ç»è¢«æ·»åŠ åˆ°äº†æ¨¡å—ä¾èµ–ä¸­&lt;/span>
&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ /go/src/github.com/moelove/iris cat go.mod
module github.com/moelove/iris
go 1.16
require sigs.k8s.io/kind v0.9.0 // indirect
&lt;span class="c1"># åˆ é™¤æœ¬åœ°çš„ kind å·¥å…·&lt;/span>
&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ /go/src/github.com/moelove/iris which kind
/go/bin/kind
&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ /go/src/github.com/moelove/iris rm /go/bin/kind
&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ /go/src/github.com/moelove/iris which kind
&lt;span class="c1"># ä¸å¸¦ @version è¿›è¡Œå®‰è£…&lt;/span>
&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ /go/src/github.com/moelove/iris go install -v sigs.k8s.io/kind
&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ /go/src/github.com/moelove/iris which kind
/go/bin/kind
&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ /go/src/github.com/moelove/iris kind version
kind v0.9.0 go1.16beta1 linux/amd64
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="å…³äº-go-get-å’Œ-gomod">å…³äº &lt;code>go get&lt;/code> å’Œ &lt;code>go.mod&lt;/code>&lt;/h2>
&lt;p>&lt;code>go get&lt;/code> å°†äºŒè¿›åˆ¶å®‰è£…ç›¸å…³çš„åŠŸèƒ½éƒ½è½¬ç§»åˆ°äº† &lt;code>go install&lt;/code>, ä»…ä½œä¸ºç”¨äºç¼–è¾‘ &lt;code>go.mod&lt;/code> æ–‡ä»¶çš„å‘½ä»¤å­˜åœ¨ã€‚åœ¨åç»­ç‰ˆæœ¬ï¼ˆè®¡åˆ’æ˜¯ Go 1.17ï¼‰ä¸­åˆ æ‰ &lt;code>go get&lt;/code> å®‰è£…äºŒè¿›åˆ¶çš„åŠŸèƒ½ï¼Œæ¥ä¸‹æ¥ &lt;code>go get&lt;/code> çš„è¡Œä¸ºå°±ç­‰åŒäºæˆ‘ä»¬ç°åœ¨æ‰§è¡Œ &lt;code>go get -d&lt;/code> å‘½ä»¤äº†ï¼Œä»…éœ€ä¸‹è½½æºç ï¼Œå¹¶å°†ä¾èµ–æ·»åŠ è‡³ &lt;code>go.mod&lt;/code> å³å¯ã€‚&lt;/p>
&lt;h3 id="gomod-å¦‚ä½•ç¼–è¾‘">&lt;code>go.mod&lt;/code> å¦‚ä½•ç¼–è¾‘&lt;/h3>
&lt;p>åœ¨ Go 1.16 ä¸­ï¼Œå¦ä¸€ä¸ªè¡Œä¸ºå˜æ›´æ˜¯ &lt;code>go build&lt;/code> å’Œ &lt;code>go test&lt;/code> ä¸ä¼šè‡ªåŠ¨ç¼–è¾‘ &lt;code>go.mod&lt;/code> äº†ï¼ŒåŸºäºä»¥ä¸Šä¿¡æ¯ï¼ŒGo 1.16 ä¸­å°†è¿›è¡Œå¦‚ä¸‹å¤„ç†ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>é€šè¿‡åœ¨ä»£ç ä¸­ä¿®æ”¹ import è¯­å¥ï¼Œæ¥ä¿®æ”¹ &lt;code>go.mod&lt;/code>ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;code>go get&lt;/code> å¯ç”¨äºæ·»åŠ æ–°æ¨¡å—ï¼›&lt;/li>
&lt;li>&lt;code>go mod tidy&lt;/code> åˆ é™¤æ‰æ— ç”¨çš„æ¨¡å—ï¼›&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>å°†æœªå¯¼å…¥çš„æ¨¡å—å†™å…¥ &lt;code>go.mod&lt;/code>:&lt;/p>
&lt;ul>
&lt;li>&lt;code>go get &amp;lt;package&amp;gt;[@&amp;lt;version&amp;gt;]&lt;/code>;&lt;/li>
&lt;li>&lt;code>go mod tidy&lt;/code> ä¹Ÿå¯ä»¥ï¼›&lt;/li>
&lt;li>æ‰‹åŠ¨ç¼–è¾‘ï¼›&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="ä»-115-å‡çº§éœ€è¦æ³¨æ„ä»€ä¹ˆ">ä» 1.15 å‡çº§éœ€è¦æ³¨æ„ä»€ä¹ˆï¼Ÿ&lt;/h2>
&lt;p>ç”±äº &lt;code>go build&lt;/code> å’Œ &lt;code>go test&lt;/code> ä¸ä¼šè‡ªåŠ¨ç¼–è¾‘ &lt;code>go.mod&lt;/code> äº†ï¼Œæ‰€ä»¥å¯ä»¥å°†åŸæœ¬çš„è¡Œä¸ºé€šè¿‡ &lt;code>go mod tidy&lt;/code> å…±åŒå¤„ç†ã€‚&lt;/p>
&lt;h2 id="æ€»ç»“">æ€»ç»“&lt;/h2>
&lt;p>Go 1.16 ä¸­ &lt;code>go install&lt;/code> å’Œ &lt;code>go get&lt;/code> æ–¹é¢æœ‰äº›ä¸å…¼å®¹çš„å˜æ›´ï¼Œä½†æ˜¯ 1.16 ä¸­æ¨¡å—æ›´åŠ ç®€æ´ï¼Œå‡å°‘äº†ä½¿ç”¨æ—¶çš„å¿ƒæ™ºè´Ÿæ‹…ï¼Œæˆ‘è¿˜æ˜¯å¾ˆæœŸå¾…è¿™ä¸ªç‰ˆæœ¬çš„ã€‚&lt;/p>
&lt;hr>
&lt;p>æ¬¢è¿è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://gitee.com/tlrr/awesome/raw/master/2020-9-9/1599632564572-mp-qrcode.png" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/golang/">golang</category></item><item><title>K8S å¼ƒç”¨ Docker äº†ï¼ŸDocker ä¸èƒ½ç”¨äº†ï¼Ÿåˆ«é€—äº†ï¼</title><link>https://moelove.info/2020/12/03/K8S-%E5%BC%83%E7%94%A8-Docker-%E4%BA%86Docker-%E4%B8%8D%E8%83%BD%E7%94%A8%E4%BA%86%E5%88%AB%E9%80%97%E4%BA%86/</link><guid isPermaLink="true">https://moelove.info/2020/12/03/K8S-%E5%BC%83%E7%94%A8-Docker-%E4%BA%86Docker-%E4%B8%8D%E8%83%BD%E7%94%A8%E4%BA%86%E5%88%AB%E9%80%97%E4%BA%86/</guid><pubDate>Thu, 03 Dec 2020 22:32:59 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>Docker å¤§æ¦‚æ²¡æƒ³åˆ°ï¼Œ2020 å¹´ï¼Œå®ƒåœ¨æŠ€æœ¯åœˆå†…çš„ä¸¤æ¬¡æˆä¸ºï¼ˆèˆ†è®ºçš„ï¼‰ç„¦ç‚¹ï¼Œç«Ÿç„¶éƒ½æ˜¯å› ä¸ºä¿¡æ¯å·®ï¼ˆè¯´æ˜¯â€œæ ‡é¢˜å…šâ€ä¹Ÿä¸ä¸ºè¿‡ï¼‰ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="æ¦‚è§ˆ">æ¦‚è§ˆ&lt;/h2>
&lt;h3 id="2013-å¹´">2013 å¹´&lt;/h3>
&lt;p>Docker æ˜¯åœ¨ 2013 å¹´çš„ PyCon ä¸Šé¦–æ¬¡æ­£å¼å¯¹å¤–å…¬å¸ƒçš„ã€‚
å®ƒå¸¦æ¥äº†ä¸€ç§å…ˆè¿›çš„è½¯ä»¶äº¤ä»˜æ–¹å¼ï¼Œå³ï¼Œé€šè¿‡å®¹å™¨é•œåƒè¿›è¡Œè½¯ä»¶çš„äº¤ä»˜ã€‚
å·¥ç¨‹å¸ˆä»¬åªéœ€è¦ç®€å•çš„ &lt;code>docker build&lt;/code> å‘½ä»¤å³å¯åˆ¶ä½œå‡ºè‡ªå·±çš„é•œåƒï¼Œå¹¶é€šè¿‡ &lt;code>docker push&lt;/code> å°†å…¶å‘å¸ƒè‡³ DockerHub ä¸Šã€‚
é€šè¿‡ç®€å•çš„ &lt;code>docker run&lt;/code> å‘½ä»¤å³å¯å¿«é€Ÿçš„ä½¿ç”¨æŒ‡å®šé•œåƒå¯åŠ¨è‡ªå·±çš„æœåŠ¡ã€‚&lt;/p>
&lt;p>é€šè¿‡è¿™ç§åŠæ³•ï¼Œå¯ä»¥æœ‰æ•ˆçš„è§£å†³è½¯ä»¶è¿è¡Œæ—¶ç¯å¢ƒå·®å¼‚å¸¦æ¥çš„é—®é¢˜ï¼Œè¾¾åˆ°å…¶ &lt;strong>Build once, Run anywhere&lt;/strong> çš„ç›®æ ‡ã€‚&lt;/p>
&lt;p>ä»æ­¤ &lt;strong>Docker ä¹ŸåŸºæœ¬æˆä¸ºäº†å®¹å™¨çš„ä»£åè¯ï¼Œå¹¶æˆä¸ºå®¹å™¨æ—¶ä»£çš„å¼•é¢†è€…ã€‚&lt;/strong>&lt;/p>
&lt;h3 id="2014-å¹´">2014 å¹´&lt;/h3>
&lt;p>2014 å¹´ Google æ¨å‡º Kubernetes ç”¨äºè§£å†³å¤§è§„æ¨¡åœºæ™¯ä¸‹ Docker å®¹å™¨ç¼–æ’çš„é—®é¢˜ã€‚&lt;/p>
&lt;p>&lt;strong>è¿™æ˜¯ä¸€ä¸ªé€»è¾‘é€‰æ‹©ï¼Œåœ¨å½“æ—¶ Docker æ˜¯æœ€æµè¡Œä¹Ÿæ˜¯å”¯ä¸€çš„è¿è¡Œæ—¶ã€‚&lt;/strong> Kubernetes é€šè¿‡å¯¹ Docker å®¹å™¨è¿è¡Œæ—¶çš„æ”¯æŒï¼Œè¿æ¥äº†å¤§é‡çš„ç”¨æˆ·ã€‚&lt;/p>
&lt;p>åŒæ—¶ï¼ŒGoogle åŠ Kubernetes ç¤¾åŒºä¸ Docker ä¹Ÿåœ¨è¿›è¡Œç€å¯†åˆ‡çš„åˆä½œï¼Œåœ¨å…¶å®˜æ–¹åšå®¢ä¸Šæœ‰å¦‚ä¸‹å†…å®¹ï¼š&lt;/p>
&lt;blockquote>
&lt;p>Weâ€™ll continue to build out the feature set, while collaborating with the Docker community to incorporate the best ideas from Kubernetes into Docker.&lt;/p>
&lt;/blockquote>
&lt;p>&lt;a href="https://cloudplatform.googleblog.com/2014/06/an-update-on-container-support-on-google-cloud-platform.html" title="An update on container support on Google Cloud Platform">An update on container support on Google Cloud Platform&lt;/a>&lt;/p>
&lt;blockquote>
&lt;p>Kubernetes is an open source manager for Docker containers, based on Googleâ€™s years of experience using containers at Internet scale.
Docker is delivering the full container stack that Kubernetes schedules into, and is looking to move critical capabilities upstream and align the Kubernetes framework with Libswarm.&lt;/p>
&lt;/blockquote>
&lt;p>&lt;a href="https://cloudplatform.googleblog.com/2014/07/welcome-microsoft-redhat-ibm-docker-and-more-to-the-kubernetes-community.html" title="Welcome Microsoft, RedHat, IBM, Docker and more to the Kubernetes community">Welcome Microsoft, RedHat, IBM, Docker and more to the Kubernetes community&lt;/a>&lt;/p>
&lt;p>å¹¶åœ¨åŒä¸€ä¸ªæœˆçš„ DockerCon ä¸Šå‘å¸ƒæ¼”è®²ï¼Œä»‹ç»äº† Kubernetes å¹¶å—åˆ°äº†å¹¿æ³›çš„å…³æ³¨ã€‚&lt;/p>
&lt;p>æ­¤æ—¶ &lt;strong>Docker Inc. ä¹Ÿå‘å¸ƒäº†å…¶å®¹å™¨ç¼–æ’å·¥å…·ï¼Œ libswarm ï¼ˆä¹Ÿå°±æ˜¯åæ¥çš„ swarmkitï¼‰ ã€‚&lt;/strong>&lt;/p>
&lt;h3 id="2015-å¹´">2015 å¹´&lt;/h3>
&lt;p>2015 å¹´ OCI ï¼ˆOpen Container Initiativeï¼‰ç”± Docker å’Œå…¶ä»–å®¹å™¨è¡Œä¸šé¢†å¯¼è€…å…±åŒæˆç«‹ï¼ˆå®ƒä¹Ÿæ˜¯ Linux åŸºé‡‘ä¼šæ——ä¸‹é¡¹ç›®ï¼‰&lt;/p>
&lt;p>OCI ä¸»è¦åŒ…å«ä¸¤ä¸ªè§„èŒƒï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>è¿è¡Œæ—¶è§„èŒƒï¼ˆruntime-specï¼‰ï¼šå®¹å™¨è¿è¡Œæ—¶ï¼Œå¦‚ä½•è¿è¡ŒæŒ‡å®šçš„ æ–‡ä»¶ç³»ç»Ÿä¸Šçš„åŒ…&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å®¹å™¨é•œåƒè§„èŒƒï¼ˆimage-specï¼‰ï¼šå¦‚ä½•åˆ›å»ºä¸€ä¸ª OCI è¿è¡Œæ—¶å¯è¿è¡Œçš„æ–‡ä»¶ç³»ç»Ÿä¸Šçš„åŒ…&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>Docker æŠŠå®ƒè‡ªå·±çš„å®¹å™¨é•œåƒæ ¼å¼å’Œ runtime ( &lt;strong>ç°åœ¨çš„ runc&lt;/strong> ) éƒ½æç»™äº† OCI ä½œä¸ºåˆå§‹å·¥ä½œã€‚&lt;/p>
&lt;h3 id="2016-å¹´">2016 å¹´&lt;/h3>
&lt;p>2016 å¹´ 6 æœˆï¼ŒDocker v1.12 å‘å¸ƒï¼Œå¸¦æ¥äº† &lt;strong>Docker åœ¨å¤šä¸»æœºå¤šå®¹å™¨çš„ç¼–æ’è§£å†³æ–¹æ¡ˆï¼ŒDocker Swarm ã€‚&lt;/strong>
è¿™é‡Œä¹Ÿéœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒDocker v1.12 çš„è®¾è®¡åŸåˆ™ï¼š&lt;/p>
&lt;ul>
&lt;li>Simple Yet Powerful ï¼ˆç®€å•è€Œå¼ºå¤§ï¼‰&lt;/li>
&lt;li>Resilientï¼ˆå¼¹æ€§ï¼‰&lt;/li>
&lt;li>Secureï¼ˆå®‰å…¨ï¼‰&lt;/li>
&lt;li>Optional Features and Backward Compatibilityï¼ˆå¯é€‰åŠŸèƒ½åŠå‘åå…¼å®¹ï¼‰&lt;/li>
&lt;/ul>
&lt;p>æ‰€ä»¥ä½ å¯ä»¥é€šè¿‡é…ç½®è‡ªè¡Œé€‰æ‹©æ˜¯å¦éœ€è¦ä½¿ç”¨ Docker Swarm ï¼Œè€Œæ— éœ€æ‹…å¿ƒæœ‰ä»€ä¹ˆå‰¯ä½œç”¨ã€‚&lt;/p>
&lt;p>2016 å¹´ 12 æœˆï¼Œ &lt;strong>Kubernetes å‘å¸ƒ CRI ï¼ˆContainer Runtime Interfaceï¼‰&lt;/strong> ï¼Œè¿™å½“ä¸­ä¸€éƒ¨åˆ†åŸå› æ˜¯ç”±äº Kubernetes å°è¯•æ”¯æŒå¦ä¸€ä¸ªç”± CoreOS é¢†å¯¼çš„å®¹å™¨è¿è¡Œæ—¶é¡¹ç›® rkt ï¼Œä½†æ˜¯éœ€è¦å†™å¾ˆå¤šå…¼å®¹çš„ä»£ç ä¹‹ç±»çš„ï¼Œä¸ºäº†é¿å…åç»­å…¼å®¹å…¶ä»–è¿è¡Œæ—¶å¸¦æ¥çš„ç»´æŠ¤å·¥ä½œï¼Œæ‰€ä»¥å‘å¸ƒäº†ç»Ÿä¸€çš„ CRI æ¥å£ï¼Œå‡¡æ˜¯æ”¯æŒ CRI çš„è¿è¡Œæ—¶ï¼Œçš†å¯ç›´æ¥ä½œä¸º Kubernetes çš„åº•å±‚è¿è¡Œæ—¶ï¼›&lt;/p>
&lt;p>å½“ç„¶ï¼Œ &lt;strong>Kubernetes ä¹Ÿæ˜¯åœ¨ 2016 å¹´é€æ­¥å–å¾—é‚£åœºå®¹å™¨ç¼–æ’æˆ˜äº‰çš„èƒœåˆ©çš„ã€‚&lt;/strong>&lt;/p>
&lt;h3 id="2017-å¹´">2017 å¹´&lt;/h3>
&lt;p>2017 å¹´ï¼Œ Docker å°†è‡ªèº«ä» v1.11 èµ·å¼€å§‹å¼•å…¥çš„&lt;a href="https://github.com/containerd/containerd/" title="containerd">å®¹å™¨è¿è¡Œæ—¶ containerd&lt;/a> æç»™äº† &lt;a href="https://www.cncf.io/" title="CNCF website">CNCF&lt;/a>&lt;/p>
&lt;p>2017 å¹´ï¼ŒDocker çš„ç½‘ç»œç»„ä»¶ libnetwork å¢åŠ äº† CNI çš„æ”¯æŒï¼›
åŒæ—¶é€šè¿‡&lt;a href="https://github.com/kubernetes/kubernetes/pull/46580" title="åœ¨ K8S ä¸­å¢åŠ  IPvs çš„è´Ÿè½½å‡è¡¡">ä½¿ç”¨ Docker ä¸º Docker Swarm æä¾›çš„ ipvs ç›¸å…³çš„ä»£ç &lt;/a>ï¼Œä¹Ÿåœ¨ Kubernetes ä¸­å®ç°äº†åŸºäº IPvs çš„ service è´Ÿè½½å‡è¡¡ã€‚ä¸è¿‡åœ¨ v1.18 ä¸­å¼€å§‹ç§»é™¤äº†ç›¸å…³çš„ä¾èµ–ã€‚&lt;/p>
&lt;p>åŒå¹´ 11 æœˆï¼Œ&lt;a href="https://kubernetes.io/blog/2017/11/containerd-container-runtime-options-kubernetes/" title="Containerd Brings More Container Runtime Options for Kubernetes">Kubernetes ä¸­æ–°å¢äº† containerd çš„æ”¯æŒ&lt;/a>&lt;/p>
&lt;p>&lt;img src="https://lh5.googleusercontent.com/sfkhKO3jiLZ9_TtPpxTsKxkbe1KHg1nrfqkbJYrjN2DbNQE_y31NJVSyDIXe0oQjSwVcQ4gFCyr1MZ9_V4GZuuiHwuU3Pq6ldpRhcRiiuTJaRVuezPK9KFLKovP8mQ6sXTYF_eru" alt="cri-containerd">&lt;/p>
&lt;h3 id="2018-å¹´">2018 å¹´&lt;/h3>
&lt;p>2018 å¹´ï¼Œ &lt;a href="https://kubernetes.io/blog/2018/05/24/kubernetes-containerd-integration-goes-ga/" title="Kubernetes Containerd Integration Goes GA">Kubernetes çš„ containerd é›†æˆï¼Œæ­£å¼ GA&lt;/a>&lt;/p>
&lt;p>ä¹‹å‰ç‰ˆæœ¬çš„æ¶æ„ï¼š&lt;/p>
&lt;p>&lt;img src="https://d33wubrfki0l68.cloudfront.net/6b4290afef76cad8a084292cd1b5e468e31c9bb3/c26ce/images/blog/2018-05-24-kubernetes-containerd-integration-goes-ga/cri-containerd.png" alt="containerd 1.0 cri-containerd">&lt;/p>
&lt;p>æ–°çš„æ¶æ„ï¼š&lt;/p>
&lt;p>&lt;img src="https://d33wubrfki0l68.cloudfront.net/f8dfc688157620f656f96bfd8872deccfbd409e7/51b10/images/blog/2018-05-24-kubernetes-containerd-integration-goes-ga/containerd.png" alt="containerd 1.1 cri-containerd">&lt;/p>
&lt;h3 id="2019-å¹´">2019 å¹´&lt;/h3>
&lt;p>2019 å¹´ï¼Œä¸Šæ–‡ä¸­æåˆ°çš„å¦ä¸€ä¸ªå®¹å™¨è¿è¡Œæ—¶é¡¹ç›® rkt è¢« CNCF å½’æ¡£ï¼Œç»ˆæ­¢ä½¿å‘½äº†ï¼›
2019 å¹´ Mirantis æ”¶è´­ Docker çš„ä¼ä¸šæœåŠ¡ã€‚&lt;/p>
&lt;h3 id="2020-å¹´">2020 å¹´&lt;/h3>
&lt;p>æ—¶é—´å›åˆ°ä»Šå¹´ï¼ŒDocker ä¸»è¦è¢«è¯¯ä¼šçš„ä¸¤ä»¶äº‹ï¼š&lt;/p>
&lt;ul>
&lt;li>Docker Inc. ä¿®æ”¹ DockerHub çš„å®šä»·å’Œ TOS ã€‚å›½å†…äº‰è®ºè¾ƒå¤šçš„ä¸»è¦æ˜¯å…³äºåˆè§„æ€§çš„é—®é¢˜ï¼ˆä½†æ˜¯è¢«æ ‡é¢˜å…šå¸¦æ­ªäº†ï¼Œå…ä¸äº†ææ…Œï¼‰ï¼›&lt;/li>
&lt;li>Kubernetes å®£å¸ƒå¼€å§‹è¿›å…¥åºŸå¼ƒ dockershim æ”¯æŒçš„å€’è®¡æ—¶ï¼Œè¢«äººè¯¯ä»¥ä¸º Docker ä¸èƒ½å†ç”¨äº†ï¼›&lt;/li>
&lt;/ul>
&lt;h2 id="è¯´æ˜">è¯´æ˜&lt;/h2>
&lt;p>&lt;strong>å…³äº DockerHub ä¿®æ”¹å®šä»·å’Œ TOS çš„äº‹æƒ…ï¼Œè¿™é‡Œå°±ä¸å†å¤šè¯´äº†ï¼Œæ¯•ç«Ÿ DockerHub ç›®å‰å¤§å®¶ä»ç„¶ç”¨çš„å¾ˆæ¬¢ä¹ï¼Œè¿œä¸åƒå½“åˆé‚£äº›æ ‡é¢˜å…šå®£ç§°çš„é‚£æ ·ã€‚&lt;/strong>&lt;/p>
&lt;p>é‡ç‚¹æ¥è¯´ä¸€ä¸‹ç¬¬äºŒä»¶äº‹æƒ…å§ã€‚&lt;/p>
&lt;p>Kubernetes å½“åˆé€‰æ‹© Docker ä½œä¸ºå…¶å®¹å™¨è¿è¡Œæ—¶ï¼Œæœ¬èº«å°±æ˜¯å› ä¸ºå½“æ—¶å®ƒæ²¡æœ‰å…¶ä»–çš„é€‰æ‹©ï¼Œå¹¶ä¸”é€‰æ‹© Docker å¯ä¸ºå®ƒå¸¦æ¥ä¼—å¤šçš„ç”¨æˆ·ã€‚
æ‰€ä»¥ï¼Œå¼€å§‹æ—¶ï¼Œå®ƒä¾¿æä¾›äº†å†…ç½®çš„å¯¹ Docker è¿è¡Œæ—¶çš„æ”¯æŒã€‚&lt;/p>
&lt;p>è€Œ Docker å…¶å®åˆ›å»ºä¹‹åˆï¼Œå¹¶æ²¡æœ‰è€ƒè™‘åˆ°â€œç¼–æ’â€çš„è¿™ä¸ªåŠŸèƒ½ï¼Œå½“ç„¶ä¹Ÿæ²¡æœ‰è€ƒè™‘åˆ° Kubernetes çš„å­˜åœ¨ï¼ˆå› ä¸ºå½“æ—¶è¿˜æ²¡æœ‰ï¼‰ã€‚&lt;/p>
&lt;p>&lt;strong>dockershim&lt;/strong> ä¸€ç›´éƒ½æ˜¯ Kubernetes ç¤¾åŒºä¸ºäº†èƒ½è®© Docker æˆä¸ºå…¶æ”¯æŒçš„å®¹å™¨è¿è¡Œæ—¶ï¼Œæ‰€ç»´æŠ¤çš„ä¸€ä¸ªå…¼å®¹ç¨‹åºã€‚ &lt;strong>æœ¬æ¬¡æ‰€è°“çš„åºŸå¼ƒï¼Œä¹Ÿä»…ä»…æ˜¯ Kubernetes è¦æ”¾å¼ƒå¯¹ç°åœ¨ Kubernetes ä»£ç ä»“åº“ä¸­çš„ dockershim çš„ç»´æŠ¤æ”¯æŒã€‚&lt;/strong> ä»¥ä¾¿å…¶å¯ä»¥åƒå¼€å§‹æ—¶è®¡åˆ’çš„é‚£æ ·ï¼Œä»…è´Ÿè´£ç»´æŠ¤å…¶ CRI ï¼Œä»»ä½•å…¼å®¹ CRI çš„è¿è¡Œæ—¶ï¼Œçš†å¯ä½œä¸º Kubernetes çš„ runtime ã€‚&lt;/p>
&lt;p>åœ¨ Kubernetes æå‡º CRI æ—¶ï¼Œæœ‰äººå»ºè®®åœ¨ Docker ä¸­å®ç°å®ƒã€‚ä½†æ˜¯è¿™ç§æ–¹å¼ä¹Ÿä¼šå¸¦æ¥ä¸€ä¸ªé—®é¢˜ï¼Œå³ä½¿ Docker å®ç°äº† CRIï¼Œä½†å®ƒä»ç„¶ä¸æ˜¯ä¸€ä¸ªå•çº¯çš„å®¹å™¨è¿è¡Œæ—¶ï¼Œå®ƒæœ¬èº«åŒ…å«äº†å¤§é‡çš„é â€œçº¯åº•å±‚å®¹å™¨è¿è¡Œæ—¶â€ æ‰€å…·å¤‡çš„åŠŸèƒ½ã€‚&lt;/p>
&lt;p>æ‰€ä»¥åæ¥ &lt;strong>è‡ª Docker ä¸­åˆ†ç¦»å‡ºæ¥çš„ containerd é¡¹ç›®ï¼Œä½œä¸ºä¸€ä¸ªåº•å±‚å®¹å™¨è¿è¡Œæ—¶å‡ºç°äº†ï¼Œå®ƒæ˜¯ Kubernetes å®¹å™¨è¿è¡Œæ—¶æ›´å¥½çš„é€‰æ‹©ã€‚&lt;/strong>&lt;/p>
&lt;p>Docker ä½¿ç”¨ containerd ä½œä¸ºå…¶åº•å±‚å®¹å™¨è¿è¡Œæ—¶ä»¥åŠä¼—å¤šçš„äº‘å‚å•†åŠå…¬å¸åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ containerd ä½œä¸ºå…¶ Kubernetes çš„è¿è¡Œæ—¶ï¼Œè¿™ä¹Ÿä»ä¾§é¢éªŒè¯äº† containerd çš„ç¨³å®šæ€§ã€‚&lt;/p>
&lt;p>ç°åœ¨ Kubernetes å’Œ Docker ç¤¾åŒºéƒ½ç›¸ä¿¡ containerd å·²ç»è¶³å¤Ÿæˆç†Ÿå¯ç›´æ¥ä½œä¸º Kubernetes çš„è¿è¡Œæ—¶äº†ï¼Œè€Œæ— éœ€å†é€šè¿‡ dockershim ä½¿ç”¨ Docker ä½œä¸º Kubernetes çš„è¿è¡Œæ—¶äº†ã€‚è¿™ä¹Ÿæ ‡å¿—ç€ Docker ä¸º Kubernetes æä¾›ä¸€ä¸ªç°ä»£åŒ–çš„å®¹å™¨è¿è¡Œæ—¶çš„æ‰¿è¯ºæœ€ç»ˆå…‘ç°äº†ã€‚&lt;/p>
&lt;p>&lt;strong>è€Œæœ¬æ¬¡äº‹ä»¶ä¸­ï¼Œé‡ç‚¹çš„ dockershim ä¹‹åçš„æ–¹å‘å¦‚ä½•å‘¢ï¼ŸKubernetes ä»£ç ä»“åº“ä¸­çš„ dockershim å°†ä¼šåœ¨æœªæ¥ç‰ˆæœ¬ä¸­ç§»é™¤ï¼Œä½†æ˜¯ Mirantis å…¬å¸å·²ç»å’Œ Docker è¾¾æˆåˆä½œï¼Œåœ¨æœªæ¥ä¼šå…±åŒç»´æŠ¤ä¸€ä»½ dockershim ç»„ä»¶ï¼Œä»¥ä¾¿æ”¯æŒ Docker ä½œä¸º Kubernetes çš„å®¹å™¨è¿è¡Œæ—¶ã€‚&lt;/strong>&lt;/p>
&lt;p>&lt;strong>Otherwise, if youâ€™re using the open source Docker Engine, the dockershim project will be available as an open source component, and you will be able to continue to use it with Kubernetes; it will just require a small configuration change, which we will document.&lt;/strong>&lt;/p>
&lt;p>&lt;a href="https://www.mirantis.com/blog/mirantis-to-take-over-support-of-kubernetes-dockershim-2/" title="Mirantis to take over support of Kubernetes dockershim">Mirantis å…¬å¸å®£å¸ƒå°†ç»´æŠ¤ dockershim&lt;/a>&lt;/p>
&lt;h2 id="qa">Q&amp;amp;A&lt;/h2>
&lt;p>Qï¼šæœ¬æ¬¡ Kubernetes æ”¾å¼ƒå¯¹ dockershim çš„ç»´æŠ¤ï¼Œåˆ°åº•æœ‰ä»€ä¹ˆå½±å“ï¼Ÿ
Aï¼šå¯¹äºæ™®é€šç”¨æˆ·è€Œè¨€ï¼Œæ²¡æœ‰ä»»ä½•å½±å“ï¼›å¯¹äºåœ¨ Kubernetes ä¹‹ä¸Šè¿›è¡Œå¼€å‘çš„å·¥ç¨‹å¸ˆï¼Œæ²¡ä»€ä¹ˆå¤ªå¤§å½±å“ï¼›å¯¹äºé›†ç¾¤ç®¡ç†å‘˜ï¼Œéœ€è¦è€ƒè™‘æ˜¯å¦è¦åœ¨æœªæ¥ç‰ˆæœ¬ä¸­ï¼Œå°†å®¹å™¨è¿è¡Œæ—¶ï¼Œå‡çº§ä¸ºæ”¯æŒ CRI çš„è¿è¡Œæ—¶ï¼Œæ¯”å¦‚ containerd ã€‚
å½“ç„¶ï¼Œå¦‚æœä½ å¹¶ä¸æƒ³åˆ‡æ¢å®¹å™¨è¿è¡Œæ—¶ï¼Œé‚£ä¹Ÿæ²¡å…³ç³»ï¼ŒMirantis å…¬å¸æœªæ¥ä¼šå’Œ Docker å…±åŒç»´æŠ¤ dockershim , å¹¶ä½œä¸ºä¸€ä¸ªå¼€æºç»„ä»¶æä¾›ã€‚&lt;/p>
&lt;p>Q: Docker ä¸èƒ½ç”¨äº†å—ï¼Ÿ
Aï¼šDocker ä»ç„¶æ˜¯æœ¬åœ°å¼€å‘ï¼Œæˆ–è€…å•æœºéƒ¨ç½²æœ€ä½³çš„å®¹å™¨å·¥å…·ï¼Œå®ƒæä¾›äº†æ›´ä¸ºäººæ€§åŒ–çš„ç”¨æˆ·ä½“éªŒï¼Œå¹¶ä¸”ä¹Ÿæœ‰ä¸°å¯Œçš„ç‰¹æ€§ã€‚ç›®å‰ Docker å·²ç»å’Œ AWS è¾¾æˆåˆä½œï¼Œå¯ç›´æ¥é€šè¿‡ Docker CLI ä¸ AWS é›†æˆã€‚å¦å¤–ï¼ŒDocker ä¹Ÿä»ç„¶å¯ä»¥ä½œä¸º Kubernetes çš„å®¹å™¨è¿è¡Œæ—¶ï¼Œå¹¶æ²¡æœ‰ç«‹å³ä¸­æ­¢å¯¹å…¶æ”¯æŒã€‚&lt;/p>
&lt;p>Qï¼šå¬è¯´ Podman å¯ä»¥å€Ÿæœºä¸Šä½äº†ï¼Ÿ
Aï¼šæƒ³å¤ªå¤šã€‚Podman ä¹Ÿå¹¶ä¸å…¼å®¹ CRI ï¼Œå¹¶ä¸”å®ƒä¹Ÿä¸å…·å¤‡ä½œä¸º Kubernetes å®¹å™¨è¿è¡Œæ—¶çš„æ¡ä»¶ã€‚æˆ‘ä¸ªäººä¹Ÿå¶å°”æœ‰åœ¨ç”¨ Podmanï¼Œ å¹¶ä¸”æˆ‘ä»¬åœ¨ KIND é¡¹ç›®ä¸­ä¹Ÿæä¾›äº†å¯¹ Podman çš„æ”¯æŒï¼Œ ä½†å®è¯è®²ï¼Œå®ƒä¹Ÿå°±æ˜¯åªæ˜¯ä¸€ä¸ª CLI å·¥å…·ï¼ŒæŸäº›æƒ…å†µä¸‹ä¼šæœ‰äº›ä½œç”¨ï¼Œæ¯”å¦‚å¦‚æœä½ çš„ Kubernetes å®¹å™¨è¿è¡Œæ—¶ä½¿ç”¨ cri-o çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ç”¨æ¥æœ¬åœ°åšä¸‹è°ƒè¯•ã€‚&lt;/p>
&lt;h2 id="æ€»ç»“">æ€»ç»“&lt;/h2>
&lt;p>æœ¬æ–‡ä¸»è¦ä»‹ç»äº† Docker å’Œ Kubernetes çš„å‘å±•å†ç¨‹ï¼Œä¹Ÿè§£é‡Šäº†æœ¬æ¬¡ Kubernetes ä»…ä»…æ˜¯æ”¾å¼ƒå…¶å¯¹ dockershim ç»„ä»¶çš„æ”¯æŒã€‚æœªæ¥æ›´æ¨èçš„ Kubernetes è¿è¡Œæ—¶æ˜¯ å…¼å®¹ CRI çš„ containerd ä¹‹ç±»çš„åº•å±‚è¿è¡Œæ—¶ã€‚&lt;/p>
&lt;p>Mirantis å…¬å¸å°†ä¼šå’Œ Docker å…±åŒç»´æŠ¤ dockershim å¹¶ä½œä¸ºå¼€æºç»„ä»¶æä¾›ã€‚&lt;/p>
&lt;p>Docker ä»ç„¶æ˜¯ä¸€æ¬¾æœ€ä½³çš„æœ¬åœ°å¼€å‘æµ‹è¯•å’Œéƒ¨ç½²çš„å·¥å…·ã€‚&lt;/p>
&lt;hr>
&lt;p>æ¬¢è¿è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://gitee.com/tlrr/awesome/raw/master/2020-9-9/1599632564572-mp-qrcode.png" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category><category domain="https://moelove.info/tags/Docker/">Docker</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| Cilium v1.9.0 å¸¦æ¥æ›´å¥½çš„æ€§èƒ½</title><link>https://moelove.info/2020/11/15/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Cilium-v1.9.0-%E5%B8%A6%E6%9D%A5%E6%9B%B4%E5%A5%BD%E7%9A%84%E6%80%A7%E8%83%BD/</link><guid isPermaLink="true">https://moelove.info/2020/11/15/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Cilium-v1.9.0-%E5%B8%A6%E6%9D%A5%E6%9B%B4%E5%A5%BD%E7%9A%84%E6%80%A7%E8%83%BD/</guid><pubDate>Sun, 15 Nov 2020 18:32:03 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container" title="k8sç”Ÿæ€">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="cilium-v190-æ­£å¼å‘å¸ƒ">Cilium v1.9.0 æ­£å¼å‘å¸ƒ&lt;/h2>
&lt;p>Cilium æœ¬å‘¨å‘å¸ƒäº† v1.9.0 ç‰ˆæœ¬ï¼Œè¿™ä¸ªç‰ˆæœ¬å¸¦æ¥äº†ä¼—å¤šå€¼å¾—å…³æ³¨çš„ç‰¹æ€§å˜æ›´ï¼Œæˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹å§ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://github.com/cilium/cilium/pull/12716">#12716&lt;/a> å¢åŠ äº† deny policy ï¼Œä½ å¯ä»¥æ·»åŠ ç±»ä¼¼ä¸‹é¢è¿™æ ·çš„è§„åˆ™ï¼š&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;cilium.io/v2&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">CiliumNetworkPolicy&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;guestbook-web&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">endpointSelector&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">matchLabels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">k8s-app.guestbook&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">web&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">ingress&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">fromEndpoints&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">matchLabels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">k8s-app.guestbook&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">redis&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">ingressDeny&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">fromEndpoints&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">matchLabels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">k8s-app.guestbook&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">redis&lt;/span>&lt;span class="w">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>&lt;a href="https://github.com/cilium/cilium/pull/13131">#13131&lt;/a> Cilium çš„ eBPF kube-proxy éƒ¨åˆ†ä¸ºå…¶åœ¨ NodePort/LoadBalancer/externalIP ç­‰éƒ¨åˆ†çš„åç«¯é€‰æ‹©é€»è¾‘ä¸­ï¼Œå¢åŠ äº†åŸºäº &lt;a href="https://research.google/pubs/pub44824/" title="Maglev ç®—æ³•">Maglev ç®—æ³•&lt;/a>çš„ä¸€è‡´æ€§å“ˆå¸Œï¼Œé€šè¿‡æ­¤ç‰¹æ€§ï¼Œå¯ä»¥å‡å°‘åç«¯å˜æ›´å¯¹å®é™…ä¸šåŠ¡è¯·æ±‚çš„å½±å“ã€‚æ­¤ç‰¹æ€§å¯ä»¥é€šè¿‡è®¾ç½® &lt;code>global.nodePort.algorithm=maglev&lt;/code> æ¥å¼€å¯ã€‚å…³äº Maglev ç®—æ³•çš„å†…å®¹ï¼Œæ­¤å¤„æš‚æ—¶ç•¥è¿‡ï¼Œå»ºè®®å¯¹æ­¤å†…å®¹æ„Ÿå…´è¶£çš„æœ‹å‹çœ‹çœ‹ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/cilium/cilium/pull/12611">#12611&lt;/a> æ·»åŠ å¯¹ K8S v1.19 çš„æ”¯æŒï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/cilium/cilium/pull/12409">#12409&lt;/a> Cilium operator HA æ¨¡å¼ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/cilium/cilium/pull/13330">#13330&lt;/a> å€ŸåŠ© &lt;code>redirect_neigh&lt;/code> ä¼˜åŒ–ä¸»æœºç½‘ç»œæ•°æ®è·¯å¾„ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/cilium/cilium/pull/12831">#12831&lt;/a> å¼•å…¥ eBPF æœ¬æœºé‡å®šå‘åŠŸèƒ½ï¼›&lt;/li>
&lt;/ul>
&lt;p>æ­¤ç‰ˆæœ¬éœ€è¦æ ¼å¤–å…³æ³¨ï¼Œæ›´å¤šå…³äºæ­¤ç‰ˆæœ¬çš„å˜æ›´ï¼Œè¯·å‚è€ƒå…¶ &lt;a href="https://github.com/cilium/cilium/releases/tag/v1.9.0">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="rook-v15-æ­£å¼å‘å¸ƒ">Rook v1.5 æ­£å¼å‘å¸ƒ&lt;/h2>
&lt;p>æœ¬å‘¨ Rook å‘å¸ƒäº† v1.5 çš„ç‰ˆæœ¬ï¼Œæ­¤ç‰ˆæœ¬ä¸­ä¹ŸåŒ…å«äº†å¾ˆå¤šæ–°çš„æ›´æ–°ï¼Œå€¼å¾—å…³æ³¨ï¼š&lt;/p>
&lt;p>Rook æ­¤ç‰ˆæœ¬ä»…æ”¯æŒ Kubernetes v1.11 åŠä»¥ä¸Šç‰ˆæœ¬ï¼Œå¦‚æœé›†ç¾¤ç‰ˆæœ¬è¾ƒä½ï¼Œè¯·æ³¨æ„ã€‚&lt;/p>
&lt;p>ç ´åæ€§å˜æ›´ï¼š&lt;/p>
&lt;ul>
&lt;li>CRD é…ç½®ä» &lt;code>common.yaml&lt;/code> ç§»åŠ¨åˆ° &lt;code>crds.yaml&lt;/code> ä»¥ä¾¿æä¾›æ›´é«˜çš„çµæ´»æ€§ï¼›&lt;/li>
&lt;li>CRD ä½¿ç”¨çš„ API ç‰ˆæœ¬ä» &lt;code>apiextensions.k8s.io/v1beta1&lt;/code> æ›´æ¢ä¸º &lt;code>apiextensions.k8s.io/v1&lt;/code>ï¼›&lt;/li>
&lt;li>Rook å°†ç¦æ­¢å¶æ•° Ceph monsï¼Œå¿…é¡»å°†å…¶è®¾ç½®ä¸ºå¥‡æ•°ä¸ªï¼›&lt;/li>
&lt;/ul>
&lt;p>ç‰¹æ€§å˜æ›´ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>Ceph Cluster&lt;/p>
&lt;ul>
&lt;li>é›†ç¾¤å®¹é‡å°†æ›´æ–°åˆ° CephCluster CR çŠ¶æ€ä¸­ï¼›&lt;/li>
&lt;li>é€šè¿‡ Vault æä¾›åŠ å¯†æ”¯æŒï¼›&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>Ceph CSI&lt;/p>
&lt;ul>
&lt;li>æ”¯æŒä¸º DaemonSet å’Œ Deployment è‡ªå®šä¹‰æ ‡ç­¾ï¼›&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>Ceph Filesystem&lt;/p>
&lt;ul>
&lt;li>&lt;code>preserveFilesystemOnDelete&lt;/code> é€‰é¡¹æ›¿ä»£ &lt;code>preservePoolsOnDelete&lt;/code> ä»¥é¿å…åœ¨å¸è½½æ—¶ï¼Œåˆ é™¤æ–‡ä»¶ç³»ç»Ÿï¼›&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>æ›´å¤šå…³äºæ­¤ç‰ˆæœ¬çš„å˜æ›´ï¼Œè¯·å‚è€ƒå…¶ &lt;a href="https://github.com/rook/rook/releases/tag/v1.5.0">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="jaeger-v1210-å‘å¸ƒ">Jaeger v1.21.0 å‘å¸ƒ&lt;/h2>
&lt;p>Jaeger æœ¬å‘¨ä¹Ÿå‘å¸ƒäº†ä¸€ä¸ªæ–°ç‰ˆæœ¬ï¼Œå¹¶ä¸”è¿‘æœŸå‘å¸ƒéƒ½æ¯”è¾ƒé¢‘ç¹ã€‚&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://github.com/jaegertracing/jaeger/pull/2545">#2545&lt;/a> åœ¨åˆ†å‘çš„æ—¶ï¼Œä¸º Jaeger åç«¯å¢åŠ äº† debug Docker é•œåƒï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/jaegertracing/jaeger/pull/2547">#2547&lt;/a>Jaeger UI ä¸­å¢åŠ äº†ç‰ˆæœ¬ä¿¡æ¯ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/jaegertracing/jaeger/pull/2580">#2580&lt;/a> OTLP-proto encoding æ”¯æŒ Kafka supported in the OTEL Ingester ;&lt;/li>
&lt;li>&lt;a href="https://github.com/jaegertracing/jaeger/pull/2496">#2496&lt;/a> é…ç½®å‚æ•°å¯ä»¥åœ¨è¿è¡Œæ—¶æ³¨å…¥ï¼Œé€šè¿‡ admin çš„ &lt;code>/debug/vars&lt;/code> æ¥å£ï¼›&lt;/li>
&lt;/ul>
&lt;p>æ›´å¤šå…³äºæ­¤ç‰ˆæœ¬çš„å˜æ›´ï¼Œè¯·å‚è€ƒå…¶ &lt;a href="https://github.com/jaegertracing/jaeger/releases/tag/v1.21.0">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="ä¸Šæ¸¸è¿›å±•">ä¸Šæ¸¸è¿›å±•&lt;/h2>
&lt;p>&lt;a href="https://github.com/kubernetes/kubernetes/pull/94115">#94115&lt;/a> è¿™æ˜¯ä¸€ä¸ªç›¸å¯¹è¾ƒå°çš„ä¿®å¤ï¼Œå¯ä»¥åœ¨æ‰§è¡Œ exec æ¢é’ˆæœŸé—´æ­£ç¡®æ£€æŸ¥è¶…æ—¶é”™è¯¯ã€‚ä½†æ˜¯å¦‚æœæƒ³è¦ä½¿ç”¨çš„è¯ï¼Œå»ºè®®ä½ ä»”ç»†æ£€æŸ¥é›†ç¾¤ä¸­å¯¹ exec æ¢é’ˆçš„ä½¿ç”¨ï¼Œä»¥é¿å…å¼•èµ·ä¸€äº›éé¢„æœŸçš„ç»“æœã€‚&lt;/p>
&lt;hr>
&lt;p>æ¬¢è¿è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://gitee.com/tlrr/awesome/raw/master/2020-9-9/1599632564572-mp-qrcode.png" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| Helm v3.4 å‘å¸ƒ</title><link>https://moelove.info/2020/11/07/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Helm-v3.4-%E5%8F%91%E5%B8%83/</link><guid isPermaLink="true">https://moelove.info/2020/11/07/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Helm-v3.4-%E5%8F%91%E5%B8%83/</guid><pubDate>Sat, 07 Nov 2020 20:30:49 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container" title="k8sç”Ÿæ€">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="helm-v34-æ­£å¼å‘å¸ƒ">Helm v3.4 æ­£å¼å‘å¸ƒ&lt;/h2>
&lt;p>Helm v3.4 æ˜¯ä¸€ä¸ªç‰¹æ€§æ›´æ–°ç‰ˆæœ¬ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹æ­¤ç‰ˆæœ¬æœ‰å“ªäº›å€¼å¾—å…³æ³¨çš„å˜åŒ–ï¼š&lt;/p>
&lt;ul>
&lt;li>11 æœˆ 13 æ—¥ï¼Œ Helm stable å’Œ incubator ä»“åº“å°†åˆ°è¾¾ç»ˆç»“æ—¥ï¼Œè¿™äº› Chart çš„å½’æ¡£å°†ä¼šå­˜å‚¨åˆ°å¦å¤–çš„ä½ç½®ï¼Œå¦‚æœä½ ä½¿ç”¨è¿™ä¸¤ä¸ªä»“åº“çš„è¯ï¼ŒHelm å°†ä¼šå…ˆæ£€æŸ¥åŸå…ˆçš„ä½ç½®ï¼Œç„¶åè¿›è¡Œé‡å®šå‘ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/helm/helm/pull/8543">#8543&lt;/a> &lt;code>helm lint&lt;/code> å°†æ£€æŸ¥åç§°é•¿åº¦çš„é”™è¯¯ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/helm/helm/pull/8529">#8529&lt;/a> &lt;code>helm status&lt;/code> æ–°å¢ &lt;code>--show-desc&lt;/code> å‚æ•°ï¼Œå¯ç”¨æ¥å±•ç¤ºæè¿°ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/helm/helm/pull/8874">#8874&lt;/a> è®© &lt;code>helm create&lt;/code> åˆ›å»ºçš„ chart ç¼©è¿›ä¿æŒä¸€è‡´ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/helm/helm/pull/7970">#7970&lt;/a> &lt;code>helm lint&lt;/code> ç°åœ¨ä¹Ÿå¯ä»¥æ£€æŸ¥ä¾èµ–äº†ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/helm/helm/pull/8438">#8438&lt;/a> &lt;code>helm show values&lt;/code> å¢åŠ  jsonpath è¾“å‡ºçš„æ”¯æŒ;&lt;/li>
&lt;li>&lt;a href="https://github.com/helm/helm/pull/8613">#8613&lt;/a> ä¼˜åŒ–äº† service ready çš„åˆ¤æ–­é€»è¾‘ï¼Œæ”¹æˆäº†åˆ¤æ–­æ˜¯å¦æœ‰ ClusterIPï¼›&lt;/li>
&lt;/ul>
&lt;p>æ›´å¤šå…³äºæ­¤ç‰ˆæœ¬çš„å˜åŒ–ï¼Œè¯·æŸ¥çœ‹å…¶ &lt;a href="https://github.com/helm/helm/releases/tag/v3.4.0">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="coredns-v18-æ­£å¼å‘å¸ƒ">CoreDNS v1.8 æ­£å¼å‘å¸ƒ&lt;/h2>
&lt;p>CoreDNS ä»Šæ—¥å‘å¸ƒäº† v1.8 ç‰ˆæœ¬ï¼Œæ•´ä½“è€Œè¨€å˜åŒ–ä¸æ˜¯å¤ªå¤§ï¼Œä¸”ä¹Ÿåšäº†å‘åå…¼å®¹ï¼Œå¯èƒ½ä¼šå—å½±å“çš„æ˜¯ä½¿ç”¨ å¤–éƒ¨ plugin æˆ–è€…åŸŸå¤–æµé‡çš„ç”¨æˆ·ã€‚&lt;/p>
&lt;p>å› ä¸ºCoreDNS ä¾èµ–çš„ Caddy å·²ç»åœ¨å¼€å‘ v2 ç‰ˆæœ¬äº†ï¼Œ ä¸”å˜åŒ–è›®å¤§çš„ã€‚ä¸ºäº†åŒ…è£… CoreDNS çš„ç‹¬ç«‹ &amp;amp; ç¨³å®šï¼Œæ‰€ä»¥ CoreDNS å›¢é˜Ÿå°†å…¶ fork äº†ä¸€ä¸ªï¼Œæˆä¸ºäº†æ–°çš„ &lt;a href="https://github.com/coredns/caddy">https://github.com/coredns/caddy&lt;/a> ã€‚å¸¦æ¥çš„å˜åŒ–æ˜¯æ‰€æœ‰çš„ä¾èµ–éœ€è¦å˜æ›´ä¸‹ã€‚&lt;/p>
&lt;p>æœ€å &lt;code>transfer&lt;/code> æ’ä»¶å·²ç»æˆä¸ºå¤´ç­‰å…¬æ°‘ï¼Œå¦‚æœåœ¨ä½¿ç”¨æ­¤æ’ä»¶çš„è¯ï¼Œå‡çº§åéœ€è¦æŒ‰å¦‚ä¸‹è§„åˆ™ä¿®æ”¹é…ç½®ï¼š&lt;/p>
&lt;p>ç”±&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="l">example.org {&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">file example.org.signed {&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">transfer to *&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">transfer to 10.240.1.1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>}&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>}&lt;span class="w">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ”¹ä¸º&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="l">example.org {&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">file example.org.signed&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">transfer {&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">to * 10.240.1.1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>}&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>}&lt;span class="w">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>&lt;a href="https://github.com/coredns/coredns/pull/4182">#4182&lt;/a> ä¿®å¤äº†ä½¿ç”¨ DoH æ—¶å€™ http/2 çš„æ”¯æŒï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/coredns/coredns/pull/4184">#4184&lt;/a> ä¿®å¤äº†æ²¡æœ‰ plugin æ—¶å€™ï¼Œå¯èƒ½å´©æºƒçš„é—®é¢˜ã€‚ä½¿ç”¨ CoreDNS çš„æ—¶å€™ï¼Œç¡®å®é»˜è®¤éƒ½ä¼šç»™å®ƒé…ç½®æ’ä»¶..å¾ˆå°‘å‡ºç°æ²¡æœ‰é…ç½®æ’ä»¶çš„æƒ…å†µï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/coredns/coredns/pull/4167">#4167&lt;/a> åœ¨ shutdown çš„æ—¶å€™ï¼Œä¸å†è¿”å› 200 äº†ï¼›&lt;/li>
&lt;/ul>
&lt;p>æ›´å¤šå…³äºæ­¤ç‰ˆæœ¬çš„å˜åŒ–ï¼Œè¯·æŸ¥çœ‹å…¶ &lt;a href="https://coredns.io/2020/10/22/coredns-1.8.0-release/">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="prometheus-operator-v043-å‘å¸ƒ">prometheus-operator v0.43 å‘å¸ƒ&lt;/h2>
&lt;p>æœ€è¿‘ prometheus-operator å‘å¸ƒäº† v0.43 ç‰ˆæœ¬ï¼Œæ­¤ç‰ˆæœ¬ä¸­æ–°å¢äº† &lt;code>AlertmanagerConfig&lt;/code> CRD &lt;a href="https://github.com/prometheus-operator/prometheus-operator/pull/3451">#3451&lt;/a>ï¼Œ åœ¨æ­¤ä¹‹å‰é…ç½®æ˜¯ç›´æ¥ç”¨ configmap çš„ï¼Œé€šè¿‡æ­¤æ¬¡å˜æ›´ï¼Œå…è®¸å°† Alertmanager çš„é…ç½®åˆ†å‰²æˆä¸åŒçš„å¯¹è±¡ã€‚&lt;/p>
&lt;p>ä¸è¿‡å½“å‰çš„ CRD ä»…æ”¯æŒ PagerDuty, OpsGenie å’Œ webhook receiver ã€‚ æ­¤å¤„æˆ‘å°±ä¸å¾—ä¸æä¸€å¥ &lt;strong>PagerDuty å’Œ OpsGenie çœŸçš„æ£’ï¼Œå°¤å…¶æ˜¯ OpsGenie&lt;/strong> ã€‚ å¦å¤–ï¼Œå½“å‰çš„ API ç‰ˆæœ¬æ˜¯ &lt;code>v1alpha1&lt;/code> æ„å‘³ç€ä¹‹åä¹Ÿä¼šé€æ­¥å¢åŠ æ–°åŠŸèƒ½/å¯¹ç°æœ‰åŠŸèƒ½è°ƒæ•´ã€‚ æœŸå¾…åç»­ç‰ˆæœ¬ã€‚&lt;/p>
&lt;p>æ­¤å¤–è¿˜æœ‰ä¸€äº›æ¯”è¾ƒå€¼å¾—å…³æ³¨çš„å†…å®¹ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://github.com/prometheus-operator/prometheus-operator/pull/3457">#3457&lt;/a> ä¸º Prometheus ä½¿ç”¨äº†å•ç‹¬çš„ reloader sidecar ã€‚&lt;code>--config-reloader-image&lt;/code> å‚æ•°åç»­ç‰ˆæœ¬å°†ä¼šç§»é™¤ï¼Œè¯·ç¡®ä¿è‡³å°‘åœ¨ v0.43 ç‰ˆæœ¬ä»¥ä¸Šä½¿ç”¨ &lt;code>--prometheus-config-reloader&lt;/code> å‚æ•°ï¼Œå¦åˆ™ Prometheus å°†å¯åŠ¨å¤±è´¥ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/prometheus-operator/prometheus-operator/pull/3598">#3598&lt;/a> ä¸º Prometheus, Alertmanager, å’Œ ThanosRuler CRD å¢åŠ  Pod æ‹“æ‰‘çº¦æŸçš„åŠŸèƒ½ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/prometheus-operator/prometheus-operator/pull/3525">#3525&lt;/a> å…è®¸è‡ªå®šä¹‰ Prometheus web çš„ title , æˆ‘ä¸ªäººæ˜¯è§‰å¾—æ²¡å•¥ç”¨äº†ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/prometheus-operator/prometheus-operator/pull/3617">#3617&lt;/a> æ·»åŠ  &lt;code>prometheus_operator_prometheus_enforced_sample_limit&lt;/code> metrics;&lt;/li>
&lt;li>&lt;a href="https://github.com/prometheus-operator/prometheus-operator/pull/3502">#3502&lt;/a> åœ¨ Prometheus replay WAL çš„æ—¶å€™ï¼Œç§»é™¤ liveness probes ä»¥å… Prometheus å®¹å™¨è¢«æ€æ‰ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/prometheus-operator/prometheus-operator/pull/3526">#3526&lt;/a> ä¿®æ­£äº†åœ¨æ›´æ–° service æ—¶å€™é‡åˆ°çš„ &lt;code>spec.ipFamily: Invalid value: &amp;quot;null&amp;quot;: field is immutable&lt;/code> é”™è¯¯ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/prometheus-operator/prometheus-operator/pull/3641">#3641&lt;/a> ä¹Ÿä¿®å¤äº† Alertmanager controller çš„åŒæ­¥é€»è¾‘ï¼Œä¸ºæ­¤è¿˜ä¸“é—¨å‘å¸ƒäº† v0.43.1 ç‰ˆæœ¬ï¼›&lt;/li>
&lt;/ul>
&lt;h2 id="ä¸Šæ¸¸è¿›å±•">ä¸Šæ¸¸è¿›å±•&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/pull/95985/">#95985&lt;/a> éšç€ seccomp è½¬ä¸º GAï¼Œ ç°åœ¨é»˜è®¤çš„ seccomp profile annotation ä» &lt;code>docker/default&lt;/code> è½¬æ¢ä¸ºäº† &lt;code>runtime/default&lt;/code>ã€‚æ‰€ä»¥ä¹Ÿè¦é»˜è®¤å…è®¸ &lt;code>runtime/default&lt;/code> å¦‚æœç”¨æˆ·è®¾ç½®çš„æ˜¯ &lt;code>docker/default&lt;/code> ;&lt;/li>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/pull/95856">#95856&lt;/a> APIserver è‡ª v1.10 å¼€å§‹åºŸå¼ƒçš„ insecure port ç»ˆäºè¢«ç§»é™¤ï¼Œä¸»è¦å½±å“ &lt;code>--address&lt;/code>, &lt;code>--insecure-bind-address&lt;/code>, &lt;code>--port&lt;/code>, å’Œ &lt;code>--insecure-port&lt;/code> è¿™å‡ ä¸ªå‚æ•°ï¼›&lt;/li>
&lt;/ul>
&lt;hr>
&lt;p>æ¬¢è¿è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://gitee.com/tlrr/awesome/raw/master/2020-9-9/1599632564572-mp-qrcode.png" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| Docker V2 GitHub Action å®£å¸ƒ GA</title><link>https://moelove.info/2020/10/31/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Docker-V2-GitHub-Action-%E5%AE%A3%E5%B8%83-GA/</link><guid isPermaLink="true">https://moelove.info/2020/10/31/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Docker-V2-GitHub-Action-%E5%AE%A3%E5%B8%83-GA/</guid><pubDate>Sat, 31 Oct 2020 22:21:31 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container" title="k8sç”Ÿæ€">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="docker-v2-github-action-å·²-ga">Docker V2 GitHub Action å·² GA&lt;/h2>
&lt;p>Docker Inc. è¿‘æœŸåœ¨å…¶&lt;a href="https://www.docker.com/blog/docker-v2-github-action-is-now-ga">å®˜æ–¹åšå®¢å®£å¸ƒ&lt;/a> Docker V2 GitHub Action å·²ç» GA ã€‚&lt;/p>
&lt;p>æˆ‘åœ¨ä¹‹å‰çš„æ–‡ç« &lt;a href="https://zhuanlan.zhihu.com/p/115367323">ã€ŠK8S ç”Ÿæ€å‘¨æŠ¥| é¦–ä¸ª Docker å®˜æ–¹ Action å‘å¸ƒã€‹&lt;/a> ä¸­æ›¾è¯¦ç»†ä»‹ç»è¿‡ Docker æä¾›çš„V1 GitHub Action çš„ç”¨æ³•ã€‚&lt;/p>
&lt;p>æ­¤æ¬¡ï¼ŒV2 ç‰ˆæœ¬å¸¦æ¥çš„æœ€å¤§å˜åŒ–æ˜¯ç”±åŸå…ˆå•ä¸€çš„ GitHub Action è½¬æ¢æˆäº†ç°åœ¨çš„å¤šä¸ªæ¨¡å—åŒ–ï¼Œä¸”åŒ…å«å¤æ‚åŠŸèƒ½çš„ç‹¬ç«‹ Actionã€‚è¿™é‡Œæˆ‘ä¹Ÿä»‹ç»ä¸‹å…¶ä¸­é‡ç‚¹çš„å†…å®¹ï¼š&lt;/p>
&lt;h3 id="ç‹¬ç«‹çš„-login-action">ç‹¬ç«‹çš„ Login Action&lt;/h3>
&lt;p>æœ¬æ¬¡å‘å¸ƒäº†ç‹¬ç«‹çš„ Login Action ï¼Œä¹‹å‰ç‰ˆæœ¬çš„ Action æ˜¯å°†ç™»å½•æ“ä½œåŒæ—¶å°è£…åœ¨æ•´ä¸ª Action æµç¨‹ä¸­çš„ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-yaml" data-lang="yaml">- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Login to DockerHub&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">uses&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">docker/login-action@v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">with&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">username&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">${{ secrets.DOCKER_USERNAME }} &lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">password&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">${{ secrets.DOCKER_TOKEN }}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ­¤å¤–ï¼Œåœ¨ Action æ‰§è¡Œå®Œæˆåï¼Œä¼šæœ‰ä¸ª Post Login çš„ job ï¼Œè‡ªåŠ¨å°† Login åŠ¨ä½œæ—¶åˆ›å»ºçš„ç”¨æˆ·å‡­è¯è¿›è¡Œé”€æ¯ã€‚&lt;/p>
&lt;h3 id="é›†æˆ-docker-buildx">é›†æˆ Docker Buildx&lt;/h3>
&lt;p>é€šè¿‡æ­¤ Action å¯ä»¥å°† builder è®¾ç½®ä¸º Buildkitï¼Œä»¥ä¾¿æä¾›æ›´çµæ´»å’Œä¸°å¯Œçš„ç‰¹æ€§ã€‚å…³äº Buildx ä¹‹å‰çš„å‘¨æŠ¥ä¸­éƒ½ä»‹ç»è¿‡äº†ï¼Œæ­¤å¤„ç•¥è¿‡ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-yaml" data-lang="yaml">- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Setup Docker Buildx&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">uses&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">docker/setup-buildx-action@v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="å¤šå¹³å°æ„å»º">å¤šå¹³å°æ„å»º&lt;/h3>
&lt;p>å¯é€šè¿‡è®¾ç½® QEMU å’Œ Buildx æ¥å®ç°å¤šå¹³å°çš„æ„å»ºï¼Œæ¯”å¦‚é€šè¿‡ä»¥ä¸‹é…ç½®å¯åŒæ—¶æ„å»º &lt;code>linux/amd64&lt;/code> å’Œ &lt;code>linux/s390x&lt;/code> å¹³å°çš„é•œåƒï¼Œå¹¶å°†å…¶æ¨é€è‡³ DockerHub çš„æŒ‡å®šé•œåƒä»“åº“ä¸­ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-yaml" data-lang="yaml">- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Setup QEMU&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">uses&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">docker/setup-qemu-action@v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Build and push&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">id&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">docker_build&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">uses&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">docker/build-push-action@v2&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">with&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">context&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">.&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">file&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">./Dockerfile&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">platforms&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">linux/amd64,linux/s390x&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">push&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">tags&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">${{ secrets.DOCKER_USERNAME }}/redis:6.0&lt;/span>&lt;span class="w">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ›´å¤šå…³äºæ­¤æ¬¡å˜æ›´çš„ç¤ºä¾‹ï¼Œè¯·å‚è€ƒ&lt;a href="https://github.com/tao12345666333/docker-github-action" title="docker-github-action">æˆ‘çš„ç¤ºä¾‹ä»£ç ä»“åº“&lt;/a>&lt;/p>
&lt;h2 id="dockerhub-æ­£å¼å¯ç”¨é™é€Ÿ">DockerHub æ­£å¼å¯ç”¨é™é€Ÿ&lt;/h2>
&lt;p>åœ¨ 8 æœˆä»½çš„æ–‡ç«  &lt;a href="https://zhuanlan.zhihu.com/p/186265631">ã€ŠK8S ç”Ÿæ€å‘¨æŠ¥| DockerHub ä¿®æ”¹äº†å®šä»·å’Œ TOSã€‹&lt;/a> ä¸€æ–‡ä¸­ï¼Œæˆ‘æ›¾ä»‹ç»è¿‡ Docker Inc. ä¿®æ”¹äº† DockerHub çš„å®šä»·ï¼Œä»¥åŠåœ¨ 11 æœˆä»½å°†å¯ç”¨é™é€ŸåŠŸèƒ½ã€‚&lt;/p>
&lt;p>&lt;strong>é™é€Ÿç­–ç•¥æ˜¯å¯¹äºåŒ¿åç”¨æˆ·é™åˆ¶ 100 æ¬¡/6å°æ—¶ï¼Œè€Œå¯¹äºç™»å½•çš„æ™®é€šç”¨æˆ·åˆ™é™åˆ¶ä¸º 200æ¬¡/6å°æ—¶ã€‚&lt;/strong>&lt;/p>
&lt;p>è¿™é‡Œæˆ‘æ¥è¯¦ç»†ä»‹ç»ä¸‹è¿™ä¸ªé™é€Ÿå…·ä½“çš„ &lt;strong>å®æ–½æ–¹å¼&lt;/strong> ï¼š&lt;/p>
&lt;p>é¦–å…ˆï¼Œå®ƒæ˜¯ &lt;strong>åŸºäºå¯¹ DockerHub ä¸Šé•œåƒ manifest çš„è¯·æ±‚æ•°é‡&lt;/strong> ï¼›å…¶æ¬¡å®ƒåŒºåˆ†çš„è´¦æˆ·ç±»å‹æ˜¯æ ¹æ®æ‹‰å–é•œåƒçš„å¸å·æ¥çš„ï¼Œè€Œä¸æ˜¯æ ¹æ®é•œåƒæ‰€æœ‰è€…è¿›è¡Œé™åˆ¶ï¼›&lt;/p>
&lt;p>æœ€åï¼Œ &lt;strong>å¯¹äºåŒ¿åç”¨æˆ·/æœªç™»å½•ç”¨æˆ·ï¼Œåˆ™æ˜¯æ ¹æ®å…¶å•ä¸ª IP è¿›è¡Œé™åˆ¶çš„ã€‚&lt;/strong>&lt;/p>
&lt;p>åœ¨äº†è§£äº†ä¸Šè¿°çš„åŸºæœ¬æ¦‚å¿µåï¼Œæˆ‘ä»¬å†æ¥çœ‹çœ‹å®é™…åœ¨ä½¿ç”¨æ—¶ï¼Œæ˜¯å¦‚ä½•æ¶ˆè€—é…é¢çš„ã€‚å…¶ &lt;strong>åŸºæœ¬æµç¨‹å¦‚&lt;/strong> ä¸‹ï¼š&lt;/p>
&lt;p>åœ¨æ‰§è¡Œ &lt;code>docker pull &amp;lt;image&amp;gt;&lt;/code> çš„æ—¶å€™ï¼Œ é¦–å…ˆä¼šå‘ registry è¯·æ±‚è¯¥é•œåƒçš„ manifest;&lt;/p>
&lt;p>å¦‚æœè¯¥é•œåƒæ˜¯æ”¯æŒå¤šæ¶æ„çš„ï¼Œé‚£ä¹ˆä¼šåœ¨å…¶ä¸­åŒ¹é…å¯¹åº”éœ€è¦æ‹‰å–çš„æ¶æ„ï¼Œå¹¶é€‰æ‹©å…¶å¯¹åº”å±‚ï¼ˆlayerï¼‰ çš„ blob è¿›è¡Œä¸‹è½½ã€‚&lt;/p>
&lt;p>å‰é¢æåˆ°æœ¬æ¬¡é™åˆ¶æ˜¯åŸºäºå¯¹é•œåƒçš„ manifest è¯·æ±‚åšçš„ã€‚æ‰€ä»¥ï¼Œåœ¨ &lt;strong>æ‹‰å–é•œåƒçš„æ—¶å€™ï¼Œæ— è®ºé•œåƒæ˜¯åªåŒ…å« ä¸€å±‚è¿˜æ˜¯å¤šå±‚ï¼Œå®é™…éƒ½æ˜¯ç®—ä¸€æ¬¡ã€‚&lt;/strong> è¿™å¯¹ç”¨æˆ·ä½“éªŒæ¥è¯´æ˜¯éå¸¸å¥½çš„ã€‚è¿™ä¹Ÿæ˜¯ Docker Inc. åœ¨å……åˆ†å¬å–ç¤¾åŒºç”¨æˆ·åé¦ˆååšå‡ºçš„è°ƒæ•´ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•çŸ¥é“è‡ªå·±è¿˜æœ‰å¤šå°‘é…é¢å‘¢ï¼Ÿ&lt;/p>
&lt;p>å¯ä»¥ç›´æ¥ä½¿ç”¨ curl æˆ–è€…å…¶ä»–æ–¹å¼æ„é€ ä»»æ„æ„é€ ä¸€ä¸ªå¯¹ DockerHub ä¸Šé•œåƒçš„ manifest çš„è¯·æ±‚ï¼Œåœ¨å“åº”å¤´ä¸­ï¼Œä¼šåŒ…å«ä¸¤ä¸ªè‡ªå®šä¹‰çš„å¤´ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;code>RateLimit-Limit&lt;/code> : è¡¨ç¤ºé…é¢æ˜¯å¤šå°‘ï¼Œæ¯”å¦‚ åŒ¿åç”¨æˆ·æ˜¯ 100 ï¼Œ å·²ç»ç™»å½•çš„æ™®é€šç”¨æˆ·æ˜¯ 200ï¼›&lt;/li>
&lt;li>&lt;code>RateLimit-Remaining&lt;/code>ï¼šè¡¨ç¤ºå½“å‰å‰©ä½™çš„é¢åº¦ï¼›&lt;/li>
&lt;/ul>
&lt;p>æ­¤å¤–ï¼Œæˆ‘ä¹Ÿåœ¨ä¹‹å‰çš„æ–‡ç«  &lt;a href="https://zhuanlan.zhihu.com/p/256359308">ã€Šçªç ´ DockerHub é™åˆ¶ï¼Œå…¨é•œåƒåŠ é€ŸæœåŠ¡ã€‹&lt;/a> ä¸­ï¼Œä»‹ç»äº†ä¼ä¸š/ä¸ªäººå¦‚ä½•çªç ´ DockerHub é™åˆ¶ï¼Œæ›´å¥½çš„ä½¿ç”¨ DockerHub çš„é•œåƒæœåŠ¡ã€‚&lt;/p>
&lt;h2 id="kubernetes-v1200-beta0-å‘å¸ƒ">Kubernetes v1.20.0-beta.0 å‘å¸ƒ&lt;/h2>
&lt;p>æ­¤ç‰ˆæœ¬ä¸­æœ€ä¸»è¦çš„å˜åŒ–åœ¨äºåŒæ ˆ service ç›¸å…³çš„å˜åŒ–ã€‚ä»¥åŠä¸€äº›å…¶ä»–çš„å†…å®¹ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/pull/91452">#91452&lt;/a> æ·»åŠ äº† Windows 1809, 1903, 1909, 2004 çš„ pause 3.4 ç‰ˆæœ¬çš„é•œåƒï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/pull/95505">#95505&lt;/a> Windows hyper-v container featuregate åœ¨ 1.20 ä¸­åºŸå¼ƒï¼Œå°†åœ¨ 1.21 ä¸­åˆ é™¤ï¼›&lt;/li>
&lt;/ul>
&lt;p>æ›´å¤šå…³äºæ­¤ç‰ˆæœ¬çš„å˜æ›´ï¼Œè¯·å‚é˜…å…¶ &lt;a href="https://github.com/kubernetes/kubernetes/blob/master/CHANGELOG/CHANGELOG-1.20.md#downloads-for-v1200-beta0">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="thanos-v0160-å‘å¸ƒ">Thanos v0.16.0 å‘å¸ƒ&lt;/h2>
&lt;p>Thanos v0.16.0 äºæœ¬å‘¨æ­£å¼å‘å¸ƒï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹æ­¤ç‰ˆæœ¬ä¸­æœ€ä¸»è¦çš„å˜æ›´ï¼š&lt;/p>
&lt;ul>
&lt;li>Thanos æ–°çš„ç»„ä»¶ &lt;a href="https://thanos.io/tip/components/query-frontend.md/">Query Frontend&lt;/a> å¢åŠ äº†æ›´å¤šé€‰é¡¹å’Œæ”¯æŒå…±äº«ç¼“å­˜ï¼Œå½“å‰æ˜¯ Memcachedï¼›&lt;/li>
&lt;li>ä¸º Thanos UI å¢åŠ äº† Debug æ¨¡å¼ï¼›&lt;/li>
&lt;li>ä¸º Thanos æ‰€æœ‰ç»„ä»¶æ”¹å–„å…¶ Debugï¼Œ å¢åŠ äº† off-CPU profileï¼›&lt;/li>
&lt;li>æ˜¾è‘—æ”¹å–„äº†ç”¨äºè·å–æŒ‡æ ‡çš„ Sidecar çš„å»¶è¿Ÿå’Œ CPU ä½¿ç”¨ç‡ï¼›&lt;/li>
&lt;/ul>
&lt;p>æ›´å¤šå…³äºæ­¤ç‰ˆæœ¬çš„å˜æ›´ï¼Œè¯·å‚ä¸å…¶ &lt;a href="https://github.com/thanos-io/thanos/releases/tag/v0.16.0">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="ä¸Šæ¸¸è¿›å±•">ä¸Šæ¸¸è¿›å±•&lt;/h2>
&lt;p>&lt;a href="https://github.com/kubernetes/kubernetes/pull/91824">#91824&lt;/a> åŒæ ˆ service æ”¯æŒã€‚è¿™æ˜¯ä¸€ä¸ª Break Changeï¼ŒåŸå…ˆçš„ä¸€ä¸ª &lt;code>ipFamily&lt;/code> ä¿®æ”¹æˆäº†ä¸‰ä¸ªå­—æ®µï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;code>ipFamilyPolicy&lt;/code> çš„å¯é€‰é¡¹ä¸º &lt;code>SingleStack&lt;/code> &lt;code>PreferDualStack&lt;/code> å’Œ &lt;code>RequireDualStack&lt;/code> ï¼›&lt;/li>
&lt;li>&lt;code>ipFamilies&lt;/code>&lt;/li>
&lt;li>&lt;code>clusterIPs&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>å½“ç„¶ï¼Œå¤šæ•°ç”¨æˆ·å…¶å®ä¹Ÿæ— éœ€æ‹…å¿ƒï¼Œé»˜è®¤æƒ…å†µä¸‹ Kubernetes ä¼šè‡ªåŠ¨å¤„ç†ç›¸å…³çš„é…ç½®ã€‚&lt;/p>
&lt;hr>
&lt;p>æ¬¢è¿è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://gitee.com/tlrr/awesome/raw/master/2020-9-9/1599632564572-mp-qrcode.png" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| Docker v20.10.0-beta1 å‘å¸ƒ</title><link>https://moelove.info/2020/10/24/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Docker-v20.10.0-beta1-%E5%8F%91%E5%B8%83/</link><guid isPermaLink="true">https://moelove.info/2020/10/24/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Docker-v20.10.0-beta1-%E5%8F%91%E5%B8%83/</guid><pubDate>Sat, 24 Oct 2020 22:38:38 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container" title="k8sç”Ÿæ€">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="docker-å‘å¸ƒ-v20100-beta1-ç‰ˆæœ¬">Docker å‘å¸ƒ v20.10.0-beta1 ç‰ˆæœ¬&lt;/h2>
&lt;p>Docker åœ¨æœ¬å‘¨å‘å¸ƒäº† v20.10.0-beta1 ç‰ˆæœ¬ï¼Œä½œä¸º v20.10 ç‰ˆæœ¬çš„é¦–ä¸ªæµ‹è¯•ç‰ˆæœ¬ï¼Œç›®å‰å¯ä»¥é€šè¿‡ Docker å®˜æ–¹çš„ test channel è¿›è¡Œä¸‹è½½ï¼Œæˆ–è€…ç›´æ¥é€šè¿‡ &lt;code>docker:20.10.0-beta1&lt;/code> å’Œ &lt;code>docker:20.10.0-beta1-dind&lt;/code> ç­‰é•œåƒè¿›è¡Œä½“éªŒã€‚ &lt;strong>å¦‚æœ‰é‡åˆ°é—®é¢˜ï¼Œæ¬¢è¿å¤§å®¶åé¦ˆ~&lt;/strong>&lt;/p>
&lt;p>è¿™ä¸ªç‰ˆæœ¬ç®—æ˜¯å§—å§—æ¥è¿Ÿå§ï¼ŒæŒ‰ç…§åŸå®šå‘å¸ƒè·¯çº¿çš„è¯ï¼Œv19.03 ç‰ˆæœ¬åçš„ä¸‹ä¸ªå¤§ç‰ˆæœ¬ä¾¿æ˜¯ v20.03 äº†ã€‚ä¸è¿‡ç›®å‰ v19.03 ç¤¾åŒºä¹Ÿè¿˜åœ¨ç§¯æè¿›è¡Œç»´æŠ¤ï¼Œå»¶é•¿äº†å…¶ç»´æŠ¤å‘¨æœŸï¼Œå¹¶è®¡åˆ’å‘å¸ƒ v19.03.14 ç‰ˆæœ¬ã€‚&lt;/p>
&lt;p>Docker v20.10 ç‰ˆæœ¬ï¼Œå˜åŒ–éå¸¸çš„å¤§ã€‚æä¾›äº† CGroup v2 çš„æ”¯æŒï¼Œå¢å¼ºäº† rootless æ¨¡å¼çš„æ”¯æŒï¼ŒåŒæ ˆæ—¥å¿—ï¼Œæ›´çµæ´»çš„å†…ç½® DNS ç­‰ï¼Œæˆ‘åœ¨è¿™ä¸ªç‰ˆæœ¬ä¸­ä¹ŸèŠ±è´¹äº†å¾ˆå¤šæ—¶é—´ã€‚&lt;/p>
&lt;p>è¯¦ç»†çš„å˜æ›´ï¼Œæˆ‘ä¼šåœ¨ v20.10 æ­£å¼å‘å¸ƒæ—¶å†è¿›è¡Œä»‹ç»ã€‚æ¬¢è¿å¤§å®¶è¿›è¡Œæµ‹è¯•å’Œåé¦ˆï¼Œç›®å‰å·²ç»æ”¶åˆ°äº†ä¸€äº›åé¦ˆçš„å»ºè®®ã€‚æˆ‘ä»¬ä¼šå°½å¿«ä¿®æ­£å¹¶å‘å¸ƒä¸‹ä¸ªç‰ˆæœ¬ã€‚&lt;/p>
&lt;h2 id="docker-hub-é•œåƒä¿ç•™ç­–ç•¥å°†å»¶æœŸ">Docker Hub é•œåƒä¿ç•™ç­–ç•¥å°†å»¶æœŸ&lt;/h2>
&lt;p>ä¸¤ä¸ªæœˆå‰ï¼Œæˆ‘åœ¨ &lt;a href="https://zhuanlan.zhihu.com/p/186265631">K8S ç”Ÿæ€å‘¨æŠ¥&lt;/a> ä¸­æ›¾ä»‹ç»è¿‡ DockerHub ä¿®æ”¹äº†å®šä»·çš„å†…å®¹ï¼Œå…¶ä¸­åŒ…æ‹¬äº†ä¸€é¡¹ï¼š &lt;strong>é•œåƒä¿ç•™ç­–ç•¥&lt;/strong> çš„å˜æ›´ï¼Œ &lt;strong>å¯¹äºéæ´»è·ƒé•œåƒï¼Œé»˜è®¤åªä¿ç•™ 6 ä¸ªæœˆ&lt;/strong> ã€‚è¿™é¡¹æ›´æ–°åŸå®šæ˜¯åœ¨ 11 æœˆ 1 æ—¥æ­£å¼å®æ–½ã€‚&lt;/p>
&lt;p>ä½†è¿™é¡¹è®¡åˆ’å…¬å¸ƒåï¼Œæ”¶åˆ°äº†å¾ˆå¤šæ¥è‡ªç¤¾åŒºçš„åé¦ˆã€‚æœ¬å‘¨ï¼ŒDocker Inc. å®£å¸ƒå°†å¯¹ä¸Šè¿°æåˆ°çš„é•œåƒä¿ç•™ç­–ç•¥çš„å®æ–½è¿›è¡Œå»¶æœŸæ‰§è¡Œï¼Œç›®å‰è®¡åˆ’æ˜¯å…ˆå»¶æœŸè‡³ 2021 å¹´å¹´ä¸­ã€‚åœ¨ 2021 å¹´å¹´åˆä¼šå…¬å¸ƒæ–°çš„è®¡åˆ’æ—¶é—´è¡¨ã€‚&lt;/p>
&lt;p>åŒæ—¶ï¼ŒDocker Inc. å°†æ¨å‡ºå®éªŒæ€§çš„ Hub CLI ç®¡ç†å·¥å…·ï¼ŒHub Dashboard å’Œæ–°çš„ API ç­‰ï¼Œä¸“æ³¨äºæ›´å¥½çš„ä¸ºå¼€å‘è€…æä¾›æœåŠ¡ã€‚&lt;/p>
&lt;p>å¦å¤–ï¼Œä¹Ÿå†æ¬¡æé†’ï¼Œè‡ª 11 æœˆ 1 æ—¥èµ·ï¼ŒDockerHub å°†é™åˆ¶ä¸‹è½½é¢‘ç‡ã€‚å¯¹äºåŒ¿åç”¨æˆ· 100 æ¬¡/6å°æ—¶ï¼›å¯¹äºå·²ç™»å½•ç”¨æˆ· 200æ¬¡/6å°æ—¶ã€‚å»ºè®®å‚è€ƒæˆ‘çš„å¦ä¸€ç¯‡æ–‡ç«  &lt;a href="https://zhuanlan.zhihu.com/p/256359308">ã€Šçªç ´ DockerHub é™åˆ¶ï¼Œå…¨é•œåƒåŠ é€ŸæœåŠ¡ã€‹&lt;/a> æ¥é¿å…å—æ­¤ç­–ç•¥çš„å½±å“ã€‚&lt;/p>
&lt;h2 id="prometheus-v2220-æ­£å¼å‘å¸ƒ">Prometheus v2.22.0 æ­£å¼å‘å¸ƒ&lt;/h2>
&lt;p>åœ¨ Prometheus v2.22 ä¸­æœ€å¤§çš„å˜åŒ–æ˜¯ç§»é™¤äº†å®éªŒæ€§çš„ gRPC API v2 &lt;a href="https://github.com/prometheus/prometheus/pull/7935">#7935&lt;/a>ã€‚&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://github.com/prometheus/prometheus/pull/6957">#6957&lt;/a> åœ¨ UI ä¸­ï¼Œtarget é¡µé¢å¢åŠ ä¸€é”®æ”¶èµ·å…¨éƒ¨åˆ—è¡¨çš„æŒ‰é’®, è¿™ä¸ªåŠŸèƒ½å¾ˆå®ç”¨ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/prometheus/prometheus/pull/7936">#7936&lt;/a> åœ¨ Alert é¡µé¢ï¼Œå¢åŠ äº†ç­›é€‰ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/prometheus/prometheus/pull/8004">#8004&lt;/a> ä¼˜é›…çš„å¤„ç†æœªçŸ¥ç±»å‹çš„ WAL è®°å½•ï¼›&lt;/li>
&lt;/ul>
&lt;p>æ›´å¤šå…³äºæ¬¡ç‰ˆæœ¬çš„ä¿¡æ¯ï¼Œè¯·å‚è€ƒå…¶ &lt;a href="https://github.com/prometheus/prometheus/releases/tag/v2.22.0">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="trivy-v0120-å‘å¸ƒ">Trivy v0.12.0 å‘å¸ƒ&lt;/h2>
&lt;p>Trivy å‘å¸ƒäº† v0.12.0 ç‰ˆæœ¬ï¼Œå¸¦æ¥äº†ä¸€äº›æ›´æ–°ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;a href="https://github.com/aquasecurity/trivy/pull/641">#641&lt;/a> ä¸º fs å’Œ repo å¢åŠ äº† &lt;code>--skip-update&lt;/code> é€‰é¡¹ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a href="https://github.com/aquasecurity/trivy/pull/624">#624&lt;/a> å¢åŠ äº† &lt;code>--skip-files&lt;/code> é€‰é¡¹ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a href="https://github.com/aquasecurity/trivy/pull/644">#644&lt;/a> ä¸º Trivy server å¢åŠ äº†å¥åº·æ£€æŸ¥ï¼Œä¾‹å¦‚ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">$ curl http://127.0.0.1:4954/healthz
ok
$ curl http://127.0.0.1:4954/healthz -v
* Trying 127.0.0.1...
* TCP_NODELAY &lt;span class="nb">set&lt;/span>
* Connected to 127.0.0.1 &lt;span class="o">(&lt;/span>127.0.0.1&lt;span class="o">)&lt;/span> port &lt;span class="m">4954&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="c1">#0)&lt;/span>
&amp;gt; GET /healthz HTTP/1.1
&amp;gt; Host: 127.0.0.1:4954
&amp;gt; User-Agent: curl/7.54.0
&amp;gt; Accept: */*
&amp;gt;
&amp;lt; HTTP/1.1 &lt;span class="m">200&lt;/span> OK
&amp;lt; Date: Sun, &lt;span class="m">20&lt;/span> Sep &lt;span class="m">2020&lt;/span> 03:11:57 GMT
&amp;lt; Content-Length: &lt;span class="m">2&lt;/span>
&amp;lt; Content-Type: text/plain&lt;span class="p">;&lt;/span> &lt;span class="nv">charset&lt;/span>&lt;span class="o">=&lt;/span>utf-8
&amp;lt;
* Connection &lt;span class="c1">#0 to host 127.0.0.1 left intact&lt;/span>
ok
&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul>
&lt;h2 id="ä¸Šæ¸¸è¿›å±•">ä¸Šæ¸¸è¿›å±•&lt;/h2>
&lt;p>&lt;a href="https://github.com/kubernetes/kubernetes/pull/95566">#95566&lt;/a> SCTP æ”¯æŒç°åœ¨è¾¾åˆ° GA ã€‚ä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¹¶éæ‰€æœ‰çš„äº‘å¹³å°æˆ–è€…ç½‘ç»œç»„ä»¶éƒ½æ”¯æŒ SCTP æµé‡ã€‚&lt;/p>
&lt;hr>
&lt;p>æ¬¢è¿è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://gitee.com/tlrr/awesome/raw/master/2020-9-9/1599632564572-mp-qrcode.png" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| Helm äº”å‘¨å²å•¦ï¼</title><link>https://moelove.info/2020/10/18/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Helm-%E4%BA%94%E5%91%A8%E5%B2%81%E5%95%A6/</link><guid isPermaLink="true">https://moelove.info/2020/10/18/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Helm-%E4%BA%94%E5%91%A8%E5%B2%81%E5%95%A6/</guid><pubDate>Sun, 18 Oct 2020 18:22:19 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container" title="k8sç”Ÿæ€">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="helm-äº”å‘¨å²å•¦">Helm äº”å‘¨å²å•¦ï¼&lt;/h2>
&lt;p>Helm äº 2015 å¹´ï¼Œåœ¨ Deis çš„é»‘å®¢æ¾ä¸­åˆ›å»ºï¼ˆè¯¥å…¬å¸å·²è¢«å¾®è½¯æ”¶è´­ï¼‰ã€‚åœ¨åŒå¹´çš„é¦–å±Š KubeCon ä¸Šæ­£å¼æ¨å‡ºç°åœ¨è¢«ç§°ä¹‹ä¸º Helm classic çš„ç‰ˆæœ¬ã€‚&lt;/p>
&lt;p>2016 å¹´ Helm å›¢é˜Ÿå’Œ Googleï¼ŒSkippboxï¼Œä»¥åŠ Bitnami ä¸€èµ·åˆ›å»ºäº† Helm 2 ã€‚è‡ªæ­¤ Helm Chart å·¥ä½œæµå°±åŸºæœ¬å®šä¹‰å¥½äº†ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ç°åœ¨åœ¨ç”¨çš„æ ·å­ã€‚&lt;/p>
&lt;p>2018 å¹´ 6 æœˆï¼ŒHelm æˆä¸ºäº† CNCF çš„å­µåŒ–é¡¹ç›®ã€‚åœ¨é‚£ä¹‹åï¼ŒHelm Hub ä¹Ÿå¼€å§‹æ‰˜ç®¡ Helm Chart ã€‚&lt;/p>
&lt;p>æœ€è¿‘ Helm å›¢é˜Ÿåšå‡ºäº†ä¸€ä¸ªé‡å¤§çš„å†³å®šï¼š&lt;/p>
&lt;h3 id="hub-è¿ç§»åˆ°äº†-artifact-hub">Hub è¿ç§»åˆ°äº† Artifact Hub&lt;/h3>
&lt;p>&lt;a href="https://hub.helm.sh">Helm Hub&lt;/a> æ­£å¼è¿ç§»åˆ°äº† &lt;a href="https://artifacthub.io">Artifact Hub&lt;/a> ã€‚&lt;/p>
&lt;p>Helm Hub æ˜¯æ„å»ºåœ¨ Monocular é¡¹ç›®ä¹‹ä¸Šçš„ï¼Œæ ¹æ® Helm å›¢é˜Ÿçš„è¯´æ³•ï¼Œè¿™ä¸ªé¡¹ç›®è®¾è®¡ä¹‹åˆä»…ä¸ºå¤„ç†æœ‰é™çš„ Helm repo ã€‚ ä½†éšç€ç°åœ¨ Helm åº”ç”¨çš„è¶Šæ¥è¶Šå¹¿æ³›ï¼ŒMonocular é¡¹ç›®çš„å±€é™æ€§å°±æš´éœ²äº†å‡ºæ¥ã€‚&lt;/p>
&lt;p>ç°åœ¨ Helm å›¢é˜Ÿå†³å®šå°† Helm Hub æ­£å¼è¿ç§»åˆ° Artifact Hub ã€‚è¿™ä¸ªé¡¹ç›®å¯ä»¥å¾ˆå¥½çš„å¤„ç†ç°åœ¨çš„å¢é•¿é—®é¢˜ï¼Œå¹¶ä¸”å®ƒä¸ä»…å¯ä»¥å¤„ç† Helm Chart ä¹Ÿå¯ä»¥å¤„ç†æ›´å¤š CNCF ç”Ÿæ€ä¸­çš„å…¶ä»–å†…å®¹ã€‚æ¯”å¦‚ Artifact Hub ä¸­ä¹ŸåŒ…å«äº†å¾ˆå¤š Falco è§„åˆ™ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„ä¸€é”®åº”ç”¨åˆ°è‡ªå·±çš„ç¯å¢ƒä¸­ã€‚&lt;/p>
&lt;p>åœ¨æˆ‘ä½¿ç”¨ GitHub å¸å·ç™»å½• Artifact Hub æ—¶ï¼Œæ€»æ˜¯é‡åˆ°é”™è¯¯ï¼Œä¸è¿‡æˆ‘è¿˜æ²¡æœ‰çœ‹å…·ä½“åŸå› ~ å¦å¤–ï¼ŒArtifact Hub é¡¹ç›®ç¼ºå°‘ä¸€äº›æ–‡æ¡£ä¹‹ç±»çš„ä¿¡æ¯ï¼Œä½†ä¹Ÿåœ¨é€æ­¥å®Œå–„ä¸­ã€‚&lt;/p>
&lt;p>å¦å¤–ï¼Œ Artifact Hub ä¹Ÿå¯èƒ½ä¼šæ”¯æŒ OCI å…¼å®¹çš„ Helm repoï¼ŒæœŸå¾…ä¸­ã€‚&lt;/p>
&lt;p>æ­¤å¤–ï¼Œ2020 å¹´ 4 æœˆ Helm æ­£å¼ä» CNCF æ¯•ä¸šï¼Œç°åœ¨ Helm æœ‰è¶…è¿‡ 1500 å®¶å…¬å¸åœ¨ä½¿ç”¨ Helm æˆ–ä¸º Helm è´¡çŒ®ä»£ç ï¼ŒHelm ç»„ç»‡ä¹Ÿç®¡ç†è€…å¤§é‡çš„ GitHub ä»“åº“ã€‚&lt;/p>
&lt;p>ä½†åœ¨å­˜å‚¨ Chart æ–¹é¢ï¼Œä¹‹å‰ Helm stable chart ä¸€ç›´æ‰˜ç®¡åœ¨ Google çš„å¯¹è±¡å­˜å‚¨ä¸­ã€‚&lt;/p>
&lt;p>åœ¨ Helm äº”å‘¨å²ä¹‹é™…ï¼ŒHelm å›¢é˜Ÿä¹Ÿå®£å¸ƒäº†ä¸€ä¸ªé‡è¦çš„å†³å®šï¼š&lt;/p>
&lt;p>&lt;strong>Helm stable å’Œ incubator çš„ Chart ä»“åº“ï¼Œå°†ç›´æ¥æ‰˜ç®¡åœ¨ GitHub ä¸Š&lt;/strong>&lt;/p>
&lt;p>å¹¶å‘å¸ƒäº† &lt;a href="https://github.com/marketplace/actions/helm-chart-releaser" title="Helm Chart Releaser">Helm Chart Releaser&lt;/a> GitHub Action å·¥å…·ã€‚&lt;/p>
&lt;p>æ„Ÿå…´è¶£çš„æœ‹å‹æ¬¢è¿ç›´æ¥åœ¨ GitHub ä¸Šä½“éªŒ~&lt;/p>
&lt;h2 id="rook-æ­£å¼ä»-cncf-æ¯•ä¸š">Rook æ­£å¼ä» CNCF æ¯•ä¸š&lt;/h2>
&lt;p>Rook ä¸º Kubernetes æä¾›äº†äº‘åŸç”Ÿçš„å­˜å‚¨è§£å†³æ–¹æ¡ˆã€‚åŒ…æ‹¬å¹³å°ï¼Œæ¡†æ¶ï¼Œä»¥åŠå¯¹å¤šç§å­˜å‚¨è§£å†³æ–¹æ¡ˆçš„æ”¯æŒï¼Œä¾‹å¦‚ï¼š Cephï¼Œminio ç­‰ã€‚&lt;/p>
&lt;p>å®ƒä» 2018 å¹´å¼€å§‹è¢«æ¥å—æˆä¸º CNCF é¡¹ç›®ï¼Œæ˜¯ç¬¬ 13 ä¸ªæ­£å¼ä» CNCF æ¯•ä¸šçš„é¡¹ç›®ï¼Œä¹Ÿæ˜¯ç¬¬ä¸€ä¸ªæä¾›äº† block , file å’Œå¯¹è±¡å­˜å‚¨çš„å­˜å‚¨ç±»é¡¹ç›®ã€‚&lt;/p>
&lt;p>æˆ‘ä¹Ÿåœ¨ä½¿ç”¨ Rook æ¥ç®¡ç† Kubernetes ä¸­çš„ Ceph é›†ç¾¤ï¼Œç”¨æ¥æä¾›å—å­˜å‚¨å’Œå¯¹è±¡å­˜å‚¨ã€‚æ•´ä½“è€Œè¨€æ˜¯æ¯”è¾ƒæ–¹ä¾¿çš„ï¼Œåªæ˜¯ç‰ˆæœ¬å‡çº§ä¹‹ç±»çš„ï¼Œéœ€è¦æ³¨æ„ä¸‹ï¼Œä¸éœ€è¦è¿½çš„å¤ªç´§ã€‚æˆ‘åœ¨ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€ä¸­ï¼Œä¹Ÿåœ¨æŒç»­è·Ÿè¿› Rook çš„å‘å±•ï¼ŒåŠæ¯ä¸ªç‰ˆæœ¬ä¸­åŒ…å«çš„é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆä¹‹ç±»çš„ï¼Œæœ‰å…´è¶£çš„æœ‹å‹å¯ä»¥çœ‹çœ‹å†å²æ–‡ç« ã€‚&lt;/p>
&lt;p>æœ€åï¼Œå†æ¬¡æ­å–œ Rook æ­£å¼æ¯•ä¸šï¼&lt;/p>
&lt;h2 id="rook-v146-å‘å¸ƒ">Rook v1.4.6 å‘å¸ƒ&lt;/h2>
&lt;p>æ­¤æ¬¡ç‰ˆæœ¬ä¸­åŒ…å«äº†ä¸€äº›æ¯”è¾ƒé‡è¦çš„æ›´æ–°ï¼Œæˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹å§ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://github.com/rook/rook/pull/6283">#6283&lt;/a> æä¾›äº†å¯¹ IPv6 å•æ ˆçš„æ”¯æŒï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/rook/rook/pull/6437">#6437&lt;/a> å¯¹äºè§„æ¨¡è¾ƒå°çš„é›†ç¾¤ï¼Œæ¯”å¦‚ä½†èŠ‚ç‚¹çš„æµ‹è¯•é›†ç¾¤ï¼Œåˆ™ä»…å¯åŠ¨ä¸€ä¸ª CSI provisionerï¼Œ ä¹‹å‰é»˜è®¤æ˜¯ 2ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/rook/rook/pull/6184">#6184&lt;/a> åœ¨ LV-backed PVC ä¸Šè®© OSD ä½¿ç”¨ RAW æ¨¡å¼ï¼Œè€Œé LVM æ¨¡å¼ï¼›&lt;/li>
&lt;/ul>
&lt;p>æ›´å¤šå…³äºæ­¤ç‰ˆæœ¬çš„å˜æ›´ï¼Œè¯·å‚è€ƒå…¶ &lt;a href="https://github.com/rook/rook/releases/tag/v1.4.6">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="containerd-v1214-å‘å¸ƒ">containerd v1.2.14 å‘å¸ƒ&lt;/h2>
&lt;p>å¦‚æœè¿˜æœ‰åœ¨ä½¿ç”¨ containerd v1.2.x ç‰ˆæœ¬çš„å°ä¼™ä¼´è¯·æ³¨æ„ã€‚ æ­¤ç‰ˆæœ¬ä¸»è¦æ˜¯ä¸ºäº†ä¿®å¤ &lt;a href="https://nvd.nist.gov/vuln/detail/CVE-2020-15157">CVE-2020-15157&lt;/a> ã€‚ &lt;strong>è¯¥æ¼æ´ä»…å½±å“ containerd v1.3 ä¹‹å‰çš„ç‰ˆæœ¬&lt;/strong>&lt;/p>
&lt;p>ç›¸åº”çš„ï¼Œåœ¨ Docker v19.03.13 ä¹‹å‰ï¼Œé»˜è®¤ä½¿ç”¨çš„å‡æ˜¯ containerd v1.2.x ç‰ˆæœ¬ã€‚æ‰€ä»¥å¦‚æœä¸ºäº†é¿å…å—æ­¤å®‰å…¨æ¼æ´çš„å½±å“ï¼Œä¹Ÿéœ€è¦å¯¹åº”çš„å‡çº§ Docker æ‰€ä½¿ç”¨çš„ containerd ç‰ˆæœ¬ï¼Œæˆ–è€…ç›´æ¥å°† Docker å‡çº§åˆ° v19.03.13 ç‰ˆæœ¬ã€‚&lt;/p>
&lt;p>æ­¤æ¼æ´çš„å…·ä½“å½±å“æ˜¯ï¼šcontainerd v1.2.14 ä¹‹å‰çš„ç‰ˆæœ¬ä¸­ï¼Œåœ¨è¯·æ±‚å®¹å™¨é•œåƒçš„ manifest æ—¶ï¼Œå¦‚æœæœåŠ¡ç«¯è¿”å› 401 å“åº”å¤´ï¼Œåˆ™å®ƒä¼šå°è¯•æä¾›ç™»å½•å‡­æ®è¿›è¡Œè®¤è¯ã€‚&lt;/p>
&lt;p>è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœå¯¹åº”çš„æœåŠ¡ç«¯åœ°å€æ˜¯ç”±æ”»å‡»è€…æ§åˆ¶çš„ï¼Œåˆ™æ”»å‡»è€…å°±å¯ä»¥è·å–ç”¨æˆ·çš„ç™»å½•å‡­è¯ã€‚&lt;/p>
&lt;p>è§£å†³åŠæ³•æ˜¯å‡çº§ containerd v1.2.14 æˆ–è€… containerd v1.3+ ä»¥ä¸Šçš„ç‰ˆæœ¬ã€‚&lt;/p>
&lt;h2 id="ä¸Šæ¸¸è¿›å±•">ä¸Šæ¸¸è¿›å±•&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/pull/95125">#95125&lt;/a> kubeadm åºŸå¼ƒäº†å®éªŒæ€§çš„è‡ªæ‰˜ç®¡åŠŸèƒ½çš„æ”¯æŒ &lt;code>kubeadm alpha self-hosting&lt;/code> å‘½ä»¤å°†åœ¨ä¹‹åç‰ˆæœ¬è¿›è¡Œç§»é™¤ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/pull/94712">#94712&lt;/a> é¿å…åœ¨æ—¥å¿—ä¸­æ³„æ¼ &lt;code>.dockercfg&lt;/code> çš„å†…å®¹ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/pull/78153">#78153&lt;/a> æ–°å¢ &lt;code>kubectl create ingress&lt;/code> å‘½ä»¤ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/kubernetes/enhancements/pull/1899">KEP#1899&lt;/a> å¢å¼ºå¤„ç† exec è¯·æ±‚ä»¥é¿å… SSRF æ”»å‡»ï¼›&lt;/li>
&lt;/ul>
&lt;h2 id="é¢˜å¤–è¯">é¢˜å¤–è¯&lt;/h2>
&lt;p>éå¸¸æŠ±æ­‰ï¼Œè¿‘æœŸå·¥ä½œå¾ˆå¿™ï¼Œæ‹–æ›´äº†ä¸¤ç¯‡ã€‚æ„Ÿè°¢å¤§å®¶æ²¡æœ‰å–å…³~ åç»­ä¼šç»§ç»­åšæŒæ›´æ–°çš„ï¼&lt;/p>
&lt;hr>
&lt;p>æ¬¢è¿è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://gitee.com/tlrr/awesome/raw/master/2020-9-9/1599632564572-mp-qrcode.png" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| Helm v3.3.4 å‘å¸ƒ</title><link>https://moelove.info/2020/09/26/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Helm-v3.3.4-%E5%8F%91%E5%B8%83/</link><guid isPermaLink="true">https://moelove.info/2020/09/26/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Helm-v3.3.4-%E5%8F%91%E5%B8%83/</guid><pubDate>Sat, 26 Sep 2020 12:58:50 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container" title="k8sç”Ÿæ€">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="helm-v334-å‘å¸ƒ">Helm v3.3.4 å‘å¸ƒ&lt;/h2>
&lt;p>æœ¬å‘¨ Helm v3.3.4 å‘å¸ƒäº†, è¿™ä¸ªç‰ˆæœ¬æ˜¯ä¸€ä¸ª bugfix ç‰ˆæœ¬, ä¿®å¤äº†è‡ª Helm v3.3.2 ä¸­å¼•å…¥çš„ä¸€äº›é—®é¢˜ã€‚&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://github.com/helm/helm/pull/8779">#8779&lt;/a> ç¡®ä¿ warning ä¿¡æ¯è¾“å‡ºåˆ° stderr è€Œä¸æ˜¯ stdout ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/helm/helm/pull/8791">#8791&lt;/a> ä¿®å¤äº†è‡ª &lt;a href="https://github.com/helm/helm/pull/8779">#8779&lt;/a> ä¸­å¼•å…¥çš„ï¼Œåœ¨ windows ä¸Š build çš„å¼‚å¸¸ã€‚ä¸»è¦æ˜¯åœ¨ PR CI ä¸­æ²¡æœ‰æµ‹è¯• Windows å¹³å°ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/helm/helm/pull/8777">#8777&lt;/a> ä¿®å¤äº†è‡ª v3.3.2 ä¸­å¸¦æ¥çš„ break change ã€‚åœ¨ v3.3.1 åŠä¹‹å‰ç‰ˆæœ¬ä¸­ï¼Œ&lt;code>helm repo add&lt;/code> æ˜¯ä¸€ä¸ªå¹‚ç­‰æ“ä½œï¼Œä½†è‡ª v3.3.2 ä¸­ä¸ºäº†ä¿®å¤å®‰å…¨é—®é¢˜ï¼Œå¼•å…¥äº†ä¸€ä¸ª break change ï¼Œå¦‚æœè¦æ·»åŠ åŒåçš„ repo ï¼Œéœ€è¦å¢åŠ  &lt;code>--force-update&lt;/code> å‚æ•°æ‰å¯ä»¥ã€‚è¿™å¯¼è‡´äº†å¾ˆå¤šè‡ªåŠ¨åŒ–å·¥å…·çš„å¤±è´¥ï¼Œæ‰€ä»¥åœ¨ v3.3.4 ç‰ˆæœ¬ä¸­å¯¹æ­¤è¿›è¡Œäº†ä¿®å¤ã€‚å³ï¼šå¦‚æœæ·»åŠ çš„ repo å®Œå…¨ç›¸åŒï¼Œåˆ™æ­¤æ“ä½œè¿˜æ˜¯å¹‚ç­‰çš„ï¼Œå¦‚æœ repo ä»…æ˜¯ name ç›¸åŒï¼Œä½†æ˜¯ url æˆ–è€… repo çš„ä¿¡æ¯ä¸åŒï¼Œåˆ™éœ€è¦å¢åŠ  &lt;code>--force-update&lt;/code> å‚æ•°æ‰å¯ä»¥ã€‚&lt;/li>
&lt;/ul>
&lt;h2 id="docker-v190313-å‘å¸ƒ">Docker v19.03.13 å‘å¸ƒ&lt;/h2>
&lt;p>Docker v19.03.13 å‘å¸ƒäº†ï¼Œ è™½ç„¶è¿™ä¸ªç‰ˆæœ¬çš„å˜æ›´çœ‹èµ·æ¥ä¸å¤šï¼Œåœ¨ ReleaseNote ä¸­æ²¡æœ‰åšå¤ªå¤šçš„è¯´æ˜ï¼Œä½† &lt;strong>è¿™ä¸ªç‰ˆæœ¬å…¶å®éœ€è¦æ ¼å¤–æ³¨æ„&lt;/strong>ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ä¿®å¤äº† rootless æ¨¡å¼ä¸‹ï¼Œç«¯å£è½¬å‘é€ æˆçš„èµ„æºæ³„æ¼é—®é¢˜ï¼Œä¸»è¦æ˜¯ rootless æ¨¡å¼ä¸‹ä¾èµ–çš„ç»„ä»¶çš„æ³„æ¼å¯¼è‡´çš„ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä¿®å¤äº† network sandbox æœªè¢«å®Œå…¨å›æ”¶çš„é—®é¢˜ï¼Œä¸»è¦æ˜¯ä»£ç ä¸­çš„ç”¨æ¥æ¸…ç†çš„ &lt;code>defer&lt;/code> å‡½æ•°æ£€æŸ¥çš„å˜é‡æœ‰è¯¯ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>å°† containerd å‡çº§è‡³ v1.3.7&lt;/strong> åœ¨æ­¤ç‰ˆæœ¬ä¹‹å‰ï¼ŒDocker v19.03 ç³»åˆ—ä¸€ç›´åœ¨ä½¿ç”¨ containerd v1.2.x ç‰ˆæœ¬ã€‚åœ¨ Docker v19.03.12 ç‰ˆæœ¬ä¸­ï¼Œä½¿ç”¨çš„æ˜¯ containerd v1.2.13 ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>containerd v1.2 ç³»åˆ—åŸå®šäº 2020 å¹´ 9 æœˆ 26 æ—¥ç»ˆæ­¢ç»´æŠ¤ï¼ˆEOLï¼‰ï¼Œç°åœ¨ç»è¿‡ç»´æŠ¤è€…ä»¬è®¨è®ºï¼Œå†³å®šå°†æ­¤æ—¶é—´å»¶é•¿è‡³ 10 æœˆ 15 æ—¥ï¼Œä»¥ä¾¿ç”¨äºè¿ç§»è‡³ v1.3 ç‰ˆæœ¬ä¸­å»ã€‚&lt;/p>
&lt;p>ä¹Ÿå°±æ˜¯è¯´ï¼Œ &lt;strong>å¦‚æœä½ åœ¨è´Ÿè´£ Docker / ç›¸å…³å®¹å™¨åŸºç¡€ç¯å¢ƒçš„è¯ï¼Œæˆ‘å»ºè®®ä½ å°† Docker ç‰ˆæœ¬å‡çº§è‡³ v19.03.13 ï¼Œæˆ–è€…ç›´æ¥å°† containerd ä» v1.2 ç³»åˆ—å‡çº§è‡³ v1.3.7 ç‰ˆæœ¬ã€‚&lt;/strong>&lt;/p>
&lt;p>è‡³äº containerd v1.3 ç‰ˆæœ¬ä¸ v1.2 ä¹‹é—´çš„å˜åŒ–ï¼Œæˆ‘å»ºè®®ä½ é˜…è¯»æˆ‘å¾€æœŸçš„ ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€ï¼Œè‡ªå»å¹´ 9 æœˆ containerd v1.3.0 å‘å¸ƒå¼€å§‹ï¼Œå‡ ä¹æ¯ä¸ªç‰ˆæœ¬æˆ‘éƒ½æœ‰è¯¦ç»†ä»‹ç»è¿‡ã€‚&lt;/p>
&lt;h2 id="podman-v21-å‘å¸ƒ">Podman v2.1 å‘å¸ƒ&lt;/h2>
&lt;p>Podman åœ¨ v2.1 å¸¦æ¥äº†å¾ˆå¤šæ–°çš„ç‰¹æ€§ï¼Œæˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹å§ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>æ–°å¢ &lt;code>podman save&lt;/code> å’Œ &lt;code>podman load&lt;/code> ç°åœ¨ä¹Ÿå¯ä»¥åƒ docker é‚£æ ·ï¼Œåˆ›å»ºæˆ–è€…åŠ è½½åŒ…å«å¤šä¸ªé•œåƒçš„å½’æ¡£æ–‡ä»¶äº†ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ç°åœ¨çš„é…ç½®æ–‡ä»¶é»˜è®¤ä½¿ç”¨ &lt;code>$HOME/.config/containers/containers.conf&lt;/code> äº†ï¼Œå¦‚æœä»æ—§ç‰ˆæœ¬å‡çº§å¯èƒ½ä¼šé‡åˆ°å¦‚ä¸‹æç¤ºï¼š&lt;/p>
&lt;/li>
&lt;/ul>
&lt;pre>&lt;code>WARN[0000] Found deprecated file /home/tao/.config/containers/libpod.conf, please remove. Use /home/tao/.config/containers/containers.conf to override defaults.
WARN[0000] Ignoring libpod.conf EventsLogger setting &amp;quot;journald&amp;quot;. Use &amp;quot;/home/tao/.config/containers/containers.conf&amp;quot; if you want to change this setting and remove libpod.conf files.
WARN[0000] Found deprecated file /home/tao/.config/containers/libpod.conf, please remove. Use /home/tao/.config/containers/containers.conf to override defaults.
WARN[0000] Ignoring libpod.conf EventsLogger setting &amp;quot;journald&amp;quot;. Use &amp;quot;/home/tao/.config/containers/containers.conf&amp;quot; if you want to change this setting and remove libpod.conf files.
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>rootless æ¨¡å¼ä¸‹ï¼Œç°åœ¨å®Œå…¨æ”¯æŒ &lt;code>podman network&lt;/code> ç›¸å…³åŠŸèƒ½ï¼Œå¹¶ä¸” rootless å®¹å™¨å¯åŠ å…¥ç½‘ç»œï¼›&lt;/li>
&lt;li>&lt;code>podman run&lt;/code> å’Œ &lt;code>podman create&lt;/code> ä¸º &lt;code>--cgroups&lt;/code> æ¨¡å¼å¢åŠ äº†ä¸€ä¸ªæ–°çš„é€‰é¡¹ &lt;code>--cgroups=split&lt;/code>ï¼Œè¿™å¯¹äºå°† podman å®¹å™¨ä½œä¸º systemd unit è¿è¡Œæ—¶æ¯”è¾ƒæœ‰ç”¨ï¼›&lt;/li>
&lt;li>&lt;code>podman play kube&lt;/code> åšäº†å¾ˆå¤šæ”¹è¿›ï¼Œæ¯”å¦‚æ”¯æŒ &lt;code>read-only&lt;/code> æŒ‚è½½ï¼Œå¯ä»¥å¤„ç† &lt;code>HostAlias&lt;/code> ç­‰ï¼›&lt;/li>
&lt;li>&lt;code>podman run&lt;/code> å’Œ &lt;code>podman create&lt;/code> å¯ä»¥å¢åŠ  &lt;code>--tz&lt;/code> å‚æ•°ï¼Œç”¨æ¥ç›´æ¥è®¾ç½®å®¹å™¨çš„æ—¶åŒºï¼Œç®—æ˜¯ä¸ªæ¯”è¾ƒæœ‰ç”¨çš„åŠŸèƒ½ã€‚&lt;/li>
&lt;/ul>
&lt;h2 id="å®‰å…¨æ¼æ´-cve-2020-14386">å®‰å…¨æ¼æ´ CVE-2020-14386&lt;/h2>
&lt;p>&lt;a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-14386" title="CVE-2020-14386">CVE-2020-14386&lt;/a> è¿™ä¸ªæ¼æ´æˆ‘åœ¨ 9 æœˆåˆå°±çœ‹åˆ°äº†é‚®ä»¶ç»„çš„æ¶ˆæ¯ï¼Œå½“æ—¶åšäº†ä¸‹å¤§æ¦‚çš„æµ‹è¯•ï¼Œä¸è¿‡æ²¡æœ‰å†™ç›¸å…³å†…å®¹å‡ºæ¥ã€‚&lt;/p>
&lt;p>ä»Šå¤©æ­£å¥½æœ‰æœ‹å‹åˆè®¨è®ºåˆ°è¿™ä¸ªæ¼æ´ï¼Œè¿™é‡Œç®€å•çš„èŠä¸€ä¸‹å¥½äº†ã€‚&lt;/p>
&lt;p>è¿™æ˜¯ä¸€ä¸ªå½±å“é¢å¾ˆå¹¿æ³›çš„æ¼æ´ï¼Œå› ä¸ºæ˜¯å†…æ ¸æ¼æ´è€Œéåº”ç”¨å±‚æ¼æ´ï¼Œå¹¶ä¸” &lt;strong>å†…æ ¸ç‰ˆæœ¬æ˜¯ &lt;code>v4.6-rc1&lt;/code> åˆ° &lt;code>v5.9-rc4&lt;/code> ä¹‹é—´çš„ï¼Œå…¨éƒ¨ä¼šå—æ­¤æ¼æ´å½±å“ã€‚&lt;/strong>&lt;/p>
&lt;p>æˆ‘åœ¨ CentOS 8 çš„ç³»ç»Ÿä¸Šï¼Œç›´æ¥ä¸‹è½½ &lt;a href="https://seclists.org/oss-sec/2020/q3/att-146/trigger_bug_c.bin">https://seclists.org/oss-sec/2020/q3/att-146/trigger_bug_c.bin&lt;/a> ä½¿ç”¨ &lt;code>gcc&lt;/code> ç¼–è¯‘åï¼Œæ‰§è¡Œä¼šç«‹å³ä½¿ç³»ç»Ÿ crash å¹¶é‡å¯ã€‚&lt;/p>
&lt;p>ReaHat å¯¹æ­¤&lt;a href="https://access.redhat.com/security/cve/CVE-2020-14386" title="CVE-2020-14386 RedHat">æ¼æ´æœ‰ä¸€ç¯‡ä»‹ç»&lt;/a>ï¼Œ å…¶ä¸­ä»‹ç»äº†è§¦å‘æ­¤æ¼æ´çš„æ¡ä»¶æ˜¯ï¼Œå…·å¤‡ &lt;code>CAP_NET_RAW&lt;/code> æƒé™çš„æœ¬åœ°ç”¨æˆ·æ‰èƒ½è§¦å‘æ­¤æ¼æ´ã€‚&lt;/p>
&lt;p>å¯¹äºäº‘åŸç”Ÿä»ä¸šè€…è€Œè¨€ï¼Œå¦‚æœä½ åœ¨ç”¨ Kubernetes ï¼Œé‚£æˆ‘å»ºè®®ä½ å¦‚æœæ²¡æœ‰å•¥ç‰¹æ®ŠåŸå› ï¼Œå¯ä»¥ç›´æ¥è®¾ç½® PSP ï¼Œç¦æ­¢ &lt;code>CAP_NET_RAW&lt;/code> æƒé™ã€‚&lt;/p>
&lt;p>æˆ–è€…è·³è¿‡å—å½±å“ç‰ˆæœ¬çš„å†…æ ¸ã€‚ å½“å‰åœ¨å†…æ ¸ 5.4.64 å’Œ 5.8.8 å‡å·²ä¿®å¤ã€‚æˆ‘å·²ç»å°†è‡ªå·±çš„ç¯å¢ƒå‡çº§åˆ°äº† 5.8.11 ç‰ˆæœ¬çš„å†…æ ¸ã€‚&lt;/p>
&lt;h2 id="ä¸Šæ¸¸è¿›å±•">ä¸Šæ¸¸è¿›å±•&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/pull/94728">#94728&lt;/a> &lt;code>kubectl portforward&lt;/code> å¯ä»¥ç»§ç»­è½¬å‘ TCP å’Œ UDP äº†ã€‚&lt;/li>
&lt;/ul>
&lt;hr>
&lt;p>æ¬¢è¿è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://gitee.com/tlrr/awesome/raw/master/2020-9-9/1599632564572-mp-qrcode.png" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| KIND v0.9 å‘å¸ƒå¸¦æ¥ä¼—å¤šæ›´æ–°</title><link>https://moelove.info/2020/09/20/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-KIND-v0.9-%E5%8F%91%E5%B8%83%E5%B8%A6%E6%9D%A5%E4%BC%97%E5%A4%9A%E6%9B%B4%E6%96%B0/</link><guid isPermaLink="true">https://moelove.info/2020/09/20/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-KIND-v0.9-%E5%8F%91%E5%B8%83%E5%B8%A6%E6%9D%A5%E4%BC%97%E5%A4%9A%E6%9B%B4%E6%96%B0/</guid><pubDate>Sun, 20 Sep 2020 20:19:37 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container" title="k8sç”Ÿæ€">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="kind-v09-æ­£å¼å‘å¸ƒ">KIND v0.9 æ­£å¼å‘å¸ƒ&lt;/h2>
&lt;p>KIND æ˜¯æˆ‘å¾ˆå–œæ¬¢ä¹Ÿä¸€ç›´åœ¨å‚ä¸è´¡çŒ®çš„ Kubernetes SIG å­é¡¹ç›®ï¼Œæœ¬å‘¨ KIND å‘å¸ƒäº† v0.9 ç‰ˆæœ¬ï¼Œè·ç¦»ä¸Šæ¬¡ v0.8 ç‰ˆæœ¬å·²è¿‡å»äº† 4 ä¸ªå¤šæœˆï¼Œåœ¨æ­¤æœŸé—´ï¼Œæˆ‘ä»¬åšäº†å¾ˆå¤šçš„ä¼˜åŒ–å’Œæ”¹è¿›ã€‚ä¸‹é¢æˆ‘æ¥å…·ä½“ä»‹ç»ä¸‹ï¼š&lt;/p>
&lt;h3 id="ç ´åæ€§å˜æ›´">ç ´åæ€§å˜æ›´&lt;/h3>
&lt;ul>
&lt;li>é»˜è®¤çš„ Node é•œåƒç‰ˆæœ¬å·²ç»å‡çº§ä¸ºæœ€æ–°çš„ Kubernetes v1.19.1 ç‰ˆæœ¬ï¼›&lt;/li>
&lt;li>&lt;code>v1alpha3&lt;/code> ç‰ˆæœ¬çš„ KIND config é…ç½®æ–‡ä»¶ç‰ˆæœ¬å·²è¢«åºŸå¼ƒï¼Œå½“å‰æœ€æ–°çš„ç‰ˆæœ¬æ˜¯ &lt;code>v1alpha4&lt;/code>ï¼›&lt;/li>
&lt;li>æ‰§è¡Œ &lt;code>kind build node-image&lt;/code> å‘½ä»¤æ—¶ï¼Œå¦‚æœ &lt;code>--type&lt;/code> æŒ‡å®šä¸º &lt;code>bazel&lt;/code> ï¼Œåˆ™ä»…èƒ½ä¸ Kubernetes v1.15+ ç‰ˆæœ¬å…¼å®¹ã€‚å¦‚æœä½¿ç”¨é»˜è®¤çš„ &lt;code>docker&lt;/code> ç±»å‹çš„æ„å»ºæ–¹å¼ï¼Œåˆ™å¯ä»¥ä¸ v1.13+ ç‰ˆæœ¬å…¼å®¹ï¼›&lt;/li>
&lt;li>ä½¿ç”¨ KIND v0.9.0 ç‰ˆæœ¬æ„å»ºçš„èŠ‚ç‚¹ imageï¼Œä»…æ”¯æŒä¸ KIND v0.9.0+ ç‰ˆæœ¬ä¸€èµ·å·¥ä½œã€‚å¦‚æœæ˜¯ä½¿ç”¨ KIND v0.8+ ç‰ˆæœ¬æ„å»ºçš„é•œåƒï¼Œä¹Ÿå¯ä¸ KIND æœ€æ–°ç‰ˆä¸€èµ·å·¥ä½œï¼Œä½†æ˜¯å°‘äº†ä¸€äº›å†…éƒ¨ä¼˜åŒ–çš„ç‰¹æ€§ï¼›&lt;/li>
&lt;li>&lt;strong>ä¸å†æ”¯æŒ Kubernetes v1.13 ä¹‹å‰çš„ Kubernetes ç‰ˆæœ¬äº†ã€‚&lt;/strong> å¤šèŠ‚ç‚¹é›†ç¾¤çš„è¯ï¼Œä»…æ”¯æŒ Kubernetes v1.14+ ç‰ˆæœ¬äº†ï¼Œä¸»è¦æ˜¯ä¸ &lt;code>kubeadm&lt;/code> æœ‰å…³ï¼›&lt;/li>
&lt;/ul>
&lt;h3 id="æ–°ç‰¹æ€§">æ–°ç‰¹æ€§&lt;/h3>
&lt;ul>
&lt;li>KIND çš„é…ç½®æ–‡ä»¶ä¸­ç›´æ¥æ”¯æŒ Kubernetes RuntimeConfig çš„é…ç½®äº†ï¼›&lt;/li>
&lt;li>NFS volume åº”è¯¥å¯ä»¥å·¥ä½œäº†ï¼›&lt;/li>
&lt;li>ç›®å‰æˆ‘ä»¬ä¸ºæ¯ä¸ªèŠ‚ç‚¹è®¾ç½®äº†ä¸€ä¸ªä»¥ &lt;code>kind://&lt;/code> å‰ç¼€å¼€å¤´çš„ &lt;code>providerID&lt;/code>ï¼Œä½†ä»¥åå¯èƒ½ä¼šå†åšæ”¹åŠ¨ï¼›&lt;/li>
&lt;li>å¦‚æœé…ç½®äº† proxy ï¼Œåˆ™ä¼šè‡ªåŠ¨å¢åŠ  &lt;code>no_proxy&lt;/code> ç›¸å…³çš„é…ç½®ï¼›&lt;/li>
&lt;li>é»˜è®¤çš„ CNI ä¼šè‡ªåŠ¨åŒ¹é…ç½‘å…³çš„ MTUï¼›&lt;/li>
&lt;/ul>
&lt;h3 id="ä¿®æ­£">ä¿®æ­£&lt;/h3>
&lt;ul>
&lt;li>å¯¹ HA æ¨¡å¼åŠ restart ç›¸å…³é€»è¾‘çš„ä¿®æ­£ï¼›&lt;/li>
&lt;li>IPv6 ç›¸å…³ç½‘ç»œé—®é¢˜çš„ä¿®æ­£ï¼›&lt;/li>
&lt;li>ä¸ªåˆ«åœºæ™¯ä¸‹ç«¯å£è½¬å‘çš„é—®é¢˜ä¿®æ­£ï¼›&lt;/li>
&lt;/ul>
&lt;p>å¯¹æ­¤ç‰ˆæœ¬æ„Ÿå…´è¶£çš„å°ä¼™ä¼´ï¼Œå¯ç›´æ¥è®¿é—® &lt;a href="https://github.com/kubernetes-sigs/kind/releases/tag/v0.9.0" title="KIND v0.9 release é¡µé¢">Release é¡µé¢&lt;/a> ä¸‹è½½é¢„ç¼–è¯‘çš„äºŒè¿›åˆ¶ä½¿ç”¨ã€‚&lt;/p>
&lt;h2 id="open-service-mesh-osm-å·²æçŒ®ç»™-cncf">Open Service Mesh (OSM) å·²æçŒ®ç»™ CNCF&lt;/h2>
&lt;p>Open Service Mesh (OSM) &lt;a href="https://openservicemesh.io/blog/open-service-mesh-osm-accepted-into-cncf-as-a-sandbox-project/" title="OSM å®˜å®£åšå®¢">ç›®å‰å·²ç»æçŒ®ç»™ CNCF &lt;/a>æˆä¸º sandbox çº§åˆ«çš„é¡¹ç›®ã€‚æ­£å¦‚ OSM åˆ›å»ºä¹‹åˆæ—¶è¯´çš„é‚£æ ·ï¼Œ å®ƒå°†ä¼šæŒ‰ç…§ CNCF çš„å¼€æºæ²»ç†æ¨¡å‹å‘å±•ï¼Œåº”è¯¥ä¼šæœ‰ä¸ªä¸é”™çš„åç»­çš„ã€‚&lt;/p>
&lt;p>Open Service Meshï¼ˆOSMï¼‰æ˜¯ä¸€ä¸ªè½»é‡çº§ï¼Œå¯æ‰©å±•çš„äº‘åŸç”ŸæœåŠ¡ç½‘æ ¼ï¼Œå®ƒä½¿ç”¨æˆ·èƒ½å¤Ÿç»Ÿä¸€ç®¡ç†ï¼Œä¿æŠ¤å’Œè·å¾—é’ˆå¯¹é«˜åº¦åŠ¨æ€å¾®æœåŠ¡ç¯å¢ƒçš„å¼€ç®±å³ç”¨çš„å¯è§‚å¯Ÿæ€§åŠŸèƒ½ã€‚&lt;/p>
&lt;p>OSM åœ¨ Kubernetes ä¸Šè¿è¡ŒåŸºäº Envoy çš„æ§åˆ¶å¹³é¢ï¼Œå¯ä»¥ä½¿ç”¨ SMI API è¿›è¡Œé…ç½®ã€‚å®ƒé€šè¿‡ä»¥ sidecar çš„å½¢å¼æ³¨å…¥ Envoy ä»£ç†æ¥å·¥ä½œã€‚&lt;/p>
&lt;p>æ§åˆ¶é¢è´Ÿè´£æŒç»­é…ç½®ä»£ç†ï¼Œä»¥é…ç½®ç­–ç•¥å’Œè·¯ç”±è§„åˆ™ç­‰éƒ½ä¿æŒæœ€æ–°ã€‚ä»£ç†ä¸»è¦è´Ÿè´£æ‰§è¡Œè®¿é—®æ§åˆ¶çš„è§„åˆ™ï¼Œè·¯ç”±æ§åˆ¶ï¼Œé‡‡é›† metrics ç­‰ã€‚ï¼ˆè¿™å’Œç›®å‰æˆ‘ä»¬å¸¸è§åˆ°çš„ Service Mesh æ–¹æ¡ˆåŸºæœ¬éƒ½ä¸€æ ·çš„ï¼‰&lt;/p>
&lt;p>å¯¹ Open Service Mesh (OSM) æ„Ÿå…´è¶£çš„å°ä¼™ä¼´ï¼Œå¯å‚è€ƒæˆ‘ä¹‹å‰å†™çš„æ–‡ç«  &lt;a href="https://zhuanlan.zhihu.com/p/171550414" title="åˆè¯• Open Service Meshï¼ˆOSMï¼‰">åˆè¯• Open Service Meshï¼ˆOSMï¼‰&lt;/a>&lt;/p>
&lt;h2 id="containerd-141-å‘å¸ƒ">containerd 1.4.1 å‘å¸ƒ&lt;/h2>
&lt;p>containerd 1.4.1 æ˜¯ v1.4 ç³»åˆ—çš„ç¬¬ä¸€ä¸ª patch ç‰ˆæœ¬ï¼Œåœ¨æ­¤ç‰ˆæœ¬ä¸­å¸¦æ¥äº†ä¸€äº›é‡è¦çš„æ”¹è¿›ï¼Œæˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹å§ï¼š&lt;/p>
&lt;ul>
&lt;li>æ€»æ˜¯ä¿æŒæ¶ˆè´¹ shim çš„æ—¥å¿—ï¼›&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>ä¸Šé¢è¿™å¥è¯çœ‹ä¼¼ç®€å•ï¼Œä½†èƒŒåçš„å½±å“å¾ˆå¤§ã€‚&lt;/strong>&lt;/p>
&lt;p>åœ¨å°† &lt;code>containerd&lt;/code> å‡çº§è‡³ &lt;code>v1.4.0&lt;/code> åï¼Œä¼—å¤š &lt;code>Arch Linux&lt;/code> çš„ç”¨æˆ·éƒ½é‡åˆ°äº†&lt;code>é…ç½®äº†å¥åº·æ£€æŸ¥çš„å®¹å™¨ Hang ä½&lt;/code>çš„é—®é¢˜ã€‚è¯¦ç»†æƒ…å†µè¯·å‚è€ƒ &lt;a href="https://bugs.archlinux.org/task/67773?dev=25983" title="arch linux containerd v1.4 å®¹å™¨ hang ä½">Arch Linux ä¸Šçš„ bug è®°å½•&lt;/a>ã€‚&lt;/p>
&lt;p>ç›®å‰ ArchLinux çš„ä»“åº“ä¸­ï¼Œå·²ç»é‡æ–°æ„å»ºäº† containerd çš„åŒ…ï¼Œå¯ä»¥ç›´æ¥æ›´æ–°ä½¿ç”¨ã€‚&lt;/p>
&lt;p>å½“ç„¶ï¼Œè¿˜æœ‰å¦å¤–ä¸¤ç§è§£å†³åŠæ³•ï¼š&lt;/p>
&lt;ol>
&lt;li>
&lt;p>ç›´æ¥æ›´æ–°è‡³ containerd v1.4.1 ç‰ˆæœ¬ã€‚ æ­¤ç‰ˆæœ¬ä¸­å·²ç»åŠ å…¥äº†ç›¸å…³é€»è¾‘ï¼Œå§‹ç»ˆæ¶ˆè´¹ shim çš„æ—¥å¿—ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¼€å¯ &lt;code>shim_debug&lt;/code> é€‰é¡¹ï¼ˆ &lt;strong>ä»…ä½œä¸ºä¸€ç§ä¸èƒ½å¿«é€Ÿå‡çº§æ—¶çš„ä¸´æ—¶è§£å†³åŠæ³•ï¼Œå¼€å¯ shim_debug åï¼Œå¯èƒ½ä¼šå¸¦æ¥æ›´å¤šé—®é¢˜ï¼Œæ¯”å¦‚æ—¥å¿—æ›´å¤šä¹‹ç±»çš„&lt;/strong> ï¼‰ï¼›&lt;/p>
&lt;/li>
&lt;/ol>
&lt;ul>
&lt;li>æ›´æ–°äº† seccomp é»˜è®¤çš„ profile ï¼›&lt;/li>
&lt;/ul>
&lt;p>å¯¹æ­¤ç‰ˆæœ¬æ„Ÿå…´è¶£çš„å°ä¼™ä¼´ï¼Œå¯å‚é˜…å…¶ &lt;a href="https://github.com/containerd/containerd/releases/tag/v1.4.1" title="containerd v1.4.1">ReleaseNote&lt;/a> äº†è§£æ›´å¤šä¿¡æ¯ã€‚&lt;/p>
&lt;h2 id="harbor-v21-å‘å¸ƒ">Harbor v2.1 å‘å¸ƒ&lt;/h2>
&lt;p>Harbor v2.1 æœ¬å‘¨å‘å¸ƒäº†ï¼Œå…·ä½“ä¸Šä¸ªç‰ˆæœ¬ v2.0 å·²ç»è¿‡å»äº†æŒºé•¿æ—¶é—´äº†ã€‚æœ¬æ¬¡ Harbor v2.1 æœ‰ä¸€äº›å€¼å¾—å…³æ³¨çš„æ–°ç‰¹æ€§ï¼š&lt;/p>
&lt;ul>
&lt;li>Harbor å¯ä½œä¸º Proxy Cache ã€‚ä½† Harbor ç›®å‰çš„å®ç°ï¼Œæ˜¯å°† proxy cache ä¹Ÿä½œä¸ºä¸€ä¸ª Harbor ä¸­çš„é¡¹ç›®æ¥å¤„ç†ï¼Œæ‰€ä»¥éœ€è¦å°†å¾…æ‹‰å–çš„é•œåƒè®¾ç½®ä¸º &lt;code>&amp;lt;harbor_servername&amp;gt;/&amp;lt;proxy_project_name&amp;gt;/repo/name:tag&lt;/code> çš„å½¢å¼ï¼Œæ‰èƒ½ä½œä¸ºç¼“å­˜ä½¿ç”¨ã€‚æˆ‘ä¸ªäººæ„Ÿè§‰è¿™æ ·æ˜¯ä¸å¤ªæ–¹ä¾¿çš„ã€‚ &lt;strong>æœ€æ–¹ä¾¿çš„å½¢å¼æ˜¯ pull through cache, ä¹Ÿå°±æ˜¯ docker daemon ä¸­çš„ registry-mirror ï¼Œå¯ä»¥æ­£å¸¸ pull é•œåƒï¼Œç„¶åç”± docker å¯¹è¯·æ±‚é•œåƒè½¬å‘å¤„ç†&lt;/strong>ï¼Œ æ„Ÿå…´è¶£çš„å°ä¼™ä¼´ï¼Œå¯ä»¥å‚è€ƒæˆ‘å‘å¸ƒçš„æ–‡ç«  &lt;a href="https://zhuanlan.zhihu.com/p/256359308" title="çªç ´ DockerHub é™åˆ¶ï¼Œå…¨é•œåƒåŠ é€ŸæœåŠ¡">çªç ´ DockerHub é™åˆ¶ï¼Œå…¨é•œåƒåŠ é€ŸæœåŠ¡&lt;/a>&lt;/li>
&lt;li>éé˜»å¡çš„ GC ï¼ˆGC ä¸€ç›´æ˜¯ Harbor æ¯”è¾ƒå—äººè¯Ÿç—…çš„ç‚¹ï¼‰ï¼›&lt;/li>
&lt;li>P2P åˆ†å‘ï¼Œä¸ Dragonfly æˆ– Kraken é›†æˆï¼›&lt;/li>
&lt;li>æ–°å¢ sysdig é•œåƒæ‰«æé›†æˆï¼›&lt;/li>
&lt;/ul>
&lt;p>å¯¹æ­¤ç‰ˆæœ¬æ„Ÿå…´è¶£çš„å°ä¼™ä¼´ï¼Œå¯å‚é˜…å…¶ &lt;a href="https://github.com/goharbor/harbor/releases/tag/v2.1.0" title="harbor v2.1.0">ReleaseNote&lt;/a> äº†è§£æ›´å¤šä¿¡æ¯ã€‚&lt;/p>
&lt;h2 id="ä¸Šæ¸¸è¿›å±•">ä¸Šæ¸¸è¿›å±•&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/pull/88337">#88337&lt;/a> &lt;code>kubectl/drain&lt;/code> æ”¯æŒè‡ªå®šä¹‰ pod è¿‡æ»¤äº†, ä»…ä½œä¸ºåº“ä½¿ç”¨æ—¶ã€‚ç›®å‰å°šæœªåœ¨ CLI ä¸­æš´éœ²ç›¸å…³é€‰é¡¹ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/pull/94140">#94140&lt;/a> &lt;code>PidLimits&lt;/code> ç‰¹æ€§ GA äº†ï¼éå¸¸å®ç”¨çš„ç‰¹æ€§ï¼Œå¯ä»¥è§„é¿å¾ˆå¤šé—®é¢˜ã€‚&lt;/li>
&lt;/ul>
&lt;hr>
&lt;p>æ¬¢è¿è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://gitee.com/tlrr/awesome/raw/master/2020-9-9/1599632564572-mp-qrcode.png" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>çªç ´ DockerHub é™åˆ¶ï¼Œå…¨é•œåƒåŠ é€ŸæœåŠ¡</title><link>https://moelove.info/2020/09/20/%E7%AA%81%E7%A0%B4-DockerHub-%E9%99%90%E5%88%B6%E5%85%A8%E9%95%9C%E5%83%8F%E5%8A%A0%E9%80%9F%E6%9C%8D%E5%8A%A1/</link><guid isPermaLink="true">https://moelove.info/2020/09/20/%E7%AA%81%E7%A0%B4-DockerHub-%E9%99%90%E5%88%B6%E5%85%A8%E9%95%9C%E5%83%8F%E5%8A%A0%E9%80%9F%E6%9C%8D%E5%8A%A1/</guid><pubDate>Sun, 20 Sep 2020 10:10:48 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>æœ€è¿‘ DockerHub ä¿®æ”¹äº†å®šä»·ï¼Œå¯¹äºå…è´¹å¸å·ä¼šé™åˆ¶ 200 pulls/6å°æ—¶ï¼Œå¯¹äºåŒ¿åå¸å·åˆ™é™åˆ¶ 100 pulls/6å°æ—¶ã€‚ æœ¬æ–‡æˆ‘æ¥ä»‹ç»ä¸‹å¦‚ä½•ä½¿ç”¨ Cache æ¥åº”å¯¹æ­¤é—®é¢˜ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="èƒŒæ™¯">èƒŒæ™¯&lt;/h2>
&lt;p>DockerHub æ˜¯å…¨ä¸–ç•Œæœ€æ—©ä¹Ÿæ˜¯æœ€å¤§çš„å®¹å™¨é•œåƒä»“åº“ï¼Œæ‰˜ç®¡ç€ä¼—å¤šæ“ä½œç³»ç»Ÿå‘è¡Œç‰ˆåŠå„ç±»è½¯ä»¶çš„ Docker é•œåƒã€‚&lt;/p>
&lt;p>åœ¨æ¨è¿›ä¸šåŠ¡å®¹å™¨åŒ–çš„è¿‡ç¨‹ä¸­ï¼Œä¸å¯é¿å…çš„ï¼Œæˆ‘ä»¬ä¼šéœ€è¦ä½¿ç”¨æ¥è‡ª DockerHub ä¸Šçš„å®¹å™¨é•œåƒã€‚ &lt;em>æ— è®ºæ˜¯åœ¨ä¸ªäººæœ¬åœ°ç¯å¢ƒä¸­ä½¿ç”¨ï¼Œè¿˜æ˜¯ç”¨äºè·‘æµ‹è¯•æœåŠ¡&lt;/em>&lt;/p>
&lt;p>ä»¥ä¸‹æ˜¯ä¸¤ç§ä¸»è¦çš„è§£å†³æ–¹æ¡ˆï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>æ„å»ºä¸€äº›å…¬å…±åŸºç¡€é•œåƒï¼Œå­˜æ”¾åœ¨ä¼ä¸šçš„ç§æœ‰é•œåƒä»“åº“ä¸­ç»™ä¸šåŠ¡æ–¹ä½¿ç”¨ï¼š&lt;/p>
&lt;p>è¿™ç§æ–¹æ¡ˆä¸‹ï¼Œå¦‚æœä¸šåŠ¡æ–¹å¶å°”éœ€è¦ä¸€äº›å°ä¼—çš„/éåŸºç¡€çš„é•œåƒï¼Œå¯èƒ½åªæ˜¯ä¸´æ—¶æµ‹è¯•ä½¿ç”¨ï¼Œé‚£é€šå¸¸æƒ…å†µä¸‹æ˜¯æ²¡å¿…è¦å°†æ­¤ç±»é•œåƒä½œä¸ºåŸºç¡€é•œåƒç»´æŠ¤çš„ã€‚&lt;/p>
&lt;p>ç»“æœå¯èƒ½æ˜¯ï¼š&lt;/p>
&lt;ul>
&lt;li>ä½¿ç”¨ä¸­ç›´æ¥ä» DockerHub pull é•œåƒï¼Œç½‘ç»œçŠ¶å†µä¸ä½³æ—¶ï¼Œå°±æ˜¯æ— å°½çš„ç­‰å¾…ï¼›&lt;/li>
&lt;li>å…ˆ pull é•œåƒï¼Œç„¶å &lt;code>docker tag&lt;/code> é‡ tag åï¼Œ push åˆ°ä¼ä¸šçš„ç§æœ‰é•œåƒä»“åº“ä¸­ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœæ²¡æœ‰è¾ƒå¥½çš„é•œåƒç®¡ç†è§„åˆ™ï¼Œé‚£ä¹ˆé•œåƒä»“åº“ä¸­å°±ä¼šå­˜åœ¨å„ç§æ— æ„ä¹‰çš„é•œåƒï¼Œé€ æˆå­˜å‚¨èµ„æºçš„æµªè´¹ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>ä¸º docker daemon é…ç½® Proxy è¿›è¡ŒåŠ é€Ÿï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;strong>ä¼—å¤šå›½å†…é•œåƒåŠ é€ŸæœåŠ¡ï¼Œä»…æä¾› Docker å®˜æ–¹é•œåƒçš„åŠ é€ŸæœåŠ¡ï¼Œä¸ªäºº/ç»„ç»‡ä¸‹çš„é•œåƒä¸æä¾›åŠ é€ŸæœåŠ¡&lt;/strong>ï¼›&lt;/li>
&lt;li>å³ä½¿åœ¨ä¸åŒèŠ‚ç‚¹ä¸Šï¼Œä¸‹è½½ç›¸åŒçš„é•œåƒï¼Œä»ç„¶éœ€è¦é€šè¿‡ç½‘ç»œåŠ é€Ÿï¼Œä¼šäº§ç”Ÿé¢å¤–çš„æµ·å¤–å¸¦å®½æˆæœ¬ï¼›&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>å¹¶ä¸”è¿‘æœŸ DockerHub ä¿®æ”¹äº†&lt;a href="https://www.docker.com/pricing" title="DockerHub å®šä»·">å…¶æœåŠ¡ä»·æ ¼&lt;/a>, å¯¹äºå…è´¹ç”¨æˆ·ï¼Œè¿›è¡Œäº†å¦‚ä¸‹é™åˆ¶ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;strong>æœªç™»å½•ç”¨æˆ·ï¼Œæ¯ 6 å°æ—¶åªå…è®¸ pull 100 æ¬¡&lt;/strong>&lt;/li>
&lt;li>&lt;strong>å·²ç™»å½•ç”¨æˆ·ï¼Œæ¯ 6 å°æ—¶åªå…è®¸ pull 200 æ¬¡&lt;/strong>&lt;/li>
&lt;/ul>
&lt;p>å¦‚æœæˆ‘ä»¬ç»§ç»­ä½¿ç”¨ä¸Šè¿°ä¸¤ç§æ¨¡å¼çš„è¯ï¼Œç”±äºå‡ºå£ IP æ˜¯ç›¸å¯¹å›ºå®šçš„ï¼Œæ‰€ä»¥å¾ˆå®¹æ˜“è§¦å‘ DockerHub çš„é…é¢é™åˆ¶ã€‚ æ­¤é™åˆ¶å°†äº 11 æœˆ 1 æ—¥æ­£å¼å…¨é¢å®æ–½ã€‚&lt;/p>
&lt;p>ä¸ºäº†èƒ½ &lt;strong>æå‡æ•ˆç‡&lt;/strong> ï¼Œä»¥åŠ &lt;strong>èŠ‚çº¦åŠ é€Ÿå¸¦å®½æˆæœ¬&lt;/strong> ï¼Œä¼ä¸šå†…éƒ¨/ä¸ªäººå°±éå¸¸éœ€è¦ä¸€ä¸ª DockerHub å…¨é•œåƒåŠ é€ŸæœåŠ¡äº†ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„ &lt;code>pull through cache&lt;/code>ã€‚&lt;/p>
&lt;p>ä¸‹é¢æˆ‘æ¥ä»‹ç»ä¸‹ï¼Œå¦‚ä½•åˆ©ç”¨ Docker å¼€æºçš„é¡¹ç›® &lt;code>registry:2&lt;/code> æ¥å®ç°è¿™ä¸€éœ€æ±‚ã€‚&lt;/p>
&lt;h2 id="å¯åŠ¨æœåŠ¡">å¯åŠ¨æœåŠ¡&lt;/h2>
&lt;p>ä½¿ç”¨ &lt;code>registry:2&lt;/code> éƒ¨ç½²é•œåƒç¼“å­˜æœåŠ¡å¾ˆç®€å•ï¼Œè¿™é‡Œå…ˆæ‰§è¡Œ &lt;code>docker pull registry:2&lt;/code> ä¸‹è½½æ‰€éœ€çš„é•œåƒï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ docker pull registry:2
2: Pulling from library/registry
cbdbe7a5bc2a: Pull &lt;span class="nb">complete&lt;/span>
47112e65547d: Pull &lt;span class="nb">complete&lt;/span>
46bcb632e506: Pull &lt;span class="nb">complete&lt;/span>
c1cc712bcecd: Pull &lt;span class="nb">complete&lt;/span>
3db6272dcbfa: Pull &lt;span class="nb">complete&lt;/span>
Digest: sha256:8be26f81ffea54106bae012c6f349df70f4d5e7e2ec01b143c46e2c03b9e551d
Status: Downloaded newer image &lt;span class="k">for&lt;/span> registry:2
docker.io/library/registry:2
&lt;/code>&lt;/pre>&lt;/div>&lt;p>æœ€å°åŒ–é…ç½®çš„ DockerHub é•œåƒç¼“å­˜æœåŠ¡ï¼Œåªéœ€è¦ä½¿ç”¨ä¸€ä¸ªé…ç½®é¡¹ &lt;code>REGISTRY_PROXY_REMOTEURL&lt;/code> å³å¯ï¼š&lt;/p>
&lt;p>è¿™é‡Œæˆ‘é¡ºä¾¿ä¸ºå®ƒå•ç‹¬åˆ›å»ºäº†ä¸€ä¸ªåä¸º &lt;code>hub-cache&lt;/code> çš„ network ï¼Œä»¥åŠåˆ›å»ºäº†å¯¹åº”çš„ volume ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ ~ docker network create hub-cache
19a39f873a23150d3bdaf021e040ccccb092ee3071884d64d52a92df0397b220
&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ ~ docker volume create hub-cache
hub-cache
&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ ~ docker run --name&lt;span class="o">=&lt;/span>cache -d --restart&lt;span class="o">=&lt;/span>always --network&lt;span class="o">=&lt;/span>hub-cache -v hub-cache:/var/lib/registry -p 5000:5000 -e &lt;span class="nv">REGISTRY_PROXY_REMOTEURL&lt;/span>&lt;span class="o">=&lt;/span>https://registry-1.docker.io registry:2
6cbdcbdcc2d62ec781479901c20be43184a48b2d73e06f04bd4693253c0c5a73
&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ ~ docker ps -l
CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES
6cbdcbdcc2d6 registry:2 &lt;span class="s2">&amp;#34;/entrypoint.sh /etcâ€¦&amp;#34;&lt;/span> &lt;span class="m">8&lt;/span> seconds ago Up &lt;span class="m">6&lt;/span> seconds 0.0.0.0:5000-&amp;gt;5000/tcp cache
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="éªŒè¯åŠ é€Ÿæ•ˆæœ">éªŒè¯åŠ é€Ÿæ•ˆæœ&lt;/h2>
&lt;p>å¯åŠ¨ä¸€ä¸ªå…¨æ–°çš„ Docker In Docker å®¹å™¨è¿›è¡ŒéªŒè¯ï¼Œé¿å…å—åˆ°æœ¬åœ°ç¯å¢ƒçš„å½±å“ã€‚&lt;/p>
&lt;p>é€šè¿‡ä¼ é€’ &lt;code>--registry-mirror http://cache:5000&lt;/code> ï¼Œå°†åˆšæ‰å¯åŠ¨çš„ registry è®¾ç½®ä¸º mirror ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ ~ docker run --network&lt;span class="o">=&lt;/span>hub-cache -d --privileged docker:dind --registry-mirror http://cache:5000
73c56ac25d68927c9f5b0e458f2babc0699cf8595df0d1e86c021fd03d477384
&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ ~ docker &lt;span class="nb">exec&lt;/span> -it &lt;span class="k">$(&lt;/span>docker ps -ql&lt;span class="k">)&lt;/span> sh
/ &lt;span class="c1"># æ£€æŸ¥é…ç½®æ˜¯å¦ç”Ÿæ•ˆ&lt;/span>
/ &lt;span class="c1"># docker info --format &amp;#39;{{ .RegistryConfig.Mirrors }}&amp;#39; &lt;/span>
&lt;span class="o">[&lt;/span>http://cache:5000/&lt;span class="o">]&lt;/span>
/ &lt;span class="c1"># time docker pull prom/prometheus&lt;/span>
Using default tag: latest
latest: Pulling from prom/prometheus
76df9210b28c: Pull &lt;span class="nb">complete&lt;/span>
559be8e06c14: Pull &lt;span class="nb">complete&lt;/span>
6a4bb3319487: Pull &lt;span class="nb">complete&lt;/span>
2cca90a64593: Pull &lt;span class="nb">complete&lt;/span>
d2014e464a99: Pull &lt;span class="nb">complete&lt;/span>
70b42590e4a2: Pull &lt;span class="nb">complete&lt;/span>
54645fcbd6cc: Pull &lt;span class="nb">complete&lt;/span>
67d9943de656: Pull &lt;span class="nb">complete&lt;/span>
b9c749b1af90: Pull &lt;span class="nb">complete&lt;/span>
9723d8eb5323: Pull &lt;span class="nb">complete&lt;/span>
7d20502d5322: Pull &lt;span class="nb">complete&lt;/span>
3e519cce6f63: Pull &lt;span class="nb">complete&lt;/span>
Digest: sha256:d43417c260e516508eed1f1d59c10c49d96bbea93eafb4955b0df3aea5908971
Status: Downloaded newer image &lt;span class="k">for&lt;/span> prom/prometheus:latest
docker.io/prom/prometheus:latest
real 0m 42.71s
user 0m 0.12s
sys 0m 0.09s
/ &lt;span class="c1"># docker image ls&lt;/span>
REPOSITORY TAG IMAGE ID CREATED SIZE
prom/prometheus latest cdfc440228d0 &lt;span class="m">8&lt;/span> days ago 168MB
/ &lt;span class="c1"># docker rmi prom/prometheus &lt;/span>
Untagged: prom/prometheus:latest
Untagged: prom/prometheus@sha256:d43417c260e516508eed1f1d59c10c49d96bbea93eafb4955b0df3aea5908971
Deleted: sha256:cdfc440228d01d7a94937d7a047fa6461efc1b1806bb20677043fee032810830
Deleted: sha256:c72f348fd2f923996ea80222feb77e34aba9de397bd96206ddc3c8651adc306d
Deleted: sha256:e34df2c00334266a67bb846b958ba6eae3b1d5cdfe9d763707027a23e7c85100
Deleted: sha256:d2cb38310ada122064b7333bbfc12c67dc58acb30e29146b3ba1e24adc27a950
Deleted: sha256:7a87cd520d19a83b3582541aac4d95098ae5016b092e72eaf80dc54f587bf51e
Deleted: sha256:f84c79dceed6b5a27234c1291d0bdccab5c459d587f13934d74db9b9e79471c6
Deleted: sha256:f542b0cffe0fe16c31c98e7eed934d5fea5e598c03b53b4efd308a62e0e9c6a9
Deleted: sha256:f746b4a525727bcb79367d009d707ef45d75bac09aaa18a68c20a19046df0897
Deleted: sha256:09b45653ee7062c7cd754885bf46ebe554d0794573fb2e200acea8644e64670f
Deleted: sha256:867526c56b30e67493341ef33890aa242c1131e4bb4151e60011b4d450892d59
Deleted: sha256:86d629b358ee70bdb0f0a11c10915b8551e904fe337f9a8bfcad476977329532
Deleted: sha256:842455c528af7383ba4a0de424fc63664a0248581a191516d6dbf45195c69426
Deleted: sha256:1be74353c3d0fd55fb5638a52953e6f1bc441e5b1710921db9ec2aa202725569
/ &lt;span class="c1"># time docker pull prom/prometheus&lt;/span>
Using default tag: latest
latest: Pulling from prom/prometheus
76df9210b28c: Pull &lt;span class="nb">complete&lt;/span>
559be8e06c14: Pull &lt;span class="nb">complete&lt;/span>
6a4bb3319487: Pull &lt;span class="nb">complete&lt;/span>
2cca90a64593: Pull &lt;span class="nb">complete&lt;/span>
d2014e464a99: Pull &lt;span class="nb">complete&lt;/span>
70b42590e4a2: Pull &lt;span class="nb">complete&lt;/span>
54645fcbd6cc: Pull &lt;span class="nb">complete&lt;/span>
67d9943de656: Pull &lt;span class="nb">complete&lt;/span>
b9c749b1af90: Pull &lt;span class="nb">complete&lt;/span>
9723d8eb5323: Pull &lt;span class="nb">complete&lt;/span>
7d20502d5322: Pull &lt;span class="nb">complete&lt;/span>
3e519cce6f63: Pull &lt;span class="nb">complete&lt;/span>
Digest: sha256:d43417c260e516508eed1f1d59c10c49d96bbea93eafb4955b0df3aea5908971
Status: Downloaded newer image &lt;span class="k">for&lt;/span> prom/prometheus:latest
docker.io/prom/prometheus:latest
real 0m 5.27s
user 0m 0.06s
sys 0m 0.03s
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨é¦–æ¬¡ pull &lt;code>prom/prometheus&lt;/code> é•œåƒæ—¶ï¼Œè€—è´¹äº† 42+s çš„æ—¶é—´ï¼Œè€Œåˆ é™¤æ‰å·²ä¸‹è½½çš„é•œåƒåï¼Œå†æ¬¡ pullï¼Œ åˆ™åªéœ€è¦è€—è´¹ 5+s çš„æ—¶é—´ã€‚é€Ÿåº¦æå‡éå¸¸çš„æ˜æ˜¾ã€‚é•œåƒåŠ é€Ÿæ•ˆæœè¾¾æˆ&lt;/strong>&lt;/p>
&lt;h2 id="ä½¿ç”¨é…ç½®">ä½¿ç”¨é…ç½®&lt;/h2>
&lt;p>å¯¹äº Linux ç³»ç»Ÿè€Œè¨€ï¼Œä»…éœ€è¦åœ¨ &lt;code>/etc/docker/daemon.json&lt;/code> æ–‡ä»¶ï¼ˆå¦‚æœæ²¡æœ‰æ­¤æ–‡ä»¶ï¼Œç›´æ¥åˆ›å»ºå³å¯ï¼‰ä¸­å†™å…¥ä½ çš„é•œåƒåŠ é€ŸæœåŠ¡çš„åŸŸåï¼Œé‡å¯ docker daemon å³å¯ï¼ˆä¹Ÿå¯é€‰æ‹© reload é…ç½®ï¼‰ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-json" data-lang="json">&lt;span class="p">{&lt;/span>
&lt;span class="nt">&amp;#34;registry-mirrors&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;span class="s2">&amp;#34;https://hub-cache.moelove.info&amp;#34;&lt;/span>
&lt;span class="p">]&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>æˆ–è€…æ˜¯åœ¨ docker daemon çš„å¯åŠ¨å‚æ•°ä¸­åŠ å…¥ &lt;code>registry-mirror&lt;/code> é…ç½®é¡¹ã€‚&lt;/p>
&lt;p>å¯¹äº Mac å’Œ Windows ç”¨æˆ·ï¼Œç›´æ¥åœ¨ Docker Desktop ç³»ç»Ÿè®¾ç½®ä¸­ï¼Œé…ç½® registry-mirrors å³å¯ã€‚&lt;/p>
&lt;p>&lt;strong>æ³¨æ„&lt;/strong> å¦‚æœ Docker daemon ä¸­é…ç½®äº† &lt;code>HTTP_PROXY&lt;/code> æˆ– &lt;code>HTTPS_PROXY&lt;/code> ï¼Œé‚£ä¹ˆéœ€è¦å°†åŠ é€ŸåŸŸåé…ç½®åœ¨ &lt;code>NO_PROXY&lt;/code> ä¸­ï¼Œé¿å…è¢«ä»£ç†ã€‚&lt;/p>
&lt;h2 id="æ€»ç»“">æ€»ç»“&lt;/h2>
&lt;p>æœ¬æ–‡ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨ Docker å¼€æºçš„ &lt;code>registry:2&lt;/code> æ­å»º DockerHub çš„é•œåƒåŠ é€ŸæœåŠ¡ã€‚è¿™é‡Œåªä»‹ç»äº†æœ€ç®€å•çš„é…ç½®ã€‚&lt;/p>
&lt;p>ä½†å¦‚æœåœ¨ä¼ä¸šç¯å¢ƒä¸­éƒ¨ç½²çš„è¯ï¼Œéœ€è¦æœ‰æ›´å¤šçš„é…ç½®ã€‚æ¯”å¦‚ï¼Œå¯ä»¥é€šè¿‡é…ç½® &lt;code>REGISTRY_HTTP_DEBUG_PROMETHEUS_ENABLED&lt;/code> æš´éœ² Prometheus metrics ï¼Œç”¨äºç›‘æ§æœåŠ¡å¯ç”¨æ€§åŠæŸ¥çœ‹ cache çš„æ•ˆæœï¼›å¯ä»¥å¯¹æ—¥å¿—åŠç›¸å…³å­—æ®µè¿›è¡Œé…ç½®ï¼›
ä¸ºäº†é¿å…åœ¨ 11 æœˆåï¼Œè§¦å‘åˆ° DockerHub çš„æµé‡é™åˆ¶ï¼Œå¯ä»¥æ¨ªå‘è¿›è¡Œæ‰©å®¹ï¼Œå‡†å¤‡å¤šå‡ºå£ IPï¼Œä»¥åŠé…ç½®è´¦æˆ·ç­‰ã€‚&lt;/p>
&lt;p>æœ€è¿‘æ–°å‘å¸ƒçš„ Harbor v2.1 è²Œä¼¼å¤šäº†ä¸€ä¸ª&lt;a href="https://goharbor.io/docs/2.1.0/administration/configure-proxy-cache/">ä½œä¸º &lt;code>proxy cache&lt;/code> çš„ç‰¹æ€§&lt;/a>ï¼Œä½†å®ƒä¸æœ¬æ–‡ä»‹ç»çš„ &lt;code>pull through cache&lt;/code> å¹¶ä¸ç›¸åŒï¼Œä½¿ç”¨ Harbor çš„ proxy cache ç‰¹æ€§ï¼Œéœ€è¦å°†å¾… pull çš„é•œåƒï¼Œè®¾ç½®æˆ &lt;code>&amp;lt;harbor_servername&amp;gt;/&amp;lt;proxy_project_name&amp;gt;/repo/name:tag&lt;/code> çš„å½¢å¼ï¼Œè¿™æ ·å­åªæ˜¯çœå»äº†æœ¬æ–‡ä¸€å¼€å§‹ä»‹ç»çš„é‚£ç§æ‰‹åŠ¨é‡ tag çš„æ“ä½œï¼Œä¸å¤Ÿæ–¹ä¾¿ï¼Œä½†ä¹Ÿæ˜¯ä¸ªå¾ˆä¸é”™çš„ç‰¹æ€§äº†ã€‚&lt;/p>
&lt;hr>
&lt;p>æ¬¢è¿è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://gitee.com/tlrr/awesome/raw/master/2020-9-9/1599632564572-mp-qrcode.png" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Container/">Container</category><category domain="https://moelove.info/tags/Docker/">Docker</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| Istio v1.7.1 å‘å¸ƒ</title><link>https://moelove.info/2020/09/13/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Istio-v1.7.1-%E5%8F%91%E5%B8%83/</link><guid isPermaLink="true">https://moelove.info/2020/09/13/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Istio-v1.7.1-%E5%8F%91%E5%B8%83/</guid><pubDate>Sun, 13 Sep 2020 17:08:06 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container" title="k8sç”Ÿæ€">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="istio-v171-å‘å¸ƒ">Istio v1.7.1 å‘å¸ƒ&lt;/h2>
&lt;p>è¿™æ˜¯ Istio v1.7 ç³»åˆ—çš„ç¬¬ä¸€ä¸ª patch ç‰ˆæœ¬ã€‚æ­¤æ¬¡æ›´æ–°æœ‰äº›å€¼å¾—æ³¨æ„çš„å†…å®¹ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://github.com/istio/istio/pull/26625">#26625&lt;/a> ä¿®å¤äº† &lt;code>istioctl x authz check&lt;/code> ä½¿å…¶èƒ½æ›´å¥½çš„å…¼å®¹ v1beta1 AuthorizationPolicy ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/istio/istio/issues/26617">#26617&lt;/a> ä¿®å¤äº† headless services endpoint æ›´æ–°ä¸ä¼šè§¦å‘ä»»ä½• xds pushes çš„é—®é¢˜ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/istio/istio/issues/26938">##26938&lt;/a> ä¿®å¤äº†å½“ä½¿ç”¨ &lt;code>IstioCNI&lt;/code> æ—¶ &lt;code>remove-from-mesh&lt;/code> æœªç§»é™¤ init container çš„é—®é¢˜ï¼›&lt;/li>
&lt;/ul>
&lt;h2 id="rook-v143-å‘å¸ƒ">Rook v1.4.3 å‘å¸ƒ&lt;/h2>
&lt;p>è¿™æ˜¯ä¸ª patch ç‰ˆæœ¬ï¼Œä¸»è¦ä¿®å¤äº†ä¸€äº›å’Œ Ceph æœ‰å…³çš„é—®é¢˜, ä»¥åŠå¼•å…¥äº†ä¸€äº›å°åŠŸèƒ½ï¼š&lt;/p>
&lt;p>ä¿®å¤ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://github.com/rook/rook/pull/6232">#6232&lt;/a> ç”±äº Ceph-CSI driver åœ¨æŸäº›é›†ç¾¤ä¸­ä¼šæŠŠåƒåœ¾å›æ”¶æ¸…ç†æ‰ï¼Œæ‰€ä»¥åˆ›å»º &lt;code>csidriver&lt;/code> å¯¹è±¡æ—¶ä¸å†ä¸ºå®ƒè®¾ç½® &lt;code>ownerRef&lt;/code> äº†ã€‚ä¸»è¦æ˜¯å› ä¸º &lt;code>csidriver&lt;/code> æ˜¯é›†ç¾¤çº§åˆ«çš„å¯¹è±¡ï¼Œä¸åº”è¯¥å°† namespace çº§åˆ«çš„å¯¹è±¡è®¾ç½®ä¸ºå®ƒçš„ &lt;code>ownerRef&lt;/code>ï¼›&lt;/li>
&lt;/ul>
&lt;p>ä¿®æ”¹ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://github.com/rook/rook/pull/6225">#6225&lt;/a> ä¸º OSD pod æ·»åŠ  storageClassDeviceSet æ ‡ç­¾&lt;/li>
&lt;li>&lt;a href="https://github.com/rook/rook/pull/6145">#6145&lt;/a> ä¸º Ceph é›†ç¾¤å¢åŠ  &lt;code>uninstall&lt;/code> æ¨¡å¼ï¼Œå¦‚æœ &lt;code>UninstallMode&lt;/code> CR spec è®¾ç½®ä¸º &lt;code>yes-really-uninstall-even-if-in-use&lt;/code>ï¼Œ é‚£ä¹ˆé›†ç¾¤ä¼šç›´æ¥å…¨éƒ¨åˆ é™¤ï¼Œè€Œä¸ä¼šç­‰å¾… PVC çš„ç­‰å¾…ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/rook/rook/pull/6198">##6198&lt;/a> ä»…åœ¨ Dashboard è®¾ç½®ä¸º true çš„æ—¶å€™ï¼Œæ‰ä¼šå¯åŠ¨ init å®¹å™¨ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/rook/rook/pull/6127">#6127&lt;/a> å¦‚æœä¸€ä¸ª OSD down äº†ï¼Œå¹¶ä¸”éœ€è¦ä» cluster ä¸­ç§»é™¤ï¼Œåˆ™ä¼šå¯åŠ¨ä¸€ä¸ª job å»æ¸…ç†å®ƒã€‚å¦‚æœ OSD ä»ç„¶ upï¼Œ åˆ™è¯¥ job ä¼šè¢«æ‹’ç»ï¼›&lt;/li>
&lt;/ul>
&lt;h2 id="thanos-v0150-å‘å¸ƒ">Thanos v0.15.0 å‘å¸ƒ&lt;/h2>
&lt;p>æœ¬æ¬¡æ–°å¢äº†ä¸€ä¸ªç»„ä»¶ &lt;a href="https://thanos.io/tip/components/query-frontend.md/" title="Query Frontend">Query Frontend &lt;/a> è¿™æ˜¯åŸºäº &lt;a href="https://cortexmetrics.io/docs/architecture/#query-frontend" title="Cortex Query Frontend"> Cortex Query Frontend &lt;/a> çš„ï¼Œæ‰€ä»¥å®ƒä»¬æœ‰äº›ç›¸åŒçš„ç‰¹æ€§ï¼Œæ¯”å¦‚ &lt;code>Splitting&lt;/code> å’Œ &lt;code>Results Caching&lt;/code>&lt;/p>
&lt;p>æ›´å¤šå…³äºæ­¤ç‰ˆæœ¬çš„ä¿¡æ¯ï¼Œè¯·å‚è€ƒå…¶ &lt;a href="https://github.com/thanos-io/thanos/releases/tag/v0.15.0" title="Thanos v0.15">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="ä¸Šæ¸¸è¿›å±•">ä¸Šæ¸¸è¿›å±•&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/pull/94398">#94398&lt;/a> kubeadm å°† &lt;code>kube-scheduler&lt;/code> å’Œ &lt;code>kube-controller-manager&lt;/code> çš„ kubeconfig é…ç½®æ–‡ä»¶ä¸­ API Server çš„åœ°å€æŒ‡å‘äº†æœ¬åœ°çš„ API Server åœ°å€ã€‚ä¸»è¦æ˜¯ä¸ºäº†é¿å…å‡çº§è¿‡ç¨‹ä¸­ï¼Œå½“è¿™äº›ç»„ä»¶ä¸ API Server ç‰ˆæœ¬ä¸ä¸€è‡´æ—¶ï¼Œå‘ API Server è¯·æ±‚ä¸å­˜åœ¨çš„ API åœ°å€ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/pull/94395">#94395&lt;/a> &lt;code>kubeadm upgrade&lt;/code> æ—¶ï¼Œæ— è®º etcd ç‰ˆæœ¬æ˜¯å¦æœ‰å˜åŒ–ï¼Œå°†ç¡®ä¿ etcd manifest é‡æ–°ç”Ÿæˆï¼›&lt;/li>
&lt;/ul>
&lt;hr>
&lt;p>æ¬¢è¿è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://gitee.com/tlrr/awesome/raw/master/2020-9-9/1599632564572-mp-qrcode.png" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| æ˜¯æ—¶å€™ä» k8s v1.16 å‡çº§äº†</title><link>https://moelove.info/2020/09/05/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-%E6%98%AF%E6%97%B6%E5%80%99%E4%BB%8E-k8s-v1.16-%E5%8D%87%E7%BA%A7%E4%BA%86/</link><guid isPermaLink="true">https://moelove.info/2020/09/05/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-%E6%98%AF%E6%97%B6%E5%80%99%E4%BB%8E-k8s-v1.16-%E5%8D%87%E7%BA%A7%E4%BA%86/</guid><pubDate>Sat, 05 Sep 2020 22:37:11 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container" title="k8sç”Ÿæ€">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="kubernetes-v11615-å‘å¸ƒ">Kubernetes v1.16.15 å‘å¸ƒ&lt;/h2>
&lt;p>&lt;a href="https://github.com/kubernetes/kubernetes/blob/master/CHANGELOG/CHANGELOG-1.16.md/#v11615">Kubernetes v1.16.15&lt;/a> æ˜¯ v1.16 ç³»åˆ—çš„æœ€åä¸€ä¸ªæ›´æ–°ï¼Œæˆ‘åœ¨ä¹‹å‰çš„å‘¨æŠ¥ä¸­ä¹Ÿæœ‰ä»‹ç»è¿‡ã€‚&lt;/p>
&lt;p>æ˜¯æ—¶å€™è€ƒè™‘å°† v1.16 å‡çº§è‡³æ›´é«˜ç‰ˆæœ¬äº†ï¼&lt;/p>
&lt;p>ä»¥ä¸‹ä»‹ç»ä» v1.16 å‡çº§è‡³ v1.17 éœ€è¦å…³æ³¨çš„ä¸€äº›é‡ç‚¹ã€‚&lt;/p>
&lt;h3 id="etcd">etcd&lt;/h3>
&lt;p>å°±å¤–éƒ¨ä¾èµ–è€Œè¨€ï¼Œæœ€ä¸»è¦çš„å˜åŒ–æ˜¯ etcd ä» &lt;code>v3.3.13&lt;/code> å‡çº§åˆ°äº† &lt;code>v3.4.3&lt;/code> ã€‚&lt;/p>
&lt;p>åœ¨å‡çº§ etcd å‰ï¼Œæˆ‘å»ºè®®ä½ å…ˆé˜…è¯»ä¸‹ &lt;a href="https://github.com/etcd-io/etcd/blob/master/Documentation/upgrades/upgrade_3_4.md" title="etcd å‡çº§æ–‡æ¡£">etcd çš„å‡çº§æ–‡æ¡£&lt;/a>ã€‚ æˆ‘ä»ä¸­è¯´å‡ ä¸ªé‡ç‚¹å†…å®¹ï¼š&lt;/p>
&lt;blockquote>
&lt;p>In the general case, upgrading from etcd 3.3 to 3.4 can be a zero-downtime, rolling upgrade:&lt;/p>
&lt;ul>
&lt;li>
&lt;p>one by one, stop the etcd v3.3 processes and replace them with etcd v3.4 processes&lt;/p>
&lt;/li>
&lt;li>
&lt;p>after running all v3.4 processes, new features in v3.4 are available to the cluster&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;p>è¿™æ˜¯ etcd æ–‡æ¡£ä¸­çš„å†…å®¹ï¼Œçœ‹èµ·æ¥æ˜¯å¾ˆå®‰å…¨çš„ã€‚&lt;/p>
&lt;p>ä½†ä¹Ÿæœ‰ä¸€äº›éå¸¸å…³é”®çš„ä¿¡æ¯å€¼å¾—æ³¨æ„ï¼Œ ä¸»è¦æ˜¯ç ´åæ€§å˜æ›´ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;code>ETCDCTL_API=3 etcdctl&lt;/code> æˆä¸ºé»˜è®¤ï¼›&lt;/li>
&lt;li>&lt;code>etcd --enable-v2=false&lt;/code> é»˜è®¤å…³æ‰äº† v2 æ”¯æŒï¼›&lt;/li>
&lt;li>&lt;code>etcd --ca-file&lt;/code> å’Œ &lt;code>etcd --peer-ca-file&lt;/code> å·²è¿‡æœŸï¼›&lt;/li>
&lt;/ul>
&lt;p>æ•´ä½“è€Œè¨€æ¶‰åŠåˆ°çš„å†…å®¹å°±æ˜¯ &lt;code>etcd v2 API&lt;/code> äº†ã€‚&lt;/p>
&lt;p>å‡å¦‚ä½ ä½¿ç”¨çš„ CNI æ˜¯ Flannel çš„è¯ï¼Œä½ éœ€è¦æ³¨æ„ &lt;a href="https://github.com/coreos/flannel/issues/1191" title="Flannel ä¸æ”¯æŒ etcd v3 API">Flannel ç›®å‰è¿˜ä¸æ”¯æŒä½¿ç”¨ etcd v3 API&lt;/a> ï¼Œ éœ€è¦è‡ªè¡Œè®¾ç½® &lt;code>--enable-v2&lt;/code> ã€‚&lt;/p>
&lt;h2 id="kube-apiserver">kube-apiserver&lt;/h2>
&lt;p>&lt;a href="https://github.com/kubernetes/kubernetes/pull/81668">é»˜è®¤çš„ service IP CIDR 10.0.0.0/24 &lt;/a> å·²ç»è¿‡æœŸï¼Œå¹¶å°†åœ¨ä¹‹åç‰ˆæœ¬åˆ é™¤ï¼Œæ‰€ä»¥éœ€è¦æ³¨æ„ç»™ kube-apiserver è®¾ç½® &lt;code>--service-cluster-ip-range&lt;/code> é€‰é¡¹ï¼Œä»¥å…åœ¨ä¹‹åå‡çº§æ—¶å‘ç”Ÿé—®é¢˜ã€‚&lt;/p>
&lt;h2 id="kubelet--csi">kubelet &amp;amp; CSI&lt;/h2>
&lt;p>å¦‚æœä½ çš„æŸä¸ªèŠ‚ç‚¹ä½¿ç”¨äº† CSI raw block volume ï¼Œé‚£ä¹ˆåœ¨å‡çº§ kubelet å‰ï¼Œ &lt;strong>å¿…é¡»&lt;/strong> &lt;code>kubectl drain node-x&lt;/code> ä»¥é¿å…é‡åˆ°&lt;a href="https://github.com/kubernetes/kubernetes/pull/74026" title="kubelet &amp;amp; CSI v1.17">é—®é¢˜&lt;/a>&lt;/p>
&lt;p>æœ€å€¼å¾—å…³æ³¨çš„é—®é¢˜ä¸»è¦å°±è¿™äº›ï¼Œç¥ä½ å‡çº§é¡ºåˆ© :)&lt;/p>
&lt;h2 id="rook-v142-å‘å¸ƒ">Rook v1.4.2 å‘å¸ƒ&lt;/h2>
&lt;p>Rook æœ¬æ¬¡å‘å¸ƒçš„ v1.4.2 ç‰ˆæœ¬ï¼Œä¸»è¦é›†ä¸­åœ¨å¯¹ Ceph ç›¸å…³å†…å®¹çš„æ”¹è¿›ã€‚æˆ‘ä»¬æ¥çœ‹çœ‹æœ‰å“ªäº›å€¼å¾—å…³æ³¨çš„å†…å®¹å§ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://github.com/rook/rook/pull/6118">#6118&lt;/a> ä¸º OSD prepare åšäº†èµ„æºé™åˆ¶ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/rook/rook/pull/6170">#6170&lt;/a> ä¸ºæ‰€æœ‰å¯¹è±¡å­˜å‚¨çš„ debug ä¿¡æ¯å¢åŠ äº†å®Œæ•´çš„ DNS åç¼€ï¼Œæ¯”å¦‚ï¼ˆ&lt;code>.svc.cluster.local&lt;/code>ï¼‰;&lt;/li>
&lt;/ul>
&lt;p>æ›´å¤šå…³äºæ­¤ç‰ˆæœ¬çš„å˜æ›´è¯·å‚è€ƒå…¶ &lt;a href="https://github.com/rook/rook/releases/tag/v1.4.2">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="cilium-v183-å‘å¸ƒ">Cilium v1.8.3 å‘å¸ƒ&lt;/h2>
&lt;p>å…³äº Cilium çš„ä»‹ç»å¯å‚è€ƒæˆ‘çš„ä¸Šä¸€ç¯‡æ–‡ç«  &lt;a href="https://zhuanlan.zhihu.com/p/213745089">Cilium ä¸Šæ‰‹å®è·µ&lt;/a> ï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°äº†ã€‚&lt;/p>
&lt;p>æœ¬å‘¨ Cilium å‘å¸ƒäº† v1.8.3 ç‰ˆæœ¬ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹æœ‰å“ªäº›å€¼å¾—æ³¨æ„çš„å˜æ›´å§ï¼š&lt;/p>
&lt;ul>
&lt;li>ä¸º &lt;a href="https://github.com/cilium/cilium/pull/12409" title="Cilium operator HA mode">Cilium operator å¢åŠ äº† HA æ¨¡å¼&lt;/a> ï¼Œ ä½†æ˜¯è¦æ³¨æ„çš„æ˜¯ &lt;strong>HA æ¨¡å¼ç”±äºä½¿ç”¨äº† coordination.k8s.io/v1 API æ‰€ä»¥ä¸æ”¯æŒ Kubernetes v1.14 ä¹‹å‰ç‰ˆæœ¬çš„ K8S&lt;/strong> ï¼›&lt;/li>
&lt;li>Hubble/relay: åœ¨ ServerStatus ä¼šæŠ¥å‘Š Node è¿æ¥çŠ¶æ€äº†ï¼›&lt;/li>
&lt;/ul>
&lt;p>æ›´å¤šå…³äºæ­¤ç‰ˆæœ¬çš„å˜æ›´ï¼Œè¯·å‚è€ƒå…¶ &lt;a href="https://github.com/cilium/cilium/releases/tag/v1.8.3" title="Cilium v1.8.3 ReleaseNote">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="ä¸Šæ¸¸è¿›å±•">ä¸Šæ¸¸è¿›å±•&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/pull/93548">#93548&lt;/a> &lt;code>kubectl&lt;/code> path å¢åŠ äº†ä¸€ä¸ª &lt;code>--patch-file&lt;/code> çš„é€‰é¡¹ï¼Œå…è®¸ä½¿ç”¨ patch æ–‡ä»¶ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/pull/94309">#94309&lt;/a> &lt;code>kubectl get ingress&lt;/code> é»˜è®¤å°†ä½¿ç”¨ &lt;code>networking.k8s.io/v1&lt;/code> API è€Œä¸æ˜¯ä¹‹å‰çš„ &lt;code>extensions/v1beta1&lt;/code> ï¼›&lt;/li>
&lt;/ul>
&lt;hr>
&lt;p>æ¬¢è¿è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://gitee.com/tlrr/awesome/raw/master/2020-9-9/1599632564572-mp-qrcode.png" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>è¢« Google é€‰æ‹©çš„ä¸‹ä¸€ä»£æ•°æ®é¢ Cilium æ˜¯ä»€ä¹ˆ</title><link>https://moelove.info/2020/09/02/%E8%A2%AB-Google-%E9%80%89%E6%8B%A9%E7%9A%84%E4%B8%8B%E4%B8%80%E4%BB%A3%E6%95%B0%E6%8D%AE%E9%9D%A2-Cilium-%E6%98%AF%E4%BB%80%E4%B9%88/</link><guid isPermaLink="true">https://moelove.info/2020/09/02/%E8%A2%AB-Google-%E9%80%89%E6%8B%A9%E7%9A%84%E4%B8%8B%E4%B8%80%E4%BB%A3%E6%95%B0%E6%8D%AE%E9%9D%A2-Cilium-%E6%98%AF%E4%BB%80%E4%B9%88/</guid><pubDate>Wed, 02 Sep 2020 10:51:21 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;h2 id="èƒŒæ™¯">èƒŒæ™¯&lt;/h2>
&lt;p>åœ¨æˆ‘ä¹‹å‰çš„æ–‡ç«  &lt;a href="https://zhuanlan.zhihu.com/p/195759300" title="Google é€‰æ‹© Cilium ä½œä¸º GKE ä¸‹ä¸€ä»£æ•°æ®é¢">K8S ç”Ÿæ€å‘¨æŠ¥| Google é€‰æ‹© Cilium ä½œä¸º GKE ä¸‹ä¸€ä»£æ•°æ®é¢&lt;/a> ä¸€æ–‡ä¸­ï¼Œæˆ‘ä»‹ç»äº† Google å®£å¸ƒä½¿ç”¨ Cilium ä½œä¸º GKE çš„ä¸‹ä¸€ä»£æ•°æ®é¢ï¼ŒåŠå…¶èƒŒåçš„æ•…äº‹ã€‚&lt;/p>
&lt;p>Google é€‰æ‹© Cilium ä¸»è¦æ˜¯ä¸ºäº†å¢åŠ  GKE å¹³å°çš„å®¹å™¨å®‰å…¨æ€§å’Œå¯è§‚æµ‹æ€§ã€‚é‚£ä¹ˆï¼ŒCilium åˆ°åº•æ˜¯ä»€ä¹ˆï¼Œä¸ºä»€ä¹ˆä¼šæœ‰è¿™ä¹ˆå¼ºçš„å¸å¼•åŠ›å‘¢ï¼Ÿ&lt;/p>
&lt;p>æ‘˜ä¸€æ®µå®˜ç½‘çš„ä»‹ç»ï¼š&lt;/p>
&lt;blockquote>
&lt;p>Cilium is open source software for transparently securing the network connectivity between application services deployed using Linux container management platforms like Docker and Kubernetes.&lt;/p>
&lt;/blockquote>
&lt;p>Cilium æ˜¯ä¸€ä¸ªç”¨äºé€æ˜ä¿æŠ¤éƒ¨ç½²åœ¨ Linux å®¹å™¨ç®¡ç†å¹³å°ï¼ˆæ¯”å¦‚ Docker å’Œ Kubernetesï¼‰ä¸Šçš„åº”ç”¨æœåŠ¡ä¹‹é—´ç½‘ç»œè¿æ¥çš„å¼€æºè½¯ä»¶ã€‚&lt;/p>
&lt;p>ä¸ºä»€ä¹ˆç€é‡å¼ºè°ƒæ˜¯ â€œLinux å®¹å™¨ç®¡ç†å¹³å°â€ å‘¢ï¼Ÿè¿™å°±ä¸å¾—ä¸æåˆ° Cilium çš„å®ç°äº†ã€‚Cilium çš„åŸºç¡€æ˜¯ä¸€ç§ç§°ä¸º eBPF çš„ Linux å†…æ ¸æŠ€æœ¯ï¼Œä½¿ç”¨ eBPF å¯ä»¥åœ¨ Linux è‡ªèº«å†…éƒ¨åŠ¨æ€çš„æ’å…¥ä¸€äº›æ§åˆ¶é€»è¾‘ï¼Œä»è€Œæ»¡è¶³å¯è§‚å¯Ÿæ€§å’Œå®‰å…¨æ€§ç›¸å…³çš„éœ€æ±‚ã€‚&lt;/p>
&lt;p>åªè°ˆæ¦‚å¿µæ¯•ç«Ÿè¿‡äºç©ºæ´ï¼Œæœ¬èŠ‚æˆ‘ä»¬ç›´æ¥ä¸Šæ‰‹å®è·µä¸€ä¸‹ Cilium ã€‚&lt;/p>
&lt;h2 id="å‡†å¤‡é›†ç¾¤">å‡†å¤‡é›†ç¾¤&lt;/h2>
&lt;p>è¿™é‡Œæˆ‘ä½¿ç”¨ &lt;a href="https://kind.sigs.k8s.io/" title="Kubernetes IN Docker">KIND&lt;/a> æ¥åˆ›å»ºä¸€å¥—å¤šèŠ‚ç‚¹çš„æœ¬åœ°é›†ç¾¤ã€‚&lt;/p>
&lt;h3 id="å†™é…ç½®æ–‡ä»¶">å†™é…ç½®æ–‡ä»¶&lt;/h3>
&lt;p>åœ¨åˆ›å»ºé›†ç¾¤æ—¶å€™ï¼Œé€šè¿‡é…ç½®æ–‡ä»¶æ¥ç¦ç”¨æ‰ KIND é»˜è®¤çš„ CNI æ’ä»¶ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Cluster&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">kind.x-k8s.io/v1alpha4&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">nodes&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>- &lt;span class="nt">role&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">control-plane&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>- &lt;span class="nt">role&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">worker&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>- &lt;span class="nt">role&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">worker&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>- &lt;span class="nt">role&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">worker&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">networking&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">disableDefaultCNI&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="å¯åŠ¨é›†ç¾¤">å¯åŠ¨é›†ç¾¤&lt;/h3>
&lt;p>å°†é…ç½®æ–‡ä»¶å‘½åä¸º &lt;code>kindconfig&lt;/code> ï¼Œé€šè¿‡ &lt;code>--config&lt;/code> å‚æ•°æ¥æŒ‡å®šå®ƒã€‚ é€šè¿‡ &lt;code>--image&lt;/code> å‚æ•°å¯æŒ‡å®šåˆ›å»ºé›†ç¾¤æ‰€ä½¿ç”¨çš„é•œåƒï¼Œè¿™é‡Œæˆ‘ä½¿ç”¨ &lt;code>kindest/node:v1.19.0@sha256:6a6e4d588db3c2873652f382465eeadc2644562a64659a1da4&lt;/code> æ¥åˆ›å»ºä¸€ä¸ªæœ€æ–°çš„ Kubernetes v1.19.0 ç‰ˆæœ¬çš„é›†ç¾¤ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ ~ kind create cluster --config&lt;span class="o">=&lt;/span>kindconfig --image&lt;span class="o">=&lt;/span>kindest/node:v1.19.0@sha256:6a6e4d588db3c2873652f382465eeadc2644562a64659a1da4
db73d3beaa8848
Creating cluster &lt;span class="s2">&amp;#34;kind&amp;#34;&lt;/span> ...
âœ“ Ensuring node image &lt;span class="o">(&lt;/span>kindest/node:v1.19.0&lt;span class="o">)&lt;/span> ğŸ–¼
âœ“ Preparing nodes ğŸ“¦ ğŸ“¦ ğŸ“¦ ğŸ“¦
âœ“ Writing configuration ğŸ“œ
âœ“ Starting control-plane ğŸ•¹ï¸
âœ“ Installing StorageClass ğŸ’¾
âœ“ Joining worker nodes ğŸšœ
Set kubectl context to &lt;span class="s2">&amp;#34;kind-kind&amp;#34;&lt;/span>
You can now use your cluster with:
kubectl cluster-info --context kind-kind
Have a question, bug, or feature request? Let us know! https://kind.sigs.k8s.io/#community ğŸ™‚
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="æŸ¥çœ‹çŠ¶æ€">æŸ¥çœ‹çŠ¶æ€&lt;/h3>
&lt;p>ç”±äºæˆ‘ä»¬å·²ç»ç¦ç”¨äº† KIND é»˜è®¤çš„ CNI ï¼Œæ‰€ä»¥ç°åœ¨é›†ç¾¤çš„ Node éƒ½æ˜¯ &lt;code>NotReady&lt;/code> çš„çŠ¶æ€ï¼Œç­‰å¾… CNI çš„åˆå§‹åŒ–ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ ~ kubectl get nodes
NAME STATUS ROLES AGE VERSION
kind-control-plane NotReady master 85s v1.19.0
kind-worker NotReady &amp;lt;none&amp;gt; 49s v1.19.0
kind-worker2 NotReady &amp;lt;none&amp;gt; 49s v1.19.0
kind-worker3 NotReady &amp;lt;none&amp;gt; 49s v1.19.0
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="éƒ¨ç½²-cilium">éƒ¨ç½² Cilium&lt;/h2>
&lt;p>éƒ¨ç½² Cilium å¯ä»¥æœ‰å¤šç§æ–¹å¼ï¼Œè¿™é‡Œæˆ‘ä»¬é€‰æ‹©æœ€ç®€å•çš„ï¼Œç›´æ¥ä½¿ç”¨ Helm 3 è¿›è¡Œéƒ¨ç½²ã€‚&lt;/p>
&lt;h3 id="æ·»åŠ -helm-ä»“åº“">æ·»åŠ  Helm ä»“åº“&lt;/h3>
&lt;p>Cilium æä¾›äº†å®˜æ–¹ç»´æŠ¤çš„ Helm ä»“åº“ï¼Œæˆ‘ä»¬å…ˆæ¥æ·»åŠ å®ƒã€‚&lt;/p>
&lt;p>æ³¨æ„ï¼š &lt;strong>è¯·ä½¿ç”¨ Helm 3&lt;/strong>ã€‚ åœ¨ä¹‹å‰çš„æ–‡ç«  &lt;a href="https://zhuanlan.zhihu.com/p/186265631" title="Helm v2 è¿›å…¥ç»´æŠ¤æœŸå€’è®¡æ—¶">K8S ç”Ÿæ€å‘¨æŠ¥| Helm v2 è¿›å…¥ç»´æŠ¤æœŸå€’è®¡æ—¶&lt;/a> ä¸­ï¼Œæˆ‘æ›¾ä»‹ç»è¿‡ Helm v2 çš„ç»´æŠ¤æœŸå·²ç»è¿›å…¥å€’è®¡æ—¶ï¼Œä¸‰ä¸ªæœˆåå°†åœæ­¢ä¸º Helm v2 æä¾›å®‰å…¨è¡¥ä¸ï¼Œå±Šæ—¶ Helm v2 çš„ç»´æŠ¤æœŸå°±å½»åº•ç»ˆæ­¢äº†ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ ~ helm repo add cilium https://helm.cilium.io/
&lt;span class="s2">&amp;#34;cilium&amp;#34;&lt;/span> has been added to your repositories
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="é¢„åŠ è½½é•œåƒ">é¢„åŠ è½½é•œåƒ&lt;/h3>
&lt;p>&lt;strong>è¿™ä¸€æ­¥å¹¶éå¿…é¡»&lt;/strong>ã€‚ åªæ˜¯ç”±äºæ¯ä¸ªåœ¨ Node ä¸Šéƒ½éœ€è¦ä¸‹è½½ &lt;code>cilium/cilium:v1.8.2&lt;/code> çš„é•œåƒï¼Œä¼šå¾ˆè€—æ—¶ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨ &lt;code>kind load docker-image&lt;/code> å°†ä¸»æœº Docker ä¸­çš„é•œåƒåŠ è½½åˆ° KIND åˆ›å»ºçš„é›†ç¾¤ä¸­ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="c1"># ä¸‹è½½é•œåƒ&lt;/span>
&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ ~ docker pull cilium/cilium:v1.8.2
v1.8.2: Pulling from cilium/cilium
Digest: sha256:9dffe79408025f7523a94a1828ac1691b997a2b1dbd69af338cfbecc8428d326
Status: Image is up to date &lt;span class="k">for&lt;/span> cilium/cilium:v1.8.2
docker.io/cilium/cilium:v1.8.2
&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="c1"># å°†é•œåƒåŠ è½½åˆ° KIND é›†ç¾¤ä¸­&lt;/span>
&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ ~ kind load docker-image cilium/cilium:v1.8.2
Image: &lt;span class="s2">&amp;#34;cilium/cilium:v1.8.2&amp;#34;&lt;/span> with ID &lt;span class="s2">&amp;#34;sha256:009715be68951ab107617f04dc50bcceb3d3f1e0c09db156aacf95e56eb0d5cc&amp;#34;&lt;/span> not yet present on node &lt;span class="s2">&amp;#34;kind-worker3&amp;#34;&lt;/span>, loading...
Image: &lt;span class="s2">&amp;#34;cilium/cilium:v1.8.2&amp;#34;&lt;/span> with ID &lt;span class="s2">&amp;#34;sha256:009715be68951ab107617f04dc50bcceb3d3f1e0c09db156aacf95e56eb0d5cc&amp;#34;&lt;/span> not yet present on node &lt;span class="s2">&amp;#34;kind-control-plane&amp;#34;&lt;/span>, loading...
Image: &lt;span class="s2">&amp;#34;cilium/cilium:v1.8.2&amp;#34;&lt;/span> with ID &lt;span class="s2">&amp;#34;sha256:009715be68951ab107617f04dc50bcceb3d3f1e0c09db156aacf95e56eb0d5cc&amp;#34;&lt;/span> not yet present on node &lt;span class="s2">&amp;#34;kind-worker&amp;#34;&lt;/span>, loading...
Image: &lt;span class="s2">&amp;#34;cilium/cilium:v1.8.2&amp;#34;&lt;/span> with ID &lt;span class="s2">&amp;#34;sha256:009715be68951ab107617f04dc50bcceb3d3f1e0c09db156aacf95e56eb0d5cc&amp;#34;&lt;/span> not yet present on node &lt;span class="s2">&amp;#34;kind-worker2&amp;#34;&lt;/span>, loading...
&lt;/code>&lt;/pre>&lt;/div>&lt;p>é•œåƒåŠ è½½å®Œæˆåï¼Œå¯ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤è¿›è¡ŒäºŒæ¬¡ç¡®è®¤ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="k">for&lt;/span> i in &lt;span class="sb">`&lt;/span>docker ps --filter &lt;span class="nv">label&lt;/span>&lt;span class="o">=&lt;/span>io.x-k8s.kind.cluster&lt;span class="o">=&lt;/span>kind -q&lt;span class="sb">`&lt;/span>
&lt;span class="k">do&lt;/span>
docker &lt;span class="nb">exec&lt;/span> &lt;span class="nv">$i&lt;/span> ctr -n k8s.io -a /run/containerd/containerd.sock i ls &lt;span class="p">|&lt;/span>grep cilium
&lt;span class="k">done&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="ä½¿ç”¨-helm-éƒ¨ç½²-cilium">ä½¿ç”¨ Helm éƒ¨ç½² Cilium&lt;/h3>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ ~ helm install cilium cilium/cilium --version 1.8.2 &lt;span class="se">\
&lt;/span>&lt;span class="se">&lt;/span> --namespace kube-system &lt;span class="se">\
&lt;/span>&lt;span class="se">&lt;/span> --set global.nodeinit.enabled&lt;span class="o">=&lt;/span>&lt;span class="nb">true&lt;/span> &lt;span class="se">\
&lt;/span>&lt;span class="se">&lt;/span> --set global.kubeProxyReplacement&lt;span class="o">=&lt;/span>partial &lt;span class="se">\
&lt;/span>&lt;span class="se">&lt;/span> --set global.hostServices.enabled&lt;span class="o">=&lt;/span>&lt;span class="nb">false&lt;/span> &lt;span class="se">\
&lt;/span>&lt;span class="se">&lt;/span> --set global.externalIPs.enabled&lt;span class="o">=&lt;/span>&lt;span class="nb">true&lt;/span> &lt;span class="se">\
&lt;/span>&lt;span class="se">&lt;/span> --set global.nodePort.enabled&lt;span class="o">=&lt;/span>&lt;span class="nb">true&lt;/span> &lt;span class="se">\
&lt;/span>&lt;span class="se">&lt;/span> --set global.hostPort.enabled&lt;span class="o">=&lt;/span>&lt;span class="nb">true&lt;/span> &lt;span class="se">\
&lt;/span>&lt;span class="se">&lt;/span> --set global.pullPolicy&lt;span class="o">=&lt;/span>IfNotPresent &lt;span class="se">\
&lt;/span>&lt;span class="se">&lt;/span> --set config.ipam&lt;span class="o">=&lt;/span>kubernetes &lt;span class="se">\
&lt;/span>&lt;span class="se">&lt;/span> --set global.hubble.enabled&lt;span class="o">=&lt;/span>&lt;span class="nb">true&lt;/span> &lt;span class="se">\
&lt;/span>&lt;span class="se">&lt;/span> --set global.hubble.relay.enabled&lt;span class="o">=&lt;/span>&lt;span class="nb">true&lt;/span> &lt;span class="se">\
&lt;/span>&lt;span class="se">&lt;/span> --set global.hubble.ui.enabled&lt;span class="o">=&lt;/span>&lt;span class="nb">true&lt;/span> &lt;span class="se">\
&lt;/span>&lt;span class="se">&lt;/span> --set global.hubble.metrics.enabled&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;{dns,drop,tcp,flow,port-distribution,icmp,http}&amp;#34;&lt;/span>
NAME: cilium
LAST DEPLOYED: Wed Sep &lt;span class="m">2&lt;/span> 21:03:23 &lt;span class="m">2020&lt;/span>
NAMESPACE: kube-system
STATUS: deployed
REVISION: &lt;span class="m">1&lt;/span>
TEST SUITE: None
NOTES:
You have successfully installed Cilium with Hubble Relay and Hubble UI.
Your release version is 1.8.2.
For any further help, visit https://docs.cilium.io/en/v1.8/gettinghelp
&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™é‡Œå¯¹å‡ ä¸ªé…ç½®é¡¹åšä¸‹è¯´æ˜ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;code>global.hubble.enabled=true&lt;/code> ï¼š è¡¨ç¤ºå¯ç”¨ Hubble ã€‚&lt;/li>
&lt;li>&lt;code>global.hubble.metrics.enabled=&amp;quot;{dns,drop,tcp,flow,port-distribution,icmp,http}&lt;/code>ï¼šè¡¨ç¤º Hubble æš´éœ²å‡ºçš„ metrics ä¸­åŒ…å«å“ªäº›å†…å®¹ï¼Œå¦‚æœä¸æŒ‡å®šåˆ™è¡¨ç¤ºç¦ç”¨å®ƒã€‚&lt;/li>
&lt;li>&lt;code>global.hubble.ui.enabled=true&lt;/code> ï¼šè¡¨ç¤ºå¯ç”¨ Hubble UI&lt;/li>
&lt;/ul>
&lt;p>å¯¹äº Hubble æ˜¯ä»€ä¹ˆï¼Œæˆ‘ä»¬ç¨åå†ä»‹ç»ã€‚&lt;/p>
&lt;p>å½“ Cilium éƒ¨ç½²å®Œæˆåï¼Œæˆ‘ä»¬å¯ä»¥æŸ¥çœ‹ä¸‹éƒ¨ç½²çš„ ns ä¸‹çš„ Pod æƒ…å†µï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ ~ kubectl -n kube-system get pods
NAME READY STATUS RESTARTS AGE
cilium-86dbc 1/1 Running &lt;span class="m">0&lt;/span> 2m11s
cilium-cjcps 1/1 Running &lt;span class="m">0&lt;/span> 2m11s
cilium-f8dtm 1/1 Running &lt;span class="m">0&lt;/span> 2m11s
cilium-node-init-9r9cm 1/1 Running &lt;span class="m">1&lt;/span> 2m11s
cilium-node-init-bkg28 1/1 Running &lt;span class="m">1&lt;/span> 2m11s
cilium-node-init-jgx6r 1/1 Running &lt;span class="m">1&lt;/span> 2m11s
cilium-node-init-s7xhx 1/1 Running &lt;span class="m">1&lt;/span> 2m11s
cilium-operator-756cc96896-brlrh 1/1 Running &lt;span class="m">0&lt;/span> 2m11s
cilium-t8kqc 1/1 Running &lt;span class="m">0&lt;/span> 2m11s
coredns-f9fd979d6-7vfnq 1/1 Running &lt;span class="m">0&lt;/span> 6m16s
coredns-f9fd979d6-h7rfw 1/1 Running &lt;span class="m">0&lt;/span> 6m16s
etcd-kind-control-plane 1/1 Running &lt;span class="m">0&lt;/span> 6m19s
hubble-relay-666ddfd69b-2lpsz 1/1 Running &lt;span class="m">0&lt;/span> 2m11s
hubble-ui-7854cf65dc-ncj89 1/1 Running &lt;span class="m">0&lt;/span> 2m11s
kube-apiserver-kind-control-plane 1/1 Running &lt;span class="m">0&lt;/span> 6m19s
kube-controller-manager-kind-control-plane 1/1 Running &lt;span class="m">0&lt;/span> 6m19s
kube-proxy-48rwk 1/1 Running &lt;span class="m">0&lt;/span> 6m16s
kube-proxy-8mn58 1/1 Running &lt;span class="m">0&lt;/span> 5m59s
kube-proxy-jptln 1/1 Running &lt;span class="m">0&lt;/span> 5m59s
kube-proxy-pp24h 1/1 Running &lt;span class="m">0&lt;/span> 5m59s
kube-scheduler-kind-control-plane 1/1 Running &lt;span class="m">0&lt;/span> 6m19s
&lt;/code>&lt;/pre>&lt;/div>&lt;p>æŸ¥çœ‹ Node çš„çŠ¶æ€ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ ~ kubectl get nodes
NAME STATUS ROLES AGE VERSION
kind-control-plane Ready master 7m1s v1.19.0
kind-worker Ready &amp;lt;none&amp;gt; 6m26s v1.19.0
kind-worker2 Ready &amp;lt;none&amp;gt; 6m26s v1.19.0
kind-worker3 Ready &amp;lt;none&amp;gt; 6m26s v1.19.0
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="cilium-åŠŸèƒ½ä½“éªŒ">Cilium åŠŸèƒ½ä½“éªŒ&lt;/h2>
&lt;h3 id="hubble-ä»‹ç»">Hubble ä»‹ç»&lt;/h3>
&lt;p>ä¸Šæ–‡ä¸­ï¼Œé€šè¿‡ Helm éƒ¨ç½² Cilium æ—¶ï¼Œæˆ‘ä»¬æŒ‡å®šäº†ä¸€äº›ä¸ Hubble æœ‰å…³çš„å‚æ•°ï¼Œä½†å°šæœªä»‹ç» Hubble å…·ä½“æ˜¯ä»€ä¹ˆã€‚è¿™é‡Œç®€å•ä»‹ç»ä¸‹ã€‚&lt;/p>
&lt;p>Hubble æ˜¯ä¸€ä¸ªå®Œå…¨åˆ†å¸ƒå¼çš„ç½‘ç»œå’Œå®‰å…¨æ€§çš„å¯è§‚å¯Ÿæ€§å¹³å°ï¼Œå®ƒå»ºç«‹åœ¨ Cilium å’Œ eBPF ä¹‹ä¸Šï¼Œä»¥å®Œå…¨é€æ˜çš„æ–¹å¼æ·±å…¥äº†è§£æœåŠ¡ä»¥åŠç½‘ç»œåŸºç¡€ç»“æ„çš„é€šä¿¡å’Œè¡Œä¸ºã€‚&lt;/p>
&lt;p>ç”±äºå®ƒæ˜¯æ„å»ºåœ¨ Cilium ä¹‹ä¸Šçš„ï¼ŒHubble å¯ä»¥åˆ©ç”¨ eBPF è·å¾—å¯è§æ€§ã€‚é€šè¿‡ä½¿ç”¨ eBPF ï¼Œæ‰€æœ‰å¯è§æ€§éƒ½æ˜¯å¯ç¼–ç¨‹çš„ï¼Œå¹¶ä¸”å¯ä»¥æœ€å¤§ç¨‹åº¦çš„å‡å°‘å¼€é”€ï¼ŒåŒæ—¶æ ¹æ®ç”¨æˆ·éœ€è¦æä¾›æ·±å…¥å’Œè¯¦å°½çš„å¯è§æ€§ã€‚ä¾‹å¦‚ï¼š&lt;/p>
&lt;ul>
&lt;li>äº†è§£æœåŠ¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚å¯ä»¥è§‚æµ‹åˆ°æœåŠ¡ä¹‹é—´æ˜¯å¦æœ‰é€šä¿¡ï¼Œé€šä¿¡é¢‘ç‡ï¼Œä»¥åŠ HTTP è°ƒç”¨äº§ç”Ÿçš„çŠ¶æ€ç ç­‰ï¼›&lt;/li>
&lt;li>ç›‘æ§ç½‘ç»œå’Œå‘Šè­¦ã€‚å¯ä»¥è§‚æµ‹åˆ°ç½‘ç»œè¿æ¥æ˜¯å¦å¼‚å¸¸ï¼Œæ˜¯ L4 è¿˜æ˜¯ L7 æœ‰é—®é¢˜ï¼ŒDNS æŸ¥è¯¢æ˜¯å¦å¼‚å¸¸ç­‰ï¼›&lt;/li>
&lt;li>ç›‘æ§åº”ç”¨ç¨‹åºã€‚å¯ä»¥è§‚æµ‹åˆ° HTTP 4xx/5xx çš„é”™è¯¯ç‡ï¼ŒHTTP è¯·æ±‚å’Œå“åº”çš„ 95 å€¼ï¼Œ99å€¼ç­‰ï¼›&lt;/li>
&lt;li>ç›‘æ§å®‰å…¨é—®é¢˜ã€‚å¯ä»¥è§‚æµ‹åˆ°å“ªäº›è¯·æ±‚æ˜¯è¢« Network Policy æ‰€æ‹’ç»çš„ï¼Œå“ªäº›æœåŠ¡è§£æäº†ç‰¹å®šçš„åŸŸåç­‰ï¼›&lt;/li>
&lt;/ul>
&lt;h3 id="å¯è§‚å¯Ÿæ€§">å¯è§‚å¯Ÿæ€§&lt;/h3>
&lt;p>æˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨ &lt;code>hubble observe&lt;/code> è§‚æµ‹å½“å‰é›†ç¾¤ä¸­çš„è¿æ¥æƒ…å†µï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ hubble-ui git:&lt;span class="o">(&lt;/span>master&lt;span class="o">)&lt;/span> kubectl &lt;span class="nb">exec&lt;/span> -n kube-system -t ds/cilium -- hubble observe
TIMESTAMP SOURCE DESTINATION TYPE VERDICT SUMMARY
Sep &lt;span class="m">2&lt;/span> 07:06:41.624 kube-system/coredns-f9fd979d6-h7rfw:8181 10.244.1.50:52404 to-stack FORWARDED TCP Flags: ACK, FIN
Sep &lt;span class="m">2&lt;/span> 07:06:41.625 10.244.1.50:52404 kube-system/coredns-f9fd979d6-h7rfw:8181 to-endpoint FORWARDED TCP Flags: ACK, FIN
Sep &lt;span class="m">2&lt;/span> 07:06:42.376 10.244.1.12:4240 10.244.0.76:45164 to-overlay FORWARDED TCP Flags: ACK
Sep &lt;span class="m">2&lt;/span> 07:06:42.376 10.244.0.76:45164 10.244.1.12:4240 to-endpoint FORWARDED TCP Flags: ACK
Sep &lt;span class="m">2&lt;/span> 07:06:42.778 10.244.1.50:37512 10.244.1.12:4240 to-endpoint FORWARDED TCP Flags: ACK, PSH
Sep &lt;span class="m">2&lt;/span> 07:06:42.778 10.244.1.12:4240 10.244.1.50:37512 to-stack FORWARDED TCP Flags: ACK, PSH
Sep &lt;span class="m">2&lt;/span> 07:06:44.941 10.244.1.50:59870 10.244.0.108:4240 to-overlay FORWARDED TCP Flags: ACK
Sep &lt;span class="m">2&lt;/span> 07:06:44.941 10.244.1.12:4240 10.244.2.220:47616 to-overlay FORWARDED TCP Fla
gs: ACK
Sep &lt;span class="m">2&lt;/span> 07:06:44.941 10.244.1.50:52090 10.244.3.159:4240 to-overlay FORWARDED TCP Fla
gs: ACK
Sep &lt;span class="m">2&lt;/span> 07:06:44.941 10.244.1.50:52958 10.244.2.81:4240 to-overlay FORWARDED TCP Fla
gs: ACK
Sep &lt;span class="m">2&lt;/span> 07:06:44.941 10.244.2.220:47616 10.244.1.12:4240 to-endpoint FORWARDED TCP Fla
gs: ACK
Sep &lt;span class="m">2&lt;/span> 07:06:45.448 10.244.1.12:4240 10.244.3.111:54012 to-overlay FORWARDED TCP Fla
gs: ACK
Sep &lt;span class="m">2&lt;/span> 07:06:45.449 10.244.3.111:54012 10.244.1.12:4240 to-endpoint FORWARDED TCP Fla
gs: ACK
Sep &lt;span class="m">2&lt;/span> 07:06:47.631 kube-system/coredns-f9fd979d6-h7rfw:36120 172.18.0.4:6443 to-stack FORWARDED TCP Fla
gs: ACK
Sep &lt;span class="m">2&lt;/span> 07:06:47.822 10.244.1.50:60914 kube-system/coredns-f9fd979d6-h7rfw:8080 to-endpoint FORWARDED TCP Fla
gs: SYN
Sep &lt;span class="m">2&lt;/span> 07:06:47.822 kube-system/coredns-f9fd979d6-h7rfw:8080 10.244.1.50:60914 to-stack FORWARDED TCP Fla
gs: SYN, ACK
Sep &lt;span class="m">2&lt;/span> 07:06:47.822 10.244.1.50:60914 kube-system/coredns-f9fd979d6-h7rfw:8080 to-endpoint FORWARDED TCP Fla
gs: ACK
Sep &lt;span class="m">2&lt;/span> 07:06:47.823 kube-system/coredns-f9fd979d6-h7rfw:8080 10.244.1.50:60914 to-stack FORWARDED TCP Fla
gs: ACK, PSH
Sep &lt;span class="m">2&lt;/span> 07:06:47.823 kube-system/coredns-f9fd979d6-h7rfw:8080 10.244.1.50:60914 to-stack FORWARDED TCP Fla
gs: ACK, FIN
Sep &lt;span class="m">2&lt;/span> 07:06:47.823 10.244.1.50:60914 kube-system/coredns-f9fd979d6-h7rfw:8080 to-endpoint FORWARDED TCP Fla
gs: ACK, PSH
&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¯ä»¥çœ‹åˆ°å†…å®¹å¾ˆè¯¦ç»†ï¼ŒåŒ…æ‹¬é€šä¿¡çš„ä¸¤ç«¯ï¼Œä»¥åŠå‘çš„åŒ…æ˜¯ &lt;code>ACK&lt;/code> è¿˜æ˜¯ &lt;code>SYN&lt;/code> ç­‰ä¿¡æ¯å‡å¯è§‚æµ‹åˆ°ã€‚&lt;/p>
&lt;h3 id="éƒ¨ç½²æµ‹è¯•åº”ç”¨">éƒ¨ç½²æµ‹è¯•åº”ç”¨&lt;/h3>
&lt;p>è¿™é‡Œæˆ‘ä»¬éƒ¨ç½²ä¸€ä¸ªæµ‹è¯•åº”ç”¨æ¥å®é™…ä½“éªŒä¸‹ Cilium æä¾›çš„å¼ºå¤§åŠŸèƒ½ã€‚å®˜æ–¹ä»“åº“ä¸­æä¾›äº†ä¸€ä¸ª &lt;a href="https://raw.githubusercontent.com/cilium/cilium/HEAD/examples/kubernetes/connectivity-check/connectivity-check.yaml" title="connectivity-check">connectivity-check&lt;/a> çš„æµ‹è¯•ç”¨ä¾‹ï¼Œè¿™é‡Œæˆ‘å¯¹å®ƒåšäº†ç²¾ç®€å’Œä¿®æ”¹ï¼Œä»¥ä¾¿ç†è§£ã€‚&lt;/p>
&lt;p>è¿™é‡Œå®šä¹‰çš„å†…å®¹å¦‚ä¸‹ï¼š&lt;/p>
&lt;ul>
&lt;li>1 ä¸ªåä¸º &lt;code>echo-a&lt;/code> çš„ svc ï¼Œç”¨äºæš´éœ² &lt;code>echo-a&lt;/code> è¿™ä¸ªæµ‹è¯•æœåŠ¡ï¼›&lt;/li>
&lt;li>4 ä¸ª deploy ï¼Œåˆ†åˆ«æ˜¯ 1 ä¸ªæµ‹è¯•æœåŠ¡ï¼Œä»¥åŠä¸‰ä¸ªç”¨äºæµ‹è¯•ä¸ &lt;code>echo-a&lt;/code> è”é€šæ€§çš„ deploy;&lt;/li>
&lt;li>2 ä¸ª CiliumNetworkPolicyï¼Œç”¨æ¥æ§åˆ¶æ˜¯å¦å…è®¸ä¸ &lt;code>echo-a&lt;/code> è”é€šï¼›&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="nn">---&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Service&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">echo-a&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ClusterIP&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">ports&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">port&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">80&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">selector&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">echo-a&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nn">---&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">apps/v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Deployment&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">echo-a&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">selector&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">matchLabels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">echo-a&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">replicas&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">template&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">labels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">echo-a&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">containers&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">echo-container&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">image&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">docker.io/cilium/json-mock:1.0&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">imagePullPolicy&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">IfNotPresent&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">readinessProbe&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">exec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">command&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;curl&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;-sS&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;--fail&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;-o&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;/dev/null&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;localhost&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nn">---&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">apps/v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Deployment&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">pod-to-a-allowed-cnp&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">selector&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">matchLabels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">pod-to-a-allowed-cnp&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">replicas&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">template&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">labels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">pod-to-a-allowed-cnp&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">containers&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">pod-to-a-allowed-cnp-container&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">image&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">docker.io/byrnedo/alpine-curl:0.1.8&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">command&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;/bin/ash&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;-c&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;sleep 1000000000&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">imagePullPolicy&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">IfNotPresent&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">livenessProbe&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">exec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">command&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;curl&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;-sS&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;--fail&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;-o&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;/dev/null&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;echo-a&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">readinessProbe&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">exec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">command&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;curl&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;-sS&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;--fail&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;-o&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;/dev/null&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;echo-a&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nn">---&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;cilium.io/v2&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">CiliumNetworkPolicy&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;pod-to-a-allowed-cnp&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">endpointSelector&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">matchLabels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">pod-to-a-allowed-cnp&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">egress&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">toEndpoints&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">matchLabels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">echo-a&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">toPorts&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">ports&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">port&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;80&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">protocol&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">TCP&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">toEndpoints&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">matchLabels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">k8s:io.kubernetes.pod.namespace&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">kube-system&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">k8s:k8s-app&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">kube-dns&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">toPorts&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">ports&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">port&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;53&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">protocol&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">UDP&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nn">---&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">apps/v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Deployment&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">pod-to-a-l3-denied-cnp&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">selector&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">matchLabels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">pod-to-a-l3-denied-cnp&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">replicas&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">template&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">labels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">pod-to-a-l3-denied-cnp&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">containers&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">pod-to-a-l3-denied-cnp-container&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">image&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">docker.io/byrnedo/alpine-curl:0.1.8&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">command&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;/bin/ash&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;-c&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;sleep 1000000000&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">imagePullPolicy&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">IfNotPresent&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">livenessProbe&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">timeoutSeconds&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">7&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">exec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">command&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;ash&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;-c&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;! curl -sS --fail --connect-timeout 5 -o /dev/null echo-a&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">readinessProbe&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">timeoutSeconds&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">7&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">exec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">command&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;ash&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;-c&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;! curl -sS --fail --connect-timeout 5 -o /dev/null echo-a&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nn">---&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;cilium.io/v2&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">CiliumNetworkPolicy&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;pod-to-a-l3-denied-cnp&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">endpointSelector&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">matchLabels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">pod-to-a-l3-denied-cnp&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">egress&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">toEndpoints&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">matchLabels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">k8s:io.kubernetes.pod.namespace&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">kube-system&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">k8s:k8s-app&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">kube-dns&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">toPorts&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">ports&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">port&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;53&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">protocol&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">UDP&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nn">---&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">apps/v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Deployment&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">pod-to-a&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">selector&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">matchLabels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">pod-to-a&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">replicas&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">template&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">labels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">pod-to-a&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">containers&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">pod-to-a-container&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">image&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">docker.io/byrnedo/alpine-curl:0.1.8&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">command&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;/bin/ash&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;-c&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;sleep 1000000000&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">imagePullPolicy&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">IfNotPresent&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">livenessProbe&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">exec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">command&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;curl&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;-sS&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;--fail&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;-o&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;/dev/null&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;echo-a&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç›´æ¥éƒ¨ç½²å³å¯ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ ~ kubectl apply -f cilium-demo.yaml
service/echo-a created
deployment.apps/echo-a created
deployment.apps/pod-to-a-allowed-cnp created
ciliumnetworkpolicy.cilium.io/pod-to-a-allowed-cnp created
deployment.apps/pod-to-a-l3-denied-cnp created
ciliumnetworkpolicy.cilium.io/pod-to-a-l3-denied-cnp created
deployment.apps/pod-to-a created
&lt;/code>&lt;/pre>&lt;/div>&lt;p>æŸ¥çœ‹ Pod çŠ¶æ€ï¼Œçœ‹çœ‹çŠ¶æ€æ˜¯å¦æ­£å¸¸ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ ~ kubectl get pods
NAME READY STATUS RESTARTS AGE
echo-a-8b6595b89-w9kt2 1/1 Running &lt;span class="m">0&lt;/span> 49s
pod-to-a-5567c85856-xsg5b 1/1 Running &lt;span class="m">0&lt;/span> 49s
pod-to-a-allowed-cnp-7b85c8db8-jrjhx 1/1 Running &lt;span class="m">0&lt;/span> 49s
pod-to-a-l3-denied-cnp-7f64d7b7c4-fsxrm 1/1 Running &lt;span class="m">0&lt;/span> 49s
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="å‘½ä»¤è¡Œè§‚æµ‹">å‘½ä»¤è¡Œè§‚æµ‹&lt;/h3>
&lt;p>æ¥ä¸‹æ¥ï¼Œä½¿ç”¨ &lt;code>hubble observe&lt;/code> è§‚å¯Ÿä¸‹æ•ˆæœï¼Œå·²ç»å¯ä»¥çœ‹åˆ°æˆ‘ä»¬éƒ¨ç½²çš„åº”ç”¨äº§ç”Ÿçš„è¿æ¥äº†ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ ~ kubectl &lt;span class="nb">exec&lt;/span> -n kube-system -t ds/cilium -- hubble observe
TIMESTAMP SOURCE DESTINATION TYPE VERDICT SUMMARY
Sep &lt;span class="m">3&lt;/span> 00:00:13.481 default/pod-to-a-5567c85856-xsg5b:60784 default/echo-a-8b6595b89-w9kt2:80 to-endpoint FORWARDED TCP Flags: ACK, PSH
Sep &lt;span class="m">3&lt;/span> 00:00:15.429 kube-system/coredns-f9fd979d6-h7rfw:53 default/pod-to-a-allowed-cnp-7b85c8db8-jrjhx:43696 to-endpoint FORWARDED UDP
Sep &lt;span class="m">3&lt;/span> 00:00:16.010 10.244.1.12:4240 10.244.2.220:50830 to-overlay FORWARDED TCP Flags: ACK
Sep &lt;span class="m">3&lt;/span> 00:00:16.010 10.244.1.12:4240 10.244.1.50:40402 to-stack FORWARDED TCP Flags: ACK
Sep &lt;span class="m">3&lt;/span> 00:00:16.010 10.244.1.50:40402 10.244.1.12:4240 to-endpoint FORWARDED TCP Flags: ACK
Sep &lt;span class="m">3&lt;/span> 00:00:16.011 10.244.2.220:50830 10.244.1.12:4240 to-endpoint FORWARDED TCP Flags: ACK
Sep &lt;span class="m">3&lt;/span> 00:00:16.523 10.244.1.12:4240 10.244.3.111:57242 to-overlay FORWARDED TCP Flags: ACK
Sep &lt;span class="m">3&lt;/span> 00:00:16.523 10.244.3.111:57242 10.244.1.12:4240 to-endpoint FORWARDED TCP Flags: ACK
Sep &lt;span class="m">3&lt;/span> 00:00:21.376 kube-system/coredns-f9fd979d6-h7rfw:53 default/pod-to-a-l3-denied-cnp-7f64d7b7c4-fsxrm:44785 to-overlay FORWARDED UDP
Sep &lt;span class="m">3&lt;/span> 00:00:21.377 kube-system/coredns-f9fd979d6-h7rfw:53 default/pod-to-a-l3-denied-cnp-7f64d7b7c4-fsxrm:44785 to-overlay FORWARDED UDP
Sep &lt;span class="m">3&lt;/span> 00:00:23.896 kube-system/coredns-f9fd979d6-h7rfw:36120 172.18.0.4:6443 to-stack FORWARDED TCP Flags: ACK
Sep &lt;span class="m">3&lt;/span> 00:00:25.428 default/pod-to-a-allowed-cnp-7b85c8db8-jrjhx:55678 default/echo-a-8b6595b89-w9kt2:80 L3-L4 FORWARDED TCP Flags: SYN
Sep &lt;span class="m">3&lt;/span> 00:00:25.428 default/pod-to-a-allowed-cnp-7b85c8db8-jrjhx:55678 default/echo-a-8b6595b89-w9kt2:80 to-endpoint FORWARDED TCP Flags: SYN
Sep &lt;span class="m">3&lt;/span> 00:00:25.428 default/echo-a-8b6595b89-w9kt2:80 default/pod-to-a-allowed-cnp-7b85c8db8-jrjhx:55678 to-endpoint FORWARDED TCP Flags: SYN, ACK
Sep &lt;span class="m">3&lt;/span> 00:00:25.428 default/pod-to-a-allowed-cnp-7b85c8db8-jrjhx:55678 default/echo-a-8b6595b89-w9kt2:80 to-endpoint FORWARDED TCP Flags: ACK
Sep &lt;span class="m">3&lt;/span> 00:00:25.428 default/pod-to-a-allowed-cnp-7b85c8db8-jrjhx:55678 default/echo-a-8b6595b89-w9kt2:80 to-endpoint FORWARDED TCP Flags: ACK, PSH
Sep &lt;span class="m">3&lt;/span> 00:00:25.429 default/pod-to-a-allowed-cnp-7b85c8db8-jrjhx:55678 default/echo-a-8b6595b89-w9kt2:80 to-endpoint FORWARDED TCP Flags: ACK, FIN
Sep &lt;span class="m">3&lt;/span> 00:00:29.546 10.244.1.50:57770 kube-system/coredns-f9fd979d6-h7rfw:8080 to-endpoint FORWARDED TCP Flags: SYN
Sep &lt;span class="m">3&lt;/span> 00:00:29.546 kube-system/coredns-f9fd979d6-h7rfw:8080 10.244.1.50:57770 to-stack FORWARDED TCP Flags: SYN, ACK
Sep &lt;span class="m">3&lt;/span> 00:00:29.546 10.244.1.50:57770 kube-system/coredns-f9fd979d6-h7rfw:8080 to-endpoint FORWARDED TCP Flags: ACK
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="hubble-ui-è§‚æµ‹">Hubble UI è§‚æµ‹&lt;/h3>
&lt;p>è¿˜è®°å¾—æˆ‘ä»¬åœ¨ä¸Šæ–‡ä¸­éƒ¨ç½² Cilium æ—¶å€™é…ç½®çš„å‡ ä¸ªå…³äº Hubble çš„å‚æ•°ä¹ˆï¼Œç°åœ¨æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Hubble UI æ¥çœ‹çœ‹æ•ˆæœã€‚&lt;/p>
&lt;p>å…ˆæ£€æŸ¥ä¸‹ &lt;code>kube-system&lt;/code> ns ä¸‹ï¼Œæ˜¯å¦æœ‰ &lt;code>hubble-ui&lt;/code> è¿™ä¸ª svc ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ kubectl -n kube-system get svc
NAME TYPE CLUSTER-IP EXTERNAL-IP PORT&lt;span class="o">(&lt;/span>S&lt;span class="o">)&lt;/span> AGE
hubble-metrics ClusterIP None &amp;lt;none&amp;gt; 9091/TCP 4m31s
hubble-relay ClusterIP 10.102.90.19 &amp;lt;none&amp;gt; 80/TCP 4m31s
hubble-ui ClusterIP 10.96.69.234 &amp;lt;none&amp;gt; 80/TCP 4m31s
kube-dns ClusterIP 10.96.0.10 &amp;lt;none&amp;gt; 53/UDP,53/TCP,9153/TCP 8m51s
&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç›´æ¥ä½¿ç”¨ &lt;code>kubectl port-forward&lt;/code> ï¼Œä»æœ¬åœ°æ¥è®¿é—® Hubble UI ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ ~ kubectl -n kube-system port-forward svc/hubble-ui 12000:80
Forwarding from 127.0.0.1:12000 -&amp;gt; &lt;span class="m">12000&lt;/span>
Forwarding from &lt;span class="o">[&lt;/span>::1&lt;span class="o">]&lt;/span>:12000 -&amp;gt; &lt;span class="m">12000&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>æµè§ˆå™¨ä¸­æ‰“å¼€ &lt;a href="http://127.0.0.1:12000">http://127.0.0.1:12000&lt;/a> å³å¯ã€‚&lt;/p>
&lt;p>&lt;img src="https://moelove.info/img/hubble-ui.png" alt="Hubble UI - https:/moelove.info">&lt;/p>
&lt;p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬åˆšæ‰éƒ¨ç½²çš„æ‰€æœ‰ Podï¼Œä»¥åŠæŸ¥çœ‹åˆ°ç›¸åº”çš„ CiliumNetworkPolicy ç­‰ä¿¡æ¯ï¼Œè¿™é‡Œå°±ä¸èµ˜è¿°äº†ï¼Œæœ‰å…´è¶£çš„å°ä¼™ä¼´å¯ä»¥è‡ªè¡Œæ¢ç´¢ä¸‹ã€‚&lt;/p>
&lt;h3 id="hubble-metrics-è§‚æµ‹">Hubble metrics è§‚æµ‹&lt;/h3>
&lt;p>æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ Hubble æš´éœ²å‡ºæ¥çš„ metrics è¿›è¡Œè§‚æµ‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ ~ kubectl port-forward -n kube-system ds/cilium 19091:9091
Forwarding from 127.0.0.1:19091 -&amp;gt; &lt;span class="m">9091&lt;/span>
Forwarding from &lt;span class="o">[&lt;/span>::1&lt;span class="o">]&lt;/span>:19091 -&amp;gt; &lt;span class="m">9091&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç®€å•çœ‹ä¸‹å…¶ä¸­çš„å†…å®¹ï¼ŒåŒ…å«å„ç±»è¯·æ±‚/å“åº”/ä¸¢å¼ƒç­‰ç›¸å…³çš„ç»Ÿè®¡ä¿¡æ¯ï¼Œè¿˜æœ‰åŒ…æ‹¬æ¯ä¸ªç›®æ ‡ç«¯å£åŒ…çš„æ•°é‡ç»Ÿè®¡ç­‰ã€‚æ„Ÿå…´è¶£çš„å°ä¼™ä¼´å¯ä»¥è‡ªè¡Œæ¢ç´¢ä¸‹ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ ~ curl -s localhost:19091/metrics &lt;span class="p">|&lt;/span> head -n &lt;span class="m">22&lt;/span>
&lt;span class="c1"># HELP hubble_dns_queries_total Number of DNS queries observed&lt;/span>
&lt;span class="c1"># TYPE hubble_dns_queries_total counter&lt;/span>
hubble_dns_queries_total&lt;span class="o">{&lt;/span>&lt;span class="nv">ips_returned&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;0&amp;#34;&lt;/span>,qtypes&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;A&amp;#34;&lt;/span>,rcode&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span> &lt;span class="m">1165&lt;/span>
hubble_dns_queries_total&lt;span class="o">{&lt;/span>&lt;span class="nv">ips_returned&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;0&amp;#34;&lt;/span>,qtypes&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;AAAA&amp;#34;&lt;/span>,rcode&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span> &lt;span class="m">1165&lt;/span>
&lt;span class="c1"># HELP hubble_dns_response_types_total Number of DNS queries observed&lt;/span>
&lt;span class="c1"># TYPE hubble_dns_response_types_total counter&lt;/span>
hubble_dns_response_types_total&lt;span class="o">{&lt;/span>&lt;span class="nv">qtypes&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;A&amp;#34;&lt;/span>,type&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;A&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span> &lt;span class="m">233&lt;/span>
hubble_dns_response_types_total&lt;span class="o">{&lt;/span>&lt;span class="nv">qtypes&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;AAAA&amp;#34;&lt;/span>,type&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;AAAA&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span> &lt;span class="m">233&lt;/span>
&lt;span class="c1"># HELP hubble_dns_responses_total Number of DNS queries observed&lt;/span>
&lt;span class="c1"># TYPE hubble_dns_responses_total counter&lt;/span>
hubble_dns_responses_total&lt;span class="o">{&lt;/span>&lt;span class="nv">ips_returned&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;0&amp;#34;&lt;/span>,qtypes&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;A&amp;#34;&lt;/span>,rcode&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;Non-Existent Domain&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span> &lt;span class="m">932&lt;/span>
hubble_dns_responses_total&lt;span class="o">{&lt;/span>&lt;span class="nv">ips_returned&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;0&amp;#34;&lt;/span>,qtypes&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;AAAA&amp;#34;&lt;/span>,rcode&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;Non-Existent Domain&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span> &lt;span class="m">932&lt;/span>
hubble_dns_responses_total&lt;span class="o">{&lt;/span>&lt;span class="nv">ips_returned&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;1&amp;#34;&lt;/span>,qtypes&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;A&amp;#34;&lt;/span>,rcode&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;No Error&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span> &lt;span class="m">233&lt;/span>
hubble_dns_responses_total&lt;span class="o">{&lt;/span>&lt;span class="nv">ips_returned&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;1&amp;#34;&lt;/span>,qtypes&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;AAAA&amp;#34;&lt;/span>,rcode&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;No Error&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span> &lt;span class="m">233&lt;/span>
&lt;span class="c1"># HELP hubble_drop_total Number of drops&lt;/span>
&lt;span class="c1"># TYPE hubble_drop_total counter&lt;/span>
hubble_drop_total&lt;span class="o">{&lt;/span>&lt;span class="nv">protocol&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;ICMPv4&amp;#34;&lt;/span>,reason&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;Policy denied&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span> &lt;span class="m">459&lt;/span>
hubble_drop_total&lt;span class="o">{&lt;/span>&lt;span class="nv">protocol&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;ICMPv4&amp;#34;&lt;/span>,reason&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;Unsupported protocol for NAT masquerade&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span> &lt;span class="m">731&lt;/span>
hubble_drop_total&lt;span class="o">{&lt;/span>&lt;span class="nv">protocol&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;ICMPv6&amp;#34;&lt;/span>,reason&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;Unsupported L3 protocol&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span> &lt;span class="m">213&lt;/span>
hubble_drop_total&lt;span class="o">{&lt;/span>&lt;span class="nv">protocol&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;TCP&amp;#34;&lt;/span>,reason&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;Policy denied&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span> &lt;span class="m">1425&lt;/span>
hubble_drop_total&lt;span class="o">{&lt;/span>&lt;span class="nv">protocol&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;UDP&amp;#34;&lt;/span>,reason&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;Stale or unroutable IP&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span> &lt;span class="m">6&lt;/span>
hubble_drop_total&lt;span class="o">{&lt;/span>&lt;span class="nv">protocol&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;Unknown flow&amp;#34;&lt;/span>,reason&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;Policy denied&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span> &lt;span class="m">1884&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="éªŒè¯-ciliumnetworkpolicy-çš„æ•ˆæœ">éªŒè¯ CiliumNetworkPolicy çš„æ•ˆæœ&lt;/h3>
&lt;p>è¯´äº†è¿™ä¹ˆå¤šï¼Œæˆ‘ä»¬æ¥éªŒè¯ä¸‹åˆšæ‰éƒ¨ç½²çš„ CiliumNetworkPolicy çš„å®é™…æ•ˆæœå§ã€‚&lt;/p>
&lt;p>ä»¥ä¸‹æ˜¯åˆšæ‰éƒ¨ç½²çš„æµ‹è¯• Podï¼Œ æˆ‘ä»¬é€šè¿‡è¿™äº› Pod æ¥è®¿é—® &lt;code>echo-a&lt;/code> è¿™ä¸ª svc ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ ~ kubectl get pods
NAME READY STATUS RESTARTS AGE
echo-a-8b6595b89-w9kt2 1/1 Running &lt;span class="m">0&lt;/span> 79m
pod-to-a-5567c85856-xsg5b 1/1 Running &lt;span class="m">0&lt;/span> 79m
pod-to-a-allowed-cnp-7b85c8db8-jrjhx 1/1 Running &lt;span class="m">0&lt;/span> 79m
pod-to-a-l3-denied-cnp-7f64d7b7c4-fsxrm 1/1 Running &lt;span class="m">0&lt;/span> 79m
&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>&lt;code>pod-to-a&lt;/code> è¿™æ˜¯æœªé…ç½®ä»»ä½• CiliumNetworkPolicy è§„åˆ™çš„ Pod&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ ~ kubectl &lt;span class="nb">exec&lt;/span> pod-to-a-5567c85856-xsg5b -- curl -sI --connect-timeout &lt;span class="m">5&lt;/span> echo-a
HTTP/1.1 &lt;span class="m">200&lt;/span> OK
X-Powered-By: Express
Vary: Origin, Accept-Encoding
Access-Control-Allow-Credentials: &lt;span class="nb">true&lt;/span>
Accept-Ranges: bytes
Cache-Control: public, max-age&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span>
Last-Modified: Sat, &lt;span class="m">26&lt;/span> Oct &lt;span class="m">1985&lt;/span> 08:15:00 GMT
ETag: W/&lt;span class="s2">&amp;#34;83d-7438674ba0&amp;#34;&lt;/span>
Content-Type: text/html&lt;span class="p">;&lt;/span> &lt;span class="nv">charset&lt;/span>&lt;span class="o">=&lt;/span>UTF-8
Content-Length: &lt;span class="m">2109&lt;/span>
Date: Thu, &lt;span class="m">03&lt;/span> Sep &lt;span class="m">2020&lt;/span> 00:54:05 GMT
Connection: keep-alive
&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>&lt;code>pod-to-a-allowed-cnp&lt;/code> é…ç½®äº†å…è®¸é€šè¿‡ &lt;code>TCP&lt;/code> è®¿é—® &lt;code>echo-a&lt;/code>&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ ~ kubectl &lt;span class="nb">exec&lt;/span> pod-to-a-allowed-cnp-7b85c8db8-jrjhx -- curl -sI --connect-timeout &lt;span class="m">5&lt;/span> echo-a
HTTP/1.1 &lt;span class="m">200&lt;/span> OK
X-Powered-By: Express
Vary: Origin, Accept-Encoding
Access-Control-Allow-Credentials: &lt;span class="nb">true&lt;/span>
Accept-Ranges: bytes
Cache-Control: public, max-age&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span>
Last-Modified: Sat, &lt;span class="m">26&lt;/span> Oct &lt;span class="m">1985&lt;/span> 08:15:00 GMT
ETag: W/&lt;span class="s2">&amp;#34;83d-7438674ba0&amp;#34;&lt;/span>
Content-Type: text/html&lt;span class="p">;&lt;/span> &lt;span class="nv">charset&lt;/span>&lt;span class="o">=&lt;/span>UTF-8
Content-Length: &lt;span class="m">2109&lt;/span>
Date: Thu, &lt;span class="m">03&lt;/span> Sep &lt;span class="m">2020&lt;/span> 01:10:27 GMT
Connection: keep-alive
&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>&lt;code>pod-to-a-l3-denied-cnp&lt;/code> åˆ™æ˜¯åªé…ç½®äº†å…è®¸è®¿é—® DNSï¼Œè€Œæœªé…ç½®å…è®¸å¯¹ &lt;code>echo-a&lt;/code> çš„è®¿é—®&lt;/li>
&lt;/ul>
&lt;pre>&lt;code>(MoeLove) âœ ~ kubectl exec pod-to-a-l3-denied-cnp-7f64d7b7c4-fsxrm -- curl -sI --connect-timeout 5 echo-a
command terminated with exit code 28
&lt;/code>&lt;/pre>&lt;p>å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœå¯¹ Pod åº”ç”¨äº† CiliumNetworkPolicy , ä½†æ˜¯æœªé…ç½®å¯¹åº”çš„å…è®¸è§„åˆ™çš„è¯ï¼Œåˆ™ä»£è¡¨ä¸å…è®¸è®¿é—®ã€‚&lt;/p>
&lt;p>æ¯”å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸Šé¢ä¸¤ä¸ªé…ç½®äº† CiliumNetworkPolicy çš„ Pod æ¥è®¿é—®ä¸‹å…¬ç½‘åŸŸåï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ ~ kubectl &lt;span class="nb">exec&lt;/span> pod-to-a-allowed-cnp-7b85c8db8-jrjhx -- curl -sI --connect-timeout &lt;span class="m">5&lt;/span> moelove.info
&lt;span class="nb">command&lt;/span> terminated with &lt;span class="nb">exit&lt;/span> code &lt;span class="m">28&lt;/span>
&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ ~ kubectl &lt;span class="nb">exec&lt;/span> pod-to-a-l3-denied-cnp-7f64d7b7c4-fsxrm -- curl -sI --connect-timeout &lt;span class="m">5&lt;/span> moelove.info
&lt;span class="nb">command&lt;/span> terminated with &lt;span class="nb">exit&lt;/span> code &lt;span class="m">28&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¯ä»¥çœ‹åˆ°ï¼Œå‡ä¸èƒ½æ­£å¸¸è®¿é—®ã€‚&lt;/p>
&lt;h2 id="æ€»ç»“">æ€»ç»“&lt;/h2>
&lt;p>æœ¬èŠ‚ï¼Œä¸»è¦ä»‹ç»äº† Cilium å’Œ Hubble ç­‰ã€‚&lt;/p>
&lt;p>é€šè¿‡ä½¿ç”¨ KIND åˆ›å»ºçš„ Kubernetes é›†ç¾¤ï¼Œéƒ¨ç½²äº† Cilium åŠå…¶ç›¸å…³ç»„ä»¶ï¼Œå¹¶é€šè¿‡ä¸€ä¸ªå®ä¾‹ï¼Œæ¥å±•ç¤ºäº†é€šè¿‡ &lt;code>hubble observe&lt;/code>ï¼ŒHubble UI åŠ Hubble metrics ç­‰æ–¹å¼è¿›è¡Œè§‚æµ‹ã€‚&lt;/p>
&lt;p>ä¹Ÿé€šè¿‡å®é™…æ“ä½œï¼ŒéªŒè¯äº† CiliumNetworkPolicy çš„å®é™…æ•ˆæœã€‚&lt;/p>
&lt;p>æˆ‘ä¸»è¦æ˜¯åœ¨ä¸º Docker å†™ä»£ç çš„è¿‡ç¨‹ä¸­ï¼Œä¼šæ¶‰åŠåˆ° &lt;code>LSM&lt;/code> åŠ &lt;code>seccomp&lt;/code> ç­‰éƒ¨åˆ†ï¼Œæ‰€ä»¥é¡ºä¾¿å»ç ”ç©¶äº† eBPF åŠå…¶ç›¸å…³æŠ€æœ¯ï¼ˆåç»­å†åˆ†äº«è¿™éƒ¨åˆ†å†…å®¹ï¼‰ã€‚&lt;/p>
&lt;p>è€Œ Cilium åˆ™æ˜¯æˆ‘åœ¨ 2019 å¹´ä¸ŠåŠå¹´å¼€å§‹å­¦ä¹ å’Œç ”ç©¶çš„ï¼Œä½†æ­£å¦‚æˆ‘åœ¨å»å¹´çš„æ–‡ç«  &lt;a href="https://zhuanlan.zhihu.com/p/79757835" title="K8S ç”Ÿæ€å‘¨æŠ¥| cilium 1.6 å‘å¸ƒ 100% kube-proxy çš„æ›¿ä»£å“">ã€ŠK8S ç”Ÿæ€å‘¨æŠ¥| cilium 1.6 å‘å¸ƒ 100% kube-proxy çš„æ›¿ä»£å“ã€‹&lt;/a> ä¸­å†™çš„é‚£æ ·ï¼š&lt;/p>
&lt;blockquote>
&lt;p>è¿™é‡Œç¨å¾®è¯´å‡ å¥æˆ‘å…³äº Cilium çš„çœ‹æ³•ï¼š&lt;/p>
&lt;ul>
&lt;li>å‰ä¸å‰å®³ï¼Ÿå‰å®³ã€‚&lt;/li>
&lt;li>å€¼ä¸å€¼å¾—ç ”ç©¶ï¼Ÿå€¼å¾—ã€‚&lt;/li>
&lt;li>ä¼šä¸ä¼šæ”¾åˆ°è‡ªå·±çš„é›†ç¾¤æ›¿ä»£ kube-proxy ï¼Ÿä¸ä¼šï¼Œæœ€èµ·ç ç›®å‰ä¸ä¼šã€‚&lt;/li>
&lt;/ul>
&lt;p>å¦‚æœä½ æƒ³è¦é€šè¿‡ cilium ç ”ç©¶ eBPF æˆ–è€… XDP æˆ‘å€’æ˜¯å»ºè®®ä½ å¯ä»¥çœ‹çœ‹ï¼Œæ˜¯ä¸ªå¾ˆä¸é”™çš„é¡¹ç›®ï¼Œè€Œä¸”é€šè¿‡è¿™ä¸ªé¡¹ç›®èƒ½åŠ æ·±å¾ˆå¤šç½‘ç»œæ–¹é¢çš„è®¤è¯†ã€‚è¿™ä¹ˆè¯´å§ï¼Œå¦‚æœæŠŠ cilium çš„æºç åŠæ‰€æ¶‰åŠåŸç†éƒ½ç ”ç©¶é€šé€äº†ï¼Œé‚£å°±å¾ˆå‰å®³äº†ã€‚&lt;/p>
&lt;p>è‡³äºè¦ä¸è¦æ›¿æ¢ kube-proxy åœ¨æˆ‘çœ‹æ¥ï¼Œæœ€èµ·ç ç›®å‰æˆ‘ä¸ä¼šè¿™æ ·å»åšã€‚è§£å†³é—®é¢˜çš„åŠæ³•æœ‰å¾ˆå¤šç§ï¼Œè€Œæ›¿æ¢æ‰ä¸€ä¸ªæ ¸å¿ƒç»„ä»¶ï¼Œå´ä¸ä¸€å®šæ˜¯ä¸€ä¸ªæœ€å€¼å¾—çš„é€‰æ‹©ã€‚&lt;/p>
&lt;/blockquote>
&lt;p>Cilium æ˜¯ä¸€ä¸ªå€¼å¾—å­¦ä¹ å’Œç ”ç©¶çš„é¡¹ç›®/æŠ€æœ¯ï¼Œä½†æˆ‘ç›®å‰å°šæœªå°†å®ƒæ”¾åˆ°ç”Ÿäº§ç¯å¢ƒä¸­ï¼ˆè¿™ä¹Ÿæ˜¯æˆ‘å°‘æ•°èŠ±è´¹å¾ˆå¤šç²¾åŠ›ç ”ç©¶ï¼Œä½†æœªåº”ç”¨äºç”Ÿäº§çš„æŠ€æœ¯ä¹‹ä¸€ï¼‰ã€‚&lt;/p>
&lt;p>ä½†ç°åœ¨çœ‹æ¥ï¼Œ Cilium ä¹Ÿæœ‰äº†ä¸€å®šçš„å¸‚åœº/å‘å±•ï¼Œæ˜¯æ—¶å€™é‡æ–°è€ƒé‡ä¸‹äº†ã€‚åç»­æˆ‘ä¼šç»§ç»­åˆ†äº« Cilium åŠ eBPF ç›¸å…³çš„æŠ€æœ¯æ–‡ç« ï¼Œæ¬¢è¿å…³æ³¨ã€‚&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category><category domain="https://moelove.info/tags/eBPF/">eBPF</category><category domain="https://moelove.info/tags/cilium/">cilium</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| Kubernetes v1.19 æ­£å¼å‘å¸ƒ</title><link>https://moelove.info/2020/08/28/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Kubernetes-v1.19-%E6%AD%A3%E5%BC%8F%E5%8F%91%E5%B8%83/</link><guid isPermaLink="true">https://moelove.info/2020/08/28/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Kubernetes-v1.19-%E6%AD%A3%E5%BC%8F%E5%8F%91%E5%B8%83/</guid><pubDate>Fri, 28 Aug 2020 23:58:22 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container" title="k8sç”Ÿæ€">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="kubernetes-v119-æ­£å¼å‘å¸ƒ">Kubernetes v1.19 æ­£å¼å‘å¸ƒ&lt;/h2>
&lt;p>æœ¬å‘¨ Kubernetes v1.19 æ­£å¼å‘å¸ƒï¼Œè¿™æ˜¯ä»Šå¹´å‘å¸ƒçš„ç¬¬äºŒä¸ªç‰ˆæœ¬ï¼Œä¹Ÿæ˜¯è€—æ—¶æœ€é•¿çš„ä¸€ä¸ªç‰ˆæœ¬ã€‚&lt;/p>
&lt;p>åœ¨æ­¤ç‰ˆæœ¬ä¸­æœ‰ 34 ä¸ªå¢å¼ºåŠŸèƒ½ï¼Œå…¶ä¸­ 10 ä¸ªGAï¼Œ15 ä¸ª beta ä»¥åŠ 9 ä¸ª alphaã€‚å¹¶ä¸”ä» v1.19 å¼€å§‹ï¼ŒKubernetes æ¯ä¸ªç‰ˆæœ¬çš„æ”¯æŒå‘¨æœŸå»¶é•¿è‡³ 1 å¹´ã€‚ï¼ˆæ„Ÿè°¢[ Long Term Support (LTS) working group ]ï¼ˆhttps://github.com/kubernetes/community/tree/master/wg-lts#readme &amp;quot;LTS WG&amp;quot;ï¼‰ï¼‰&lt;/p>
&lt;p>å…³äºæ­¤ç‰ˆæœ¬ä¸­é‡è¦çš„å˜æ›´ï¼Œå¯å‚è€ƒæˆ‘æ¯æœŸå‘¨æŠ¥ä¸­ â€œä¸Šæ¸¸è¿›å±•â€ çš„éƒ¨åˆ†ã€‚æˆ–è€…ç›´æ¥å‚è€ƒ &lt;a href="https://kubernetes.io/blog/2020/08/26/kubernetes-release-1.19-accentuate-the-paw-sitive/" title="v1.19 ä»‹ç»">å®˜æ–¹åšå®¢ä¸­ v1.19 çš„ä»‹ç»æ–‡ç« &lt;/a> ã€‚&lt;/p>
&lt;p>è¿™é‡Œæˆ‘æ¥å•ç‹¬ä»‹ç»ä¸€ä¸ªæ›´å…·ä½“ä¸”å®ç”¨çš„ç‰¹æ€§ã€‚&lt;/p>
&lt;h2 id="api-å¼ƒç”¨è§„åˆ™">API å¼ƒç”¨è§„åˆ™&lt;/h2>
&lt;p>Kubernetes æ˜¯ä¸€ä¸ªåºå¤§çš„ç³»ç»Ÿï¼Œå½“è®¨è®ºå®ƒçš„ API æ—¶ï¼Œæˆ‘ä»¬ä¸å¾—ä¸æåˆ°å¸¸ç”¨çš„ 4 ä¸ªæœ¯è¯­ï¼Œå³ï¼šgroupï¼ˆç»„ï¼‰, versionï¼ˆç‰ˆæœ¬ï¼‰, kindï¼ˆç±»å‹ï¼‰å’Œ resourceï¼ˆèµ„æºï¼‰ã€‚&lt;/p>
&lt;p>ä¸€ä¸ª API group æ˜¯ä¸€ç»„ç›¸å…³åŠŸèƒ½çš„é›†åˆï¼Œgroup + version æ˜¯ç¡®ä¿ API å¯éšç€æ—¶é—´æ¨ç§»ï¼Œè¿›è¡Œç‰ˆæœ¬å‡çº§æˆ–åŠŸèƒ½æ›´æ–°çš„åŸºç¡€ã€‚&lt;/p>
&lt;p>è¿™é‡Œæˆ‘æ¥ä»‹ç»ä¸‹ &lt;strong>è‡ª Kubernetes v1.19 å¼€å§‹&lt;/strong> é’ˆå¯¹ REST èµ„æºï¼ˆaka API å¯¹è±¡ï¼‰åœ¨å¼ƒç”¨ç­–ç•¥ç›¸å…³çš„å˜æ›´ã€‚&lt;/p>
&lt;p>å½“è¯·æ±‚ä¸€ä¸ªå·²æ ‡è®°ä¸ºåºŸå¼ƒçš„ REST API endpoint æ—¶ï¼Œä¼šæœ‰å¦‚ä¸‹è¡Œä¸ºï¼š&lt;/p>
&lt;ul>
&lt;li>æ ¹æ®&lt;a href="https://tools.ietf.org/html/rfc7234#section-5.5" title="RFC7234"> RFC7234 &lt;/a> ä¼šè¿”å›ä¸€ä¸ª &lt;code>Warning&lt;/code> headerï¼›&lt;/li>
&lt;li>æ·»åŠ ä¸€ä¸ª &lt;code>&amp;quot;k8s.io/deprecated&amp;quot;:&amp;quot;true&amp;quot;&lt;/code> annotation åˆ°è®°å½•æ­¤æ¬¡è¯·æ±‚çš„ audit event ä¸­ï¼›&lt;/li>
&lt;li>ä¸º &lt;code>kube-apiserver&lt;/code> è¿›ç¨‹è®¾ç½®ä¸€ä¸ªç±»å‹ä¸º Gauge çš„ metric &lt;code>apiserver_requested_deprecated_apis&lt;/code> çš„å€¼ä¸º &lt;code>1&lt;/code>ã€‚è¿™ä¸ª metrics æœ‰ &lt;code>group&lt;/code>, &lt;code>version&lt;/code>, &lt;code>resource&lt;/code>, &lt;code>subresource&lt;/code> ç­‰æ ‡ç­¾ã€‚ä¾‹å¦‚ï¼š&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">apiserver_requested_deprecated_apis&lt;span class="o">{&lt;/span>&lt;span class="nv">group&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;extensions&amp;#34;&lt;/span>,removed_release&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;1.22&amp;#34;&lt;/span>,resource&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;ingresses&amp;#34;&lt;/span>,subresource&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>,version&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;v1beta1&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span> &lt;span class="m">1&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™è¡¨ç¤º &lt;code>extensions&lt;/code> ç»„ &lt;code>v1beta1&lt;/code> ç‰ˆæœ¬çš„ &lt;code>ingresses&lt;/code> èµ„æºå°†åœ¨ &lt;code>1.22&lt;/code> ç‰ˆæœ¬ç§»é™¤ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬å¯ä»¥å°†è¿™ä¸ªæŒ‡æ ‡å’Œ &lt;code>apiserver_request_total&lt;/code> è¿™ä¸ªæŒ‡æ ‡è¿›è¡Œç»„åˆæŸ¥è¯¢ï¼Œå³å¯çœ‹åˆ°å½“å‰é›†ç¾¤ä¸­æœ‰å¤šå°‘è¯·æ±‚æ˜¯åœ¨è®¿é—®å·²åºŸå¼ƒ API çš„ã€‚&lt;/p>
&lt;p>ä¾‹å¦‚ä½¿ç”¨å¦‚ä¸‹æŸ¥è¯¢æ¡ä»¶ï¼Œç”¨æ¥æŸ¥è¯¢å½“å‰æœ‰å¤šå°‘è¯·æ±‚å°†åœ¨ 1.22 ä¸­ç§»é™¤çš„ APIï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="n">apiserver_requested_deprecated_apis&lt;/span>&lt;span class="err">{&lt;/span>&lt;span class="n">removed_release&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;1.22&amp;#34;&lt;/span>&lt;span class="err">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">on&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">group&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="k">version&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">resource&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">subresource&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">group_right&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">apiserver_request_total&lt;/span>&lt;span class="w">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://moelove.info/img/k119-metrics-result.png" alt="K8S metrics - https://moelove.info">&lt;/p>
&lt;p>&lt;strong>ä½¿ç”¨åœºæ™¯&lt;/strong> ä¸çŸ¥é“ä½ æ˜¯å¦è¿˜è®°å¾— v1.18 ä¸­åˆ é™¤äº†å¾ˆå¤šå·²åºŸå¼ƒçš„ API ç‰ˆæœ¬ï¼Œåœ¨é›†ç¾¤ç‰ˆæœ¬å‡çº§æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ç¡®ä¿å·²ç»æ›´æ–°/åˆ é™¤ä½¿ç”¨è¿™äº› API ç‰ˆæœ¬çš„èµ„æºï¼Œä»¥å…åœ¨é›†ç¾¤å‡çº§åï¼Œå¯¼è‡´å·²éƒ¨ç½²èµ„æºçš„å¼‚å¸¸ã€‚&lt;/p>
&lt;p>å½“æˆ‘ä»¬ä½¿ç”¨ä¸Šé¢ä»‹ç»çš„æ–¹æ³•ï¼Œç›´æ¥ç»„åˆ &lt;code>apiserver_requested_deprecated_apis&lt;/code> æŒ‡æ ‡å’Œ &lt;code>apiserver_request_total&lt;/code> æŒ‡æ ‡è¿›è¡ŒæŸ¥è¯¢ï¼Œå³å¯çœ‹åˆ°å½“å‰é›†ç¾¤å†…æ˜¯å¦æœ‰ä¼šå—æ­¤å½±å“çš„è¯·æ±‚ã€‚&lt;/p>
&lt;p>å…³äºæ­¤ç‰ˆæœ¬çš„è¯¦ç»†å˜æ›´è¯·å‚è€ƒ &lt;a href="https://github.com/kubernetes/kubernetes/blob/master/CHANGELOG/CHANGELOG-1.19.md" title="v1.19 ReleaseNote">v1.19 çš„ ReleaseNote&lt;/a>ã€‚&lt;/p>
&lt;h2 id="prometheus-2210-rc0-å‘å¸ƒ">Prometheus 2.21.0-rc.0 å‘å¸ƒ&lt;/h2>
&lt;p>æ­¤ç‰ˆæœ¬ä½¿ç”¨ Go v1.15 æ„å»ºï¼Œåœ¨ TLS è¯ä¹¦éªŒè¯æ—¶ï¼Œå¼ƒç”¨äº† &lt;a href="https://golang.org/doc/go1.15#commonname" title="X.509 CommonName">X.509 CommonName&lt;/a> çš„æ”¯æŒã€‚&lt;/p>
&lt;p>æˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹æ­¤ç‰ˆæœ¬ä¸­å€¼å¾—æ³¨æ„çš„å˜æ›´å§ï¼š&lt;/p>
&lt;ul>
&lt;li>æ–°å¢çš„ Service Discoveryï¼š&lt;a href="https://github.com/prometheus/prometheus/pull/3369" title="Eureka SD">Eureka SD&lt;/a> å’Œ &lt;a href="https://github.com/prometheus/prometheus/pull/7822" title="Hetzner SD">Hetzner SD&lt;/a>;&lt;/li>
&lt;li>Kubernetes SD ç°åœ¨å·²æ”¯æŒ &lt;a href="https://github.com/prometheus/prometheus/pull/6838" title="Kubernetes SD æ”¯æŒ EndpointSlices">EndpointSlices&lt;/a>&lt;/li>
&lt;li>&lt;strong>æ–°å¢ &lt;code>target_limit&lt;/code> é…ç½®&lt;/strong> ï¼Œè¡¨ç¤ºæ¯æ¬¡æŠ“å–èƒ½æ¥å—çš„ instance æ•°é‡ã€‚åœ¨ target relabel ä¹‹åï¼Œå¦‚æœè¶…è¿‡äº†æ­¤é…ç½®ï¼Œåˆ™ Prometheus ä¼šå°†å…¶æ ‡è®°ä¸ºå¤±è´¥ã€‚è¿™æ˜¯ä¸€é¡¹å®éªŒæ€§åŠŸèƒ½ï¼Œåç»­è¡Œä¸ºå¯èƒ½ä¼šæœ‰è°ƒæ•´ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/prometheus/prometheus/pull/7713">#7713&lt;/a> åœ¨ PromQL å’Œ UI ä¸­æ”¯æŒæ›´æ˜“è¯»çš„æ—¶é—´å‘¨æœŸï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/prometheus/prometheus/pull/7856">#7856&lt;/a> ä¿®å¤äº† &lt;code>chunks.HeadReadWriter: maxt of the files are not set&lt;/code> çš„é”™è¯¯ï¼›&lt;/li>
&lt;/ul>
&lt;p>æ›´å¤šå…³äºæ­¤ç‰ˆæœ¬çš„å˜æ›´ï¼Œè¯·å‚è€ƒå…¶ &lt;a href="https://github.com/prometheus/prometheus/releases/tag/v2.21.0-rc.0" title="Prometheus v2.21.0-rc.0 ReleaseNote">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="jaeger-v119-ç³»åˆ—å‘å¸ƒ">jaeger v1.19 ç³»åˆ—å‘å¸ƒ&lt;/h2>
&lt;p>æœ¬å‘¨è¿ç»­å‘å¸ƒäº† v1.19.0 è‡³ v1.19.2 ç‰ˆæœ¬ï¼Œä¸»è¦ bug éƒ½é›†ä¸­åœ¨ UI ä¸Šã€‚å¹¶ä¸”åœ¨ v1.19 ä¸­æœ‰ä¸€ä¸ªå·²çŸ¥çš„é—®é¢˜ï¼Œ&lt;a href="https://github.com/jaegertracing/jaeger/pull/2297">#2297&lt;/a> æ˜¯ä¸º gRPC query æ·»åŠ  TLS æ”¯æŒï¼Œä½†æœªæ³¨å†Œ flag ï¼Œæ‰€ä»¥æ­¤ç‰¹æ€§ä¸èƒ½ä½¿ç”¨ã€‚è®¡åˆ’æ˜¯åœ¨ v1.20 ä¸­ä¿®å¤ã€‚&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://github.com/jaegertracing/jaeger/pull/2336">#2336&lt;/a> å¯é…ç½®çš„ UDP socket buffer size;&lt;/li>
&lt;li>&lt;a href="https://github.com/jaegertracing/jaeger/pull/2330">#2330&lt;/a> é»˜è®¤æ”¯æŒæ‰¹é‡ä¸”é˜Ÿåˆ—åŒ–çš„é‡è¯•ï¼›&lt;/li>
&lt;/ul>
&lt;h2 id="ä¸Šæ¸¸è¿›å±•">ä¸Šæ¸¸è¿›å±•&lt;/h2>
&lt;ul>
&lt;li>Kubernetes v1.16.15 å°†ä¼šæ˜¯ Kubernetes v1.16 ä¸­çš„æœ€åä¸€ä¸ªç‰ˆæœ¬ï¼›&lt;/li>
&lt;/ul>
&lt;hr>
&lt;p>æ¬¢è¿è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| Google é€‰æ‹© Cilium ä½œä¸º GKE ä¸‹ä¸€ä»£æ•°æ®é¢</title><link>https://moelove.info/2020/08/23/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Google-%E9%80%89%E6%8B%A9-Cilium-%E4%BD%9C%E4%B8%BA-GKE-%E4%B8%8B%E4%B8%80%E4%BB%A3%E6%95%B0%E6%8D%AE%E9%9D%A2/</link><guid isPermaLink="true">https://moelove.info/2020/08/23/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Google-%E9%80%89%E6%8B%A9-Cilium-%E4%BD%9C%E4%B8%BA-GKE-%E4%B8%8B%E4%B8%80%E4%BB%A3%E6%95%B0%E6%8D%AE%E9%9D%A2/</guid><pubDate>Sun, 23 Aug 2020 02:11:46 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="google-é€‰æ‹©-cilium-ä½œä¸º-gke-ç½‘ç»œçš„æ•°æ®é¢">Google é€‰æ‹© Cilium ä½œä¸º GKE ç½‘ç»œçš„æ•°æ®é¢&lt;/h2>
&lt;p>&lt;img src="https://cilium.io/static/1a5e48f755419401103235a6a01de4fd/906b5/google_header.png" alt="GKE &amp; Cilium">&lt;/p>
&lt;p>Google &lt;a href="https://cloud.google.com/blog/products/containers-kubernetes/bringing-ebpf-and-cilium-to-google-kubernetes-engine" title="GKE ä½¿ç”¨ Cilium çš„å£°æ˜">å£°æ˜&lt;/a>å°†é€‰æ‹© &lt;a href="https://cilium.io/" title="Cilium ä¸»é¡µ">Cilium&lt;/a> ä½œä¸º GKE ç½‘ç»œçš„æ•°æ®é¢ V2 ä»¥ä¾¿å¢åŠ å…¶å®¹å™¨å®‰å…¨æ€§å’Œå¯è§‚æµ‹æ€§ã€‚&lt;/p>
&lt;p>Kubernetes æœ€å¼ºçš„èƒ½åŠ›ä¹‹ä¸€ä¾¿æ˜¯å…¶å¼€å‘è€…ä¼˜å…ˆçš„ç½‘ç»œæ¨¡å‹ï¼Œå¯ä»¥æä¾›ç®€å•æ˜“ç”¨çš„åŠŸèƒ½ï¼Œæ¯”å¦‚ï¼š L3/L4 service å’Œ L7 ingress ä»¥ä¾¿å°†æµé‡å¼•å…¥ Kubernetes é›†ç¾¤ï¼Œä»¥åŠå¤šç§Ÿæˆ·çš„ç½‘ç»œéš”ç¦»ç­‰ã€‚&lt;/p>
&lt;p>ä½†éšç€è¶Šæ¥è¶Šå¤šçš„ä¼ä¸šä½¿ç”¨ Kubernetes , ç”¨ä¾‹èŒƒå›´è¶Šæ¥è¶Šå¹¿ï¼Œå›´ç»•å¤šäº‘ï¼Œå®‰å…¨æ€§ï¼Œå¯è§‚å¯Ÿæ€§å’Œå¯æ‰©å±•æ€§ç­‰æ–¹é¢å‡æå‡ºäº†æ–°çš„è¦æ±‚ã€‚æ­¤å¤–ï¼Œè¯¸å¦‚ service mesh å’Œ serverless ç­‰æŠ€æœ¯ï¼Œå‡éœ€è¦æ¥è‡ªåº•å±‚ Kubernetes çš„æ›´å¤šè‡ªå®šä¹‰ã€‚è¿™äº›æ–°è¦æ±‚æœ€ç»ˆæ±‡èšåˆ°ä¸€èµ·å¾—å‡ºæ¥çš„ç»“è®ºä¾¿æ˜¯ï¼š &lt;strong>éœ€è¦ä¸€ä¸ªæ›´å…·å¯ç¼–ç¨‹æ€§çš„æ•°æ®å¹³é¢&lt;/strong>ï¼Œè¯¥å¹³é¢å¯æ‰§è¡Œ Kubernetes æ„ŸçŸ¥çš„æ•°æ®åŒ…æ“ä½œï¼Œå¹¶ä¸”è¿˜ä¸ä¼šæŸå¤±æ€§èƒ½ã€‚&lt;/p>
&lt;p>Cilium çš„å‡ºç°æ°æ°æ»¡è¶³äº†è¿™äº›éœ€æ±‚ï¼Œå®ƒåŸºäº eBPF æŠ€æœ¯çš„å®ç°ï¼Œä½¿ Linux å†…æ ¸å…·å¤‡äº† Kubernetes çš„æ„è¯†ã€‚å®ƒå¯ä»¥å¾ˆå¥½çš„æ»¡è¶³ç°åœ¨æ–°çš„å¯¹å®¹å™¨è´Ÿè½½çš„å¯ä¼¸ç¼©æ€§ï¼Œå¯è§‚å¯Ÿæ€§ä»¥åŠå®‰å…¨ç­‰æ–¹é¢ç›¸å…³çš„è¦æ±‚ã€‚æ­¤å¤–ï¼Œ Cilium æ‰€æä¾›çš„åŠŸèƒ½ä¹Ÿè¿œè¶…äº†ä¼ ç»Ÿ CNI æä¾›çš„åŠŸèƒ½ï¼Œä¸ä»…æœ‰ä¼ ç»Ÿçš„ Network Policyï¼Œ service å’Œ LB ï¼Œè¿˜æœ‰ Flow &amp;amp; Policy logging ä»¥åŠå†…ç½®è¿ç»´å’Œå®‰å…¨ä¾§çš„ metrics ç­‰ã€‚&lt;/p>
&lt;h3 id="èƒŒåçš„æ•…äº‹">èƒŒåçš„æ•…äº‹&lt;/h3>
&lt;p>Google é¦–æ¬¡å‚ä¸ Cilium é¡¹ç›®å¤§æ¦‚æ˜¯å»å¹´ 12 æœˆï¼Œåæ¥è¶Šæ¥è¶Šå¤šçš„ Google å·¥ç¨‹å¸ˆåŠ å…¥è¿›æ¥ï¼Œä¹Ÿè´¡çŒ®äº†å¾ˆå¤šæ ¸å¿ƒåŠŸèƒ½ï¼Œæ¯”å¦‚ä¸Šæ–‡ä¸­æåˆ°çš„ Policy Logging ç­‰åŠŸèƒ½ã€‚æ­¤å¤–è¿˜æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚è‡ªåŠ¨æ£€æµ‹ EndpointSlices ï¼Œå¯¹ Pod IP çš„ IPv6 é‚»å±…å‘ç°çš„æ”¯æŒï¼Œè¿˜æœ‰åŸºäº socket cookie çš„è´Ÿè½½å‡è¡¡ç­‰ã€‚&lt;/p>
&lt;p>å½“ç„¶ï¼ŒGoogle æ˜¯æœ‰å®åŠ›å¯ä»¥ç›´æ¥åŸºäº eBPF æ¥æ„å»ºå…¶æ•°æ®å¹³é¢çš„ï¼Œä½†å®ƒé€‰æ‹©äº†å‚ä¸ Cilium ç¤¾åŒºï¼Œè¿™ä¹Ÿæ˜¯å¯¹ Cilium ç¤¾åŒºå¤šå¹´æ¥å·¥ä½œçš„è®¤å¯ï¼Œè¿™ä¹Ÿè®©ç¤¾åŒºæˆå‘˜éå¸¸å¼€å¿ƒã€‚&lt;/p>
&lt;p>ç›¸ä¿¡ä»Šåå°†ä¼šæœ‰æ›´å¤šæœ‰è¶£çš„ç‰¹æ€§è¢«åŠ å…¥è¿›æ¥ã€‚&lt;/p>
&lt;p>ä»¥ä¸‹æ˜¯ Cilium ä¸»è¦çš„åŠŸèƒ½ï¼š&lt;/p>
&lt;p>&lt;img src="https://camo.githubusercontent.com/714c5d777b0025dda66b46f14e28badc01e3e3360ef264be204f54846a7c9573/68747470733a2f2f63646e2e6a7364656c6976722e6e65742f67682f63696c69756d2f63696c69756d406d61737465722f446f63756d656e746174696f6e2f696d616765732f63696c69756d5f6f766572766965772e706e67" alt="Cilium æ ¸å¿ƒåŠŸèƒ½ - https://moelove.info">&lt;/p>
&lt;p>&lt;strong>åœ¨å»å¹´ 8 æœˆä»½çš„ &lt;a href="https://zhuanlan.zhihu.com/p/79757835" title="cilium 1.6 å‘å¸ƒ">ã€ŠK8S ç”Ÿæ€å‘¨æŠ¥| cilium 1.6 å‘å¸ƒ 100% kube-proxy çš„æ›¿ä»£å“ã€‹&lt;/a> ä¸€æ–‡ä¸­ï¼Œæˆ‘å°±æ›¾ä»‹ç»è¿‡ Cilium é¡¹ç›®åŠå…¶æ‰€ç”¨æŠ€æœ¯ï¼Œä¹Ÿé’ˆå¯¹è¯¥é¡¹ç›®å†™äº†è‡ªå·±çš„çœ‹æ³•ï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥çœ‹çœ‹ã€‚&lt;/strong>&lt;/p>
&lt;p>å¦å¤–ä¸€ä¸ªæ¯”è¾ƒæœ‰æ„æ€çš„ä¿¡æ¯æ˜¯ï¼Œ2017 å¹´ Google ä¸ Calico èƒŒåçš„å…¬å¸ Tigera åˆä½œï¼Œä¸º GKE å¼•å…¥äº† Calico ã€‚Cilium æ˜¯å¦ä¼šå–ä»£ Calico å‘¢ï¼Ÿ&lt;/p>
&lt;p>æœ€åï¼Œå¦‚æœä½ æƒ³è¦åœ¨ GKE ä¸­ä½¿ç”¨ Cilium ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">gcloud beta container clusters create &amp;lt;cluster name&amp;gt; &lt;span class="se">\
&lt;/span>&lt;span class="se">&lt;/span> --enable-dataplane-v2 --release-channel rapid &lt;span class="se">\
&lt;/span>&lt;span class="se">&lt;/span> --cluster-version 1.17.9-gke.600 --zone &amp;lt;zone name&amp;gt;
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="containerd-v140-å‘å¸ƒ">containerd v1.4.0 å‘å¸ƒ&lt;/h2>
&lt;p>æœ¬å‘¨ containerd ç»ˆäºè¿æ¥äº† v1.4.0 ç‰ˆæœ¬çš„æ­£å¼å‘å¸ƒï¼Œè·ç¦»ä¸Šä¸€ä¸ªæ­£å¼å¤§ç‰ˆæœ¬ v1.3.0 å·²ç»è¿‡å»äº†è¿‘ 10 ä¸ªæœˆï¼Œå¹¶ä¸”åœ¨æ­£å¼å‘å¸ƒä¹‹å‰ï¼Œä¹Ÿå…ˆåç»è¿‡äº† 3 ä¸ª beta ç‰ˆæœ¬å’Œ 2 ä¸ª rc ç‰ˆï¼Œå¯ä»¥çœ‹å‡ºæ­¤æ¬¡å‘å¸ƒè¿˜æ˜¯å¾ˆæ…é‡çš„ã€‚&lt;/p>
&lt;p>æˆ‘åœ¨&lt;a href="https://zhuanlan.zhihu.com/p/178227659" title="containerd v1.4.0-rc0 å‘å¸ƒ">ä¹‹å‰çš„ ã€ŠK8S ç”Ÿæ€å‘¨æŠ¥| runc v1.0-rc92 å‘å¸ƒã€‹&lt;/a> ä¸€æ–‡ä¸­ï¼Œä»‹ç»è¿‡ containerd v1.4.0-rc.0 ç›¸å…³çš„å†…å®¹ï¼Œæœ‰å…´è¶£çš„æœ‹å‹å¯ä»¥ç»“åˆç€çœ‹ã€‚&lt;/p>
&lt;p>ä»¥ä¸‹æ˜¯æ­¤ v1.4 ä¸­è¾ƒä¸ºå…³é”®çš„ç‰¹æ€§ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>æ”¯æŒé•œåƒçš„ lazy pull:&lt;/p>
&lt;ul>
&lt;li>ä¸»è¦é€‚ç”¨åœºæ™¯ï¼šFaaSï¼ŒPython/Ruby/Java/dotNet ç­‰é•œåƒç¯å¢ƒï¼›&lt;/li>
&lt;li>å®ç°æ’ä»¶ &lt;a href="https://github.com/containerd/stargz-snapshotter" title="stargz-snapshotter">stargz-snapshotter&lt;/a>;&lt;/li>
&lt;li>åŸºäº Stargz/CRFS å®Œæˆï¼›&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>CRI æ¨¡å¼ä¸‹æ”¯æŒ MCS å¤šç±»åˆ«çš„å®‰å…¨ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æ·»åŠ  cgroup v2 çš„æ”¯æŒï¼š&lt;/p>
&lt;ul>
&lt;li>æ”¯æŒ eBPF é›†æˆï¼›&lt;/li>
&lt;li>æ”¹å–„ OOM æ§åˆ¶ï¼›&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>æ”¹å–„ rootless æ¨¡å¼çš„æ”¯æŒï¼›&lt;/p>
&lt;ul>
&lt;li>èµ„æºæ§åˆ¶éœ€è¦ systemd å’Œ cgroup v2 çš„æ”¯æŒï¼›&lt;/li>
&lt;li>overlayfs snapshotter å¯é€šè¿‡ FUSE-overlayfs å®Œæˆï¼Œéœ€è¦ 4.18 åŠä»¥ä¸Šå†…æ ¸ï¼›&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>æ”¯æŒä¸é‡å¯ daemon çš„æƒ…å†µä¸‹ï¼Œé‡åŠ è½½ CNI é…ç½®ï¼›&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>æ›´å¤šå…³äºæ­¤ç‰ˆæœ¬ä¸­çš„å˜æ›´ï¼Œè¯·æŸ¥çœ‹å…¶ &lt;a href="https://github.com/containerd/containerd/releases/tag/v1.4.0" title="containerd v1.4 release note">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="istio-v17-æ­£å¼å‘å¸ƒ">Istio v1.7 æ­£å¼å‘å¸ƒ&lt;/h2>
&lt;p>Istio v1.7 ä¸»è¦é›†ä¸­åœ¨æ˜“ç”¨æ€§ï¼Œå®‰å…¨æ€§å’Œå¯é æ€§ä¸Šï¼Œå¹¶é’ˆå¯¹é Kubernetes ç¯å¢ƒåšäº†ä¸€äº›ä¼˜åŒ–ã€‚&lt;/p>
&lt;p>åœ¨æ˜“ç”¨æ€§æ–¹é¢ï¼Œæ–°ç‰ˆæœ¬ä¸­æä¾›äº† &lt;a href="https://istio.io/latest/docs/ops/diagnostic-tools/istioctl-analyze/" title="Istio åˆ†æå·¥å…·">Istio åˆ†æå·¥å…·&lt;/a> å¯é€šè¿‡ &lt;code>istioctl analyze --all-namespaces&lt;/code> ä½¿ç”¨ï¼›&lt;/p>
&lt;p>åœ¨å¯é æ€§æ–¹é¢ï¼Œä½ å¯ä»¥å°†&lt;a href="https://medium.com/@marko.luksa/delaying-application-start-until-sidecar-is-ready-2ec2d21a7b74" title="istio å»¶è¿Ÿå¯åŠ¨">åº”ç”¨ç¨‹åºçš„å¯åŠ¨å»¶è¿Ÿåˆ° sidecar å¯åŠ¨ä¹‹å&lt;/a>ï¼›&lt;/p>
&lt;p>å®‰å…¨æ€§æ–¹é¢ï¼Œä¸»è¦å°±æ˜¯é’ˆå¯¹é Kubernetes ï¼ˆVMï¼‰ ç¯å¢ƒçš„ä¸€äº›ä¼˜åŒ–äº†ã€‚&lt;/p>
&lt;p>æ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥å‚è€ƒå…¶ &lt;a href="https://istio.io/latest/news/releases/1.7.x/announcing-1.7/" title="Istio v1.7">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="k3s-æˆä¸ºäº†-cncf-sandbox-é¡¹ç›®">k3s æˆä¸ºäº† CNCF sandbox é¡¹ç›®&lt;/h2>
&lt;p>k3s ç›®æ ‡æ˜¯æä¾›ä¸€ç§é€šè¿‡ CNCF ä¸€è‡´æ€§è®¤è¯çš„ç”Ÿäº§çº§ Kubernetes å‘è¡Œç‰ˆï¼Œä½†ç›¸æ¯” Kubernetes è€Œè¨€æ›´åŠ è½»é‡å’Œæ˜“äºé…ç½®ã€‚ä¸»è¦å—ä¼—ç›®æ ‡æ˜¯ï¼š&lt;/p>
&lt;ul>
&lt;li>Edge&lt;/li>
&lt;li>IoT&lt;/li>
&lt;li>CI Pipeline&lt;/li>
&lt;li>å¼€å‘åˆ°ç”Ÿäº§ä¸€è‡´çš„ç¯å¢ƒ&lt;/li>
&lt;li>ARM è®¾å¤‡&lt;/li>
&lt;/ul>
&lt;p>å®ƒä¸»è¦ä¾èµ–çš„ç»„ä»¶å¦‚ä¸‹ï¼š&lt;/p>
&lt;ul>
&lt;li>containerd å’Œ runc&lt;/li>
&lt;li>Flannel&lt;/li>
&lt;li>CoreDNS&lt;/li>
&lt;li>CNI&lt;/li>
&lt;li>Host utilities (iptables, socat, etc)&lt;/li>
&lt;li>Ingress controller (traefik)&lt;/li>
&lt;li>Embedded service loadbalancer&lt;/li>
&lt;li>Embedded network policy controller&lt;/li>
&lt;/ul>
&lt;p>å°±æˆ‘ä¸ªäººè€Œè¨€ï¼Œæˆ‘å¯¹ k3s çš„äº†è§£&amp;amp;å…´è‡´ä»…é™äºå®ƒåˆšå‘å¸ƒä¹‹æ—¶ï¼Œåç»­å¶å°”ä¼šç¨å¾®çœ‹ä¸‹ç›¸å…³çš„ä¿¡æ¯ï¼Œä½†æœªåœ¨ç”Ÿäº§ä¸­ä½¿ç”¨è¿‡ã€‚&lt;/p>
&lt;p>ç°åœ¨ k3s çš„å®šä½å·²ç»æ˜ç¡®ä¸º Kubernetes çš„ä¸€ç§å‘è¡Œç‰ˆï¼Œæˆ‘è§‰å¾—è¿™ä¸ªå†³å®šè¿˜æ˜¯å¾ˆæ˜æ™ºçš„ï¼ˆç›¸æ¯” fork è€Œè¨€ï¼‰ã€‚ä¹‹å‰å¬è¯´å›½å†…æœ‰å‡ ä¸ªå…¬å¸åœ¨æ k3s on ARM ä¹‹ç±»çš„ï¼Œä¸è¿‡ä¹Ÿæ²¡å¬åˆ°åç»­çš„ç»“æœï¼Œå¯èƒ½è¿˜æ˜¯ä¼šé¢ä¸´ä¸€äº›é—®é¢˜å§ã€‚&lt;/p>
&lt;p>ç”Ÿäº§ä½¿ç”¨æˆ‘ä¸ªäººè¿˜æ˜¯å»ºè®®é€‰æ‹© Kubernetes æˆ–è€…å¯é€‰æ‹© OpenShift ä¹‹ç±»çš„ã€‚ï¼ˆæœ‰ç‰¹æ®Šåœºæ™¯æˆ–éœ€æ±‚çš„å¦è¯´ï¼‰&lt;/p>
&lt;h2 id="é¢˜å¤–è¯">é¢˜å¤–è¯&lt;/h2>
&lt;p>ä»¥ä¸Šä¾¿æ˜¯æˆ‘è§‰å¾—æœ¬å‘¨å€¼å¾—å…³æ³¨çš„å†…å®¹äº†ï¼Œä¸Šå‘¨å‘èµ·çš„â€œå…³äºä½¿ç”¨ Helm v2 or v3 â€çš„æŠ•ç¥¨ç»“æœå‡ºæ¥äº†ï¼Œ å‚ä¸æŠ•ç¥¨çš„æœ‹å‹ä¸­æœ‰ 7 æˆåœ¨ç”¨ Helm v3 ã€‚&lt;/p>
&lt;p>æœ¬æœŸè®¨è®ºå†…å®¹ï¼š &lt;strong>ä½ åœ¨ç”¨å“ªä¸ªç½‘ç»œæ’ä»¶å‘¢ï¼Ÿä»¥åŠé€‰æ‹©å®ƒçš„åŸå› &lt;/strong> ï¼Œ æ¬¢è¿ç•™è¨€å‚ä¸è®¨è®ºï¼&lt;/p>
&lt;hr>
&lt;p>æ¬¢è¿è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| Helm v2 è¿›å…¥ç»´æŠ¤æœŸå€’è®¡æ—¶</title><link>https://moelove.info/2020/08/15/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Helm-v2-%E8%BF%9B%E5%85%A5%E7%BB%B4%E6%8A%A4%E6%9C%9F%E5%80%92%E8%AE%A1%E6%97%B6/</link><guid isPermaLink="true">https://moelove.info/2020/08/15/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Helm-v2-%E8%BF%9B%E5%85%A5%E7%BB%B4%E6%8A%A4%E6%9C%9F%E5%80%92%E8%AE%A1%E6%97%B6/</guid><pubDate>Sat, 15 Aug 2020 15:39:19 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="helm-v2-å°†æ­£å¼åºŸå¼ƒ">Helm v2 å°†æ­£å¼åºŸå¼ƒ&lt;/h2>
&lt;p>æœ¬å‘¨ï¼ŒHelm v2 ç³»åˆ—å‘å¸ƒäº† v2.16.10 ç‰ˆæœ¬ï¼Œ &lt;strong>è¿™æ˜¯ Helm v2 çš„æœ€åä¸€ä¸ª bugfix ç‰ˆæœ¬&lt;/strong>ï¼Œæ­¤åä¸ä¼šå†ä¸º Helm v2 æä¾›é”™è¯¯ä¿®å¤ã€‚å¹¶ä¸”åœ¨ä¸‰ä¸ªæœˆåï¼Œå°†åœæ­¢ä¸º Helm v2 æä¾›å®‰å…¨è¡¥ä¸ã€‚å±Šæ—¶ï¼Œ Helm v2 ä¹Ÿå°±å®Œå…¨åºŸå¼ƒï¼Œä¸ä¼šå†å»ç»´æŠ¤äº†ã€‚&lt;/p>
&lt;p>å¦‚æœæœ‰åœ¨ä½¿ç”¨ Helm v2 çš„å°ä¼™ä¼´ï¼Œè¯·å°½å¿«å‡çº§è‡³ Helm v3ï¼Œ ç¤¾åŒºä¹Ÿæä¾›äº† &lt;a href="https://github.com/helm/helm-2to3" title="helm 2to3">Helm 2to3&lt;/a> çš„å·¥å…·ï¼Œå¯ä»¥å¸®åŠ©è¿ç§»ã€‚&lt;/p>
&lt;p>å¦å¤–ï¼Œè¿˜æœ‰ä¸ªåˆ«å‚å•†ç»‘å®š Helm v2 æä¾›åº”ç”¨å®‰è£…/éƒ¨ç½²æœåŠ¡çš„ï¼Œä¹Ÿå»ºè®®å°½å¿«è¿ç§»äº†ã€‚&lt;/p>
&lt;p>æˆ‘ç»Ÿè®¡äº†ä¸‹ï¼Œæˆ‘å‘å¸ƒçš„æ–‡ç« ä¸­ï¼Œæœ‰ 25 ç¯‡ä¸ Helm ç›¸å…³ã€‚åŒ…æ‹¬ &lt;a href="https://zhuanlan.zhihu.com/container">Helm v3 çš„å°è¯•&lt;/a>ï¼Œ&lt;a href="https://zhuanlan.zhihu.com/container">Helm v2 çš„åºŸå¼ƒè®¡åˆ’&lt;/a>ï¼Œ&lt;a href="https://zhuanlan.zhihu.com/container">ä» Helm v2 è¿ç§»åˆ° v3&lt;/a> ç­‰å†…å®¹ï¼Œæ„Ÿå…´è¶£çš„å°ä¼™ä¼´å¯ä»¥çœ‹çœ‹å†å²æ–‡ç« ã€‚&lt;/p>
&lt;h2 id="dockerhub-ä¿®æ”¹äº†å®šä»·å’Œ-tos">DockerHub ä¿®æ”¹äº†å®šä»·å’Œ TOS&lt;/h2>
&lt;p>DockerHub æœ¬å‘¨å¯¹å…¶æœåŠ¡æ”¶è´¹ä»¥åŠ &lt;a href="https://www.docker.com/legal/docker-terms-service" title="Docker TOS">TOSï¼ˆTerms of Serviceï¼‰&lt;/a>ã€‚æˆ‘ä»¬é‡ç‚¹æ¥çœ‹çœ‹æœ¬æ¬¡çš„ä¿®æ”¹å¯¹æˆ‘ä»¬ä¼šæœ‰å“ªäº›å½±å“å§ã€‚&lt;/p>
&lt;p>è¿™é‡Œé‡ç‚¹æ¥çœ‹çœ‹å¯¹å…è´¹ç”¨æˆ·/ï¼ˆæœªç™»å½•ï¼‰åŒ¿åç”¨æˆ·çš„å½±å“ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;strong>æµé‡é™åˆ¶&lt;/strong>&lt;/p>
&lt;p>æœªç™»å½•ç”¨æˆ·æ¯ 6 å°æ—¶ï¼Œå…è®¸ Pull 100 æ¬¡ï¼›
å·²ç™»å½•ç”¨æˆ·æ¯ 6 å°æ—¶ï¼Œå…è®¸ Pull 200 æ¬¡ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>é•œåƒä¿ç•™ç­–ç•¥å˜æ›´&lt;/p>
&lt;p>éæ´»è·ƒé•œåƒï¼Œä¿ç•™å‘¨æœŸä¸º 6 ä¸ªæœˆã€‚åœ¨æ¸…ç†ä¹‹å‰ï¼Œä¼šå‘é€é€šçŸ¥å‘ŠçŸ¥ä¼šè¿›è¡Œæ¸…ç†ç­‰æ“ä½œã€‚å…¶ä¸­ï¼Œ &lt;strong>éæ´»è·ƒé•œåƒ&lt;/strong> æŒ‡çš„æ˜¯æ—  push æˆ– pull æ“ä½œç­‰ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>è¿™ä¸ªå½±å“æœ‰å¤šå¤§å‘¢ï¼Ÿé¦–å…ˆæ˜¯æµé‡é™åˆ¶æ–¹é¢ï¼Œå¦‚æœä½ ç»´æŠ¤ç€ä¸€ä¸ªåŒ…å« 20 ä¸ª Node çš„ Kubernetes é›†ç¾¤ï¼Œå¹¶å‡è®¾å®ƒä»¬çš„å…¬ç½‘å‡ºå£ä¸€è‡´ã€‚é‚£ä½  6 ä¸ªå°æ—¶å†…ï¼Œå¹³å‡æ¯ä¸ª Node ä¸Šåªèƒ½ä» DockerHub æ‹‰å– 5 æ¬¡é•œåƒã€‚&lt;/p>
&lt;p>åœ¨é•œåƒä¿ç•™ç­–ç•¥è¿™é‡Œï¼Œå¦‚æœä½ æ›¾ç»æ„å»ºè¿‡ä¸€ä¸ªé•œåƒï¼Œä½†æ²¡ä»€ä¹ˆäººç”¨ï¼Œä¸”å¾ˆä¹…æœªæ›´æ–°ï¼Œé‚£å°±ææœ‰å¯èƒ½è¢«æ¸…ç†æ‰äº†ã€‚ä½ å¯ä»¥é€šè¿‡ DockerHub é¡µé¢ä¸Šé•œåƒçš„æ›´æ–°æ—¶é—´æ¥æŸ¥çœ‹ä¸‹é•œåƒçš„æƒ…å†µã€‚å½“ç„¶ï¼ŒDocker å›¢é˜Ÿä¹Ÿå®£ç§°ä¼šåœ¨ DockerHub ä¸Šæä¾›ä¸€ä¸ª Dashboard ï¼Œæ–¹ä¾¿æŸ¥çœ‹å½“å‰é•œåƒçš„å¥åº·ç¨‹åº¦ã€‚&lt;/p>
&lt;p>è¿™ä¸ªé•œåƒä¿ç•™ç­–ç•¥çš„ç”Ÿæ•ˆæ—¶é—´ï¼Œæ˜¯ä»ä»Šå¹´çš„ 11 æœˆ 1 æ—¥å¼€å§‹å®æ–½ï¼Œå±Šæ—¶å¤§å®¶æœ€å¥½å…³æ³¨ä¸‹è‡ªå·±çš„é•œåƒã€‚&lt;/p>
&lt;p>æœ€åï¼Œè¯´ä¸€ä¸‹ Docker ä¸ºä½•è¦å¢åŠ è¿™ä¸ªâ€œé•œåƒä¿ç•™ç­–ç•¥â€ çš„æ¡æ¬¾ï¼Œé‚£æ˜¯å› ä¸ºå½“å‰ DockerHub ä¿ç•™çš„é•œåƒæ•°æ®è¶…è¿‡äº† 15PBï¼Œä½†å…¶ä¸­æœ‰ 4.5PB å·¦å³å±äºæ— æ•ˆé•œåƒï¼Œé€šè¿‡æ­¤æ¬¡æ–°çš„ç­–ç•¥ï¼Œåº”è¯¥å¯ä»¥ä¸º DockerHub èŠ‚çº¦ä¸å°‘çš„ï¼ˆS3ï¼‰å­˜å‚¨æ”¯å‡ºã€‚&lt;/p>
&lt;h2 id="rook-v141-å‘å¸ƒ">Rook v1.4.1 å‘å¸ƒ&lt;/h2>
&lt;p>Rook ä¹Ÿè¿æ¥äº†å…¶ v1.4 ç³»åˆ—ç‰ˆæœ¬ï¼Œæ­¤æ¬¡ç‰ˆæœ¬ä¸­æœ‰ä¸€äº›éå¸¸å€¼å¾—å…³æ³¨çš„å†…å®¹ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ä¸å†æ”¯æŒæ¥è‡ª Ceph-CSI é©±åŠ¨çš„ Alpha å¿«ç…§ï¼Œåªæ”¯æŒ Beta å¿«ç…§äº†ï¼›&lt;/p>
&lt;ul>
&lt;li>æ­¤ç‰ˆæœ¬ä¸­é»˜è®¤éƒ¨ç½²äº† &lt;a href="https://github.com/ceph/ceph-csi/releases/tag/v3.0.0" title="ceph-csi 3.0">Ceph-CSI 3.0&lt;/a>;&lt;/li>
&lt;li>åŒ…æ‹¬å¤šæ¶æ„çš„ Docker é•œåƒæ”¯æŒï¼›&lt;/li>
&lt;li>å¯ä»¥ä¸º RBD åˆ›å»ºæˆ–åˆ é™¤ Beta å¿«ç…§ï¼ŒåŒæ—¶ç§»é™¤ Alpha å¿«ç…§çš„æ”¯æŒï¼›&lt;/li>
&lt;li>å¯ä»¥ä» RBD å¿«ç…§åˆ›å»º PVC ï¼›&lt;/li>
&lt;li>å¯ä»¥ä¸º RDB å’Œ CephFS æ”¯æŒ ROX å·ï¼›&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>å¦‚æœ dashboard æ¨¡å—å¼€å¯ï¼Œåˆ™å°†ä¼šä¸º ceph å¯¹è±¡å­˜å‚¨å¼€å¯ dashboardï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å®éªŒæ€§çš„å¢åŠ äº†ä¸€ä¸ª admission controller ï¼Œå¯è¿›è¡Œ CRD æ ¡éªŒï¼Œä½†æ˜¯é»˜è®¤æ˜¯ä¸å¼€å¯çš„ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>CephObjectStore&lt;/code> CRD å°†å…¶å¥åº·çŠ¶æ€å±•ç¤ºåœ¨ &lt;code>Status&lt;/code> å­—æ®µä¸­äº†ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>OSD&lt;/code> å¯ä»¥é€šè¿‡åœ¨ &lt;code>storageClassDeviceSet&lt;/code> è®¾ç½® &lt;code>encrypted: true&lt;/code> è¿›è¡ŒåŠ å¯†äº†ï¼›&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="ä¸Šæ¸¸è¿›å±•">ä¸Šæ¸¸è¿›å±•&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/pull/93929" title="#93929">#93929&lt;/a> å¯¹ Ingress TLS çš„ secretName å¢åŠ äº†æ ¡éªŒã€‚å½“åˆ›å»ºäº†ä¸€ä¸ª &lt;code>networking.k8s.io/v1&lt;/code> çš„ Ingress å¯¹è±¡ï¼Œä¼šæ ¡éªŒ &lt;code>spec.tls[*].secretName&lt;/code> å­—æ®µï¼›&lt;/li>
&lt;li>Kubernetes v1.19 è®¡åˆ’äº 8 æœˆ 25 æ—¥å‘å¸ƒï¼Œå±Šæ—¶é»˜è®¤ Go ç‰ˆæœ¬ä¸º v1.15ï¼›&lt;/li>
&lt;/ul>
&lt;hr>
&lt;p>æ¬¢è¿è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| runc v1.0-rc92 å‘å¸ƒ</title><link>https://moelove.info/2020/08/09/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-runc-v1.0-rc92-%E5%8F%91%E5%B8%83/</link><guid isPermaLink="true">https://moelove.info/2020/08/09/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-runc-v1.0-rc92-%E5%8F%91%E5%B8%83/</guid><pubDate>Sun, 09 Aug 2020 23:07:37 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="å¾®è½¯å¼€æºäº†-open-service-mesh">å¾®è½¯å¼€æºäº† Open Service Mesh&lt;/h2>
&lt;p>å¾®è½¯è¿‘æœŸå¼€æºäº†ä¸€ä¸ªæ–°çš„åä¸º &lt;a href="https://github.com/openservicemesh/osm/" title="OSM">Open Service Mesh&lt;/a> çš„é¡¹ç›®å¹¶å‡†å¤‡&lt;a href="https://github.com/cncf/toc/pull/507" title="æèµ ææ¡ˆ">æèµ ç»™ CNCF&lt;/a> ã€‚&lt;/p>
&lt;p>OSM ä¸»æ‰“è½»é‡&amp;amp;å¯æ‰©å±•ï¼Œæ”¯æŒ &lt;a href="https://smi-spec.io/" title="SMI">Service Mesh Interface (SMI) è§„èŒƒ&lt;/a> é™„å¸¦å¼€ç®±å³ç”¨çš„å¯è§‚å¯Ÿæ€§åŠŸèƒ½ã€‚æˆªè‡³ç›®å‰ï¼Œå·²ç»å‘å¸ƒäº†v0.2.0 ç‰ˆæœ¬ã€‚&lt;/p>
&lt;p>ä¸»è¦ç‰¹æ€§å¦‚ä¸‹ï¼š&lt;/p>
&lt;ul>
&lt;li>æ”¯æŒ Service Mesh Interface (SMI) çš„è§„èŒƒï¼Œä¸»è¦åŒ…æ‹¬ &lt;code>Traffic Access Control&lt;/code>ï¼Œ &lt;code>Traffic Specs&lt;/code> å’Œ &lt;code>Traffic Split&lt;/code> ã€‚å‰©ä¸‹çš„ &lt;code>Traffic Metrics&lt;/code> æ­£åœ¨å¼€å‘ä¸­ï¼›&lt;/li>
&lt;li>æœåŠ¡é—´çš„é€šä¿¡åŠ å¯†ä½¿ç”¨ mTLS ï¼›&lt;/li>
&lt;li>å®šä¹‰å’Œæ‰§è¡ŒæœåŠ¡é—´çš„&lt;a href="https://github.com/servicemeshinterface/smi-spec/blob/v0.5.0/apis/traffic-access/v1alpha2/traffic-access.md" title="è®¿é—®æ§åˆ¶">è®¿é—®æ§åˆ¶&lt;/a>ç­–ç•¥ï¼›&lt;/li>
&lt;li>é€šè¿‡ Prometheus å’Œ Grafana å®Œæˆå…¶è§‚å¯Ÿæ€§ï¼›&lt;/li>
&lt;li>å¯ä¸å¤–éƒ¨è¯ä¹¦ç®¡ç†æœåŠ¡è¿›è¡Œé›†æˆï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/openservicemesh/osm/blob/main/docs/patterns/sidecar_injection.md" title="sidecar æ³¨å…¥">Envoy sidecar &lt;/a> è‡ªåŠ¨æ³¨å…¥ï¼›&lt;/li>
&lt;/ul>
&lt;p>å…³äº Open Service Mesh æ›´è¯¦ç»†çš„å†…å®¹ï¼Œè¯·å‚è€ƒæˆ‘ä¸Šä¸€ç¯‡æ–‡ç«  &lt;a href="https://zhuanlan.zhihu.com/p/171550414" title="åˆè¯• Open Service Meshï¼ˆOSMï¼‰">åˆè¯• Open Service Meshï¼ˆOSMï¼‰&lt;/a>&lt;/p>
&lt;h2 id="runc-v10-rc92-å‘å¸ƒ">runc v1.0-rc92 å‘å¸ƒ&lt;/h2>
&lt;p>è¿™ä¸ªç‰ˆæœ¬åœ¨æœ¬å‘¨å‘å¸ƒï¼Œä¸»è¦æ˜¯å› ä¸ºä¸Šä¸ªç‰ˆæœ¬ v1.0-rc91 å‘å¸ƒä¹‹åï¼Œæˆ‘å‘ç°äº†å®ƒä¼šå¯¼è‡´ Docker æ— æ³•ä½¿ç”¨ &lt;code>--privileged&lt;/code> å‚æ•°è¿è¡Œä¸€ä¸ªå®¹å™¨ï¼Œæ€»æ˜¯ä¼šæç¤º &lt;code>invalid argument&lt;/code> è¿™ä¸ªé”™è¯¯ã€‚&lt;/p>
&lt;p>æŸ¥çœ‹ä»£ç åï¼Œå‘ç°å®ƒæ¥è‡ªäº Golang ä¸­ &lt;code>golang.org/x/sys/unix&lt;/code> çš„ &lt;code>unix.Mknod()&lt;/code> è¿™ä¸ªæ–¹æ³•ï¼Œè¿™å…¶å®æ˜¯ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨ã€‚æœ¬ç€æ±‚çœŸåŠ¡å®çš„æ€åº¦ï¼Œæˆ‘å»æ£€æŸ¥äº†ä¸‹è¿™ä¸ªå‡½æ•°çš„æºç ï¼Œ glibc ä»¥åŠ linux kernel çš„æºç ï¼Œä¸€ç•ªæŠ˜è…¾åï¼Œä¹Ÿå®šä½åˆ°äº†é—®é¢˜æ‰€åœ¨ã€‚&lt;/p>
&lt;p>å‘ç°é—®é¢˜æ¥è‡ªäº runc çš„æŸæ¬¡ä¿®æ”¹ï¼Œå¹¶è”ç³»åˆ°äº† runc çš„ç»´æŠ¤è€… &lt;em>Aleksa Sarai&lt;/em> ï¼Œä»–åœ¨&lt;a href="https://github.com/opencontainers/runc/commit/24388be71e1aef7facd0d78dda22e696c1694272">ä¸€æ¬¡æ›´æ–°ä¸­&lt;/a> åˆ é™¤äº†ä¸€æ®µç”¨äºæ£€æŸ¥è®¾å¤‡ç±»å‹çš„ä»£ç ï¼Œæ‰€ä»¥æ‰å¯¼è‡´äº†éšè—åœ¨ runc ä¸­çš„ bug è¿™æ¬¡è¢«æš´éœ²äº†å‡ºæ¥ã€‚&lt;/p>
&lt;p>è€Œè¿™ä¸ª bug ç›®å‰åªå½±å“åˆ°äº† Docker ï¼Œå¹¶æœªå½±å“ runc ä½œä¸ºå®¹å™¨è¿è¡Œæ—¶è‡ªèº«çš„åŠŸèƒ½ã€‚&lt;/p>
&lt;p>éšå &lt;em>Aleksa Sarai&lt;/em> æäº¤ä»£ç è¿›è¡Œäº†æ¼æ´ä¿®å¤ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹è¿™æ®µæŠ˜è…¾äº†æˆ‘å¥½å‡ å¤©çš„ä»£ç ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-diff" data-lang="diff">&lt;span class="gd">- switch {
&lt;/span>&lt;span class="gd">- case mode&amp;amp;unix.S_IFBLK == unix.S_IFBLK:
&lt;/span>&lt;span class="gd">&lt;/span>&lt;span class="gi">+ switch mode &amp;amp; unix.S_IFMT {
&lt;/span>&lt;span class="gi">+ case unix.S_IFBLK:
&lt;/span>&lt;span class="gi">&lt;/span> devType = configs.BlockDevice
&lt;span class="gd">- case mode&amp;amp;unix.S_IFCHR == unix.S_IFCHR:
&lt;/span>&lt;span class="gd">&lt;/span>&lt;span class="gi">+ case unix.S_IFCHR:
&lt;/span>&lt;span class="gi">&lt;/span> devType = configs.CharDevice
&lt;span class="gd">- case mode&amp;amp;unix.S_IFIFO == unix.S_IFIFO:
&lt;/span>&lt;span class="gd">&lt;/span>&lt;span class="gi">+ case unix.S_IFIFO:
&lt;/span>&lt;span class="gi">&lt;/span> devType = configs.FifoDevice
default:
return nil, ErrNotADevice
&lt;/code>&lt;/pre>&lt;/div>&lt;p>å…¶å®å°±æ˜¯ä¸€æ®µç”¨æ¥åˆ¤æ–­ç³»ç»Ÿè®¾å¤‡ç±»å‹çš„ä»£ç ï¼Œä½†å¾ˆé—æ†¾ï¼Œä¹‹å‰çš„ç±»å‹åˆ¤å®šä¸€ç›´éƒ½æ˜¯é”™è¯¯çš„ï¼Œç”¨æ¥åˆ¤å®šè®¾å¤‡ç±»å‹ï¼Œä¸èƒ½ä½¿ç”¨ç±»ä¼¼ &lt;code>mode&amp;amp;unix.S_IFBLK == unix.S_IFBLK&lt;/code> è¿™æ ·çš„æ–¹æ³•ï¼Œè€Œæ˜¯éœ€è¦ä½¿ç”¨ &lt;code>mode &amp;amp; unix.S_IFMT&lt;/code> ä½œä¸ºåˆ¤å®šã€‚&lt;/p>
&lt;p>è¿™åœ¨ Linux å†…æ ¸çš„æºç ä¸­ä¹Ÿæ—©æœ‰ä½“ç° &lt;a href="https://github.com/torvalds/linux/blob/bcf876870b95592b52519ed4aafcf9d95999bc9c/include/uapi/linux/stat.h#L21-L27">https://github.com/torvalds/linux/blob/bcf876870b95592b52519ed4aafcf9d95999bc9c/include/uapi/linux/stat.h#L21-L27&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-c" data-lang="c">&lt;span class="c1">// include/uapi/linux/stat.h
&lt;/span>&lt;span class="c1">&lt;/span>&lt;span class="cp">#define S_ISLNK(m) (((m) &amp;amp; S_IFMT) == S_IFLNK)
&lt;/span>&lt;span class="cp">#define S_ISREG(m) (((m) &amp;amp; S_IFMT) == S_IFREG)
&lt;/span>&lt;span class="cp">#define S_ISDIR(m) (((m) &amp;amp; S_IFMT) == S_IFDIR)
&lt;/span>&lt;span class="cp">#define S_ISCHR(m) (((m) &amp;amp; S_IFMT) == S_IFCHR)
&lt;/span>&lt;span class="cp">#define S_ISBLK(m) (((m) &amp;amp; S_IFMT) == S_IFBLK)
&lt;/span>&lt;span class="cp">#define S_ISFIFO(m) (((m) &amp;amp; S_IFMT) == S_IFIFO)
&lt;/span>&lt;span class="cp">#define S_ISSOCK(m) (((m) &amp;amp; S_IFMT) == S_IFSOCK)
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æœ€ç»ˆï¼Œè¿™ä¸ªä¿®å¤è¢«åˆå¹¶äº†ï¼ŒDocker ä¹Ÿå¯ä»¥ç»§ç»­å’Œæ–°ç‰ˆæœ¬çš„ runc ä¸€èµ·å·¥ä½œäº†ã€‚(ä¸ªäººä½“ä¼šå°±æ˜¯ï¼Œæœ‰äº› bug éšè—å¤ªæ·±ï¼Œè¿™æ®µä»£ç æˆ‘ä¹‹å‰çœ‹è¿‡ï¼Œä½†å¤ªåƒäº†ï¼Œè¢«æˆ‘ç»™å¿½ç•¥æ‰äº† orz)&lt;/p>
&lt;h2 id="containerd-v140-rc0-å‘å¸ƒ">containerd v1.4.0-rc.0 å‘å¸ƒ&lt;/h2>
&lt;p>è¿™æ˜¯ containerd çš„ç¬¬ 5 ä¸ªä¸»è¦ç‰ˆæœ¬ï¼Œæ­¤ç‰ˆæœ¬ä¸­åŒ…å«äº†å¤§é‡çš„æ›´æ–°ï¼Œæ¯”å¦‚å¯¹ CGroups v2 çš„æ”¯æŒï¼Œæ‰©å±•çš„ SELinux æ”¯æŒï¼Œé€šè¿‡ CRI æä¾›äº† Kubernetes On Windows çš„æ”¯æŒï¼Œå…±äº«è¿œç«¯å­˜å‚¨çš„å¿«ç…§æ”¯æŒç­‰ã€‚&lt;/p>
&lt;p>æ­¤ç‰ˆæœ¬ä¸­åŒ…å«çš„é‡å¤§ bug çš„ä¿®å¤ä¹Ÿä¼šç§»æ¤åˆ°å½“å‰è¿˜å—æ”¯æŒçš„ç‰ˆæœ¬ä¸­ã€‚æ­¤å¤–ï¼Œåœ¨è¿™ä¸ªç‰ˆæœ¬ä¸­ï¼Œä¹ŸåŒ…å«äº†ä¸¤ä¸ªä¸å‘åå…¼å®¹çš„ API ä¿®æ”¹ï¼Œéœ€è¦æ³¨æ„ã€‚&lt;/p>
&lt;p>ä»¥ä¸‹æ˜¯æˆ‘è§‰å¾—å€¼å¾—å…³æ³¨çš„å˜æ›´ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://github.com/containerd/containerd/pull/3726," title="3726">#3726&lt;/a> æ·»åŠ å¯¹ CGroups v2 çš„æ”¯æŒï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/containerd/containerd/pull/4384," title="4384">#4384&lt;/a> æ ‡è®° &lt;code>io.containerd.runtime.v1.*&lt;/code> å’Œ &lt;code>io.containerd.runc.v1&lt;/code> è¿™ä¸¤ä¸ª runtime ä¸ºåºŸå¼ƒã€‚ &lt;strong>åœ¨å½“å‰ Docker v19.03.x ç‰ˆæœ¬ä¸­ï¼Œé»˜è®¤çš„ runtime è°ƒç”¨çš„ API å°±æ˜¯ io.containerd.runtime.v1.linux , å¦‚æœè¦å‡çº§ Docker æˆ–è€…å•ç‹¬å‡çº§ containerd ï¼Œ éœ€è¦æ ¼å¤–æ³¨æ„&lt;/strong>;&lt;/li>
&lt;li>&lt;a href="https://github.com/containerd/containerd/pull/3765," title="3765">#3765&lt;/a> æ”¯æŒ FUSE æŒ‚è½½ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/containerd/containerd/pull/3972," title="3972">#3972&lt;/a> ä¿®å¤äº†é•œåƒå¹¶å‘ä¸‹è½½çš„é—®é¢˜ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/containerd/containerd/pull/3925," title="3925">#3925&lt;/a> ä¸ºå¿«ç…§æ·»åŠ äº† &lt;code>cleanup&lt;/code> çš„ APIï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/containerd/containerd/pull/4439," title="4439">#4439&lt;/a> å®‰è£… containerd çš„æ—¶å€™ï¼Œ ä¸éœ€è¦åœ¨é¢å¤–å®‰è£… &lt;code>libseccomp&lt;/code>ï¼Œ å†…ç½®äº†ï¼›&lt;/li>
&lt;/ul>
&lt;p>ä»¥ä¸Šå°±æ˜¯æˆ‘è®¤ä¸º containerd v1.4.0-rc.0 ä¸­å€¼å¾—æ³¨æ„çš„å˜æ›´ï¼Œæ›´å¤šå…³äºæ­¤ç‰ˆæœ¬çš„ä¿¡æ¯ï¼Œè¯·å‚è€ƒå…¶ &lt;a href="https://github.com/containerd/containerd/releases/tag/v1.4.0-rc.0," title="containerd v1.4 release note">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="docker-v190313-beta2-å‘å¸ƒ">Docker v19.03.13-beta2 å‘å¸ƒ&lt;/h2>
&lt;p>æœ¬æ¬¡ç‰ˆæœ¬ä¸»è¦æ˜¯è¿›è¡Œä¸€äº› bugfixï¼Œç›®å‰æ²¡ä»€ä¹ˆå¤ªå€¼å¾—å•ç‹¬èŠçš„ï¼Œæœ¬æœŸæš‚ä¸”è·³è¿‡ï¼Œç­‰æ­£å¼ç‰ˆæœ¬å‘å¸ƒæ—¶å†å…·ä½“èŠã€‚&lt;/p>
&lt;h2 id="ä¸Šæ¸¸è¿›å±•">ä¸Šæ¸¸è¿›å±•&lt;/h2>
&lt;p>&lt;a href="https://github.com/kubernetes/kubernetes/pull/93570," title="93570">#93570&lt;/a> componentstatus API è¢«æ ‡è®°åºŸå¼ƒã€‚&lt;/p>
&lt;p>æœ‰æ—¶ï¼Œæˆ‘ä»¬ä¼šé€šè¿‡ &lt;code>kubectl get componentstatus&lt;/code> æ¥æŸ¥çœ‹é›†ç¾¤ç»„ä»¶æ˜¯å¦å¥åº·ã€‚ä¾‹å¦‚ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ ~ kubectl get componentstatus
NAME STATUS MESSAGE ERROR
controller-manager Healthy ok
scheduler Healthy ok
etcd-0 Healthy &lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;health&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;true&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä½†éšç€ secure port ç›¸ç»§è¢«å¯ç”¨ï¼Œè¿™ä¸ª API å·²ç»ä¸èƒ½å¾ˆå¥½çš„æ­£å¸¸å·¥ä½œäº†ã€‚ æ‰€ä»¥ç°åœ¨å°†å…¶æ ‡è®°ä¸ºåºŸå¼ƒï¼Œä¸å»ºè®®å†é€šè¿‡æ­¤ API æ¥è·å–é›†ç¾¤ç»„ä»¶çš„çŠ¶æ€ä¿¡æ¯äº†ã€‚&lt;/p>
&lt;hr>
&lt;p>æ¬¢è¿è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>åˆè¯• Open Service Meshï¼ˆOSMï¼‰</title><link>https://moelove.info/2020/08/07/%E5%88%9D%E8%AF%95-Open-Service-MeshOSM/</link><guid isPermaLink="true">https://moelove.info/2020/08/07/%E5%88%9D%E8%AF%95-Open-Service-MeshOSM/</guid><pubDate>Fri, 07 Aug 2020 00:19:13 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;p>å¾®è½¯è¿‘æœŸå¼€æºäº†ä¸€ä¸ªæ–°çš„åä¸º &lt;a href="https://github.com/openservicemesh/osm/" title="OSM">Open Service Mesh&lt;/a> çš„é¡¹ç›®å¹¶å‡†å¤‡&lt;a href="https://github.com/cncf/toc/pull/507" title="æèµ ææ¡ˆ">æèµ ç»™ CNCF&lt;/a> ã€‚&lt;/p>
&lt;h2 id="åŸºæœ¬ä»‹ç»">åŸºæœ¬ä»‹ç»&lt;/h2>
&lt;blockquote>
&lt;p>Open Service Mesh (OSM) is a lightweight, extensible, Cloud Native service mesh that allows users to uniformly manage, secure, and get out-of-the-box observability features for highly dynamic microservice environments.&lt;/p>
&lt;/blockquote>
&lt;p>Open Service Meshï¼ˆOSMï¼‰æ˜¯ä¸€ä¸ªè½»é‡çº§ï¼Œå¯æ‰©å±•çš„äº‘åŸç”ŸæœåŠ¡ç½‘æ ¼ï¼Œå®ƒä½¿ç”¨æˆ·èƒ½å¤Ÿç»Ÿä¸€ç®¡ç†ï¼Œä¿æŠ¤å’Œè·å¾—é’ˆå¯¹é«˜åº¦åŠ¨æ€å¾®æœåŠ¡ç¯å¢ƒçš„å¼€ç®±å³ç”¨çš„å¯è§‚å¯Ÿæ€§åŠŸèƒ½ã€‚&lt;/p>
&lt;p>OSM åœ¨ Kubernetes ä¸Šè¿è¡ŒåŸºäº Envoy çš„æ§åˆ¶å¹³é¢ï¼Œå¯ä»¥ä½¿ç”¨ SMI API è¿›è¡Œé…ç½®ã€‚å®ƒé€šè¿‡ä»¥ sidecar çš„å½¢å¼æ³¨å…¥ Envoy ä»£ç†æ¥å·¥ä½œã€‚&lt;/p>
&lt;p>æ§åˆ¶é¢è´Ÿè´£æŒç»­é…ç½®ä»£ç†ï¼Œä»¥é…ç½®ç­–ç•¥å’Œè·¯ç”±è§„åˆ™ç­‰éƒ½ä¿æŒæœ€æ–°ã€‚ä»£ç†ä¸»è¦è´Ÿè´£æ‰§è¡Œè®¿é—®æ§åˆ¶çš„è§„åˆ™ï¼Œè·¯ç”±æ§åˆ¶ï¼Œé‡‡é›† metrics ç­‰ã€‚ï¼ˆè¿™å’Œç›®å‰æˆ‘ä»¬å¸¸è§åˆ°çš„ Service Mesh æ–¹æ¡ˆåŸºæœ¬éƒ½ä¸€æ ·çš„ï¼‰&lt;/p>
&lt;h2 id="æ˜¾è‘—ç‰¹æ€§">æ˜¾è‘—ç‰¹æ€§&lt;/h2>
&lt;ul>
&lt;li>åŸºäº Service Mesh Interface (SMI) çš„å®ç°ï¼Œä¸»è¦åŒ…æ‹¬ &lt;code>Traffic Access Control&lt;/code>ï¼Œ &lt;code>Traffic Specs&lt;/code> å’Œ &lt;code>Traffic Split&lt;/code> ã€‚å‰©ä¸‹çš„ &lt;code>Traffic Metrics&lt;/code> æ­£åœ¨å¼€å‘ä¸­ï¼›&lt;/li>
&lt;li>æœåŠ¡é—´çš„é€šä¿¡åŠ å¯†ä½¿ç”¨ mTLS ï¼›&lt;/li>
&lt;li>å®šä¹‰å’Œæ‰§è¡ŒæœåŠ¡é—´çš„&lt;a href="https://github.com/servicemeshinterface/smi-spec/blob/v0.5.0/apis/traffic-access/v1alpha2/traffic-access.md" title="è®¿é—®æ§åˆ¶">è®¿é—®æ§åˆ¶&lt;/a>ç­–ç•¥ï¼›&lt;/li>
&lt;li>é€šè¿‡ Prometheus å’Œ Grafana å®Œæˆå…¶è§‚å¯Ÿæ€§ï¼›&lt;/li>
&lt;li>å¯ä¸å¤–éƒ¨è¯ä¹¦ç®¡ç†æœåŠ¡è¿›è¡Œé›†æˆï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/openservicemesh/osm/blob/main/docs/patterns/sidecar_injection.md" title="sidecar æ³¨å…¥">Envoy sidecar &lt;/a> è‡ªåŠ¨æ³¨å…¥ï¼›&lt;/li>
&lt;/ul>
&lt;h2 id="ä¸Šæ‰‹ä½“éªŒ">ä¸Šæ‰‹ä½“éªŒ&lt;/h2>
&lt;p>åªåšä»‹ç»æœªå…å¤ªè¿‡æ— è¶£ï¼Œè€Œä¸”è¯´å®è¯ï¼Œè¿™ä¹ˆå¤š service mesh å®ç°ï¼Œä¸äº²è‡ªä¸Šæ‰‹è¯•è¯•çœ‹ï¼Œæ„Ÿè§‰ä¸å‡ºæ¥å¤ªå¤šå·®å¼‚çš„ã€‚&lt;/p>
&lt;p>è¿™é‡Œæˆ‘ä½¿ç”¨ &lt;a href="https://kind.sigs.k8s.io/" title="Kubernetes In Docker">KIND&lt;/a> ä½œä¸ºæˆ‘æœ¬åœ°çš„å®éªŒç¯å¢ƒã€‚&lt;/p>
&lt;h3 id="å®‰è£…">å®‰è£…&lt;/h3>
&lt;p>å®‰è£…è¿‡ç¨‹å¾ˆç®€å•ï¼Œç›´æ¥å» &lt;a href="https://github.com/openservicemesh/osm/releases" title="osm Release é¡µé¢">Release é¡µé¢&lt;/a> ä¸‹è½½é¢„ç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚å¯å°†äºŒè¿›åˆ¶æ–‡ä»¶åŠ å…¥åˆ° &lt;code>$PATH&lt;/code> ä¸­ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ ~ wget -q https://github.com/openservicemesh/osm/releases/download/v0.1.0/osm-v0.1.0-linux-amd64.tar.gz
&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ ~ tar -xzvf osm-v0.1.0-linux-amd64.tar.gz
linux-amd64/
linux-amd64/LICENSE
linux-amd64/README.md
linux-amd64/osm
&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ ~ &lt;span class="nb">cd&lt;/span> linux-amd64
&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ linux-amd64 ls
LICENSE osm README.md
&lt;/code>&lt;/pre>&lt;/div>&lt;p>åœ¨è¿›è¡Œ osm èµ„æºå’ŒæœåŠ¡çš„æ­£å¼å®‰è£…å‰ï¼Œå…ˆåšä¸ªå¿…è¦çš„æ£€æŸ¥ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ linux-amd64 ./osm check --pre-install
ok: initialize Kubernetes client
ok: query Kubernetes API
ok: Kubernetes version
ok: can create namespaces
ok: can create customresourcedefinitions
ok: can create clusterroles
ok: can create clusterrolebindings
ok: can create mutatingwebhookconfigurations
ok: can create serviceaccounts
ok: can create services
ok: can create deployments
ok: can create configmaps
ok: can &lt;span class="nb">read&lt;/span> secrets
ok: can modify iptables
All checks successful!
&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¯ä»¥çœ‹åˆ°ä¸»è¦æ˜¯å’Œæƒé™ç›¸å…³çš„ä¸€äº›æ£€æŸ¥ã€‚æ¥ä¸‹æ¥å°±æ­£å¼å¯¹ ocm ç›¸å…³èµ„æºè¿›è¡Œéƒ¨ç½²ã€‚&lt;/p>
&lt;p>é»˜è®¤ä½¿ç”¨çš„é•œåƒï¼Œæ‰˜ç®¡åœ¨ DockerHub ä¸Šï¼Œå¦‚æœéœ€è¦é…ç½®åŠ é€Ÿçš„å°ä¼™ä¼´ï¼Œå¯ä¼ é€’ &lt;code>--container-registry&lt;/code> æ›´æ”¹æºåœ°å€ï¼Œä»¥ä¾¿äºåŠ é€Ÿå®‰è£…è¿›åº¦ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ linux-amd64 ./osm install
OSM installed successfully in namespace &lt;span class="o">[&lt;/span>osm-system&lt;span class="o">]&lt;/span> with mesh name &lt;span class="o">[&lt;/span>osm&lt;span class="o">]&lt;/span>
&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ linux-amd64 kubectl -n osm-system get pods
NAME READY STATUS RESTARTS AGE
osm-controller-d499d6cc7-88659 0/1 ContainerCreating &lt;span class="m">0&lt;/span> 12s
osm-grafana-58ff65dfb7-svztv 0/1 ContainerCreating &lt;span class="m">0&lt;/span> 12s
osm-prometheus-5756769877-zj6f6 0/1 ContainerCreating &lt;span class="m">0&lt;/span> 12s
zipkin-6df4b57677-dcq8q 0/1 ContainerCreating &lt;span class="m">0&lt;/span> 12s
&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¯ä»¥çœ‹åˆ°é»˜è®¤å®‰è£…å®Œæˆåï¼Œéƒ½åœ¨ &lt;code>osm-system&lt;/code> å‘½åç©ºé—´ä¸‹ï¼Œæœ‰ 4 ä¸ª Pods&lt;/p>
&lt;ul>
&lt;li>osm-controllerï¼šæ§åˆ¶è°¬&lt;/li>
&lt;li>osm-grafanaï¼šDashboard ç›¸å…³ï¼Œå¯é€šè¿‡ &lt;code>osm dashboard&lt;/code> å‘½ä»¤å”¤èµ·ï¼›&lt;/li>
&lt;li>osm-prometheusï¼šé‡‡é›† metrics ï¼›&lt;/li>
&lt;li>zipkinï¼šé“¾è·¯è¿½è¸ª&lt;/li>
&lt;/ul>
&lt;p>è¿˜æœ‰å¯¹åº”çš„ service è®°å½•.&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ linux-amd64 kubectl -n osm-system get svc
NAME TYPE CLUSTER-IP EXTERNAL-IP PORT&lt;span class="o">(&lt;/span>S&lt;span class="o">)&lt;/span> AGE
osm-controller ClusterIP 10.97.115.1 &amp;lt;none&amp;gt; 15128/TCP,443/TCP 7m46s
osm-grafana ClusterIP 10.110.209.86 &amp;lt;none&amp;gt; 3000/TCP 7m46s
osm-prometheus ClusterIP 10.97.10.65 &amp;lt;none&amp;gt; 7070/TCP 7m46s
zipkin ClusterIP 10.103.150.158 &amp;lt;none&amp;gt; 9411/TCP 7m46s
&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä»¥åŠä¸€ç³»åˆ—çš„ CRD&lt;/p>
&lt;pre>&lt;code>(MoeLove) âœ linux-amd64 kubectl -n osm-system get crd
NAME CREATED AT
backpressures.policy.openservicemesh.io 2020-08-06T16:14:03Z
httproutegroups.specs.smi-spec.io 2020-08-06T16:14:03Z
tcproutes.specs.smi-spec.io 2020-08-06T16:14:03Z
trafficsplits.split.smi-spec.io 2020-08-06T16:14:03Z
traffictargets.access.smi-spec.io 2020-08-06T16:14:03Z
&lt;/code>&lt;/pre>&lt;h2 id="å®è·µ">å®è·µ&lt;/h2>
&lt;ul>
&lt;li>åˆ›å»ºå®éªŒç”¨çš„ namespace, å¹¶é€šè¿‡ &lt;code>osm namespace add&lt;/code> å°†å…¶çº³å…¥ç®¡ç†èŒƒå›´ä¸­ï¼š&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ ~ kubectl create ns bookstore
namespace/bookstore created
&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ ~ kubectl create ns bookbuyer
namespace/bookbuyer created
&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ ~ kubectl create ns bookthief
namespace/bookthief created
&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ ~ kubectl create ns bookwarehouse
namespace/bookwarehouse created
&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ ~ osm namespace add bookstore bookbuyer bookthief bookwarehouse
Namespace &lt;span class="o">[&lt;/span>bookstore&lt;span class="o">]&lt;/span> succesfully added to mesh &lt;span class="o">[&lt;/span>osm&lt;span class="o">]&lt;/span>
Namespace &lt;span class="o">[&lt;/span>bookbuyer&lt;span class="o">]&lt;/span> succesfully added to mesh &lt;span class="o">[&lt;/span>osm&lt;span class="o">]&lt;/span>
Namespace &lt;span class="o">[&lt;/span>bookthief&lt;span class="o">]&lt;/span> succesfully added to mesh &lt;span class="o">[&lt;/span>osm&lt;span class="o">]&lt;/span>
Namespace &lt;span class="o">[&lt;/span>bookwarehouse&lt;span class="o">]&lt;/span> succesfully added to mesh &lt;span class="o">[&lt;/span>osm&lt;span class="o">]&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>éƒ¨ç½²å®éªŒåº”ç”¨ç¨‹åº&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="c1"># åœ¨é¡¹ç›®çš„ä»£ç ç›®å½•ä¸­æ‰§è¡Œ&lt;/span>
&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ osm git:&lt;span class="o">(&lt;/span>main&lt;span class="o">)&lt;/span> kubectl apply -f docs/example/manifests/apps
Warning: kubectl apply should be used on resource created by either kubectl create --save-config or kubectl apply
namespace/bookbuyer configured
serviceaccount/bookbuyer created
service/bookbuyer created
deployment.apps/bookbuyer created
Warning: kubectl apply should be used on resource created by either kubectl create --save-config or kubectl apply
namespace/bookstore configured
service/bookstore created
service/bookstore-v1 created
serviceaccount/bookstore-v1 created
deployment.apps/bookstore-v1 created
Warning: kubectl apply should be used on resource created by either kubectl create --save-config or kubectl apply
namespace/bookthief configured
serviceaccount/bookthief created
service/bookthief created
deployment.apps/bookthief created
Warning: kubectl apply should be used on resource created by either kubectl create --save-config or kubectl apply
namespace/bookwarehouse configured
serviceaccount/bookwarehouse created
service/bookwarehouse created
deployment.apps/bookwarehouse created
trafficsplit.split.smi-spec.io/bookstore-split created
&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>æœ¬åœ°è®¿é—®&lt;/li>
&lt;/ul>
&lt;p>ä½ å¯ä»¥é€šè¿‡ &lt;code>kubectl port-foward&lt;/code> åœ¨æœ¬åœ°å¯¹åˆšæ‰éƒ¨ç½²çš„åº”ç”¨è¿›è¡Œè®¿é—®ã€‚ç¤ºä¾‹ä¸­ä¹Ÿæä¾›äº†ç›¸åº”çš„å¯åŠ¨è„šæœ¬ &lt;code>scripts/port-forward-all.sh&lt;/code> ï¼Œæ³¨æ„è¿™é‡Œéœ€è¦å…ˆå®‰è£… GNU parallel ï¼Œä¾‹å¦‚ï¼š &lt;code>dnf install parallel&lt;/code> .&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ osm git:&lt;span class="o">(&lt;/span>main&lt;span class="o">)&lt;/span> âœ— ./scripts/port-forward-all.sh
Academic tradition requires you to cite works you base your article on.
If you use programs that use GNU Parallel to process data &lt;span class="k">for&lt;/span> an article in a
scientific publication, please cite:
O. Tange &lt;span class="o">(&lt;/span>2018&lt;span class="o">)&lt;/span>: GNU Parallel 2018, Mar 2018, ISBN 9781387509881,
DOI https://doi.org/10.5281/zenodo.1146014
This helps funding further development&lt;span class="p">;&lt;/span> AND IT WON&lt;span class="s1">&amp;#39;T COST YOU A CENT.
&lt;/span>&lt;span class="s1">If you pay 10000 EUR you should feel free to use GNU Parallel without citing.
&lt;/span>&lt;span class="s1">
&lt;/span>&lt;span class="s1">More about funding GNU Parallel and the citation notice:
&lt;/span>&lt;span class="s1">https://www.gnu.org/software/parallel/parallel_design.html#Citation-notice
&lt;/span>&lt;span class="s1">
&lt;/span>&lt;span class="s1">To silence this citation notice: run &amp;#39;&lt;/span>parallel --citation&lt;span class="err">&amp;#39;&lt;/span> once.
&lt;/code>&lt;/pre>&lt;/div>&lt;p>è®¿é—®æœ¬åœ°çš„ &lt;code>8080~8083&lt;/code> ç«¯å£å³å¯çœ‹åˆ°ç¤ºä¾‹é¡¹ç›®ã€‚ä¾‹å¦‚ï¼š&lt;/p>
&lt;p>&lt;img src="https://moelove.info/img/osm-bookbuyer.png" alt="">&lt;/p>
&lt;p>&lt;em>å¤‡æ³¨ï¼šè¿™é‡Œæ˜¯å› ä¸ºæˆ‘çš„åº”ç”¨ç¨‹åºå·²ç»è¿è¡Œä¸€æ®µæ—¶é—´äº†ï¼Œå¦‚æœæ˜¯æ–°éƒ¨ç½²çš„ï¼Œæ‰€æœ‰æ•°å­—çš†ä¸º 0&lt;/em>&lt;/p>
&lt;ul>
&lt;li>è®¿é—®æ§åˆ¶ç­–ç•¥&lt;/li>
&lt;/ul>
&lt;p>æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•è°ƒæ•´è®¿é—®æ§åˆ¶çš„ç­–ç•¥&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">TrafficTarget&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">access.smi-spec.io/v1alpha2&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">bookstore-v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">namespace&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">bookstore&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">destination&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ServiceAccount&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">bookstore-v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">namespace&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">bookstore&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">rules&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">HTTPRouteGroup&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">bookstore-service-routes&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">matches&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="l">buy-a-book&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="l">books-bought&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">sources&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ServiceAccount&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">bookbuyer&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">namespace&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">bookbuyer&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">#- kind: ServiceAccount&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">#name: bookthief&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">#namespace: bookthief&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nn">---&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">specs.smi-spec.io/v1alpha3&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">HTTPRouteGroup&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">bookstore-service-routes&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">namespace&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">bookstore&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">matches&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">books-bought&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">pathRegex&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/books-bought&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">methods&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="l">GET&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">headers&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">host&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;bookstore.bookstore&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">&amp;#34;user-agent&amp;#34;: &lt;/span>&lt;span class="s2">&amp;#34;.*-http-client/*.*&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">&amp;#34;client-app&amp;#34;: &lt;/span>&lt;span class="s2">&amp;#34;bookbuyer&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">buy-a-book&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">pathRegex&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;.*a-book.*new&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">methods&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="l">GET&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">headers&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">host&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;bookstore.bookstore&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™é‡Œå®šä¹‰äº†ä¸¤ä¸ª SMI ä¸­çš„èµ„æº &lt;code>TrafficTarget&lt;/code> å’Œ &lt;code>HTTPRouteGroup&lt;/code> ï¼Œç”¨æ¥æ§åˆ¶å…¥å£æµé‡ã€‚&lt;/p>
&lt;pre>&lt;code>(MoeLove) âœ osm git:(main) âœ— kubectl apply -f docs/example/manifests/access/
&lt;/code>&lt;/pre>&lt;p>é€šè¿‡ä»¥ä¸Šå‘½ä»¤åˆ›å»ºè¿™ä¸¤ä¸ªèµ„æºã€‚ç„¶åå†æ¬¡æ‰“å¼€æˆ‘ä»¬çš„ç¤ºä¾‹åº”ç”¨ç¨‹åºï¼Œå°±ä¼šçœ‹åˆ°å¯¹åº”çš„è®¡æ•°æ­£åœ¨é€æ­¥å¢åŠ ï¼ˆå› ä¸ºè¯·æ±‚è¢«æ”¾è¡Œäº†ï¼‰ ã€‚&lt;/p>
&lt;p>&lt;em>ä»¥ä¸Šç¤ºä¾‹æ¥è‡ªäº&lt;a href="https://github.com/openservicemesh/osm">é¡¹ç›®ä»“åº“&lt;/a> ä¸­çš„ç¤ºä¾‹ã€‚&lt;/em>&lt;/p>
&lt;h2 id="dashboard">Dashboard&lt;/h2>
&lt;p>é€šè¿‡ &lt;code>osm dashboard&lt;/code> å¯ç›´æ¥å”¤èµ·æœ¬åœ°æµè§ˆå™¨ï¼Œå¹¶ port-foward å°† Grafana æ‰“å¼€ã€‚&lt;/p>
&lt;p>&lt;img src="https://moelove.info/img/osm-dashboard.png" alt="">&lt;/p>
&lt;h2 id="æ€»ç»“">æ€»ç»“&lt;/h2>
&lt;p>Open Service Mesh ç›¸å¯¹æ¥è¯´ï¼Œç¡®å®å¾ˆè½»é‡ã€‚ æ‰€éœ€è¦çš„è®¿é—®æ§åˆ¶ï¼Œæµé‡åˆ‡å‰²ç­‰åŠŸèƒ½é€šè¿‡è‡ªå·±åˆ›å»º SMI èµ„æºæ¥æ§åˆ¶ã€‚&lt;/p>
&lt;p>å¹¶ä¸”ï¼Œåœ¨åŒä¸€ä¸ªé›†ç¾¤å†…å¯å­˜åœ¨å¤šç»„ mesh ï¼Œosm å®‰è£…çš„æ—¶å€™ï¼Œå¯æŒ‡å®š mesh åç§°ã€‚&lt;/p>
&lt;p>æ­¤å¤–ï¼Œè¿™ä¸ªé¡¹ç›®ä¹Ÿæ˜¯å¾®è½¯åœ¨ Service Mesh æ–¹å‘çš„åˆä¸€ä¸ªå¤§åŠ¨ä½œäº†ã€‚ç›®æ ‡ä¹Ÿè®¸æ˜¯ Istio ã€‚è®©æˆ‘ä»¬æ‹­ç›®ä»¥å¾…ã€‚&lt;/p>
&lt;hr>
&lt;p>æ¬¢è¿è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category><category domain="https://moelove.info/tags/Istio/">Istio</category><category domain="https://moelove.info/tags/servicemesh/">servicemesh</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| Istio å·²ä¿®å¤å¯¼è‡´ Pod å´©æºƒçš„ bug</title><link>https://moelove.info/2020/08/02/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Istio-%E5%B7%B2%E4%BF%AE%E5%A4%8D%E5%AF%BC%E8%87%B4-Pod-%E5%B4%A9%E6%BA%83%E7%9A%84-bug/</link><guid isPermaLink="true">https://moelove.info/2020/08/02/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Istio-%E5%B7%B2%E4%BF%AE%E5%A4%8D%E5%AF%BC%E8%87%B4-Pod-%E5%B4%A9%E6%BA%83%E7%9A%84-bug/</guid><pubDate>Sun, 02 Aug 2020 10:21:43 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="istio-167-å‘å¸ƒ">Istio 1.6.7 å‘å¸ƒ&lt;/h2>
&lt;p>Istio 1.6.7 æ˜¯ä¸ºäº†è§£å†³åœ¨ 1.6.6 ä¸­å¼•å…¥çš„&lt;a href="https://github.com/istio/istio/commit/bae28dde42cf54e213d4c6bcd9c930f8d9ee60c4" title="bug">ä¸€ä¸ª bug&lt;/a>ã€‚&lt;/p>
&lt;p>è¯¥ bug å¯èƒ½ä¼šå¯¼è‡´ &lt;strong>åœ¨ä½¿ç”¨ Istio 1.6.6 æ—¶ï¼ŒæŸäº› Pod è¿›å…¥ &lt;code>CrashLoopBackOff&lt;/code> çŠ¶æ€ï¼Œæ— æ³•æ­£å¸¸æä¾›æœåŠ¡ã€‚&lt;/strong>&lt;/p>
&lt;p>ä¿®å¤åçš„æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼Œè¿™é‡Œä¸»è¦æ˜¯å¢åŠ å¦ä¸€ä¸ªè¿”å›å€¼ &lt;code>expectpod&lt;/code> ã€‚&lt;/p>
&lt;p>é€šè¿‡æ­¤æ–¹æ³•è·å– Pod æ—¶ï¼ŒPod æœ‰ä¸¤ç§æƒ…å†µå¯èƒ½ä¸ºç©ºï¼š&lt;/p>
&lt;ul>
&lt;li>è¯¥ endpoint æœªå…³è” Podï¼Œè¿™æ—¶ expectpod ä¸º &lt;code>false&lt;/code>ï¼›&lt;/li>
&lt;li>è¯¥ endpoint å·²å…³è” Podï¼Œä½†æœªæ‰¾åˆ° Podï¼Œè¿™æ—¶ expectpod ä¸º &lt;code>true&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>è€Œè¿™ç§æƒ…å†µå‘ç”Ÿçš„æœ€ä¸»è¦åŸå› å¯èƒ½æ˜¯ç”±äºæœ€ç»ˆä¸€è‡´æ€§ï¼Œæˆ–è€…ä¹±åºäº‹ä»¶ç­‰ã€‚&lt;/p>
&lt;p>&lt;strong>å»ºè®®å¦‚æœæ‰“ç®—å‡çº§ Istio çš„è¯»è€…ï¼Œç›´æ¥è·³è¿‡ 1.6.6 ç‰ˆæœ¬ï¼Œä»¥å…å½±å“åˆ°æœåŠ¡ã€‚&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="kd">func&lt;/span> &lt;span class="nf">getPod&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">c&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">Controller&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">ip&lt;/span> &lt;span class="kt">string&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">ep&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">metav1&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">ObjectMeta&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">targetRef&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">v1&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">ObjectReference&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">host&lt;/span> &lt;span class="nx">host&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Name&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">rpod&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">v1&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Pod&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">expectPod&lt;/span> &lt;span class="kt">bool&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">pod&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">c&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">pods&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">getPodByIP&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">ip&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">pod&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="nx">pod&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kc">false&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">targetRef&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="nx">targetRef&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Kind&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s">&amp;#34;Pod&amp;#34;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">key&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">kube&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">KeyFunc&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">targetRef&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Name&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">targetRef&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Namespace&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="nx">podFromInformer&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">f&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">c&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">pods&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">informer&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">GetStore&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="nf">GetByKey&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">key&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="o">||&lt;/span> &lt;span class="p">!&lt;/span>&lt;span class="nx">f&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Debugf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Endpoint without pod %s %s.%s error: %v&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">ip&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">ep&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Name&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">ep&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Namespace&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="nx">endpointsWithNoPods&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Increment&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">c&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">metrics&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">c&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">metrics&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">AddMetric&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">model&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">EndpointNoPod&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nb">string&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">host&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="kc">nil&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">ip&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="nx">epkey&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">kube&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">KeyFunc&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">ep&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Name&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">ep&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Namespace&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="nx">c&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">pods&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">queueEndpointEventOnPodArrival&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">epkey&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">ip&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="kc">nil&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kc">true&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="nx">pod&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">podFromInformer&lt;/span>&lt;span class="p">.(&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="nx">v1&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Pod&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="nx">pod&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kc">false&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="trivy-v0101-å‘å¸ƒ">Trivy v0.10.1 å‘å¸ƒ&lt;/h2>
&lt;p>æœ¬å‘¨ Trivy ç›¸ç»§å‘å¸ƒäº† v0.10.0 å’Œ v0.10.1 ç‰ˆæœ¬ï¼Œæˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹æœ‰å“ªäº›å€¼å¾—å…³æ³¨çš„å†…å®¹å§ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://github.com/aquasecurity/trivy/pull/559">#559&lt;/a>å…è®¸é€šè¿‡ä½¿ç”¨ &lt;code>--severity&lt;/code> é€‰é¡¹è¿›è¡Œè¿‡æ»¤ï¼ŒåªæŸ¥çœ‹ç‰¹å®šçº§åˆ«çš„æ¼æ´ä¿¡æ¯&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ ~ trivy i --severity LOW alpine:3.10.2
2020-08-02T23:19:28.060+0800 INFO Detecting Alpine vulnerabilities...
alpine:3.10.2 &lt;span class="o">(&lt;/span>alpine 3.10.2&lt;span class="o">)&lt;/span>
&lt;span class="o">=============================&lt;/span>
Total: &lt;span class="m">1&lt;/span> &lt;span class="o">(&lt;/span>LOW: 1&lt;span class="o">)&lt;/span>
+---------+------------------+----------+-------------------+---------------+--------------------------------+
&lt;span class="p">|&lt;/span> LIBRARY &lt;span class="p">|&lt;/span> VULNERABILITY ID &lt;span class="p">|&lt;/span> SEVERITY &lt;span class="p">|&lt;/span> INSTALLED VERSION &lt;span class="p">|&lt;/span> FIXED VERSION &lt;span class="p">|&lt;/span> TITLE &lt;span class="p">|&lt;/span>
+---------+------------------+----------+-------------------+---------------+--------------------------------+
&lt;span class="p">|&lt;/span> openssl &lt;span class="p">|&lt;/span> CVE-2019-1547 &lt;span class="p">|&lt;/span> LOW &lt;span class="p">|&lt;/span> 1.1.1c-r0 &lt;span class="p">|&lt;/span> 1.1.1d-r0 &lt;span class="p">|&lt;/span> openssl: side-channel weak &lt;span class="p">|&lt;/span>
&lt;span class="p">|&lt;/span> &lt;span class="p">|&lt;/span> &lt;span class="p">|&lt;/span> &lt;span class="p">|&lt;/span> &lt;span class="p">|&lt;/span> &lt;span class="p">|&lt;/span> encryption vulnerability &lt;span class="p">|&lt;/span>
+---------+------------------+----------+-------------------+---------------+--------------------------------+
&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>&lt;a href="https://github.com/aquasecurity/trivy/pull/562">#562&lt;/a>æ”¯æŒé€šè¿‡ Open Policy Agent (OPA) æ¥è¿›è¡Œè¿‡æ»¤ã€‚&lt;/li>
&lt;/ul>
&lt;p>æ¯”æ–¹è¯´ï¼Œæˆ‘ä»¬æƒ³è¦å®ç°å’Œä¸Šé¢ä½¿ç”¨ &lt;code>--severity LOW&lt;/code> å‚æ•°ç›¸åŒçš„æ•ˆæœï¼Œé‚£æˆ‘ä»¬å¯ä»¥å®šä¹‰å¦‚ä¸‹ rego è§„åˆ™æ–‡ä»¶ã€‚æ³¨æ„ï¼š &lt;strong>åŒ…åå¿…é¡»ä¸º &lt;code>trivy&lt;/code>&lt;/strong> ï¼ŒåŒæ—¶ï¼Œå®ƒè¿˜å¿…é¡»åŒ…å«ä¸€ä¸ªåä¸º &lt;code>ignore&lt;/code> çš„è§„åˆ™ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="p">(&lt;/span>&lt;span class="nx">MoeLove&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="err">âœ&lt;/span> &lt;span class="err">~&lt;/span> &lt;span class="nx">cat&lt;/span> &lt;span class="nx">test_trivy&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">rego&lt;/span>
&lt;span class="kn">package&lt;/span> &lt;span class="nx">trivy&lt;/span>
&lt;span class="nx">ignore&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">input&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Severity&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="s">&amp;#34;UNKNOWN&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;MEDIUM&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;HIGH&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;CRITICAL&amp;#34;&lt;/span>&lt;span class="p">}[&lt;/span>&lt;span class="nx">_&lt;/span>&lt;span class="p">]&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>é€šè¿‡ç»™ &lt;code>trivy&lt;/code> ä¼ é€’ &lt;code>--ignore-policy&lt;/code> å‚æ•°å³å¯ã€‚ï¼ˆè¿™é‡Œä¸€å®šè¦æ³¨æ„ææ¸…æ¥šé€»è¾‘ï¼Œ &lt;strong>trivy çš„å‚æ•°ä¸ºå¿½ç•¥æ‰åŒ¹é…æˆåŠŸçš„è§„åˆ™&lt;/strong>ã€‚ï¼‰&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ ~ trivy image --ignore-policy test_trivy.rego alpine:3.10.2
2020-08-02T23:54:40.843+0800 INFO Detecting Alpine vulnerabilities...
alpine:3.10.2 &lt;span class="o">(&lt;/span>alpine 3.10.2&lt;span class="o">)&lt;/span>
&lt;span class="o">=============================&lt;/span>
Total: &lt;span class="m">1&lt;/span> &lt;span class="o">(&lt;/span>UNKNOWN: 0, LOW: 1, MEDIUM: 0, HIGH: 0, CRITICAL: 0&lt;span class="o">)&lt;/span>
+---------+------------------+----------+-------------------+---------------+--------------------------------+
&lt;span class="p">|&lt;/span> LIBRARY &lt;span class="p">|&lt;/span> VULNERABILITY ID &lt;span class="p">|&lt;/span> SEVERITY &lt;span class="p">|&lt;/span> INSTALLED VERSION &lt;span class="p">|&lt;/span> FIXED VERSION &lt;span class="p">|&lt;/span> TITLE &lt;span class="p">|&lt;/span>
+---------+------------------+----------+-------------------+---------------+--------------------------------+
&lt;span class="p">|&lt;/span> openssl &lt;span class="p">|&lt;/span> CVE-2019-1547 &lt;span class="p">|&lt;/span> LOW &lt;span class="p">|&lt;/span> 1.1.1c-r0 &lt;span class="p">|&lt;/span> 1.1.1d-r0 &lt;span class="p">|&lt;/span> openssl: side-channel weak &lt;span class="p">|&lt;/span>
&lt;span class="p">|&lt;/span> &lt;span class="p">|&lt;/span> &lt;span class="p">|&lt;/span> &lt;span class="p">|&lt;/span> &lt;span class="p">|&lt;/span> &lt;span class="p">|&lt;/span> encryption vulnerability &lt;span class="p">|&lt;/span>
+---------+------------------+----------+-------------------+---------------+--------------------------------+
&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>&lt;a href="https://github.com/aquasecurity/trivy/pull/561">#561&lt;/a>åœ¨è¾“å‡ºå†…å®¹ä¸­æ–°å¢åŠ äº† &lt;code>CweIDs&lt;/code> å­—æ®µã€‚&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ ~ trivy image -f json --ignore-policy test_trivy.rego alpine:3.10.2
&lt;span class="o">[&lt;/span>
&lt;span class="o">{&lt;/span>
&lt;span class="s2">&amp;#34;Target&amp;#34;&lt;/span>: &lt;span class="s2">&amp;#34;alpine:3.10.2 (alpine 3.10.2)&amp;#34;&lt;/span>,
&lt;span class="s2">&amp;#34;Type&amp;#34;&lt;/span>: &lt;span class="s2">&amp;#34;alpine&amp;#34;&lt;/span>,
&lt;span class="s2">&amp;#34;Vulnerabilities&amp;#34;&lt;/span>:
&lt;span class="o">{&lt;/span>
&lt;span class="s2">&amp;#34;VulnerabilityID&amp;#34;&lt;/span>: &lt;span class="s2">&amp;#34;CVE-2019-1547&amp;#34;&lt;/span>,
&lt;span class="s2">&amp;#34;PkgName&amp;#34;&lt;/span>: &lt;span class="s2">&amp;#34;openssl&amp;#34;&lt;/span>,
&lt;span class="s2">&amp;#34;InstalledVersion&amp;#34;&lt;/span>: &lt;span class="s2">&amp;#34;1.1.1c-r0&amp;#34;&lt;/span>,
&lt;span class="s2">&amp;#34;FixedVersion&amp;#34;&lt;/span>: &lt;span class="s2">&amp;#34;1.1.1d-r0&amp;#34;&lt;/span>,
&lt;span class="s2">&amp;#34;CweIDs&amp;#34;&lt;/span>: &lt;span class="o">[&lt;/span>
&lt;span class="s2">&amp;#34;CWE-311&amp;#34;&lt;/span>
&lt;span class="o">]&lt;/span>,
...
&lt;span class="o">}&lt;/span>
&lt;span class="o">}&lt;/span>
&lt;span class="o">]&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>&lt;a href="https://github.com/aquasecurity/trivy/pull/574">#574&lt;/a> å¢åŠ äº† &lt;code>--list-all-pkgs&lt;/code> é€‰é¡¹ï¼Œå…è®¸è¾“å‡ºè¢«æ‰«æç³»ç»Ÿä¸­å·²ç»å®‰è£…çš„åŒ…åŠå…¶ç‰ˆæœ¬ç­‰ã€‚&lt;/li>
&lt;/ul>
&lt;p>è€Œåç»­å‘å¸ƒçš„ &lt;strong>v0.10.1 ç‰ˆæœ¬ä¸»è¦æ˜¯ä¸ºäº†ä¿®æ­£ v0.10.0 ä¸­å¯¹ Dockerfile ä¸­æ‰§è¡Œç”¨æˆ·çš„ä¿®æ”¹ï¼Œç»§ç»­ä½¿ç”¨ root ç”¨æˆ·ä½œä¸ºå®¹å™¨é•œåƒä¸­çš„é»˜è®¤ç”¨æˆ·&lt;/strong> ã€‚&lt;/p>
&lt;p>æ›´å¤šå…³äºæ­¤ç‰ˆæœ¬çš„ä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹ &lt;a href="https://github.com/aquasecurity/trivy/releases/tag/v0.10.1">Trivy ReleaseNote&lt;/a>, æ¬¢è¿ä¸‹è½½ä½¿ç”¨ã€‚&lt;/p>
&lt;h2 id="ä¸Šæ¸¸è¿›å±•">ä¸Šæ¸¸è¿›å±•&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/pull/93248">#93248&lt;/a> ä¿®æ”¹äº† Kubelet ä¸­ CFS shares ç›¸å…³çš„é€»è¾‘ï¼Œä¸ºå…¶è®¾ç½®æœ€å¤§å€¼ä¸ºå†…æ ¸å…è®¸çš„æœ€å¤§å€¼ï¼Œå³ 2^18=262144 ã€‚&lt;/li>
&lt;/ul>
&lt;p>é€šè¿‡æ­¤æ¬¡ä¿®æ”¹ï¼ŒKubelet ä½¿ç”¨ systemd ä½œä¸º cgroups é©±åŠ¨æ—¶ï¼Œèƒ½æ­£å¸¸çš„å¤„ç† CPU æ ¸æ•°å¤§äº 512 çš„æœºå™¨ï¼ˆå¦‚æœä½¿ç”¨ cgroupfs ä½œä¸º cgroup é©±åŠ¨çš„è¯ï¼Œä¸€ç›´éƒ½å¯ä»¥ï¼Œå› ä¸ºå†…æ ¸ä¼šç›´æ¥è¿›è¡Œå¤„ç†ï¼‰&lt;/p>
&lt;p>æœ‰å…³ Linux å†…æ ¸ CFS ç›¸å…³å†…å®¹ï¼Œå¯ä»¥å‚è€ƒæˆ‘ä¹‹å‰å†™çš„æ–‡ç«  &lt;a href="https://gitbook.cn/gitchat/column/5d70cfdc4dc213091bfca46f">Docker å®¹å™¨èµ„æºç®¡ç†&lt;/a>&lt;/p>
&lt;hr>
&lt;p>æ¬¢è¿è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| NGINX Ingress Controlleråˆæ·»æ–°ç‰¹æ€§</title><link>https://moelove.info/2020/07/26/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-NGINX-Ingress-Controller%E5%8F%88%E6%B7%BB%E6%96%B0%E7%89%B9%E6%80%A7/</link><guid isPermaLink="true">https://moelove.info/2020/07/26/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-NGINX-Ingress-Controller%E5%8F%88%E6%B7%BB%E6%96%B0%E7%89%B9%E6%80%A7/</guid><pubDate>Sun, 26 Jul 2020 21:44:38 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="conftest-æ­£å¼åŠ å…¥-open-policy-agent-é¡¹ç›®">Conftest æ­£å¼åŠ å…¥ Open Policy Agent é¡¹ç›®&lt;/h2>
&lt;p>&lt;a href="https://www.conftest.dev/">conftest&lt;/a> æ˜¯ä¸€ä¸ªéå¸¸å®ç”¨çš„ CLI å·¥å…·ï¼Œå¯ä»¥ç”¨äºæµ‹è¯•/éªŒè¯é…ç½®æ–‡ä»¶æ˜¯å¦ç¬¦åˆé¢„æœŸã€‚ä¾‹å¦‚ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹å†…å®¹æ¥å®šä¹‰è§„åˆ™ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="kn">package&lt;/span> &lt;span class="nx">main&lt;/span>
&lt;span class="nx">deny&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nx">msg&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">input&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">kind&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s">&amp;#34;Deployment&amp;#34;&lt;/span>
&lt;span class="nx">not&lt;/span> &lt;span class="nx">input&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">spec&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">template&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">spec&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">securityContext&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">runAsNonRoot&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="kc">true&lt;/span>
&lt;span class="nx">msg&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s">&amp;#34;Containers must not run as root&amp;#34;&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="nx">deny&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nx">msg&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">input&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">kind&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s">&amp;#34;Deployment&amp;#34;&lt;/span>
&lt;span class="nx">not&lt;/span> &lt;span class="nx">input&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">spec&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">selector&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">matchLabels&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">app&lt;/span>
&lt;span class="nx">msg&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s">&amp;#34;Containers must provide app label for pod selectors&amp;#34;&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä½¿ç”¨æ­¤è§„åˆ™å»æ£€æŸ¥ä¸€ä¸ªæœªç¬¦åˆé¢„æœŸè§„åˆ™çš„ Deployment çš„é…ç½®æ–‡ä»¶ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ conftest &lt;span class="nb">test&lt;/span> deployment.yaml
FAIL - deployment.yaml - Containers must not run as root
FAIL - deployment.yaml - Deployments are not allowed
&lt;span class="m">2&lt;/span> tests, &lt;span class="m">0&lt;/span> passed, &lt;span class="m">0&lt;/span> warnings, &lt;span class="m">2&lt;/span> failures
&lt;/code>&lt;/pre>&lt;/div>&lt;p>å°±ä¼šçœ‹åˆ°æœ‰ç›¸åº”çš„æ£€æŸ¥ç»“æœäº†ã€‚&lt;/p>
&lt;p>è‡³äº &lt;a href="https://www.openpolicyagent.org/">OPA&lt;/a> å®ƒæ˜¯ä¸€ä¸ªç­–ç•¥å¼•æ“ï¼Œæä¾›äº†ä¸€ç§éå¸¸çµæ´»çš„æ–¹å¼æ¥å£°æ˜ç­–ç•¥ã€‚&lt;/p>
&lt;p>conftest æ­£å¼åŠ å…¥ OPA é¡¹ç›®ï¼Œå¯ä»¥æ›´å¥½çš„è®©å½¼æ­¤è¿›è¡Œé›†æˆå’Œç»„åˆä½¿ç”¨ã€‚å¹¶ä¸”ï¼Œåœ¨ conftest åŠ å…¥ OPA é¡¹ç›®åï¼Œä¼šæœ‰éƒ¨åˆ†åŠŸèƒ½ä» conftest ç§»è‡³ OPAï¼Œè®© conftest æ›´é—´ç®€ä¾¿ã€‚æœŸå¾…åç»­çš„å‘å±•ã€‚&lt;/p>
&lt;h2 id="traefik-v227-å‘å¸ƒ">Traefik v2.2.7 å‘å¸ƒ&lt;/h2>
&lt;p>Traefik v2.2.6 ä¸­ï¼Œä¿®å¤äº†ä¸€ä¸ªå®‰å…¨é—®é¢˜ã€‚
åœ¨æ ¡éªŒä½¿ç”¨åŸŸå‰ç½®çš„ TLS è¿æ¥æ—¶ï¼Œå¦‚æœ &lt;code>Host&lt;/code> å¤´ä¸ SNI ä¸åŒçš„è¯ï¼Œåˆ™ Traefik å°†ä¼šè¿”å› &lt;code>421&lt;/code> çŠ¶æ€ç ã€‚&lt;/p>
&lt;p>æ­¤æ¬¡ Traefik å‘å¸ƒçš„ v2.2.7 ç‰ˆæœ¬ï¼Œä¸»è¦æ˜¯ä¸ºäº†è§£å†³ä¸Šè¿°åœ¨ v2.2.6 ä¸­ç”±äºä¿®å¤æ­¤å®‰å…¨é—®é¢˜è€Œå¼•å…¥çš„ bug ã€‚&lt;/p>
&lt;p>ç°è±¡æ˜¯åœ¨ v2.2.6 ç‰ˆæœ¬ä¸­ï¼Œå¦‚æœä¸º Host æŒ‡å®šäº†éæ ‡å‡†ç«¯å£ï¼ˆ443ï¼‰çš„è¯ï¼Œåˆ™ Traefik ä¼šè¿”å› &lt;code>421&lt;/code> çŠ¶æ€ç ï¼Œä»è€Œå¯¼è‡´è¿æ¥å¼‚å¸¸ã€‚&lt;/p>
&lt;p>v2.2.7 ä¸­è§£å†³åŠæ³•ä¹Ÿå¾ˆç®€å•ï¼Œç›´æ¥å¿½ç•¥æ‰ Host ä¸­çš„ç«¯å£ï¼Œä¸ SNI è¿›è¡Œæ¯”è¾ƒå³å¯ã€‚&lt;/p>
&lt;p>å»ºè®®å¦‚æœæ‰“ç®—å‡çº§çš„è¯ï¼Œç›´æ¥å‡è‡³ v2.2.7 ï¼Œé¿å¼€ v2.2.6 ç‰ˆæœ¬ã€‚å¯é€šè¿‡ &lt;a href="https://github.com/containous/traefik/releases/tag/v2.2.7">Release é¡µé¢&lt;/a> ä¸‹è½½ä½¿ç”¨ã€‚&lt;/p>
&lt;h2 id="nginx-ingress-controller-v180-å‘å¸ƒ">NGINX Ingress Controller v1.8.0 å‘å¸ƒ&lt;/h2>
&lt;p>è¿™é‡Œä»‹ç»çš„æ˜¯ NGINX å®˜æ–¹çš„ Ingress Controller é¡¹ç›®ï¼ˆé¿å…å’Œç¤¾åŒºçš„ Kubernetes NGINX Ingress Controller ææ··ï¼‰ ã€‚&lt;/p>
&lt;p>æ­¤æ¬¡ç‰ˆæœ¬ä¸­æœ‰å‡ ä¸ªéå¸¸å€¼å¾—å…³æ³¨çš„ç‰¹æ€§ã€‚&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://github.com/nginxinc/kubernetes-ingress/pull/1028">#1028&lt;/a> æ–°å¢äº†ä¸€ç§èµ„æº &lt;code>Policy&lt;/code> ã€‚&lt;/li>
&lt;/ul>
&lt;p>&lt;code>Policy&lt;/code> èµ„æºå…è®¸ä½ ä¸º VirtualServer èµ„æºæ·»åŠ è®¿é—®æ§åˆ¶ï¼Œå¯ä½œç”¨äº è®¤è¯ï¼Œé™æµå’Œ WAF ä¹‹ç±»çš„ç‰¹æ€§ã€‚ç”±äºæ­¤ç‰ˆæœ¬ä¸­æ˜¯é¦–æ¬¡æ·»åŠ ï¼Œç›®å‰åªå®ç°äº†åŸºäº IP çš„è®¿é—®æ§åˆ¶ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥é€šè¿‡ä¸‹æ–¹çš„é…ç½®æ–‡ä»¶ï¼Œæ¥å…è®¸ &lt;code>10.0.0.0/8&lt;/code> çš„è®¿é—®ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">k8s.nginx.org/v1alpha1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Policy &lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">allow-localhost&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">accessControl&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">allow&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="m">10.0.0.0&lt;/span>&lt;span class="l">/8&lt;/span>&lt;span class="w">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>&lt;a href="https://github.com/nginxinc/kubernetes-ingress/pull/1019">#1019&lt;/a> æ”¯æŒæ³¨å…¥ç‰‡æ®µï¼ˆ Snippets ï¼‰&lt;/li>
&lt;/ul>
&lt;p>ä½¿ç”¨ Snippets å…è®¸ä½ ä¸º VirtualServer é…ç½®æ³¨å…¥ä¸€æ®µåŸç”Ÿçš„ NGINX é…ç½®ç‰‡æ®µï¼Œç”¨äºè¦†ç›–é»˜è®¤é…ç½®ã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">k8s.nginx.org/v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">VirtualServer&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">cafe&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">namespace&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">cafe&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">http-snippets&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">|&lt;/span>&lt;span class="sd">
&lt;/span>&lt;span class="sd"> limit_req_zone $binary_remote_addr zone=mylimit:10m rate=1r/s;
&lt;/span>&lt;span class="sd"> proxy_cache_path /tmp keys_zone=one:10m;&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">host&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">cafe.example.com&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">tls&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">secret&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">cafe-secret&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">server-snippets&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">|&lt;/span>&lt;span class="sd">
&lt;/span>&lt;span class="sd"> &lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">limit_req zone=mylimit burst=20;&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">upstreams&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">tea&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">service&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">tea-svc&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">port&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">80&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">coffee&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">service&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">coffee-svc&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">port&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">80&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">routes&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">path&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/tea&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">location-snippets&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">|&lt;/span>&lt;span class="sd">
&lt;/span>&lt;span class="sd"> proxy_cache one;
&lt;/span>&lt;span class="sd"> proxy_cache_valid 200 10m;&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">action&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">pass&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">tea&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">path&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/coffee&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">action&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">pass&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">coffee&lt;/span>&lt;span class="w">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä½†è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœä½ ä½¿ç”¨æ­¤ç‰¹æ€§ï¼Œæˆ‘å»ºè®®ä½ åœ¨ä½¿ç”¨ä¹‹å‰ï¼Œæ¸…æ¥šçš„ç†è§£è‡ªå·±é…ç½®çš„å«ä¹‰ã€‚å› ä¸ºç”¨è¿™ç§æ–¹å¼é…ç½®ï¼Œä¼šç»•è¿‡ Ingress Controller çš„æ ¡éªŒè¿‡ç¨‹ã€‚ä¼šæ¯”è¾ƒå±é™©ã€‚å¹¶ä¸”ä½¿ç”¨æ­¤ç‰¹æ€§ï¼Œä¸å¤Ÿç›´è§‚ã€‚ä½†ï¼Œå´å¯ä»¥è®©ä½ å¯¹ NGINX æœ‰æ›´å¼ºçš„æ§åˆ¶èƒ½åŠ›ã€‚&lt;/p>
&lt;p>æ›´å¤šå…³äºæ­¤ç‰ˆæœ¬çš„ä¿¡æ¯ï¼Œè¯·å‚è€ƒå…¶ &lt;a href="https://github.com/nginxinc/kubernetes-ingress/releases/tag/v1.8.0">RelaseNote&lt;/a>&lt;/p>
&lt;h2 id="ä¸Šæ¸¸è¿›å±•">ä¸Šæ¸¸è¿›å±•&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/pull/92986">#92986&lt;/a> å¦‚æœ CSI é©±åŠ¨æŠ›å‡º FailedPrecondition é”™è¯¯ï¼Œåˆ™åœæ­¢é‡è¯•å¯¹å·è¿›è¡Œæ‰©å±•ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/pull/80917">#80917&lt;/a> ç§»æ¤ deviceManager åˆ° Windows å®¹å™¨ç®¡ç†ä¸­ä»¥æ”¯æŒ GPU çš„è®¿é—®ã€‚ï¼ˆè¿™æ˜¯ä¸€ä¸ªå¾ˆå…³é”®çš„ç‰¹æ€§ï¼‰&lt;/li>
&lt;/ul>
&lt;hr>
&lt;p>æ¬¢è¿è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| Traefik v2.3.0-rc2 å‘å¸ƒ</title><link>https://moelove.info/2020/07/19/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Traefik-v2.3.0-rc2-%E5%8F%91%E5%B8%83/</link><guid isPermaLink="true">https://moelove.info/2020/07/19/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Traefik-v2.3.0-rc2-%E5%8F%91%E5%B8%83/</guid><pubDate>Sun, 19 Jul 2020 21:47:13 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="traefik-v230-rc2-å‘å¸ƒ">Traefik v2.3.0-rc2 å‘å¸ƒ&lt;/h2>
&lt;p>å…³äº Traefik çš„ç³»åˆ—ä»‹ç»å¯ä»¥å‚è€ƒä¹‹å‰å‘¨æŠ¥çš„å†…å®¹ï¼š&lt;a href="https://zhuanlan.zhihu.com/p/111833886">Traefik v2.2.0-rc1 å‘å¸ƒ&lt;/a>ã€‚æœ¬å‘¨å®ƒåˆå‘å¸ƒäº† v2.3.0-rc2 ç‰ˆæœ¬ï¼Œæˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹æœ‰å“ªäº›å€¼å¾—å…³æ³¨çš„å†…å®¹å§ï¼&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://github.com/containous/traefik/pull/6696">#6696&lt;/a> ä¸º Traefik åœ¨ terminating æ—¶ï¼Œæ·»åŠ è‡ªå®šä¹‰çš„ HTTP çŠ¶æ€ç ï¼›&lt;/li>
&lt;/ul>
&lt;p>å…·ä½“è€Œè¨€ï¼Œå¯é€šè¿‡ä»¥ä¸‹å‡ ç§æ–¹å¼è¿›è¡Œæ·»åŠ ï¼š&lt;/p>
&lt;p>&lt;strong>é…ç½®æ–‡ä»¶ï¼ˆYAMLï¼‰&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="nt">ping&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">terminatingStatusCode&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">204&lt;/span>&lt;span class="w">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>å‘½ä»¤è¡Œå‚æ•°&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">--ping.terminatingStatusCode&lt;span class="o">=&lt;/span>&lt;span class="m">204&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>ç¯å¢ƒå˜é‡&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="nv">TRAEFIK_PING_TERMINATINGSTATUSCODE&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">204&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>ç°åœ¨é»˜è®¤çš„çŠ¶æ€ç æ˜¯ 503&lt;/strong>&lt;/p>
&lt;p>å¢åŠ æ­¤é…ç½®çš„å¥½å¤„åœ¨äºï¼Œå½“ Traefik å¤„äº terminating çŠ¶æ€æ—¶ï¼Œå¯é€šè¿‡è®¾ç½®è‡ªå®šä¹‰çš„çŠ¶æ€ç æ¥å®ç°ä¼˜é›…ç»ˆæ­¢ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;a href="https://github.com/containous/traefik/pull/6875">#6875&lt;/a> ä½¿ç”¨ parser ä»æ–‡ä»¶ä¸­å–åŠ¨æ€é…ç½®; å€¼å¾—æ³¨æ„çš„æ˜¯ï¼š &lt;strong>å¦‚æœä»ä¹‹å‰ç‰ˆæœ¬å‡çº§è‡³ v2.3 é‚£ä¸€å®šéœ€è¦æ³¨æ„çš„æ˜¯å¦‚æœåŠ¨æ€é…ç½®ä¸­å­˜åœ¨æœªçŸ¥çš„å…¶ä»–å­—æ®µï¼Œåˆ™è¿”å›é”™è¯¯ã€‚&lt;/strong>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a href="https://github.com/containous/traefik/pull/7041">#7041&lt;/a> Traefik æä¾›äº† Plugins ç‰¹æ€§çš„æ”¯æŒã€‚å¯ä»¥é€šè¿‡æ­¤æœºåˆ¶ï¼Œè®© Traefik Pilot è¿æ¥åˆ° Traefik ï¼Œä»¥æ­¤æ¥å°†å…¶ SaaS èƒ½åŠ›æš´éœ²ç»™ç”¨æˆ·ã€‚åŒæ—¶ Traefik Pilot å¯ä»¥ç›‘æ§è¿æ¥åˆ°å®ƒçš„ä»»æ„ Traefik å®ä¾‹ï¼Œå¹¶æ”¯æŒå‘å‡ºæŠ¥è­¦ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>æ›´å¤šå…³äºæ­¤ç‰ˆæœ¬çš„ç‰¹æ€§è¯·å‚é˜…å…¶ &lt;a href="https://github.com/containous/traefik/releases/tag/v2.3.0-rc2">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="etcd-v3410-å‘å¸ƒ">etcd v3.4.10 å‘å¸ƒ&lt;/h2>
&lt;p>etcd åœ¨æœ¬å‘¨å‘å¸ƒäº† v3.4.10 ç‰ˆæœ¬ï¼Œæˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹æ­¤ç‰ˆæœ¬ä¸­å€¼å¾—æ³¨æ„çš„å†…å®¹ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://github.com/etcd-io/etcd/pull/11946">#11946&lt;/a> åœ¨ä¹‹å‰çš„ &lt;a href="https://zhuanlan.zhihu.com/p/146554894">K8S ç”Ÿæ€å‘¨æŠ¥| å‡ ä¹å½±å“æ‰€æœ‰ k8s é›†ç¾¤çš„æ¼æ´&lt;/a> ä¸­ï¼Œæˆ‘å°±ä»‹ç»è¿‡äº†ï¼Œæ–°å¢äº† &lt;code>--unsafe-no-fsync&lt;/code> é€‰é¡¹ï¼Œå¯ä»¥ç¦æ­¢æ‰€æœ‰çš„ fsyncï¼Œè¿™ä½¿å¾—å°† etcd ç”¨äº CI ç¯èŠ‚æˆ–æœ¬æ¬¡æµ‹è¯•éƒ½å°†éå¸¸é«˜æ•ˆï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/etcd-io/etcd/pull/11980">#11980&lt;/a> æ·»åŠ äº† &lt;code>--auth-token-ttl&lt;/code> çš„é€‰é¡¹ï¼Œç”¨äºè‡ªå®šä¹‰ &lt;code>simpleTokenTTL&lt;/code> è®¾ç½®ï¼›&lt;/li>
&lt;/ul>
&lt;p>æ›´å¤šå…³äºæ­¤ç‰ˆæœ¬çš„ç‰¹æ€§ï¼Œè¯·å‚è€ƒå…¶ &lt;a href="https://github.com/etcd-io/etcd/releases/tag/v3.4.10">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="trivy-v092-å‘å¸ƒ">Trivy v0.9.2 å‘å¸ƒ&lt;/h2>
&lt;p>Trivy åœ¨ä¹‹å‰çš„å‘¨æŠ¥ä¸­å·²ç»åšäº†å¾ˆå¤šä»‹ç»ã€‚æœ¬å‘¨å®ƒå‘å¸ƒäº† v0.9.2 ç‰ˆæœ¬ï¼Œæˆ‘ä»¬ä¸€èµ·çœ‹çœ‹æœ‰å“ªäº›å€¼å¾—å…³æ³¨çš„å†…å®¹ã€‚&lt;/p>
&lt;p>&lt;strong>æ”¯æŒ JUnit XML&lt;/strong> å¦‚æœä½ çš„ CI æœåŠ¡å™¨æ”¯æŒ JUnit XML é‚£ä½ å°±å¯ä»¥åœ¨ CI pipeline ä¸­çœ‹åˆ° Trivy å¯¹åº”çš„æ£€æŸ¥ç»“æœäº†ã€‚&lt;/p>
&lt;p>æ¯”å¦‚ï¼Œåœ¨ GitLab CI ä¸­ä½¿ç”¨ Trivy æ•ˆæœå¦‚ä¸‹ï¼š&lt;/p>
&lt;p>&lt;img src="https://moelove.info/img/trivy-in-gitlab-ci.png" alt="Trivy In GitLab CI">&lt;/p>
&lt;p>&lt;strong>&lt;a href="https://github.com/aquasecurity/trivy/pull/530">#530&lt;/a> åœ¨ç»“æœä¸­æ”¯æŒ CVSS è¯„åˆ†ä¿¡æ¯äº†&lt;/strong>ï¼Œ ä¾‹å¦‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-json" data-lang="json"> &lt;span class="p">{&lt;/span>
&lt;span class="nt">&amp;#34;VulnerabilityID&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;CVE-2019-1547&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="nt">&amp;#34;PkgName&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;openssl&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="nt">&amp;#34;InstalledVersion&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;1.1.1c-r0&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="nt">&amp;#34;FixedVersion&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;1.1.1d-r0&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="nt">&amp;#34;CVSS&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nt">&amp;#34;nvd&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nt">&amp;#34;V2Vector&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;AV:L/AC:M/Au:N/C:P/I:N/A:N&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="nt">&amp;#34;V3Vector&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;CVSS:3.1/AV:L/AC:H/PR:L/UI:N/S:U/C:H/I:N/A:N&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="nt">&amp;#34;V2Score&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mf">1.9&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="nt">&amp;#34;V3Score&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mf">4.7&lt;/span>
&lt;span class="p">},&lt;/span>
&lt;span class="nt">&amp;#34;redhat&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nt">&amp;#34;V3Vector&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;CVSS:3.0/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:N/A:N&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="nt">&amp;#34;V3Score&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mf">5.5&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="p">},&lt;/span>
&lt;span class="err">...&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ›´å¤šå…³äºæ­¤ç‰ˆæœ¬çš„ä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹å…¶ &lt;a href="https://github.com/aquasecurity/trivy/releases/tag/v0.9.2">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="ä¸Šæ¸¸è¿›å±•">ä¸Šæ¸¸è¿›å±•&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/pull/92310">#92310&lt;/a> &lt;code>kubectl alpha debug&lt;/code> ç°åœ¨æ”¯æŒä¸»æœºçº§åˆ«çš„ debug äº†ï¼Œ é€šè¿‡å¯åŠ¨å®¹å™¨å¹¶åŠ å…¥ä¸»æœºçš„ namespace ä¸­ï¼Œå®ƒä¼šè‡ªåŠ¨å°†ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿç»‘å®šåˆ° &lt;code>/host&lt;/code> ä¸‹ï¼Œä»¥ä¾¿è°ƒè¯•ä½¿ç”¨ã€‚è¿™ç§æ¨¡å¼ï¼Œæœ‰æœ›æ›¿ä»£ä¼ ç»Ÿçš„é€šè¿‡ SSH ç™»å½•æœºå™¨ debug çš„æ¨¡å¼äº†ã€‚&lt;/li>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/pull/91946">#91946&lt;/a> è¿˜è®°å¾— Kubernetes æ–°å¢çš„ &lt;code>.meta.managedFields&lt;/code> å—ï¼Ÿå½“ä½ æ‰§è¡Œ &lt;code>kubectl edit&lt;/code> çš„æ—¶å€™ï¼Œæ˜¯å¦è§‰å¾—å®ƒå¾ˆçƒ¦ã€‚ ç°åœ¨åœ¨ &lt;code>kubectl edit&lt;/code> çš„æ—¶å€™ï¼Œå°†ä¼šé»˜è®¤éšè—å®ƒ ï¼ˆ &lt;strong>å¤ªæ£’äº†ï¼&lt;/strong> )&lt;/li>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/issues/92914">#92914&lt;/a> CVE-2020-8559 å·²ç»è¢«æ–°å‘å¸ƒç‰ˆæœ¬ä¿®å¤ï¼›&lt;/li>
&lt;/ul>
&lt;hr>
&lt;p>æ¬¢è¿è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| Helm v3.3.0-rc.1 å‘å¸ƒ</title><link>https://moelove.info/2020/07/12/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Helm-v3.3.0-rc.1-%E5%8F%91%E5%B8%83/</link><guid isPermaLink="true">https://moelove.info/2020/07/12/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Helm-v3.3.0-rc.1-%E5%8F%91%E5%B8%83/</guid><pubDate>Sun, 12 Jul 2020 22:46:25 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="helm-v330-rc1-å‘å¸ƒ">Helm v3.3.0-rc.1 å‘å¸ƒ&lt;/h2>
&lt;p>è¿™æ˜¯ Helm v3.3.0 çš„é¢„å‘å¸ƒç‰ˆæœ¬ï¼Œåœ¨æ­¤æ¬¡ç‰ˆæœ¬ä¸­ï¼Œé‡ç‚¹åœ¨ä¿®å¤ &lt;code>helm lint&lt;/code> ç›¸å…³çš„é”™è¯¯ï¼Œä»¥åŠæå‡æ•´ä½“çš„ç¨³å®šæ€§å’Œå…¶ä»–ä¸€èˆ¬æ€§ bug çš„ä¿®å¤ã€‚æˆ‘ä¸»è¦ä»‹ç»å‡ ä¸ªå€¼å¾—æ³¨æ„çš„å†…å®¹ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://github.com/helm/helm/pull/8277">#8277&lt;/a> å°† warning ä¿¡æ¯ä»å†™å…¥ &lt;code>stdout&lt;/code> ä¿®æ”¹ä¸ºå†™å…¥ &lt;code>stderr&lt;/code> ï¼Œè¿™æ ·å¯å¤§å¤§æ–¹ä¾¿å°† helm ç”¨äº pipeline ä¸­ã€‚æ¯”å¦‚ &lt;code>helm template&lt;/code> ä¸ &lt;code>kubectl&lt;/code> ç»„åˆä½¿ç”¨ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/helm/helm/pull/8220">#8220&lt;/a> ä¿®å¤äº†å½“ chart æ•°é‡å¾ˆå¤šæ—¶ï¼Œ&lt;code>helm chart list&lt;/code> å¯èƒ½æŠ¥é”™çš„é—®é¢˜ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/helm/helm/pull/8158">#8158&lt;/a> ä¿®å¤äº† &lt;code>--repository-cache&lt;/code> ä¸èƒ½è¢« &lt;code>repo add&lt;/code> å’Œ &lt;code>repo update&lt;/code> è¯†åˆ«çš„é—®é¢˜ï¼Œ ç°åœ¨å¯ä»¥é€šè¿‡ &lt;code>repository-cache&lt;/code> è‡ªè¡ŒæŒ‡å®š cache ç›®å½•ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/helm/helm/issues/7875">#7875&lt;/a> å¢åŠ äº† &lt;code>--insecure-skip-tls-verify&lt;/code> å‚æ•°ï¼Œç”¨äºåœ¨ &lt;code>pull&lt;/code>/&lt;code>install&lt;/code> ç­‰é˜¶æ®µï¼Œè·³è¿‡è¯ä¹¦æ ¡éªŒï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/helm/helm/pull/8011">#8011&lt;/a> å¢åŠ äº† lint è§„åˆ™ï¼Œä»¥ä¾¿äºæ£€æŸ¥èµ„æºåç§°æ˜¯å¦ç¬¦åˆ K8S çš„è¦æ±‚ã€‚&lt;/li>
&lt;/ul>
&lt;p>ä»¥ä¸Šä¾¿æ˜¯æˆ‘è®¤ä¸ºæ­¤ç‰ˆæœ¬ä¸­å€¼å¾—å…³æ³¨çš„å†…å®¹ï¼Œæ›´å¤šå…³äºæ­¤ç‰ˆæœ¬çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è€ƒå…¶ &lt;a href="https://github.com/helm/helm/releases/tag/v3.3.0-rc.1">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="suse-å®£å¸ƒæ”¶è´­-rancher-labs">SUSE å®£å¸ƒæ”¶è´­ Rancher Labs&lt;/h2>
&lt;p>æœ¬å‘¨æƒ³å¿…å¤§å®¶å·²ç»è¢«æ­¤æ¶ˆæ¯åˆ·å±ï¼ŒSUSE å°†æ”¶è´­ Rancher Labs ã€‚è¿™é‡Œæˆ‘ç¨å¾®èŠä¸€ç‚¹æˆ‘ä¸ªäººçš„çœ‹æ³•ã€‚&lt;/p>
&lt;p>SUSE å¤§å®¶å¯èƒ½æ¯”è¾ƒç†Ÿæ‚‰çš„æ˜¯ openSUSE ï¼Œä¸€ä¸ª Linux å‘è¡Œç‰ˆï¼ŒLOGO æ˜¯ä¸€åªç»¿èœ¥èœ´ã€‚æˆ‘æ—©å¹´ä¹Ÿæ›¾åœ¨ä¸ªäººç”µè„‘ä¸Šè£…è¿‡ openSUSEï¼Œä¸ºäº†ç©å®ƒçš„ 3D æ¡Œé¢ç‰¹æ•ˆï¼ˆæ•ˆæœæ˜¯è›®é…·çš„ï¼‰ã€‚&lt;/p>
&lt;p>ä½†å®ƒèƒŒåçš„å…¬å¸ä¸»ä¸šå¯ä¸æ­¢ openSUSE ï¼Œå®ƒçš„ä¸€ä¸ªé‡è¦äº§å“æ˜¯ SUSE Linux Enterprise ï¼Œ å®ƒä¿©ä¹‹é—´æ¯”è¾ƒåƒ Red Hat Enterprise Linux å’Œ Fedora ä¹‹é—´çš„å…³ç³»ã€‚&lt;/p>
&lt;p>æ­¤å¤–ï¼Œè¿˜æœ‰å›´ç»•æ­¤æ„å»ºå‡ºæ¥çš„ SUSE Linux Enterprise Desktop å’Œ SUSE Linux Enterprise Server ä»¥åŠ SUSE Linux Enterprise é«˜æ€§èƒ½è®¡ç®—ç­‰ã€‚&lt;/p>
&lt;p>çœ‹èµ·æ¥å¾ˆåƒæ˜¯ä¸“æ³¨äºæç³»ç»Ÿå±‚çš„å…¬å¸å¯¹å§ï¼Œå®ƒåœ¨è¿‘äº›å¹´è¿˜æäº†ä¸¤ä¸ªæˆ‘è®¤ä¸ºæ˜¯æ¯”è¾ƒæ ¸å¿ƒçš„äº§å“ï¼Œ 1. åŸºäº Ceph æŠ€æœ¯æä¾›çš„ SUSE Enterprise Storage - ä¼ä¸šçº§å­˜å‚¨ç³»ç»Ÿ 2. SUSE CaaS Platform - ä¼ä¸šçº§å®¹å™¨æœåŠ¡å¹³å°ã€‚&lt;/p>
&lt;p>å…¶å®æˆ‘ä¸»è¦å…³æ³¨å®ƒçš„ç‚¹ï¼Œåœ¨äºè¿™ä¸¤ä¸ªäº§å“è¿è¡Œç¯å¢ƒæ˜¯ SUSE Linux Enterprise ä¹Ÿå°±æ˜¯è¯´ï¼Œä¹°äº†æœåŠ¡é‚£ä½ è¿˜éœ€è¦ä¹°åŸºç¡€è®¾æ–½ï¼Œè¿™æ ·æ‰èƒ½æ›´å¥½çš„è¾¾åˆ°ä¼ä¸šçº§çš„å¯é æ€§ä¿éšœã€‚&lt;/p>
&lt;p>è¿™é‡Œä¸è¯´å®ƒçš„ç›ˆåˆ©æ¨¡å¼äº†ï¼Œä¸»è¦æ˜¯æƒ³è¦è¯´ï¼Œ SUSE å…¶å®æŒºæ—©å°±æƒ³è¦åˆ‡å…¥åˆ° K8S ç”Ÿæ€ï¼ˆæˆ–è€…è¯´äº‘åŸç”Ÿç”Ÿæ€ï¼‰ä¸­äº†ï¼Œé€‰æ‹©çš„æ–¹å‘ä¹Ÿéƒ½å¾ˆå‡†ã€‚å»å¹´æˆ‘åœ¨ Kube Con ä¸Šæœ‰å’Œå®ƒä»¬çš„å·¥ä½œäººå‘˜èŠäº†ä¸‹å…³äºå®ƒä»¬çš„å­˜å‚¨ä¸ K8S ç»“åˆç›¸å…³çš„å†…å®¹ï¼Œæ˜¯ä¸ªä¸é”™çš„åˆ‡å…¥ç‚¹ã€‚&lt;/p>
&lt;p>ç°åœ¨ SUSE æ”¶è´­ Rancher Labs ï¼Œå¯¹äº SUSE è€Œè¨€æ˜¯è¿›ä¸€æ­¥å¢åŠ äº†åœ¨äº‘åŸç”Ÿé¢†åŸŸçš„è¦†ç›–é¢ï¼Œå¯¹äº Rancher Labs è€Œè¨€ä¹Ÿæ˜¯å¢åŠ äº†ä¸€ä¸ªå¼ºåŠ›çš„åç›¾ã€‚å½“ç„¶ï¼Œåœ¨ä¼ä¸šç¯å¢ƒä¸‹ï¼Œä¹Ÿæ›´éœ€è¦æœ‰ SUSE è¿™æ ·å¯ä»¥æä¾›æŠ€æœ¯å’Œä¼ä¸šçº§æœåŠ¡çš„ä¼™ä¼´ã€‚&lt;/p>
&lt;p>ä¸è¿‡æˆ‘ä¹Ÿçœ‹åˆ°äº†ä¸€äº›å…¶ä»–çš„å£°éŸ³ï¼Œæ¯”å¦‚è¯´çœ‹ &lt;strong>SUSE ç°åœ¨çš„äº§å“å¤§å¤šæ˜¯éƒ¨ç½²åœ¨ SUSE Enterprise Linux å¹³å°ä¹‹ä¸Šçš„ï¼Œæ‹…å¿ƒåç»­ä½¿ç”¨ Rancher æ˜¯å¦ä¹Ÿéœ€è¦ç‰¹å®šåœ¨ SUSE çš„å¹³å°ä¹‹ä¸Šã€‚&lt;/strong> ä¸è¿‡ SUSE å·²ç»åšäº†å›åº”ï¼Œç§°ä¼šç»§ç»­æ”¯æŒå¼€æºã€‚&lt;/p>
&lt;p>æ•´ä½“è€Œè¨€ï¼Œè¿™æ˜¯ä¸ªå¥½äº‹å„¿ï¼Œæˆ‘ä»¬èƒ½çœ‹åˆ°æœ‰æ›´å¤šçš„å…¬å¸æ„¿æ„åœ¨ K8S ç›¸å…³æŠ€æœ¯æ–¹é¢è¿›è¡ŒæŠ•å…¥äº†ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥çœ‹åˆ°ä¼—å¤šçš„æ”¶è´­æ¡ˆä¾‹ä¸­ï¼Œto B æ‰æ˜¯ç›®æ ‡ã€‚&lt;/p>
&lt;h2 id="google-å°†-istio-å•†æ ‡è½¬ç§»ç»™-ouc">Google å°† Istio å•†æ ‡è½¬ç§»ç»™ OUC&lt;/h2>
&lt;p>è°·æ­Œè¿‘æœŸå®£å¸ƒæˆç«‹æ–°ç»„ç»‡ &lt;a href="https://openusage.org/">Open Usage Commonsï¼ˆOUCï¼‰&lt;/a> ï¼Œå¹¶å°† Istioï¼ŒAngularï¼ŒGerrit Code Review ä¸‰ä¸ªé¡¹ç›®çš„å•†æ ‡è½¬ç§»ç»™å®ƒã€‚&lt;/p>
&lt;p>è¿™ä¸ªäº‹æƒ…å¯¹äºäº‘åŸç”Ÿé¢†åŸŸç®—æ˜¯ä¸ªå¤§æ–°é—»äº†ï¼Œç”šè‡³ IBM ç­‰å…¬å¸ä¹Ÿä¸“é—¨å‘æ–‡å£°æ˜åå¯¹ Google çš„è¿™ä¸€åšæ³•ï¼Œè®¤ä¸ºåº”è¯¥äº¤ç»™ CNCF ç®¡ç†ã€‚&lt;/p>
&lt;p>å…³äºè¿™ä¸€äº‹æƒ…ï¼Œæˆ‘ä¸å‘è¡¨å¤ªå¤šæ„è§ã€‚&lt;/p>
&lt;p>ä½†æˆ‘æƒ³è¯´çš„æ˜¯ï¼Œæ— è®º Google æ˜¯å¦æ›´æ”¹è¿™ä¸€å†³å®šï¼Œ &lt;strong>çŸ­æ—¶é—´æ¥çœ‹ï¼Œå¹¶ä¸ä¼šå½±å“ Istio çš„åº”ç”¨å’Œå‘å±•ã€‚&lt;/strong>&lt;/p>
&lt;h2 id="ä¸Šæ¸¸è¿›å±•">ä¸Šæ¸¸è¿›å±•&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/pull/91381">#91381&lt;/a> åœ¨ Pod å’Œ Container çš„ &lt;code>securityContext&lt;/code> å¯¹è±¡ä¸­å¢åŠ å¦ä¸€ä¸ª &lt;code>seccompProfile&lt;/code> å­—æ®µï¼Œä»¥ä¾¿æ”¯æŒ Seccomp ã€‚åŒæ—¶ &lt;code>seccomp.security.alpha.kubernetes.io/pod&lt;/code> å’Œ &lt;code>container.seccomp.security.alpha.kubernetes.io/...&lt;/code> çš„ annotations è¢«æ ‡è®°ä¸ºåºŸå¼ƒï¼Œå°†åœ¨ v1.22 ä¸­ç§»é™¤ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/pull/91532">#91532&lt;/a> &lt;a href="https://github.com/kubernetes/kubernetes/pull/91522">#91522 &lt;/a> å’Œ &lt;a href="https://github.com/kubernetes/kubernetes/pull/91521">#91521&lt;/a> åˆ†åˆ«ä¸º kubeletï¼Œscheduler å’Œ controller-manager å¢åŠ  &lt;code>--logging-format&lt;/code> é€‰é¡¹ï¼Œä»¥ä¾¿æ”¯æŒç»“æ„åŒ–æ—¥å¿—ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/pull/92740">#92740&lt;/a> &lt;code>kubeadm config view&lt;/code> è¢«æ ‡è®°ä¸ºåºŸå¼ƒï¼Œè¯·ç›´æ¥ä½¿ç”¨ &lt;code>kubectl get cm -o yaml -n kube-system kubeadm-config&lt;/code> æŸ¥çœ‹ configmapï¼›&lt;/li>
&lt;/ul>
&lt;hr>
&lt;p>æ¬¢è¿è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| runc v1.0.0-rc91 å‘å¸ƒ</title><link>https://moelove.info/2020/07/05/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-runc-v1.0.0-rc91-%E5%8F%91%E5%B8%83/</link><guid isPermaLink="true">https://moelove.info/2020/07/05/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-runc-v1.0.0-rc91-%E5%8F%91%E5%B8%83/</guid><pubDate>Sun, 05 Jul 2020 21:04:24 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="runc-v100-rc91-å‘å¸ƒ">runc v1.0.0-rc91 å‘å¸ƒ&lt;/h2>
&lt;p>å¦‚æœä¸å‡ºæ„å¤–çš„è¯ï¼Œè¿™å°†ä¼šæ˜¯ runc v1.0 æ­£å¼å‘å¸ƒå‰çš„å€’æ•°ç¬¬äºŒä¸ª rc ç‰ˆã€‚
æœ¬æ¬¡æœ‰å¾ˆå¤šå€¼å¾—å…³æ³¨çš„å˜æ›´ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>é¦–å…ˆæ˜¯æœŸå¾…å·²ä¹…çš„ hooks çš„å˜æ›´ï¼Œè¿™æ˜¯å°‘æ•°ä¸è§„èŒƒæœ‰å…³çš„å˜æ›´ï¼Œå½“ç„¶å®ƒä¹Ÿæ˜¯ä¸€ç›´æ²¡æœ‰å‘å¸ƒ v1.0 çš„åŸå› ä¹‹ä¸€ã€‚ç°æœ‰çš„ä½¿ç”¨ hook çš„ç”¨æˆ·ä¸å—å½±å“ï¼Œæ¯”å¦‚è¯´ NVIDIA Docker ç”¨æˆ·ï¼Œä½†æ˜¯ runc æä¾›äº†å…¶ä»–çš„ hook ï¼Œæ¯”å¦‚ &lt;code>createRuntime&lt;/code> ç­‰ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å…¶æ¬¡æ˜¯å¯¹ cgroup v2 çš„æ”¯æŒï¼ˆæˆ‘å·²ç»å¤šæ¬¡ä»‹ç»è¿‡ï¼‰ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä¿®å¤äº†ä¸€ä¸ªå°çš„&lt;a href="https://github.com/opencontainers/runc/security/advisories/GHSA-g54h-m393-cpwq">å®‰å…¨æ¼æ´&lt;/a> å¾ˆæ—©ä¹‹å‰ runc ä¸­é»˜è®¤å°†æ‰€æœ‰çš„è®¾å¤‡éƒ½è®¾ç½®æˆäº†å…è®¸ï¼Œè¿™æ„å‘³ç€éœ€è¦ç”¨æˆ·è‡ªå·±å»è®¾ç½®è¦å»æ‹’ç»å“ªä¸ªè®¾å¤‡è®¿é—®ã€‚åœ¨ runc çš„ä¼—å¤šç”¨æˆ·ï¼Œå‡å·²ç»å¾ˆæ—©å°±ä¿®å¤äº†æ­¤é—®é¢˜ã€‚æ‰€ä»¥æ­¤é—®é¢˜åœ¨ runc ä¸­è¢«å¿½ç•¥æ‰äº†ï¼Œç›´åˆ°ç°åœ¨æ‰ä¿®å¤ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>æ›´å¤šå…³äºæ­¤ç‰ˆæœ¬çš„ä¿¡æ¯ï¼Œè¯·å‚è€ƒå…¶ &lt;a href="https://github.com/opencontainers/runc/releases/tag/v1.0.0-rc91">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="envoy-v1143-å‘å¸ƒ">Envoy v1.14.3 å‘å¸ƒ&lt;/h2>
&lt;p>æ­¤æ¬¡ v1.14.3 ç‰ˆæœ¬çš„ä¸»é¢˜æ˜¯å®‰å…¨ä¿®å¤ã€‚æœ¬æ¬¡ä¿®å¤äº†å¦‚ä¸‹å®‰å…¨æ¼æ´ï¼š&lt;/p>
&lt;ul>
&lt;li>CVE-2020-12603&lt;/li>
&lt;li>CVE-2020-12604&lt;/li>
&lt;li>CVE-2020-12605&lt;/li>
&lt;li>CVE-2020-8663&lt;/li>
&lt;li>CVE-2020-8663&lt;/li>
&lt;/ul>
&lt;p>è¿™äº›å®‰å…¨æ¼æ´åŸºæœ¬éƒ½æ˜¯é€šè¿‡å‘é€ç‰¹å®šæ•°æ®åŒ…ï¼Œå¼•èµ·æœåŠ¡ç«¯å¤§é‡æ¶ˆè€—èµ„æºã€‚ åŒæ—¶ï¼Œæ­¤æ¬¡çš„è¿™äº›å®‰å…¨ä¿®å¤ï¼Œä¹Ÿéƒ½å½±å“åˆ°äº† Istio ï¼Œæ‰€ä»¥ Istio åœ¨æœ¬å‘¨ä¹Ÿå‘å¸ƒäº† v1.6.4 ç‰ˆæœ¬ä»¥åŒ…å«è¿™äº›æ¼æ´ä¿®å¤ã€‚&lt;/p>
&lt;p>æ›´å¤šå…³äºæ­¤ç‰ˆæœ¬ä¿¡æ¯ï¼Œè¯·å‚è€ƒå…¶ &lt;a href="https://github.com/envoyproxy/envoy/releases/tag/v1.14.3">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="rook-v137-å‘å¸ƒ">Rook v1.3.7 å‘å¸ƒ&lt;/h2>
&lt;p>è¿™ä»ç„¶æ˜¯ä¸€ä¸ª bugfix ç‰ˆæœ¬ï¼Œå…¶ä¸­æœ‰å‡ ä¸ªå€¼å¾—æ³¨æ„çš„ä¿®å¤ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://github.com/rook/rook/issues/5504">#5504&lt;/a> ä¿®å¤äº† OSD åˆ›å»ºè¿‡ç¨‹ä¸­ç£ç›˜åˆ†åŒºæ ‡ç­¾åœ¨ &lt;code>devicePathFilter&lt;/code> è¿‡æ»¤æ¡ä»¶ä¸­å¤±æ•ˆçš„é—®é¢˜ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/rook/rook/pull/5698">#5698&lt;/a> åœ¨ monitor æ•…éšœè½¬ç§»çš„æ—¶å€™ï¼Œåˆ é™¤ä¸ä¹‹å…³è”çš„ PVCï¼Œè¿™æ ·å¯ä»¥é¿å…å…¶æ•…éšœæ—¶ï¼Œ PVC ä»å¤„äºç»‘å®šçš„çŠ¶æ€ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/rook/rook/pull/5720">#5720&lt;/a> ä¹‹å‰å¡ä½çš„ monitor åªæœ‰åœ¨å¥åº·æ£€æŸ¥çš„æ—¶å€™æ‰ä¼šè¢«å¼ºåˆ¶åˆ é™¤ï¼Œç°åœ¨åœ¨æ¯æ¬¡ reconcile æ—¶ï¼Œä¹Ÿä¼šé‡å¯ monitor äº†ï¼›&lt;/li>
&lt;/ul>
&lt;p>ä»¥ä¸Šä¾¿æ˜¯æœ¬æ¬¡ç‰ˆæœ¬ä¸­å€¼å¾—å…³æ³¨çš„ä¿¡æ¯ï¼Œæ›´å¤šå…³äºæ­¤ç‰ˆæœ¬çš„å˜æ›´ï¼Œè¯·å‚è€ƒå…¶ &lt;a href="https://github.com/rook/rook/releases/tag/v1.3.7">RleaseNote&lt;/a>&lt;/p>
&lt;h2 id="ä¸Šæ¸¸è¿›å±•">ä¸Šæ¸¸è¿›å±•&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/pull/92407">#92407&lt;/a> å¯¹ kubelet æš´éœ²å‡ºçš„ä¸¤ä¸ª metric åšäº†é‡å‘½åï¼Œåˆ†åˆ«æ˜¯å°† &lt;code>kubelet_running_container_count&lt;/code> -&amp;gt; &lt;code>kubelet_running_containers&lt;/code> å’Œ &lt;code>kubelet_running_pod_count&lt;/code> -&amp;gt; &lt;code>kubelet_running_pods&lt;/code> &lt;strong>å¦‚æœåœ¨å‡çº§åï¼Œå‘ç°è‡ªå·±çš„ Dashboard æˆ–è€…æŠ¥è­¦ä¸å¥½ç”¨äº†ï¼Œè¯·å³ä½¿æ£€æŸ¥ metric æ˜¯å¦åŒ¹é…&lt;/strong>ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/pull/91980">#91980&lt;/a> &lt;code>kubeadm upgrade&lt;/code> å…è®¸ç”¨æˆ·é€šè¿‡ &lt;code>--config&lt;/code> æ‰‹åŠ¨æä¾›é›†ç¾¤ç»„ä»¶çš„é…ç½®ã€‚æ—§æœ‰çš„ &lt;code>--config&lt;/code> è¡Œä¸ºä¹Ÿå°†ç»§ç»­æ”¯æŒã€‚ç›¸å…³çš„ KEP è¯·æŸ¥çœ‹ &lt;a href="https://github.com/kubernetes/enhancements/blob/master/keps/sig-cluster-lifecycle/kubeadm/20190925-component-configs.md">https://github.com/kubernetes/enhancements/blob/master/keps/sig-cluster-lifecycle/kubeadm/20190925-component-configs.md&lt;/a> ï¼ˆå¯¹äºæƒ³è¦æ‰‹åŠ¨ç®¡ç†ï¼Œæˆ–è€…è§„é¿ä¸€äº›ç‰ˆæœ¬é—®é¢˜çš„ç”¨æˆ·ï¼Œéå¸¸æœ‰ç”¨ï¼‰ï¼›&lt;/li>
&lt;/ul>
&lt;hr>
&lt;p>æ¬¢è¿è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| Docker v19.03.12 å‘å¸ƒ</title><link>https://moelove.info/2020/06/28/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Docker-v19.03.12-%E5%8F%91%E5%B8%83/</link><guid isPermaLink="true">https://moelove.info/2020/06/28/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Docker-v19.03.12-%E5%8F%91%E5%B8%83/</guid><pubDate>Sun, 28 Jun 2020 19:31:03 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="docker-ce-v190312-å‘å¸ƒ">Docker CE v19.03.12 å‘å¸ƒ&lt;/h2>
&lt;p>åœ¨ Docker v19.03.11 å‘å¸ƒæ—¶ï¼Œæˆ‘åœ¨&lt;a href="https://zhuanlan.zhihu.com/p/146554894">ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥| å‡ ä¹å½±å“æ‰€æœ‰ k8s é›†ç¾¤çš„æ¼æ´ã€&lt;/a> ä¸€æ–‡ä¸­æ›¾ä»‹ç»è¿‡ï¼Œè¯¥ç‰ˆæœ¬ä¸»è¦æ˜¯ä¸ºäº†ä¿®å¤ä¸€ä¸ªé€šè¿‡ä½¿ç”¨ IPv6 RA æ¶ˆæ¯è¿›è¡Œåœ°å€æ¬ºéª—çš„å®‰å…¨æ¼æ´ &lt;a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-13401">CVE-2020-13401&lt;/a>ã€‚&lt;/p>
&lt;p>è§£å†³åŠæ³•ä¹Ÿå¾ˆç®€å•ï¼Œç›´æ¥å°† &lt;code>/proc/sys/net/ipv6/conf/*/accept_ra&lt;/code> è®¾ç½®æˆ 0 ï¼Œè¿™æ ·ä¾¿å¯ç¡®ä¿ä¸æ¥æ”¶ RA æ¶ˆæ¯ï¼Œä»è€Œé¿å…é­å—æ”»å‡»ã€‚&lt;/p>
&lt;p>ä½†æ˜¯ï¼Œåœ¨ v19.03.11 çš„ä¿®å¤ä¸­ï¼Œå½“æ— æ³•ç¦ç”¨ RA æ¶ˆæ¯æ—¶ï¼Œä¼šç›´æ¥æŠ¥é”™ï¼Œå¯¼è‡´ docker daemon æ— æ³•å¯åŠ¨ ï¼ˆæ¯”å¦‚åœ¨å®¹å™¨å†…çš„åªè¯»æ–‡ä»¶ç³»ç»Ÿä¸Šï¼‰ã€‚æ‰€ä»¥æ­¤æ¬¡ v19.03.12 çš„ä¸€ä¸ªæœ€ä¸»è¦ä¿®å¤ï¼Œå°±æ˜¯æ— æ³•ç¦ç”¨ RA æ¶ˆæ¯æ—¶ï¼Œåªæ˜¯ä¼šè®°å½•ä¸€æ¡æ—¥å¿—ï¼Œè€Œä¸æ˜¯ç›´æ¥æŠ¥é”™ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-diff" data-lang="diff">&lt;span class="gd">- return fmt.Errorf(&amp;#34;libnetwork: Unable to disable IPv6 router advertisement: %v&amp;#34;, err)
&lt;/span>&lt;span class="gd">&lt;/span>&lt;span class="gi">+ logrus.WithError(err).Warn(&amp;#34;unable to disable IPv6 router advertisement&amp;#34;)
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¯¹æ­¤ç‰ˆæœ¬æ„Ÿå…´è¶£çš„å°ä¼™ä¼´ï¼Œå¯ä»¥ç›´æ¥æ›´æ–°ã€‚&lt;/p>
&lt;h2 id="containerd-v135-å‘å¸ƒ">containerd v1.3.5 å‘å¸ƒ&lt;/h2>
&lt;p>æ­¤æ¬¡ v1.3.5 ç‰ˆæœ¬ï¼Œæœ‰å¯èƒ½æ˜¯ v1.3.x ç³»åˆ—çš„æœ€åä¸€ä¸ªç‰ˆæœ¬äº†ã€‚æ­¤ç‰ˆæœ¬ä¸­ä¸»è¦æ˜¯æŠŠä¸»çº¿ä¸­çš„ä¸€äº›ä¿®æ­£ç»™ç§»æ¤è¿‡æ¥ã€‚æ¯”å¦‚&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://github.com/containerd/containerd/pull/4276">#4276&lt;/a> ä¿®æ­£äº†é•œåƒç”¨é‡çš„è®¡ç®—é”™è¯¯ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/containerd/containerd/pull/4278">#4278&lt;/a> å½“é‡åˆ°ä¸€äº›é”™è¯¯æ—¶å€™ï¼Œæ¸…ç†æ‰åˆ†é…çš„èµ„æºï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/containerd/containerd/pull/4327/">#4327&lt;/a> shim v2 runc ä¼ é€’äº† &lt;code>options.Root&lt;/code>ï¼›&lt;/li>
&lt;/ul>
&lt;p>æ­¤ç‰ˆæœ¬ä¹Ÿå°†å¾ˆå¿«é›†æˆè¿› Docker ä¸­ã€‚&lt;/p>
&lt;p>æ›´å¤šä¿¡æ¯è¯·å‚è€ƒå…¶ &lt;a href="https://github.com/containerd/containerd/releases/tag/v1.3.5">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="istio-v1410-å‘å¸ƒ">Istio v1.4.10 å‘å¸ƒ&lt;/h2>
&lt;p>Istio v1.4.10 ä¸­ä¸»è¦åŒ…å«ä»¥ä¸‹å€¼å¾—æ³¨æ„çš„å†…å®¹ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;strong>ISTIO-SECURITY-2020-006&lt;/strong>: è¿™ä¸ªæ¼æ´æºè‡ª &lt;a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-11080">CVE-2020-11080&lt;/a> nghttp2 åœ¨ v1.41.0 ç‰ˆæœ¬ä¹‹å‰ï¼Œå­˜åœ¨ payload è¿‡å¤§å¯¼è‡´æ‹’ç»æœåŠ¡çš„æ¼æ´ã€‚å½“æ”»å‡»è€…æŒç»­æ„é€ å¤§å‹è¯·æ±‚æ—¶ï¼Œå¯èƒ½å¯¼è‡´ CPU é£™åˆ° 100% ã€‚è¿™ç§è¯·æ±‚å¯èƒ½ä¼šè¢«å‘é€åˆ° Ingress Gateway æˆ–è€… Sidecar ï¼Œè¿›è€Œå¯¼è‡´æ‹’ç»æœåŠ¡ã€‚&lt;/li>
&lt;li>&lt;a href="https://github.com/istio/istio/issues/23770">#23770&lt;/a> ä¿®å¤äº† CNI å¯¼è‡´ POD å»¶è¿Ÿ 30~40s å¯åŠ¨çš„ bug ï¼Œä¸»è¦æ˜¯å› ä¸º &lt;code>istio-iptables.sh&lt;/code> ä¸­ IPv6 ç›¸å…³çš„æ£€æŸ¥é€»è¾‘ã€‚&lt;/li>
&lt;/ul>
&lt;h2 id="ä¸Šæ¸¸è¿›å±•">ä¸Šæ¸¸è¿›å±•&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/pull/88649">#88649&lt;/a> åˆ é™¤æ‰äº†è‡ª v1.14 èµ·ï¼Œè¢«åºŸå¼ƒçš„ &lt;code>kubectl get&lt;/code> çš„ &lt;code>--export&lt;/code> å‚æ•°ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/pull/89778">#89778&lt;/a> Ingress å·²ç» GAï¼Œå½“å‰ä½¿ç”¨çš„ API ç‰ˆæœ¬ä¸º &lt;code>networking.k8s.io/v1&lt;/code>;&lt;/li>
&lt;/ul>
&lt;hr>
&lt;p>æ¬¢è¿è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| CoreDNS å‘å¸ƒ v1.7.0</title><link>https://moelove.info/2020/06/21/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-CoreDNS-%E5%8F%91%E5%B8%83-v1.7.0/</link><guid isPermaLink="true">https://moelove.info/2020/06/21/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-CoreDNS-%E5%8F%91%E5%B8%83-v1.7.0/</guid><pubDate>Sun, 21 Jun 2020 15:00:50 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="coredns-v170-å‘å¸ƒ">CoreDNS v1.7.0 å‘å¸ƒ&lt;/h2>
&lt;p>CoreDNS æœ¬å‘¨å‘å¸ƒäº† v1.7.0 ç‰ˆæœ¬ï¼Œ &lt;strong>è¿™æ˜¯ä¸€ä¸ªå‘åä¸å…¼å®¹çš„ç‰ˆæœ¬&lt;/strong>ã€‚ ä¸»è¦åŒ…å«äº†ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://github.com/coredns/coredns/pull/3776">#3776&lt;/a>æ›´å¥½çš„ metrics åç§°ï¼Œå…¶ä¿®æ”¹äº†å¤§é‡çš„ metrics åç§°ï¼ŒDashborad ä¹‹ç±»çš„éƒ½éœ€è¦ä¿®æ”¹äº†ã€‚ ä¾‹å¦‚ï¼š &lt;code>coredns_request_block_count_total&lt;/code> -&amp;gt; &lt;code>coredns_dns_blocked_requests_total&lt;/code>&lt;/li>
&lt;li>&lt;a href="https://github.com/coredns/coredns/pull/3794">#3794&lt;/a> &lt;code>federation&lt;/code> æ’ä»¶å·²ç»è¢«ç§»é™¤ ï¼ˆv1 Kubernetes federationï¼‰;&lt;/li>
&lt;li>ä» &lt;code>kubernetes&lt;/code> æ’ä»¶ä¸­åˆ é™¤äº†ä¸€äº›ä»£ç ï¼Œ æ‰€ä»¥å®ƒä¸ä¼šä½œä¸ºå¤–éƒ¨æ’ä»¶æ„å»ºï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/coredns/coredns/pull/3534">#3534&lt;/a> æ–°çš„ &lt;code>dns64&lt;/code> æ’ä»¶ï¼Œç”±å¤–éƒ¨è½¬ä¸ºå†…ç½®æ’ä»¶ï¼Œè¯¥æ’ä»¶æä¾›äº† DNS64 IPv6 åœ°å€è½¬æ¢æœºåˆ¶ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/coredns/coredns/pull/3737">#3737&lt;/a> &lt;code>plugin/kubernetes&lt;/code>: ç§»é™¤äº†å·²ç»è¿‡æœŸçš„ &lt;code>resyncperiod&lt;/code> å’Œ &lt;code>upstream&lt;/code> é€‰é¡¹ï¼›&lt;/li>
&lt;/ul>
&lt;p>ä»¥ä¸Šä¾¿æ˜¯æ­¤ç‰ˆæœ¬ä¸­å€¼å¾—æ³¨æ„çš„å˜æ›´ï¼Œæ›´å¤šè¯¦ç»†å†…å®¹è¯·å‚çœ‹å…¶ &lt;a href="https://coredns.io/2020/06/15/coredns-1.7.0-release/">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="helm-v324-å‘å¸ƒ">Helm v3.2.4 å‘å¸ƒ&lt;/h2>
&lt;p>è¿™æ˜¯ä¸€ä¸ªå®‰å…¨æ›´æ–°ç‰ˆæœ¬ï¼Œä¸»è¦æ˜¯ä¸ºäº†ä¿®æ­£ä¸€ä¸ªæ¼æ´ï¼Œè¯¥æ¼æ´å½±å“äº† v3.2.4 ä¹‹å‰æ‰€æœ‰ Helm v3 ç‰ˆæœ¬ã€‚æ¼æ´å·ä¸º &lt;a href="https://github.com/helm/helm/security/advisories/GHSA-qq3j-xp49-j73f">CVE-2020-4053&lt;/a>&lt;/p>
&lt;p>æ­¤æ¼æ´çš„å…·ä½“å½±å“èŒƒå›´æ˜¯ï¼Œå½“é€šè¿‡ HTTP çš„æ–¹å¼ä»è¿œç¨‹æ¥å®‰è£…ä¸€ä¸ª Plugin çš„æ—¶å€™ï¼Œå¯èƒ½ä¼šå‘ç”Ÿæ–‡ä»¶ç›®å½•çš„éå†æ”»å‡»ã€‚æ”»å‡»è€…å¯èƒ½ä¼šåœ¨æ¶æ„æ’ä»¶ä¸­åŒ…å«ç›¸å¯¹è·¯å¾„ï¼Œä»¥æ­¤æ¥å°†æ”»å‡»æ–‡ä»¶å¤åˆ¶åˆ°é¢„æœŸçš„æ–‡ä»¶ç›®å½•ä¹‹å¤–ã€‚&lt;/p>
&lt;p>è¿™æ˜¯ä¸€ç§å¾ˆå¸¸è§çš„æ”»å‡»æ–¹æ³•ï¼Œåœ¨ä¹‹å‰çš„ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€æ–‡ç« ä¸­ï¼Œæˆ‘ä¹Ÿä»‹ç»è¿‡ç±»ä¼¼çš„åˆ©ç”¨è¿™ç§æ–‡ä»¶ç›®å½•éå†çš„æ¼æ´ã€‚&lt;/p>
&lt;p>ä¿®æ­£æ–¹å¼ä¹Ÿå¾ˆç®€å•ï¼Œå¯¹äºæ–‡ä»¶çš„è§£å‹æ“ä½œï¼Œåˆ¤æ–­æ˜¯å¦åŒ…å«ç›¸å¯¹è·¯å¾„ï¼Œå¦‚æœæœ‰ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ï¼ˆè¿™é‡Œä¸»è¦æ˜¯ä¸ºäº†è­¦ç¤ºç”¨æˆ·ï¼Œå…¶å®‰è£…çš„å†…å®¹ä¸­å¯èƒ½æœ‰æ¶æ„è¡Œä¸ºï¼‰ã€‚&lt;/p>
&lt;p>å¯¹æ­¤ç‰ˆæœ¬æ„Ÿå…´è¶£çš„æœ‹å‹ï¼Œå¯ä»¥ç›´æ¥&lt;a href="https://github.com/helm/helm/releases/tag/v3.2.4">ä¸‹è½½&lt;/a> ä½¿ç”¨ã€‚&lt;/p>
&lt;h2 id="istio-v163-å‘å¸ƒ">Istio v1.6.3 å‘å¸ƒ&lt;/h2>
&lt;p>æœ¬å‘¨ Istio å‘å¸ƒäº† v1.6.3 ï¼Œæ­¤ç‰ˆæœ¬çš„ä¸»è¦å˜æ›´å¦‚ä¸‹ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://github.com/istio/istio/issues/24264">#24264&lt;/a> ä¿®å¤äº† istio å´©æºƒä¿¡æ¯ä¸º &lt;code>proto.Message is *client.QuotaSpecBinding, not *client.QuotaSpecBinding&lt;/code> çš„é—®é¢˜ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/istio/istio/pull/24365">#24365)&lt;/a> ä¿®æ­£äº† &lt;code>SidecarInjectionSpec&lt;/code> CRDï¼Œ ä» &lt;code>.Values.global&lt;/code> é˜…è¯» &lt;code>imagePullSecret&lt;/code>ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/istio/istio/issues/24469">#24469)&lt;/a> å½“ &lt;code>gateway.runAsRoot&lt;/code> å¼€å¯æ—¶ï¼Œä» &lt;code>PodSecurityContext&lt;/code> ç§»é™¤äº†æ— æ•ˆçš„é…ç½®ï¼›&lt;/li>
&lt;/ul>
&lt;p>æ›´å¤šå…³äºæ­¤ç‰ˆæœ¬çš„ä¿¡æ¯ï¼Œè¯·å‚è€ƒå…¶ &lt;a href="https://istio.io/latest/news/releases/1.6.x/announcing-1.6.3/">ReleaseNote&lt;/a> ã€‚&lt;/p>
&lt;h2 id="rook-v136-å‘å¸ƒ">Rook v1.3.6 å‘å¸ƒ&lt;/h2>
&lt;p>Rook å·²ç»æäº¤äº†ä» CNCF æ‰˜ç®¡é¡¹ç›®ä¸­æ¯•ä¸šçš„ç”³è¯·ï¼Œå¯èƒ½è¿˜éœ€è¦ä¸€æ®µæ—¶é—´æ‰èƒ½æ¯•ä¸šå§ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬æ¥çœ‹çœ‹æœ¬æ¬¡ Rook v1.3.6 ç‰ˆæœ¬çš„æ›´æ–°å†…å®¹ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://github.com/rook/rook/pull/5603">#5603&lt;/a> å°† CSI é©±åŠ¨å‡çº§åˆ°äº† v2.1.2ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/rook/rook/issues/5309">#5309&lt;/a> ä¿®å¤äº† template size å¢åŠ æ—¶ï¼ŒOSD PVC size ä¸å¢åŠ çš„é—®é¢˜ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/rook/rook/pull/5595">#5595&lt;/a> ä¿®æ”¹äº† svc port çš„åç§°ï¼Œéœ€æ±‚ä¸»è¦æ¥è‡ªæƒ³è¦å°† rook ä¸ Istio é›†æˆï¼Œå…¶ä¸­ kiali è¦æ±‚ port åç§°å¿…é¡»æœ‰ä¸ªåè®®å‰ç¼€ï¼Œå…·ä½“ä¿¡æ¯è¯·å‚è€ƒ &lt;a href="https://kiali.io/documentation/validations/#_kia0601_port_name_must_follow_protocol_suffix_form">https://kiali.io/documentation/validations/#_kia0601_port_name_must_follow_protocol_suffix_form&lt;/a> ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/rook/rook/pull/5606">#5606&lt;/a> ä¿®æ­£äº†å°é›†ç¾¤ï¼ˆæ¯”å¦‚ OSD ä¸º 3ï¼‰ å½“ OSD æ›´æ–°æ—¶ï¼Œè·å–çš„ OSD æ•°é‡ä¸å‡†ç¡®çš„æƒ…å†µï¼›&lt;/li>
&lt;/ul>
&lt;p>æ›´å¤šå…³äºæ­¤ç‰ˆæœ¬çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è€ƒå…¶ &lt;a href="https://github.com/rook/rook/releases/tag/v1.3.6">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="ä¸Šæ¸¸è¿›å±•">ä¸Šæ¸¸è¿›å±•&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/pull/90569">#90569&lt;/a> &lt;code>kubectl run&lt;/code> å¢åŠ äº†ä¸€ä¸ª &lt;code>--privileged&lt;/code> çš„å‚æ•°ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/pull/91952">#91952&lt;/a> ä¸º &lt;code>kubeadm join&lt;/code> å¢åŠ äº†ä¸€ä¸ªé‡è¯•çš„å¾ªç¯ï¼Œ é»˜è®¤å†™è¶…æ—¶æ˜¯ 40 sï¼Œ è¯»è¶…æ—¶æ˜¯ 15s ï¼›&lt;/li>
&lt;/ul>
&lt;hr>
&lt;p>æ¬¢è¿è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| Trivy å‘å¸ƒæ–°ç‰ˆæœ¬</title><link>https://moelove.info/2020/06/14/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Trivy-%E5%8F%91%E5%B8%83%E6%96%B0%E7%89%88%E6%9C%AC/</link><guid isPermaLink="true">https://moelove.info/2020/06/14/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Trivy-%E5%8F%91%E5%B8%83%E6%96%B0%E7%89%88%E6%9C%AC/</guid><pubDate>Sun, 14 Jun 2020 15:30:58 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="trivy-å‘å¸ƒ-v09x-ç‰ˆæœ¬">Trivy å‘å¸ƒ v0.9.x ç‰ˆæœ¬&lt;/h2>
&lt;p>&lt;a href="https://github.com/aquasecurity/trivy">Trivy&lt;/a> æ˜¯ä¸€æ¬¾ç”± Aqua Security å¼€æºçš„é•œåƒæ¼æ´å®‰å…¨æ‰«æç¨‹åºï¼Œå¯¹ CI å‹å¥½ã€‚&lt;/p>
&lt;p>åœ¨ä¹‹å‰çš„ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€ä¸­ï¼Œæˆ‘æ›¾ä»‹ç»è¿‡è¿™æ¬¾å·¥å…·ã€‚æœ¬å‘¨å…¶å‘å¸ƒäº† v0.9.x ç³»åˆ—ç‰ˆæœ¬ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›å€¼å¾—æ³¨æ„çš„å˜æ›´ï¼š&lt;/p>
&lt;ul>
&lt;li>æ”¯æŒ &lt;a href="https://github.com/advisories">GitHub Advisory æ•°æ®åº“&lt;/a>äº†ï¼Œç›¸å½“äºæ‰©å……äº†å®ƒçš„æ¼æ´åº“ï¼Œå¯ä»¥å¤§å¹…æå‡ Trivy çš„å‡†ç¡®åº¦ï¼›&lt;/li>
&lt;li>æ”¯æŒæ–‡ä»¶ç³»ç»Ÿæ‰«æï¼Œå¯ä»¥ç›´æ¥åœ¨å·²å¯åŠ¨çš„å®¹å™¨ä¸­ï¼Œæ‰«æå®¹å™¨çš„æ–‡ä»¶ç³»ç»Ÿï¼›&lt;/li>
&lt;li>å¯å†…ç½®åœ¨ Dockerfile ä¸­ï¼Œåœ¨æ„å»ºé•œåƒçš„è¿‡ç¨‹ä¸­ï¼Œç›´æ¥è¿›è¡Œæ¼æ´æ‰«æ, ä¾‹å¦‚ï¼š&lt;/li>
&lt;/ul>
&lt;pre>&lt;code>$ cat Dockerfile
FROM alpine:3.7
RUN apk add --no-cache curl \
&amp;amp;&amp;amp; curl -sfL https://raw.githubusercontent.com/aquasecurity/trivy/master/contrib/install.sh | sh -s -- -b /usr/local/bin \
&amp;amp;&amp;amp; trivy filesystem --exit-code 1 --no-progress / \
&amp;amp;&amp;amp; trivy --reset &amp;amp;&amp;amp; rm -f /usr/loca/bin/trivy &amp;amp;&amp;amp; apk del curl
$ docker build -t vulnerable-image
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>æ”¯æŒç›´æ¥æ‰«æ Git ä»“åº“ï¼ˆå½“å‰åªå…è®¸æ‰«æå…¬å¼€ä»“åº“ï¼‰;&lt;/li>
&lt;/ul>
&lt;p>å¯¹æ­¤ç‰ˆæœ¬æ„Ÿå…´è¶£çš„å°ä¼™ä¼´ï¼Œæ¬¢è¿ä¸‹è½½ä½“éªŒ &lt;a href="https://github.com/aquasecurity/trivy/releases/tag/v0.9.1">https://github.com/aquasecurity/trivy/releases/tag/v0.9.1&lt;/a>&lt;/p>
&lt;h2 id="kubernetes-nginx-ingress-å‘å¸ƒ-v033">Kubernetes NGINX Ingress å‘å¸ƒ v0.33&lt;/h2>
&lt;p>Kubernetes NGINX Ingress æƒ³å¿…å¤§å®¶ä¸ä¼šå¤ªé™Œç”Ÿï¼Œæ­¤é¡¹ç›®ä¹Ÿç®—æ˜¯å‘ç‰ˆè¾¾äººï¼Œæ›´æ–°é¢‘ç‡è¾ƒé«˜ã€‚&lt;/p>
&lt;p>æ­¤æ¬¡å‘å¸ƒçš„ v0.33 ä¸­ä¸»è¦çš„å˜æ›´å¦‚ä¸‹ï¼š&lt;/p>
&lt;ul>
&lt;li>ä½¿ç”¨ NGINX v1.19.0ï¼›&lt;/li>
&lt;li>é»˜è®¤å¼€å¯ TLSv1.3 ï¼›&lt;/li>
&lt;li>&lt;code>access-log-path&lt;/code> æ ‡è®°æˆäº†åºŸå¼ƒï¼Œè¯·ä½¿ç”¨ &lt;code>http-access-log-path&lt;/code> å’Œ &lt;code>stream-access-log-path&lt;/code> è¿›è¡Œæ›¿ä»£ï¼›&lt;/li>
&lt;/ul>
&lt;p>å¯¹æ­¤ç‰ˆæœ¬æ„Ÿå…´è¶£çš„å°ä¼™ä¼´ï¼Œæ¬¢è¿ä¸‹è½½ä½“éªŒ &lt;a href="https://github.com/kubernetes/ingress-nginx/releases/tag/controller-0.33.0">https://github.com/kubernetes/ingress-nginx/releases/tag/controller-0.33.0&lt;/a>&lt;/p>
&lt;h2 id="ä¸Šæ¸¸è¿›å±•">ä¸Šæ¸¸è¿›å±•&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/pull/90191">#90191&lt;/a> CertificateSigningRequest v1beta1 API å’Œ &lt;a href="https://github.com/kubernetes/kubernetes/pull/91685">#91685&lt;/a> CertificateSigningRequest v1 API ã€‚é¦–å…ˆå®Œæˆäº† v1beta1 APIï¼Œå¢åŠ äº†ä¸€äº›å­—æ®µå’Œå…¶ä»–å¿…è¦çš„å†…å®¹ï¼Œä¸ºåç»­ç‰ˆæœ¬åšå‡†å¤‡ã€‚ å…¶æ¬¡å¢åŠ äº† v1 APIï¼Œæ·»åŠ äº†ä¸€äº›å‘åå…¼å®¹çš„æ”¹è¿›ã€‚æ•´ä½“è€Œè¨€æ˜¯ CSR API çš„ä¸€å¤§é‡è¦æ”¹è¿›ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/pull/91275">#91275&lt;/a> kubelet çš„ &lt;code>--node-status-max-images&lt;/code> å‚æ•°å·²ç§»åŠ¨è‡³é…ç½®æ–‡ä»¶ä¸­ï¼›&lt;/li>
&lt;/ul>
&lt;h2 id="é¢˜å¤–è¯">é¢˜å¤–è¯&lt;/h2>
&lt;p>æ•´ä½“è€Œè¨€ï¼Œæœ¬å‘¨ç¤¾åŒºç›¸å¯¹å®‰é™ï¼Œä¸»è¦å¯èƒ½å’Œå¤§çš„ç¯å¢ƒæœ‰å…³ã€‚å„ç±»æŠ€æœ¯ç¤¾åŒºä¹Ÿéƒ½çº·çº·åŠ å…¥å…¶ä¸­äº†ã€‚&lt;/p>
&lt;p>å¦å¤–ï¼Œçœ‹ç°åœ¨å›½å†…ç›¸å…³çš„æŠ¥é“ï¼Œè¿˜æ˜¯éœ€è¦æ³¨æ„èº«ä½“ï¼Œä¿æŠ¤å¥½è‡ªå·±å’Œå®¶äººã€‚&lt;/p>
&lt;hr>
&lt;p>æ¬¢è¿è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| å‡ ä¹å½±å“æ‰€æœ‰ k8s é›†ç¾¤çš„æ¼æ´</title><link>https://moelove.info/2020/06/07/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-%E5%87%A0%E4%B9%8E%E5%BD%B1%E5%93%8D%E6%89%80%E6%9C%89-k8s-%E9%9B%86%E7%BE%A4%E7%9A%84%E6%BC%8F%E6%B4%9E/</link><guid isPermaLink="true">https://moelove.info/2020/06/07/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-%E5%87%A0%E4%B9%8E%E5%BD%B1%E5%93%8D%E6%89%80%E6%9C%89-k8s-%E9%9B%86%E7%BE%A4%E7%9A%84%E6%BC%8F%E6%B4%9E/</guid><pubDate>Sun, 07 Jun 2020 19:50:52 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="docker-v190311-å‘å¸ƒ">Docker v19.03.11 å‘å¸ƒ&lt;/h2>
&lt;p>è·ç¦» v19.03.10 å‘å¸ƒä»…ä¸€å‘¨æ—¶é—´ï¼ŒDocker åˆå‘å¸ƒäº†æ–°ç‰ˆæœ¬ v19.03.11 ã€‚æ­¤ç‰ˆæœ¬æ˜¯ä¸€ä¸ªå®‰å…¨ä¿®å¤ç‰ˆæœ¬ï¼Œé€šè¿‡ç¦ç”¨äº† IPv6 è·¯ç”±åœ°å€å¹¿æ’­ï¼ˆRAï¼‰ä»è€Œé˜²æ­¢åœ°å€æ¬ºéª—ï¼Œå¯¹åº”çš„æ¼æ´ä¸º &lt;a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-13401">CVE-2020-13401&lt;/a> ã€‚&lt;/p>
&lt;p>åœ¨ Docker çš„é»˜è®¤é…ç½®ä¸­ï¼Œå®¹å™¨ç½‘ç»œæ¥å£æ˜¯æŒ‡å‘ä¸»æœºï¼ˆveth æ¥å£ï¼‰çš„è™šæ‹Ÿä»¥å¤ªç½‘é“¾æ¥ï¼Œåœ¨æ­¤é…ç½®ä¸‹ï¼Œå¦‚æœä¸€ä¸ªæ”»å‡»è€…å¯ä»¥åœ¨å®¹å™¨ä¸­ä»¥ root èº«ä»½è¿è¡Œè¿›ç¨‹çš„è¯ï¼Œé‚£ä¹ˆä»–æ˜¯å¯ä»¥ä½¿ç”¨ &lt;code>CAP_NET_RAW&lt;/code> èƒ½åŠ›ï¼Œå‘ä¸»æœºä»»æ„å‘é€å’Œæ¥æ”¶æ•°æ®åŒ…çš„ã€‚&lt;/p>
&lt;p>ä¾‹å¦‚ï¼š åœ¨å®¹å™¨å†…ä½¿ç”¨ root ç”¨æˆ·ï¼Œå¯ä»¥æ­£å¸¸æ‰§è¡Œ &lt;code>ping&lt;/code> å‘½ä»¤&lt;/p>
&lt;pre>&lt;code>(MoeLove) âœ ~ docker run --rm -it -u root redis:alpine sh
/data # whoami
root
/data # ping -c 1 moelove.info
PING moelove.info (185.199.108.153): 56 data bytes
64 bytes from 185.199.108.153: seq=0 ttl=49 time=54.389 ms
--- moelove.info ping statistics ---
1 packets transmitted, 1 packets received, 0% packet loss
round-trip min/avg/max = 54.389/54.389/54.389 ms
&lt;/code>&lt;/pre>&lt;p>åœ¨å®¹å™¨å†…ä½¿ç”¨é root ç”¨æˆ·ï¼Œæ‰§è¡Œ &lt;code>ping&lt;/code> å‘½ä»¤ä¼šæç¤ºæ— æƒé™&lt;/p>
&lt;pre>&lt;code>(MoeLove) âœ ~ docker run --rm -it -u redis redis:alpine sh
/data # whoami
redis
/data $ ping -c 1 moelove.info
PING moelove.info (185.199.109.153): 56 data bytes
ping: permission denied (are you root?)
&lt;/code>&lt;/pre>&lt;p>å¦‚æœæ²¡æœ‰åœ¨ä¸»æœºä¸Šå®Œå…¨ç¦ç”¨ IPv6 ï¼ˆé€šè¿‡å†…æ ¸å‚æ•° &lt;code>ipv6.disable=1&lt;/code>ï¼‰, é‚£ä¹ˆä¸»æœºä¸Šçš„ç½‘ç»œæ¥å£å¯ä»¥è‡ªå·±è¿›è¡Œé…ç½®ã€‚å¦‚æœé…ç½®é¡¹ä¸º &lt;code>/proc/sys/net/ipv6/conf/*/forwarding == 0&lt;/code> é‚£è¡¨ç¤ºè¯¥æ¥å£ç¦ç”¨äº† IPv6 è½¬å‘ã€‚å…¨å±€çš„é™æ€é…ç½®å¯ä»¥åœ¨ä»¥ä¸‹ä½ç½®çœ‹åˆ°ï¼š&lt;/p>
&lt;pre>&lt;code>(MoeLove) âœ ~ cat /proc/sys/net/ipv6/conf/all/forwarding
1
&lt;/code>&lt;/pre>&lt;p>å¦å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªé»˜è®¤é…ç½®æ˜¯å…³äºæ˜¯å¦æ¥æ”¶ RA æ¶ˆæ¯çš„ï¼Œå¦‚æœé…ç½®é¡¹ä¸º &lt;code>/proc/sys/net/ipv6/conf/*/accept_ra == 1&lt;/code>ï¼Œåˆ™è¡¨ç¤ºè¯¥æ¥å£é»˜è®¤æ¥æ”¶ RA æ¶ˆæ¯ã€‚å…¨å±€çš„é™æ€é…ç½®å¯ä»¥åœ¨ä»¥ä¸‹ä½ç½®çœ‹åˆ°ï¼š&lt;/p>
&lt;pre>&lt;code>(MoeLove) âœ ~ cat /proc/sys/net/ipv6/conf/all/accept_ra
1
&lt;/code>&lt;/pre>&lt;p>ä¸Šè¿°çš„ä¸¤ä¸ªç³»ç»Ÿé»˜è®¤é…ç½®çš„ç»„åˆï¼Œè¡¨ç¤ºç³»ç»Ÿæ¥å—è·¯ç”±å¹¿æ’­ï¼ˆRAï¼‰æ¶ˆæ¯ï¼Œå¹¶ä¸”ä½¿ç”¨å®ƒé…ç½® IPv6 ç½‘ç»œæ ˆï¼ˆSLAACï¼‰ã€‚å¦‚æœç†Ÿæ‚‰ IETF RFC 4861 çš„å°ä¼™ä¼´åº”è¯¥çŸ¥é“ï¼ŒICMPv6 RA è™½ç„¶æœ¬æ„æ˜¯å¥½çš„ï¼Œä½†å®ƒç¡®å®å­˜åœ¨å®‰å…¨é£é™©ã€‚&lt;/p>
&lt;p>åœ¨å°šæœªä½¿ç”¨ IPv6 çš„ç½‘ç»œä¸­ï¼ŒåŒæ ˆä¸»æœºå¤„äºä¼‘çœ çŠ¶æ€ï¼Œå¹¶ç­‰å¾…æœ€ç»ˆçš„ RA æ¶ˆæ¯æ¥å”¤é†’å…¶ IPv6 è¿æ¥ã€‚æ”»å‡»è€…å¯ä»¥åˆ¶ä½œæ¶æ„çš„ RA æ¶ˆæ¯ï¼Œè·å–ç½‘ç»œä¸­çš„åŒåè®®èŠ‚ç‚¹ä»¥é…ç½®å…¶ IPv6 åœ°å€ï¼Œå¹¶åˆ©ç”¨æ”»å‡»è€…çš„ç³»ç»Ÿä½œä¸ºå…¶é»˜è®¤çš„ç½‘å…³ã€‚è¿™æ ·ä¾¿å¯å¾ˆç®€å•çš„å®æ–½ä¸­é—´äººæ”»å‡»äº†ã€‚åœ¨ RFC 6104 ä¸­å…¶å®æ—©å°±è®°å½•è¿‡è¿™ä¸ªé—®é¢˜ï¼Œä¹Ÿæœ‰å¾ˆå¤šç›¸å…³çš„è§£å†³æ–¹æ¡ˆï¼Œæ­¤å¤„å°±ä¸å±•å¼€äº†ï¼Œæ¶‰åŠçš„ä¸œè¥¿å¤ªå¤šäº†ã€‚&lt;/p>
&lt;p>å¯¹åº”åˆ°æ­¤æ¬¡æ¼æ´ä¸­ï¼Œå¦‚æœæ”»å‡»è€…é€šè¿‡å®¹å™¨å‘é€æ¶æ„ RA æ¶ˆæ¯ï¼ˆrogue RAï¼‰ï¼Œåˆ™å¯ä»¥é‡æ–°é…ç½®ä¸»æœºï¼Œå°†ä¸»æœºçš„éƒ¨åˆ†æˆ–è€…å…¨éƒ¨ IPv6 é€šä¿¡éƒ½é‡å®šå‘åˆ°æ”»å‡»è€…æ§åˆ¶çš„å®¹å™¨ã€‚&lt;/p>
&lt;p>å³ä½¿ä¹‹å‰æ²¡æœ‰ IPv6 æµé‡ï¼Œå¦‚æœ DNS æœåŠ¡å™¨è¿”å› Aï¼ˆIPv4ï¼‰å’Œ AAAAï¼ˆIPv6ï¼‰è®°å½•çš„è¯ï¼Œå¾ˆå¤š HTTP åº“å°†ä¼šé¦–å…ˆå°è¯•è¿›è¡Œ IPv6 è¿æ¥ï¼Œç„¶åå†å›é€€åˆ° IPv4 ã€‚è¿™å°±ä¸ºæ”»å‡»è€…æä¾›äº†åˆ¶é€ å“åº”çš„æœºä¼šã€‚&lt;/p>
&lt;p>å¦‚æœä¸»æœºæ°å¥½æœ‰ç±»ä¼¼å»å¹´ apt çš„ &lt;a href="https://nvd.nist.gov/vuln/detail/CVE-2019-3462">CVE-2019-3462&lt;/a> è¿™ç§æ¼æ´çš„è¯ï¼Œåˆ™æ”»å‡»è€…ä¾¿å¯èƒ½è·å–ä¸»æœºæƒé™ã€‚&lt;/p>
&lt;p>æ€»ä½“è€Œè¨€ï¼ŒDocker å®¹å™¨é»˜è®¤æ²¡æœ‰é…ç½® &lt;code>CAP_NET_ADMIN&lt;/code> èƒ½åŠ›ï¼Œæ‰€ä»¥æ”»å‡»è€…æ— æ³•ç›´æ¥å°†å…¶é…ç½®ä¸ºä¸­é—´äººæ”»å‡»çš„ IPï¼Œæ— æ³•ä½¿ç”¨ iptables è¿›è¡Œ &lt;code>NAT&lt;/code> æˆ–è€… &lt;code>REDIRECT&lt;/code> æµé‡ï¼Œä¹Ÿä¸èƒ½ä½¿ç”¨ &lt;code>IP_TRANSPARENT&lt;/code>ã€‚ä½†æ˜¯æ”»å‡»è€…ä»ç„¶å¯ä»¥ä½¿ç”¨ &lt;code>CAP_NET_RAW&lt;/code> èƒ½åŠ›ï¼Œå¹¶åœ¨ç”¨æˆ·ç©ºé—´å®ç° TCP/IP å †æ ˆã€‚&lt;/p>
&lt;p>èŠå®Œ Docker ç›¸å…³çš„è¿™ä¸ªæ¼æ´ï¼Œè¿™é‡Œå°±é¡ºä¾¿å±•å¼€èŠèŠç›¸å…³çš„ä¸€äº›å…¶ä»–é—®é¢˜å§ã€‚&lt;/p>
&lt;p>ä¸æ­¤æ¼æ´ç±»ä¼¼çš„ï¼Œå—å½±å“çš„è¿˜æœ‰ &lt;strong>Kubernetes&lt;/strong> ï¼Œ ä½†å¹¶ä¸æ˜¯ Kubernetes è‡ªèº«çš„æ¼æ´ï¼Œè€Œæ˜¯å®˜æ–¹å®‰è£…æºä»“åº“ä¸­ï¼Œkubelet ä¾èµ–çš„ &lt;code>kubernetes-cni&lt;/code> CNI åŒ…ï¼Œä¹Ÿå­˜åœ¨æ¼æ´ &lt;a href="https://nvd.nist.gov/vuln/detail/CVE-2020-10749">CVE-2020-10749&lt;/a>&lt;/p>
&lt;p>å—å½±å“ç‰ˆæœ¬ä¸ºï¼š&lt;/p>
&lt;ul>
&lt;li>kubelet v1.18.0-v1.18.3&lt;/li>
&lt;li>kubelet v1.17.0-v1.17.6&lt;/li>
&lt;li>kubelet v1.16.11 ä¹‹å‰ç‰ˆæœ¬&lt;/li>
&lt;/ul>
&lt;p>ç¬¬ä¸‰æ–¹ç»„ä»¶ç›¸å…³çš„æ¼æ´ä¿¡æ¯ï¼š&lt;/p>
&lt;ul>
&lt;li>Calico å’Œ Calico Enterprise (CVE-2020-13597) æ¼æ´ä¿¡æ¯ TTA-2020-001 å¯åœ¨æ­¤å¤„ &lt;a href="https://www.projectcalico.org/security-bulletins/">https://www.projectcalico.org/security-bulletins/&lt;/a> æŸ¥çœ‹ï¼›&lt;/li>
&lt;li>CNI Plugins v0.8.6 ä¹‹å‰ç‰ˆæœ¬ ï¼ˆCVE-2020-10749ï¼‰ï¼Œè¯¦æƒ…è§ &lt;a href="https://github.com/containernetworking/plugins/pull/484">https://github.com/containernetworking/plugins/pull/484&lt;/a>ï¼›&lt;/li>
&lt;li>Flannel å…¨éƒ¨ç‰ˆæœ¬ï¼›&lt;/li>
&lt;li>Weave Net v2.6.3 ä¹‹å‰ç‰ˆæœ¬ï¼›&lt;/li>
&lt;/ul>
&lt;p>ä»¥ä¸‹ç¬¬ä¸‰æ–¹ç»„ä»¶ç›®å‰æœªå—æ­¤æ¬¡æ¼æ´å½±å“ï¼š&lt;/p>
&lt;ul>
&lt;li>Cilium&lt;/li>
&lt;li>Juniper Contrail Networking&lt;/li>
&lt;li>OpenShift SDN&lt;/li>
&lt;li>OVN-Kubernetes&lt;/li>
&lt;li>Tungsten Fabric&lt;/li>
&lt;/ul>
&lt;p>ç»“åˆå‰é¢æˆ‘å¯¹æ­¤æ¼æ´çš„è¯´æ˜ï¼Œæƒ³å¿…ä½ ä¹Ÿçœ‹åˆ°äº†ï¼Œè§£å†³æ­¤æ¼æ´æœ€ç®€å•çš„æ–¹æ³•æ˜¯ï¼š&lt;/p>
&lt;ul>
&lt;li>æ›´æ–°ç›¸å…³ç»„ä»¶åˆ°æœ€æ–°ï¼ˆåŒ…å«ä¿®å¤å†…å®¹ï¼‰çš„ç‰ˆæœ¬ï¼ˆæˆªè‡³ç›®å‰ï¼Œç›¸å…³å—å½±å“ç»„ä»¶ä¸­ï¼Œé™¤ Flannel å¤–ï¼Œå‡å·²å‘å¸ƒæ–°ç‰ˆæœ¬æ¥è§£å†³æ­¤æ¼æ´ï¼‰ï¼›&lt;/li>
&lt;li>å¯ä»¥åœ¨ç³»ç»Ÿä¸­ç¦æ­¢æ¥æ”¶ RA æ¶ˆæ¯ï¼ˆå¦‚æœä½ ä¸éœ€è¦ RA æ¶ˆæ¯çš„è¯ï¼‰ï¼›&lt;/li>
&lt;li>ä¹Ÿå¯ä»¥ç¦ç”¨å®¹å™¨çš„ &lt;code>CAP_NET_RAW&lt;/code> èƒ½åŠ›ï¼Œä¾‹å¦‚ï¼š&lt;/li>
&lt;/ul>
&lt;pre>&lt;code>(MoeLove) âœ ~ docker run --cap-drop CAP_NET_RAW --rm -it -u root redis:alpine sh
/data # ping -c 1 moelove.info
PING moelove.info (185.199.108.153): 56 data bytes
ping: permission denied (are you root?)
&lt;/code>&lt;/pre>&lt;h2 id="docker-compose-v1260-å‘å¸ƒ">Docker Compose v1.26.0 å‘å¸ƒ&lt;/h2>
&lt;p>Docker Compose æ˜¯ä¸€ä¸ªå¾ˆæ–¹ä¾¿çµæ´»çš„å·¥å…·ï¼Œå¤§å®¶åº”è¯¥ä¸ä¼šé™Œç”Ÿã€‚å‰æ®µæ—¶é—´ Docker å°† Compose è§„èŒƒå¼€æºåï¼Œç¤¾åŒºåœ¨é€æ­¥æˆé•¿ä¸­ã€‚&lt;/p>
&lt;p>æœ¬æ¬¡å‘å¸ƒçš„ v1.26.0 ä¸­ï¼ŒåŒ…å«äº†å¾ˆå¤šå€¼å¾—æ³¨æ„çš„å†…å®¹ï¼š&lt;/p>
&lt;ul>
&lt;li>æ·»åŠ äº†å¯¹ &lt;code>doker context&lt;/code> çš„æ”¯æŒï¼Œ&lt;code>context&lt;/code> éå¸¸å¥½ç”¨ï¼Docker Inc. åœ¨ä»Šå¹´çš„ Docker Con ä¹‹å‰è¿˜å’Œ Azure è¾¾æˆäº†åˆä½œï¼ŒåŠ é€Ÿä»æœ¬åœ°åˆ°äº‘çš„å¼€å‘/éƒ¨ç½²ç­‰ï¼Œå…·ä½“æ“ä½œä¸Šä¹Ÿéƒ½æ˜¯é€šè¿‡ context å®ç°çš„ï¼›&lt;/li>
&lt;li>æ”¯æŒé€šè¿‡ &lt;code>COMPOSE_COMPATIBILITY&lt;/code> ç¯å¢ƒå˜é‡é…ç½®å…¶èƒ½åŠ›ï¼›&lt;/li>
&lt;/ul>
&lt;p>å¯¹æ­¤ç‰ˆæœ¬æ„Ÿå…´è¶£çš„æœ‹å‹è¯·å‚è€ƒå…¶ &lt;a href="https://docs.docker.com/compose/release-notes/#1260">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="kube-ovn-v12-å‘å¸ƒ">Kube-OVN v1.2 å‘å¸ƒ&lt;/h2>
&lt;p>Kube-OVN æ˜¯é¦–æ¬¡å‡ºç°åœ¨ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€ä¸­çš„é¡¹ç›®ï¼Œç¨å¾®åšä¸‹ä»‹ç»ã€‚å®ƒæ˜¯ä¸€æ¬¾åŸºäº OVN çš„ Kubernetes ç½‘ç»œç»„ä»¶ï¼Œé€šè¿‡å°†OpenStacké¢†åŸŸæˆç†Ÿçš„ç½‘ç»œåŠŸèƒ½å¹³ç§»åˆ°Kubernetesï¼Œæ¥åº”å¯¹æ›´åŠ å¤æ‚çš„åŸºç¡€ç¯å¢ƒå’Œåº”ç”¨åˆè§„æ€§è¦æ±‚ã€‚&lt;/p>
&lt;p>Kube-OVNä¸»è¦å…·å¤‡äº”å¤§ä¸»è¦åŠŸèƒ½ï¼šNamespace å’Œå­ç½‘çš„ç»‘å®šï¼Œä»¥åŠå­ç½‘é—´è®¿é—®æ§åˆ¶ï¼Œé™æ€IPåˆ†é…ï¼ŒåŠ¨æ€QoSï¼Œåˆ†å¸ƒå¼å’Œé›†ä¸­å¼ç½‘å…³ï¼Œå†…åµŒ LoadBalancerã€‚&lt;/p>
&lt;p>æœ¬æ¬¡å‘å¸ƒçš„ v1.2 ä¸­åŒ…å«äº†ä»¥ä¸‹é‡è¦æ›´æ–°ï¼š&lt;/p>
&lt;ul>
&lt;li>å¼€å§‹æ”¯æŒ OVS-DPDK ä»¥ä¾¿äºæ”¯æŒé«˜æ€§èƒ½ dpdk åº”ç”¨ï¼›&lt;/li>
&lt;li>æ”¯æŒä½¿ç”¨ BGP å°† Pod IP è·¯ç”±å®£å‘Šåˆ°å¤–éƒ¨ç½‘ç»œï¼›&lt;/li>
&lt;li>åœ¨åˆ›å»ºåï¼Œæ”¯æŒä¿®æ”¹å­ç½‘ CIDR ï¼ˆæˆ‘ä¸ªäººè§‰å¾—è¿™ä¸ªåŠŸèƒ½ç‰¹åˆ«æœ‰ç”¨ï¼Œç½‘ç»œè§„åˆ’ä¹Ÿæœ‰åŠ¨æ€è°ƒæ•´çš„å®é™…éœ€æ±‚ï¼‰ï¼›&lt;/li>
&lt;li>å½“å­ç½‘ç½‘å…³ä¿®æ”¹åï¼Œè·¯ç”±å¯ä»¥è‡ªåŠ¨æ›´æ”¹ï¼›&lt;/li>
&lt;/ul>
&lt;p>å¯¹æ­¤ç‰ˆæœ¬æ„Ÿå…´è¶£çš„æœ‹å‹è¯·å‚è€ƒå…¶ &lt;a href="https://github.com/alauda/kube-ovn/releases/tag/v1.2.0">RelaseNote&lt;/a>&lt;/p>
&lt;h2 id="ä¸Šæ¸¸è¿›å±•">ä¸Šæ¸¸è¿›å±•&lt;/h2>
&lt;p>æœ¬å‘¨ Kubernetes v1.19.0-beta1 å·²ç»å‘å¸ƒï¼&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/pull/91113">#91113&lt;/a> å’Œ &lt;a href="https://github.com/kubernetes/kubernetes/pull/91481">#91481&lt;/a> åœ¨ &lt;code>kubectl create deployment&lt;/code> æ—¶ï¼Œå¢åŠ äº† &lt;code>--port&lt;/code> çš„é€‰é¡¹ï¼›&lt;/li>
&lt;/ul>
&lt;p>å¦ä¸€ä¸ªå€¼å¾—å¼€å¿ƒçš„å˜æ›´æ¥è‡ª etcd :&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://github.com/etcd-io/etcd/pull/11946">#11946&lt;/a> ä¸º etcd æ·»åŠ äº†ä¸€ä¸ª &lt;code>--unsafe-no-fsync&lt;/code> çš„é€‰é¡¹ï¼Œå¯ä»¥ç¦æ­¢æ–‡ä»¶åŒæ­¥ã€‚è¿™å¯¹äºæœ¬åœ°å¼€å‘/CI æµ‹è¯•éƒ½æ˜¯éå¸¸å¥½çš„ï¼&lt;/li>
&lt;/ul>
&lt;hr>
&lt;p>æ¬¢è¿è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/IPv6/">IPv6</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| Docker v19.03.10 æ­£å¼å‘å¸ƒ</title><link>https://moelove.info/2020/05/31/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Docker-v19.03.10-%E6%AD%A3%E5%BC%8F%E5%8F%91%E5%B8%83/</link><guid isPermaLink="true">https://moelove.info/2020/05/31/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Docker-v19.03.10-%E6%AD%A3%E5%BC%8F%E5%8F%91%E5%B8%83/</guid><pubDate>Sun, 31 May 2020 23:18:33 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="node-exporter-v100-æ­£å¼å‘å¸ƒ">Node Exporter v1.0.0 æ­£å¼å‘å¸ƒ&lt;/h2>
&lt;p>&lt;a href="https://prometheus.io/">Prometheus&lt;/a> æ˜¯æœ€æ—©ç”± SoundCloud å¼€æºçš„ç›‘æ§å‘Šè­¦è§£å†³æ–¹æ¡ˆã€‚å¹¶å·²ç»æˆé•¿ä¸ºç»§ Kubernetes ä¹‹åï¼Œç¬¬äºŒä¸ªä» CNCF æ¯•ä¸šçš„é¡¹ç›®ã€‚ä¼´éšç€äº‘åŸç”Ÿç†å¿µçš„æ™®åŠå’Œ Kubernetes ç­‰æŠ€æœ¯çš„å‘å±•ï¼Œ Prometheus åœ¨ç›‘æ§é¢†åŸŸä¹Ÿæœ‰äº†é•¿è¶³çš„å‘å±•ã€‚&lt;/p>
&lt;p>å…¶ä¸»è¦ç»„ä»¶åŒ…æ‹¬ Prometheusï¼ŒAlertmanagerï¼ŒNode Exporterï¼ŒBlackbox Exporter å’Œ Pushgateway ç­‰ã€‚&lt;/p>
&lt;p>Promethues é‡‡å– Pull çš„æ¨¡å¼ï¼Œæ‰€é‡‡é›†çš„ metrics éœ€è¦ç”±å¯¹åº”çš„ Exporter æš´éœ²å‡ºæ¥ã€‚æˆ‘ä»¬æœ€å¸¸ç”¨çš„ç”¨äºæ”¶é›†ç³»ç»Ÿ metrics çš„ç»„ä»¶ä¾¿æ˜¯ Node Exporter äº†ã€‚&lt;/p>
&lt;p>æœ¬å‘¨ï¼ŒNode Exporter ç»ˆäºè¿æ¥äº† v1.0.0 ç‰ˆæœ¬ï¼Œæ ‡å¿—ç€å®ƒæ›´åŠ ç¨³å®šï¼Œæ›´åŠ é€šç”¨ã€‚&lt;/p>
&lt;p>æˆ‘åœ¨æœ¬å‘¨ä¸“é—¨å†™äº†ä¸€ç¯‡æ–‡ç« æ¥ä»‹ç»å®ƒè¿™ä¸ªç‰ˆæœ¬ä¸­æˆ‘æœ€å…³æ³¨çš„ç‰¹æ€§ï¼š &lt;a href="https://zhuanlan.zhihu.com/p/144048025">ä¸º Prometheus Node Exporter åŠ ä¸Šè®¤è¯&lt;/a>, æˆ‘ä»¬å¯ä»¥è®©ç›‘æ§å˜å¾—æ›´åŠ å®‰å…¨ã€‚&lt;/p>
&lt;p>å½“ç„¶è¿™ä¸ªç‰ˆæœ¬ä¸­ä¹ŸåŒ…å«äº†ä¼—å¤šå˜æ›´å’Œ bugfixï¼Œ è¿™é‡Œæš‚ä¸”è·³è¿‡ï¼Œæœ‰å…´è¶£çš„å°ä¼™ä¼´å¯ç›´æ¥å‚é˜…å…¶ &lt;a href="https://github.com/prometheus/node_exporter/releases/tag/v1.0.0">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="docker-v190310-å‘å¸ƒ">Docker v19.03.10 å‘å¸ƒ&lt;/h2>
&lt;p>Docker åœ¨æœ¬å‘¨å‘å¸ƒäº† v19.03.10 ç‰ˆæœ¬ï¼Œè·ç¦»ä¸Šä¸ªç‰ˆæœ¬ v19.03.9 ä»…è¿‡äº†ä¸¤å‘¨çš„æ—¶é—´ï¼Œå¦‚æœåœ¨ä½¿ç”¨ Docker v19.03.x ç‰ˆæœ¬çš„å°ä¼™ä¼´ï¼Œæˆ‘ä¸ªäººè¿˜æ˜¯å»ºè®®ä½ æ›´æ–°åˆ°æ­¤ç‰ˆæœ¬ã€‚&lt;/p>
&lt;p>æ­¤ç‰ˆæœ¬ä¸­æœ€ä¸»è¦çš„ä¸€ä¸ªä¿®å¤æ˜¯ç½‘ç»œç›¸å…³çš„ï¼Œå…·ä½“è€Œè¨€æ˜¯ä¸å†…ç½® DNS ï¼ˆembedded DNSï¼‰ æœ‰å…³çš„é—®é¢˜ï¼Œåœ¨ç‰¹å®šåœºæ™¯ä¸‹ï¼Œå¦‚æœä½ åˆ›å»ºäº†è‡ªå®šä¹‰ç½‘ç»œï¼Œå½“è§£æå¤–éƒ¨åŸŸåæ—¶ï¼Œå¯èƒ½ä¼šå‡ºç°è§£æå¤±è´¥çš„æƒ…å†µã€‚&lt;/p>
&lt;p>è¿™ä¸ªé—®é¢˜çš„æ ¹å› æœ€æ—©æ˜¯ä»Šå¹´ 3 æœˆä»½æˆ‘åœ¨å‚ä¸ Docker å¼€å‘æ—¶é‡åˆ°çš„ï¼Œå½“å†…ç½® DNS æœåŠ¡å™¨åŸŸåè§£æå¤±è´¥æ—¶ï¼Œå¯èƒ½ä¼šè§¦å‘ panic å¯¼è‡´ Docker daemon å¼‚å¸¸é€€å‡ºã€‚éšå &lt;em>Sam Whited&lt;/em> åœ¨ &lt;code>moby/libnetwork&lt;/code> ä¸­å¿«é€Ÿçš„å¯¹å…¶è¿›è¡Œäº†ä¿®æ­£ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-diff" data-lang="diff">&lt;span class="gd">- if err != nil &amp;amp;&amp;amp; !resp.Truncated {
&lt;/span>&lt;span class="gd">&lt;/span>&lt;span class="gi">+ if err != nil &amp;amp;&amp;amp; (resp != nil &amp;amp;&amp;amp; !resp.Truncated) {
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¿®æ”¹çš„å†…å®¹çœ‹èµ·æ¥å¾ˆç®€å•ï¼Œåœ¨å¼‚å¸¸å¤„ç†æ—¶ï¼Œå¢åŠ äº† &lt;code>resp != nil&lt;/code> çš„æ¡ä»¶ï¼Œè¿™ç¡®å®ä¿®æ­£äº†æˆ‘å½“æ—¶é‡åˆ°çš„æƒ…å†µã€‚&lt;/p>
&lt;p>ä½†è¿™ä¸ªä¿®æ­£å´ä¼šå¿½ç•¥è¿”å›é”™è¯¯ä½†æ— å“åº”çš„æƒ…å†µï¼Œæ¯”å¦‚ DNS æœåŠ¡å™¨å¼‚å¸¸ä¹‹ç±»çš„æƒ…å†µã€‚ä½†ç”±äºåç»­ Docker ä¸­çš„é€»è¾‘å¤„ç†ä¸­ï¼Œéœ€è¦ä¾èµ–äºæ­¤å¤„çš„é”™è¯¯å¤„ç†ï¼Œæ‰€ä»¥ä¼šé”™è¯¯çš„è®¤ä¸º DNS æœåŠ¡å™¨å·²è¿æ¥æˆåŠŸï¼Œåªæ˜¯æ²¡æœ‰å“åº”ç½¢äº†ã€‚è¿™ä¹Ÿå°±å¸¦æ¥äº†é—®é¢˜ã€‚&lt;/p>
&lt;p>æ‰€ä»¥è¿™æ¬¡çš„ä¿®æ­£ï¼Œä¹Ÿè¿˜æ˜¯åœ¨è¿™ä¸ªä½ç½®ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-diff" data-lang="diff">&lt;span class="gd">- if err != nil &amp;amp;&amp;amp; (resp != nil &amp;amp;&amp;amp; !resp.Truncated) {
&lt;/span>&lt;span class="gd">&lt;/span>&lt;span class="gi">+ if err != nil &amp;amp;&amp;amp; (resp == nil || !resp.Truncated) {
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¤„ç†äº†ä¸¤ç§æƒ…å†µï¼š&lt;/p>
&lt;ul>
&lt;li>å¦‚æœè¿”å›äº†é”™è¯¯ï¼Œå¹¶ä¸”å“åº”ä¸ºç©ºï¼›&lt;/li>
&lt;li>å¦‚æœè¿”å›äº†é”™è¯¯ï¼Œå¹¶ä¸”å’Œæˆªæ–­çš„å“åº”æ— å…³ï¼›&lt;/li>
&lt;/ul>
&lt;p>ç»è¿‡è¿™æ¬¡çš„ä¿®æ­£ï¼Œé‚£å°±åŸºæœ¬è¦†ç›–äº†ç›®å‰èƒ½è€ƒè™‘åˆ°çš„æ‰€æœ‰æƒ…å†µäº†ã€‚å¸Œæœ›å¤§å®¶èƒ½å°½æ—©å‡çº§ç‰ˆæœ¬ã€‚&lt;/p>
&lt;h2 id="trivy-å‘å¸ƒ-v08-ç‰ˆæœ¬">trivy å‘å¸ƒ v0.8 ç‰ˆæœ¬&lt;/h2>
&lt;p>åœ¨ä¹‹å‰çš„ ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€ä¸­å·²ç»ä»‹ç»è¿‡ trivy å·¥å…·äº†ï¼Œæ˜¯ä¸€æ¬¾å¾ˆæ–¹ä¾¿çš„é•œåƒå®‰å…¨æ‰«æå·¥å…·ã€‚ æœ¬å‘¨å®ƒå‘å¸ƒäº† v0.8 çš„ç‰ˆæœ¬ï¼Œå¸¦æ¥äº†å‡ ä¸ªå€¼å¾—å…³æ³¨çš„å˜æ›´ã€‚&lt;/p>
&lt;ul>
&lt;li>å¢åŠ äº†æ–°çš„å­å‘½ä»¤ &lt;code>trivy image $IMAGE_NAME&lt;/code> ï¼ŒåŒæ—¶åºŸå¼ƒäº†ä¹‹å‰çš„ &lt;code>trivy $IMAGE_NAME&lt;/code> çš„æ ¼å¼ï¼›&lt;/li>
&lt;li>å¢åŠ  &lt;code>--format=json&lt;/code> ç”¨äºä»¥ JSON å½¢å¼è¾“å‡ºç»“æœï¼Œæ›´ä¾¿äºä¸å…¶ä»–ç³»ç»Ÿè¿›è¡Œé›†æˆï¼›&lt;/li>
&lt;li>é€šè¿‡è®¾ç½® &lt;code>TRIVY_REGISTRY_TOKEN&lt;/code> ç¯å¢ƒå˜é‡ï¼Œå¯è®¾ç½® registry token ä¾¿äºç›´æ¥æ‹‰å–é•œåƒè¿›è¡Œæ‰«æï¼›&lt;/li>
&lt;/ul>
&lt;p>å¯ç›´æ¥è®¿é—® &lt;a href="https://github.com/aquasecurity/trivy/releases/tag/v0.8.0">Release é¡µé¢&lt;/a> ä¸‹è½½ä½¿ç”¨æ–°ç‰ˆæœ¬ã€‚&lt;/p>
&lt;h2 id="ä¸Šæ¸¸è¿›å±•">ä¸Šæ¸¸è¿›å±•&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/pull/90960">#90960&lt;/a> ä¿®æ­£äº† &lt;code>kubectl create secret docker-registry --from-file&lt;/code> ä¸å¯ç”¨çš„é—®é¢˜ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/pull/91182">#91182&lt;/a> kubelet çš„ &lt;code>--seccomp-profile-root&lt;/code> é€‰é¡¹ç§»åŠ¨åˆ°äº†é…ç½®æ–‡ä»¶ä¸­ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/pull/91171">#91171&lt;/a> å°† etcd çš„é•œåƒæ¢æˆäº†åŸºäº distroless çš„é•œåƒï¼Œä¹‹å‰å·²ç»æŠŠå…¶ä»–çš„ä¸€äº›é•œåƒéƒ½æ¢æ‰äº†ï¼Œä¸»è¦è€ƒè™‘çš„ç‚¹å¯èƒ½æ˜¯å®‰å…¨å’Œä½“ç§¯ç›¸å…³çš„é—®é¢˜å§ã€‚&lt;/li>
&lt;/ul>
&lt;hr>
&lt;p>æ¬¢è¿è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>ä¸º Prometheus Node Exporter åŠ ä¸Šè®¤è¯</title><link>https://moelove.info/2020/05/26/%E4%B8%BA-Prometheus-Node-Exporter-%E5%8A%A0%E4%B8%8A%E8%AE%A4%E8%AF%81/</link><guid isPermaLink="true">https://moelove.info/2020/05/26/%E4%B8%BA-Prometheus-Node-Exporter-%E5%8A%A0%E4%B8%8A%E8%AE%A4%E8%AF%81/</guid><pubDate>Tue, 26 May 2020 23:21:58 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>è¿™ç¯‡æ–‡ç« ä¸»è¦æ˜¯ä¸ºäº†åº†ç¥ Node Exporter ç»ˆäºè¿æ¥äº† v1.0.0 ç‰ˆæœ¬ã€‚&lt;/p>
&lt;/blockquote>
&lt;p>&lt;a href="https://prometheus.io/">Prometheus&lt;/a> æ˜¯æœ€æ—©ç”± SoundCloud å¼€æºçš„ç›‘æ§å‘Šè­¦è§£å†³æ–¹æ¡ˆã€‚å¹¶å·²ç»æˆé•¿ä¸ºç»§ Kubernetes ä¹‹åï¼Œç¬¬äºŒä¸ªä» CNCF æ¯•ä¸šçš„é¡¹ç›®ã€‚ä¼´éšç€äº‘åŸç”Ÿç†å¿µçš„æ™®åŠå’Œ Kubernetes ç­‰æŠ€æœ¯çš„å‘å±•ï¼Œ Prometheus åœ¨ç›‘æ§é¢†åŸŸä¹Ÿæœ‰äº†é•¿è¶³çš„å‘å±•ã€‚&lt;/p>
&lt;p>å…¶ä¸»è¦ç»„ä»¶åŒ…æ‹¬ Prometheusï¼ŒAlertmanagerï¼ŒNode Exporterï¼ŒBlackbox Exporter å’Œ Pushgateway ç­‰ã€‚&lt;/p>
&lt;p>æœ¬æ–‡ä¸»è¦æ˜¯ä¸ºäº†åº†ç¥ Node Exporter ç»ˆäºè¿æ¥äº† v1.0.0 ç‰ˆæœ¬ï¼Œ æ‰€ä»¥é‡ç‚¹ä¸»è¦æ”¾åœ¨ä¸€ç›´è¢«äººè¯Ÿç—…çš„å®‰å…¨æ€§ç›¸å…³ä¸Šï¼Œå…·ä½“è€Œè¨€å°±æ˜¯åˆ©ç”¨ TLS å’Œ Basic Auth æå‡å…¶å®‰å…¨æ€§ã€‚&lt;/p>
&lt;h2 id="èƒŒæ™¯">èƒŒæ™¯&lt;/h2>
&lt;p>Node Exporter æ˜¯ Prometheus å®˜æ–¹å‘å¸ƒçš„ï¼Œç”¨äºé‡‡é›†èŠ‚ç‚¹çš„ç³»ç»Ÿä¿¡æ¯ï¼Œæ¯”å¦‚ CPUï¼Œå†…å­˜ï¼Œç£ç›˜å’Œç½‘ç»œç­‰ä¿¡æ¯ã€‚
é€šå¸¸æƒ…å†µä¸‹ï¼Œå¦‚æœæˆ‘ä»¬åœ¨ä½¿ç”¨ Prometheus ä½œä¸ºç›‘æ§æ–¹æ¡ˆï¼Œé‚£ Node Exporter åŸºæœ¬éƒ½ä¼šç”¨åˆ°çš„ã€‚&lt;/p>
&lt;p>åœ¨ Promethues çš„ç›‘æ§ä½“ç³»ä¸­ï¼Œç¤¾åŒºä¸­ä¸€ç›´å­˜åœ¨çš„ä¸€ä¸ªè§‚ç‚¹æ˜¯ï¼ŒMetrics ä¸åŒ…å«è¿‡äºç§å¯†çš„ä¿¡æ¯ã€‚æ‰€ä»¥ä½ å¯ä»¥çœ‹åˆ°ï¼Œå¤§å¤šæ•°çš„ &lt;code>/metrics&lt;/code> æ¥å£éƒ½æ˜¯ç›´æ¥æš´éœ²å‡ºæ¥çš„ï¼Œæ²¡ä»€ä¹ˆç‰¹åˆ«çš„å®‰å…¨æªæ–½ã€‚&lt;/p>
&lt;p>ä½†éšç€ Prometheus åœ¨ç”Ÿäº§ä¸­çš„å¤§é‡åº”ç”¨ï¼Œå®‰å…¨é—®é¢˜å˜å¾—æ›´åŠ é‡è¦ã€‚&lt;/p>
&lt;p>å¤§å®¶æœ€å…ˆæƒ³åˆ°çš„è§£å†³åŠæ³•å°±æ˜¯ï¼Œä¸º Prometheus ä¸ç›‘æ§ç›®æ ‡ä¹‹é—´çš„è¿æ¥å¯ç”¨ TLSã€‚ ä½†ç”±äºå„ç±» exporter å¹¶ä¸åŸç”Ÿæ”¯æŒ TLS è¿æ¥ï¼Œæ‰€ä»¥é€šå¸¸æƒ…å†µä¸‹æˆ‘ä»¬ä¼šé€‰æ‹©&lt;a href="https://prometheus.io/docs/guides/tls-encryption/">é…åˆåå‘ä»£ç†&lt;/a>æ¥å®Œæˆã€‚&lt;/p>
&lt;p>è¿™ç§æ–¹å¼èƒ½æ»¡è¶³éœ€æ±‚ï¼Œä½†æœªå…å¤æ‚äº†äº›ã€‚è¿‘æœŸ &lt;strong>Prometheus å¯¹å…¶å®‰å…¨æ¨¡å‹åšäº†ä¿®æ”¹&lt;/strong> ï¼Œ ä» Node Exporter å¼€å§‹åˆ°åç»­å…¶ä»–çš„ç»„ä»¶ï¼Œéƒ½å°†æ”¯æŒ TLS å’Œ basic authï¼Œ åŒæ—¶ä¹Ÿåˆ—å‡ºäº†æœ€æ–°çš„å®‰å…¨åŸºå‡†ï¼ˆé»˜è®¤æƒ…å†µä¸‹éƒ½æ”¯æŒ TLS v1.2 åŠä»¥ä¸Šï¼‰&lt;/p>
&lt;h2 id="ä½¿ç”¨-tls">ä½¿ç”¨ TLS&lt;/h2>
&lt;p>è¿™é‡Œæˆ‘ä»¬ç›´æ¥å®è·µä¸‹çœ‹çœ‹å¦‚ä½•å¯ç”¨ TLS ã€‚&lt;/p>
&lt;h3 id="å‡†å¤‡è¯ä¹¦">å‡†å¤‡è¯ä¹¦&lt;/h3>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ ~ mkdir -p prometheus-tls
&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ ~ &lt;span class="nb">cd&lt;/span> prometheus-tls
&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ prometheus-tls openssl req -new -newkey rsa:2048 -days &lt;span class="m">365&lt;/span> -nodes -x509 -keyout node_exporter.key -out node_exporter.crt -subj &lt;span class="s2">&amp;#34;/C=CN/ST=Beijing/L=Beijing/O=Moelove.info/CN=localhost&amp;#34;&lt;/span>
Generating a RSA private key
...........................................+++++
..+++++
writing new private key to &lt;span class="s1">&amp;#39;node_exporter.key&amp;#39;&lt;/span>
-----
&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ prometheus-tls ls
node_exporter.crt node_exporter.key
&lt;/code>&lt;/pre>&lt;/div>&lt;p>é€šè¿‡ä¸Šé¢çš„æ­¥éª¤ï¼Œæˆ‘ä»¬å¾—åˆ°äº† &lt;code>node_exporter.crt&lt;/code> å’Œ&lt;code> node_exporter.key&lt;/code> è¿™ä¸¤ä¸ªæ–‡ä»¶ã€‚&lt;/p>
&lt;h3 id="node-exporter-ä½¿ç”¨-tls">Node Exporter ä½¿ç”¨ TLS&lt;/h3>
&lt;p>&lt;a href="https://github.com/prometheus/node_exporter/releases/tag/v1.0.0">ä¸‹è½½ v1.0.0 ç‰ˆæœ¬çš„ Node Exporter&lt;/a>ï¼Œ å¹¶å¯¹å…¶è¿›è¡Œè§£å‹ç­‰æ“ä½œ&lt;/p>
&lt;pre>&lt;code>(MoeLove) âœ /tmp tar -zxvf node_exporter-1.0.0.linux-amd64.tar.gz
node_exporter-1.0.0.linux-amd64/
node_exporter-1.0.0.linux-amd64/node_exporter
node_exporter-1.0.0.linux-amd64/NOTICE
node_exporter-1.0.0.linux-amd64/LICENSE
(MoeLove) âœ /tmp cd node_exporter-1.0.0.linux-amd64
(MoeLove) âœ node_exporter-1.0.0.linux-amd64 ls
LICENSE node_exporter NOTICE
&lt;/code>&lt;/pre>&lt;p>å¤åˆ¶å‰é¢ç”Ÿæˆçš„ &lt;code>node_exporter.crt&lt;/code> å’Œ&lt;code> node_exporter.key&lt;/code> è¿™ä¸¤ä¸ªæ–‡ä»¶åˆ°å½“å‰ç›®å½•ä¸‹ã€‚&lt;/p>
&lt;pre>&lt;code>(MoeLove) âœ node_exporter-1.0.0.linux-amd64 cp ~/prometheus-tls/node_exporter.* .
(MoeLove) âœ node_exporter-1.0.0.linux-amd64 ls
LICENSE node_exporter node_exporter.crt node_exporter.key NOTICE
&lt;/code>&lt;/pre>&lt;p>ç¼–å†™é…ç½®æ–‡ä»¶ï¼Œå¹¶ä¿å­˜ä¸º &lt;code>config.yaml&lt;/code> ï¼ˆå‘½åéšæ„ï¼‰ï¼š&lt;/p>
&lt;pre>&lt;code>tls_server_config:
cert_file: node_exporter.crt
key_file: node_exporter.key
&lt;/code>&lt;/pre>&lt;p>æ¥ä¸‹æ¥å°±ä½¿ç”¨ &lt;code>--web.config&lt;/code> å°†é…ç½®æ–‡ä»¶ä¼ é€’ç»™ Node Exporter&lt;/p>
&lt;pre>&lt;code>(MoeLove) âœ node_exporter-1.0.0.linux-amd64 ./node_exporter --web.config=config.yaml
level=info ts=2020-05-26T17:50:12.123Z caller=node_exporter.go:177 msg=&amp;quot;Starting node_exporter&amp;quot; version=&amp;quot;(version=1.0.0, branch=HEAD, revision=b9c96706a7425383902b6143d097cf6d7cfd1960)&amp;quot;
level=info ts=2020-05-26T17:50:12.124Z caller=node_exporter.go:178 msg=&amp;quot;Build context&amp;quot; build_context=&amp;quot;(go=go1.14.3, user=root@3e55cc20ccc0, date=20200526-06:01:48)&amp;quot;
level=info ts=2020-05-26T17:50:12.130Z caller=node_exporter.go:105 msg=&amp;quot;Enabled collectors&amp;quot;
...
level=info ts=2020-05-26T17:50:12.135Z caller=tls_config.go:200 msg=&amp;quot;TLS is enabled and it cannot be disabled on the fly.&amp;quot; http2=true
&lt;/code>&lt;/pre>&lt;p>&lt;strong>å½“ä½ çœ‹åˆ°æœ€åè¿™å¥æ—¥å¿—æ—¶ï¼Œå°±è¯´æ˜ä½ çš„ Node Exporter å·²ç»å¯ç”¨äº† TLS è¿æ¥ã€‚&lt;/strong>&lt;/p>
&lt;p>å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€‰æ‹©æ‰‹åŠ¨éªŒè¯ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="c1"># ç›´æ¥ curl è¯·æ±‚&lt;/span>
&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ prometheus-tls curl localhost:9100/metrics
Client sent an HTTP request to an HTTPS server.
&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ prometheus-tls curl https://localhost:9100/metrics
curl: &lt;span class="o">(&lt;/span>60&lt;span class="o">)&lt;/span> SSL certificate problem: self signed certificate
More details here: https://curl.haxx.se/docs/sslcerts.html
curl failed to verify the legitimacy of the server and therefore could not
establish a secure connection to it. To learn more about this situation and
how to fix it, please visit the web page mentioned above.
&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¯ä»¥çœ‹åˆ°ä¸èƒ½ç›´æ¥ curl è¿›è¡Œè¯·æ±‚äº†ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¯ä¹¦ä¼ é€’ç»™ curl ï¼Œç”¨æ¥éªŒè¯åˆšæ‰çš„é…ç½®æ˜¯å¦æ­£ç¡®ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ prometheus-tls curl -s --cacert node_exporter.crt https://localhost:9100/metrics &lt;span class="p">|&lt;/span>grep node_exporter_build_info
&lt;span class="c1"># HELP node_exporter_build_info A metric with a constant &amp;#39;1&amp;#39; value labeled by version, revision, branch, and goversion from which node_exporter was built.&lt;/span>
&lt;span class="c1"># TYPE node_exporter_build_info gauge&lt;/span>
node_exporter_build_info&lt;span class="o">{&lt;/span>&lt;span class="nv">branch&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;HEAD&amp;#34;&lt;/span>,goversion&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;go1.14.3&amp;#34;&lt;/span>,revision&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;b9c96706a7425383902b6143d097cf6d7cfd1960&amp;#34;&lt;/span>,version&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;1.0.0&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span> &lt;span class="m">1&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>å½“ç„¶ï¼Œé™¤äº†é€šè¿‡ &lt;code>--cacert&lt;/code> å‚æ•°å°†è¯ä¹¦ä¼ é€’ç»™ curl å¤–ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ &lt;code>-k&lt;/code> å‚æ•°æ¥å¿½ç•¥è¯ä¹¦æ£€æŸ¥ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ prometheus-tls curl -s -k https://localhost:9100/metrics &lt;span class="p">|&lt;/span>grep node_exporter_build_info
&lt;span class="c1"># HELP node_exporter_build_info A metric with a constant &amp;#39;1&amp;#39; value labeled by version, revision, branch, and goversion from which node_exporter was built.&lt;/span>
&lt;span class="c1"># TYPE node_exporter_build_info gauge&lt;/span>
node_exporter_build_info&lt;span class="o">{&lt;/span>&lt;span class="nv">branch&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;HEAD&amp;#34;&lt;/span>,goversion&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;go1.14.3&amp;#34;&lt;/span>,revision&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;b9c96706a7425383902b6143d097cf6d7cfd1960&amp;#34;&lt;/span>,version&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;1.0.0&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span> &lt;span class="m">1&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="é…ç½®-prometheus-ä½¿ç”¨-tls">é…ç½® Prometheus ä½¿ç”¨ TLS&lt;/h3>
&lt;p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±è¦é…ç½® Prometheus é€šè¿‡ HTTPS ä» Node Exporter è·å–æŒ‡æ ‡äº†ã€‚å®‰è£…è¿‡ç¨‹å¾ˆç®€å•ï¼Œæ— è®ºç›´æ¥ä¸‹è½½æœ€æ–°çš„äºŒè¿›åˆ¶ç‰ˆæœ¬ï¼Œæˆ–æ˜¯ç›´æ¥ä½¿ç”¨ Docker é•œåƒå‡å¯ã€‚&lt;/p>
&lt;p>æ³¨æ„ï¼Œæˆ‘è¿™é‡ŒæŠŠä¸Šæ–‡ä¸­ç­¾å‘çš„è¯ä¹¦å¤åˆ¶åˆ°äº†å½“å‰ç›®å½•ä¸­ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ prometheus-2.18.1.linux-amd64 cp ~/prometheus-tls/node_exporter.crt .
&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ prometheus-2.18.1.linux-amd64 ls
console_libraries consoles LICENSE node_exporter.crt NOTICE prometheus prometheus.yml promtool tsdb
&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ¥ä¸‹æ¥ï¼Œéœ€è¦ä¿®æ”¹ä¸‹é…ç½®æ–‡ä»¶ï¼Œè®© Prometheus å¯ä»¥æŠ“å– Node Exporter æš´éœ²çš„ metrics ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="nt">global&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">scrape_interval&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">15s &lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">evaluation_interval&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">15s &lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">scrape_configs&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">job_name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;prometheus&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">static_configs&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">targets&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;localhost:9090&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">job_name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;node_exporter&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">scheme&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">https&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">tls_config&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">ca_file&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">node_exporter.crt&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">static_configs&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">targets&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;localhost:9100&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™é‡Œé¢å¤–å¢åŠ äº† &lt;code>scheme: https&lt;/code> è¡¨ç¤ºé€šè¿‡ HTTPS å»ºç«‹è¿æ¥ï¼Œ&lt;code>tls_config&lt;/code> ä¸­æŒ‡å®šäº†æ‰€ç”¨çš„è¯ä¹¦æ–‡ä»¶ã€‚å®Œæ•´çš„é…ç½®å¯ä»¥å‚è€ƒ &lt;a href="https://prometheus.io/docs/prometheus/latest/configuration/configuration/#tls_config">å®˜æ–¹æ–‡æ¡£ä¸­å¯¹ tls_config çš„è¯´æ˜&lt;/a> ã€‚&lt;/p>
&lt;p>æœ€åï¼Œå¯åŠ¨ Prometheus å¹¶åœ¨æµè§ˆå™¨ä¸­è®¿é—® &lt;a href="http://127.0.0.1:9090/targets">&lt;code>/targets&lt;/code>&lt;/a> ï¼Œå¦‚æœä½ åœ¨ endpoint ä¸­çœ‹åˆ° &lt;code>https://localhost:9100/metrics&lt;/code> äº†ï¼Œé‚£ä¹ˆæ­å–œä½ ï¼ŒPrometheus å’Œ Node Exporter å·²ç»é€šè¿‡ TLS è¿æ¥äº†ã€‚&lt;/p>
&lt;p>&lt;img src="https://moelove.info/img/prometheus-tls-target.png" alt="Prometheus TLS - https://moelove.info">&lt;/p>
&lt;h2 id="æ·»åŠ -basic-auth">æ·»åŠ  Basic Auth&lt;/h2>
&lt;p>ä¸Šæ–‡ä¸­ï¼Œæˆ‘å·²ç»ä¸ºä½ ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨è®© Prometheus å’Œ Node Exporter é—´ä½¿ç”¨ TLS è¿æ¥äº†ï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä¸ºä½ ä»‹ç»å¦‚ä½•å¢åŠ  Basic Auth ã€‚&lt;/p>
&lt;p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒBasic Auth å’Œ TLS å¹¶ä¸æ˜¯å¼ºä¾èµ–çš„ã€‚ä½ å¯ä»¥åœ¨ä¸å¼€å¯ TLS çš„æƒ…å†µä¸‹ä½¿ç”¨ Basic Auth ï¼Œä½†æˆ‘ä¸ªäººå»ºè®®ï¼Œè¦åšå°±åšå½»åº•ç‚¹ï¼ŒåŒæ—¶å¯ç”¨å¥½äº†ã€‚&lt;/p>
&lt;h3 id="ä¸º-node-exporter-é…ç½®å¯†ç ">ä¸º Node Exporter é…ç½®å¯†ç &lt;/h3>
&lt;p>æˆ‘ä»¬ç›´æ¥å¯ä»¥ä½¿ç”¨ &lt;code>htpasswd&lt;/code> æ¥ç”Ÿæˆ bcrypt å¯†ç  hash ï¼ˆè¿™ä¸ªå·¥å…·æƒ³å¿…å¤§å®¶ä¸ä¼šå¤ªé™Œç”Ÿï¼‰ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ prometheus-tls htpasswd -nBC &lt;span class="m">12&lt;/span> &lt;span class="s1">&amp;#39;&amp;#39;&lt;/span> &lt;span class="p">|&lt;/span> tr -d &lt;span class="s1">&amp;#39;:\n&amp;#39;&lt;/span>
New password:
Re-type new password:
&lt;span class="nv">$2&lt;/span>y&lt;span class="nv">$12$WLw2sYa&lt;/span>.NYZoBVoCOE84qe3xNm7kbSoKVIBXP.PvqNDna60vnZhEW
&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™é‡Œæˆ‘åªç”¨å®ƒæ¥ç”Ÿæˆäº†å¯†ç  hash ï¼Œ æ²¡æœ‰ä¼ é€’ç”¨æˆ·åã€‚&lt;/p>
&lt;p>æ¥ä¸‹æ¥ï¼Œä¿®æ”¹ä¸Šæ–‡ä¸­æåˆ°çš„ Node Exporter æ‰€ç”¨çš„é…ç½®æ–‡ä»¶ï¼Œå¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="nt">tls_server_config&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">cert_file&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">node_exporter.crt&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">key_file&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">node_exporter.key&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">basic_auth_users&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># å½“å‰è®¾ç½®çš„ç”¨æˆ·åä¸º prometheus ï¼Œ å¯ä»¥è®¾ç½®å¤šä¸ª&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">prometheus&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">$2y$12$WLw2sYa.NYZoBVoCOE84qe3xNm7kbSoKVIBXP.PvqNDna60vnZhEW&lt;/span>&lt;span class="w">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å†æ¬¡å¯åŠ¨ Node Exporterï¼Œå¹¶ä½¿ç”¨ curl è¯·æ±‚ metrics æ¥å£ï¼Œå¯ä»¥çœ‹åˆ°å½“å‰è¿”å› 401 ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ prometheus-tls curl -Ik https://127.0.0.1:9100/metrics
HTTP/1.1 &lt;span class="m">401&lt;/span> Unauthorized
Content-Type: text/plain&lt;span class="p">;&lt;/span> &lt;span class="nv">charset&lt;/span>&lt;span class="o">=&lt;/span>utf-8
Www-Authenticate: Basic
X-Content-Type-Options: nosniff
Date: Wed, &lt;span class="m">27&lt;/span> May &lt;span class="m">2020&lt;/span> 11:45:16 GMT
Content-Length: &lt;span class="m">13&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ‰“å¼€ Prometheus çš„ Targets é¡µé¢ï¼Œä¹Ÿä¼šçœ‹åˆ°å½“å‰æç¤º 401 ï¼Œæ— æ³•æŠ“å– metrics ã€‚&lt;/p>
&lt;p>&lt;img src="https://moelove.info/img/prometheus-tls-target-401.png" alt="Prometheus Basic Auth - https://moelove.info">&lt;/p>
&lt;h3 id="é…ç½®-prometheus-ä½¿ç”¨-basic-auth">é…ç½® Prometheus ä½¿ç”¨ Basic Auth&lt;/h3>
&lt;p>æ¥ä¸‹æ¥ï¼Œåªè¦ä¿®æ”¹ Prometheus çš„é…ç½®æ–‡ä»¶ï¼Œä¸ºå…¶å¢åŠ  &lt;code>basic_auth&lt;/code> çš„é…ç½®é¡¹å³å¯ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="nt">global&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">scrape_interval&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">15s &lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">evaluation_interval&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">15s &lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">scrape_configs&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">job_name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;prometheus&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">static_configs&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">targets&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;localhost:9090&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">job_name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;node_exporter&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">scheme&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">https&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">tls_config&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">ca_file&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">node_exporter.crt&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">basic_auth&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">username&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">prometheus&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">password&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">moelove.info&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">static_configs&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">targets&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;localhost:9100&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¿®æ”¹é…ç½®æ–‡ä»¶åï¼Œåªè¦è®© Prometheus é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶å³å¯ï¼š&lt;/p>
&lt;pre>&lt;code>(MoeLove) âœ killall -HUP prometheus
&lt;/code>&lt;/pre>&lt;p>ç°åœ¨åˆ·æ–° Prometheus çš„ Targets é¡µé¢ï¼Œå°±å¯ä»¥çœ‹åˆ°å·²ç»æ­£å¸¸æŠ“å– metrics äº†ã€‚&lt;/p>
&lt;h2 id="æ€»ç»“">æ€»ç»“&lt;/h2>
&lt;p>æœ¬æ–‡ä»‹ç»äº†å¦‚ä½•å¼€å¯ Prometheus å’Œ Node Exporter ä¹‹é—´çš„ TLS è¿æ¥ï¼Œ ä»¥åŠå¼€å¯ Node Exporter çš„ Basic Auth è®¤è¯ã€‚ åœ¨æ­¤ä¹‹å‰ï¼Œå¯èƒ½æœ‰å°ä¼™ä¼´æ˜¯é€šè¿‡åŠ åä»£æ¥å®Œæˆçš„ï¼Œæ¯”å¦‚ï¼š &lt;a href="https://blog.fleeto.us/post/node_exp_basic_auth/">ç»™ Node Exporter åŠ ä¸Š Basic è®¤è¯&lt;/a>&lt;/p>
&lt;p>åœ¨ç”Ÿäº§ä¸­ä½¿ç”¨æ—¶ï¼Œå»ºè®®æ›´åŠ è§„èŒƒåŒ–æ“ä½œï¼Œæ¯”å¦‚ CA çš„é€‰æ‹©ï¼Œå¯†ç çš„ç®¡ç†ç­‰ï¼Œæ¯”å¦‚ Node Exporter çš„ Basic Auth å…¶å®æ”¯æŒé…ç½®å¤šä¸ªç”¨æˆ·åå¯†ç çš„ã€‚&lt;/p>
&lt;p>æ¥ä¸‹æ¥ï¼Œåœ¨ Prometheus å®˜æ–¹æä¾›çš„åŸºç¡€ç»„ä»¶ä¸­ï¼Œéƒ½å°†é€æ­¥æ¨è¿›æœ¬æ–‡ä¸­æ‰€æåˆ°çš„è¿™ç±»å®‰å…¨ç‰¹æ€§çš„æ”¯æŒï¼ŒåŒ…æ‹¬ Prometheusï¼ŒAlertmanagerï¼Œ Pushgateway å’Œå®˜æ–¹ exporter ï¼Œåç»­ç¤¾åŒºæä¾›çš„ exporter å¤§æ¦‚ç‡ä¹Ÿä¼šé€æ­¥è·Ÿè¿›çš„ã€‚&lt;/p>
&lt;p>æœ€åï¼Œå†æ¬¡æ­å–œ Node Exporter è¿æ¥äº† v1.0.0 ç‰ˆæœ¬ã€‚&lt;/p>
&lt;hr>
&lt;p>æ¬¢è¿è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Prometheus/">Prometheus</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| Docker v19.03.9 å‘å¸ƒ</title><link>https://moelove.info/2020/05/24/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Docker-v19.03.9-%E5%8F%91%E5%B8%83/</link><guid isPermaLink="true">https://moelove.info/2020/05/24/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Docker-v19.03.9-%E5%8F%91%E5%B8%83/</guid><pubDate>Sun, 24 May 2020 17:56:36 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="docker-v19039-å‘å¸ƒ">Docker v19.03.9 å‘å¸ƒ&lt;/h2>
&lt;p>Docker åœ¨æœ¬å‘¨å‘å¸ƒäº† v19.03.9 ç‰ˆæœ¬ï¼Œå¦‚æœæœ‰åœ¨ä½¿ç”¨ Docker v19.03.x ç‰ˆæœ¬çš„å°ä¼™ä¼´ï¼Œæˆ‘ä¸ªäººå¼ºçƒˆå»ºè®®ä½ æ›´æ–°åˆ°æ­¤ç‰ˆæœ¬ã€‚&lt;/p>
&lt;p>åœ¨ä¹‹å‰çš„&lt;a href="https://zhuanlan.zhihu.com/p/111833886">ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€ä¸­&lt;/a>ï¼Œæˆ‘æ›¾ä»‹ç»è¿‡ï¼Œè‡ª Docker v19.03.7 å¼€å§‹ï¼Œå…¶ &lt;code>Backing Filesystem&lt;/code> çš„æ£€æŸ¥é€»è¾‘å­˜åœ¨é—®é¢˜ã€‚&lt;/p>
&lt;p>è¿™ä¼šå¯¼è‡´åœ¨æ‰§è¡Œ &lt;code>docker info&lt;/code> çš„æ—¶å€™ï¼Œå¾—åˆ°å¦‚ä¸‹è¾“å‡ºï¼š&lt;/p>
&lt;pre>&lt;code>(MoeLove) âœ ~ docker info --format '{{ index .DriverStatus 0 }}'
[Backing Filesystem ]
&lt;/code>&lt;/pre>&lt;p>å¦å¤–ï¼Œç”±äºä¸èƒ½æ­£ç¡®è¯†åˆ« &lt;code>Backing Filesystem&lt;/code> ä¹Ÿä¼šå¯¼è‡´è®¾ç½® storage quota æ—¶æŠ¥é”™ã€‚è¿™ä¸ªé—®é¢˜æˆ‘æ—©å·²åœ¨ä¸Šæ¸¸è¿›è¡Œäº†ä¿®å¤ï¼ŒåŸè®¡åˆ’æ˜¯åœ¨ v19.03.8 ä¸­å‘å¸ƒï¼Œä¸è¿‡ç”±äº v19.03.8 æ˜¯ä¸ºå®‰å…¨ä¿®å¤ç‰ˆæœ¬å‘å¸ƒçš„ï¼Œ æ‰€ä»¥å»¶è¿Ÿåˆ°æœ¬æ¬¡ v19.03.9 ä¸­äº†ã€‚&lt;/p>
&lt;p>é™¤äº†ä¸Šé¢æåˆ°çš„è¿™ä¸ª bug ä»¥å¤–ï¼Œæœ¬æ¬¡ç‰ˆæœ¬ä¸­è¿˜æœ‰äº›é‡è¦çš„ä¿®å¤ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://github.com/moby/moby/pull/40780">#40780&lt;/a> ä¿®æ­£äº† BuildKit ä¸­å¹¶å‘æ„å»ºå¤šä¸ªé•œåƒæ—¶ï¼Œå¯èƒ½å¼•å‘çš„ panicï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/docker/cli/pull/2471">#2471&lt;/a> ä¿®æ­£äº† Docker CLI ä½¿ç”¨å•ä¸ªæ•°å­—ä½œä¸ºå·æ—¶ï¼Œå¯èƒ½å¼•å‘çš„ panicï¼Œ ä¸¾ä¾‹è€Œè¨€å°±æ˜¯ï¼š&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="c1"># ä¿®æ­£å‰&lt;/span>
&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ ~ docker run -it --rm -v 1:/1 alpine
panic: runtime error: index out of range
...
&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="c1"># ä¿®æ­£å&lt;/span>
docker run -it --rm -v 1:/1 alpine
docker: Error response from daemon: create 1: volume name is too short, names should be at least two alphanumeric characters.
&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>ä¿®å¤äº†ä¸º Docker é€šè¿‡ &lt;code>--bip&lt;/code> è®¾ç½® bridge network æ—¶ï¼Œ IP åœ°å€æ± è®¡ç®—ä¸ä¸€è‡´çš„é—®é¢˜ã€‚&lt;/li>
&lt;/ul>
&lt;p>ä»¥ä¸Šä¾¿æ˜¯ Docker v19.03.9 ä¸­æ¯”è¾ƒå€¼å¾—æ³¨æ„çš„å˜æ›´ï¼Œå¯¹æ­¤ç‰ˆæœ¬æ„Ÿå…´è¶£çš„å°ä¼™ä¼´å¯æŸ¥çœ‹å…¶&lt;a href="https://github.com/docker/docker-ce/releases/tag/v19.03.9">å®Œæ•´çš„ ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="containerd-140-beta0-å‘å¸ƒ">containerd 1.4.0-beta.0 å‘å¸ƒ&lt;/h2>
&lt;p>è¿™æ˜¯ containerd çš„ç¬¬ 5 ä¸ªå¤§ç‰ˆæœ¬ï¼ˆé¢„å‘å¸ƒç‰ˆæœ¬ï¼‰ï¼Œæ­¤ç‰ˆæœ¬ä¸­åŒ…å«äº†å¤§é‡çš„æ–°ç‰¹æ€§å’Œæ¼æ´ä¿®å¤ï¼Œæˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹å§ã€‚&lt;/p>
&lt;ul>
&lt;li>å¢åŠ äº†å¯¹ CGroups v2 çš„æ”¯æŒï¼›&lt;/li>
&lt;li>æ”¹å–„äº†å¯¹ SELinux çš„æ”¯æŒï¼›&lt;/li>
&lt;li>å¢åŠ  FUSE æŒ‚è½½æ”¯æŒï¼›&lt;/li>
&lt;li>ä»£ç†å¿«ç…§æ’ä»¶æ”¯æŒæ¸…ç†è¡Œä¸ºï¼›&lt;/li>
&lt;li>ä¸ºå¿«ç…§ API å¢åŠ ç­›é€‰æ¡ä»¶ï¼›&lt;/li>
&lt;li>æ·»åŠ åœ¨ Windows ç³»ç»Ÿä¸Š CRI æ’ä»¶çš„æ”¯æŒï¼›&lt;/li>
&lt;/ul>
&lt;p>åœ¨ CRI æ–¹é¢ï¼ŒåŒæ ·ä¹Ÿåšäº†ä¸å°‘çš„å˜æ›´ï¼š&lt;/p>
&lt;ul>
&lt;li>æ·»åŠ  Windows å®¹å™¨è¿›ç¨‹çš„éš”ç¦»ï¼›&lt;/li>
&lt;li>&lt;strong>æ›´æ–°é»˜è®¤çš„è¿è¡Œæ—¶ä¸º &lt;code>io.containerd.runc.v2&lt;/code>&lt;/strong> ï¼›&lt;/li>
&lt;li>ä¿®æ­£åˆ›å»ºç‰¹æƒå®¹å™¨çš„æ”¯æŒï¼›&lt;/li>
&lt;li>å½“ç›‘å¬åˆ°æ–‡ä»¶å˜åŒ–äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œé‡å¯ CNI ç½‘ç»œé…ç½®ï¼›&lt;/li>
&lt;li>æ·»åŠ  CGroups v2 çš„æ”¯æŒï¼›&lt;/li>
&lt;/ul>
&lt;p>å¯¹æ­¤ç‰ˆæœ¬æ„Ÿå…´è¶£çš„å°ä¼™ä¼´ï¼Œå¯ä»¥æŸ¥çœ‹å…¶&lt;a href="https://github.com/containerd/containerd/releases/tag/v1.4.0-beta.0">å®Œæ•´çš„ ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="istio-16-æ­£å¼å‘å¸ƒ">Istio 1.6 æ­£å¼å‘å¸ƒ&lt;/h2>
&lt;p>Istio ä¹Ÿå‘å¸ƒäº† v1.6 ç‰ˆæœ¬ï¼Œæ­¤ç‰ˆæœ¬ä¸­ç»§ç»­è¿›è¡Œç®€åŒ–ï¼Œ Istiod å˜å¾—æ›´åŠ é‡è¦ï¼Œä¸æ­¤åŒæ—¶ï¼ŒCitadel, Sidecar Injector å’Œ Galley ç­‰åœ¨ v1.5 ä¸­å·²ç»è¢«é»˜è®¤ç¦ç”¨çš„ç»„ä»¶ä¹Ÿè¢«ç§»é™¤äº†ã€‚ä¹Ÿç§»é™¤äº†æ—§çš„ &lt;code>istio-pilot&lt;/code> é…ç½®ç­‰ã€‚&lt;/p>
&lt;p>å½“ç„¶ï¼Œé™¤äº†ç§»é™¤ä¸€äº›ä¸å†éœ€è¦çš„å†…å®¹å¤–ï¼Œæœ¬æ¬¡ç‰ˆæœ¬ä¹Ÿæä¾›äº†ä¸å°‘æ–°çš„ç‰¹æ€§æ”¯æŒï¼Œæ¯”å¦‚å¢åŠ äº† &lt;code>istioctl install&lt;/code> ç­‰å‘½ä»¤ï¼Œ &lt;strong>ä¹Ÿæ·»åŠ å¯¹ Istio è‡ªèº«çš„é‡‘ä¸é›€æ›´æ–°æ”¯æŒ&lt;/strong>ï¼ˆæˆ‘ä¸ªäººè®¤ä¸ºè¿™ä¸ªç‰¹æ€§éå¸¸å¥½ï¼Œèƒ½ä¸ºå¤§å®¶æä¾›æ›´å¤šçš„ä¿éšœï¼‰ã€‚&lt;/p>
&lt;p>å¯¹æ­¤ç‰ˆæœ¬æ„Ÿå…´è¶£çš„å°ä¼™ä¼´ï¼Œå¯ä»¥æŸ¥çœ‹å…¶&lt;a href="https://istio.io/news/releases/1.6.x/announcing-1.6/change-notes/">å®Œæ•´çš„ ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="ä¸Šæ¸¸è¿›å±•">ä¸Šæ¸¸è¿›å±•&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/pull/91046">#91046&lt;/a> Kubelet ä¸å†æ³¨å†Œ &lt;code>beta.kubernetes.io/os&lt;/code> å’Œ &lt;code>beta.kubernetes.io/arch&lt;/code> èŠ‚ç‚¹æ ‡ç­¾åˆ° api-server ä¸­äº†ã€‚ è¿™ä¿©æ ‡ç­¾å…¶å®ä» v1.14 å¼€å§‹å°±æ ‡è®°åºŸå¼ƒäº†ï¼Œ æœ¬æ¬¡è¿›è¡Œç§»é™¤ç½¢äº†ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/pull/90061">#90061&lt;/a> ä¸º CRI &lt;code>ImageSpec&lt;/code> å¯¹è±¡æ·»åŠ  annotation æ”¯æŒï¼Œä¸»è¦æ˜¯å¤„äºå¯¹ Windows å¹³å°çš„è€ƒè™‘ï¼›&lt;/li>
&lt;/ul>
&lt;h2 id="é¢˜å¤–è¯">é¢˜å¤–è¯&lt;/h2>
&lt;p>ä¸Šå‘¨æˆ‘å„¿å­å‡ºç”Ÿäº†ï¼Œæˆ‘ä¸€ç›´åœ¨åŒ»é™¢é™ªæŠ¤æ¥ç€ï¼Œæ‰€ä»¥ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€åœæ›´äº†ä¸€æœŸï¼Œæ„Ÿè°¢å¤§å®¶çš„ç†è§£å’Œæ”¯æŒ~æœ¬å‘¨æ¢å¤æ­£å¸¸æ›´æ–°ã€‚&lt;/p>
&lt;p>ï¼ˆæ–°æ‰‹å¥¶çˆ¸ç»ƒçº§ä¸­~&lt;/p>
&lt;hr>
&lt;p>æ¬¢è¿è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| Helm v3.2.1 å‘å¸ƒ</title><link>https://moelove.info/2020/05/10/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Helm-v3.2.1-%E5%8F%91%E5%B8%83/</link><guid isPermaLink="true">https://moelove.info/2020/05/10/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Helm-v3.2.1-%E5%8F%91%E5%B8%83/</guid><pubDate>Sun, 10 May 2020 23:53:49 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="helm-v321-ç‰ˆæœ¬å‘å¸ƒ">Helm v3.2.1 ç‰ˆæœ¬å‘å¸ƒ&lt;/h2>
&lt;p>æœ¬å‘¨ Helm å‘å¸ƒäº† v3.2.1 ç‰ˆæœ¬ï¼Œè¿™æ˜¯ v3.2 ç³»åˆ—çš„ç¬¬ä¸€ä¸ª patch ç‰ˆæœ¬ã€‚æ­¤æ¬¡åŒ…å«ä¸€äº›å€¼å¾—å…³æ³¨çš„å†…å®¹ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;a href="https://github.com/helm/helm/pull/7959">#7959&lt;/a> ä¿®å¤äº†ä¸€ä¸ª Helm v3 ä» 3.0-rc ç‰ˆä¸€ç›´å­˜åœ¨çš„ä¸€ä¸ª bug ï¼Œè¯¦æƒ…è§ &lt;a href="https://github.com/helm/helm/issues/6899">#6899&lt;/a>, ä½† &lt;code>--reuse-values&lt;/code> è¿™ä¸ªå‚æ•°ç”¨çš„äººå¯èƒ½ä¸å¤šï¼Œå®é™…ä¸Šå½±å“æ²¡é‚£ä¹ˆå¤§ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a href="https://github.com/helm/helm/pull/7653">#7653&lt;/a> ä¿®æ”¹äº† &lt;code>helm upgrade&lt;/code> çš„è¡Œä¸ºï¼Œå…è®¸å¯¹ä¸€ä¸ªå¤±è´¥çš„ Release æ‰§è¡Œ &lt;code>helm upgrade&lt;/code> è¿›è¡Œé‡æ–°éƒ¨ç½²ï¼Œè€Œä¸éœ€è¦å…ˆåˆ é™¤æ‰æ—§çš„ Releaseï¼›ï¼ˆæ–¹ä¾¿äº†å¾ˆå¤šï¼ï¼‰&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>å…¶å®æœ¬å‘¨ Helm è¿˜å‘å¸ƒäº† v2.16.7 ï¼Œè™½ç„¶ Helm 2 å·²ç»è¿›å…¥äº†ç»´æŠ¤æœŸï¼Œä½†ä¸å¾—ä¸è¯´ï¼Œç»´æŠ¤å›¢é˜Ÿè¿˜æ˜¯å¾ˆé è°±çš„ï¼Œä¸€ç›´åœ¨æŒç»­æ‰“ patch ä¸­ã€‚&lt;/p>
&lt;p>ç»§ç»­å»ºè®®å¤§å®¶å‡çº§è‡³ Helm v3 ã€‚&lt;/p>
&lt;p>å¯¹æ­¤ç‰ˆæœ¬æ„Ÿå…´è¶£çš„æœ‹å‹å¯æŸ¥çœ‹å…¶å®Œæ•´çš„ &lt;a href="https://github.com/helm/helm/releases/tag/v3.2.1">ReleaseNote&lt;/a> ã€‚&lt;/p>
&lt;h2 id="rancher-v243-å‘å¸ƒ">Rancher v2.4.3 å‘å¸ƒ&lt;/h2>
&lt;p>Rancher v2.4 æ˜¯ä¸ªå¤§ç‰ˆæœ¬ï¼Œæœ¬æ¬¡å‘å¸ƒçš„ v2.4.3 ä¸­åŒ…å«äº†å…¶ä¸å°‘æ›´æ–°å’Œä¿®å¤ï¼Œä¸€èµ·æ¥çœ‹çœ‹å§ï¼&lt;/p>
&lt;ul>
&lt;li>å¯¹äºä½¿ç”¨ RHEL/CentOS èŠ‚ç‚¹æ± çš„ç”¨æˆ·ï¼Œé»˜è®¤çš„ Docker å­˜å‚¨é©±åŠ¨å·²ç»ä¿®æ”¹æˆäº† &lt;code>overlay2&lt;/code>ï¼Œè¿™é‡Œéœ€è¦å°¤å…¶æ³¨æ„ã€‚ åŸæœ¬çš„ &lt;code>devicemapper&lt;/code> å­˜å‚¨é©±åŠ¨å·²ç»åœ¨ Docker ä¸­è¢«æ ‡è®°ä¸ºåºŸå¼ƒï¼Œä¹‹å‰çš„å‘¨æŠ¥ä¸­ä¹Ÿæœ‰åšè¿‡ç›¸å…³è§£é‡Šï¼Œæ­¤å¤„ä¸å†èµ˜è¿°ï¼›&lt;/li>
&lt;li>å®éªŒæ€§æ–°åŠŸèƒ½çš„ Feature Flags é€‰é¡¹ï¼Œä½ å¯ä»¥é€šè¿‡å¯åŠ¨å‚æ•°æŒ‡å®šï¼Œæˆ–è€…ç›´æ¥é€šè¿‡ UI æ¥è¿›è¡Œé€‰æ‹©ï¼Œä½¿ç”¨æ–‡æ¡£å‚è€ƒ &lt;a href="https://rancher.com/docs/rancher/v2.x/en/admin-settings/feature-flags/">https://rancher.com/docs/rancher/v2.x/en/admin-settings/feature-flags/&lt;/a> ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/rancher/rancher/issues/21361">#21361&lt;/a> &lt;strong>ä¿®å¤äº† Rancher å†…å­˜æ³„æ¼ï¼Œå¯èƒ½å¯¼è‡´ç³»ç»Ÿ OOM çš„é—®é¢˜&lt;/strong>ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/rancher/rancher/issues/26061">#26061&lt;/a> ä¿®å¤äº†å½“æœ‰å¤§é‡ LDAP group çš„æ—¶å€™ï¼Œç™»å½•æ…¢çš„æƒ…å†µï¼›&lt;/li>
&lt;/ul>
&lt;p>è¿˜æœ‰ä¸€äº›å…¶ä»–çš„ä¿®æ­£å’Œæ”¹è¿›ï¼Œæœ‰å…´è¶£çš„æœ‹å‹å¯å‚è€ƒå…¶ &lt;a href="https://github.com/rancher/rancher/releases/tag/v2.4.3">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="ä¸Šæ¸¸è¿›å±•">ä¸Šæ¸¸è¿›å±•&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/pull/88915">#88915&lt;/a> ä¿®æ­£äº†ä¸€ä¸ª kubelet image manager ä¸­å¯èƒ½ä¼šå¯¼è‡´ static pod workers åœæ­¢å·¥ä½œçš„é—®é¢˜ã€‚è¿™ä¸ªé—®é¢˜çœ‹è®°å½•æ˜¯ä» 1.10 å¼•å…¥çš„ï¼Œä½†æˆ‘è¿˜å°šæœªåœ¨ç”Ÿäº§ç¯å¢ƒä¸­é‡åˆ°æ­¤é—®é¢˜ã€‚ä¸è¿‡è¿˜æ˜¯å»ºè®®å°½å¿«å‡çº§ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/pull/89660">#89660&lt;/a> kubectl çš„è¾“å‡ºæ ¼å¼ä¸­ï¼Œå°†ä¼šæä¾›ä¸€ä¸ª å°† JSONPATH è¾“å‡ºä¸º JSON çš„é€‰é¡¹ï¼Œ&lt;/li>
&lt;/ul>
&lt;p>ç¤ºä¾‹è¾“å‡ºå¦‚ä¸‹ï¼š&lt;/p>
&lt;pre>&lt;code>old:
$ /old/kubectl get pod -o=jsonpath='{ ..'ip' }'
10.42.0.50 10.42.0.48 10.42.0.49
new/unchanged:
$ kubectl get pod -o=jsonpath='{ ..'ip' }'
10.42.0.50 10.42.0.49 10.42.0.48
new:
$ kubectl get pod -o=jsonpath-as-json='{ ..'ip' }'
[
&amp;quot;10.42.0.50&amp;quot;,
&amp;quot;10.42.0.49&amp;quot;,
&amp;quot;10.42.0.48&amp;quot;
]
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/pull/88723">#88723&lt;/a> &lt;code>kubectl taint&lt;/code> å˜å¾—æ›´åŠ çµæ´»ï¼Œä¸å†éœ€è¦æŒ‡å®šå…¨éƒ¨çš„èµ„æºåäº†ï¼›&lt;/li>
&lt;/ul>
&lt;hr>
&lt;p>æ¬¢è¿è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| KIND v0.8 æ­£å¼å‘å¸ƒ</title><link>https://moelove.info/2020/05/03/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-KIND-v0.8-%E6%AD%A3%E5%BC%8F%E5%8F%91%E5%B8%83/</link><guid isPermaLink="true">https://moelove.info/2020/05/03/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-KIND-v0.8-%E6%AD%A3%E5%BC%8F%E5%8F%91%E5%B8%83/</guid><pubDate>Sun, 03 May 2020 21:34:30 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="kind-v08-æ­£å¼å‘å¸ƒ">KIND v0.8 æ­£å¼å‘å¸ƒ&lt;/h2>
&lt;p>æœ¬å‘¨ &lt;a href="https://kind.sigs.k8s.io/">KINDï¼ˆKubernetes In Dockerï¼‰&lt;/a> æ­£å¼å‘å¸ƒäº† v0.8 ç‰ˆæœ¬ï¼Œæ­¤æ¬¡æœ€ä¸»è¦çš„æ˜¯ä¸ºå¤§å®¶å¸¦æ¥äº† &lt;strong>æŒä¹…åŒ–é›†ç¾¤&lt;/strong>ï¼Œå½“ä¸»æœºæˆ–è€… dockerd é‡å¯åï¼Œé›†ç¾¤å¯è‡ªåŠ¨æ¢å¤ã€‚&lt;/p>
&lt;h3 id="breaking-changes">Breaking Changes&lt;/h3>
&lt;ul>
&lt;li>æ­¤æ¬¡é»˜è®¤çš„é›†ç¾¤é•œåƒæ˜¯ Kubernetes &lt;code>v1.18.2&lt;/code> : &lt;code>kindest/node:v1.18.2@sha256:7b27a6d0f2517ff88ba444025beae41491b016bc6af573ba467b70c5e8e0d85f&lt;/code> ;&lt;/li>
&lt;li>å½“ä½¿ç”¨ KIND v0.8+ å¯åŠ¨é›†ç¾¤æ—¶ï¼Œå¿…é¡»ä½¿ç”¨é€šè¿‡ KIND v0.8+ æ„å»ºçš„ node é•œåƒï¼Œå¦åˆ™æ— æ³•æŒ‰é¢„æœŸå·¥ä½œï¼›&lt;/li>
&lt;li>æ–°ç‰ˆæœ¬ä¸­ï¼Œ KIND åˆ›å»ºå‡ºæ¥çš„æ‰€æœ‰ Node ï¼Œéƒ½ä½¿ç”¨è‡ªå®šä¹‰çš„ bridge ç½‘ç»œï¼ˆé»˜è®¤åç§°ä¸º &lt;code>kind&lt;/code>ï¼Œå¯é€šè¿‡ç¯å¢ƒå˜é‡ &lt;code>KIND_EXPERIMENTAL_DOCKER_NETWORK&lt;/code> ä¿®æ”¹ï¼‰ï¼›&lt;/li>
&lt;li>ä½ å¯ä»¥åœ¨å¯åŠ¨ä»»æ„å®¹å™¨æ—¶ï¼Œå¢åŠ  &lt;code>--network=kind&lt;/code>ï¼Œä»¥ä¾¿è®©å®ƒå’Œ KIND åˆ›å»ºçš„é›†ç¾¤ç½‘ç»œäº’é€šï¼›&lt;/li>
&lt;/ul>
&lt;p>è¿™é‡Œéœ€è¦ç‰¹åˆ«è¯´ä¸€ä¸‹å…³äºæŒä¹…åŒ–é›†ç¾¤çš„ç‰¹æ€§ã€‚åœ¨ä¹‹å‰ç‰ˆæœ¬ä¸­ï¼Œå¦‚æœä½ çš„ dockerd è¿›è¡Œäº†é‡å¯æ“ä½œï¼Œæˆ–è€…æ˜¯é‡å¯äº†ç³»ç»Ÿï¼Œé‚£å¯èƒ½ä¼šå¯¼è‡´é›†ç¾¤ IP é‡æ–°åˆ†é…ï¼Œè¿›è€Œå¯¼è‡´é›†ç¾¤çŠ¶æ€å¼‚å¸¸ã€‚&lt;/p>
&lt;p>åœ¨ä¹‹å‰ç‰ˆæœ¬ä¸­ï¼Œæˆ‘ä»¬å»ºè®®æ‰€æœ‰çš„ç”¨æˆ·ï¼Œä¸è¦ä¾èµ–é›†ç¾¤æŒä¹…åŒ–ã€‚ä½†é‰´äºæœ‰ä¸å°‘ç”¨æˆ·çš„åé¦ˆï¼Œæ‰€ä»¥æˆ‘å…ˆå®ç°äº†ç¬¬ä¸€ç‰ˆã€‚&lt;/p>
&lt;p>å…·ä½“åšæ³•å…¶å®ä¹Ÿç®€å•ï¼ŒåŸå…ˆçš„ç—›ç‚¹åœ¨äºé‡å¯åï¼Œå®¹å™¨ IP çš„é‡æ–°åˆ†é…ï¼Œæ‰€ä»¥å…¨éƒ¨ä»¥åŸŸåçš„æ–¹å¼è¿›è¡Œæ›¿ä»£ï¼Œå¦å¤–å°±æ˜¯å€ŸåŠ©äº Docker çš„ embedded DNS æ¥å®Œæˆ LB å±‚å¯¹ master çš„ä»£ç†ã€‚&lt;/p>
&lt;p>ä½†è¿™ä¸ªå®ç°ï¼Œä¼šäº§ç”Ÿä¸€ä¸ª DNS æŸ¥è¯¢å¼‚å¸¸çš„é—®é¢˜ï¼Œæˆ‘åœ¨ä¸“æ  &lt;a href="https://gitbook.cn/gitchat/column/5d70cfdc4dc213091bfca46f">ã€ŠDocker æ ¸å¿ƒçŸ¥è¯†å¿…çŸ¥å¿…ä¼šã€‹&lt;/a> ç½‘ç»œç¯‡ä¸­æ·±å…¥ä»‹ç»è¿‡å…¶åŸç†ã€‚ä¹‹å‰æˆ‘è€ƒè™‘è¿‡é€šè¿‡ &lt;code>--resolv-conf&lt;/code> å‚æ•°ï¼Œå°†ä¸»æœºçš„ resolver æä¾›ç»™ kubelet ä½¿ç”¨ï¼Œä½†è¿™ç§æ–¹å¼å¹¶ä¸å¤Ÿä¼˜é›…ï¼Œè€Œä¸”æ’æŸ¥é—®é¢˜çš„è¯ï¼Œç”±äºä¸ä¸ kubelet ä½¿ç”¨ç›¸åŒ &lt;code>resolv.conf&lt;/code> ï¼Œä¹Ÿä¼šå¸¦æ¥ä¸€äº›éº»çƒ¦ï¼›ä¹‹åè€ƒè™‘å°†ä¸»æœºå’Œ Node ä¸­çš„ resolver è¿›è¡Œåˆå¹¶ï¼Œä½†åˆå¹¶çš„è¯ï¼Œä¹Ÿä¼šå¸¦æ¥ä¸€äº›éšæ‚£ã€‚&lt;/p>
&lt;p>æœ¬æ¬¡ç‰ˆæœ¬ä¸­çš„å®ç°ï¼Œå…¶å®æ˜¯å¯¹ Docker embedded DNS åšäº†å¾ˆå¤š hackï¼Œä¸»åŠ¨å¯¹ç½‘ç»œåšäº†ç®¡ç†ï¼Œä»¥æ­¤æ¥å®Œæˆæ­¤éœ€æ±‚ã€‚&lt;/p>
&lt;h3 id="features">Features&lt;/h3>
&lt;ul>
&lt;li>&lt;code>kind delete clusters --all&lt;/code> å¯ç”¨äºåˆ é™¤æ‰€æœ‰é›†ç¾¤ï¼›&lt;/li>
&lt;li>é…ç½®æ–‡ä»¶ä¸­æ–°å¢äº†é¡¶çº§ &lt;code>featureGates&lt;/code> å­—æ®µï¼Œæ¥å¼€å¯ç›¸å…³ç‰¹æ€§ï¼›&lt;/li>
&lt;li>&lt;code>NO_COLOR&lt;/code> çš„æ”¯æŒï¼›&lt;/li>
&lt;li>å®éªŒæ€§çš„å¯¹ &lt;code>podman&lt;/code> æä¾›äº†æ”¯æŒï¼›&lt;/li>
&lt;li>æ”¯æŒé€šè¿‡ &lt;code>KIND_CLUSTER_NAME&lt;/code> ç¯å¢ƒå˜é‡æ¥æŒ‡å®šé›†ç¾¤åç§°ï¼›&lt;/li>
&lt;li>æ”¯æŒåŠ¨æ€ PV åœ¨ k8s v.11.xï¼›&lt;/li>
&lt;/ul>
&lt;p>ä»¥ä¸Šå°±æ˜¯æ­¤æ¬¡ KIND v0.8 ä¸­å€¼å¾—æ³¨æ„çš„å†…å®¹ï¼Œæ¬¢è¿å¤§å®¶ä¸‹è½½ä½¿ç”¨ï¼ä½¿ç”¨æ–¹å¼å¯å‚è€ƒ&lt;a href="https://zhuanlan.zhihu.com/p/105173589">ã€Šä½¿ç”¨ Kind åœ¨ç¦»çº¿ç¯å¢ƒåˆ›å»º K8S é›†ç¾¤ã€‹&lt;/a>&lt;/p>
&lt;h2 id="nginx-ingress-controller-170-å‘å¸ƒ">NGINX Ingress Controller 1.7.0 å‘å¸ƒ&lt;/h2>
&lt;p>æœ¬å‘¨ &lt;a href="https://github.com/nginxinc/kubernetes-ingress">NGINX Ingress Controller&lt;/a> 1.7.0 å‘å¸ƒäº†ï¼ŒåŒ…å«äº†ä¼—å¤šæ›´æ–°ï¼š&lt;/p>
&lt;ul>
&lt;li>æ”¯æŒé€šè¿‡æ–°çš„èµ„æº &lt;code>TransportServer&lt;/code> å’Œ &lt;code>GlobalConfiguration&lt;/code> é…ç½® TCP/UDP/TLS çš„è´Ÿè½½å‡è¡¡ï¼Œè¿™æ ·ä¾¿å¯é€šè¿‡ NGINX Ingress Controller åœ¨ Kubernetes ä¸Šäº¤ä»˜éåŸºäº HTTP çš„åº”ç”¨ç¨‹åºï¼›&lt;/li>
&lt;li>æ”¯æŒåœ¨ &lt;code>VirtualServer&lt;/code> å’Œ &lt;code>VirtualServerRoute&lt;/code> èµ„æºä¸­é…ç½®é”™è¯¯é¡µï¼›&lt;/li>
&lt;li>æ”¯æŒåœ¨ Kubernetes æˆ– OpenShift ä¸Šï¼Œé€šè¿‡ &lt;a href="https://github.com/nginxinc/nginx-ingress-operator">NGINX Ingress Operator&lt;/a> ç®¡ç† Ingress çš„ç”Ÿå‘½å‘¨æœŸï¼›&lt;/li>
&lt;/ul>
&lt;p>å…³äºæ­¤ç‰ˆæœ¬çš„æ›´è¯¦ç»†å†…å®¹ï¼Œè¯·å‚è€ƒå…¶ &lt;a href="https://github.com/nginxinc/kubernetes-ingress/releases/tag/v1.7.0">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="ä¸Šæ¸¸è¿›å±•">ä¸Šæ¸¸è¿›å±•&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/pull/89285">#89285&lt;/a> ç§»é™¤äº† k/k ä¸­å¯¹ä¸Šæ¸¸ prometheus client åº“çš„ä¾èµ–ï¼Œå…¨éƒ¨æ›¿æ¢æˆäº† kubernetes å®ç°çš„ metrics æ¡†æ¶ã€‚è¿™æ˜¯ä¸ºäº†å®æ–½æ—©å…ˆçš„ä¸€ä¸ª &lt;a href="https://github.com/kubernetes/enhancements/blob/master/keps/sig-instrumentation/20190605-metrics-stability-migration.md">æŒ‡æ ‡ç¨³å®šæ€§è¿ç§»ï¼ˆMetrics Stability Migrationï¼‰çš„ KEP&lt;/a> ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/pull/90394">#90394&lt;/a> ä¿®æ­£äº† kubeadm ä¸­å¯¹ &lt;code>resolvConf&lt;/code> çš„è¡Œä¸ºã€‚kubeadm å°†ä¸ä¼šåœ¨ &lt;code>/var/lib/kubelet/kubeadm-flags.env&lt;/code> ä¸­è®¾ç½® &lt;code>--resolv-conf&lt;/code> çš„å€¼ï¼Œè€Œæ˜¯ä½¿ç”¨ &lt;code>KubeletConfiguration&lt;/code> å¯¹å…¶è¿›è¡Œé…ç½®ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/pull/90463">#90463&lt;/a> &lt;code>autoscaling/v2beta1&lt;/code> å·²åºŸå¼ƒï¼Œæ¨èä½¿ç”¨ &lt;code>autoscaling/v2beta2&lt;/code> ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/pull/89594">#89594&lt;/a> å°†ä¸å¯å˜ Secrets/ConfigMaps æå‡è‡³ Beta é˜¶æ®µï¼Œå¹¶ä¸” &lt;strong>é»˜è®¤æ‰“å¼€&lt;/strong> ï¼Œç”¨æˆ·å¯é€šè¿‡è®¾ç½® &lt;code>Immutable&lt;/code> å­—æ®µæ¥æ ‡è®°å…¶å†…å®¹ä¸ºä¸å¯å˜ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/pull/90449">#90449&lt;/a> ç§»é™¤äº† events API ä¸­æœªä½¿ç”¨çš„ &lt;code>series.state&lt;/code> å­—æ®µï¼›&lt;/li>
&lt;/ul>
&lt;h2 id="é¡¹ç›®æ¨è">é¡¹ç›®æ¨è&lt;/h2>
&lt;p>&lt;a href="https://github.com/weaveworks/kured">kured&lt;/a> æ˜¯ä¸€ä¸ªç”¨äºèŠ‚ç‚¹å®‰å…¨é‡å¯çš„ Daemonset ã€‚å®ƒåŒ…å«ä»¥ä¸‹ç‰¹æ€§ï¼š&lt;/p>
&lt;ul>
&lt;li>ç›‘å¬é‡å¯æ ‡å¿—ï¼Œä¾‹å¦‚ &lt;code>/var/run/reboot-required&lt;/code>ï¼›&lt;/li>
&lt;li>åˆ©ç”¨ API server ä¸­çš„é”æ¥ä¿éšœæ¯æ¬¡åªé‡å¯ä¸€ä¸ªèŠ‚ç‚¹ï¼›&lt;/li>
&lt;li>ï¼ˆå¯é€‰ï¼‰æ ¹æ® Prometheus æŠ¥è­¦æˆ–è€…é€‰å®š Pod çš„æƒ…å†µä¸‹ï¼Œå»¶è¿Ÿé‡å¯ï¼›&lt;/li>
&lt;li>åœ¨é‡å¯èŠ‚ç‚¹å‰ä¼šè‡ªåŠ¨æ‰§è¡Œ &lt;code>cordon&lt;/code> å’Œ &lt;code>drain&lt;/code> ï¼Œåœ¨èŠ‚ç‚¹é‡å¯å®Œæˆåæ‰§è¡Œ &lt;code>uncordon&lt;/code> ï¼›&lt;/li>
&lt;/ul>
&lt;p>è¿™åœ¨ç³»ç»Ÿéœ€è¦å®šæœŸç»´æŠ¤æ—¶å€™ï¼Œæ˜¯éå¸¸æœ‰ç”¨çš„ã€‚åŒæ—¶ä¹Ÿå¯è‡ªå·±æ‰‹åŠ¨è¿›è¡Œè§¦å‘ï¼Œè€Œä¸éœ€æ¯æ¬¡é‡å¤æ“ä½œã€‚&lt;/p>
&lt;hr>
&lt;p>æ¬¢è¿è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| Helm v3.2 æ­£å¼å‘å¸ƒ</title><link>https://moelove.info/2020/04/26/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Helm-v3.2-%E6%AD%A3%E5%BC%8F%E5%8F%91%E5%B8%83/</link><guid isPermaLink="true">https://moelove.info/2020/04/26/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Helm-v3.2-%E6%AD%A3%E5%BC%8F%E5%8F%91%E5%B8%83/</guid><pubDate>Sun, 26 Apr 2020 15:49:33 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="helm-v320-æ­£å¼å‘å¸ƒ">Helm v3.2.0 æ­£å¼å‘å¸ƒ&lt;/h2>
&lt;p>ç»è¿‡ä¸¤ä¸ªå¤šæœˆçš„æ—¶é—´ï¼ŒHelm v3.2 ç»ˆäºåœ¨æœ¬å‘¨æ­£å¼å‘å¸ƒäº†ï¼&lt;/p>
&lt;p>è¿™ä¸ªç‰ˆæœ¬å¸¦æ¥äº†å¾ˆå¤šå€¼å¾—å…³æ³¨çš„å†…å®¹ï¼Œæˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹å§ã€‚&lt;/p>
&lt;h3 id="postgres-å­˜å‚¨æ”¯æŒ">postgres å­˜å‚¨æ”¯æŒ&lt;/h3>
&lt;p>Helm v2 æ—¶å€™ï¼ŒRelease é»˜è®¤æ˜¯ä»¥ &lt;code>configmap&lt;/code> å­˜å‚¨çš„ï¼Œæ­¤å¤–è¿˜æ”¯æŒå­˜å‚¨ä¸º &lt;code>memory&lt;/code>, &lt;code>secret&lt;/code> æˆ– &lt;code>sql&lt;/code> ã€‚åœ¨ Helm v3 æ—¶ï¼Œç¤¾åŒºå¯¹æ­¤åšå‡ºäº†è°ƒæ•´ï¼Œæä¾›äº† &lt;code>configmap&lt;/code>, &lt;code>secret&lt;/code> å’Œ &lt;code>memory&lt;/code> ç­‰ä¸‰ç§å­˜å‚¨æ¨¡å¼ï¼Œå¹¶ä¸”é»˜è®¤çš„å­˜å‚¨æ–¹å¼ä¹Ÿå˜æˆäº†ä»¥ &lt;code>secret&lt;/code> è¿›è¡Œå­˜å‚¨ã€‚æ‰€ä»¥ä½ å¯ä»¥ç›´æ¥é€šè¿‡ &lt;code>kubectl get secret&lt;/code> çœ‹åˆ°ä½ éƒ¨ç½²çš„ release ã€‚&lt;/p>
&lt;p>æœ¬æ¬¡å‘å¸ƒçš„ Helm v3.2 ä¸­ï¼Œå¯¹æ­¤æœ‰äº†ä¸ªé‡å¤§å˜æ›´ï¼&lt;/p>
&lt;p>æœ¬æ¬¡ v3.2 ä¸­ï¼ŒHelm v3 ä¸­ç§»æ¤äº† Helm v2 ç‰ˆæœ¬æ—¶ï¼Œå¯¹ &lt;code>sql&lt;/code> å­˜å‚¨çš„æ”¯æŒï¼Œå³ï¼šç¬¬å››ç§ &lt;code>postgres&lt;/code>, é€šè¿‡ç»„åˆ &lt;code>$HELM_DRIVER&lt;/code> å’Œ &lt;code>$HELM_DRIVER_SQL_CONNECTION_STRING&lt;/code> ç¯å¢ƒå˜é‡ï¼Œä¾¿å¯è¾¾åˆ°æ•ˆæœã€‚&lt;/p>
&lt;p>&lt;em>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™è¿˜æ˜¯ä¸ªå®éªŒä¸­çš„ç‰¹æ€§ï¼Œå°šæœªæ­£å¼ GAã€‚å°é²œå¯ä»¥ï¼Œä½†å°½é‡åˆ«æ”¾åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ã€‚&lt;/em>&lt;/p>
&lt;h3 id="å…¶ä»–å˜æ›´">å…¶ä»–å˜æ›´&lt;/h3>
&lt;ul>
&lt;li>åœ¨æ·»åŠ  repo çš„æ—¶å€™ï¼Œå¢åŠ äº† &lt;code>--insecure-skip-tls-verify&lt;/code> å‚æ•°ï¼Œå¯è·³è¿‡ TLS æ£€æŸ¥ï¼š&lt;/li>
&lt;/ul>
&lt;pre>&lt;code>(MoeLove) âœ ~ helm3 repo add -h |grep 'insecure-skip-tls-verify'
--insecure-skip-tls-verify skip tls certificate checks for the repository
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>
&lt;p>ä¿®å¤äº†ä¸€ä¸ª&lt;a href="https://github.com/helm/helm/security/advisories/GHSA-q8q8-93cv-v6h8">é‡è¦æ¼æ´&lt;/a>ï¼Œè™½ç„¶ Helm ç¤¾åŒºä¹Ÿå‘å¸ƒäº† v3.1.3 æ¥è§£å†³æ­¤å®‰å…¨é—®é¢˜ï¼Œä½†å»ºè®®è¿˜æ˜¯ç›´æ¥å‡çº§åˆ° v3.2 (æ¯•ç«Ÿå®ƒè¿˜æœ‰ 40+ é¡¹ bugfix)ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>helm3 completion&lt;/code> æœ‰äº†æ˜¾è‘—æ”¹è¿›ï¼Œè‡ªåŠ¨è¡¥å…¨æ•ˆæœå˜å¥½äº†ï¼›&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>è¿˜æœ‰å…¶ä»–å¾ˆå¤šå°çš„ bugfix è¿™é‡Œå°±ä¸å†ä»‹ç»äº†ï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹è¯·å‚è€ƒå…¶ &lt;a href="https://github.com/helm/helm/releases/tag/v3.2.0">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="prometheus-2180-rc0-å‘å¸ƒ">Prometheus 2.18.0-rc.0 å‘å¸ƒ&lt;/h2>
&lt;p>è¿™æ˜¯ Prometheus v2.18.0 çš„é¦–ä¸ª rc ç‰ˆï¼Œè¿™é‡Œä»‹ç»å®ƒï¼Œä¸»è¦æ˜¯ç”±äºæœ¬æ¬¡æ–°å¢äº†ä¸€ä¸ªæœ‰è¶£çš„ç‰¹æ€§ã€‚ &lt;a href="https://github.com/prometheus/prometheus/pull/7148">&lt;strong>å¢åŠ äº† Jaeger çš„æ”¯æŒ&lt;/strong>&lt;/a>&lt;/p>
&lt;p>åœ¨ä¹‹å‰çš„æ–‡ç« ä¸­ï¼Œå·²ç»å¤šæ¬¡ä»‹ç»è¿‡ &lt;a href="https://www.jaegertracing.io/">Jaeger&lt;/a> äº†ï¼Œå®ƒæ˜¯ä¸€ä¸ªç«¯å¯¹ç«¯çš„åˆ†å¸ƒå¼ trace ç³»ç»Ÿï¼ŒåŒæ ·ä¹Ÿæ˜¯ CNCF çš„æ¯•ä¸šé¡¹ç›®ã€‚&lt;/p>
&lt;p>æ­¤æ¬¡å¢åŠ çš„å¯¹ Jaeger æ”¯æŒï¼Œå¯å¸®åŠ©æˆ‘ä»¬äº†è§£ Prometheus ä¸­æ¯ä¸ªæŸ¥è¯¢çš„æ‰§è¡Œæƒ…å†µã€‚&lt;/p>
&lt;p>ä½†ä¹Ÿè¯·æ³¨æ„ï¼šæ·»åŠ  Jaeger æ”¯æŒç®—æ˜¯ä¸€ä¸ªä¸´æ—¶çš„è§£å†³åŠæ³•ï¼Œæœ€ç»ˆç›®æ ‡æ˜¯è½¬å‘ OpenTelemetry ã€‚(æ­¤çŠ¶æ€å¯èƒ½ä¼šæŒç»­å¾ˆé•¿ä¸€æ®µæ—¶é—´)&lt;/p>
&lt;p>å¯ç›´æ¥ä¸‹è½½äºŒè¿›åˆ¶æ–‡ä»¶æˆ–ä½¿ç”¨ Docker é•œåƒè¿›è¡Œä½“éªŒ &lt;a href="https://github.com/prometheus/prometheus/releases/tag/v2.18.0-rc.0">https://github.com/prometheus/prometheus/releases/tag/v2.18.0-rc.0&lt;/a>&lt;/p>
&lt;h2 id="kubernetes-nginx-ingress-v0310-å‘å¸ƒ">Kubernetes NGINX Ingress v0.31.0 å‘å¸ƒ&lt;/h2>
&lt;p>æœ¬æ¬¡å‘å¸ƒçš„ä¸»è¦å˜åŒ–å¦‚ä¸‹ï¼š&lt;/p>
&lt;ul>
&lt;li>NGINX å‡çº§è‡³ 1.17.10&lt;/li>
&lt;li>OpenSSL å‡çº§è‡³ 1.1.1g ï¼Œ ä¸»è¦æ˜¯ä¸ºäº†é¿å…å— &lt;a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=2020-1967">CVE-2020-1967&lt;/a> æ¼æ´çš„å½±å“ï¼›&lt;/li>
&lt;li>æ”¯æŒä½¿ç”¨ comfigmap é…ç½® lua pluginï¼›&lt;/li>
&lt;/ul>
&lt;p>å®Œæ•´å˜æ›´è¯·å‚è€ƒå…¶ &lt;a href="https://github.com/kubernetes/ingress-nginx/blob/master/Changelog.md">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="ä¸Šæ¸¸è¿›å±•">ä¸Šæ¸¸è¿›å±•&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/pull/88480">#88480&lt;/a> Kubelet çš„ &lt;code>--volume-plugin-dir&lt;/code> é€‰é¡¹ï¼Œç°åœ¨å¯é€šè¿‡é…ç½®æ–‡ä»¶ä¸­çš„ &lt;code>VolumePluginDir&lt;/code> å‚æ•°è¿›è¡Œé…ç½®äº†ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/pull/89861">#89861&lt;/a> ä¿®æ­£äº† &lt;code>kubectl get&lt;/code> æœªæ‰¾åˆ°éå‘½åç©ºé—´èµ„æºæ—¶å€™çš„è¾“å‡ºæç¤ºã€‚ä¾‹å¦‚ï¼š&lt;/li>
&lt;/ul>
&lt;pre>&lt;code># ä¿®æ”¹å‰
(MoeLove) âœ ~ kubectl get pv
No resources found in default namespace.
# ä¿®æ”¹å
(MoeLove) âœ ~ kubectl get pv
No resources found
&lt;/code>&lt;/pre>&lt;hr>
&lt;p>æ¬¢è¿è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>Docker è¿˜éœ€è¦å­¦ä¹ å—ï¼Ÿ</title><link>https://moelove.info/2020/04/24/Docker-%E8%BF%98%E9%9C%80%E8%A6%81%E5%AD%A6%E4%B9%A0%E5%90%97/</link><guid isPermaLink="true">https://moelove.info/2020/04/24/Docker-%E8%BF%98%E9%9C%80%E8%A6%81%E5%AD%A6%E4%B9%A0%E5%90%97/</guid><pubDate>Fri, 24 Apr 2020 07:12:31 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;p>å»å¹´ä¸­åœ¨ Hacker News ä¸Šæœ‰ç¯‡çƒ­å¸– &lt;a href="https://zwischenzugs.com/2019/07/27/goodbye-docker-purging-is-such-sweet-sorrow/">â€œGoodbye Docker: Purging is Such Sweet Sorrowâ€&lt;/a> è¿™ç¯‡æ–‡ç« å†…å®¹å…¶å®å¾ˆå¸¸è§„ï¼Œæ— éæ˜¯è‡ªå·±ä½¿ç”¨ Docker çš„æ—¶å€™é‡åˆ°äº†ä¸€äº›é—®é¢˜ï¼Œæœ€ååˆ‡æ¢åˆ°äº† &lt;code>Podman&lt;/code> &lt;code>buildah&lt;/code> å’Œ &lt;code>Skopeo&lt;/code> ç»„åˆçš„å·¥å…·é›†ï¼Œä»¥ä½œä¸º Docker çš„ä¸€ç§æ›¿ä»£æ–¹æ¡ˆã€‚&lt;/p>
&lt;p>è¿™æ ·çš„æ–‡ç« åœ¨è¿‘ä¸€å¹´å·¦å³åº”è¯¥ç®—æ˜¯æ¯”è¾ƒå¸¸è§äº†ï¼Œä½†ä¸ºä½•ä¼šæˆä¸º Hacker News ä¸Šçš„çƒ­å¸–å‘¢ï¼Ÿä¸»è¦æœ‰ä¸¤æ–¹é¢çš„åŸå› ï¼š 1. è¿˜æ˜¯å› ä¸ºæ­¤æ–‡çš„ä½œè€…æ˜¯ Ian Miell ä»–æ˜¯ Docker in Practice (ä¸­è¯‘æœ¬å«åš ã€ŠDocker å®è·µã€‹)çš„ä½œè€…ï¼Œä¸€ä¸ª Docker ç›¸å…³æŠ€æœ¯ä¹¦ç±çš„ä½œè€…å°†è‡ªå·±çš„ Docker ç»™æ›¿æ¢æ‰ï¼Œä¼šè®©äººæ¯”è¾ƒå¥½å¥‡ï¼›2. æ›¿æ¢ Docker è²Œä¼¼æ˜¯ä¸€ç§æ–¹å‘ï¼Œå¤šæ•°äººä¹Ÿæƒ³è¦äº†è§£è¿™ç§æŠ€æœ¯å˜è¿ä¼šå¸¦æ¥ä»€ä¹ˆä¼˜åŠ¿æˆ–è€…æœ‰ä»€ä¹ˆæ ·çš„å‘ã€‚&lt;/p>
&lt;p>èƒŒæ™¯ä»‹ç»å®Œäº†ï¼Œæˆ‘ä»¬æ¥å¼€å§‹æ­£æ–‡ã€‚&lt;/p>
&lt;h2 id="å®¹å™¨æ—¶ä»£">å®¹å™¨æ—¶ä»£&lt;/h2>
&lt;p>Docker åœ¨ 2013 å¹´ PyCon ä¸Šé¦–æ¬¡äº®ç›¸ï¼Œéšåå¼€æºã€‚ç”±äºå…¶ç®€å•æ˜“ç”¨ï¼Œä»¥åŠåˆ‡å®è§£å†³äº†å› ç¯å¢ƒä¸ä¸€è‡´å¯¼è‡´çš„é—®é¢˜ï¼Œè¿…é€Ÿè·å¾—åˆ°ä¸€å¤§æ‰¹ç²‰ä¸ã€‚&lt;/p>
&lt;p>æ¥ä¸‹æ¥çš„å‡ å¹´ä¸­ï¼ŒDocker æ”¹å˜äº†è½¯ä»¶çš„äº¤ä»˜æ–¹å¼ï¼Œæ›´å¤šçš„äººä¸ºä¹‹ç€è¿·ã€‚éšä¹‹è€Œæ¥çš„æ˜¯ Docker ç”Ÿæ€çš„è“¬å‹ƒå‘å±•ã€‚&lt;/p>
&lt;p>Docker åœ¨å¤§å¤šæ•°äººçœ¼ä¸­å‡ ä¹æ˜¯å®¹å™¨ï¼ˆcontainerï¼‰çš„ä»£åè¯ï¼Œå³ä½¿æ˜¯ç°åœ¨æˆ‘ä¹Ÿä¼šå¸¸å¬åˆ°æœ‰äººè¯´â€œæˆ‘æœ‰å‡ ä¸ª docker è·‘ xx æœåŠ¡â€ ç±»ä¼¼è¿™æ ·çš„è¯ï¼Œæ— ç–‘ &lt;strong>Docker å¼•é¢†äº†å®¹å™¨çš„æ—¶ä»£&lt;/strong>ã€‚&lt;/p>
&lt;h3 id="å®¹å™¨æ˜¯ä»€ä¹ˆ">å®¹å™¨æ˜¯ä»€ä¹ˆ&lt;/h3>
&lt;p>ä¸€ç›´åœ¨æå®¹å™¨ï¼Œæˆ‘ä»¬ä¸å¦‚æ·±å…¥ç‚¹å…ˆæ¥æ¢ç©¶ä¸‹å®¹å™¨åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ&lt;/p>
&lt;p>åœ¨ &lt;a href="https://www.docker.com/resources/what-container">Docker å®˜ç½‘&lt;/a>ä¸Šå¯¹å®¹å™¨çš„æè¿°æ˜¯ï¼š &lt;em>â€œA standardized unit of softwareâ€&lt;/em> -- è½¯ä»¶çš„æ ‡å‡†å•å…ƒï¼Œå¹¶æ²¡æœ‰ä»€ä¹ˆæ›´è¯¦ç»†çš„å†…å®¹äº†ã€‚å¤šæ•°äººå¯¹å®¹å™¨çš„çœ‹æ³•ä¹Ÿéƒ½åœç•™åœ¨å¾ˆæµ…æ˜¾çš„è®¤è¯†ï¼šè®¤ä¸ºå®¹å™¨æ˜¯è½»é‡çº§çš„è™šæ‹Ÿæœºï¼Œæ‰€ä»¥åæ¥ä¹Ÿå°±æœ‰ä¸€æ®µæ—¶é—´æœ‰äººæ¨â€œå¯Œå®¹å™¨â€æŠ€æœ¯ã€‚&lt;/p>
&lt;p>è¿™é‡Œæˆ‘æƒ³æ›´æ·±å…¥ä¸€äº›ï¼Œå¯èƒ½ä¼šæ¶‰åŠä¸€äº›å®¹å™¨çš„å†å²ï¼Œä½†æˆ‘è®¤ä¸ºè¿™äº›å†…å®¹æœ‰åŠ©äºè¯»è€…ç†è§£æˆ‘çš„è§’åº¦å’Œè§‚ç‚¹ã€‚&lt;/p>
&lt;p>è¯´ç™½äº† &lt;strong>å®¹å™¨å…¶å®æ˜¯åœ¨æŸå°æœºå™¨ä¸Šçš„â€œä¸€ç»„â€è¿›ç¨‹ï¼Œå½“ç„¶è¿™ç»„è¿›ç¨‹å¯èƒ½åªæœ‰ä¸€ä¸ªï¼›å®ƒä»¬æœ‰ç›¸åŒçš„ç‰¹æ€§ï¼Œå½“ç„¶æ‰€å—çš„é™åˆ¶ä¹Ÿæ˜¯ç›¸åŒçš„ï¼›æ—¢ç„¶å«åšå®¹å™¨ï¼Œå¾ˆè‡ªç„¶çš„æˆ‘ä»¬è®¤ä¸ºå®ƒä»¬ä¸å¤–ç•Œå¯ä»¥è¿›è¡Œéš”ç¦»/åº”è¯¥æœ‰ä¸€ä¸ªåˆ†ç•Œçº¿ã€‚&lt;/strong>&lt;/p>
&lt;p>è°ˆå®Œäº†å®ƒçš„åŸºæœ¬ç‰¹æ€§ï¼Œé‚£æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•æ¥åˆ›å»ºä¸€ä¸ªå®¹å™¨ã€‚&lt;/p>
&lt;h4 id="chroot">chroot&lt;/h4>
&lt;p>å¦‚æœä½ å¯¹ Linux ç›¸å¯¹ç†Ÿæ‚‰çš„è¯ï¼Œä½ å¯èƒ½çŸ¥é“ &lt;code>chroot&lt;/code> ï¼Œæˆ‘ä»¬æœ‰æ—¶ä¼šä½¿ç”¨ &lt;code>chroot&lt;/code> æ”¹å˜æŸè¿›ç¨‹çš„æ ¹ç›®å½•ï¼Œå¹¶ä¸”å®ƒä¸èƒ½è®¿é—®è¯¥ç›®å½•ä¹‹å¤–çš„å…¶ä»–ç›®å½•ã€‚&lt;/p>
&lt;p>è¿™ä¸ªå’Œæˆ‘ä»¬åœ¨ä¸€ä¸ªå®¹å™¨å†…çš„æ„Ÿè§‰å¾ˆåƒäº†ã€‚äº‹å®ä¸Šåœ¨å‡ å¹´å‰ç¡®å®æœ‰äººç”¨ä¸€ç™¾å¤šè¡Œçš„ bash shell åˆ©ç”¨ &lt;code>chroot&lt;/code> å†™äº†ä¸€ä¸ªæ¨¡æ‹Ÿ Docker åˆ›å»ºå®¹å™¨çš„å®ç°ï¼Œç§°ä¹‹ä¸º &lt;a href="https://github.com/p8952/bocker">bocker&lt;/a> , æœ‰å…´è¶£çš„æœ‹å‹å¯ä»¥å»çœ‹çœ‹è¯¥é¡¹ç›®çš„ä»£ç ã€‚&lt;/p>
&lt;p>æ¥ä¸‹æ¥æˆ‘ä»¬ä½¿ç”¨ &lt;code>chroot&lt;/code> åˆ›å»ºä¸€ä¸ªéš”ç¦»ç¯å¢ƒï¼š&lt;/p>
&lt;p>é¦–å…ˆå®ƒéœ€è¦æœ‰ä¸€ä¸ª &lt;code>rootfs&lt;/code> çš„æ ¹æ–‡ä»¶ç³»ç»Ÿï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆç®€å•çš„ä½¿ç”¨ Docker è·å¾—æˆ‘ä»¬éœ€è¦çš„å†…å®¹ã€‚&lt;/p>
&lt;pre>&lt;code>(MoeLove) âœ ~ mkdir chroot-dir
(MoeLove) âœ ~ cd chroot-dir
(MoeLove) âœ chroot-dir docker save -o debian.tar debian:buster
(MoeLove) âœ chroot-dir ls
debian.tar
(MoeLove) âœ chroot-dir tar -xf debian.tar
(MoeLove) âœ chroot-dir ls
098963abf3c3b87b8114ff67d164097dfac2d5659e39f9beb5604db91585f375.json debian.tar repositories
0f28619fe69181d3af529d56692f1362b7a7c8a6bf8dc9ab0d6d4f9ef9b0004d manifest.json
(MoeLove) âœ chroot-dir mkdir -p debian
(MoeLove) âœ chroot-dir tar -C debian -xf 0f28619fe69181d3af529d56692f1362b7a7c8a6bf8dc9ab0d6d4f9ef9b0004d/layer.tar
(MoeLove) âœ chroot-dir ls debian
bin boot dev etc home lib lib64 media mnt opt proc root run sbin srv sys tmp usr var
&lt;/code>&lt;/pre>&lt;p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬é€šè¿‡å¯¹é•œåƒæ–‡ä»¶çš„è§£å‹ï¼Œå¾—åˆ°äº†æˆ‘ä»¬æ‰€éœ€çš„ &lt;code>rootfs&lt;/code> çš„å…¨éƒ¨å†…å®¹ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹ &lt;code>chroot&lt;/code> çš„èƒ½åŠ›ï¼š&lt;/p>
&lt;pre>&lt;code>(MoeLove) âœ chroot sudo chroot debian /bin/bash -i
[sudo] tao çš„å¯†ç ï¼š
root@localhost:/# whoami
root
root@localhost:/# cat /etc/os-release
PRETTY_NAME=&amp;quot;Debian GNU/Linux 10 (buster)&amp;quot;
NAME=&amp;quot;Debian GNU/Linux&amp;quot;
VERSION_ID=&amp;quot;10&amp;quot;
VERSION=&amp;quot;10 (buster)&amp;quot;
VERSION_CODENAME=buster
ID=debian
HOME_URL=&amp;quot;https://www.debian.org/&amp;quot;
SUPPORT_URL=&amp;quot;https://www.debian.org/support&amp;quot;
BUG_REPORT_URL=&amp;quot;https://bugs.debian.org/&amp;quot;
&lt;/code>&lt;/pre>&lt;p>æˆ‘ä»¬ç›®å‰å°±å·²ç»åœ¨ä¸€ä¸ª &amp;quot;å®¹å™¨&amp;quot; å†…äº†ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹ä½¿ç”¨è¿™ä¸ªå®¹å™¨æˆ‘ä»¬èƒ½åšäº›ä»€ä¹ˆã€‚&lt;/p>
&lt;p>é¦–å…ˆæˆ‘ä»¬çœ‹çœ‹å½“å‰â€œå®¹å™¨â€å†…çš„è·¯ç”±è¡¨ï¼š&lt;/p>
&lt;pre>&lt;code>root@localhost:/# mkdir -p /sys
root@localhost:/# mount -t sysfs sys /sys
root@localhost:/# ip r
default via 192.168.0.1 dev wlp2s0 proto dhcp metric 600
172.17.0.0/16 dev docker0 proto kernel scope link src 172.17.0.1 linkdown
192.168.0.0/24 dev wlp2s0 proto kernel scope link src 192.168.0.108 metric 600
192.168.122.0/24 dev virbr0 proto kernel scope link src 192.168.122.1 linkdown
&lt;/code>&lt;/pre>&lt;p>å¾ˆè‡ªç„¶çš„ï¼Œæˆ‘ä»¬å‘ç°å®ƒå¯ä»¥è®¿é—®æ‰€æœ‰çš„ç½‘ç»œè®¾å¤‡&lt;/p>
&lt;pre>&lt;code>root@localhost:/# ls /sys/class/net/
docker0 enp1s0 lo vboxnet0 virbr0 virbr0-nic wlp2s0
&lt;/code>&lt;/pre>&lt;p>å¦å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å°† &lt;code>/proc&lt;/code> ä¹ŸæŒ‚è½½è¿›å»&lt;/p>
&lt;pre>&lt;code>root@localhost:/# mkdir -p /proc
root@localhost:/# mount -t proc proc /proc
root@localhost:/# ls -al /proc/31730/ns/pid
lrwxrwxrwx. 1 1000 1000 0 Jul 29 16:47 /proc/31730/ns/pid -&amp;gt; 'pid:[4026531836]'
&lt;/code>&lt;/pre>&lt;p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬åœ¨è¿™ä¸ªâ€œå®¹å™¨â€å†…ï¼Œå¯ä»¥è®¿é—®åˆ°ä¸»æœºä¸Šçš„è¿›ç¨‹åŠç½‘ç»œç­‰ä¿¡æ¯ï¼Œè¿™è¡¨ç¤ºæ²¡æœ‰ä»»ä½•çš„è¿›ç¨‹æˆ–è€…ç½‘ç»œéš”ç¦»ï¼Œè¿™å¸¦æ¥çš„å±é™©æ˜¯æˆ‘ä»¬ç”šè‡³å¯ä»¥åœ¨å®¹å™¨å†…æ€æ‰å®¹å™¨å¤–çš„è¿›ç¨‹ï¼Œæˆ–è€…é€šè¿‡å®¹å™¨æ¥æ”»å‡»ä¸»æœºã€‚&lt;/p>
&lt;p>ä¸ºäº†èƒ½æ›´å¥½çš„è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæ¥ä¸‹æ¥å‡ºç°äº†å¦ä¸€ä¸ªæŠ€æœ¯ï¼šnamespace ã€‚&lt;/p>
&lt;h4 id="namespace">namespace&lt;/h4>
&lt;p>Namespace æ˜¯åœ¨ 2002 å¹´ç”± Linux 2.4.19 å¼€å§‹åŠ å…¥å†…æ ¸çš„ç‰¹æ€§ï¼Œå®ƒä¸»è¦çš„ä½œç”¨å°±åšäº†ä¸€å±‚æŠ½è±¡å’Œéš”ç¦»ï¼Œä½¿å¾—åœ¨ namespace ä¸­çš„è¿›ç¨‹/è¿›ç¨‹ç»„å¯ä»¥çœ‹èµ·æ¥æ‹¥æœ‰è‡ªå·±çš„ç‹¬ç«‹èµ„æºï¼Œå…·ä½“çš„â€œèµ„æºâ€è¡¨ç°å½¢å¼å–å†³äºç»™å®ƒèµ‹äºˆäº†å“ªäº› namespace ã€‚&lt;/p>
&lt;p>éšç€ 2013 å¹´ Linux 3.8 ä¸­ user namespace çš„å¼•å…¥ï¼Œå¯¹äºæˆ‘ä»¬ç°åœ¨æ‰€ç†ŸçŸ¥çš„å®¹å™¨æ‰€éœ€çš„å…¨éƒ¨ namespace å°±éƒ½å®ç°äº†ï¼š&lt;code>mnt&lt;/code> &lt;code>pid&lt;/code> &lt;code>net&lt;/code> &lt;code>ipc&lt;/code> &lt;code>uts&lt;/code> &lt;code>user&lt;/code> å’Œ &lt;code>cgroup&lt;/code> å¯¹äºè¿™äº› namespace å’Œ Docker çš„å…³ç³»ï¼Œæˆ‘ä»¬ç¨åä¼šé€æ­¥æ¥çœ‹ï¼Œè¿™é‡Œå…ˆå¯¹ namespace åšä¸‹ä»‹ç»ï¼Œç„¶åç»§ç»­å‰é¢&amp;quot;å®¹å™¨&amp;quot;çš„å†…å®¹ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‰ä¸ªç³»ç»Ÿè°ƒç”¨ç›´æ¥æ“ä½œ namespace ï¼Œè¿™ä¸‰ä¸ªç³»ç»Ÿè°ƒç”¨åˆ†åˆ«æ˜¯ï¼š&lt;/p>
&lt;ul>
&lt;li>clone: å¯ä»¥é€šè¿‡ä¼ é€’ä¸åŒ namespace çš„æ ‡å¿—æ¥ä¸ºæ–°çš„(å­)è¿›ç¨‹æŒ‡å®šå…¶æ‰€å±çš„ namespace;&lt;/li>
&lt;li>unshare: å…è®¸ä¸€ä¸ªè¿›ç¨‹(æˆ–çº¿ç¨‹)å–æ¶ˆå½“å‰ä¸å…¶ä»–è¿›ç¨‹(æˆ–çº¿ç¨‹)å…±äº«çš„æ‰§è¡Œä¸Šä¸‹æ–‡ï¼›&lt;/li>
&lt;li>setns: è¿›å…¥æ–‡ä»¶æè¿°ç¬¦æŒ‡å®šçš„ namespace;&lt;/li>
&lt;/ul>
&lt;p>çŸ¥é“äº†è¿™äº›åŸºç¡€çŸ¥è¯†åï¼Œæˆ‘ä»¬å›åˆ°å‰é¢&amp;quot;å®¹å™¨&amp;quot;çš„å†…å®¹ä¸­ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬åœ¨å‰é¢ &lt;code>chroot&lt;/code> çš„ä¾‹å­ä¸­çœ‹åˆ°æ²¡èƒ½åšåˆ°è¿›ç¨‹æˆ–ç½‘ç»œéš”ç¦»ï¼Œç°åœ¨æˆ‘ä»¬æ¥è¯•è¯•çœ‹ç”¨ namespace å®Œæˆè¯¥éœ€æ±‚ã€‚&lt;/p>
&lt;pre>&lt;code>(MoeLove) âœ ~ sudo unshare -fp --mount-proc -n
[sudo] tao çš„å¯†ç ï¼š
[root@localhost]/home/tao# ip l
1: lo: &amp;lt;LOOPBACK&amp;gt; mtu 65536 qdisc noop state DOWN mode DEFAULT group default qlen 1000
link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
[root@localhost]/home/tao# ps -a
PID TTY TIME CMD
1 pts/15 00:00:00 zsh
33 pts/15 00:00:00 ps
[root@localhost]/home/tao#
&lt;/code>&lt;/pre>&lt;p>è¿™é‡Œå¾ˆæ˜æ˜¾ï¼Œæˆ‘ä»¬å½“å‰æ‰€åœ¨è¿›ç¨‹çš„ PID ä¸º 1 å¹¶ä¸”çœ‹ä¸åˆ°å®¿ä¸»æœºä¸Šçš„å…¶ä»–è¿›ç¨‹ï¼Œæˆ‘ä»¬è¾¾åˆ°äº†åŸºç¡€çš„éš”ç¦»æ•ˆæœã€‚ç½‘ç»œä¹ŸåŒæ ·ï¼Œç°åœ¨åªåŒ…å«ä¸€ä¸ª &lt;code>lo&lt;/code> æ¥å£ã€‚å…³äºç½‘ç»œéƒ¨åˆ†çš„å†…å®¹å…¶å®èƒ½èŠçš„ä¸œè¥¿è¿˜æœ‰å¾ˆå¤šï¼Œæˆ‘åœ¨ä¸“æ &lt;a href="https://gitbook.cn/gitchat/column/5d70cfdc4dc213091bfca46f">ã€ŠDocker æ ¸å¿ƒçŸ¥è¯†å¿…çŸ¥å¿…ä¼šã€‹&lt;/a>ä¸­ï¼Œç”¨ 8 èŠ‚å†…å®¹æ¥æ·±å…¥çš„èŠäº†èŠ Docker å®¹å™¨ç½‘ç»œç›¸å…³çš„å†…å®¹ï¼Œæ„Ÿå…´è¶£çš„è¯»è€…å¯ä»¥çœ‹çœ‹ã€‚&lt;/p>
&lt;h3 id="å°ç»“">å°ç»“&lt;/h3>
&lt;p>ä¸Šé¢èŠäº†è¿™ä¹ˆå¤šï¼Œæ— éæ˜¯æƒ³è¯´æ˜å®¹å™¨çš„å‘å±•å†ç¨‹ï¼Œä»¥åŠå®ƒæ˜¯ä»€ä¹ˆã€‚å®ƒå…¶å®å°±æ˜¯ç”¨äº†å„ç§ Linux å†…æ ¸æä¾›çš„ç‰¹æ€§/åŠŸèƒ½ååŒå®ç°çš„å¯¹è¿›ç¨‹ç»„çš„èµ„æºéš”ç¦»ã€‚ç”¨ Docker æˆ–è€… namespace æˆ–è€… chroot ä¹‹ç±»çš„éƒ½å¯ä»¥é€ å‡ºæ¥ä¸€ä¸ª â€œå®¹å™¨â€ ï¼Œé‚£æˆ‘ä»¬ä¸ºä»€ä¹ˆè¦ç”¨ Docker å‘¢ï¼Ÿ&lt;/p>
&lt;h2 id="docker-å´›èµ·ä¹‹è·¯">Docker å´›èµ·ä¹‹è·¯&lt;/h2>
&lt;p>æƒ³å¿…å¤§å®¶å¯¹ cgroups ä¸ä¼šå¤ªé™Œç”Ÿï¼Œå®ƒåœ¨ 2008 å¹´è¿›å…¥ Linux 2.6.24 åï¼ŒåŸºäºå®ƒå¹¶ä¸”ç„å‡†å®¹å™¨ä¸–ç•Œçš„ä¸€ä¸ªé¡¹ç›®è¯ç”Ÿäº†ã€‚&lt;/p>
&lt;p>Linux Container ï¼ˆLXCï¼‰ç»“åˆäº† namespace å’Œ cgroups ç­‰æŠ€æœ¯ï¼Œç›®æ ‡å°±æ˜¯è¦åˆ›é€ å‡ºè¿è¡Œåœ¨ Linux ç³»ç»Ÿä¸­ï¼Œå¹¶ä¸”éš”ç¦»æ€§è‰¯å¥½çš„å®¹å™¨ç¯å¢ƒã€‚&lt;/p>
&lt;p>LXC çš„äº‹æƒ…å‘ç”Ÿåœ¨ 2008 å¹´ï¼Œä½†å€¼å¾—æ³¨æ„çš„æ˜¯ cgroups æœ€åˆæ˜¯ç”± Google çš„å·¥ç¨‹å¸ˆå¼€å‘çš„ï¼Œæœ€æ—©çš„è®°å½•æ˜¯åœ¨ 2006 å¹´ï¼Œäº‹å®ä¸Šå½“æ—¶ Google ç¡®å®ä¹Ÿåœ¨åšç±»ä¼¼çš„å®¹å™¨åŒ–é¡¹ç›®ã€‚&lt;/p>
&lt;p>æ—¶é—´ä¸€æ™ƒè€Œè¿‡ï¼Œå°±åˆ°äº† 2013 å¹´çš„ PyCon ä¸Šï¼Œåœ¨è¿™æ¬¡å¤§ä¼šä¸Š Docker æ­£å¼é¢ä¸–ã€‚è€Œå®ƒå½“æ—¶å…¶å®ä¹Ÿåªæ˜¯æ„å»ºåœ¨ LXC ä¹‹ä¸Šçš„ä¸€ä¸ªå·¥å…·ï¼Œå±è”½æ‰äº† LXC çš„ä½¿ç”¨ç»†èŠ‚ï¼Œè®©ç”¨æˆ·å¯ä»¥ä¸€å¥ &lt;code>docker run&lt;/code> ä¾¿åˆ›å»ºå‡ºè‡ªå·±çš„å®¹å™¨ç¯å¢ƒã€‚ &lt;strong>åŒæ—¶ï¼Œå®ƒå…è®¸ç”¨æˆ·å°†å®¹å™¨ç¯å¢ƒæ‰“åŒ…æˆä¸ºä¸€ä¸ª Docker é•œåƒè¿›è¡Œåˆ†å‘ï¼Œè¿™ä¹Ÿå¤§å¤§é™ä½äº†ç”¨æˆ·ä½¿ç”¨çš„é—¨æ§›ã€‚&lt;/strong> Docker é•œåƒåˆ†å‘å¯ä»¥è¯´æ˜¯ Docker æˆåŠŸçš„ä¸€ä¸ªå…³é”®è¦ç´ äº†ã€‚&lt;/p>
&lt;p>2014 å¹´ Docker å‘å¸ƒ 1.0 æ­£å¼è¿›å…¥ç”Ÿäº§å°±ç»ªçš„çŠ¶æ€ã€‚åœ¨æ­¤ä¹‹å‰å®ƒä¹Ÿå°† LXC é€æ­¥ä»å®ƒçš„åº•å±‚ç§»é™¤ï¼Œæ¢æˆäº†è‡ªå·±å®ç°çš„ &lt;code>libcontainer&lt;/code> ï¼Œå¹¸è¿çš„æ˜¯æˆ‘ä¹Ÿåœ¨ 0.9 ç‰ˆæœ¬æ—¶å¼€å§‹äº†æˆ‘çš„ Docker ä¹‹è·¯ã€‚&lt;/p>
&lt;p>æ­¤å Docker ä¾¿æˆä¸ºäº†é£é¡æŠ€æœ¯ç•Œçš„æ–°çƒ­æ½®ã€‚&lt;/p>
&lt;p>&lt;strong>äº†è§£äº† Docker çš„å‘å±•èƒŒæ™¯åï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹å‰é¢æˆ‘ä»¬æåˆ°çš„é—®é¢˜ï¼šä¸ºä»€ä¹ˆè¦ç”¨ Docker å‘¢ï¼Ÿ&lt;/strong>&lt;/p>
&lt;p>2008 å¹´åˆ° 2013 å¹´è¿™ä¹‹é—´å¤§çº¦ 5 å¹´å·¦å³çš„æ—¶é—´ï¼Œä»¥ LXC ä¸ºé¦–çš„å®¹å™¨æŠ€æœ¯å¹¶æ²¡æœ‰å¾—åˆ°ç±»ä¼¼ Docker å‡ºç°åé‚£ä¹ˆå¹¿æ³›çš„æ™®åŠï¼Œæˆ‘åœ¨ä¹‹å‰çš„çº¿ä¸‹æ¼”è®²ä¸­ä¹Ÿæåˆ°è¿‡è¿™ä¸ªç‚¹ï¼Œæœ€ä¸»è¦çš„åŸå› åœ¨äº LXC å¤ªåå‘æŠ€æœ¯äº†ï¼Œä½¿ç”¨ LXC æœ‰ä¸€å®šçš„é—¨æ§›ï¼Œå¯¼è‡´äº†å¥½å¤šäººçš„é€€å´ã€‚&lt;/p>
&lt;p>Docker åˆ™æä¾›äº†ç®€å•æ˜“ç”¨çš„ CLI , ä¼˜é›…çµæ´»çš„å®¹å™¨ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼Œä»¥åŠé•œåƒçš„æ„å»ºï¼Œåˆ†å‘ç­‰é…å¥—è®¾æ–½ï¼Œè¿™ä¸ºåæœŸçš„æ¨è¿›æä¾›äº†å¾ˆå¤šçš„ä¾¿åˆ©ã€‚&lt;/p>
&lt;p>å†åŠ ä¸Š Docker çš„ç­–ç•¥å¾ˆå¥½ï¼Œä»¥åŠåœ¨ Docker å…¬å¸å†…éƒ¨ä¹Ÿæœ‰å¤§é‡çš„å®è·µç»éªŒï¼Œæ‰€ä»¥è¿™äº›äº‹æƒ…åšèµ·æ¥ä¹Ÿéƒ½å¾ˆé¡ºç•…äº†ã€‚ï¼ˆå…³äº Docker å…¬å¸çš„å®è·µç»éªŒå¯ä»¥è¯´æ˜¯ä¿¡æ¯é‡å·¨å¤§äº†ï¼Œä»¥åå†çœ‹æœºä¼šåˆ†äº«å§ï¼‰&lt;/p>
&lt;h2 id="ä½¿ç”¨-docker-é¢ä¸´çš„é—®é¢˜">ä½¿ç”¨ Docker é¢ä¸´çš„é—®é¢˜&lt;/h2>
&lt;p>å‰é¢åˆ†åˆ«èŠäº†å®¹å™¨çš„å‘å±•å†ç¨‹ï¼Œä»¥åŠ Docker çš„å‘å±•å†ç¨‹ã€‚æˆ‘ä»¬è¦æ­£è§† Docker æ˜¯ä¸€ä¸ªå·²ç» 7 å²çš„é¡¹ç›®ï¼Œè‡ªå®ƒ 1.0 å‘å¸ƒä»¥æ¥å·²ç» 6 å¹´ä¹‹ä¹…äº†ï¼Œå®ƒåœ¨ç”Ÿäº§ç¯å¢ƒä¸­å·²ç»å¾—åˆ°äº†å¤§é‡çš„å®è·µå’ŒéªŒè¯ã€‚å½“ç„¶ä¸å¯é¿å…çš„å®ƒä¹Ÿä¼šå­˜åœ¨ä¸€äº›å†å²é—ç•™é—®é¢˜æˆ–è€…æ˜¯è½¯ä»¶ bug ã€‚&lt;/p>
&lt;p>å°¤å…¶æ˜¯éšç€ K8S çš„å‘å±•ï¼Œå›½å†…å¤–å¤§é‡å…¬å¸éƒ½åœ¨è½åœ° K8Sã€‚å…¶ä¸­æœ‰è¶…è¿‡åŠæ•°çš„å…¬å¸éƒ½æ˜¯ä½¿ç”¨ Docker ä½œä¸ºå®¹å™¨è¿è¡Œçš„ã€‚&lt;/p>
&lt;p>å½“å‘ç”Ÿæ•…éšœæˆ–è€…å¼‚å¸¸æ—¶ï¼Œæœ‰äº›äººå¯èƒ½ä¼šæŸæ‰‹æ— ç­–ï¼Œæˆ–æ˜¯åªä»ä¸Šå±‚è¿›è¡Œé—®é¢˜çš„æ’æŸ¥ï¼Œæ®Šä¸çŸ¥é—®é¢˜å¾ˆå¯èƒ½å‘ç”Ÿåœ¨åº•å±‚çš„å®¹å™¨è¿è¡Œæ—¶ã€‚æ¯”è¾ƒå…¸å‹çš„ä¾‹å­ï¼šæ¯”å¦‚è¯´å®¹å™¨ Hang ä½ï¼Œæˆ–è€…æ˜¯æ— æ³•åˆ›å»ºå®¹å™¨ç­‰ã€‚&lt;/p>
&lt;p>æˆ–è€…æœ‰äººç”±äºå¯¹ Docker ç½‘ç»œç›¸å…³çš„æ–¹é¢ä¸äº†è§£ï¼Œæ‰€ä»¥åœ¨å­¦ä¹ å’Œä½¿ç”¨ K8S æ—¶ï¼Œä¹Ÿä¼šèµ°ä¸å°‘çš„å¼¯è·¯ã€‚æ¯”è¾ƒå…¸å‹çš„ä¾‹å­ï¼šä¸ç†è§£ K8S ä¸­æ•°æ®åŒ…çš„æµå‘ã€‚&lt;/p>
&lt;p>æœ€åä¸€ä¸ªå¾ˆé‡è¦çš„æ–¹é¢å°±æ˜¯å®‰å…¨ç›¸å…³çš„äº†ã€‚åœ¨ä¼ä¸šä¸­ä½¿ç”¨ Docker å°¤å…¶éœ€è¦æ³¨æ„ã€‚è¿™é‡ŒåŒ…å«ç€å¾ˆå¤šä¿¡æ¯ï¼šæ¯”å¦‚å®¹å™¨è¿è¡Œæ—¶å®‰å…¨ï¼Œé•œåƒå®‰å…¨ï¼Œå®¹å™¨ç­–ç•¥å®‰å…¨ç­‰ï¼Œæˆ‘åœ¨ä¸“æ çš„å®‰å…¨ç¯‡ä¹Ÿéƒ½è¿›è¡Œäº†ä»‹ç»ã€‚&lt;/p>
&lt;h2 id="æ€»ç»“">æ€»ç»“&lt;/h2>
&lt;p>Docker çš„ä¸Šæ‰‹ä½¿ç”¨éå¸¸ç®€å•ï¼Œè¿™æ˜¯ Docker çš„ä¸€å¤§ä¼˜åŠ¿ï¼Œæ—¨åœ¨é™ä½å¼€å‘è€…çš„ä½¿ç”¨é—¨æ§›ã€‚å°¤å…¶æ˜¯ Docker Desktop æä¾›äº†äº¤äº’å¼ UIï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡é¼ æ ‡ç‚¹å‡»å°±å®Œæˆå®¹å™¨çš„ç›¸å…³æ“ä½œå’Œç®¡ç†ã€‚&lt;/p>
&lt;p>ä½†æ˜¯ Docker ä½œä¸ºä¸€ä¸ªæ­£åœ¨è¢«å¤§é‡ä½¿ç”¨ï¼Œä¸”å¾€åä¼šè¢«åº”ç”¨æ›´å¤šçš„æŠ€æœ¯ï¼Œå¦‚æœè¦ç”¨åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæˆ‘å»ºè®®è¯»è€…å»æ›´æ·±å…¥çš„å­¦ä¹ å’ŒæŒæ¡å®ƒã€‚&lt;/p>
&lt;p>ä»¥ä¾¿åœ¨é‡åˆ°é—®é¢˜æ—¶ï¼Œå¯ä»¥æ›´å¿«é€Ÿçš„å®šä½å’Œè§£å†³ï¼›æ„å»ºé•œåƒæ—¶ï¼Œå¯ä»¥æ›´åŠ é«˜æ•ˆï¼›ä½¿ç”¨ Docker æ—¶ï¼Œèƒ½ä¸ºä¼ä¸šæä¾›æ›´é€‚å®œçš„å®‰å…¨ç­–ç•¥ã€‚&lt;/p>
&lt;p>å½“ç„¶ï¼Œè¿˜æœ‰ä¸€ä¸ªæœ€é‡è¦çš„ï¼Œå½“ä½ å¯¹ Docker çš„äº†è§£è¶Šæ·±å…¥æ—¶ï¼Œä½ ä¹Ÿä¼šè¶Šå¼€å¿ƒï¼Œä½ èƒ½æ¥è§¦åˆ°æ›´å¤šæœ‰è¶£çš„çŸ¥è¯†å’ŒæŠ€èƒ½ã€‚&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Docker/">Docker</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| containerd v1.3.4 æ­£å¼å‘å¸ƒ</title><link>https://moelove.info/2020/04/19/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-containerd-v1.3.4-%E6%AD%A3%E5%BC%8F%E5%8F%91%E5%B8%83/</link><guid isPermaLink="true">https://moelove.info/2020/04/19/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-containerd-v1.3.4-%E6%AD%A3%E5%BC%8F%E5%8F%91%E5%B8%83/</guid><pubDate>Sun, 19 Apr 2020 23:38:40 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="containerd-v134-æ­£å¼å‘å¸ƒ">containerd v1.3.4 æ­£å¼å‘å¸ƒ&lt;/h2>
&lt;p>æœ¬å‘¨ containerd v1.3.4 æ­£å¼å‘å¸ƒäº†ï¼Œè·ç¦»ä¸Šæ¬¡ v1.3.3 å¤§çº¦ 2 ä¸ªæœˆå·¦å³çš„æ—¶é—´ã€‚æœ¬æ¬¡ä»ç„¶æ˜¯ v1.3.x ç³»åˆ—çš„ patch ç‰ˆæœ¬ï¼Œä½†æœ¬æ¬¡å€¼å¾—æ³¨æ„çš„å†…å®¹å¹¶ä¸å°‘ï¼Œæˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://github.com/containerd/containerd/pull/4007">containerd/containerd#4007&lt;/a> æ”¹å–„äº† docker remote ä¸­é•œåƒä¸»æœºå¤±è´¥å›é€€çš„è¡Œä¸ºã€‚&lt;/li>
&lt;/ul>
&lt;p>è¿™ä¸ªå˜æ›´æ˜¯éå¸¸æœ‰ç”¨çš„ï¼Œæ¯”å¦‚å½“æˆ‘ä»¬æƒ³è¦ä¸ºæŸä¸ªé•œåƒä»“åº“æä¾›å¤šä¸ªå¯ç”¨çš„é•œåƒæºï¼ˆæˆ–è€…ä¸»æœºï¼‰çš„æ—¶å€™ï¼Œåœ¨ v1.3.4 ä¹‹å‰ï¼Œå¦‚æœç¬¬ä¸€ä¸ªæºï¼ˆæˆ–è€…ä¸»æœºï¼‰ è¿”å›é”™è¯¯çš„æ—¶å€™ï¼Œé‚£é»˜è®¤å°±ä¼šå›é€€ï¼Œç›´æ¥è¯·æ±‚æºç«™äº†ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œç›¸å½“äºæˆ‘ä»¬è®¾ç½®çš„å¤šä¸ªé•œåƒæºï¼ˆæˆ–ä¸»æœºï¼‰å°±æ²¡ä»€ä¹ˆå®é™…æ„ä¹‰äº†ã€‚&lt;/p>
&lt;p>ç»è¿‡æ­¤æ¬¡å˜æ›´åï¼Œè¯·æ±‚ä¼šé€ä¸ªå°è¯•è®¾ç½®çš„é•œåƒæºï¼Œå¯å¤§å¤§ä¿éšœæ‹‰å–çš„æˆåŠŸç‡ã€‚&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://github.com/containerd/containerd/pull/4104">containerd/containerd#4104&lt;/a> æ·»åŠ äº†å¯¹ &lt;code>NOTIFY_SOCKET&lt;/code> çš„æ”¯æŒï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/containerd/containerd/pull/4150">containerd/containerd#4150&lt;/a> ä¿®æ­£äº† FIFO çš„æ¸…ç†é€»è¾‘ï¼›&lt;/li>
&lt;/ul>
&lt;p>è¿™ä¸ªå˜æ›´æ˜¯ä¸ºäº†ä¿®æ­£æ—©å…ˆå¼•å…¥çš„ä¸€æ®µå¯¹ FIFO çš„æ¸…ç†é€»è¾‘ï¼Œå†æ­¤æ¬¡ä¿®æ­£ä¹‹å‰ï¼Œå¦‚æœå°† stdin/stdout/stderr ç­‰ä½¿ç”¨ /dev/null åˆ é™¤ï¼Œåˆ™åœ¨ä»»åŠ¡å…³é—­æ—¶ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ¸…ç©º &lt;code>/dev&lt;/code> ç›®å½•ï¼Œè¿™å°±éå¸¸å±é™©äº†ã€‚&lt;/p>
&lt;p>å…³äºæ­¤ç‰ˆæœ¬çš„å…¶ä»–å˜æ›´ï¼Œå¯å‚è€ƒå…¶ &lt;a href="https://github.com/containerd/containerd/releases/tag/v1.3.4">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="helm-v2166-å’Œ-v320-rc1-å‘å¸ƒ">Helm v2.16.6 å’Œ v3.2.0-rc.1 å‘å¸ƒ&lt;/h2>
&lt;p>è¿™æ˜¯ Helm v2 çš„ä¸€ä¸ª bugfix ç‰ˆæœ¬ï¼Œä¿®æ­£äº†ä¸€å¤„ç©ºæŒ‡é’ˆçš„é”™è¯¯ &lt;a href="https://github.com/helm/helm/issues/7812">#7812&lt;/a> ï¼Œå¦‚æœè¿˜æœ‰å°ä¼™ä¼´æœªå‡çº§ä½¿ç”¨ Helm v3 ï¼Œè¿˜æ˜¯ä½¿ç”¨ Helm v2 çš„è¯ï¼Œå¯ä»¥è€ƒè™‘å‡çº§è‡³æ­¤ç‰ˆæœ¬ã€‚&lt;/p>
&lt;p>Helm v3 åœ¨æœ¬å‘¨ä¹Ÿå‘å¸ƒäº† v3.2.0-rc.1 ç‰ˆæœ¬ï¼Œæ­¤ç‰ˆæœ¬ä¸­æœ‰å¾ˆå¤šå€¼å¾—æ³¨æ„çš„å†…å®¹ï¼Œæˆ‘æ­¤å¤„åªè¯´ä¸€ä¸ªï¼Œå…¶ä»–çš„å˜æ›´ç­‰æ­£å¼ç‰ˆå‘å¸ƒåå†åšä»‹ç»ã€‚&lt;/p>
&lt;p>&lt;a href="https://github.com/helm/helm/pull/7635">#7635&lt;/a> ä¸º Helm v3 æ·»åŠ  SQL å­˜å‚¨é©±åŠ¨çš„æ”¯æŒã€‚&lt;/p>
&lt;p>ä½ å¯ä»¥é€šè¿‡ &lt;code>HELM_DRIVER&lt;/code> å’Œ &lt;code>HELM_DRIVER_SQL_CONNECTION_STRING&lt;/code> å˜é‡è¿›è¡Œæ•°æ®åº“è¿æ¥çš„é…ç½®ã€‚&lt;/p>
&lt;p>ä¸å°±å v3.2 å°±ä¼šæ­£å¸¸å‘å¸ƒäº†ï¼Œå±Šæ—¶å¯ä»¥å…ˆä½“éªŒçœ‹çœ‹ã€‚&lt;/p>
&lt;h2 id="kubernetes-å¤šä¸ªç‰ˆæœ¬ç›¸ç»§å‘å¸ƒ">Kubernetes å¤šä¸ªç‰ˆæœ¬ç›¸ç»§å‘å¸ƒ&lt;/h2>
&lt;p>æœ¬å‘¨ Kubernetes v1.16.9ï¼Œv1.17.5 å’Œ v1.18.2 ç­‰ç‰ˆæœ¬ç›¸ç»§å‘å¸ƒã€‚&lt;/p>
&lt;p>å¯¹äº v1.18.2 è€Œè¨€ï¼Œæ¯”è¾ƒå€¼å¾—æ³¨æ„çš„æ˜¯ï¼š &lt;a href="https://github.com/kubernetes/kubernetes/pull/89908">#89908&lt;/a> ä¿®å¤äº†ä¸€ä¸ªåœ¨èŠ‚ç‚¹åˆ é™¤åï¼Œå½“åˆ é™¤åœ¨å…¶ä¸Šéƒ¨ç½²çš„ Pod è§¦å‘è°ƒåº¦æ—¶ï¼Œå¯èƒ½å¯¼è‡´ Kubernetes crash çš„é—®é¢˜ï¼›ï¼ˆä¸»è¦æ˜¯å› ä¸ºå®ƒçš„ç¼“å­˜ï¼‰&lt;/p>
&lt;p>åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¾ˆå°‘ä¼šåœ¨åˆ é™¤ Node åï¼Œå†è§¦å‘ç›¸å…³çš„è°ƒåº¦ï¼Œè¿™ä¸ªé—®é¢˜å¯èƒ½ä¸å¤ªå®¹æ˜“é‡åˆ°ã€‚&lt;/p>
&lt;h2 id="ä¸Šæ¸¸è¿›å±•">ä¸Šæ¸¸è¿›å±•&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/pull/89666">#89666&lt;/a> &lt;code>kubectl scale&lt;/code> ç°åœ¨æ”¯æŒä½¿ç”¨å‚æ•° &lt;code>--dry-run=server|client&lt;/code> äº†ï¼&lt;/li>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/pull/89551">#89551&lt;/a> æ¢å¤äº† &lt;code>kubectl apply --prune&lt;/code> ä¸æŒ‡å®š namespace æ—¶çš„èƒ½åŠ›ï¼›&lt;/li>
&lt;/ul>
&lt;h2 id="æ¨èé˜…è¯»">æ¨èé˜…è¯»&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://kubernetes.io/blog/2020/04/16/monitoring-kubernetes-sidecar-pattern/">https://kubernetes.io/blog/2020/04/16/monitoring-kubernetes-sidecar-pattern/&lt;/a> ä»‹ç»äº†ä½¿ç”¨ Sidecar æ¥ç›‘æ§ Kubernetes ä¸­éƒ¨ç½²çš„ä¸šåŠ¡ã€‚&lt;/li>
&lt;/ul>
&lt;hr>
&lt;p>æ¬¢è¿è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| Docker å¼€æº Compose è§„èŒƒ</title><link>https://moelove.info/2020/04/12/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Docker-%E5%BC%80%E6%BA%90-Compose-%E8%A7%84%E8%8C%83/</link><guid isPermaLink="true">https://moelove.info/2020/04/12/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Docker-%E5%BC%80%E6%BA%90-Compose-%E8%A7%84%E8%8C%83/</guid><pubDate>Sun, 12 Apr 2020 22:01:37 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="docker-å¼€æº-compose-è§„èŒƒ-åŠ©åŠ›äº‘åŸç”Ÿåº”ç”¨å¼€å‘">Docker å¼€æº Compose è§„èŒƒ, åŠ©åŠ›äº‘åŸç”Ÿåº”ç”¨å¼€å‘&lt;/h2>
&lt;p>æœ¬å‘¨ Docker å®£å¸ƒå°† Compose è§„èŒƒå¼€æºï¼Œå¹¶ä½œä¸ºç‹¬ç«‹ç»„ç»‡è¿›è¡Œæ²»ç†ã€‚&lt;/p>
&lt;p>ç”±äº Compose å¯ä»¥ç®€å•çš„å®šä¹‰åŸºäºå¤šå®¹å™¨çš„åº”ç”¨ç¨‹åºå †æ ˆçš„å·¥ä½œæ–¹å¼ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡ä¸€æ¡å‘½ä»¤å¯åŠ¨åº”ç”¨ç¨‹åºï¼Œè€Œä¸éœ€è¦æ‰‹åŠ¨æ„å»ºé•œåƒå’Œé€ä¸ªå¯åŠ¨å®¹å™¨ï¼Œè¿™å¯ä»¥å¤§å¤§èŠ‚çœå¼€å‘å›¢é˜Ÿçš„æ—¶é—´ã€‚&lt;/p>
&lt;p>å½“å‰ Compose å·²ç»è¢«æ•°ç™¾ä¸‡å¼€å‘äººå‘˜ä½¿ç”¨ï¼Œåœ¨ GitHub ä¸Šæœ‰è¶…è¿‡ 650,000 ä¸ª Compose é…ç½®æ–‡ä»¶ã€‚&lt;/p>
&lt;p>Docker ä¹Ÿåœ¨ GitHub ä¸Šåˆ›å»ºäº†ä¸€ä¸ª &lt;a href="https://github.com/docker/awesome-compose">awesome-compose&lt;/a> çš„ä»“åº“ï¼Œå…¶ä¸­åŒ…å«äº† Compose åœ¨å¤šç§åº”ç”¨åœºæ™¯ä¸‹çš„ä½¿ç”¨ç¤ºä¾‹ã€‚&lt;/p>
&lt;p>æœ¬æ¬¡å¼€æº Compose è§„èŒƒï¼Œæ—¨åœ¨èƒ½åˆ©ç”¨å¼€æºç¤¾åŒºçš„åŠ›é‡ï¼Œå¹¶ä¸å¾®è½¯ç­‰åˆä½œä¼™ä¼´ï¼Œå…±åŒè¿›è¡Œåä½œåˆ›æ–°ï¼Œä¸º Compose è§„èŒƒæä¾›æ›´å¤šæ´»åŠ›ï¼Œå¹¶ä»¥æ­¤å¸®åŠ©å»ºç«‹ä»æ¡Œé¢åˆ°äº‘æ„å»ºå’Œéƒ¨ç½²å®¹å™¨åº”ç”¨ç¨‹åºé€šç”¨å¼€æ”¾æ ‡å‡†ã€‚&lt;/p>
&lt;p>å¦å¤–ï¼ŒCompose è§„èŒƒè®¡åˆ’æ˜¯æåŠ©ç»™ä¸­ç«‹çš„åŸºé‡‘ä¼šï¼Œæˆ‘ä¸ªäººè®¤ä¸ºå¤§æ¦‚ç‡æ˜¯æç»™ CNCF äº†ï¼ˆç›®å‰æ²¡çœ‹åˆ°æ­£å¼æ¶ˆæ¯ï¼‰ã€‚æ‰©å±•åçš„ Compose è§„èŒƒå¿…å°†ä¼šå¤§å¤§æå‡å¼€å‘è€…ä½“éªŒã€‚&lt;/p>
&lt;p>åŒæ—¶ï¼Œç¤¾åŒºåœ¨è®¡åˆ’ä½¿ç”¨ Go å¯¹ docker-compose å·¥å…·è¿›è¡Œé‡å†™ï¼ˆæˆ–è€…æ˜¯é‡æ–°å®ç° Compose è§„èŒƒï¼‰ï¼Œæ•´ä½“è€Œè¨€ä¹Ÿæ˜¯å¥½äº‹å„¿ï¼Œå€¼å¾—å…³æ³¨ã€‚&lt;/p>
&lt;p>è¯¦æƒ…å¯æŸ¥çœ‹ï¼šhttp://www.compose-spec.io/&lt;/p>
&lt;h2 id="smi-æ­£å¼åŠ å…¥-cncf">SMI æ­£å¼åŠ å…¥ CNCF&lt;/h2>
&lt;p>SMIï¼ˆService Mesh Interfaceï¼‰äºæœ¬å‘¨æ­£å¼åŠ å…¥ CNCF ï¼Œæˆä¸ºå…¶ sandbox çº§åˆ«çš„é¡¹ç›®ã€‚&lt;/p>
&lt;p>æˆ‘åœ¨å»å¹´ 5 æœˆä»½çš„ &lt;a href="https://zhuanlan.zhihu.com/p/67079625">K8S ç”Ÿæ€å‘¨æŠ¥| 2019-05-20~2019-05-26&lt;/a> ä¸­æ›¾ä»‹ç»è¿‡å¾®è½¯å®£å¸ƒæ¨å‡ºçš„ SMIï¼Œæœ¬è´¨æ˜¯ä¸ºäº†èƒ½ä¸ºæœåŠ¡ç½‘æ ¼æä¾›é€šç”¨æ¥å£ï¼Œä»¥ä¾¿èƒ½è®© Service Mesh æœ‰æ›´åŠ é€šç”¨çš„è§„èŒƒ ï¼ˆå°±åƒå½“åˆ CNI/CRI é‚£æ ·å­ï¼‰ã€‚&lt;/p>
&lt;p>ç»è¿‡äº†å°†è¿‘ä¸€å¹´æ—¶é—´çš„å‘å±•ï¼ŒSMI çš„ç¤¾åŒºæœ‰äº†æ˜¾è‘—çš„å‘å±•ï¼Œå½“å‰ç¤¾åŒºåˆ—å‡ºçš„ç”Ÿæ€ä¿¡æ¯å¦‚ä¸‹ï¼š&lt;/p>
&lt;ul>
&lt;li>Consul Connect*: service segmentation (consul.io/docs/connect)&lt;/li>
&lt;li>Flagger: progressive delivery operator (flagger.app)&lt;/li>
&lt;li>Istio*: connect, secure, control, observe (servicemeshinterface/smi-adapter-istio)&lt;/li>
&lt;li>Linkerd: ultralight service mesh (linkerd.io)&lt;/li>
&lt;li>Maesh: simpler service mesh (mae.sh)&lt;/li>
&lt;li>Meshery: the service mesh management plane (layer5.io/meshery)&lt;/li>
&lt;li>Rio: application deployment engine (rio.io)&lt;/li>
&lt;li>Service Mesh Hub: unified dashboard (solo.io/products/service-mesh-hub)&lt;/li>
&lt;/ul>
&lt;p>æˆ‘å°è±¡ä¸­æœ€æ—©è·Ÿè¿› SMI çš„å¤§æ¦‚æ˜¯ 19 å¹´ 6 æœˆä»½ Linkerd å¢åŠ äº†å¯¹ SMI çš„æ”¯æŒã€‚&lt;/p>
&lt;p>ä¸è¿‡ä¹Ÿå¯ä»¥çœ‹åˆ°ï¼Œå¯¹äº Istio è€Œè¨€ï¼Œæ˜¯ç¤¾åŒºæä¾›äº†ä¸€ä¸ªå¯¹ Istio çš„é€‚é…ï¼ˆè¿™é‡Œå°±ä¸å±•å¼€äº†ï¼‰ã€‚&lt;/p>
&lt;p>è¯¦æƒ…å¯æŸ¥çœ‹ï¼šhttps://smi-spec.io/blog/smi-joins-cncf/&lt;/p>
&lt;h2 id="kubernetes-v1181-å‘å¸ƒ">Kubernetes v1.18.1 å‘å¸ƒ&lt;/h2>
&lt;p>Kubernetes v1.18.1 å‘å¸ƒï¼Œå¸¦æ¥äº†ä¸€äº› bugfixï¼Œè¿™é‡Œä¸»è¦å°±ä»‹ç»ä¸€ä¸ªå…³äºä½¿ç”¨ kubeadm å‡çº§çš„é—®é¢˜ã€‚&lt;/p>
&lt;p>&lt;a href="https://github.com/kubernetes/kubernetes/pull/89537">#89537&lt;/a> ä¿®å¤äº†åœ¨ä½¿ç”¨ kubeadm ä» v1.17 å‡çº§è‡³ v1.18 æ—¶ï¼Œnode æ— æ³•åŠ å…¥é›†ç¾¤çš„é—®é¢˜ã€‚ä¸»è¦æ˜¯å› ä¸ºä¹‹å‰åœ¨ node åŠ å…¥é›†ç¾¤æ—¶ï¼Œå¢åŠ äº†å¯¹æ˜¯å¦æœ‰åŒåèŠ‚ç‚¹å­˜åœ¨çš„æ£€æŸ¥ã€‚è€Œ kubeadm ä¸­æ¼æ‰äº†ç›¸åº”çš„ RBAC è§„åˆ™ã€‚&lt;/p>
&lt;p>ä¿®æ­£ä»£ç å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="c1">// Create RBAC rules that makes the bootstrap tokens able to get nodes
&lt;/span>&lt;span class="c1">&lt;/span>&lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">nodebootstraptoken&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">AllowBoostrapTokensToGetNodes&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">client&lt;/span>&lt;span class="p">);&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">errs&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nb">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">errs&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="ä¸Šæ¸¸è¿›å±•">ä¸Šæ¸¸è¿›å±•&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/pull/89151">#89151&lt;/a> æ–°å¢äº†ä¸€ä¸ª &lt;code>etcd_db_total_size_in_bytes&lt;/code> çš„ metric ï¼Œå¯ç”¨äºæš´éœ² etcd æ–‡ä»¶å¤§å°ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/pull/89848">#89848&lt;/a> &lt;code>kubectl apply&lt;/code> å³ä½¿ build å¼‚å¸¸ï¼Œä¹Ÿä¼šåº”ç”¨å…¶ä»–å·²éªŒè¯èµ„æºã€‚&lt;/li>
&lt;/ul>
&lt;hr>
&lt;p>æ¬¢è¿è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| NGINX Ingress Controller æ–°ç‰ˆæœ¬å‘å¸ƒ</title><link>https://moelove.info/2020/04/05/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-NGINX-Ingress-Controller-%E6%96%B0%E7%89%88%E6%9C%AC%E5%8F%91%E5%B8%83/</link><guid isPermaLink="true">https://moelove.info/2020/04/05/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-NGINX-Ingress-Controller-%E6%96%B0%E7%89%88%E6%9C%AC%E5%8F%91%E5%B8%83/</guid><pubDate>Sun, 05 Apr 2020 20:59:26 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="nginx-ingress-controller-170-rc1-å‘å¸ƒ">NGINX Ingress Controller 1.7.0-rc1 å‘å¸ƒ&lt;/h2>
&lt;p>NGINX Ingress Controller æœ¬æ¬¡å‘å¸ƒçš„ 1.7.0-rc1 æœ‰ä¸€äº›æ¯”è¾ƒå€¼å¾—æ³¨æ„çš„æ›´æ–°ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://github.com/nginxinc/kubernetes-ingress/pull/827">#827&lt;/a> ä¸ºå…¶æš´éœ²å‡ºçš„æ‰€æœ‰ metrics æ·»åŠ äº†ä¸€ä¸ª class æ ‡ç­¾ã€‚&lt;/li>
&lt;/ul>
&lt;p>æ¯”å¦‚å¦‚æœåŸå…ˆçš„ metrics æ˜¯ &lt;code>nginx_ingress_controller_ingress_resources_total{type=&amp;quot;regular&amp;quot;} 1&lt;/code> é‚£ä¹ˆç°åœ¨å°†å˜æˆ &lt;code>nginx_ingress_controller_ingress_resources_total{class=&amp;quot;nginx&amp;quot;,type=&amp;quot;regular&amp;quot;} 1&lt;/code> ã€‚è¿™ä¸ªæ ‡ç­¾çš„å€¼ï¼Œå¯ä»¥é€šè¿‡ &lt;code>-ingress-class&lt;/code> è¿›è¡Œè®¾ç½®ã€‚&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://github.com/nginxinc/kubernetes-ingress/pull/852">#852&lt;/a> åœ¨ configmap ä¸­å¢åŠ äº†ä¸€ä¸ª &lt;code>default-server-access-log-off&lt;/code> çš„é…ç½®é¡¹ï¼Œç”¨äºé…ç½®æ˜¯å¦å…³é—­é»˜è®¤ server çš„ access log ã€‚&lt;/li>
&lt;li>&lt;a href="https://github.com/nginxinc/kubernetes-ingress/pull/902">#902&lt;/a> æ·»åŠ äº†ä¸¤ä¸ªæ–°çš„èµ„æº &lt;code>TransportServer&lt;/code> å’Œ &lt;code>GlobalConfiguration&lt;/code>ï¼Œç”¨æ¥æ”¯æŒ TCP/UDP å’Œ TLS çš„è´Ÿè½½å‡è¡¡ã€‚&lt;/li>
&lt;/ul>
&lt;p>æ­¤ç‰ˆæœ¬çš„å˜æ›´æ•´ä½“è€Œè¨€æ˜¯æ¯”è¾ƒå¤šçš„ï¼Œå…¶ä½™å˜æ›´è¯·å‚è€ƒå…¶ &lt;a href="https://github.com/nginxinc/kubernetes-ingress/blob/v1.7.0-rc1/CHANGELOG.md#170---release-candidate-1">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="rook-v127-å‘å¸ƒ">rook v1.2.7 å‘å¸ƒ&lt;/h2>
&lt;p>æœ¬æ¬¡ rook çš„ v1.2.7 ç‰ˆæœ¬ï¼Œä»ç„¶æ˜¯ä¸ª bugfix ç‰ˆæœ¬ï¼Œå…¶ä¸­åŒ…å«å¤šé¡¹æ”¹è¿›ï¼Œè¿™é‡Œè¯´ä¸¤ä¸ªå€¼å¾—æ³¨æ„çš„å†…å®¹ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://github.com/rook/rook/pull/5089">#5089&lt;/a> è¿™ä¸ª PR çš„ç›®çš„æ˜¯å½“é…ç½®ç£ç›˜è®¾å¤‡ä½œä¸º OSD æ—¶ï¼Œå¦‚æœè¯¥ç£ç›˜/åˆ†åŒºçš„å®¹é‡å°äº 5 G åˆ™ä¼šè¢«ç›´æ¥æ‹’ç»ã€‚æœ€ç›´æ¥çš„å½±å“å°±æ˜¯ï¼Œå¦‚æœæœ‰äººåˆ†åŒºä¸åˆç†/åˆ†åŒºå®¹é‡è¿‡å°ï¼Œé‚£ä¾¿æ— æ³•ä½œä¸º OSD äº†ï¼ˆåªä¸è¿‡ç›®å‰é€‰æ‹©çš„æ˜¯ 5 Gï¼Œå¹¶ä¸ä¿è¯ä¹‹åä¸ä¼šå‘ç”Ÿæ”¹å˜ï¼‰ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/rook/rook/issues/5022">#5022&lt;/a> æ·»åŠ äº†å¯¹æ–‡ä»¶ç³»ç»Ÿçš„é¢å¤–æ ¡éªŒï¼Œä»¥ä¾¿äºåœ¨ OSD çš„é…ç½®ä¸­ï¼Œå¯ä»¥è·³è¿‡ boot åˆ†åŒºï¼›&lt;/li>
&lt;/ul>
&lt;p>å…¶ä»–å˜æ›´ï¼Œè¯·å‚è€ƒå…¶ &lt;a href="https://github.com/rook/rook/releases/tag/v1.2.7">ReleaseNote&lt;/a>ã€‚ å¦å¤–ï¼Œ rook ç›®å‰æ­£åœ¨å‡†å¤‡ä» CNCF æ¯•ä¸šï¼Œæ•´ä½“è€Œè¨€ï¼Œå®ƒä¹Ÿåœ¨é€æ­¥å˜å¾—æ›´åŠ ç¨³å®šå’Œæ˜“ç”¨ã€‚&lt;/p>
&lt;h2 id="traefik-v220-æ­£å¼å‘å¸ƒ">Traefik v2.2.0 æ­£å¼å‘å¸ƒ&lt;/h2>
&lt;p>åœ¨ä¸Šä¸ªæœˆçš„ &lt;a href="https://zhuanlan.zhihu.com/p/111833886">ã€ŠK8S ç”Ÿæ€å‘¨æŠ¥| Docker v19.03.7 å‘å¸ƒã€‹&lt;/a> ä¸­ï¼Œæˆ‘æ›¾ä»‹ç»è¿‡ Traefik v2.2.0-rc1 æ›´æ–°çš„å†…å®¹ï¼Œåˆ°ç°åœ¨ v2.2.0 ç»ˆäºæ­£å¼å‘å¸ƒäº†ã€‚&lt;/p>
&lt;p>ç›¸æ¯”ä¸ v2.2.0-rc1 æ—¶ï¼Œæ­£å¼ç‰ˆä¸­æ²¡æœ‰å¤ªå¤šå˜æ›´ï¼Œåªæœ‰ä¸€äº›å°çš„ä¿®å¤ï¼Œæ¯”å¦‚ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://github.com/containous/traefik/pull/6504">#6504&lt;/a> ä¿®å¤äº† Ingress TLS çš„æ”¯æŒï¼Œç°åœ¨å¯ä»¥é€šè¿‡ &lt;code>traefik.ingress.kubernetes.io/router.tls: &amp;quot;true&amp;quot;&lt;/code> çš„ annotation è¿›è¡Œå¯ç”¨äº†ã€‚&lt;/li>
&lt;/ul>
&lt;p>å…¶ä»–é‡è¦å†…å®¹ï¼Œæˆ‘åœ¨ä¹‹å‰çš„æ–‡ç« ä¸­å°±å·²ç»åŸºæœ¬ä»‹ç»è¿‡äº†ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥æŸ¥çœ‹ä¹‹å‰çš„æ–‡ç« ï¼Œæˆ–å‚è€ƒè¯¥é¡¹ç›®çš„ [ReleaseNote]https://github.com/containous/traefik/releases/tag/v2.2.0()&lt;/p>
&lt;h2 id="ä¸Šæ¸¸è¿›å±•">ä¸Šæ¸¸è¿›å±•&lt;/h2>
&lt;p>æœ€è¿‘åœ¨ Kubernetes é¡¹ç›®ä¸­ï¼Œæ¯”è¾ƒé‡å¤§çš„ä¸€ä¸ªå˜æ›´å°±æ˜¯ kubelet å¯¹ cgroupv2 çš„æ”¯æŒäº†ã€‚&lt;a href="https://github.com/kubernetes/kubernetes/pull/85218">#85218&lt;/a>&lt;/p>
&lt;p>è¿™ä¸ª PR ä»å»å¹´ 11 æœˆå¼€å§‹ï¼Œç›´åˆ°æœ€è¿‘æ‰åˆšè¢«åˆå¹¶è¿›å»ã€‚è¿™ä¸ª PR çš„åˆå¹¶ï¼Œå¯¹ cgroupv2 çš„æ¨è¿›éå¸¸é‡è¦ã€‚æˆªè‡³ç›®å‰ï¼ŒDockerï¼Œcontainerdï¼Œrunc ç­‰éƒ½å·²ç»ç›¸ç»§å¢åŠ äº†å¯¹ cgroupv2 çš„æ”¯æŒã€‚æˆ‘é¢„è®¡ cgroupv2 ä»£æ›¿ v1 è‡³å°‘è¿˜éœ€è¦ä¸¤ä¸‰å¹´çš„æ—¶é—´ã€‚ä½†æ•´ä½“è€Œè¨€ï¼Œæ˜¯åœ¨é€æ­¥å‘å‰æ¨è¿›çš„ã€‚&lt;/p>
&lt;p>è¿˜æœ‰ä¸€ä¸ªéœ€è¦æ³¨æ„çš„æ˜¯ &lt;a href="https://github.com/kubernetes/kubernetes/pull/89401">#89401&lt;/a> ä¿®å¤äº† &lt;code>kubectl port-forward&lt;/code> æ—¶ï¼Œå¿½ç•¥åˆ°äº†æœ¬åœ° port çš„é—®é¢˜ï¼ˆå—å½±å“ç‰ˆæœ¬æ˜¯ v1.18+ï¼‰&lt;/p>
&lt;h2 id="é¡¹ç›®æ¨è">é¡¹ç›®æ¨è&lt;/h2>
&lt;p>&lt;a href="https://github.com/kubenav/kubenav">kubenav&lt;/a> æ˜¯ä¸€ä¸ªåŒ…å«æ¡Œé¢ç‰ˆå’Œæ‰‹æœºç‰ˆçš„åº”ç”¨ç¨‹åºï¼Œå¯ä»¥å¸®åŠ©ä½ æ¥ç®¡ç† Kubernetes é›†ç¾¤ã€‚&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/kubenav/kubenav/master/utils/assets/github-screenshot.png" alt="kubenav - https://moelove.info">&lt;/p>
&lt;hr>
&lt;p>æ¬¢è¿è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| K8S ç§»é™¤å¯¹ basic auth çš„æ”¯æŒ</title><link>https://moelove.info/2020/03/29/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-K8S-%E7%A7%BB%E9%99%A4%E5%AF%B9-basic-auth-%E7%9A%84%E6%94%AF%E6%8C%81/</link><guid isPermaLink="true">https://moelove.info/2020/03/29/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-K8S-%E7%A7%BB%E9%99%A4%E5%AF%B9-basic-auth-%E7%9A%84%E6%94%AF%E6%8C%81/</guid><pubDate>Sun, 29 Mar 2020 21:26:45 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="helm-v2165-å‘å¸ƒ">Helm v2.16.5 å‘å¸ƒ&lt;/h2>
&lt;p>é‰´äºè¿˜æœ‰ä¸å°‘äººå°šæœªå‡çº§è‡³ Helm v3ï¼Œè™½ç„¶ Helm v2 ç›®å‰åœ¨ç»´æŠ¤æœŸï¼Œä½†ä»ç„¶åœ¨é¢‘ç¹åœ¨å‘å¸ƒç‰ˆæœ¬ã€‚&lt;/p>
&lt;p>æœ¬å‘¨ Helm v2 ç›¸ç»§å‘å¸ƒäº† v2.16.5 å’Œ v2.16.4ï¼Œ &lt;strong>å¦‚æœæ‰“ç®—å‡çº§çš„è¯ï¼Œå»ºè®®ç›´æ¥å‡çº§è‡³ v2.16.5&lt;/strong> ã€‚&lt;/p>
&lt;p>å› ä¸º v2.16.4 ç‰ˆæœ¬ä¸­åœ¨ &lt;code>Validate()&lt;/code> ä¸­è¯¯æ·»åŠ äº†ä¸€ä¸ª &lt;code>Latest()&lt;/code> ï¼Œä¼šå¯¼è‡´åœ¨å®‰è£…æˆ–å‡çº§ Release æ—¶ï¼Œå‡ºç°èµ„æºæ‰¾ä¸åˆ°çš„é”™è¯¯ã€‚&lt;/p>
&lt;p>ä¾‹å¦‚ï¼š&lt;/p>
&lt;pre>&lt;code>Release &amp;quot;moelove-release&amp;quot; does not exist. Installing it now.
Error: namespaces &amp;quot;moelove-namespace&amp;quot; not found
&lt;/code>&lt;/pre>&lt;p>æ›´å¤šè¯¦æƒ…è¯·å‚è€ƒå…¶ &lt;a href="https://github.com/helm/helm/releases/tag/v2.16.5">ReleaseNote&lt;/a> ã€‚&lt;/p>
&lt;h2 id="kubernetes-v118-æ­£å¼å‘å¸ƒ">Kubernetes v1.18 æ­£å¼å‘å¸ƒ&lt;/h2>
&lt;p>è¿™æ˜¯ Kubernetes ä»Šå¹´ç¬¬ä¸€ä¸ªæ­£å¼å‘å¸ƒçš„ç‰ˆæœ¬ï¼Œv1.18 åŒ…å«äº† 38 ä¸ªå¢å¼ºåŠŸèƒ½ï¼Œå…¶ä¸­åŒ…å« 15 ä¸ª stable çŠ¶æ€çš„ï¼Œ11 ä¸ªåœ¨ beta ï¼Œæœ€åå‰©ä½™ 12 ä¸ªè¿˜æ˜¯ alpha é˜¶æ®µã€‚&lt;/p>
&lt;p>è¿™ä¸ªç‰ˆæœ¬åœ¨æ”¹å–„ç”¨æˆ·ä½“éªŒï¼Œä»¥åŠç¨³å®šæ€§æ–¹é¢åšäº†å¤§é‡çš„å·¥ä½œã€‚ è‡³äºå…·ä½“çš„å˜åŒ–ï¼Œè¯·å‚è€ƒæˆ‘ä¸Šå‘¨å‘å¸ƒçš„æ–‡ç«  &lt;a href="https://zhuanlan.zhihu.com/p/116177002">ã€ŠKubernetes v1.18 æ­£å¼å‘å¸ƒï¼æŠ¢å…ˆä¸€è§ˆã€‹&lt;/a> ã€‚&lt;/p>
&lt;p>å¯¹æ­¤ç‰ˆæœ¬æ„Ÿå…´è¶£çš„å°ä¼™ä¼´ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ Kind è¿›è¡Œå®‰è£…ä½“éªŒã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ ~ wget -q -O kind https://github.com/kubernetes-sigs/kind/releases/download/v0.7.0/kind-linux-amd64
&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ ~ chmod +x kind
&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ /tmp ./kind create cluster --image&lt;span class="o">=&lt;/span>kindest/node:v1.18.0@sha256:0e20578828edd939d25eb98496a685c76c98d54084932f76069f886ec315d694 --name&lt;span class="o">=&lt;/span>v1.18
Creating cluster &lt;span class="s2">&amp;#34;v1.18&amp;#34;&lt;/span> ...
âœ“ Ensuring node image &lt;span class="o">(&lt;/span>kindest/node:v1.18.0&lt;span class="o">)&lt;/span> ğŸ–¼
âœ“ Preparing nodes ğŸ“¦
âœ“ Writing configuration ğŸ“œ
âœ“ Starting control-plane ğŸ•¹ï¸
âœ“ Installing CNI ğŸ”Œ
âœ“ Installing StorageClass ğŸ’¾
Set kubectl context to &lt;span class="s2">&amp;#34;kind-v1.18&amp;#34;&lt;/span>
You can now use your cluster with:
kubectl cluster-info --context kind-v1.18
Not sure what to &lt;span class="k">do&lt;/span> next? ğŸ˜… Check out https://kind.sigs.k8s.io/docs/user/quick-start/
&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ ~ kubectl get nodes
NAME STATUS ROLES AGE VERSION
v1.18-control-plane Ready master 109s v1.18.0
&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ›´è¯¦ç»†å†…å®¹è¯·å‚è€ƒå…¶ &lt;a href="https://github.com/kubernetes/kubernetes/blob/master/CHANGELOG/CHANGELOG-1.18.md#whats-new-major-themes">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="coredns-v169-å‘å¸ƒ">CoreDNS v1.6.9 å‘å¸ƒ&lt;/h2>
&lt;p>CoreDNS å‘å¸ƒäº† v1.6.9 ç‰ˆæœ¬ï¼Œè¿™ä¸ªç‰ˆæœ¬çš„å‘å¸ƒä¸»è¦æ˜¯ç”±äºåœ¨å‘å¸ƒ v1.6.8 æ—¶ï¼Œè‡ªåŠ¨åŒ–å‘å¸ƒå·¥å…·é‡åˆ°äº†ç‚¹é—®é¢˜ã€‚å¦‚æœä½ ä»”ç»†å»çœ‹ ReleaseNote ä½ ä¼šå‘ç°ä¸¤ä¸ªç‰ˆæœ¬çš„ ReleaseNote åŸºæœ¬æ˜¯ä¸€æ ·çš„å†…å®¹ã€‚æœ¬æ¬¡å‘å¸ƒå…¶å®å°±æ˜¯ä¸ºäº†ä¿®æ­£è‡ªåŠ¨åŒ–å‘å¸ƒå·¥å…·ã€‚&lt;/p>
&lt;p>æ‰€ä»¥ï¼Œæˆ‘ä»¬ä¸€èµ·çœ‹çœ‹ CoreDNS v1.6.9 ï¼ˆæˆ–è€…è¯´ v1.6.8ï¼‰ ä¸­ï¼Œæœ‰å“ªäº›å€¼å¾—æ³¨æ„çš„å†…å®¹å§ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://github.com/coredns/coredns/pull/3640">#3640&lt;/a> plugins/forward: å¢åŠ äº†ä¸€ä¸ª &lt;code>max_concurrent&lt;/code> çš„é…ç½®é¡¹ï¼Œå¯é€šè¿‡è¿™ä¸ªé…ç½®é¡¹åšå¹¶å‘æ§åˆ¶ã€‚åŒæ—¶ä¹Ÿåœ¨ metrics ä¸­å¢åŠ äº† &lt;code>max_concurrent_reject_count_total{}&lt;/code> ç”¨äºç»Ÿè®¡ç”±äºè¾¾åˆ°æœ€å¤§å¹¶å‘é™åˆ¶è€Œè¢«æ‹’ç»çš„è¯·æ±‚ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/coredns/coredns/pull/3687">#3687&lt;/a> plugin/kubernetesï¼šåœ¨ PTR ç±»å‹çš„è¯·æ±‚ä¸­ï¼Œè¿”å›æŸ¥æ‰¾åˆ°çš„æ‰€æœ‰çš„ IP è€Œä¸æ˜¯åªè¿”å›ç¬¬ä¸€ä¸ªï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/coredns/coredns/pull/3643">#3643&lt;/a> plugin/forwardï¼šé€šè¿‡æ·»åŠ å¥åº·æ£€æŸ¥æ¥é¿å…åˆ›å»ºæ–°çš„ TLS è¿æ¥ã€‚å½“ forward æ£€æŸ¥åˆ°é”™è¯¯çš„æ—¶å€™ï¼Œå¥åº·æ£€æŸ¥å°†ä¼šåœ¨ä¸€ä¸ªå¾ªç¯ä¸­è¿è¡Œï¼Œåˆå§‹é—´éš”æ˜¯ 0.5sï¼Œä¹‹åä¼šæŒç»­å¢é•¿è‡³ 60sï¼ŒæŠ¥å‘Šä¸Šæ¸¸ä¸å¥åº·ã€‚å½“ä¸Šæ¸¸æ¢å¤å¥åº·æ—¶ï¼Œå¥åº·æ£€æŸ¥å°†ä¼šåœæ­¢ã€‚&lt;/li>
&lt;/ul>
&lt;h2 id="ä¸Šæ¸¸è¿›å±•">ä¸Šæ¸¸è¿›å±•&lt;/h2>
&lt;ul>
&lt;li>
&lt;p>&lt;a href="https://github.com/kubernetes/kubernetes/pull/89069">#89069&lt;/a> ç»ˆæ­¢å¯¹ basic authentication çš„æ”¯æŒï¼Œ&lt;code>--basic-auth-file&lt;/code> è¢«å½»åº•ç§»é™¤ï¼Œè¿™ä¸ªç‰¹æ€§å…¶å®åœ¨ v1.16 ä¸­å°±å·²ç»è¢«å¼ƒç”¨äº†ï¼Œå¦‚æœæœ‰ç”¨åˆ°è¯¥ç‰¹æ€§çš„æœ‹å‹ï¼Œè¯·å°½å¿«æ›´æ¢å…¶ä»–æ–¹å¼ã€‚å¦å¤–ï¼Œå¯¹ basic authentication çš„æ”¯æŒï¼Œå¤§æ¦‚æ˜¯ä» 2015 å¹´åŠ å…¥çš„ï¼Œè‡³ä»Šå°†è¿‘ 5 å¹´å·¦å³çš„æ—¶é—´ï¼Œä¹Ÿç®—æ˜¯å¾ˆè¾‰ç…Œäº†ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a href="https://github.com/kubernetes/kubernetes/issues/89377">#89377&lt;/a> CVE-2020-8551: Kubelet DoS via API å’Œ &lt;a href="https://github.com/kubernetes/kubernetes/issues/89378">#89378&lt;/a> CVE-2020-8552: apiserver DoS (oom) æ˜¯è¿‘æœŸçš„ä¸¤ä¸ªéå¸¸å€¼å¾—å…³æ³¨çš„æ¼æ´ã€‚å‡ ä¹æ˜¯æ‰€æœ‰ç‰ˆæœ¬å‡ä¼šæ”¶åˆ°æ¼æ´çš„å½±å“ï¼Œè¯·åŠæ—¶å°†å°ç‰ˆæœ¬æ›´æ–°è‡³ v1.17.3 ï¼Œv1.16.7 å’Œ v1.15.10 ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;hr>
&lt;p>æ¬¢è¿è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>Docker 7 å‘¨å¹´ï¼Œç”Ÿæ—¥å¿«ä¹ï¼</title><link>https://moelove.info/2020/03/26/Docker-7-%E5%91%A8%E5%B9%B4%E7%94%9F%E6%97%A5%E5%BF%AB%E4%B9%90/</link><guid isPermaLink="true">https://moelove.info/2020/03/26/Docker-7-%E5%91%A8%E5%B9%B4%E7%94%9F%E6%97%A5%E5%BF%AB%E4%B9%90/</guid><pubDate>Thu, 26 Mar 2020 22:32:31 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>Docker 7 å²å•¦ï¼æ–‡æœ«æœ‰æ´»åŠ¨é“¾æ¥~&lt;/p>
&lt;/blockquote>
&lt;p>2013 å¹´ Docker é¦–æ¬¡åœ¨ PyCon ä¸Šäº®ç›¸ï¼Œéšååœ¨ Hacker News ä¸Šå¼•èµ·äº†å¼ºçƒˆçš„åå“ã€‚ä¹‹ååœ¨ GitHub ä¸Šæ­£å¼å¼€æºï¼Œä»æ­¤æ­£å¼å¼€å¯äº† Docker çš„æ—¶ä»£ã€‚&lt;/p>
&lt;p>æ—¶è‡³ä»Šæ—¥ï¼Œæ— è®ºæˆ‘ä»¬åœ¨è°ˆè®ºå®¹å™¨ï¼ŒKubernetes æˆ–æ˜¯è¿™æ•´ä¸ªç”Ÿæ€ä¸­çš„å…¶ä»–äº§å“å’ŒæŠ€æœ¯ï¼Œä¸å¯é¿å…çš„éƒ½ä¼šç”¨åˆ°ä¸ Docker ç›¸å…³çš„çŸ¥è¯†ã€‚&lt;/p>
&lt;p>æ¯«ä¸å¤¸å¼ çš„è¯´ï¼ŒDocker æ”¹å˜äº†ä¸–ç•Œå¼€å‘éƒ¨ç½²åº”ç”¨ç¨‹åºçš„æ–¹å¼ï¼&lt;/p>
&lt;p>3 æœˆæ˜¯ Docker çš„ç”Ÿæ—¥æœˆï¼ŒæŒ‰ç…§ Docker ç¤¾åŒºçš„ä¼ ç»Ÿï¼Œåœ¨æœ¬æœˆä¼šä¸¾åŠä¸€æ¬¡æ´»åŠ¨æ¥åº†ç¥ Docker çš„ç”Ÿæ—¥ã€‚&lt;/p>
&lt;h2 id="æ´»åŠ¨ä¿¡æ¯">æ´»åŠ¨ä¿¡æ¯&lt;/h2>
&lt;p>&lt;strong>æœ¬æ¬¡çš„æ´»åŠ¨é€šè¿‡ 3 å°æ—¶çš„åœ¨çº¿ç›´æ’­æ¥å®Œæˆï¼Œå°†äºåŒ—äº¬æ—¶é—´ 3 æœˆ 27 æ—¥ 00:00 å¼€å§‹ã€‚&lt;/strong>&lt;/p>
&lt;p>&lt;strong>ç›´æ’­åœ°å€æ˜¯ï¼šhttps://youtu.be/3UZ0TUPP0ks&lt;/strong>&lt;/p>
&lt;h2 id="ç®€å•åˆ†äº«ç‚¹-docker-ç›®å‰çš„è¿›å±•">ç®€å•åˆ†äº«ç‚¹ Docker ç›®å‰çš„è¿›å±•&lt;/h2>
&lt;p>æˆ‘è‡ª Docker v0.9 ç‰ˆæœ¬å¼€å§‹äº†è‡ªå·±çš„ Docker ä¹‹è·¯ï¼Œå®ƒæ˜¯æˆ‘ä½¿ç”¨æœ€é¢‘ç¹çš„å·¥å…·ä¹‹ä¸€ã€‚&lt;/p>
&lt;p>é™¤äº†æ˜¯ Docker çš„é‡åº¦ç”¨æˆ·å¤–ï¼Œæˆ‘ä¹Ÿä¸€ç›´å‚ä¸ç€ Docker ç¤¾åŒºçš„ä¸Šæ¸¸è´¡çŒ®ã€‚ç›®å‰åœ¨ Docker çš„æ ¸å¿ƒä»“åº“è´¡çŒ®è€…æ’è¡Œæ¦œä¸­åœ¨ top90 ã€‚ï¼ˆå¾ˆæ—©ä»¥å‰æˆ‘ä¸€åº¦ä»¥ä¸ºè¿™ä¸ªæ’è¡Œæ¦œä¸ä¼šæ›´æ–° hhhï¼‰ï¼Œä»¥ä¸‹æ˜¯ Docker çš„æ ¸å¿ƒä¸Šæ¸¸ä»“åº“æœ¬æœˆçš„æ¦‚è§ˆï¼š&lt;/p>
&lt;p>&lt;img src="https://moelove.info/img/docker-march-overview.png" alt="Docker 3 æœˆä»½æ ¸å¿ƒä»“åº“æ¦‚è§ˆ - https://moelove.info">&lt;/p>
&lt;p>å¯ä»¥çœ‹åˆ°ç¤¾åŒºè¿˜æ˜¯å¾ˆæ´»è·ƒçš„ï¼Œè€Œä¸” Docker ç›®å‰å°†é‡ç‚¹æ”¾åœ¨æå‡å¼€å‘è€…ä½“éªŒä¸Šï¼Œä»Šå¹´ç›¸ç»§æ¨å‡ºäº† Docker Desktop æ–°ç‰ˆæœ¬ï¼Œ Docker é¦–ä¸ªå®˜æ–¹ GitHub Actionï¼Œ ä»¥åŠå¼€æºäº† &lt;a href="https://github.com/docker/awesome-compose">awesome-compose&lt;/a> æä¾›äº†ä¼—å¤šç²¾é€‰çš„ compose ç¤ºä¾‹ï¼Œå¸®åŠ©å¼€å‘è€…æ›´å¿«çš„éƒ¨ç½²å®¹å™¨åŒ–åº”ç”¨ã€‚&lt;/p>
&lt;h2 id="æ´»åŠ¨å†…å®¹">æ´»åŠ¨å†…å®¹&lt;/h2>
&lt;p>&lt;img src="https://moelove.info/img/docker-7th-event-info.png" alt="Docker æ´»åŠ¨ä¿¡æ¯ - https://moelove.info">&lt;/p>
&lt;p>&lt;img src="https://moelove.info/img/docker-7th-event-speakers.png" alt="Docker æ´»åŠ¨ speakers - https://moelove.info">&lt;/p>
&lt;p>æ„Ÿå…´è¶£çš„è¯ï¼Œæ¬¢è¿æ¥å‚åŠ æ´»åŠ¨ï¼å¯åœ¨çº¿äº’åŠ¨å“¦~&lt;/p>
&lt;p>&lt;strong>æœ¬æ¬¡çš„æ´»åŠ¨é€šè¿‡ 3 å°æ—¶çš„åœ¨çº¿ç›´æ’­æ¥å®Œæˆï¼Œå°†äºåŒ—äº¬æ—¶é—´ 3 æœˆ 27 æ—¥ 00:00 å¼€å§‹ã€‚&lt;/strong>&lt;/p>
&lt;p>&lt;strong>ç›´æ’­åœ°å€æ˜¯ï¼šhttps://youtu.be/3UZ0TUPP0ks&lt;/strong>&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Docker/">Docker</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category><category domain="https://moelove.info/tags/Linux/">Linux</category></item><item><title>Kubernetes v1.18 æ­£å¼å‘å¸ƒï¼æŠ¢å…ˆä¸€è§ˆ</title><link>https://moelove.info/2020/03/25/Kubernetes-v1.18-%E6%AD%A3%E5%BC%8F%E5%8F%91%E5%B8%83%E6%8A%A2%E5%85%88%E4%B8%80%E8%A7%88/</link><guid isPermaLink="true">https://moelove.info/2020/03/25/Kubernetes-v1.18-%E6%AD%A3%E5%BC%8F%E5%8F%91%E5%B8%83%E6%8A%A2%E5%85%88%E4%B8%80%E8%A7%88/</guid><pubDate>Wed, 25 Mar 2020 00:11:28 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>æŒç»­å…³æ³¨ &lt;a href="https://zhuanlan.zhihu.com/container">ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€&lt;/a>çš„å°ä¼™ä¼´ä»¬ï¼Œåœ¨æ¯å‘¨çš„ä¸Šæ¸¸è¿›å±•ä¸­ï¼Œåº”è¯¥å·²ç»äº†è§£åˆ°äº†å¤§å¤šæ•°æ–°çš„ç‰¹æ€§å’Œä¿®å¤ï¼Œè¿™é‡Œæ¥ä¸€å¹¶æ€»ç»“ä¸‹ã€‚&lt;/p>
&lt;/blockquote>
&lt;p>Kubernetes å³å°†å‘å¸ƒï¼Œæˆªè‡³å‘æ–‡æ—¶ï¼Œv1.18.0 å°šæœªæ­£å¼ Release ã€‚ä¸è¿‡å·²ç»åœ¨è¿›è¡Œä¸­äº†ï¼Œ
è®©æˆ‘ä»¬æŠ¢å…ˆçœ‹çœ‹ Kubernetes v1.18 ä¸ºæˆ‘ä»¬å¸¦æ¥äº†å“ªäº›æ–°å†…å®¹å§ï¼&lt;/p>
&lt;p>v1.18 ä¸­çš„ä¸»è¦å˜æ›´é›†ä¸­åœ¨ &lt;code>deprecations&lt;/code>, &lt;code>metrics&lt;/code> , &lt;code>kubectl&lt;/code> å’Œ &lt;code>node&lt;/code> æ–¹é¢ã€‚æˆ‘ä»¬é€ä¸ªæ¥çœ‹çœ‹ï¼š&lt;/p>
&lt;h2 id="kubectl-ç›¸å…³å˜æ›´">kubectl ç›¸å…³å˜æ›´&lt;/h2>
&lt;p>å¼•ç”¨æˆ‘åœ¨&lt;a href="https://zhuanlan.zhihu.com/p/113449314">K8S ç”Ÿæ€å‘¨æŠ¥| Helm v3.1.2 å‘å¸ƒ&lt;/a>ä¸­çš„ä»‹ç»ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/pull/88004">#88004&lt;/a> æ­£å¼æ·»åŠ äº† &lt;code>kubectl alpha debug&lt;/code> å‘½ä»¤ï¼Œå¯é€šè¿‡æ­¤å‘½ä»¤æ¥è°ƒè¯• Kubernetes ä¸­çš„èµ„æºï¼Œä¸è¿‡ä¹Ÿè¯·æ³¨æ„ï¼Œæ­¤å‘½ä»¤å°šåœ¨ alpha é˜¶æ®µï¼Œåç»­è¿˜ä¼šæœ‰å˜åŠ¨ã€‚&lt;/li>
&lt;/ul>
&lt;p>å¼•ç”¨æˆ‘åœ¨&lt;a href="https://zhuanlan.zhihu.com/p/108700105">K8S ç”Ÿæ€å‘¨æŠ¥| containerd v1.2.13 å‘å¸ƒ&lt;/a> ä¸­çš„ä»‹ç»ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/pull/87714">#87714&lt;/a> kubectl çš„ &lt;code>--server-dry-run&lt;/code> è¢«æ ‡è®°ä¸ºåºŸå¼ƒï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡ä½¿ç”¨ &lt;code>--dry-run=server&lt;/code> æ›¿ä»£ã€‚å¹¶ä¸” kubectl çš„ &lt;code>--dry-run&lt;/code> å‚æ•°æ¥æ”¶çš„å€¼ï¼Œä¹Ÿå˜æˆäº† &lt;code>client&lt;/code>, &lt;code>server&lt;/code> ä»¥åŠ &lt;code>none&lt;/code>ã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼š&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ ~ kubectl create deploy moelove --image&lt;span class="o">=&lt;/span>redis --dry-run&lt;span class="o">=&lt;/span>client
deployment.apps/moelove created &lt;span class="o">(&lt;/span>dry run&lt;span class="o">)&lt;/span>
&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ ~ kubectl create deploy moelove --image&lt;span class="o">=&lt;/span>redis --dry-run&lt;span class="o">=&lt;/span>server
deployment.apps/moelove created &lt;span class="o">(&lt;/span>server dry run&lt;span class="o">)&lt;/span>
&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ ~ kubectl create deploy moelove --image&lt;span class="o">=&lt;/span>redis --dry-run&lt;span class="o">=&lt;/span>none
deployment.apps/moelove created
&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ­¤å¤–ï¼Œkubectl è¿˜æœ‰äº›å…¶ä»–å€¼å¾—æ³¨æ„çš„å†…å®¹ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/pull/87776">#87776&lt;/a> å½“ä½ ä½¿ç”¨ &lt;code>kubectl delete --force&lt;/code> åˆ é™¤èµ„æºçš„æ—¶å€™ï¼Œä¸å†éœ€è¦æ·»åŠ  &lt;code>--grace-period=0&lt;/code> äº†ã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼š&lt;/li>
&lt;/ul>
&lt;p>åœ¨ v1.18 ä¸­:&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ ~ kubectl get pods
NAME READY STATUS RESTARTS AGE
redis-65d8df48cf-2rcqq 1/1 Running &lt;span class="m">0&lt;/span> 48s
&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ ~ kubectl delete pods redis-65d8df48cf-2rcqq --force
warning: Immediate deletion does not &lt;span class="nb">wait&lt;/span> &lt;span class="k">for&lt;/span> confirmation that the running resource has been terminated. The resource may &lt;span class="k">continue&lt;/span> to run on the cluster indefinitely.
pod &lt;span class="s2">&amp;#34;redis-65d8df48cf-2rcqq&amp;#34;&lt;/span> force deleted
&lt;/code>&lt;/pre>&lt;/div>&lt;p>åœ¨ v1.18 ä¹‹å‰:&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ ~ kubectl get pods
kNAME READY STATUS RESTARTS AGE
redis-65d8df48cf-qrd4h 1/1 Running &lt;span class="m">0&lt;/span> 53s
&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ ~ kubectl delete pods redis-65d8df48cf-qrd4h --force
warning: --force is ignored because --grace-period is not 0.
pod &lt;span class="s2">&amp;#34;redis-65d8df48cf-qrd4h&amp;#34;&lt;/span> deleted
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="ç›¸å…³åºŸå¼ƒ">ç›¸å…³åºŸå¼ƒ&lt;/h2>
&lt;h3 id="85903httpsgithubcomkuberneteskubernetespull85903-kube-apiserver">&lt;a href="https://github.com/kubernetes/kubernetes/pull/85903">#85903&lt;/a> kube-apiserver&lt;/h3>
&lt;ul>
&lt;li>æ‰€æœ‰èµ„æºçš„ API &lt;code>apps/v1beta1&lt;/code> å’Œ &lt;code>apps/v1beta2&lt;/code> éƒ½å°†åºŸå¼ƒï¼Œè¯·ä½¿ç”¨ &lt;code>apps/v1&lt;/code> ä»£æ›¿ï¼›&lt;/li>
&lt;li>&lt;code>daemonsets&lt;/code>, &lt;code>deployments&lt;/code>, &lt;code>replicasets&lt;/code> èµ„æºçš„ API &lt;code>extensions/v1beta1&lt;/code> å°†è¢«åºŸå¼ƒï¼Œè¯·ä½¿ç”¨ &lt;code>apps/v1&lt;/code> ä»£æ›¿;&lt;/li>
&lt;li>&lt;code>networkpolicies&lt;/code> èµ„æºçš„ API &lt;code>extensions/v1beta1&lt;/code> å°†è¢«åºŸå¼ƒï¼Œè¯·ä½¿ç”¨ &lt;code>networking.k8s.io/v1&lt;/code> ä»£æ›¿ï¼›&lt;/li>
&lt;li>&lt;code>podsecuritypolicies&lt;/code> èµ„æºçš„ API &lt;code>extensions/v1beta1&lt;/code> å°†è¢«åºŸå¼ƒï¼Œè¯·ä½¿ç”¨ &lt;code>policy/v1beta1&lt;/code> ä»£æ›¿ï¼›&lt;/li>
&lt;/ul>
&lt;h3 id="kubelet">kubelet&lt;/h3>
&lt;ul>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/pull/86282">#86282&lt;/a> kubelet çš„ &lt;code>/metrics/resource/v1alpha1&lt;/code> æ¥å£è¢«åºŸå¼ƒã€‚å…¶å®æ¯æ¬¡ç‰ˆæœ¬å‘å¸ƒï¼Œéƒ½ä¼šæœ‰å¾ˆå¤š metrics è¢«åºŸå¼ƒï¼Œv1.17 ä¹ŸåŒæ ·ã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="kube-proxy">kube-proxy&lt;/h3>
&lt;ul>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/pull/88512">#88512&lt;/a> &lt;code>--healthz-port&lt;/code> å’Œ &lt;code>--metrics-port&lt;/code> é€‰é¡¹è¢«åºŸå¼ƒï¼Œè¯·ä½¿ç”¨ &lt;code>--healthz-bind-address&lt;/code> å’Œ &lt;code>--metrics-bind-address&lt;/code> ä»£æ›¿ã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="kubeadm">kubeadm&lt;/h3>
&lt;p>å¼•ç”¨ &lt;a href="https://zhuanlan.zhihu.com/p/111833886">K8S ç”Ÿæ€å‘¨æŠ¥| Docker v19.03.7 å‘å¸ƒ&lt;/a> ä¸­çš„ä»‹ç»&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/pull/88827">#88827&lt;/a> kubeadm åºŸå¼ƒäº† &lt;code>kubeadm alpha certs renew&lt;/code> ä¸‹çš„ &lt;code>--use-api&lt;/code> å‚æ•°ï¼Œç›®å‰é¢„æœŸåœ¨ v1.19 å°†å…¶ç§»é™¤ï¼Œå¦‚æœ‰ç”¨åˆ°ç›¸å…³åŠŸèƒ½çš„ï¼Œè¯·æ³¨æ„ã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="kubectl">kubectl&lt;/h3>
&lt;p>å¼•ç”¨ &lt;a href="https://zhuanlan.zhihu.com/p/105974404">K8S ç”Ÿæ€å‘¨æŠ¥| Docker v19.03.6-rc2 å‘å¸ƒ&lt;/a> ä¸­çš„ä»‹ç»ï¼š&lt;/p>
&lt;p>&lt;strong>åœ¨ Kubernetes v1.18 ä¸­ï¼Œä¼šå°†ä¹‹å‰å·²æ ‡æ³¨è¿‡æœŸçš„å„ç±» generator éƒ½ç§»é™¤æ‰ã€‚&lt;/strong> ä¹Ÿå°±æ˜¯è¯´ï¼Œè‡ª v1.18 èµ·ä½¿ç”¨ &lt;code>kubectl run&lt;/code> å‘½ä»¤ä¸»è¦å°±æ˜¯åˆ›å»º Pod äº†ï¼Œè€Œä¸ä¼šåˆ›å»ºå¤šä½™çš„ deploy ä¹‹ç±»çš„ã€‚&lt;/p>
&lt;p>è‡³äºåƒ &lt;code>service&lt;/code> åŠ äº† &lt;code>--expose&lt;/code> å€’ä¹Ÿè¿˜å¯ä»¥åˆ›å»ºï¼Œåªä¸è¿‡ç±»ä¼¼ &lt;code>--service-generator&lt;/code> è¿™ç±»å‚æ•°å°±ä¹Ÿéƒ½æ ‡è®°åºŸå¼ƒäº†ã€‚&lt;/p>
&lt;p>v1.18 ä¹‹å‰ç‰ˆæœ¬çš„æ‰§è¡Œç»“æœæ˜¯è¿™æ ·ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ ~ kubectl run redis --image&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;redis:alpine&amp;#34;&lt;/span>
kubectl run --generator&lt;span class="o">=&lt;/span>deployment/apps.v1 is DEPRECATED and will be removed in a future version. Use kubectl run --generator&lt;span class="o">=&lt;/span>run-pod/v1 or kubectl create instead.
deployment.apps/redis created
&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ ~ kubectl get all -l &lt;span class="nv">run&lt;/span>&lt;span class="o">=&lt;/span>redis
NAME READY STATUS RESTARTS AGE
pod/redis-8544698fd7-tvz5q 1/1 Running &lt;span class="m">0&lt;/span> 14s
NAME READY UP-TO-DATE AVAILABLE AGE
deployment.apps/redis 1/1 &lt;span class="m">1&lt;/span> &lt;span class="m">1&lt;/span> 14s
NAME DESIRED CURRENT READY AGE
replicaset.apps/redis-8544698fd7 &lt;span class="m">1&lt;/span> &lt;span class="m">1&lt;/span> &lt;span class="m">1&lt;/span> 14s
&lt;/code>&lt;/pre>&lt;/div>&lt;p>v1.18 ç‰ˆæœ¬ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ bin ./kubectl run redis-new --image&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;redis:alpine&amp;#34;&lt;/span>
pod/redis-new created
&lt;span class="o">(&lt;/span>MoeLove&lt;span class="o">)&lt;/span> âœ bin ./kubectl get all -l &lt;span class="nv">run&lt;/span>&lt;span class="o">=&lt;/span>redis-new
NAME READY STATUS RESTARTS AGE
pod/redis-new 1/1 Running &lt;span class="m">0&lt;/span> 12s
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="æ€»ç»“">æ€»ç»“&lt;/h2>
&lt;p>ä»¥ä¸Šå†…å®¹æ˜¯æˆ‘è®¤ä¸ºåœ¨ Kubernetes v1.18 ä¸­æ¯”è¾ƒå€¼å¾—å…³æ³¨çš„éƒ¨åˆ†ã€‚å¾… v1.18.0 æ­£å¼å‘å¸ƒæ—¶ï¼Œå¯å†å‚è€ƒå®˜æ–¹çš„ &lt;a href="https://github.com/kubernetes/kubernetes/blob/master/CHANGELOG/CHANGELOG-1.18.md">ReleaseNote&lt;/a> è·å–æ›´åŠ è¯¦å°½çš„å†…å®¹ã€‚&lt;/p>
&lt;hr>
&lt;p>æ¬¢è¿é€šè¿‡ä¸‹é¢äºŒç»´ç è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| é¦–ä¸ª Docker å®˜æ–¹ Action å‘å¸ƒ</title><link>https://moelove.info/2020/03/22/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-%E9%A6%96%E4%B8%AA-Docker-%E5%AE%98%E6%96%B9-Action-%E5%8F%91%E5%B8%83/</link><guid isPermaLink="true">https://moelove.info/2020/03/22/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-%E9%A6%96%E4%B8%AA-Docker-%E5%AE%98%E6%96%B9-Action-%E5%8F%91%E5%B8%83/</guid><pubDate>Sun, 22 Mar 2020 15:45:06 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="é¦–ä¸ª-docker-å®˜æ–¹-github-action-å‘å¸ƒäº†">é¦–ä¸ª Docker å®˜æ–¹ GitHub Action å‘å¸ƒäº†&lt;/h2>
&lt;p>ä»å»å¹´ Docker å°†ä¼ä¸šæœåŠ¡ç›¸å…³çš„ä¸šåŠ¡å‡ºå”®ç»™ Mirantis ä¹‹åï¼ŒDocker å°†é‡å¿ƒæ”¾åœ¨åŠ©åŠ›å¼€å‘è€…ä½“éªŒä¸Šï¼Œå¹¶ä¸ºæ­¤åšäº†ä¸€ç³»åˆ—çš„åŠªåŠ›ã€‚
åŒ…æ‹¬ 1 æœˆä»½å‘å¸ƒäº† &lt;a href="https://www.docker.com/blog/docker-desktop-release-2-2-is-here/">Docker Desktop v2.2&lt;/a> ï¼Œæä¾›äº† WSL2 çš„æ–°æ¶æ„ï¼Œä»¥åŠæ–°çš„äº¤äº’å¼ Desktop Dashboard ç­‰ç‰¹æ€§ã€‚&lt;/p>
&lt;p>æœ¬å‘¨åˆå‘å¸ƒäº†é¦–ä¸ª Docker GitHub Actionï¼Œç®€åŒ–äº† CI/CD çš„æµç¨‹ã€‚&lt;/p>
&lt;p>è¿™å…¶å®ä¹Ÿæ˜¯ä»å¦ä¸€ä¸ªè§’åº¦æ¥æ¨è¿› DockerHub çš„æ™®åŠï¼ˆæ¯”é¢„æœŸçš„æ™šäº†ä¸€äº›ï¼‰ã€‚DockerHub ä¸Šä¸€ç›´éƒ½æœ‰æ„å»º Docker é•œåƒçš„åŠŸèƒ½ï¼Œä½†æˆ‘ä¸ªäººæ„Ÿè§‰ä½“éªŒå¹¶ä¸å¤Ÿå¥½ï¼Œä»ä¸€èˆ¬æ„ä¹‰ä¸Šæ¥è¯´ï¼Œå®ƒä¸å¤Ÿçµæ´»ï¼›å¦å¤–æˆ‘æ„Ÿè§‰å®ƒçš„è°ƒåº¦ç•¥æ…¢äº†ä¸€ç‚¹ï¼ˆè™½ç„¶ç°åœ¨åœ¨ä¼˜åŒ–ä¸­äº†ï¼‰ã€‚&lt;/p>
&lt;p>ä½†æœ¬æ¬¡å‘å¸ƒçš„ Docker GitHub Action å¯ä»¥è®©ç”¨æˆ·å¯ä»¥æ›´çµæ´»çš„é€šè¿‡ GitHub Action æ¥å®šä¹‰è‡ªå·±çš„ workflowï¼Œå¹¶å°†é•œåƒæ¨é€è‡³é•œåƒä»“åº“ã€‚è¿™é‡Œçš„é•œåƒä»“åº“å¹¶æ²¡æœ‰å’Œ DockerHub å¼ºåˆ¶ç»‘å®šï¼Œç”¨æˆ·å¯ä»¥è‡ªå®šä¹‰é•œåƒä»“åº“çš„åœ°å€ã€‚&lt;/p>
&lt;p>ä½¿ç”¨ç¤ºä¾‹å¦‚ä¸‹ï¼Œå®Œæ•´çš„é¡¹ç›®å¯å‚è€ƒ &lt;a href="https://github.com/tao12345666333/docker-github-action">docker-github-action&lt;/a> ã€‚
éœ€è¦é¢å¤–æ³¨æ„çš„æ˜¯ï¼Œ &lt;strong>å¦‚æœä½ çš„ä»“åº“æ˜¯å…¬å¼€çš„ï¼Œè¯·æ³¨æ„å°†è‡ªå·±çš„ç”¨æˆ·åå¯†ç ç­‰è®¾ç½®ä¸º secrets ï¼Œå¯å‚è€ƒä¸‹æ–¹ç¤ºä¾‹ï¼Œä»¥é˜²æ³„æ¼&lt;/strong>ã€‚&lt;/p>
&lt;pre>&lt;code>- name: Build and push Docker images
uses: docker/build-push-action@v1.0
with:
# Username used to log in to a Docker registry. If not set then no login will occur
username: ${{ secrets.DOCKER_USERNAME }}
# Password or personal access token used to log in to a Docker registry. If not set then no login will occur
password: ${{ secrets.DOCKER_TOKEN }}
# Docker repository to tag the image with
repository: ${{ secrets.DOCKER_USERNAME }}/${{ secrets.DOCKER_PROJECT }}
# Automatically tags the built image with the git reference as per the readme
tag_with_ref: true
# Automatically tags the built image with the git short SHA as per the readme
tag_with_sha: true
# Path to run docker build from
path: .
# Name of the Dockerfile (Default is 'path/Dockerfile')
dockerfile: Dockerfile
# Always attempt to pull a newer version of the image
always_pull: true
# Adds labels with git repository information to the built image
add_git_labels: true
# Whether to push the image
push: true
&lt;/code>&lt;/pre>&lt;p>æ­¤å¤– &lt;a href="https://devblogs.microsoft.com/visualstudio/visual-studio-code-docker-extension-1-0-better-than-ever/">Visual Studio Code Docker extension 1.0&lt;/a> ä¹Ÿåœ¨æœ¬å‘¨å‘å¸ƒäº†ï¼æ®è¯´æ¯”ä¹‹å‰ç‰ˆæœ¬çš„éƒ½å¥½ç”¨ï¼Œä½¿ç”¨ vsc çš„å°ä¼™ä¼´å¯ä»¥å°è¯•ä¸‹ã€‚&lt;/p>
&lt;h2 id="etcd-v345-å‘å¸ƒ">etcd v3.4.5 å‘å¸ƒ&lt;/h2>
&lt;p>etcd æœ¬å‘¨å‘å¸ƒçš„ v3.4.5 åŒ…å«äº†ä¸€äº›ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://github.com/etcd-io/etcd/pull/11704">#11704&lt;/a> åœ¨ server ç«¯çš„æ—¥å¿—ä¸­è®°å½•äº† &lt;code>/health&lt;/code> çš„æ£€æŸ¥ç»“æœï¼Œä¸»è¦æ˜¯ä¸ºäº†ä¾¿äºåœ¨ etcd æŒ‚æ‰æ—¶åˆ†ææ ¹å› ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/etcd-io/etcd/pull/11694">#11694&lt;/a> ä¿®å¤äº†ä¸€ä¸ªåœ¨å¤„ç† metrics å¯èƒ½å¼•èµ·çš„å¼‚å¸¸;&lt;/li>
&lt;/ul>
&lt;p>å…¶ä»–å˜æ›´ï¼Œè¯·å‚è€ƒå…¶ &lt;a href="https://github.com/etcd-io/etcd/blob/master/CHANGELOG-3.4.md#v345-2020-03-18">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="trivy-æˆæƒåè®®å˜æ›´ä¸º-apache-20">Trivy æˆæƒåè®®å˜æ›´ä¸º Apache-2.0&lt;/h2>
&lt;p>Aqua Security å¼€æºçš„ &lt;a href="https://github.com/aquasecurity/trivy">trivy&lt;/a> æ˜¯ä¸€æ¬¾é•œåƒæ¼æ´å®‰å…¨æ‰«æç¨‹åºï¼Œå¯¹ CI å‹å¥½ã€‚&lt;/p>
&lt;p>å¯èƒ½æœ‰äº›å°ä¼™ä¼´ä¸å¤ªäº†è§£ &lt;a href="https://www.aquasec.com/">Aqua Security&lt;/a> è¿™å®¶å…¬å¸ï¼Œä½†å¤§å¤šæ•°äººéƒ½æˆ–å¤šæˆ–å°‘ç”¨è¿‡æˆ–è€…äº†è§£è¿‡å®ƒçš„ä¸€äº›å¼€æºé¡¹ç›®ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://github.com/aquasecurity/kubectl-who-can">kubectl-who-can&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/aquasecurity/kube-bench">kube-bench&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/aquasecurity/kube-hunter">kube-hunter&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>è¿‘æœŸï¼Œtrivy çš„æˆæƒåè®®&lt;a href="https://github.com/aquasecurity/trivy/pull/434">ä» &lt;code>AGPL v3&lt;/code> ä¿®æ”¹æˆäº† &lt;code>Apache-2.0&lt;/code>&lt;/a>ï¼Œè¿™ä¸ªäº‹æƒ…çš„æ„ä¹‰åœ¨äºï¼Œæ›´å¤šçš„å‚å•†æˆ–è€…å…¬å¸å¯ä»¥ä¸ç”¨æ‹…å¿ƒ trivy è‡ªèº«çš„æˆæƒåè®®ï¼Œå¯ä»¥åœ¨è‡ªå·±çš„äº§å“æˆ–è€…ç¯å¢ƒä¸­é›†æˆä½¿ç”¨ trivy äº†ï¼&lt;/p>
&lt;p>ç›®å‰åŒ…æ‹¬ Harborï¼ŒDocker åŠ Mirantis Docker Enterprise ç­‰æ­£åœ¨æˆ–è€…å°†ä½¿ç”¨ trivy ä½œä¸ºå…¶é»˜è®¤é•œåƒå®‰å…¨æ‰«æå·¥å…·ã€‚&lt;/p>
&lt;p>ä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œtrivy ä½¿ç”¨çš„æ•°æ®æºæœ‰äº›æ˜¯è¿˜æ˜¯ç¦æ­¢å•†ç”¨æ¥ç€ã€‚&lt;/p>
&lt;p>æ¨èé˜…è¯»ï¼š&lt;a href="https://blog.fleeto.us/post/introducing-trivy/">å…¨é¢æ˜“ç”¨çš„é•œåƒæ¼æ´æ£€æµ‹å·¥å…·ï¼šTrivy&lt;/a>&lt;/p>
&lt;h2 id="ä¸Šæ¸¸è¿›å±•">ä¸Šæ¸¸è¿›å±•&lt;/h2>
&lt;ul>
&lt;li>è¿™æ˜¯ä¸€ä¸ªå¯¹ Kubernetes v1.16 çš„ä¿®å¤ï¼Œå°†ä¸€ç³»åˆ—ä¸»çº¿ä¸­çš„ä¿®å¤éƒ½åˆå¹¶åˆ°äº† v1.16 ã€‚è¿™é‡Œä¸“é—¨æåˆ°å®ƒï¼Œæ˜¯å› ä¸ºå¦‚æœä½ é›†ç¾¤ä¸­æœ‰å¾ˆå¤šèŠ‚ç‚¹å˜ NotReady æ—¶ï¼Œå¯èƒ½ä¼šå¯¼è‡´ control plane è¶…è½½ï¼Œå‡ºç°ä¸å¯ç”¨çš„æƒ…å†µã€‚ä¸»è¦çš„ä¿®æ­£éƒ½åœ¨ NodeLifecycleController ä¸Šï¼Œå»ºè®®æƒ³è¦ä½¿ç”¨æˆ–è€…æ­£åœ¨ v1.16 ç‰ˆæœ¬çš„ç”¨æˆ·å…³æ³¨ä¸‹æ­¤é—®é¢˜ï¼ˆå¦‚æœé›†ç¾¤è§„æ¨¡ä¸å¤§ï¼Œé‚£å—æ­¤é—®é¢˜å½±å“çš„å¯èƒ½æ€§æ¯”è¾ƒå°ï¼‰ï¼Œè¯¦æƒ…è¯·æŸ¥çœ‹ &lt;a href="https://github.com/kubernetes/kubernetes/pull/88959">#88959&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="é¡¹ç›®æ¨è">é¡¹ç›®æ¨è&lt;/h2>
&lt;p>&lt;a href="https://github.com/stakater/Reloader">Reloader&lt;/a> æ˜¯ä¸€ä¸ª Kubernetes controller ï¼Œå®ƒä¼š watch &lt;code>ConfigMap&lt;/code> æˆ– &lt;code>Secrets&lt;/code>ï¼Œç„¶åå¯¹ä½¿ç”¨è¿™äº›èµ„æºçš„ Pod æ‰§è¡Œæ»šåŠ¨å‡çº§ã€‚&lt;/p>
&lt;p>æ³¨æ„å®ƒåªå…¼å®¹ Kubernetes v1.9 åŠä»¥ä¸Šã€‚å¦‚æœæœ‰ç›¸å…³éœ€æ±‚çš„å°ä¼™ä¼´å¯ä»¥è¿›è¡Œå°è¯•ã€‚&lt;/p>
&lt;hr>
&lt;p>æ¬¢è¿è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€ä¸€å‘¨å¹´äº†ï¼</title><link>https://moelove.info/2020/03/21/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5%E4%B8%80%E5%91%A8%E5%B9%B4%E4%BA%86/</link><guid isPermaLink="true">https://moelove.info/2020/03/21/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5%E4%B8%80%E5%91%A8%E5%B9%B4%E4%BA%86/</guid><pubDate>Sat, 21 Mar 2020 08:10:21 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å·²ç»æ•´æ•´ä¸€å¹´å•¦ï¼æ„Ÿè°¢å¤§å®¶çš„å…³æ³¨å’Œæ”¯æŒï¼&lt;/p>
&lt;/blockquote>
&lt;p>ä» 2019 å¹´ 3 æœˆ 25 æ—¥å‘å¸ƒç¬¬ä¸€ç¯‡ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€åˆ°ä»Šå¤©å·²æ­£å¥½ä¸€å¹´ï¼Œå·²ç»å‘å¸ƒäº† 52 ç¯‡å†…å®¹ã€‚åœ¨è¿™ä¸ªç‰¹æ®Šçš„æ—¥å­é‡Œï¼Œå¾ˆæƒ³ä¸å¤§å®¶åˆ†äº«ä¸‹æˆ‘çš„æ„Ÿå—,ä»¥åŠã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€çš„åˆè¡·å’Œå‘å±•ã€‚&lt;/p>
&lt;h2 id="ç¼˜èµ·">ç¼˜èµ·&lt;/h2>
&lt;p>å‡¡æ˜¯æ¥è§¦ K8S ç”Ÿæ€æˆ–è€…å®¹å™¨ç”Ÿæ€çš„å°ä¼™ä¼´éƒ½ä¸éš¾å‘ç°ï¼Œæ•´ä¸ªç”Ÿæ€ä¸­æ¶‰åŠçš„ä¸œè¥¿å¾ˆå¤šï¼Œæ¯å¤©æœ‰æ— æ•°çš„æ–°æ¶ˆæ¯ï¼Œæ–°å˜åŒ–ï¼Œç¨ä¸ç•™ç¥å°±ä¼šé”™è¿‡å¾ˆå¤šæœ‰ä»·å€¼çš„å†…å®¹ã€‚&lt;/p>
&lt;p>è¿™æ˜¯ä¸€ä¸ªä¿¡æ¯çˆ†ç‚¸çš„æ—¶ä»£ï¼ŒåŒæ—¶å¤§å¤šæ•°äººåŒ…æ‹¬æˆ‘åœ¨å†…åº”è¯¥ä¹Ÿéƒ½ä¼šå­˜åœ¨ç€ä¸€å®šçš„â€œç„¦è™‘â€ï¼Œæ‰€ä»¥é¢å¯¹ç€æµ·é‡çš„ä¿¡æ¯æ€»æ˜¯å¸Œæœ›èƒ½æ›´å¿«çš„ç­›é€‰å‡ºæœ‰ä»·å€¼çš„å†…å®¹ã€‚&lt;/p>
&lt;p>åœ¨å»å¹´å¹´åˆï¼Œæˆ‘åœ¨åšä¸ªäººæ€»ç»“æ—¶å‘ç°ï¼Œè™½ç„¶æˆ‘æ¯å¤©æ¥è§¦åˆ°çš„ä¿¡æ¯å¾ˆå¤šï¼Œä½†çœŸæ­£æœ‰ä»·å€¼çš„ï¼Œæˆ–è€…è¯´å€¼å¾—æˆ‘èŠ±å¾ˆå¤šç²¾åŠ›æŒç»­å»å…³æ³¨çš„å†…å®¹å¹¶æ²¡æœ‰é‚£ä¹ˆå¤šã€‚&lt;/p>
&lt;p>å¹¶ä¸”ç”±äºæ²¡æœ‰å½’æ¡£ï¼Œå…‰é è‡ªå·±è®°å¿†çš„è¯ï¼Œæœ‰äº›äº‹æƒ…å¯èƒ½å°±å¿˜è®°äº†ã€‚ä¹‹åä¹Ÿè®¸è¿˜ä¼šå†æ¬¡èŠ±è´¹æ—¶é—´äº†è§£æˆ–å­¦ä¹ ç›¸å…³çš„å†…å®¹ï¼Œè¿™ä¹Ÿæ˜¯å¦ä¸€ç§å½¢å¼çš„æµªè´¹ã€‚&lt;/p>
&lt;p>äºæ˜¯ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å°±ä»¥è¿™ä¸ªæ€è·¯å¼€å§‹å‘å¸ƒäº†ç¬¬ä¸€ç¯‡ &lt;a href="https://juejin.im/post/5c98db12518825702d3bdb8d">K8S ç”Ÿæ€å‘¨æŠ¥| 2019.03.25~2019.03.31&lt;/a>ã€‚&lt;/p>
&lt;h2 id="è¿‡ç¨‹æ”¹è¿›">è¿‡ç¨‹æ”¹è¿›&lt;/h2>
&lt;p>ç¬¬ä¸€ç¯‡ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å‘å¸ƒåï¼Œæˆ‘è§‰å¾—è¿™ä¸ªäº‹æƒ…æ˜¯å€¼å¾—åšçš„ã€‚åŒæ—¶ä¸ºäº†èƒ½æå‡æ•ˆç‡ï¼Œç®€åŒ–ä¸€äº›äººå·¥æ“ä½œï¼ˆè‡ªåŠ¨åŒ–æ‰æ˜¯ç¬¬ä¸€ç”Ÿäº§åŠ›ï¼‰ï¼Œæ‰€ä»¥å‘¨æœ«æŠ½ç©ºå†™äº†ä¸ªå·¥å…·ï¼ŒæŠŠå‘¨æŠ¥åŠ åˆ°äº†æˆ‘çš„ TODO ä¸­ã€‚&lt;/p>
&lt;p>å…·ä½“è€Œè¨€ï¼Œç”±äºå¤šå¹´å‚ä¸å¼€æºé¡¹ç›®ï¼Œæˆ‘æ¯”è¾ƒä¹ æƒ¯ä½¿ç”¨ GitHub çš„ issue æ¥ç®¡ç†ä¸ªäººçš„ TODOï¼ŒåŠ ä¸Š GitHub æä¾›äº† Project ç®¡ç†çš„åŠŸèƒ½ï¼Œæ‰€ä»¥å®ƒç°åœ¨çœ‹èµ·æ¥æ˜¯è¿™ä¸ªæ ·å­ï¼š&lt;/p>
&lt;p>&lt;img src="https://moelove.info/img/weekly-cards.png" alt="ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€- https://moelove.info">&lt;/p>
&lt;p>æ¯å‘¨æœ‰è‡ªåŠ¨æ‰§è¡Œçš„ä»»åŠ¡æ¥å¸®åŠ©æˆ‘ç®¡ç†è¿™äº› issueï¼Œå¹¶å°†å…¶åŠ å…¥æˆ‘çš„æ¯å‘¨è®¡åˆ’ä¾¿äºè·Ÿè¸ªè¿›åº¦ã€‚æ¯å‘¨ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€çš„è‰ç¨¿ä¹Ÿæ˜¯åœ¨ issue ä¸­å®Œæˆçš„ï¼Œåˆ°å‘¨æœ«æ—¶ï¼Œå†å°†å†…å®¹ç­›é€‰æ•´ç†å¹¶å‘å¸ƒã€‚&lt;/p>
&lt;p>ç”¨äºç®¡ç†è¿™ç±» issue çš„ä»»åŠ¡ï¼Œæ˜¯æ‰˜ç®¡åœ¨ &lt;a href="https://gitlab.com">GitLab&lt;/a> ä¸Šçš„ã€‚æ‰§è¡Œæƒ…å†µå¦‚ä¸‹ï¼š&lt;/p>
&lt;p>&lt;img src="https://moelove.info/img/todo-pipeline.png" alt="ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€Pipeline - https://moelove.info">&lt;/p>
&lt;p>è¿™ç»„å·¥å…·å·²ç»ç¨³å®šè¿è¡Œä¸€å¹´äº†ï¼ŒåŸºæœ¬æ²¡åšè¿‡ä»€ä¹ˆè°ƒæ•´ï¼Œè¿˜æ˜¯æ¯”è¾ƒèƒ½æå‡æˆ‘çš„æ•ˆç‡çš„ã€‚&lt;/p>
&lt;h2 id="å‘å±•é˜¶æ®µ">å‘å±•é˜¶æ®µ&lt;/h2>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€ä¸€å¼€å§‹åªå‘å¸ƒåœ¨&lt;a href="https://moelove.info">æˆ‘çš„åšå®¢&lt;/a>ï¼Œå…¬ä¼—å·ï¼ˆMoeLoveï¼‰ã€&lt;a href="https://zhuanlan.zhihu.com/container">çŸ¥ä¹ä¸“æ &lt;/a>å’Œ&lt;a href="https://juejin.im/user/570eef23ebcb7d0055844663/posts">æ˜é‡‘&lt;/a>ä¸Šï¼Œåæ¥å¢åŠ äº†&lt;a href="https://segmentfault.com/blog/moelove">SegmentFault&lt;/a>å’Œå¾®åšã€‚ä¹Ÿæ”¶è·äº†å¾ˆå¤šå°ä¼™ä¼´çš„æ”¯æŒå’Œåé¦ˆã€‚&lt;/p>
&lt;p>ä¸Šä¸ªæœˆè€ƒè™‘åˆ°æ–‡å­—ç‰ˆä¸å¤Ÿè¯¦å°½ï¼Œæ‰€ä»¥åœ¨æˆ‘å®¶å°å¯çˆ±çš„æ”¯æŒä¸‹ï¼Œå¢åŠ äº† &lt;strong>å†…å®¹æ›´è¯¦ç»†çš„è§†é¢‘ç‰ˆ&lt;/strong>ï¼ŒåŒæ­¥å‘å¸ƒåœ¨ &lt;a href="https://search.bilibili.com/video?keyword=k8s%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5">BiliBili&lt;/a>ï¼Œè¥¿ç“œè§†é¢‘å’Œå¾®ä¿¡è§†é¢‘å·ä¸Šã€‚æ„Ÿè°¢æˆ‘çš„å°å¯çˆ±~&lt;/p>
&lt;h2 id="æ”¶è·">æ”¶è·&lt;/h2>
&lt;p>ç®€å•çš„åˆ†äº«ä¸‹ç°åœ¨çš„ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€çš„æ•°æ®ï¼ŒåŸºæœ¬æƒ…å†µå¦‚ä¸‹ï¼š&lt;/p>
&lt;p>&lt;img src="https://moelove.info/img/weekly-count.png" alt="é˜…è¯»ç»Ÿè®¡- https://moelove.info">&lt;/p>
&lt;p>å¯ä»¥çœ‹åˆ°éå¸¸ç¬¦åˆæˆ‘å‘¨æŠ¥çš„æ›´æ–°é¢‘ç‡ï¼Œæ¯å‘¨æœ‰æ˜æ˜¾çš„æ³¢åŠ¨ã€‚æˆ‘ä¸€ç›´ä¿æŒåœ¨å‘¨ä¸€çš„æ—©ä¸Šåœ¨å…¬ä¼—å·è¿›è¡Œæ¨é€ã€‚&lt;/p>
&lt;p>è¿™äº›æ•°æ®æ„ä¹‰ä¸å¤§ï¼Œåªä¸è¿‡çœ‹ç€æ•°æ®ä¸Šæ¶¨ï¼ŒçŸ¥é“è‡ªå·±å†™çš„å†…å®¹è¢«æ›´å¤šäººçœ‹åˆ°äº†ï¼Œä¹Ÿä¼šæœ‰äº›å¼€å¿ƒï¼Œæ‰€ä»¥æˆ‘è¿™é‡Œä¹Ÿå°±åªæ˜¯åˆ†äº«ä¸ªè¶‹åŠ¿ã€‚&lt;/p>
&lt;p>çœŸæ­£çš„æ”¶è·æœ‰ä»¥ä¸‹å‡ é¡¹ï¼š&lt;/p>
&lt;ul>
&lt;li>å‘¨æŠ¥æˆ‘ä¸€ç›´åšæŒæ²¡æœ‰æ–­æ›´ï¼Œæ‰€ä»¥ç®—æ˜¯ç”¨å¦ä¸€ç§æ–¹å¼å¼ºè¿«æˆ‘è§£å†³äº†ä¹‹å‰ä¿¡æ¯æ²¡æœ‰ã€Œå½’æ¡£ã€çš„è¿™ä¸ªé—®é¢˜ï¼›&lt;/li>
&lt;li>å¦å¤–ï¼Œç”±äºè¦æŠŠå†…å®¹è®²æ¸…æ¥šæ˜ç™½ï¼Œæ‰€ä»¥ä¹Ÿæ›´åŠ æ·±äº†å¯¹ä¿¡æ¯å°è±¡å’Œç†è§£ï¼›&lt;/li>
&lt;li>ä¸ªäººæ—¶é—´æ¯”è¾ƒå°‘ï¼Œè¦æŠ½æ—¶é—´å†™å®Œæ•´çš„æ–‡ç« ä¼šæ¯”è¾ƒéº»çƒ¦ï¼Œé€šè¿‡å‘¨æŠ¥çš„å½¢å¼ï¼Œä¹Ÿå¯ä»¥é¡ºä¾¿æŠŠè‡ªå·±æƒ³è¯´çš„å†…å®¹ç¨å¾®åŠ è¿›å»ï¼Œä¹Ÿæ–¹ä¾¿äº†å¾ˆå¤šï¼›&lt;/li>
&lt;li>å»å¹´å‚åŠ  KubeCon çš„æ—¶å€™ï¼Œè¿˜æœ‰å°ä¼™ä¼´è¯´æ¯å‘¨éƒ½åœ¨åšæŒçœ‹æˆ‘çš„ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€ï¼Œå˜¿å˜¿~ï¼›&lt;/li>
&lt;li>å¼€äº†äº¤æµç¾¤ï¼Œä¹Ÿæœ‰ä¸å°‘å°ä¼™ä¼´çš„åŠ å…¥ï¼›&lt;/li>
&lt;li>åœ¨å¤§é‡ä¿¡æ¯ä¸­èƒ½å¿«é€Ÿçš„ç­›é€‰å‡ºæœ‰æ•ˆä¿¡æ¯ï¼Œå¹¶å¯¹å…¶æŒç»­å…³æ³¨ï¼Œå¯¹ä¸ªäººæˆé•¿æœ‰å¾ˆå¤§å¥½å¤„ï¼›&lt;/li>
&lt;/ul>
&lt;h2 id="å±•æœ›">å±•æœ›&lt;/h2>
&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;p>è¿™æ˜¯å†™åœ¨æ¯ç¯‡ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€ä¸­å›ºå®šçš„å†…å®¹ï¼ŒåŒæ—¶ä¹Ÿä»‹ç»äº†ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€çš„å®šä½ã€‚æ¯å‘¨çš„å†…å®¹ä¸­åŒ…å«çš„éƒ½æ˜¯æˆ‘æ‰€æ¥è§¦åˆ°çš„å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚&lt;/p>
&lt;p>å¦‚æœæœ‰æŒç»­å…³æ³¨ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€çš„å°ä¼™ä¼´åº”è¯¥å‘ç°äº†ï¼Œæœ‰æ—¶å¯èƒ½æ›´æ–°çš„å†…å®¹å¾ˆå°‘ï¼Œè¿™ä¸»è¦ä¼šæœ‰ä¸¤ä¸ªåŸå›  1. æˆ‘å¤ªå¿™äº†æ²¡å…³æ³¨åˆ° 2. ç¡®å®æ²¡ä»€ä¹ˆå¤ªå€¼å¾—å…³æ³¨çš„å†…å®¹ã€‚ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€çš„å®šä½çŸ­æ—¶é—´å†…ä¸ä¼šå˜æ›´ï¼Œå†…å®¹ä¹Ÿå…¨éƒ½æ˜¯æˆ‘æ¥äº§å‡ºï¼Œå¯èƒ½æˆ‘ä¼šæŠŠä¸€äº›æ²¡æ—¶é—´å†™ç¯‡å®Œæ•´æ–‡ç« çš„å†…å®¹ï¼Œä¹Ÿä¸€å¹¶åŠ è¿›æ¥ï¼›å¦‚æœå¤§å®¶æœ‰ä»€ä¹ˆå€¼å¾—æ¨èçš„å†…å®¹ï¼Œæ¯”å¦‚æŠ€æœ¯æ–‡ç« /å¼€æºé¡¹ç›®ç­‰ï¼Œæ¬¢è¿è”ç³»~&lt;/p>
&lt;p>æ¥ä¸‹æ¥æˆ‘è¿˜æ˜¯ä¼šç»§ç»­åšæŒæ›´æ–°ï¼Œå¦å¤–å°±åƒå…¬ä¼—å·ä»‹ç»ä¸­å†™çš„ï¼Œâ€œä¸åªé™äº Containerï¼ŒDocker å’Œ Kubernetes ç­‰æŠ€æœ¯ï¼Œä¸ä½ åˆ†äº«æ›´å¤šä½¿ç”¨ä¸”å…·æœ‰å‰æ™¯çš„æŠ€æœ¯â€ æ¬¢è¿å…³æ³¨ï¼&lt;/p>
&lt;p>æ„Ÿè°¢å¤§å®¶çš„æ”¯æŒï¼&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| Helm v3.1.2 å‘å¸ƒ</title><link>https://moelove.info/2020/03/15/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Helm-v3.1.2-%E5%8F%91%E5%B8%83/</link><guid isPermaLink="true">https://moelove.info/2020/03/15/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Helm-v3.1.2-%E5%8F%91%E5%B8%83/</guid><pubDate>Sun, 15 Mar 2020 22:49:12 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="docker-ce-v19038-å‘å¸ƒ">Docker CE v19.03.8 å‘å¸ƒ&lt;/h2>
&lt;p>è¿™æ˜¯ä¸€ä¸ªä¸´æ—¶å¢åŠ çš„å®‰å…¨æ›´æ–°ç‰ˆæœ¬ï¼Œä¸»è¦ç”¨äºæ”¹è¿›ä¹‹å‰ç‰ˆæœ¬ä¸­å¯¹ &lt;a href="https://nvd.nist.gov/vuln/detail/CVE-2019-14271">CVE-2019-14271&lt;/a> çš„ä¿®å¤æªæ–½ã€‚&lt;/p>
&lt;p>åœ¨å»å¹´ 9 æœˆä»½ï¼Œæˆ‘å‘å¸ƒçš„ &lt;a href="https://zhuanlan.zhihu.com/p/81736488">K8S ç”Ÿæ€å‘¨æŠ¥| Harbor v1.9 å¸¦æ¥ä¼—å¤šæ–°ç‰¹æ€§&lt;/a> ä¸€æ–‡ä¸­ï¼Œæˆ‘æ›¾ä»‹ç»è¿‡ Docker v19.03.1 çš„å‘å¸ƒä¸»è¦ä¹Ÿæ˜¯ä¸ºäº†ä¿®å¤ CVE-2019-14271 æ¼æ´ã€‚&lt;/p>
&lt;p>å°½ç®¡è¿™æ˜¯ä¸€ä¸ªå®‰å…¨æ›´æ–°ç‰ˆæœ¬ï¼Œä½†æˆ‘å¹¶ä¸å»ºè®®ä½ ç«‹é©¬å‡çº§åˆ°æ­¤ v19.03.8 ç‰ˆæœ¬ï¼Œé™¤éä½ å¹¶æ²¡æœ‰ç”¨åˆ° Docker å¯¹æ–‡ä»¶ç³»ç»Ÿè¯†åˆ«ç›¸å…³çš„åŠŸèƒ½ã€‚è¯¦æƒ…è¯·å‚è€ƒæˆ‘ä¸Šå‘¨å‘å¸ƒçš„å‘¨æŠ¥ &lt;a href="https://zhuanlan.zhihu.com/p/111833886">K8S ç”Ÿæ€å‘¨æŠ¥| Docker v19.03.7 å‘å¸ƒ&lt;/a>ã€‚&lt;/p>
&lt;p>ç®€å•æ¥è¯´å°±æ˜¯åœ¨ v19.03.7 ä¸­ï¼Œæ‰§è¡Œ &lt;code>docker info&lt;/code> å‘½ä»¤çš„æ—¶å€™ï¼Œä¼šçœ‹åˆ° &lt;code>Backing Filesystem&lt;/code> æ˜¾ç¤ºä¸º &lt;code>unknown&lt;/code> çš„æƒ…å†µã€‚&lt;/p>
&lt;p>è¯¥é—®é¢˜æˆ‘å·²ç»ä¿®å¤ï¼ŒåŸè®¡åˆ’åœ¨ v19.03.8 ä¸­å‘å¸ƒï¼Œä¸è¿‡æ°é€¢æ­¤å®‰å…¨æ›´æ–°ç‰ˆæœ¬ï¼Œæ‰€ä»¥ç°åœ¨æ¨è¿Ÿåˆ°äº† v19.03.9 ç‰ˆæœ¬ä¸­å‘å¸ƒï¼Œæ•¬è¯·æœŸå¾…ã€‚&lt;/p>
&lt;h2 id="helm-v312-å‘å¸ƒ">Helm v3.1.2 å‘å¸ƒ&lt;/h2>
&lt;p>Helm äºæœ¬å‘¨å‘å¸ƒäº† v3.1.2 ç‰ˆæœ¬ï¼Œæ­¤ç‰ˆæœ¬æ˜¯ Helm v3.1 çš„ç¬¬äºŒä¸ª bugfix ç‰ˆæœ¬ã€‚åœ¨æ­¤ç‰ˆæœ¬ä¸­æœ‰ä¸¤ä¸ªå€¼å¾—æ³¨æ„çš„å†…å®¹ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://github.com/helm/helm/pull/7674">#7674&lt;/a> å½“ä½¿ç”¨ &lt;code>APIVersionV2&lt;/code> æ—¶ï¼Œæ‰§è¡Œ &lt;code>helm package&lt;/code> ä¼šå°† &lt;code>Chart.lock&lt;/code> ä¹Ÿä¸€å¹¶æ‰“åŒ…ã€‚è¿™å°†ä½¿å¾— Helm åŒ…æ›´æ˜“äºåˆ†å‘ï¼Œä¾èµ–ç‰ˆæœ¬çš„é—®é¢˜å˜çš„æ›´ç®€å•äº†ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/helm/helm/pull/7661">#7661&lt;/a> ä¸º &lt;code>helm upgrade&lt;/code> å¢åŠ äº†ä¸€ä¸ª &lt;code>--skip-crds&lt;/code> çš„é€‰é¡¹ï¼Œå…è®¸è·³è¿‡ CRDsï¼›&lt;/li>
&lt;/ul>
&lt;p>å¦å¤–å°±æ˜¯ä¸€äº›å°çš„ä¿®æ­£å’Œæ”¹åŠ¨äº†ï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹å¯å‚è€ƒå…¶ &lt;a href="https://github.com/helm/helm/releases/tag/v3.1.2">ReleaseNote&lt;/a>ï¼Œä¹Ÿå¯ç›´æ¥å‡çº§ä½“éªŒã€‚&lt;/p>
&lt;h2 id="kubernetes-å¤šä¸ªç‰ˆæœ¬å‘å¸ƒ">Kubernetes å¤šä¸ªç‰ˆæœ¬å‘å¸ƒ&lt;/h2>
&lt;p>æœ¬å‘¨å‘å¸ƒäº† Kubernetes v1.15.11ã€v1.16.8 å’Œ v1.17.4 ç­‰å‡ ä¸ªç‰ˆæœ¬ã€‚å’Œä¹‹å‰æƒ…å†µç±»ä¼¼ï¼Œä¸»è¦éƒ½æ˜¯ SIG Cloud Provider ç›¸å…³çš„å†…å®¹ï¼Œæ­¤å¤„æš‚ä¸”ä¸è°ˆã€‚æˆ‘ä¸ªäººè®¤ä¸ºï¼Œæœ‰ä¸¤ä¸ªå€¼å¾—æ³¨æ„çš„å†…å®¹æ˜¯ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/pull/88079">#88079&lt;/a> ä¿®å¤äº†ä¸€ä¸ª kubelet åœ¨å®¢æˆ·ç«¯è¯ä¹¦è½®è½¬æ—¶å¯èƒ½å´©æºƒçš„é—®é¢˜ã€‚&lt;/li>
&lt;/ul>
&lt;p>è¿™ä¸ªé—®é¢˜ä¸»è¦ä¹Ÿå°±æ˜¯ä»£ç ä¸­åœ¨è¿æ¥çš„å¤„ç†ä¸Šæœ‰ä¸ª bugã€‚å®é™…å½±å“çš„è¯ï¼Œå½“é‡åˆ°è¿™ä¸ªæƒ…å†µæ—¶ kubelet ä¼šå¼‚å¸¸å´©æºƒã€‚è€Œæˆ‘ä»¬é€šå¸¸ä¼šä½¿ç”¨ &lt;code>systemd&lt;/code> ä¹‹ç±»çš„ç®¡ç† kubeletï¼Œå¹¶æ·»åŠ è‡ªåŠ¨é‡å¯ï¼Œä¼šæŠŠå®ƒå†æ‹‰èµ·æ¥ã€‚&lt;/p>
&lt;p>æ‰€ä»¥ç»¼åˆæ¥çœ‹çš„è¯ï¼Œå—è¿™ä¸ª bug å½±å“çš„å¯èƒ½æ€§ä¸ç®—å¤§ï¼Œä½†å»ºè®®å‡çº§ã€‚&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/pull/88505">#88505&lt;/a> ä¿®æ­£äº†ä¸€ä¸ª kubelet ä¿®æ”¹ Pod çŠ¶æ€æ—¶å€™çš„é€»è¾‘ï¼›&lt;/li>
&lt;/ul>
&lt;p>æ„Ÿå…´è¶£çš„æœ‹å‹è¯·å‚è€ƒå„ç‰ˆæœ¬çš„ ReleaseNote &lt;a href="https://github.com/kubernetes/kubernetes/blob/master/CHANGELOG/CHANGELOG-1.15.md#changelog-since-v11510">v1.15.11&lt;/a> &lt;a href="https://github.com/kubernetes/kubernetes/blob/master/CHANGELOG/CHANGELOG-1.16.md#changelog-since-v1167">v1.16.8&lt;/a> å’Œ &lt;a href="https://github.com/kubernetes/kubernetes/blob/master/CHANGELOG/CHANGELOG-1.17.md#changelog-since-v1173">v1.17.4&lt;/a>&lt;/p>
&lt;h2 id="ä¸Šæ¸¸è¿›å±•">ä¸Šæ¸¸è¿›å±•&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/pull/88004">#88004&lt;/a> æ­£å¼æ·»åŠ äº† &lt;code>kubectl alpha debug&lt;/code> å‘½ä»¤ï¼Œå¯é€šè¿‡æ­¤å‘½ä»¤æ¥è°ƒè¯• Kubernetes ä¸­çš„èµ„æºï¼Œä¸è¿‡ä¹Ÿè¯·æ³¨æ„ï¼Œæ­¤å‘½ä»¤å°šåœ¨ alpha é˜¶æ®µï¼Œåç»­è¿˜ä¼šæœ‰å˜åŠ¨ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/pull/88758">#88758&lt;/a> éšè—äº†åœ¨ &lt;code>kubectl describe&lt;/code> ä¸­ &lt;code>kubectl.kubernetes.io/last-applied-configuration&lt;/code> ç›¸å…³çš„è¾“å‡ºï¼Œèƒ½æœ‰æ•ˆç¼©çŸ­ &lt;code>kubectl describe&lt;/code> çš„è¾“å‡ºå†…å®¹ï¼Œå¾ˆæœ‰ç”¨ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/pull/88240">#88240&lt;/a> åœ¨æ‰§è¡Œ &lt;code>kubectl get pods&lt;/code> çš„æ—¶å€™ï¼Œ Pod æœ‰äº† &lt;code>NotReady&lt;/code> çš„çŠ¶æ€ã€‚å…¶å®è¯´èµ·æ¥å°±æ˜¯å°†åŸå…ˆ &lt;code>Running&lt;/code> çŠ¶æ€ç»†åŒ–äº†ä¸‹ï¼Œå¦‚æœæ˜¯ Pod å·²ç»å¯åŠ¨ï¼Œä½†æ˜¯æœªç¬¦åˆæ¡ä»¶çš„ï¼Œå°±ä¼šæ˜¾ç¤ºä¸º &lt;code>NotReady&lt;/code> çš„çŠ¶æ€äº†ã€‚&lt;/li>
&lt;/ul>
&lt;h2 id="é¢˜å¤–è¯">é¢˜å¤–è¯&lt;/h2>
&lt;p>åšä¸ªå°è°ƒç ”ï¼Œå¯¹äºå½“å‰ Docker åœ¨ Linux/macOS/Windows ä¸Šçš„ä½“éªŒæ˜¯å¦æœ‰ä¸æ»¡æ„çš„åœ°æ–¹ï¼Ÿå¦‚æœéƒ½æä¾›ç»Ÿä¸€çš„ GUI æ˜¯å¦èƒ½æå‡ä½¿ç”¨ä½“éªŒæˆ–é™ä½æ“ä½œé—¨æ§›ï¼Ÿ æ¬¢è¿ç•™è¨€è®¨è®º&lt;/p>
&lt;hr>
&lt;p>æ¬¢è¿è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| Docker v19.03.7 å‘å¸ƒ</title><link>https://moelove.info/2020/03/08/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Docker-v19.03.7-%E5%8F%91%E5%B8%83/</link><guid isPermaLink="true">https://moelove.info/2020/03/08/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Docker-v19.03.7-%E5%8F%91%E5%B8%83/</guid><pubDate>Sun, 08 Mar 2020 22:47:41 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="docker-v19037-å‘å¸ƒ">Docker v19.03.7 å‘å¸ƒ&lt;/h2>
&lt;p>æˆ‘åœ¨ä¹‹å‰çš„ä¸¤æ¬¡å‘¨æŠ¥ &lt;a href="https://zhuanlan.zhihu.com/p/107328855">ã€ŠK8S ç”Ÿæ€å‘¨æŠ¥| Docker CE v19.03.6 æ­£å¼å‘å¸ƒã€‹&lt;/a> å’Œ&lt;a href="https://zhuanlan.zhihu.com/p/108700105">ã€ŠK8S ç”Ÿæ€å‘¨æŠ¥| containerd v1.2.13 å‘å¸ƒã€‹&lt;/a> ä¸­å·²ç»ä»‹ç»è¿‡äº† Docker CE v19.03.6 &lt;strong>åœ¨å•æ ¸æœºå™¨ä¸Š&lt;/strong> ä¼šç”±äº containerd ä¸­çš„ä¸€ä¸ª bug å¯¼è‡´ä»»åŠ¡ hang ä½ã€‚æœ¬å‘¨å‘å¸ƒçš„ v19.03.7 å·²ç»å°†é»˜è®¤çš„ containerd ç‰ˆæœ¬å‡çº§è‡³ v1.2.13 ï¼Œè¯¥ç‰ˆæœ¬ä¸­åŒ…å«äº†å¯¹æ­¤ bug çš„ä¿®å¤ã€‚&lt;/p>
&lt;p>æ­¤å¤–è¿™ä¸ªç‰ˆæœ¬ä¸­è¿˜åŒ…å«äº†ä¸€ä¸ªå°çš„ä¼˜åŒ–ï¼Œå¯ä»¥è®© &lt;code>docker stats&lt;/code> æ¯”ä¹‹å‰çš„å¯åŠ¨é€Ÿåº¦æ›´å¿«ä¸€ç‚¹ï¼Œç›´è§‚ä¸Šçš„æ„Ÿå—ç›®å‰å¯èƒ½è¿˜ä¸æ˜¯å¾ˆæ˜æ˜¾ã€‚ä½†å¦‚æœæ˜¯é’ˆå¯¹äºæŸäº›ç‰¹æ®Šéœ€æ±‚ï¼Œéœ€è¦é‡‡é›†ä½¿ç”¨é‡åˆ†æçš„æ—¶å€™ï¼Œé‚£å°±ä¼šæ¯”è¾ƒæ˜æ˜¾äº†ã€‚&lt;/p>
&lt;p>&lt;strong>æ³¨æ„&lt;/strong> å‡çº§åˆ°æ­¤ç‰ˆæœ¬å, å¦‚æœä½ åœ¨ä½¿ç”¨ &lt;code>overlay2&lt;/code> å­˜å‚¨é©±åŠ¨æ—¶ï¼Œå¯èƒ½ä¼šæœ‰äººåœ¨æ‰§è¡Œ &lt;code>docker info&lt;/code> æ—¶ï¼Œ&lt;code>Backing Filesystem&lt;/code> é‚£ä¸€æ æ˜¾ç¤ºä¼šæœ‰ç‚¹é—®é¢˜ï¼Œè¿™æ˜¯å› ä¸ºä»£ç é‡Œé¢ç§»é™¤äº†ä¸€äº›æ–‡ä»¶ç³»ç»Ÿçš„æ£€æŸ¥é€»è¾‘ï¼Œå¯¼è‡´èµ‹å€¼ä¹Ÿæœ‰äº›é—®é¢˜ï¼Œä¹‹åä¼šåšä¿®å¤ã€‚&lt;/p>
&lt;p>ä½ å¯èƒ½ä¼šå¾—åˆ°ç±»ä¼¼ä¸‹é¢çš„è¾“å‡ºï¼Œä¸ç”¨å¤ªç´§å¼ ã€‚ï¼ˆå¦‚æœä½ æ²¡æœ‰ä½¿ç”¨ Storage ç›¸å…³é…ç½®çš„è¯ï¼Œæ²¡å¤ªå¤§å½±å“çš„ï¼‰&lt;/p>
&lt;pre>&lt;code>(MoeLove) âœ ~ docker info --format '{{ index .DriverStatus 0 }}'
[Backing Filesystem &amp;lt;unknown&amp;gt;]
&lt;/code>&lt;/pre>&lt;p>æ›´æ–°ï¼šæˆ‘å·²ç»å°†å®ƒè¿›è¡Œäº†ä¿®å¤ï¼Œä¼šåŒ…å«åœ¨ Docker v19.03.8 ç‰ˆæœ¬ä¸­ã€‚&lt;/p>
&lt;p>æ›´å¤šä¿¡æ¯è¯·å‚è€ƒ &lt;a href="https://github.com/docker/docker-ce/releases/tag/v19.03.7">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="istio-v150-æ­£å¼å‘å¸ƒ">Istio v1.5.0 æ­£å¼å‘å¸ƒ&lt;/h2>
&lt;p>Istio v1.5.0 æ˜¯ä¸ªé‡è¦çš„ç‰ˆæœ¬ï¼Œåœ¨æ­¤ç‰ˆæœ¬ä¸­å¼•å…¥äº† &lt;code>Istiod&lt;/code> äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œé€šè¿‡å¼•å…¥å®ƒå¤§å¤§ç®€åŒ–äº† Istio çš„æ¶æ„ä½“ç³»ï¼Œä¹Ÿæ”¹å–„äº†æ“ä½œä½“éªŒã€‚&lt;/p>
&lt;p>æœ¬æ¬¡å®˜æ–¹æ–‡æ¡£å’Œç¤¾åŒºå¾ˆå¤šçš„æ–‡ç« ä¹Ÿéƒ½æœ‰æ­¤ç‰ˆæœ¬ç‰¹æ€§çš„ä»‹ç»ï¼Œæˆ‘å°±ä¸è¿‡å¤šèµ˜è¿°äº†ï¼Œä¸‹é¢ç”¨ä¸¤å¼ å›¾æ¥ç›´è§‚çš„æ„Ÿå—ä¸‹å·®åˆ«ï¼š&lt;/p>
&lt;p>&lt;img src="https://developer.ibm.com/developer/blogs/istio-15-release/images/istio14.jpg" alt="Istio v1.4 - https://moelove.info">&lt;/p>
&lt;p>&lt;img src="https://developer.ibm.com/developer/blogs/istio-15-release/images/istio15.jpg" alt="Istio v1.5 - https://moelove.info">&lt;/p>
&lt;p>æ­¤ç‰ˆæœ¬çš„è¯¦ç»†å˜æ›´ï¼Œè¯·æŸ¥çœ‹å…¶ &lt;a href="https://istio.io/news/releases/1.5.x/announcing-1.5/">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="traefik-v220-rc1-å‘å¸ƒ">Traefik v2.2.0-rc1 å‘å¸ƒ&lt;/h2>
&lt;p>Traefik æƒ³å¿…å¤§å®¶ä¸ä¼šå¤ªè¿‡é™Œç”Ÿï¼Œæœ¬å‘¨å‘å¸ƒäº† v2.2.0-rc1 ç‰ˆæœ¬ï¼Œè¿™æ¬¡ç‰ˆæœ¬å˜åŠ¨è¿˜æ˜¯æ¯”è¾ƒå¤§çš„ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹æœ‰å“ªäº›å€¼å¾—æ³¨æ„çš„å†…å®¹ï¼š&lt;/p>
&lt;ul>
&lt;li>å¢å¼º Kubernetes Ingress çš„æ”¯æŒï¼Œæ¯”å¦‚ &lt;a href="https://github.com/containous/traefik/pull/6171">#6171&lt;/a> æ”¯æŒäº† &lt;code>networking.k8s.io/v1beta1&lt;/code> Ingress API ç‰ˆæœ¬ï¼Œ&lt;a href="https://github.com/containous/traefik/pull/6160">#6160&lt;/a> å¢åŠ äº† annotations çš„æ”¯æŒï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/containous/traefik/pull/5899">#5899&lt;/a> æ·»åŠ äº† KV store providersï¼šç°åœ¨æ”¯æŒ Consul/etcd/Redis/ZooKeeper ç­‰ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/containous/traefik/pull/6348">#6348&lt;/a> å¢åŠ äº†å¯¹ UDP çš„æ”¯æŒï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/containous/traefik/pull/5870">#5870&lt;/a> å¢åŠ äº†å¯¹ Elastic APM tracer çš„æ”¯æŒï¼Œè¿™ä¸ªåŠŸèƒ½å¯ä»¥è¯´æ˜¯å¾ˆå®ç”¨äº†ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/containous/traefik/pull/6036">#6036&lt;/a> UI å¢åŠ äº†æ·±è‰²æ¨¡å¼ï¼›&lt;/li>
&lt;/ul>
&lt;p>æ­¤ç‰ˆæœ¬æ›´è¯¦ç»†çš„å˜æ›´ï¼Œè¯·æŸ¥çœ‹å…¶ &lt;a href="https://github.com/containous/traefik/blob/master/CHANGELOG.md">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="ä¸Šæ¸¸è¿›å±•">ä¸Šæ¸¸è¿›å±•&lt;/h2>
&lt;p>å…ˆæ¥èŠä¸€ä¸ªç¤¾åŒºè¿›å±•ï¼š&lt;/p>
&lt;p>&lt;strong>&lt;code>k8s.gcr.io&lt;/code> å°†ä¼šä» &lt;code>gcr.io/google-containers&lt;/code> è¿ç§»è‡³ &lt;code>gcr.io/k8s-artifacts-prod&lt;/code>&lt;/strong> ï¼Œæœ¬æ¬¡è¿ç§»æ˜¯ç”±äº &lt;code>gcr.io/google-containers&lt;/code> æ˜¯ç”± Google ç»è¥çš„ï¼Œä¹‹å‰åªèƒ½è®© Google å‘˜å·¥å†™å…¥ã€‚ç°åœ¨è¿ç§»åˆ°çš„æ–°çš„å­˜å‚¨ä»“åº“ &lt;code>gcr.io/k8s-artifacts-prod&lt;/code> å®ƒæ˜¯ç”± K8S ç¤¾åŒºè¿›è¡Œè¿è¥ï¼Œä¹Ÿå°±æ˜¯è¯´ç¤¾åŒºæˆå‘˜ä¹Ÿå¯ä»¥æ¨é€é•œåƒäº†ï¼Œä¸å†ä¾èµ–äº Google å‘˜å·¥çš„æ“ä½œã€‚&lt;/p>
&lt;p>æœ¬æ¬¡è¿ç§»ä¸ºäº†ä¿éšœæ•°æ®ä¸€è‡´æ€§ï¼Œè¿ç§»å‰ä¼šå°† &lt;code>gcr.io/google-containers&lt;/code> è®¾ç½®ä¸ºåªè¯»ï¼Œè¿ç§»æ—¶é—´æš‚å®š 4 æœˆåˆã€‚&lt;/p>
&lt;p>å¯¹äºå›½å†…ç”¨æˆ·è€Œè¨€ï¼Œå¾ˆå¤šé•œåƒç«™éœ€è¦ä¿®æ”¹ä¸€ä¸‹æ•°æ®æºäº†ï¼›å¦å¤–ï¼Œç”±äºæ–°çš„é•œåƒä»“åº“ä»ç„¶åœ¨ &lt;code>gcr.io&lt;/code> æ‰€ä»¥å¹¶ä¸éœ€è¦å¯¹å…¶ç½‘ç»œæœ‰ä»€ä¹ˆç‰¹æ®Šçš„æœŸå¾…~&lt;/p>
&lt;p>å…·ä½“è®¨è®ºè¯·å‚è€ƒ &lt;a href="https://groups.google.com/forum/#!topic/kubernetes-dev/MkXnkTSJ_vs/discussion">k8s.gcr.io moving from gcr.io/google-containers to gcr.io/k8s-artifacts-prod in early April &lt;/a>&lt;/p>
&lt;p>ä¸‹å‘¨å°±è¦è¿›å…¥ä»£ç å†»ç»“æœŸäº†ï¼Œè¿‘æœŸåˆå¹¶çš„ä»£ç å¾ˆå¤šï¼Œæˆ‘ä¸ªäººæ¯”è¾ƒå…³æ³¨çš„æœ‰ä»¥ä¸‹éƒ¨åˆ†ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/pull/84814">#84814&lt;/a> &lt;code>storage.k8s.io/CSIDriver&lt;/code> æ­£å¼ GA äº†ï¼Œå®ƒä» v1.14 è¿›å…¥ Beta çŠ¶æ€ï¼Œå¦‚ä»Šç»ˆäº GAï¼Œåœ¨ Kubernetes v1.18 çš„ ReleaseNote ä¸­æƒ³å¿…ä¹Ÿä¼šé¢å¤–è¯´æ˜çš„ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/pull/88827">#88827&lt;/a> kubeadm åºŸå¼ƒäº† &lt;code>kubeadm alpha certs renew&lt;/code> ä¸‹çš„ &lt;code>--use-api&lt;/code> å‚æ•°ï¼Œç›®å‰é¢„æœŸåœ¨ v1.19 å°†å…¶ç§»é™¤ï¼Œå¦‚æœ‰ç”¨åˆ°ç›¸å…³åŠŸèƒ½çš„ï¼Œè¯·æ³¨æ„ã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="ref">ref&lt;/h3>
&lt;p>å›¾æºï¼š&lt;a href="https://developer.ibm.com/blogs/istio-15-release/#">istio-15-release&lt;/a>&lt;/p>
&lt;hr>
&lt;p>æ¬¢è¿è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| rkt é¡¹ç›®æ­£å¼å½’æ¡£å¹¶å®£å¸ƒç»ˆæ­¢</title><link>https://moelove.info/2020/02/29/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-rkt-%E9%A1%B9%E7%9B%AE%E6%AD%A3%E5%BC%8F%E5%BD%92%E6%A1%A3%E5%B9%B6%E5%AE%A3%E5%B8%83%E7%BB%88%E6%AD%A2/</link><guid isPermaLink="true">https://moelove.info/2020/02/29/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-rkt-%E9%A1%B9%E7%9B%AE%E6%AD%A3%E5%BC%8F%E5%BD%92%E6%A1%A3%E5%B9%B6%E5%AE%A3%E5%B8%83%E7%BB%88%E6%AD%A2/</guid><pubDate>Sat, 29 Feb 2020 12:45:36 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="rkt-é¡¹ç›®æ­£å¼å½’æ¡£å¹¶å®£å¸ƒç»ˆæ­¢">rkt é¡¹ç›®æ­£å¼å½’æ¡£å¹¶å®£å¸ƒç»ˆæ­¢&lt;/h2>
&lt;p>&lt;a href="https://github.com/rkt/rkt">rkt&lt;/a> é¡¹ç›®æˆ‘åœ¨ä¹‹å‰çš„å‘¨æŠ¥&lt;a href="https://zhuanlan.zhihu.com/p/78730840">ã€ŠK8S ç”Ÿæ€å‘¨æŠ¥| rkt é¡¹ç›®æ­£å¼è¢« CNCF å½’æ¡£ã€‹&lt;/a> å°±å·²ç»è¯¦ç»†ä»‹ç»è¿‡äº†ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚&lt;/p>
&lt;p>ä»å»å¹´ rkt é¡¹ç›®æ­£å¼è¢« CNCF å½’æ¡£åï¼Œç›´åˆ°ç°åœ¨ rkt é¡¹ç›®çš„ç»´æŠ¤è€…ä»¬ä¹Ÿç»ˆäºåœ¨ GitHub ä¸Šå½’æ¡£è¯¥é¡¹ç›®ï¼Œå¹¶å®£å¸ƒæ­¤é¡¹ç›®æ­£å¼ç»ˆæ­¢ã€‚&lt;/p>
&lt;p>å…¬å‘Šä¿¡æ¯è¯·å‚è€ƒ &lt;a href="https://github.com/rkt/rkt/commit/bbd90a1d1e57d0f6d4598de2b62ae0b6ead94ec5">rkt/rkt@bbd90a1&lt;/a> ã€‚&lt;/p>
&lt;p>å†æ¬¡æ„Ÿè°¢ rkt åœ¨å®¹å™¨ç”Ÿæ€é¢†åŸŸåšå‡ºçš„è´¡çŒ®ï¼ï¼ˆå¤§æ¦‚ä»¥åä¹Ÿä¸ä¼šå†æåˆ° rkt äº†ï¼‰&lt;/p>
&lt;h2 id="kubernetes-nginx-ingress-å‘å¸ƒ-v0300">Kubernetes NGINX Ingress å‘å¸ƒ v0.30.0&lt;/h2>
&lt;p>Kuberentes NGINX Ingress è¿‘æœŸç›¸ç»§å‘å¸ƒäº† v0.29 å’Œ v0.30 ä¸¤ä¸ªç‰ˆæœ¬ï¼Œå˜æ›´è¾ƒé¢‘ç¹ã€‚ä¸»è¦å€¼å¾—æ³¨æ„çš„å†…å®¹å¦‚ä¸‹ï¼š&lt;/p>
&lt;ul>
&lt;li>NGINX å‡çº§åˆ°äº† v1.17.8 ç‰ˆæœ¬ï¼›&lt;/li>
&lt;li>å…è®¸ &lt;code>ExternalName&lt;/code> ç±»å‹çš„ service æœ‰ä¸åŒçš„ &lt;code>port&lt;/code> å’Œ &lt;code>targetPort&lt;/code>ï¼ˆè¿™æ˜¯ä¸€ä¸ª bugfixï¼‰;&lt;/li>
&lt;/ul>
&lt;p>é¡ºä¾¿èŠä¸ªæ— å…³ç´§è¦çš„å†…å®¹ï¼Œè¿™ä¸ªç‰ˆæœ¬ä¸­æœ‰ä¸€ä¸ª commit æ¯”è¾ƒæœ‰è¶£ï¼Œè¯·çœ‹ &lt;a href="https://github.com/kubernetes/ingress-nginx/pull/5041">#5041&lt;/a> ã€‚è¿™ä¸ª commit å…¶å®æ˜¯ç”±ä¸€ä¸ª bot ç”Ÿæˆçš„ï¼Œä¸“é—¨ç”¨æ¥åšå›¾ç‰‡ä¼˜åŒ–çš„åº”ç”¨ï¼Œ é€šè¿‡è¿™ä¸ª ImgBot ä½¿å¾—è¯¥é¡¹ç›®ä¸­å›¾ç‰‡èµ„æºçš„ä½“ç§¯å‡å°‘äº† 36.94%ï¼Œ æ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥å°è¯•ä¸‹è¿™ä¸ª ImgBot &lt;a href="https://github.com/marketplace/imgbot">https://github.com/marketplace/imgbot&lt;/a>&lt;/p>
&lt;p>å¯¹ Kubernetes NGINX Ingress æ–°ç‰ˆæœ¬æ„Ÿå…´è¶£çš„æœ‹å‹è¯·å‚è€ƒå…¶ &lt;a href="https://github.com/kubernetes/ingress-nginx/blob/master/Changelog.md">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="rook-v125-å‘å¸ƒ">rook v1.2.5 å‘å¸ƒ&lt;/h2>
&lt;p>è¿™ä¸ªç‰ˆæœ¬æ˜¯ä¸€ä¸ª bugfix ç‰ˆæœ¬ï¼Œ æœ‰äº›å€¼å¾—æ³¨æ„çš„å†…å®¹ï¼š&lt;/p>
&lt;ul>
&lt;li>å°† Ceph ç‰ˆæœ¬å‡çº§è‡³ v14.2.7ï¼›&lt;/li>
&lt;li>ä¿®å¤äº† Chart ä¸­ RBAC çš„é…ç½®ï¼Œå…è®¸äº† &lt;code>patch&lt;/code> åŠ¨ä½œï¼›&lt;/li>
&lt;li>operator ä¸­ CSI çš„é…ç½®å¯é€šè¿‡ configmap è¿›è¡Œé…ç½®äº†ï¼›&lt;/li>
&lt;/ul>
&lt;p>å…³äº rook æ­¤ç‰ˆæœ¬æ„Ÿå…´è¶£çš„æœ‹å‹è¯·å‚è€ƒå…¶ &lt;a href="https://github.com/rook/rook/releases/tag/v1.2.5">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="ä¸Šæ¸¸è¿›å±•">ä¸Šæ¸¸è¿›å±•&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/pull/87906">#87906&lt;/a> å½“ pod, container æˆ–è€… emptyDir è§¦å‘é©±é€æ—¶ï¼Œkubelet_evictions å¯è®°å½•ã€‚ä¸ªäººè®¤ä¸ºæ­¤åŠŸèƒ½å¾ˆæœ‰ç”¨ï¼Œé›†ç¾¤ç®¡ç†å‘˜ä¹Ÿå¯å¢åŠ å¯¹åº”ç›‘æ§å’Œå‘Šè­¦ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/pull/88057">#88057&lt;/a> &lt;code>kubectl rolling-update&lt;/code> è¢«æ­£å¼ç§»é™¤ï¼Œè¿™ä¸ªå‘½ä»¤æ—©åœ¨ä¸¤å¹´å‰ï¼ˆ2018 å¹´ 4 æœˆï¼‰å°±å·²ç»è¢«æ ‡è®°ä¸ºåºŸå¼ƒï¼Œè¯·ä½¿ç”¨ &lt;code>kubectl rollout&lt;/code> ä»£æ›¿ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/pull/88324">#88324&lt;/a> ä¸º cluster-info dump å¢åŠ  init-container çš„æ—¥å¿—è®°å½•ï¼›&lt;/li>
&lt;/ul>
&lt;h2 id="é¡¹ç›®æ¨è">é¡¹ç›®æ¨è&lt;/h2>
&lt;p>&lt;a href="https://github.com/devopsprodigy/kubegraf">kubegraf&lt;/a> - ä¸€æ¬¾ä¸º K8S ç›‘æ§è€Œå‡†å¤‡çš„ Grafana æ’ä»¶ã€‚æ„Ÿå…´è¶£çš„å°ä¼™ä¼´å¯ä»¥å°è¯•ä¸‹ï¼Œæˆªå›¾å¦‚ä¸‹ï¼š&lt;/p>
&lt;p>&lt;img src="https://camo.githubusercontent.com/1437242a5337a94a6ecb432df65f7599de74589f/68747470733a2f2f6465766f707370726f646967792e636f6d2f696d672f646f702d6b756265677261662f763132302f6170706c69636174696f6e735f6f766572766965775f322e706e67" alt="kubegraf - https://moelove.info">&lt;/p>
&lt;p>&lt;img src="https://camo.githubusercontent.com/6153e1cb75dad07119ee6f47ca96266eadf23fea/68747470733a2f2f6465766f707370726f646967792e636f6d2f696d672f646f702d6b756265677261662f763132302f6e6f64655f6f766572766965772e706e67" alt="kubegraf - https://moelove.info">&lt;/p>
&lt;hr>
&lt;p>æ¬¢è¿è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| containerd v1.2.13 å‘å¸ƒ</title><link>https://moelove.info/2020/02/23/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-containerd-v1.2.13-%E5%8F%91%E5%B8%83/</link><guid isPermaLink="true">https://moelove.info/2020/02/23/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-containerd-v1.2.13-%E5%8F%91%E5%B8%83/</guid><pubDate>Sun, 23 Feb 2020 11:56:55 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="containerd-v1213-å‘å¸ƒ">containerd v1.2.13 å‘å¸ƒ&lt;/h2>
&lt;p>ä¸Šå‘¨çš„ &lt;a href="https://zhuanlan.zhihu.com/p/107328855">K8S ç”Ÿæ€å‘¨æŠ¥&lt;/a> ä¸­ï¼Œæˆ‘åœ¨ &lt;a href="https://zhuanlan.zhihu.com/p/107328855">Docker CE v19.03.6 æ­£å¼å‘å¸ƒ&lt;/a> çš„éƒ¨åˆ†ï¼Œä»‹ç»äº† Docker v19.03.6 åœ¨å•æ ¸çš„æœºå™¨/è™šæ‹Ÿæœºä¸­ï¼Œå¯èƒ½ä¼šç”±äº containerd çš„ä¸€ä¸ª bug å¯¼è‡´ä»»åŠ¡ hang ä½ã€‚&lt;/p>
&lt;p>æœ¬å‘¨ containerd v1.2.13 å‘å¸ƒäº†ï¼Œæ­¤ç‰ˆæœ¬ä¸­å·²ç»åŒ…å«äº†å¯¹è¯¥å†…å®¹çš„ä¿®å¤ã€‚&lt;/p>
&lt;p>å¦‚æœå—åˆ°æ­¤é—®é¢˜å½±å“çš„ç”¨æˆ·ï¼Œ &lt;strong>å¯ç›´æ¥ä¸‹è½½å®‰è£…ä½¿ç”¨ containerd v1.2.13&lt;/strong> ä»¥ä¿®å¤æ­¤é—®é¢˜ã€‚&lt;/p>
&lt;p>è¿‘æœŸ Docker v19.03.7 ä¹Ÿå°†å‘å¸ƒï¼Œå°†ä¼šé»˜è®¤ä½¿ç”¨ containerd v1.2.13 ï¼Œå±Šæ—¶ç›´æ¥é‡è£…/å‡çº§å‡å¯è§„é¿æ­¤é—®é¢˜ã€‚&lt;/p>
&lt;h2 id="helm-v311-å‘å¸ƒ">Helm v3.1.1 å‘å¸ƒ&lt;/h2>
&lt;p>ä¸Šå‘¨ Helm 3.1.0 åˆšå‘å¸ƒä¾¿é©¬ä¸Šè¿æ¥äº† v3.1.1 ç‰ˆæœ¬ï¼Œè¿™æ˜¯ä¸€ä¸ª bugfix ç‰ˆæœ¬ï¼ŒåŒ…å«äº†å‡ ä¸ªä¸»è¦çš„ä¿®å¤ï¼š&lt;/p>
&lt;ul>
&lt;li>ä¿®å¤äº† &lt;code>helm list&lt;/code> ä¸èƒ½æ­£ç¡®æŠ›å‡ºé”™è¯¯ä¿¡æ¯çš„é—®é¢˜ï¼ŒåŸå› æ˜¯ä»£ç ä¸­æœ‰ä¸ª&lt;a href="https://github.com/helm/helm/commit/3fa62f4da11862c03742fa4306c8dacbaf9ded41">é”™è¯¯æœªè¢«æ•è·&lt;/a>ï¼›&lt;/li>
&lt;li>ç°åœ¨ï¼Œå¦‚æœè®¾ç½®äº† &lt;code>--wait&lt;/code> å‚æ•°æ—¶ï¼Œservice ä¸ä¼šç­‰å¾… externalIPs ä¾¿å¯ä»¥è¿”å›äº†ï¼Œå¯è§„é¿ä¸€äº›ç±»ä¼¼ &lt;code>helm upgrade --wait&lt;/code> æ—¶å¯èƒ½è¶…æ—¶çš„é—®é¢˜ï¼›&lt;/li>
&lt;/ul>
&lt;h2 id="ä¸Šæ¸¸è¿›å±•">ä¸Šæ¸¸è¿›å±•&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/pull/87714">#87714&lt;/a> kubectl çš„ &lt;code>--server-dry-run&lt;/code> è¢«æ ‡è®°ä¸ºåºŸå¼ƒï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡ä½¿ç”¨ &lt;code>--dry-run=server&lt;/code> æ›¿ä»£ã€‚å¹¶ä¸” kubectl çš„ &lt;code>--dry-run&lt;/code> å‚æ•°æ¥æ”¶çš„å€¼ï¼Œä¹Ÿå˜æˆäº† &lt;code>client&lt;/code>, &lt;code>server&lt;/code> ä»¥åŠ &lt;code>none&lt;/code>ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/pull/86810">#86810&lt;/a> &lt;code>kubeadm config images list&lt;/code> å®ç°äº†ç»“æ„åŒ–è¾“å‡ºï¼Œæ”¯æŒæ–‡æœ¬ï¼ŒJSONï¼ŒYAML å’Œ GO æ¨¡æ¿ç­‰ã€‚ï¼ˆæˆ‘ä¸ªäººè®¤ä¸ºï¼Œè¿™ä¸ªåŠŸèƒ½ä¸é”™çš„ï¼Œä½†ç›®å‰æˆ‘è¿˜æ²¡æƒ³åˆ°ä»€ä¹ˆæƒ…å†µä¸‹æˆ‘ä¼šéœ€è¦å®ƒï¼‰ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/pull/87975">#87975&lt;/a> &lt;code>kubeadm upgrade node config&lt;/code> ä» v1.15 èµ·æ ‡è®°åºŸå¼ƒï¼Œç°åœ¨æ­£å¼ç§»é™¤ï¼Œè¯·ä½¿ç”¨ &lt;code>kubeadm upgrade node phase kubelet-config&lt;/code> ä»£æ›¿ã€‚&lt;/li>
&lt;/ul>
&lt;h2 id="é¢˜å¤–è¯">é¢˜å¤–è¯&lt;/h2>
&lt;p>æœ€è¿‘å°è¯•ä¸º ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å¢åŠ äº†è§†é¢‘ç‰ˆï¼Œæ¬¢è¿è§‚çœ‹åŠåé¦ˆã€‚&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://www.bilibili.com/video/av89983893">K8S ç”Ÿæ€å‘¨æŠ¥| Helm v3.1.0 æ­£å¼å‘å¸ƒ&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://www.bilibili.com/video/av88082603">K8S ç”Ÿæ€å‘¨æŠ¥| Docker v19.03.6-rc2 å‘å¸ƒ&lt;/a>&lt;/li>
&lt;/ul>
&lt;hr>
&lt;p>å¯ä»¥é€šè¿‡ä¸‹é¢äºŒç»´ç è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘ï¼Œç‚¹å‡»é˜…è¯»åŸæ–‡æœ‰æ›´å¥½çš„é˜…è¯»ä½“éªŒã€‚&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| Helm v3.1.0 æ­£å¼å‘å¸ƒ</title><link>https://moelove.info/2020/02/15/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Helm-v3.1.0-%E6%AD%A3%E5%BC%8F%E5%8F%91%E5%B8%83/</link><guid isPermaLink="true">https://moelove.info/2020/02/15/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Helm-v3.1.0-%E6%AD%A3%E5%BC%8F%E5%8F%91%E5%B8%83/</guid><pubDate>Sat, 15 Feb 2020 23:12:46 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="docker-ce-v19036-æ­£å¼å‘å¸ƒ">Docker CE v19.03.6 æ­£å¼å‘å¸ƒ&lt;/h2>
&lt;p>åœ¨ä¸Šæ¬¡çš„å‘¨æŠ¥ &lt;a href="https://zhuanlan.zhihu.com/p/105974404">K8S ç”Ÿæ€å‘¨æŠ¥| Docker v19.03.6-rc2 å‘å¸ƒ&lt;/a> ä¸­ï¼Œæˆ‘å·²ç»ä»‹ç»äº† Docker v19.03.6 ä¸­åŒ…å«çš„ä¸»è¦æ›´æ–°äº†ã€‚&lt;/p>
&lt;p>è¿™é‡Œæˆ‘è¦é¢å¤–å¢åŠ ä¸€ç‚¹æé†’ï¼š&lt;/p>
&lt;p>&lt;strong>å¦‚æœä½ åœ¨ä½¿ç”¨å•æ ¸çš„æœºå™¨/è™šæ‹Ÿæœºï¼Œåœ¨å‡çº§ v19.03.6 åï¼Œå¯èƒ½ä¼šç”±äº containerd ä¸­çš„ä¸€ä¸ª bug è€Œå¯¼è‡´ä»»åŠ¡ hang ä½&lt;/strong>&lt;/p>
&lt;p>æ¯”è¾ƒå¸¸è§çš„ä¸€ä¸ªå¯èƒ½å‡ºé”™çš„åœ°æ–¹å°±æ˜¯ä½¿ç”¨ GitLab.com çš„å…±äº« runner ï¼ˆå•æ ¸çš„ vmï¼‰ï¼Œå¦‚æœä½ æ²¡æœ‰å°† dindï¼ˆDocker In Dockerï¼‰é•œåƒæŒ‡å®šä¸ºå…·ä½“çš„ç‰ˆæœ¬å·ï¼Œè€Œæ˜¯ä½¿ç”¨ç±»ä¼¼ &lt;code>docker:dind&lt;/code> è¿™æ ·çš„ tag æ—¶ï¼Œä½ å¯èƒ½å·²ç»é‡åˆ°ç›¸å…³çš„é—®é¢˜äº†ã€‚æ¨èå½“å‰å›ºå®šä¸º &lt;code>docker:19.03.5-dind&lt;/code> ï¼Œå¾…åç»­ä¿®æ­£ã€‚&lt;/p>
&lt;p>containerd v1.2.13 ä¸­å°†ä¼šåŒ…å«æ­¤ä¿®å¤ï¼ˆå°šæœªå‘å¸ƒï¼‰ï¼Œæˆ–è€…ä¸´æ—¶è§£å†³åŠæ³•å¯ä»¥æ˜¯æš‚æ—¶é™çº§ containerd ã€‚&lt;/p>
&lt;p>å½“ container å‘å¸ƒæ–°ç‰ˆæœ¬åï¼Œå¯ä»¥é€šè¿‡é‡æ–°å®‰è£…/å‡çº§ containerd æ¥è§£å†³æ­¤é—®é¢˜ã€‚&lt;/p>
&lt;h2 id="helm-v310-æ­£å¼å‘å¸ƒ">Helm v3.1.0 æ­£å¼å‘å¸ƒ&lt;/h2>
&lt;p>è‡ª 2019 å¹´ 11 æœˆ 13 æ—¥ Helm æ­£å¼å‘å¸ƒ v3.0.0 è‡³ä»Šå·²è¿‡äº†ä¸‰ä¸ªæœˆï¼ŒHelm ç»ˆäºè¿æ¥äº†æ–°çš„ç‰¹æ€§ç‰ˆæœ¬ï¼Œ v3.1.0 æœ¬å‘¨æ­£å¼å‘å¸ƒäº†ã€‚å…¶ä¸­åŒ…å«äº†å¤§é‡çš„æ›´æ–°å’Œä¿®å¤ï¼Œæ¯”è¾ƒå€¼å¾—æ³¨æ„çš„å†…å®¹å¦‚ä¸‹ï¼š&lt;/p>
&lt;ul>
&lt;li>ä¸º &lt;code>--all-namespaces&lt;/code> æ·»åŠ äº†ä¸€ä¸ªåˆ«åï¼Œå¯ä½¿ç”¨ &lt;code>-A&lt;/code> æ›¿ä»£ï¼›&lt;/li>
&lt;li>&lt;code>helm lint&lt;/code> å¯ä»¥ç›´æ¥å¯¹ä¸€ä¸ª &lt;code>tar.gz&lt;/code> çš„å‹ç¼©åŒ…åšæ£€æŸ¥äº†ï¼›&lt;/li>
&lt;li>å¢åŠ äº†ä¸€ä¸ª &lt;code>--post-renderer&lt;/code> çš„ hook ï¼Œæ”¯æŒä½¿ç”¨å¯æ‰§è¡Œæ–‡ä»¶å¯¹æ¸²æŸ“åçš„æ–‡ä»¶åšä¿®æ”¹ï¼›&lt;/li>
&lt;li>æ”¯æŒæ¸²æŸ“ CRD åˆ° &lt;code>--output-dir&lt;/code> æŒ‡å®šçš„ç›®å½•äº†ï¼›&lt;/li>
&lt;/ul>
&lt;p>å…¶ä»–å°±æ˜¯å¤§é‡çš„ bugfix äº†ï¼Œ
å¦‚æœä½ å¯¹æ­¤ç‰ˆæœ¬æ„Ÿå…´è¶£ï¼Œè¯·å‚çœ‹ &lt;a href="https://github.com/helm/helm/releases/tag/v3.1.0">ReleaseNote&lt;/a>.&lt;/p>
&lt;h2 id="kubernetes-ç›¸ç»§å‘å¸ƒå¤šä¸ªç‰ˆæœ¬">Kubernetes ç›¸ç»§å‘å¸ƒå¤šä¸ªç‰ˆæœ¬&lt;/h2>
&lt;p>Kubernetes v1.17.3ã€v1.16.7ã€v1.15.10 ç­‰ç›¸ç»§å‘å¸ƒï¼Œä¸»è¦éƒ½æ˜¯ä¿®å¤ä¸€äº› bugï¼Œå…¶ä¸­ SIG Cloud Provider ç±»çš„è¾ƒå¤šã€‚&lt;/p>
&lt;p>æˆ‘å¤§è‡´çœ‹äº†çœ‹ï¼Œè¿™é‡Œå°±ä¸ä¸€ä¸€ä»‹ç»äº†ï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥å‚è€ƒ &lt;a href="https://github.com/kubernetes/kubernetes/releases/tag/v1.17.3">v1.17.3&lt;/a> &lt;a href="https://github.com/kubernetes/kubernetes/releases/tag/v1.16.7">v1.16.7&lt;/a> &lt;a href="https://github.com/kubernetes/kubernetes/releases/tag/v1.15.10">v1.15.10 çš„ ReleaseNote&lt;/a> ã€‚&lt;/p>
&lt;h2 id="istio-v144-å‘å¸ƒ">Istio v1.4.4 å‘å¸ƒ&lt;/h2>
&lt;p>Istio æœ¬å‘¨ä¹Ÿå‘å¸ƒäº† v1.4.4 ç‰ˆæœ¬ï¼Œ å…¶ä¸­æœ‰ä¸ªå€¼å¾—æ³¨æ„çš„ç‚¹ï¼š&lt;/p>
&lt;p>&lt;strong>&lt;a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-8595">CVE-2020-8595&lt;/a>ï¼šIstio çš„ AuthenticationPolicy ä¸­è·¯å¾„ç²¾ç¡®åŒ¹é…çš„é€»è¾‘ä¸­æœ‰ä¸€å¤„æ¼æ´ï¼Œå…è®¸æœªç»æˆæƒçš„ JWT token å¯¹èµ„æºè¿›è¡Œæœªç»æˆæƒçš„è®¿é—®ã€‚&lt;/strong>&lt;/p>
&lt;h2 id="ä¸Šæ¸¸è¿›å±•">ä¸Šæ¸¸è¿›å±•&lt;/h2>
&lt;ul>
&lt;li>å®ç°äº†ä¸€ä¸ª &lt;code>backoff&lt;/code> manager &lt;a href="https://github.com/kubernetes/kubernetes/pull/87829">#87829&lt;/a>;&lt;/li>
&lt;li>ä¿®å¤äº† &lt;code>kubectl drain&lt;/code> æ—¶çš„ä¸€å¤„é€»è¾‘é”™è¯¯ &lt;a href="https://github.com/kubernetes/kubectl/issues/803">kubernetes/kubectl#803&lt;/a>;&lt;/li>
&lt;/ul>
&lt;hr>
&lt;p>å¯ä»¥é€šè¿‡ä¸‹é¢äºŒç»´ç è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘ï¼Œç‚¹å‡»é˜…è¯»åŸæ–‡æœ‰æ›´å¥½çš„é˜…è¯»ä½“éªŒã€‚&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| Docker v19.03.6-rc2 å‘å¸ƒ</title><link>https://moelove.info/2020/02/09/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Docker-v19.03.6-rc2-%E5%8F%91%E5%B8%83/</link><guid isPermaLink="true">https://moelove.info/2020/02/09/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Docker-v19.03.6-rc2-%E5%8F%91%E5%B8%83/</guid><pubDate>Sun, 09 Feb 2020 17:14:37 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="docker-v19036-rc2-å‘å¸ƒ">Docker v19.03.6-rc2 å‘å¸ƒ&lt;/h2>
&lt;p>è‡ª 2019 å¹´ 11 æœˆ 15 æ—¥ Docker v19.03.5 å‘å¸ƒåï¼ŒDocker Inc. åŒ…æ‹¬ç¤¾åŒºéƒ½å‘ç”Ÿäº†ä¸å°‘çš„å˜åŒ–ã€‚&lt;/p>
&lt;p>v19.03.6 å°†ä¼šæ˜¯ v19.03 ç³»åˆ—çš„ä¸‹ä¸€ä¸ª bugfix ç‰ˆæœ¬ã€‚åœ¨æ­¤ç‰ˆæœ¬ä¸­ï¼Œæœ‰å‡ ä¸ªæ¯”è¾ƒå€¼å¾—æ³¨æ„çš„å†…å®¹ï¼š&lt;/p>
&lt;ul>
&lt;li>buildkit: ä¿®å¤äº†åœ¨è§¦å‘ &lt;code>ONBUILD&lt;/code> è§„åˆ™ä¹‹åï¼Œæœªæ¸…ç†æ‰ &lt;code>ONBUILD&lt;/code> è§„åˆ™çš„é—®é¢˜ã€‚å¯¹äºä¾èµ– &lt;code>ONBUILD&lt;/code> æŒ‡ä»¤ï¼Œä¸”ä½¿ç”¨ buildkit çš„ç”¨æˆ·è€Œè¨€æ˜¯ä¸ªé‡è¦ä¿®å¤ï¼›&lt;/li>
&lt;li>buildkit: ä¿®å¤äº†å¯ç”¨äº† userns æ—¶ï¼Œå¯èƒ½å¯¼è‡´æƒé™é”™è¯¯çš„é—®é¢˜ï¼›&lt;/li>
&lt;li>&lt;strong>ä½¿ç”¨äº† libnetwork çš„çŸ­ ID, ä»¥é¿å…é‡åˆ° &lt;code>UNIX_PATH_MAX&lt;/code> çš„é”™è¯¯&lt;/strong>;&lt;/li>
&lt;/ul>
&lt;p>è¯´åˆ°è¿™ä¸ªé—®é¢˜ï¼Œå…¶å®ä¹Ÿè›®æœ‰è¶£çš„ï¼Œå¯èƒ½ä¸å°‘äººéƒ½é‡åˆ°è¿‡ç±»ä¼¼çš„é—®é¢˜ã€‚å½“ç„¶æˆ‘ä¹Ÿæƒ³åœ¨è¿™ä¸ª &lt;code>UNIX_PATH_MAX&lt;/code> çš„é—®é¢˜ä¸Šç¨å¾®å¤šèŠä¸€ç‚¹ã€‚&lt;/p>
&lt;p>è¿™ä¸ªé—®é¢˜å…¶å®åœ¨å››äº”å¹´å‰æˆ‘åœ¨ Docker é¡¹ç›®ä¸­å…¶ä»–çš„éƒ¨åˆ†å°±é‡åˆ°è¿‡ï¼Œè§£å†³èµ·æ¥ä¹Ÿç®€å•å°±æ˜¯ç¼©çŸ­è·¯å¾„é•¿åº¦å³å¯ã€‚ä½†ä½ å¯èƒ½ä¼šå¥½å¥‡ï¼Œè¦ç¼©çŸ­åˆ°ä»€ä¹ˆç¨‹åº¦å‘¢ï¼Ÿå¤šé•¿æ˜¯åˆç†å€¼å‘¢ï¼Ÿ&lt;/p>
&lt;p>å…¶å®è¿™ä¸ªé—®é¢˜è¦æ·±ç©¶çš„è¯ï¼ŒèƒŒåæœ‰è›®å¤šå†å²çš„ï¼Œè¿™é‡Œæˆ‘å…ˆè·³è¿‡ã€‚æˆ‘ä¸»è¦è¯´ä¸‹ç›®å‰çš„é™åˆ¶æ˜¯ä»€ä¹ˆï¼Œè¿™ä¸ªé™åˆ¶å¯ä»¥åœ¨ &lt;a href="https://github.com/torvalds/linux.git">Linux çš„æºç &lt;/a>ä¸­æ‰¾åˆ°çš„ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-c" data-lang="c">&lt;span class="c1">// include/uapi/linux/un.h
&lt;/span>&lt;span class="c1">&lt;/span>&lt;span class="cp">#ifndef _LINUX_UN_H
&lt;/span>&lt;span class="cp">#define _LINUX_UN_H
&lt;/span>&lt;span class="cp">&lt;/span>
&lt;span class="cp">#include&lt;/span> &lt;span class="cpf">&amp;lt;linux/socket.h&amp;gt;&lt;/span>&lt;span class="cp">
&lt;/span>&lt;span class="cp">&lt;/span>
&lt;span class="cp">#define UNIX_PATH_MAX 108
&lt;/span>&lt;span class="cp">&lt;/span>
&lt;span class="k">struct&lt;/span> &lt;span class="n">sockaddr_un&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="n">__kernel_sa_family_t&lt;/span> &lt;span class="n">sun_family&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="cm">/* AF_UNIX */&lt;/span>
&lt;span class="kt">char&lt;/span> &lt;span class="n">sun_path&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">UNIX_PATH_MAX&lt;/span>&lt;span class="p">];&lt;/span> &lt;span class="cm">/* pathname */&lt;/span>
&lt;span class="p">};&lt;/span>
&lt;span class="cp">#define SIOCUNIXFILE (SIOCPROTOPRIVATE + 0) &lt;/span>&lt;span class="cm">/* open a socket file with O_PATH */&lt;/span>&lt;span class="cp">
&lt;/span>&lt;span class="cp">&lt;/span>
&lt;span class="cp">#endif &lt;/span>&lt;span class="cm">/* _LINUX_UN_H */&lt;/span>&lt;span class="cp">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¯ä»¥çœ‹åˆ°ç°åœ¨å¤´æ–‡ä»¶ä¸­å®šä¹‰çš„æ˜¯ &lt;code>108&lt;/code> ã€‚ï¼ˆ &lt;strong>æ³¨æ„æˆ‘æ­¤å¤„ä½¿ç”¨çš„æ˜¯ Linux 5.4 ç‰ˆæœ¬çš„å†…æ ¸&lt;/strong> ï¼‰&lt;/p>
&lt;p>å¦å¤–ï¼Œè¿™ä¸ªå¤´æ–‡ä»¶å®šä¹‰åœ¨ &lt;code>include/uapi/linux/un.h&lt;/code> è¿™ä¸ª &lt;code>uapi&lt;/code> ç›®å½•å¯èƒ½æœ‰äº›äººä¼šè§‰å¾—é™Œç”Ÿï¼Œå…¶å®å®ƒæ˜¯åœ¨ Linux 3.x æ–°å¢çš„ï¼Œå…¶ä¸­åŒ…å«çš„å†…å®¹åŸºæœ¬å°±æ˜¯åŸæœ¬æ•£è½åœ¨å„å¤„çš„å¤´æ–‡ä»¶ã€‚è¿™ä¹Ÿæ˜¯ä¸ºäº†è§£å†³ Linux ä¸­å¾ªç¯å¼•ç”¨çš„é—®é¢˜ã€‚&lt;/p>
&lt;p>æœ‰ç‚¹è·‘é¢˜äº†ï¼Œå›åˆ° Docker v19.03.6 ç‰ˆæœ¬ä¸Šï¼Œå¦‚æœä½ å¯¹æ­¤ç‰ˆæœ¬æœ‰æ‰€æœŸå¾…ï¼Œå¯ä»¥æŠ¢å…ˆå°è¯•ä¸‹å½“å‰çš„ rc ç‰ˆã€‚å¦‚æœè¿½æ±‚ç¨³å®šï¼Œå¯ä»¥å†ç¨å¾®ç­‰å‡ å¤©ï¼Œç­‰æ­£å¼ç‰ˆæœ¬å‘å¸ƒï¼ˆå¤§æ¦‚åœ¨ä¸¤å‘¨å†…ï¼‰ã€‚&lt;/p>
&lt;p>æ­¤å¤„ç ´ä¾‹æ¨èä¸‹æˆ‘çš„ä¸“æ  &lt;a href="https://gitbook.cn/gitchat/column/5d70cfdc4dc213091bfca46f">ã€ŠDocker æ ¸å¿ƒçŸ¥è¯†å¿…çŸ¥å¿…ä¼šã€‹&lt;/a>ï¼Œå½“å‰å†…å®¹å·²ç»æ›´æ–°äº†ä¸€åŠä»¥ä¸Šï¼Œä»¥ Docker çš„æœ€æ–°ç‰ˆæœ¬ä¸ºåŸºç¡€ï¼Œå¯¹æ¯”æ—§ç‰ˆæœ¬åŠ Docker ä¸Šæ¸¸å‘å±•çš„å·®å¼‚ï¼Œå¹¶å¯¹æ¯ä¸ªæ ¸å¿ƒçŸ¥è¯†ç‚¹è¿›è¡Œç”±æµ…å…¥æ·±ã€ä»å®è·µåˆ°å†…éƒ¨åŸç†çš„è®²è§£ï¼Œå…¶ä¸­ä¹ŸåŒ…å«äº†ä¸€äº› Linux å†…æ ¸ç›¸å…³çš„çŸ¥è¯†ã€‚æ„Ÿè°¢è®¢é˜…ã€‚&lt;/p>
&lt;h2 id="containerd-v133-å‘å¸ƒ">containerd v1.3.3 å‘å¸ƒ&lt;/h2>
&lt;p>æœ¬å‘¨ containerd v1.3.3 å‘å¸ƒï¼Œå¸¦æ¥äº†ä¸€äº›é‡è¦çš„ä¿®å¤å’Œæ›´æ–°ï¼š&lt;/p>
&lt;ul>
&lt;li>runtime v2 æ–¹é¢ï¼Œå°† runc shim ä¸­ &lt;code>platform&lt;/code> çš„å…³é—­æµç¨‹ç§»åˆ°äº† &lt;code>Shutdown&lt;/code> æ–¹æ³•ä¸­ï¼Œè¿™æ ·å¯ä»¥ç¡®ä¿ &lt;code>platform&lt;/code> åªå…³é—­ä¸€æ¬¡ï¼›&lt;/li>
&lt;li>&lt;strong>ä¿®å¤äº†ä¸€ä¸ª containerd v1.3.0+ ç‰ˆæœ¬åŠä»¥ä¸Š exec æ—¶å­˜åœ¨çš„ eventfd æ³„æ¼çš„ bug ï¼›&lt;/strong>&lt;/li>
&lt;/ul>
&lt;p>å¦å¤–ï¼Œæœ¬å‘¨ &lt;strong>containerd ä¹Ÿå‘å¸ƒäº† v1.2.12 ç‰ˆæœ¬&lt;/strong> ã€‚&lt;/p>
&lt;p>è¿™ä¸¤ä¸ªç‰ˆæœ¬ä¸­å‡åŒ…å«äº†ä¸€ç³»åˆ—é‡è¦çš„å®‰å…¨æ›´æ–° &lt;a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-19921">CVE-2019-19921&lt;/a> ã€&lt;a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-16884">CVE-2019-16884&lt;/a> å’Œ &lt;a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-0601">CVE-2020-0601&lt;/a>&lt;/p>
&lt;p>å»ºè®®ï¼Œå¦‚æœæœ‰åœ¨ä½¿ç”¨ containerd çš„æœ‹å‹è¯·å°½æ—©æ›´æ–°ã€‚è¿™ä¸¤ä¸ªç‰ˆæœ¬æ›´è¯¦ç»†çš„å˜æ›´ï¼Œè¯·å‚è€ƒ &lt;a href="https://github.com/containerd/containerd/releases/tag/v1.2.12">containerd v1.2.12 çš„ ReleaseNote&lt;/a> å’Œ &lt;a href="https://github.com/containerd/containerd/releases/tag/v1.3.3">containerd v1.3.3 çš„ ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="cncf-å‘å¸ƒäº†-containerd-é¡¹ç›®çš„æ—…ç¨‹æŠ¥å‘Š">CNCF å‘å¸ƒäº† containerd é¡¹ç›®çš„æ—…ç¨‹æŠ¥å‘Š&lt;/h2>
&lt;p>CNCF å¯¹ containerd è‡ªåˆ›å»ºåˆ°æ¯•ä¸šåé¡¹ç›®çš„æ´»è·ƒåº¦åŠç¤¾åŒºå‘å±•ç­‰ç»´åº¦è¿›è¡Œäº†è°ƒç ”ï¼Œå¹¶ç»™å‡ºäº†ç›¸åº”çš„æŠ¥å‘Šã€‚&lt;/p>
&lt;p>æ•´ä½“æ¥çœ‹ï¼Œcontainerd è‡ªæ‰“ä» Docker ä¸­è¯ç”Ÿå¼€å§‹ï¼Œæˆªè‡³ç›®å‰é¡¹ç›®åŠç¤¾åŒºå‘å±•éƒ½æŒºä¸é”™ã€‚&lt;/p>
&lt;p>å¯¹æ­¤æŠ¥å‘Šæ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥å‚è€ƒ &lt;a href="https://www.cncf.io/cncf-containerd-project-journey/">CNCF çš„æŠ¥å‘Š: CNCF containerd Project Journey Report&lt;/a> ã€‚&lt;/p>
&lt;h2 id="docker-å°†å…³é—­æ—§çš„-apt-å’Œ-yum-ä»“åº“">Docker å°†å…³é—­æ—§çš„ APT å’Œ YUM ä»“åº“&lt;/h2>
&lt;p>Docker project äº 2013 å¹´åœ¨ PyCon ä¸Šé¦–æ¬¡æ­£å¼äº®ç›¸ï¼Œå¹¶é€æ­¥æˆé•¿ä¸ºç¤¾åŒºé¡¹ç›®ï¼Œæ‰€ä»¥å½“æ—¶å°±æ³¨å†Œäº† &lt;code>dockerproject.org&lt;/code> å’Œ &lt;code>dockerproject.com&lt;/code> çš„åŸŸåï¼Œå¹¶ä¸”åæ¥åœ¨è¿™ä¸¤ä¸ªåŸŸåä¹‹ä¸‹æ‰˜ç®¡äº† APT å’Œ YUM ä»“åº“ã€‚&lt;/p>
&lt;p>åæœŸéšç€ Docker Inc. çš„æˆç«‹ï¼Œä¸ºäº†æ›´å¥½çš„ä¸“æ³¨äº Docker çš„äº§å“ ï¼ˆCE å’Œ EEï¼‰ï¼Œæ‰€ä»¥å°±æ³¨å†Œäº† &lt;code>docker.com&lt;/code> çš„åŸŸåã€‚å¹¶ä¸”æ­£å¼å°† APT å’Œ YUM ä»“åº“æ‰˜ç®¡åˆ°äº† &lt;a href="https://download.docker.com/">&lt;code>download.docker.com&lt;/code>&lt;/a>ã€‚&lt;/p>
&lt;p>ç°åœ¨å‡ ä¹æ‰€æœ‰äººéƒ½å·²ç»åœ¨ä½¿ç”¨æ–°çš„ &lt;code>download.docker.com&lt;/code> çš„ä»“åº“äº†ï¼ˆå¦‚æœä½ è¿˜æ²¡æœ‰ä½¿ç”¨ï¼Œè¯·å°½å¿«æ›´æ–°ï¼‰ã€‚&lt;/p>
&lt;p>é‡ç‚¹ï¼š &lt;strong>Docker Inc è®¡åˆ’åœ¨ 2020 å¹´ 3 æœˆ 31 æ—¥åœæ­¢è€æ—§çš„ &lt;code>dockerproject.org&lt;/code> å’Œ &lt;code>dockerproject.com&lt;/code> åŸŸåä¸‹æ‰˜ç®¡çš„ APT å’Œ YUM ä»“åº“äº†ï¼&lt;/strong>&lt;/p>
&lt;p>è¯·å¤§å®¶å°½æ—©&lt;a href="https://docs.docker.com/install/">æŒ‰ Docker å®˜æ–¹æ–‡æ¡£ä¸­çš„å®‰è£…è¯´æ˜&lt;/a> å®‰è£… Dockerï¼Œå¹¶åœæ­¢ä½¿ç”¨è€æ—§çš„ä»“åº“åŸŸåã€‚&lt;/p>
&lt;h2 id="ä¸Šæ¸¸è¿›å±•">ä¸Šæ¸¸è¿›å±•&lt;/h2>
&lt;p>&lt;code>kubectl run&lt;/code> æƒ³å¿…å¤§å®¶éƒ½ä¸é™Œç”Ÿå§ï¼Œå¯ä»¥ç”¨å®ƒæ¥æ‰‹åŠ¨åˆ›å»ºå„ç§èµ„æºã€‚&lt;/p>
&lt;p>&lt;strong>åœ¨ Kubernetes v1.18 ä¸­ï¼Œä¼šå°†ä¹‹å‰å·²æ ‡æ³¨è¿‡æœŸçš„å„ç±» generator éƒ½ç§»é™¤æ‰ã€‚&lt;/strong> ä¹Ÿå°±æ˜¯è¯´ï¼Œè‡ª v1.18 èµ·ä½¿ç”¨ &lt;code>kubectl run&lt;/code> å‘½ä»¤ä¸»è¦å°±æ˜¯åˆ›å»º Pod äº†ï¼Œè€Œä¸ä¼šåˆ›å»ºå¤šä½™çš„ deploy ä¹‹ç±»çš„ã€‚&lt;/p>
&lt;p>è‡³äºåƒ &lt;code>service&lt;/code> åŠ äº† &lt;code>--expose&lt;/code> å€’ä¹Ÿè¿˜å¯ä»¥åˆ›å»ºï¼Œåªä¸è¿‡ç±»ä¼¼ &lt;code>--service-generator&lt;/code> è¿™ç±»å‚æ•°å°±ä¹Ÿéƒ½æ ‡è®°åºŸå¼ƒäº†ã€‚&lt;/p>
&lt;p>v1.18 ä¹‹å‰ç‰ˆæœ¬çš„æ‰§è¡Œç»“æœæ˜¯è¿™æ ·ï¼š&lt;/p>
&lt;pre>&lt;code>(MoeLove) âœ ~ kubectl run redis --image=&amp;quot;redis:alpine&amp;quot;
kubectl run --generator=deployment/apps.v1 is DEPRECATED and will be removed in a future version. Use kubectl run --generator=run-pod/v1 or kubectl create instead.
deployment.apps/redis created
(MoeLove) âœ ~ kubectl get all -l run=redis
NAME READY STATUS RESTARTS AGE
pod/redis-8544698fd7-tvz5q 1/1 Running 0 14s
NAME READY UP-TO-DATE AVAILABLE AGE
deployment.apps/redis 1/1 1 1 14s
NAME DESIRED CURRENT READY AGE
replicaset.apps/redis-8544698fd7 1 1 1 14s
&lt;/code>&lt;/pre>&lt;p>v1.18 ç‰ˆæœ¬ï¼š&lt;/p>
&lt;pre>&lt;code>(MoeLove) âœ bin ./kubectl run redis-new --image=&amp;quot;redis:alpine&amp;quot;
pod/redis-new created
(MoeLove) âœ bin ./kubectl get all -l run=redis-new
NAME READY STATUS RESTARTS AGE
pod/redis-new 1/1 Running 0 12s
&lt;/code>&lt;/pre>&lt;h2 id="é¢˜å¤–è¯">é¢˜å¤–è¯&lt;/h2>
&lt;p>è¿˜æ˜¯é‚£å¥è€è¯ï¼Œæ³¨æ„å‹¤æ´—æ‰‹ï¼Œå¤šå–æ°´ï¼Œæ³¨æ„ä¼‘æ¯ï¼Œç…§é¡¾å¥½å®¶äººã€‚&lt;/p>
&lt;p>åœ¨å®¶å®…ç€ä¹Ÿåˆ«å¿˜è®°å­¦ä¹ ï¼Œå†æ¬¡æ¨èæˆ‘çš„ä¸“æ  &lt;a href="https://gitbook.cn/gitchat/column/5d70cfdc4dc213091bfca46f">ã€ŠDocker æ ¸å¿ƒçŸ¥è¯†å¿…çŸ¥å¿…ä¼šã€‹&lt;/a>&lt;/p>
&lt;hr>
&lt;p>å¯ä»¥é€šè¿‡ä¸‹é¢äºŒç»´ç è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘ï¼Œåœ¨å…¬ä¼—å·åå°å›å¤ k8s å¯åŠ å…¥æŠ€æœ¯åœˆäº¤æµã€‚ç‚¹å‡»é˜…è¯»åŸæ–‡æœ‰æ›´å¥½çš„é˜…è¯»ä½“éªŒã€‚&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>ä½¿ç”¨ Kind åœ¨ç¦»çº¿ç¯å¢ƒåˆ›å»º K8S é›†ç¾¤</title><link>https://moelove.info/2020/02/05/%E4%BD%BF%E7%94%A8-Kind-%E5%9C%A8%E7%A6%BB%E7%BA%BF%E7%8E%AF%E5%A2%83%E5%88%9B%E5%BB%BA-K8S-%E9%9B%86%E7%BE%A4/</link><guid isPermaLink="true">https://moelove.info/2020/02/05/%E4%BD%BF%E7%94%A8-Kind-%E5%9C%A8%E7%A6%BB%E7%BA%BF%E7%8E%AF%E5%A2%83%E5%88%9B%E5%BB%BA-K8S-%E9%9B%86%E7%BE%A4/</guid><pubDate>Wed, 05 Feb 2020 12:14:04 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>&lt;a href="https://github.com/kubernetes-sigs/kind">Kind&lt;/a> æ˜¯æˆ‘å¾ˆå–œæ¬¢ä¹Ÿä¸€ç›´åœ¨å‚ä¸çš„é¡¹ç›®ï¼Œæˆ‘è®¡åˆ’å°† Kind ç›¸å…³çš„æ–‡ç« å†™æˆä¸€ä¸ªç³»åˆ—ã€‚è¿™æ˜¯ç¬¬äºŒç¯‡ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="èƒŒæ™¯">èƒŒæ™¯&lt;/h2>
&lt;p>&lt;a href="https://github.com/kubernetes-sigs/kind">Kind&lt;/a> æ˜¯ Kubernetes In Docker çš„ç¼©å†™ï¼Œé¡¾åæ€ä¹‰æ˜¯ä½¿ç”¨ Docker å®¹å™¨ä½œä¸º Node å¹¶å°† Kubernetes éƒ¨ç½²è‡³å…¶ä¸­çš„ä¸€ä¸ªå·¥å…·ã€‚ç°åœ¨åŒ…æ‹¬ Kubernetes è‡ªèº«åœ¨å†…çš„å¾ˆå¤šäº‘åŸç”ŸåŸºç¡€é¡¹ç›®éƒ½å°† Kind åº”ç”¨äºè‡ªèº«çš„ e2e æµ‹è¯•æˆ–é¡¹ç›®çš„å…¥é—¨ç¤ºä¾‹ä¸­ã€‚&lt;/p>
&lt;p>é»˜è®¤æƒ…å†µä¸‹ä½¿ç”¨ Kind åˆ›å»º Kubernetes é›†ç¾¤ï¼Œåªéœ€è¦&lt;a href="https://kind.sigs.k8s.io/#installation-and-usage">å…ˆå®‰è£…å¥½ Kind æ‰§è¡Œ &lt;code>kind create cluster&lt;/code> ä¾¿å¯&lt;/a>ï¼Œ Kind ä¼šè‡ªåŠ¨ä¸‹è½½æ‰€éœ€çš„ Docker é•œåƒï¼Œå¹¶å¯åŠ¨é›†ç¾¤ã€‚&lt;/p>
&lt;p>ä½†æ˜¯ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¹Ÿä¼šæœ‰éœ€è¦åœ¨ç¦»çº¿ç¯å¢ƒä¸­å¯åŠ¨ Kubernetes é›†ç¾¤çš„éœ€æ±‚ã€‚æœ¬ç¯‡æ–‡ç« æˆ‘æ¥ä¸ºä½ ä»‹ç»ä¸¤ç§ä½¿ç”¨ Kind åœ¨ç¦»çº¿ç¯å¢ƒåˆ›å»º Kubernetes é›†ç¾¤çš„æ–¹å¼ã€‚&lt;/p>
&lt;h2 id="ä½¿ç”¨é¢„æ„å»ºé•œåƒ">ä½¿ç”¨é¢„æ„å»ºé•œåƒ&lt;/h2>
&lt;p>Kind åœ¨æ¯æ¬¡å‘å¸ƒç‰ˆæœ¬æ—¶ï¼Œä¼šåŒæ—¶æ„å»ºå¹¶å‘å¸ƒé»˜è®¤ä½¿ç”¨çš„é•œåƒï¼Œç›®å‰&lt;a href="https://hub.docker.com/r/kindest/node/tags">æ‰˜ç®¡åœ¨ Docker Hub &lt;/a>ä¸Šã€‚å»ºè®®ä½ ä½¿ç”¨åœ¨æ¯æ¬¡ &lt;a href="https://github.com/kubernetes-sigs/kind/releases">ReleaseNote&lt;/a> ä¸­æŒ‡å®šäº† shasum çš„é•œåƒã€‚&lt;/p>
&lt;p>å½“ä½ åœ¨ç¦»çº¿ç¯å¢ƒä¸­æƒ³è¦ä½¿ç”¨ Kind é¢„æ„å»ºçš„é•œåƒåˆ›å»ºé›†ç¾¤æ—¶ï¼Œä½ å¯ä»¥åœ¨ä»»æ„å¯è”ç½‘çš„æœºå™¨ä¸Šæˆ–ç›®æ ‡æœºå™¨ä¸Šæœ‰ç½‘ç»œçš„æƒ…å†µä¸‹ï¼Œæå‰ä¸‹è½½è¯¥é•œåƒï¼Œå¹¶æ‹·è´è‡³éœ€è¦åˆ›å»ºé›†ç¾¤çš„ç›®æ ‡æœºå™¨ä¸Šã€‚&lt;/p>
&lt;p>å¦‚æœä½ çš„æœºå™¨ä¸Šå·²ç»&lt;a href="https://docs.docker.com/install/">å®‰è£…äº† Docker&lt;/a>ï¼Œé‚£å¯ä»¥ç›´æ¥ä½¿ç”¨ &lt;code>docker pull&lt;/code> å‘½ä»¤ä¸‹è½½é•œåƒï¼š&lt;/p>
&lt;pre>&lt;code>(MoeLove) âœ ~ docker pull kindest/node:v1.17.0@sha256:9512edae126da271b66b990b6fff768fbb7cd786c7d39e86bdf55906352fdf62
sha256:9512edae126da271b66b990b6fff768fbb7cd786c7d39e86bdf55906352fdf62: Pulling from kindest/node
cc5a81c29aab: Pull complete
81c62728355f: Pull complete
ed9cffdd962a: Pull complete
6a46f000fce2: Pull complete
6bd890da28be: Pull complete
0d88bd219ffe: Pull complete
af5240f230f0: Pull complete
Digest: sha256:9512edae126da271b66b990b6fff768fbb7cd786c7d39e86bdf55906352fdf62
Status: Downloaded newer image for kindest/node@sha256:9512edae126da271b66b990b6fff768fbb7cd786c7d39e86bdf55906352fdf62
docker.io/kindest/node:v1.17.0@sha256:9512edae126da271b66b990b6fff768fbb7cd786c7d39e86bdf55906352fdf62
&lt;/code>&lt;/pre>&lt;p>æ¥ä¸‹æ¥ï¼Œä½ å¯ä»¥ä½¿ç”¨ &lt;code>docker save&lt;/code> å‘½ä»¤ï¼Œå°†é•œåƒä¿å­˜ä¸ºä¸€ä¸ª tar åŒ…ï¼š&lt;/p>
&lt;pre>&lt;code>(MoeLove) âœ ~ docker save -o kind.v1.17.0.tar kindest/node:v1.17.0@sha256:9512edae126da271b66b990b6fff768fbb7cd786c7d39e86bdf55906352fdf62
&lt;/code>&lt;/pre>&lt;p>å¦‚æœä½ è§‰å¾—é•œåƒä½“ç§¯å¤ªå¤§ï¼Œå¹¶ä¸”ä½ ä¹Ÿå·²ç»å®‰è£…äº† gzip çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼Œå°†é•œåƒä¿å­˜ä¸ºç» gzip æ ¼å¼çš„å‹ç¼©åŒ…ã€‚&lt;/p>
&lt;pre>&lt;code>(MoeLove) âœ ~ docker save kindest/node:v1.17.0@sha256:9512edae126da271b66b990b6fff768fbb7cd786c7d39e86bdf55906352fdf62 | gzip &amp;gt; kind.v1.17.0.tar.gz
&lt;/code>&lt;/pre>&lt;p>åœ¨ç›®æ ‡æœºå™¨ä¸Šï¼Œä½ å¯ä»¥ä½¿ç”¨ &lt;code>docker load&lt;/code> å‘½ä»¤å°†é•œåƒåŠ è½½è‡³ docker daemon çš„å­˜å‚¨ä¸­ï¼š&lt;/p>
&lt;pre>&lt;code>(MoeLove) âœ ~ docker load -i kind.v1.17.0.tar
Loaded image ID: sha256:ec6ab22d89efc045f4da4fc862f6a13c64c0670fa7656fbecdec5307380f9cb0
# æˆ–è€…
âœ ~ docker load -i kind.v1.17.0.tar.gz
Loaded image ID: sha256:ec6ab22d89efc045f4da4fc862f6a13c64c0670fa7656fbecdec5307380f9cb0
&lt;/code>&lt;/pre>&lt;p>è‡³æ­¤ï¼Œä½ ä¾¿å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤ï¼Œä½¿ç”¨å·²ç»å¯¼å…¥çš„é•œåƒæ¥åˆ›å»ºé›†ç¾¤ï¼š&lt;/p>
&lt;pre>&lt;code>(MoeLove) âœ ~ kind create cluster --image kindest/node:v1.17.0@sha256:9512edae126da271b66b990b6fff768fbb7cd786c7d39e86bdf55906352fdf62
Creating cluster &amp;quot;kind&amp;quot; ...
âœ“ Ensuring node image (kindest/node:v1.17.0) ğŸ–¼
âœ“ Preparing nodes ğŸ“¦
âœ“ Writing configuration ğŸ“œ
âœ“ Starting control-plane ğŸ•¹ï¸
âœ“ Installing CNI ğŸ”Œ
âœ“ Installing StorageClass ğŸ’¾
Set kubectl context to &amp;quot;kind-kind&amp;quot;
You can now use your cluster with:
kubectl cluster-info --context kind-kind
Have a question, bug, or feature request? Let us know! https://kind.sigs.k8s.io/#community ğŸ™‚
&lt;/code>&lt;/pre>&lt;p>PSï¼šåœ¨ä¸‹è½½ Docker é•œåƒçš„æ­¥éª¤ä¸­ï¼Œå¦‚æœä½ æ²¡æœ‰å®‰è£… Dockerï¼Œé‚£ä½ ä¹Ÿå¯ä»¥æœ‰å…¶ä»–é€‰æ‹©ï¼Œæ¯”å¦‚ä½¿ç”¨ &lt;a href="https://github.com/containers/skopeo">skopeo&lt;/a> ä¹‹ç±»çš„å·¥å…·ã€‚&lt;/p>
&lt;h2 id="è‡ªè¡Œæ„å»ºé•œåƒ">è‡ªè¡Œæ„å»ºé•œåƒ&lt;/h2>
&lt;p>å¦‚æœä½ åœ¨å¯¹ Kubernetes è¿›è¡Œå¼€å‘ï¼Œæˆ–æ˜¯ Kind ç»´æŠ¤å›¢é˜Ÿæ²¡æœ‰å‘å¸ƒç‰¹å®š Kubernetes ç‰ˆæœ¬çš„é¢„æ„å»ºçš„é•œåƒï¼Œé‚£ä½ å¯ä»¥è‡ªè¡Œæ„å»ºé•œåƒã€‚&lt;/p>
&lt;p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ„å»ºé•œåƒæ—¶éœ€è¦ç½‘ç»œå’Œä¸€å®šçš„ç£ç›˜ç©ºé—´ã€‚ä½ å¯ä»¥åœ¨æ„å»ºå®Œé•œåƒåï¼Œä½¿ç”¨ä¸Šä¸€èŠ‚æåˆ°çš„åŠæ³•åœ¨ç¦»çº¿ç¯å¢ƒä½¿ç”¨ã€‚&lt;/p>
&lt;h3 id="æ„å»º-base-é•œåƒ">æ„å»º base é•œåƒ&lt;/h3>
&lt;p>éœ€è¦æå‰å‡†å¤‡å¥½ &lt;a href="https://github.com/kubernetes-sigs/kind">kind çš„æºä»£ç &lt;/a>&lt;/p>
&lt;pre>&lt;code>(MoeLove) âœ ~ mkdir -p $GOPATH/src/sigs.k8s.io
(MoeLove) âœ ~ cd $GOPATH/src/sigs.k8s.io
(MoeLove) âœ ~ git clone https://github.com/kubernetes-sigs/kind
&lt;/code>&lt;/pre>&lt;p>æ¥ä¸‹æ¥ä¾¿å¯ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ„å»º base é•œåƒäº†ã€‚&lt;/p>
&lt;pre>&lt;code>(MoeLove) âœ ~ kind build base-image --image kindest/base:latest --source $GOPATH/src/sigs.k8s.io/kind/images/base
Building base image in: /tmp/kind-base-image147474678
Starting Docker build ...
...
Successfully tagged kindest/base:latest
Docker build completed.
&lt;/code>&lt;/pre>&lt;p>æ„å»ºå®Œ base é•œåƒï¼Œè¿˜éœ€è¦ä»¥æ­¤é•œåƒä½œä¸ºåŸºç¡€æ„å»º node é•œåƒã€‚&lt;/p>
&lt;h3 id="æ„å»º-node-é•œåƒ">æ„å»º node é•œåƒ&lt;/h3>
&lt;p>ä½¿ç”¨æ­¤æ–¹æ³•ï¼Œéœ€è¦ä½ æå‰å‡†å¤‡å¥½ Kubernetes æºä»£ç ï¼Œä½ å¯ä»¥&lt;a href="https://github.com/kubernetes/kubernetes#you-have-a-working-go-environment">å‚è€ƒ Kubernetes é¡¹ç›®çš„è¯´æ˜&lt;/a>ä¸‹è½½ Kubernetes æºä»£ç ï¼Œæˆ–è€…å°†æºä»£ç æ‹·è´è‡³ç›®æ ‡æœºå™¨çš„å¯¹åº”ä½ç½®ã€‚&lt;/p>
&lt;pre>&lt;code>(MoeLove) âœ ~ mkdir -p $GOPATH/src/k8s.io
(MoeLove) âœ ~ cd $GOPATH/src/k8s.io
(MoeLove) âœ ~ git clone https://github.com/kubernetes/kubernetes
&lt;/code>&lt;/pre>&lt;p>æ¥ä¸‹æ¥ä½ ä¾¿å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ„å»º node é•œåƒäº†&lt;/p>
&lt;pre>&lt;code>(MoeLove) âœ ~ kind build node-image --base-image kindest/base:latest --image kindest/node:latest --kube-root $GOPATH/src/k8s.io/kubernetes
Starting to build Kubernetes
+++ [0205 11:21:38] Verifying Prerequisites....
...
Image build completed.
&lt;/code>&lt;/pre>&lt;p>é•œåƒæ„å»ºæˆåŠŸåï¼Œä¾¿å¯ä½¿ç”¨æ­¤é•œåƒæ¥åˆ›å»ºé›†ç¾¤äº†ã€‚&lt;/p>
&lt;pre>&lt;code>(MoeLove) âœ ~ kind create cluster --image kindest/node:latest
Creating cluster &amp;quot;kind&amp;quot; ...
âœ“ Ensuring node image (kindest/node:latest) ğŸ–¼
âœ“ Preparing nodes ğŸ“¦
âœ“ Writing configuration ğŸ“œ
âœ“ Starting control-plane ğŸ•¹ï¸
âœ“ Installing CNI ğŸ”Œ
âœ“ Installing StorageClass ğŸ’¾
Set kubectl context to &amp;quot;kind-kind&amp;quot;
You can now use your cluster with:
kubectl cluster-info --context kind-kind
Have a question, bug, or feature request? Let us know! https://kind.sigs.k8s.io/#community ğŸ™‚
&lt;/code>&lt;/pre>&lt;p>æ£€æŸ¥é›†ç¾¤èŠ‚ç‚¹ä¿¡æ¯&lt;/p>
&lt;pre>&lt;code>(MoeLove) âœ ~ kubectl get node
NAME STATUS ROLES AGE VERSION
kind-control-plane Ready master 40s v1.18.0-alpha.0.3222+4b294079458a72
&lt;/code>&lt;/pre>&lt;p>å¯ä»¥çœ‹åˆ°é›†ç¾¤ç‰ˆæœ¬æ˜¯å½“å‰ kubernetes æºç çš„ç‰ˆæœ¬äº†ã€‚&lt;/p>
&lt;h2 id="æ€»ç»“">æ€»ç»“&lt;/h2>
&lt;p>æœ¬æ–‡ä»‹ç»äº†ä¸¤ç±»ä½¿ç”¨ Kind åˆ›å»º Kubernetes é›†ç¾¤çš„æ–¹æ³•ï¼Œåˆ†åˆ«æ˜¯ä½¿ç”¨ Kind é¢„å‘å¸ƒçš„é•œåƒå’Œä½¿ç”¨ Kubernetes æºä»£ç æ„å»ºé•œåƒã€‚&lt;/p>
&lt;p>ä»¥ä¸Šä¸¤ç§æ–¹æ³•ï¼Œé•œåƒä¸­å‡å·²åŒ…å«åˆ›å»º Kubernetes é›†ç¾¤æ‰€éœ€çš„å…¨éƒ¨èµ„æºï¼Œæ— éœ€å†é¢å¤–ä¸‹è½½ã€‚(è¿™ä¹Ÿæ˜¯å’Œä¹‹å‰ç‰ˆæœ¬æœ€å¤§çš„åŒºåˆ«)&lt;/p>
&lt;h3 id="ç³»åˆ—æ–‡ç« ">ç³»åˆ—æ–‡ç« &lt;/h3>
&lt;ul>
&lt;li>&lt;a href="https://zhuanlan.zhihu.com/p/60464867">ã€Šä½¿ç”¨ Kind æ­å»ºä½ çš„æœ¬åœ° Kubernetes é›†ç¾¤ã€‹&lt;/a> (ä½¿ç”¨äº† 0.2.0 ç‰ˆæœ¬ï¼Œéƒ¨åˆ†å†…å®¹å·²è¿‡æœŸ)&lt;/li>
&lt;/ul>
&lt;h3 id="æ¨èé˜…è¯»">æ¨èé˜…è¯»&lt;/h3>
&lt;ul>
&lt;li>&lt;a href="https://mauilion.dev/posts/kind-k8s-testing/">How to Test a Kubernetes PR with KIND&lt;/a>&lt;/li>
&lt;/ul>
&lt;hr>
&lt;p>å¯ä»¥é€šè¿‡ä¸‹é¢äºŒç»´ç è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category><category domain="https://moelove.info/tags/Kind/">Kind</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| Rook v1.2.3 å‘å¸ƒ</title><link>https://moelove.info/2020/02/02/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Rook-v1.2.3-%E5%8F%91%E5%B8%83/</link><guid isPermaLink="true">https://moelove.info/2020/02/02/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Rook-v1.2.3-%E5%8F%91%E5%B8%83/</guid><pubDate>Sun, 02 Feb 2020 17:45:03 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="rook-v123-å‘å¸ƒ">Rook v1.2.3 å‘å¸ƒ&lt;/h2>
&lt;p>Rook æ˜¨å¤©å‘å¸ƒäº† v1.2.3 ç‰ˆæœ¬ï¼Œæ­¤ç‰ˆæœ¬ä¸­ä»ç„¶é‡ç‚¹æ˜¯å¯¹ Ceph ç›¸å…³çš„å†…å®¹åšäº†æ”¹è¿›ã€‚å€¼å¾—å…³æ³¨çš„å†…å®¹å¦‚ä¸‹ï¼š&lt;/p>
&lt;ul>
&lt;li>å…è®¸ä½¿ç”¨ &lt;a href="https://rook.io/docs/rook/v1.2/ceph-upgrade.html#enabling-the-csi-v20-driver">Ceph-CSI v2.0.0&lt;/a> é©±åŠ¨äº†ï¼Œä¸è¿‡é»˜è®¤è¿˜æ˜¯ä½¿ç”¨ CSI v1.2.2 ï¼›&lt;/li>
&lt;li>ä¿®æ­£äº† prepare job èµ„æºé…é¢çš„å¤„ç†é€»è¾‘ï¼›&lt;/li>
&lt;li>æ”¹å–„ ceph-volume çš„æ—¥å¿—è¾“å‡ºï¼Œæš´éœ²æ¯ä¸ª pvc ceph-volume æ—¥å¿—ï¼›&lt;/li>
&lt;li>ä¿®æ­£äº† CSI é©±åŠ¨çš„åƒåœ¾å›æ”¶æœºåˆ¶ï¼Œè¿™ä¸ªé—®é¢˜æ ¹æœ¬åŸå› æ˜¯èµ„æºçš„ OwnerReference æ‰€ä½¿ç”¨çš„ API é”™äº†ã€‚å¯èƒ½å¯¼è‡´çš„æƒ…å†µæ˜¯ï¼ŒæŸäº›æƒ…å†µä¸‹ CSI ç›¸å…³çš„ Pod è¢«æ¸…æ‰äº†ï¼›&lt;/li>
&lt;/ul>
&lt;p>å¯¹æ­¤ç‰ˆæœ¬æ„Ÿå…´è¶£çš„æœ‹å‹å¯å‚è€ƒå…¶ &lt;a href="https://github.com/rook/rook/releases/tag/v1.2.3">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="coredns-v167-å‘å¸ƒ">CoreDNS v1.6.7 å‘å¸ƒ&lt;/h2>
&lt;p>æœ¬å‘¨ CoreDNS v1.6.7 å‘å¸ƒäº†ï¼Œæ˜¯ä¸ªå°ç‰ˆæœ¬çš„æ›´æ–°ï¼Œéœ€è¦æ³¨æ„çš„æ›´æ–°å¦‚ä¸‹ï¼š&lt;/p>
&lt;ul>
&lt;li>plugin/{kubernetes, etcd}ï¼šå…è®¸é€šè¿‡ CNAME è§£æ TXT è®°å½•ã€‚è¿™ä¸ªæ›´æ–°æ˜¯ä¸º &lt;code>backend_lookup.go&lt;/code> ä¸­çš„ &lt;code>TXT&lt;/code> æ–¹æ³•å¢åŠ äº†ä¸€ä¸ªå‚æ•°ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯å½“å‰å·²ç»æ›´æ–°äº† &lt;code>kubernetes&lt;/code> å’Œ &lt;code>etcd&lt;/code> æ’ä»¶çš„ç›¸å…³è°ƒç”¨ï¼Œå¦‚æœæœ‰è‡ªå·±å®ç°æˆ–è€…ä½¿ç”¨å…¶ä»–ç¬¬ä¸‰æ–¹ plugin çš„è¯ï¼Œéœ€è¦æ³¨æ„ã€‚&lt;/li>
&lt;/ul>
&lt;p>å…¶ä»–æ›´æ–°è¯·å‚è€ƒ &lt;a href="https://coredns.io/2020/01/28/coredns-1.6.7-release/">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="rancher-v235-å‘å¸ƒ">Rancher v2.3.5 å‘å¸ƒ&lt;/h2>
&lt;p>è¿™ä¸ªç‰ˆæœ¬ä¸­æœ€ä¸»è¦çš„ä¿®å¤æ˜¯ä¸€å †å’Œä½¿ç”¨ Istio ç›¸å…³çš„å†…å®¹ã€‚ä»¥ä¸‹å†…å®¹æ˜¯ä» ReleaseNote æ‘˜å½•çš„ï¼Œæˆ‘æ²¡å¤ªå…³æ³¨ï¼Œå°±ä¸å±•å¼€äº†ã€‚&lt;/p>
&lt;ul>
&lt;li>Fixed a UI issue where Istio wasn't able to edit the Istio configuration after deployment [#25114]&lt;/li>
&lt;li>Fixed an issues around Istio being able to work in air gap setups [#25028]&lt;/li>
&lt;li>Fixed an issue where enabling SDS gateway in Istio failed [#25051]&lt;/li>
&lt;li>Fixed an issue where updates in Istio 1.4.3 requires new role data [#25077]&lt;/li>
&lt;li>Fixed a UI issue where member roles were unable to removed from clusters after creation [#24934]&lt;/li>
&lt;/ul>
&lt;p>å¯¹æ­¤ç‰ˆæœ¬æ„Ÿå…´è¶£çš„æœ‹å‹è¯·å‚é˜… &lt;a href="https://github.com/rancher/rancher/releases/tag/v2.3.5">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="æ¨èé˜…è¯»">æ¨èé˜…è¯»&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://www.docker.com/blog/solving-docker-compose-performance-on-macos-catalina/">How We Solved a Report on docker-compose Performance on macOS Catalina&lt;/a> è¿™ç¯‡æ–‡ç« ä»‹ç»äº† docker-compose çš„ç»´æŠ¤è€…è§£å†³äº†åœ¨ docker-compose åœ¨ macOS Catalina ä¸Šçš„æ€§èƒ½é—®é¢˜ï¼Œå¹¶å»ºè®®å‡çº§è‡³ v1.25.1 ç‰ˆæœ¬ä»¥ä¸Šã€‚&lt;/li>
&lt;li>&lt;a href="https://www.docker.com/blog/faster-builds-in-compose-thanks-to-buildkit-support/">Faster builds in Docker Compose 1.25.1 thanks to BuildKit Support&lt;/a> è¿™ç¯‡æ–‡ç« ä»‹ç»äº† docker-compose v1.25.1 ç‰ˆæœ¬å¼€å§‹å¯é€šè¿‡è®¾ç½® &lt;code>COMPOSE_DOCKER_CLI_BUILD=1&lt;/code> ç¯å¢ƒå˜é‡æ¥å¯ç”¨ buildkit çš„æ”¯æŒã€‚ï¼ˆéœ€åŒæ—¶è®¾ç½® &lt;code>DOCKER_BUILDKIT=1&lt;/code>ï¼‰&lt;/li>
&lt;/ul>
&lt;h2 id="é¢˜å¤–è¯">é¢˜å¤–è¯&lt;/h2>
&lt;p>è¿‘æœŸå¤§å®¶å¯èƒ½éƒ½è¿˜åœ¨å®¶ä¼‘æ¯ï¼Œæ³¨æ„å‹¤æ´—æ‰‹ï¼Œå¤šå–æ°´ï¼Œæ³¨æ„ä¼‘æ¯ï¼Œç…§é¡¾å¥½å®¶äººã€‚&lt;/p>
&lt;hr>
&lt;p>å¯ä»¥é€šè¿‡ä¸‹é¢äºŒç»´ç è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘ï¼Œåœ¨å…¬ä¼—å·åå°å›å¤ k8s å¯åŠ å…¥æŠ€æœ¯åœˆäº¤æµã€‚ç‚¹å‡»é˜…è¯»åŸæ–‡æœ‰æ›´å¥½çš„é˜…è¯»ä½“éªŒã€‚&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| runc v1.0.0-rc10 æ­£å¼å‘å¸ƒ</title><link>https://moelove.info/2020/01/26/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-runc-v1.0.0-rc10-%E6%AD%A3%E5%BC%8F%E5%8F%91%E5%B8%83/</link><guid isPermaLink="true">https://moelove.info/2020/01/26/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-runc-v1.0.0-rc10-%E6%AD%A3%E5%BC%8F%E5%8F%91%E5%B8%83/</guid><pubDate>Sun, 26 Jan 2020 10:21:24 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="kubernetes-å‘å¸ƒ-v1180-alpha2-ç‰ˆæœ¬">Kubernetes å‘å¸ƒ v1.18.0-alpha.2 ç‰ˆæœ¬&lt;/h2>
&lt;p>è¿™ä¸ªç‰ˆæœ¬åŒ…å«äº†ä¸å°‘å˜æ›´ï¼Œè¿™é‡Œåˆ—ä¸€äº›æˆ‘ä¸ªäººæ„Ÿè§‰æ¯”è¾ƒé‡è¦çš„å†…å®¹ï¼š&lt;/p>
&lt;ul>
&lt;li>ä¿®å¤äº†ä¸€ä¸ª &lt;code>kubectl apply --prune&lt;/code> æ—¶ï¼Œæœªæ¥æ”¶ kubectl æŒ‡å®š namespace çš„é—®é¢˜ &lt;a href="https://github.com/kubernetes/kubernetes/pull/85613">#85357&lt;/a>;&lt;/li>
&lt;li>ä¸º kubeadm åœ¨ pull image æ—¶å¢åŠ äº†è‡ªåŠ¨é‡è¯•ï¼Œé»˜è®¤æ˜¯ 5 æ¬¡ï¼›&lt;/li>
&lt;li>kubelet çš„ä¸€äº› metrics æ ‡è®°è¿‡æœŸï¼›&lt;/li>
&lt;li>å¯ä»¥ä¸º kubelet ä¼ é€’ &lt;code>--node-ip ::&lt;/code> é»˜è®¤è®¾ç½® IPv6 åœ°å€ä¸ºä¸»åœ°å€äº†ï¼›&lt;/li>
&lt;/ul>
&lt;p>å…³äºæ­¤ç‰ˆæœ¬çš„å…¶ä»–å˜æ›´ï¼Œè¯·æŸ¥çœ‹ &lt;a href="https://github.com/kubernetes/kubernetes/releases/tag/v1.18.0-alpha.2">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="runc-v100-rc10-æ­£å¼å‘å¸ƒ">runc v1.0.0-rc10 æ­£å¼å‘å¸ƒ&lt;/h2>
&lt;p>runc æƒ³å¿…å¤§å®¶ä¸ä¼šå¤ªé™Œç”Ÿï¼Œå…³æ³¨æˆ‘çš„æœ‹å‹å¤§å¤šéƒ½çœ‹åˆ°è¿‡æˆ‘ä¹‹å‰å‡ ç¯‡å…³äº runc çš„æ–‡ç« ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚&lt;/p>
&lt;p>æœ¬æ¬¡å‘å¸ƒçš„ç‰ˆæœ¬æœ€ä¸»è¦çš„ç›®çš„æ˜¯ä¿®å¤ &lt;a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-19921">CVE-2019-19921&lt;/a> ï¼Œç”±äº runc æ˜¯ä¸ªåŸºç¡€è½¯ä»¶ï¼Œç›®å‰ä¹Ÿå·²ç»å°† containerd å’Œ Docker åšäº†ç›¸åº”çš„æ›´æ–°å‡çº§ä»¥åº”å¯¹æ­¤æ¼æ´ã€‚&lt;/p>
&lt;p>å…³äºè¿™ä¸ªæ¼æ´çš„ä¿®å¤ä¸»è¦å°±æ˜¯é¿å…æŒ‚è½½ /proc åˆ°éç›®å½•ï¼Œä»¥é¿å…æ”»å‡»è€…åˆ©ç”¨è½¯é“¾çš„æ–¹å¼åˆ©ç”¨ runc å°† /proc æŒ‚è½½åˆ°å…¶ä»–çš„åœ°æ–¹å®ç°æ”»å‡»ã€‚&lt;/p>
&lt;p>å¦ä¸€ä¸ªé‡è¦å˜æ›´æ˜¯åœ¨ runc ä¸­å¢åŠ äº† cgroups2 çš„æ”¯æŒã€‚&lt;/p>
&lt;p>æƒ³å¿…ä¹‹å cgroups2 æ¨è¿›æ­¥ä¼èƒ½åŠ å¿«ä¸€äº›ã€‚æ›´å¤šå…³äºæ­¤ç‰ˆæœ¬çš„ä¿¡æ¯è¯·æŸ¥çœ‹ &lt;a href="https://github.com/opencontainers/runc/releases/tag/v1.0.0-rc10">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="ä¸Šæ¸¸è¿›å±•">ä¸Šæ¸¸è¿›å±•&lt;/h2>
&lt;p>åœ¨&lt;a href="https://zhuanlan.zhihu.com/p/103509475">ä¸Šå‘¨çš„ K8S å‘¨æŠ¥&lt;/a>ä¸­ï¼ŒKubernetes ä¸Šæ¸¸ç›¸ç»§å‘å¸ƒäº† v1.15.8ï¼Œv1.16.5 ä»¥åŠ v1.17.1 ä¸‰ä¸ªç‰ˆæœ¬ï¼Œä½†è¿™å‡ ä¸ªç‰ˆæœ¬çš„æ„å»ºä¿¡æ¯æœ‰è¯¯ï¼Œå¦‚æœä½ æ›´æ–°åˆ°è¿™äº›ç‰ˆæœ¬ä¼šå‘ç° &lt;code>version&lt;/code> å‘½ä»¤çš„ç»“æœæ˜¯é”™è¯¯çš„ã€‚&lt;/p>
&lt;p>&lt;strong>æ‰€ä»¥åœ¨æœ¬å‘¨åˆç´§æ€¥å‘å¸ƒäº† v1.15.9, v1.16.6 ä»¥åŠ v1.17.2 ç‰ˆæœ¬ã€‚å¦‚æœä½ è¿˜æ²¡æœ‰å‡çº§ï¼Œé‚£ä¹ˆè¯·ç›´æ¥å‡çº§åˆ°æœ¬æ¬¡å‘å¸ƒçš„è¿™äº›æ–°ç‰ˆæœ¬, è·³è¿‡ä¸Šå‘¨å‘å¸ƒçš„ç‰ˆæœ¬ã€‚å¦‚æœä½ å·²ç»å‡çº§çš„è¯ï¼Œé‚£æ›´åŠ å»ºè®®ä½ ç«‹åˆ»å‡çº§åˆ°æœ¬æ¬¡å‘å¸ƒçš„æœ€æ–°ç‰ˆæœ¬ï¼&lt;/strong>&lt;/p>
&lt;h2 id="é¡¹ç›®æ¨è">é¡¹ç›®æ¨è&lt;/h2>
&lt;p>&lt;a href="https://github.com/strimzi/strimzi-kafka-operator">strimzi-kafka-operator&lt;/a> æ˜¯ä¸€ä¸ªæ‰˜ç®¡äº CNCF sandbox çº§åˆ«çš„é¡¹ç›®ï¼Œè‡´åŠ›äºæ›´æ–¹ä¾¿çš„å°† kafka è¿è¡Œåœ¨ Kubernetes ä¹‹ä¸Šã€‚&lt;/p>
&lt;p>Strimzi æä¾›çš„ operator æ¶æ„å›¾å¦‚ä¸‹&lt;/p>
&lt;p>&lt;img src="https://strimzi.io/docs/quickstart/latest/images/operators.png" alt="strimzi-kafka-operator - https://moelove.info">&lt;/p>
&lt;h2 id="é¢˜å¤–è¯">é¢˜å¤–è¯&lt;/h2>
&lt;p>ç¥å¤§å®¶å¹³å®‰å–œä¹ï¼Œæ³¨æ„èº«ä½“ã€‚&lt;/p>
&lt;hr>
&lt;p>å¯ä»¥é€šè¿‡ä¸‹é¢äºŒç»´ç è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘ï¼Œåœ¨å…¬ä¼—å·åå°å›å¤ k8s å¯åŠ å…¥æŠ€æœ¯åœˆäº¤æµã€‚ç‚¹å‡»é˜…è¯»åŸæ–‡æœ‰æ›´å¥½çš„é˜…è¯»ä½“éªŒã€‚&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| Kind v0.7.0 æ­£å¼å‘å¸ƒ</title><link>https://moelove.info/2020/01/19/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Kind-v0.7.0-%E6%AD%A3%E5%BC%8F%E5%8F%91%E5%B8%83/</link><guid isPermaLink="true">https://moelove.info/2020/01/19/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Kind-v0.7.0-%E6%AD%A3%E5%BC%8F%E5%8F%91%E5%B8%83/</guid><pubDate>Sun, 19 Jan 2020 08:24:28 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="kind-kubernetes-in-docker-æ­£å¼å‘å¸ƒ-v070">Kind (Kubernetes in Docker) æ­£å¼å‘å¸ƒ v0.7.0&lt;/h2>
&lt;p>Kind (Kubernetes in Docker) æ˜¯æˆ‘å¾ˆå–œæ¬¢ä¹Ÿä¸€ç›´åœ¨å‚ä¸çš„é¡¹ç›®ï¼Œç°åœ¨åœ¨ GitHub ä¸Šæœ‰ 4.3k çš„ star ï¼Œæœ¬å‘¨æ­£å¼å‘å¸ƒäº† v0.7.0 æˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹åœ¨æ­¤ç‰ˆæœ¬ä¸­å¢åŠ äº†å“ªäº›æœ‰ç”¨çš„ç‰¹æ€§ã€‚&lt;/p>
&lt;h3 id="é‡å¤§å˜æ›´">é‡å¤§å˜æ›´&lt;/h3>
&lt;ul>
&lt;li>Kubernetes ç‰ˆæœ¬å‡çº§ï¼Œç°åœ¨é»˜è®¤çš„ Kubernetes ç‰ˆæœ¬å‡çº§ä¸º v1.17.0 , åœ¨ kind v0.6+ æ—¶å€™é»˜è®¤çš„ Kubernetes ç‰ˆæœ¬æ˜¯ v1.16.3;&lt;/li>
&lt;li>ä½¿ç”¨ kind v0.7.0 æ„å»ºçš„é•œåƒæœ‰å¾ˆå¤šæ”¹è¿›ï¼Œéœ€è¦è‡³å°‘ v0.5+ ç‰ˆæœ¬æ‰èƒ½ä¿æŒå…¼å®¹ï¼Œå¦‚æœæ˜¯æƒ³è¦ä½¿ç”¨åœ¨ v0.7 ç‰ˆæœ¬ä¸­æ–°å¢çš„å…¨éƒ¨ç‰¹æ€§ï¼Œå»ºè®®åŒæ—¶å‡çº§ kind äºŒè¿›åˆ¶æ–‡ä»¶ä»¥åŠæ›´æ–° node é•œåƒ;&lt;/li>
&lt;/ul>
&lt;h3 id="æ–°ç‰¹æ€§å¢åŠ ">æ–°ç‰¹æ€§å¢åŠ &lt;/h3>
&lt;ul>
&lt;li>é€šè¿‡é›†æˆ &lt;a href="https://github.com/rancher/local-path-provisioner">rancher.io/localhost-path&lt;/a> æä¾›äº†å¼€ç®±å³ç”¨çš„åŠ¨æ€å­˜å‚¨å·çš„æ”¯æŒï¼›&lt;/li>
&lt;li>æä¾›äº†ä½¿ç”¨ Ingress æš´éœ²éƒ¨ç½²åœ¨ Kind ä¸­æœåŠ¡çš„å¤šç§æ–¹å¼çš„æ–‡æ¡£ï¼ŒåŒ…æ‹¬ &lt;strong>Contour&lt;/strong> å’Œ &lt;strong>NGINX Ingress&lt;/strong> ;&lt;/li>
&lt;li>æ›´æ–°äº†ç›¸å…³çš„ä¾èµ–ï¼ŒåŒ…æ‹¬ä¿®å¤ CNI portmap æ’ä»¶ä»¥æé«˜ç¨³å®šæ€§ï¼›&lt;/li>
&lt;/ul>
&lt;h3 id="ä¿®å¤é—®é¢˜">ä¿®å¤é—®é¢˜&lt;/h3>
&lt;ul>
&lt;li>æå‡æ—¥å¿—æ¶ˆæ¯çš„å¯è¯»æ€§;&lt;/li>
&lt;li>ä¿®æ­£ &lt;code>kind load&lt;/code> é•œåƒåˆ° node èŠ‚ç‚¹ä¸Šä¹‹åçš„æ£€æŸ¥é€»è¾‘ï¼›&lt;/li>
&lt;li>å½“é»˜è®¤çš„ &lt;code>$HOME/.kube/config&lt;/code> æ–‡ä»¶ä¸å­˜åœ¨æ—¶ï¼Œåœ¨ &lt;code>kind create cluster&lt;/code> ä¹‹åï¼Œä¼šè‡ªåŠ¨æ ¹æ® kubeadm çš„ä¿¡æ¯è¡¥å……å…¶ä»–å­—æ®µï¼Œæ¯”å¦‚ &lt;code>kind&lt;/code> å’Œ &lt;code>apiVersion&lt;/code> ï¼›&lt;/li>
&lt;li>å‡å°é•œåƒçš„ä½“ç§¯ï¼›&lt;/li>
&lt;/ul>
&lt;p>åœ¨æˆ‘çš„ç”µè„‘ä¸Šå¦‚æœå¿½ç•¥æ‰é•œåƒä¸‹è½½è€—æ—¶ï¼Œä½¿ç”¨ kind v0.6+ ç‰ˆæœ¬ï¼Œåˆ›å»ºä¸€ä¸ªå•èŠ‚ç‚¹é›†ç¾¤è€—æ—¶æ˜¯ 52 ç§’ï¼Œè€Œå‡çº§è‡³ v0.7 åè€—æ—¶å¯ç¼©çŸ­åˆ° 46 ç§’ã€‚&lt;/p>
&lt;p>åœ¨åˆ›å»ºé›†ç¾¤åï¼Œé»˜è®¤æœ‰ä¸€ä¸ªåä¸º &lt;code>standard&lt;/code> çš„ StorageClass å¯ç›´æ¥ä½¿ç”¨ã€‚&lt;/p>
&lt;pre>&lt;code>(MoeLove) âœ ~ kubectl get nodes
NAME STATUS ROLES AGE VERSION
117-control-plane Ready master 66s v1.17.0
(MoeLove) âœ ~ kubectl get sc
NAME PROVISIONER RECLAIMPOLICY VOLUMEBINDINGMODE ALLOWVOLUMEEXPANSION AGE
standard (default) rancher.io/local-path Delete WaitForFirstConsumer false 65s
&lt;/code>&lt;/pre>&lt;p>æ¬¢è¿å¤§å®¶ä¸‹è½½ä½¿ç”¨ &lt;a href="https://github.com/kubernetes-sigs/kind/releases/tag/v0.7.0">https://github.com/kubernetes-sigs/kind/releases/tag/v0.7.0&lt;/a>&lt;/p>
&lt;h2 id="rancher-å‘å¸ƒ-v234-ç‰ˆæœ¬">Rancher å‘å¸ƒ v2.3.4 ç‰ˆæœ¬&lt;/h2>
&lt;p>å¤§è‡´éœ€è¦æ³¨æ„çš„å†…å®¹å¦‚ä¸‹ï¼š&lt;/p>
&lt;ul>
&lt;li>Kubernetes v1.17 æˆä¸ºäº†é»˜è®¤çš„ç‰ˆæœ¬ï¼›&lt;/li>
&lt;li>Istio å‡çº§è‡³ v1.4.3;&lt;/li>
&lt;li>ä¿®å¤äº†ä¸€äº›æ¯”å¦‚ label æ— æ³•æ·»åŠ ä¹‹ç±»çš„é—®é¢˜ï¼›&lt;/li>
&lt;/ul>
&lt;p>å…¶å®ä¿®å¤çš„å†…å®¹è¿˜æ¯”è¾ƒå¤šï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥çœ‹çœ‹å…¶ &lt;a href="https://github.com/rancher/rancher/releases/tag/v2.3.4">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="rook-å‘å¸ƒ-v122-ç‰ˆæœ¬">Rook å‘å¸ƒ v1.2.2 ç‰ˆæœ¬&lt;/h2>
&lt;p>Rook å‘å¸ƒçš„ v1.2.2 ä¸»è¦æ˜¯è¿›è¡Œ bugfix ã€‚è¿™ä¸ªç‰ˆæœ¬æœ€ä¸»è¦çš„å†…å®¹éƒ½é›†ä¸­åœ¨ Ceph ä¸Šï¼Œå…¶ä¸­æœ‰äº›å€¼å¾—å…³æ³¨çš„ç‚¹ï¼š&lt;/p>
&lt;ul>
&lt;li>æ”¯æŒå¤šä¸ªé›†ç¾¤è®¾ç½® &lt;code>useAllDevices&lt;/code> é€‰é¡¹ï¼Œå…¶æœ€ä¸»è¦çš„éœ€æ±‚æ¥è‡ªäºå½“åˆ›å»ºé›†ç¾¤å¤±è´¥ï¼Œæƒ³è¦é‡æ–°åˆ›å»ºé›†ç¾¤æ—¶ï¼Œä¹‹å‰ç‰ˆæœ¬ä¸­åªå…è®¸æœ‰ä¸€ä¸ªé›†ç¾¤èƒ½è®¾ç½®ä¸º &lt;code>useAllDevices&lt;/code>ï¼Œæ‰€ä»¥å°±ä¼šæŠ¥é”™äº†ã€‚æ›´æ–°è‡³æ­¤ v1.2.2 ç‰ˆæœ¬åï¼Œå°±å…è®¸å¤šä¸ªé›†ç¾¤éƒ½å¯ä»¥è®¾ç½® &lt;code>useAllDevices&lt;/code> é€‰é¡¹äº†ï¼›&lt;/li>
&lt;li>å°† example ä¸­ Ceph ç‰ˆæœ¬è®¾ç½®ä¸º v14.2.6ï¼›&lt;/li>
&lt;li>ä¿®å¤äº† &lt;code>CephMonHighNumberOfLeaderChanges&lt;/code> ä¸­é”™è¯¯çš„ Pod åç§°å’Œä¸»æœºåï¼›&lt;/li>
&lt;/ul>
&lt;p>æ›´å¤šè¯¦ç»†çš„å†…å®¹è¯·å‚è€ƒå…¶ &lt;a href="https://github.com/rook/rook/releases/tag/v1.2.2">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="ä¸Šæ¸¸è¿›å±•">ä¸Šæ¸¸è¿›å±•&lt;/h2>
&lt;p>Kubernetes æœ¬å‘¨ç›¸ç»§å‘å¸ƒäº† v1.15.8ï¼Œv1.16.5 ä»¥åŠ v1.17.1 ï¼Œè¿™å…¶ä¸­åŒ…å«äº†ä¸¤ä¸ªå¾ˆé‡è¦çš„ bugfixï¼Œ éœ€è¦æ³¨æ„ã€‚&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/pull/84951">84951&lt;/a> ä¿®å¤äº† kubelet å¯¹ static pod çŠ¶æ€çš„åŒæ­¥ï¼›&lt;/li>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/pull/86320">86320&lt;/a> ä¸º kubelet patch pod çŠ¶æ€æ—¶ï¼Œå¢åŠ äº†ä¸€ä¸ª uid ä»¥é¿å…å‡ºç°æ›´æ–°é”™è¯¯çš„æƒ…å†µï¼›&lt;/li>
&lt;/ul>
&lt;hr>
&lt;p>å¯ä»¥é€šè¿‡ä¸‹é¢äºŒç»´ç è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘ï¼Œåœ¨å…¬ä¼—å·åå°å›å¤ k8s å¯åŠ å…¥æŠ€æœ¯åœˆäº¤æµã€‚ç‚¹å‡»é˜…è¯»åŸæ–‡æœ‰æ›´å¥½çš„é˜…è¯»ä½“éªŒã€‚&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| Istio v1.4.3 å‘å¸ƒ</title><link>https://moelove.info/2020/01/12/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Istio-v1.4.3-%E5%8F%91%E5%B8%83/</link><guid isPermaLink="true">https://moelove.info/2020/01/12/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Istio-v1.4.3-%E5%8F%91%E5%B8%83/</guid><pubDate>Sun, 12 Jan 2020 20:18:09 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="prometheus-v2152-å‘å¸ƒ">Prometheus v2.15.2 å‘å¸ƒ&lt;/h2>
&lt;p>æœ¬å‘¨ Prometheus å‘å¸ƒäº† v2.15.2 ç‰ˆæœ¬ï¼Œå…¶ä¿®å¤äº†ä¸¤ä¸ª TSDB ç›¸å…³çš„é—®é¢˜ã€‚&lt;/p>
&lt;ul>
&lt;li>ä¿®å¤å¯¹ 2.1.0 ä¹‹å‰ç‰ˆæœ¬æ„å»ºçš„ TSDB å—çš„æ”¯æŒï¼Œè¿™ä¸ªé—®é¢˜ç›´æ¥å½±å“çš„æ˜¯é‚£äº›ç›´æ¥ä» 2.1.0 ç‰ˆæœ¬ä¹‹å‰ç›´æ¥å‡çº§åˆ° 2.15 çš„ç”¨æˆ·ï¼Œæ ¹æœ¬åŸå› æ˜¯åœ¨ 2.1.0 ç‰ˆæœ¬åŠ å…¥çš„ä¸€ä¸ªå¯¹ key æ’åºçš„ç‰¹æ€§ï¼›&lt;/li>
&lt;li>ä¿®å¤äº† TSDB åœ¨ Windows ä¸‹çš„å‹ç¼©é—®é¢˜ï¼›&lt;/li>
&lt;/ul>
&lt;p>å…¶ä»–å˜åŒ–ï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥å‚çœ‹å…¶ &lt;a href="https://github.com/prometheus/prometheus/releases/tag/v2.15.2">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="istio-v143-å‘å¸ƒ">Istio v1.4.3 å‘å¸ƒ&lt;/h2>
&lt;p>Istio å‘å¸ƒäº† v1.4.3 ç‰ˆæœ¬ï¼Œå¸¦æ¥äº†ä¼—å¤š bugfix å’Œæ”¹è¿›ï¼Œæˆ‘ä»¬æ¥å…·ä½“çœ‹çœ‹ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ä¿®å¤äº† Mixer ä¸º secret åˆ›å»ºå¤§é‡ watcher å¯èƒ½å¯¼è‡´ Kubernetes api-server OOM çš„é—®é¢˜ &lt;a href="https://github.com/istio/istio/issues/19481">#19481&lt;/a> ;&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä¿®å¤äº†æ³¨å…¥ç›¸å…³çš„æ¨¡æ¿ã€‚å½“ POD æœ‰å¤šä¸ª container ä½† container æœªæš´éœ²ç«¯å£æ—¶ï¼Œistio-proxy æ— æ³•å¯åŠ¨çš„é—®é¢˜ã€‚&lt;a href="https://github.com/istio/istio/issues/18594">#18594&lt;/a>ï¼›&lt;/p>
&lt;p>å¦‚æœåªæ˜¯æƒ³è¦ä¿®å¤è¿™ä¸ªé—®é¢˜çš„è¯ï¼Œä½ å¯ä»¥ç›´æ¥æ‰‹åŠ¨ä¿®æ”¹æ³¨å…¥ç›¸å…³çš„æ¨¡æ¿ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä¸ºæ‰€æœ‰æ³¨å…¥å®¹å™¨æ·»åŠ äº† PSP ç›¸å…³çš„é…ç½®å’Œæ”¯æŒ &lt;a href="https://github.com/istio/istio/pull/17427">#17427&lt;/a>&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>å…¶ä»–å˜åŒ–ï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥å‚çœ‹å…¶ &lt;a href="https://istio.io/news/releases/1.4.x/announcing-1.4.3/">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="falco-æ™‹çº§ä¸º-cncf-å­µåŒ–é¡¹ç›®">Falco æ™‹çº§ä¸º CNCF å­µåŒ–é¡¹ç›®&lt;/h2>
&lt;p>&lt;strong>&lt;a href="https://falco.org/">Falco&lt;/a> æ˜¯é¦–ä¸ªè¿›å…¥ CNCF å­µåŒ–çº§çš„è¿è¡Œæ—¶å®‰å…¨é¡¹ç›®ã€‚&lt;/strong>&lt;/p>
&lt;p>Falco æœ€åˆç”± Sysdig åœ¨ 2016 å¹´åˆ›å»ºï¼Œåœ¨ 2018 å¹´ 10 æœˆä»½æ­£å¼æˆä¸º CNCF sandbox çº§åˆ«çš„é¡¹ç›®ã€‚&lt;/p>
&lt;p>Falco æ˜¯ä¸€ä¸ªéå¸¸æœ‰ç”¨ä¸”æœ‰è¶£çš„é¡¹ç›®ï¼Œä½¿ç”¨å®ƒå¯ä»¥å¾ˆæ–¹ä¾¿çš„åšå®¹å™¨å®‰å…¨ç›¸å…³çš„äº‹æƒ…ï¼Œæ¯”å¦‚ï¼šå…¥ä¾µæ£€æµ‹ä¹‹ç±»çš„ã€‚åªéœ€è¦ç¼–å†™å¯¹åº”çš„è§„åˆ™æ–‡ä»¶å³å¯å®Œæˆã€‚&lt;/p>
&lt;p>ç°åœ¨å®¹å™¨åŒ–å’Œ Kubernetes æ„ˆå‘ç«çƒ­ï¼Œä½†å®‰å…¨ç›¸å…³çš„é—®é¢˜è¿˜ä¸å¤Ÿé‡è§†ï¼ŒFalco ç°åœ¨æ™‹çº§æˆä¸º CNCF çš„å­µåŒ–é¡¹ç›®ï¼Œæ— ç–‘èƒ½åœ¨æ­¤æ–¹é¢å¡«è¡¥ä¸€äº›ç©ºç¼ºã€‚&lt;/p>
&lt;h2 id="kubernetes-nginx-ingress-v0270-å‘å¸ƒ">Kubernetes NGINX Ingress v0.27.0 å‘å¸ƒ&lt;/h2>
&lt;p>ä¸»è¦å˜æ›´å¦‚ä¸‹ï¼š&lt;/p>
&lt;ul>
&lt;li>å‡çº§è‡³ NGINX 1.17.7ï¼›&lt;/li>
&lt;li>å…è®¸ä¸º Ingress å¼€å¯æˆ–å…³é—­ opentrace;&lt;/li>
&lt;li>&lt;code>lua-resty-waf&lt;/code> è¢«ç§»é™¤ï¼Œåˆ é™¤å®ƒçš„ä¸»è¦åŸå› æ˜¯æ„å»ºé•œåƒçš„å…³ç³»ï¼Œä¸”é¡¹ç›®ä¸å¤Ÿæ´»è·ƒï¼›&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>ç ´åæ€§å˜æ›´&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>æœ¬æ¬¡ç‰ˆæœ¬ä¸­ï¼Œå°† OpenResty å†æ¬¡æ›¿æ¢ä¸º NGINXï¼Œ ä¸”åŸºç¡€é•œåƒä½¿ç”¨äº† Alpine Linuxï¼Œ ç”±æ­¤é•œåƒä½“ç§¯å‡å°‘äº† 90M å·¦å³ï¼Œä¸”æ¼æ´å‡å·²ä¿®æ­£ã€‚&lt;/li>
&lt;/ul>
&lt;p>Kubernetes NGINX Ingress åœ¨ NGINX å’Œ OpenResty ä¸­æ¥å›åˆ‡æ¢ï¼Œå¦‚æœæœ‰ä¾èµ–äº OpenResty çš„æœ‹å‹ï¼Œéœ€è¦æ ¼å¤–æ³¨æ„ã€‚&lt;/p>
&lt;h2 id="ä¸Šæ¸¸è¿›å±•">ä¸Šæ¸¸è¿›å±•&lt;/h2>
&lt;ul>
&lt;li>API Server ç°åœ¨éœ€è¦ client å£°æ˜å…¶åè®®ç‰ˆæœ¬ &lt;a href="https://github.com/kubernetes/kubernetes/pull/86646">#86646&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="é¡¹ç›®æ¨è">é¡¹ç›®æ¨è&lt;/h2>
&lt;p>Grafana å¼€æºäº†ä¸€ä¸ªé¡¹ç›®ï¼Œåä¸º &lt;a href="https://github.com/grafana/tanka">Tanka&lt;/a> ä¸»è¦æ˜¯ä¸ºäº†æ›´çµæ´»çš„é…ç½®å’Œé‡ç”¨ã€‚&lt;/p>
&lt;p>å…·ä½“æ¥è¯´å°±æ˜¯å®ƒä½¿ç”¨ jsonnet ä½œä¸ºé…ç½®è¯­è¨€ï¼Œå¹¶ä¸”æä¾›äº†å‚æ•°åŠæŠ½è±¡ï¼Œä»¥åŠä¸€ä¸ªè‡ªå¸¦çš„ Kubernetes åº“ï¼Œå¯ä»¥æ›´åŠ æ–¹ä¾¿çš„è¿›è¡Œçµæ´»é…ç½®ã€‚&lt;/p>
&lt;p>åœ¨æˆ‘ä¸ªäººçœ‹æ¥ï¼Œå½“å‰å¯ç”¨çš„è¿™ç±»å·¥å…·å¤ªå¤šï¼Œå¤§è‡´ä¹Ÿå¯ä»¥ä¸ Helm æˆ– kustomize è¿›è¡Œç±»æ¯”ã€‚ä½†è‡³äºå¦‚ä½•é€‰æ‹©ï¼Œè¿˜æ˜¯çœ‹ä¸ªäººä¹ æƒ¯ä»¥åŠéœ€æ±‚ï¼ŒTanka çš„ä¼˜åŠ¿åŠä¾¿åˆ©æ€§æ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥è‡ªè¡Œå‘æ˜ä¸‹ï¼Œæˆ‘å°±ä¸è¿‡å¤šä»‹ç»äº†ã€‚&lt;/p>
&lt;p>(æˆ‘æ›´è§‰å¾—è¿™æ˜¯ jsonnet çš„ä¸€æ¬¡é‡ç”Ÿï¼Œå€¼å¾—æ¨èä¸€ä¸‹)&lt;/p>
&lt;hr>
&lt;p>å¯ä»¥é€šè¿‡ä¸‹é¢äºŒç»´ç è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘ï¼Œåœ¨å…¬ä¼—å·åå°å›å¤ k8s å¯åŠ å…¥æŠ€æœ¯åœˆäº¤æµã€‚ç‚¹å‡»é˜…è¯»åŸæ–‡æœ‰æ›´å¥½çš„é˜…è¯»ä½“éªŒã€‚&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| ç»ˆç«¯ä¸‹çš„ K8S èµ„æºæ ‘æŸ¥çœ‹å™¨</title><link>https://moelove.info/2020/01/05/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-%E7%BB%88%E7%AB%AF%E4%B8%8B%E7%9A%84-K8S-%E8%B5%84%E6%BA%90%E6%A0%91%E6%9F%A5%E7%9C%8B%E5%99%A8/</link><guid isPermaLink="true">https://moelove.info/2020/01/05/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-%E7%BB%88%E7%AB%AF%E4%B8%8B%E7%9A%84-K8S-%E8%B5%84%E6%BA%90%E6%A0%91%E6%9F%A5%E7%9C%8B%E5%99%A8/</guid><pubDate>Sun, 05 Jan 2020 09:52:30 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="ä¸Šæ¸¸è¿›å±•">ä¸Šæ¸¸è¿›å±•&lt;/h2>
&lt;ul>
&lt;li>Kubernetes v1.17.0 ä¸­ï¼Œå¦‚æœå°† CIDR è®¾ç½®ä¸ºä½äº &lt;code>/16&lt;/code> ä½ï¼Œåˆ™ IP åˆ†é…å™¨å¯èƒ½ä¼šæŠ¥é”™ã€‚è¿™ä¸ªé—®é¢˜å½“å‰å·²ç»åœ¨ &lt;a href="http://issue.k8s.io/86534">#86534&lt;/a>ä¸­ä¿®å¤ï¼Œå°†éšç€ v1.17.1 å‘å¸ƒï¼Œå¦‚æœå°šæœªå‡çº§è‡³ v1.17.0 çš„æœ‹å‹å¯ä»¥ç¨åï¼›&lt;/li>
&lt;li>api-server çš„ &lt;code>bind-address&lt;/code> æœ€è¿‘ç¨ä½œäº†è°ƒæ•´ï¼Œå¦‚æœæœªæŒ‡å®šæˆ–è€…ä½¿ç”¨ &lt;code>0.0.0.0&lt;/code> æˆ– &lt;code>::&lt;/code> åˆ™ä¼šç›‘å¬æœ¬åœ°çš„æ‰€æœ‰å¯ç”¨çš„åœ°å€ã€‚&lt;/li>
&lt;/ul>
&lt;h2 id="é¡¹ç›®æ¨è">é¡¹ç›®æ¨è&lt;/h2>
&lt;p>&lt;a href="https://github.com/ahmetb/kubectl-tree">kubectl-tree&lt;/a> æ˜¯ä¸€ä¸ªç”¨äºåœ¨ç»ˆç«¯å†…ä»¥æ ‘å½¢ç»“æ„å±•ç¤º Kubernetes èµ„æºçš„ Kubectl æ’ä»¶ã€‚ï¼ˆå·²ç»ç™»ä¸Šäº† GitHub çš„è¶‹åŠ¿æ¦œï¼‰&lt;/p>
&lt;p>ä½¿ç”¨æ•ˆæœå¦‚å›¾ï¼š&lt;/p>
&lt;p>&lt;img src="https://moelove.info/img/kubectl-tree.png" alt="kubectl-tree - https://moelove.info">&lt;/p>
&lt;p>åœ¨æˆ‘çš„ç»ˆç«¯ä¸‹ï¼Œå®ƒä¸èƒ½å¯¹é½ï¼Œä¸è¿‡æˆ‘è¿˜æ²¡æ¥å¾—åŠå…·ä½“å»çœ‹åŸå› ã€‚&lt;/p>
&lt;h2 id="æ–°é¡¹ç›®apisix-ingress-controller">æ–°é¡¹ç›®ï¼šAPISIX-ingress-controller&lt;/h2>
&lt;p>æœ€è¿‘çœ‹åˆ°ä¸€ä¸ªä¸º &lt;a href="https://github.com/apache/incubator-apisix">Apache APISIX&lt;/a> å®ç° Ingress Controller çš„é¡¹ç›® &lt;a href="https://github.com/iresty/ingress-controller">APISIX-ingress-controller&lt;/a>&lt;/p>
&lt;p>åŒæ—¶ä¹Ÿçœ‹åˆ°äº†&lt;a href="https://mp.weixin.qq.com/s?__biz=MzI1MDU3NjQ5OA==&amp;amp;mid=2247483714&amp;amp;idx=1&amp;amp;sn=9981994db87bdeb4e9e9f32ef0903197&amp;amp;chksm=e9816a5fdef6e349cf7c53edfd358cafc1f4055cefa9b88875417a43b89d777f42488db63b4f&amp;amp;mpshare=1&amp;amp;scene=1&amp;amp;srcid=&amp;amp;sharer_sharetime=1577773615386&amp;amp;sharer_shareid=f168231ea32e9fe3764a5ba7337ed0f7#rd">ä¸€ç¯‡æ–‡ç« : ä¸ºä»€ä¹ˆæˆ‘ä»¬é‡æ–°å†™äº†ä¸€ä¸ª k8s ingress controller &lt;/a> æ–‡ç« çš„ä½œè€…è§£é‡Šäº†ä¸ºä½•è¦é‡æ–°å†™ä¸€ä¸ª Ingress Controllerã€‚&lt;/p>
&lt;p>åœ¨æˆ‘ä¸ªäººçœ‹æ¥ï¼Œå¤šå®ç°ä¸€ç§ Ingress Controller å¯¹ç¤¾åŒºè€Œè¨€æ˜¯å¥½äº‹å„¿ï¼Œè®©å¤§å®¶æœ‰äº†&lt;a href="https://kubernetes.io/docs/concepts/services-networking/ingress-controllers/#additional-controllers">æ›´å¤šçš„é€‰æ‹©&lt;/a>ï¼Œå¦ä¸€æ–¹é¢ï¼Œè¿™ä¸ªé¡¹ç›®åˆšèµ·æ­¥ä¸ä¹…ï¼Œå¦‚æœæœ‰å¯¹å®ç° APISIX Ingress Controller æ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥å°½æ—©åŠ å…¥ã€‚&lt;/p>
&lt;p>( &lt;em>æŠ›å¼€æ­¤é¡¹ç›®ä¸è°ˆï¼Œå•çº¯è°ˆå†™ä¸€ä¸ªç®€å•çš„è‡ªå®šä¹‰ Ingress Controller å…¶å®æ¯”è¾ƒç®€å•ï¼Œå€’ä¹ŸæŒºæœ‰è¶£çš„ï¼Œåªä¸è¿‡åœ¨å¤„ç†ä¸€äº›é«˜çº§ç‰¹æ€§åŠå¤„ç†å¤§é‡è¯·æ±‚æ—¶ï¼Œä¸åŒçš„å®ç°ä¼šæœ‰äº›åŒºåˆ«ã€‚&lt;/em> æ¨èå¤§å®¶éƒ½å°è¯•ä¸‹&lt;/p>
&lt;h2 id="é¢˜å¤–è¯">é¢˜å¤–è¯&lt;/h2>
&lt;p>æœ€è¿‘æ°é€¢æ–°å¹´ï¼Œä¸Šæ¸¸çš„å˜æ›´ä¸å¤ªé¢‘ç¹ï¼ˆå¤§å¤šéƒ½ä¼‘å‡äº†ï¼‰ï¼Œå¤šæ•°çš„å˜æ›´ä¹Ÿéƒ½æ˜¯ä¸€äº›å°çš„ä¿®å¤å’Œæ¸…ç†å·¥ä½œã€‚&lt;/p>
&lt;p>å†æ¬¡ç¥å¤§å®¶æ–°å¹´å¿«ä¹&lt;/p>
&lt;hr>
&lt;p>å¯ä»¥é€šè¿‡ä¸‹é¢äºŒç»´ç è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘ï¼Œåœ¨å…¬ä¼—å·åå°å›å¤ k8s å¯åŠ å…¥æŠ€æœ¯åœˆäº¤æµã€‚&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>2019 å°å›é¡¾</title><link>https://moelove.info/2020/01/01/2019-%E5%B0%8F%E5%9B%9E%E9%A1%BE/</link><guid isPermaLink="true">https://moelove.info/2020/01/01/2019-%E5%B0%8F%E5%9B%9E%E9%A1%BE/</guid><pubDate>Wed, 01 Jan 2020 22:01:00 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>è¿™ç¯‡æ–‡ç« èµ·ç¬”äºä¸Šå‘¨ï¼ˆå¹´åº•ï¼‰ï¼Œä¸è¿‡å·¥ä½œæ¯”è¾ƒå¿™ï¼Œä¸€ç›´è€½æåˆ°ä»Šå¤©ï¼ˆ1 æœˆ 1 æ—¥ï¼‰æ‰æŠ½å‡ºæ—¶é—´ï¼Œç´¢æ€§å°±é‡å†™äº†ã€‚ç®—æ˜¯ä¸€ç¯‡å²å²å¿µï¼Œæƒ³åˆ°ä»€ä¹ˆå°±å†™ç‚¹ã€‚&lt;/p>
&lt;/blockquote>
&lt;p>è½¬çœ¼å·²æ˜¯ 2020 å¹´ 1 æœˆ 1 æ—¥äº†ï¼Œæƒ¯ä¾‹åšä¸ªå°å›é¡¾ã€‚
2019 å¹´å‘ç”Ÿäº†å¤ªå¤šäº‹æƒ…ï¼Œéå¸¸å€¼å¾—å¥½å¥½å›é¡¾ä¸€ä¸‹ã€‚æ¯å¹´çš„å›é¡¾ä¸ä»…æ˜¯å¯¹è¿‡å»ä¸€å¹´çš„æ€»ç»“ï¼Œä¹Ÿæ˜¯å¯¹æ–°çš„ä¸€å¹´åšä¸ªè®¡åˆ’ã€‚
ä¾æ—§æŒ‰ç…§æˆ‘æ¯å¹´çš„ä¹ æƒ¯ï¼Œåˆ†åˆ«ä»å·¥ä½œå’Œç”Ÿæ´»æ¥èŠèŠã€‚&lt;/p>
&lt;h2 id="å·¥ä½œ">å·¥ä½œ&lt;/h2>
&lt;p>2019 å¹´æˆ‘åšçš„äº‹æƒ…ï¼Œä¸»è¦æ¶‰åŠä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š&lt;/p>
&lt;ul>
&lt;li>Docker å®¹å™¨åŒ–å’Œ Kubernetes&lt;/li>
&lt;li>API Gateway&lt;/li>
&lt;li>CI/CD&lt;/li>
&lt;li>å­˜å‚¨&lt;/li>
&lt;li>ç›‘æ§&lt;/li>
&lt;li>å‘Šè­¦ä¿¡æ¯æ”¶æ•›&lt;/li>
&lt;/ul>
&lt;p>ä¹Ÿç®—æ˜¯æ¯”è¾ƒå…¸å‹çš„äº‘åŸç”Ÿå·¥ç¨‹å¸ˆçš„å·¥ä½œå†…å®¹äº†ï¼Œæ„Ÿè°¢åŒäº‹ä»¬çš„æ”¯æŒå’Œé…åˆã€‚&lt;/p>
&lt;p>2019 å¹´æ˜¯äº‘åŸç”Ÿå½¢åŠ¿å¤§å¥½çš„ä¸€å¹´ï¼Œè¿™ä¸€å¹´æ•´ä¸ªè¡Œä¸šå†…éƒ½å‘ç”Ÿäº†ä¸å°çš„å˜åŠ¨ï¼Œå…³æ³¨æˆ‘æ¯å‘¨æ¨é€çš„&lt;a href="https://zhuanlan.zhihu.com/container">ã€Œk8s ç”Ÿæ€å‘¨æŠ¥ã€&lt;/a>çš„å°ä¼™ä¼´å¯èƒ½å·²ç»å‘ç°ï¼Œå‘¨æŠ¥ä¸­æœ€å¤šçš„å†…å®¹æ˜¯ K8S ç”Ÿæ€ä¸­æ¯”è¾ƒæ ¸å¿ƒçš„è½¯ä»¶çš„ç‰ˆæœ¬å‘å¸ƒåŠåŠŸèƒ½å˜æ›´æˆ–æ¼æ´ç›¸å…³çš„ä¿¡æ¯ã€‚&lt;/p>
&lt;p>ä¸ºä»€ä¹ˆè¿™ç±»ä¿¡æ¯ä¼šè¿™ä¹ˆå¤šå‘¢ï¼Ÿä¸»è¦è¿˜æ˜¯å› ä¸º 2019 å¹´äº‘åŸç”Ÿæˆ–è€…è¯´ Kubernetes çš„æ™®åŠè¶Šæ¥è¶Šå¹¿æ³›ï¼Œéœ€æ±‚å¢å¤šï¼Œåœºæ™¯æ„ˆå‘å¤æ‚ï¼Œç›¸åº”çš„åƒ Docker, Kubernetes, Prometheus è¿™ç±»åŸºç¡€è½¯ä»¶ä¹Ÿå°±éœ€è¦æä¾›æ›´å¤šçš„ç‰¹æ€§æ”¯æŒï¼Œæˆ–è€… bugfix ã€‚æ‰€ä»¥æˆ‘åœ¨è¿™æ–¹é¢æŠ•å…¥çš„æ—¶é—´ä¹Ÿå°±æ›´å¤šä¸€äº›ã€‚&lt;/p>
&lt;p>æ­¤å¤–ï¼Œä» 19 å¹´ 3 æœˆåº•ï¼Œæˆ‘å¼€å§‹äº†æ¯å‘¨ &lt;a href="https://zhuanlan.zhihu.com/container">ã€Œk8s ç”Ÿæ€å‘¨æŠ¥ã€&lt;/a> çš„æ¨é€ï¼Œç›´åˆ°ä»Šå¤©å…±è®¡æ¨é€äº† 41 ç¯‡å‘¨æŠ¥ï¼Œæœªæ›¾è½ä¸‹ï¼Œä¹Ÿç§¯ç´¯äº†ä¸å°‘è¯»è€…ï¼Œæ„Ÿè°¢å¤§å®¶å…³æ³¨ã€‚&lt;/p>
&lt;p>ä»Šå¹´åœ¨ PyCon China çš„è§’è‰²ä»è®²å¸ˆå˜æˆäº†å‡ºå“äººï¼ŒåŸæœ¬è®¡åˆ’ä¼šæœ‰ä¸€ä¸ªä¸»é¢˜æ¼”è®²ï¼Œä½†æ˜¯ç”±äºè·Ÿæˆ‘çš„å©šç¤¼æ—¶é—´å†²çªäº†ï¼Œæ‰€ä»¥æœªèƒ½å‚åŠ ã€‚æ„Ÿè°¢ PyCon China çš„ä¸€ä¼—å°ä¼™ä¼´çš„è°…è§£å’Œæ”¯æŒã€‚&lt;/p>
&lt;p>åœ¨å›½åº†å‡æœŸç»“æŸåï¼Œæˆ‘åœ¨ GitChat ä¸Šå‘å¸ƒçš„ä¸“æ &lt;a href="https://gitbook.cn/gitchat/column/5d70cfdc4dc213091bfca46f">ã€ŠDocker æ ¸å¿ƒçŸ¥è¯†å¿…çŸ¥å¿…ä¼šã€‹&lt;/a>æ­£å¼ä¸Šçº¿äº†ï¼Œè‡³ä»Šä¸“æ å†…å®¹å·²ç»æ›´æ–°äº†ä¸€åŠï¼ŒæŒ‰ç…§ GitChat çš„å­—æ•°ç»Ÿè®¡ç°åœ¨å†™äº†å¤§æ¦‚æ˜¯ 9w å­—å·¦å³ï¼ˆè¿™ä¸ªç»Ÿè®¡åŒ…æ‹¬äº†æˆ‘ä¹‹å‰å‘å¸ƒçš„äº”ç¯‡ Chat æ–‡ç« ï¼‰ã€‚æ„Ÿè°¢æˆ‘çš„å°å¯çˆ±ä¸€ç›´ç£ä¿ƒæˆ‘ï¼Œæ„Ÿè°¢ç¼–è¾‘ä»¬çš„è¾›è‹¦ï¼Œæ„Ÿè°¢è¯»è€…çš„ä¿¡ä»»å’Œæ”¯æŒã€‚&lt;/p>
&lt;p>ä¸å·¥ä½œç›¸å…³çš„å†…å®¹ä¸»è¦å°±è¿™äº›å§ï¼Œä¹‹å‰&lt;a href="https://mp.weixin.qq.com/s?__biz=MzIyMjYyMzg3MA==&amp;amp;mid=2247491168&amp;amp;idx=4&amp;amp;sn=99c75223a96c3f0a4ba4802162a7176b&amp;amp;chksm=e82bff71df5c7667eeeabc6a12c1ed5d7e2589dd6d81c015a9fdf4896af0d99019c71182ab27&amp;amp;mpshare=1&amp;amp;scene=1&amp;amp;srcid=&amp;amp;sharer_sharetime=1577896952072&amp;amp;sharer_shareid=ca2e51094588e06bf753d47ce6ce6894&amp;amp;exportkey=AeBs7IZvP2YDdO0PAERxHsc%3D&amp;amp;pass_ticket=sUqDG7gi77aHI1AzhT8QG4acbC2iGtoHfL5dhjaRgAIB%2BMOsBIpQ8jHnQ671eH1e#rd">GitChat çš„è®¿è°ˆä¸­&lt;/a>æˆ‘æœ‰å¤§æ¦‚èŠäº†ä¸‹ 2020 å¹´çš„å®¹å™¨æŠ€æœ¯è¶‹åŠ¿ï¼Œæ•´ä½“è€Œè¨€æ˜¯ç¨³å®šæ€§å’Œæ€§èƒ½ä¼šå æ®ä¸»ä½“åœ°ä½ï¼Œæ¶æ„åœ¨ k8s ç­‰åŸºç¡€è®¾æ–½ä¹‹ä¸Šçš„ serverless å’Œ service mesh ç­‰å°†ä¼šæ„ˆå‘ç«çƒ­ï¼Œä¸è¿‡è¿™äº›ä¸æ˜¯æœ¬ç¯‡çš„é‡ç‚¹ï¼Œä¹‹åæœ‰ç©ºä¼šä¸“é—¨è¡¥ä¸€ç¯‡å…³äºæˆ‘æ‰€é¢„è§çš„æŠ€æœ¯è¶‹åŠ¿çš„æ–‡ç« ã€‚&lt;/p>
&lt;h2 id="ç”Ÿæ´»">ç”Ÿæ´»&lt;/h2>
&lt;p>2019 å¹´å¯¹æˆ‘è€Œè¨€æ˜¯æ„ä¹‰éå‡¡çš„ä¸€å¹´ï¼Œè¿™ä¸€å¹´æˆ‘å’Œæˆ‘çš„å°å¯çˆ±ç»“å©šå•¦ï¼è€Œä¸”ç°åœ¨ä¹Ÿæœ‰äº†å®å®ï¼ˆè™½ç„¶è¦ç­‰åˆ° 2020 å¹´å‡ºç”Ÿï¼‰ã€‚&lt;/p>
&lt;p>å©šç¤¼æ˜¯åœ¨è€å®¶åŠçš„ï¼Œè¦éå¸¸æ„Ÿè°¢å®¶äººæœ‹å‹ä»¬å¯¹æˆ‘ä»¬çš„å¸®åŠ©å’Œæ”¯æŒã€‚&lt;/p>
&lt;p>ç»å¸¸å¬æœ‹å‹ä»¬è¯´â€œä¸€èƒçœ‹ä¹¦å…»â€ æœç„¶æ²¡é”™ï¼Œè‡ªä»å°å¯çˆ±æ€€å­•åï¼Œæˆ‘å®¶é‡Œä¹¦æ¶ä¸Šçš„ä¹¦å°±æ¢æˆã€Šç¡å‰èƒæ•™ã€‹ã€Šå­•æœŸç™¾ç§‘ã€‹ä¹‹ç±»çš„ä¹¦ï¼Œä¹°äº†èƒå¿ƒä»ªï¼Œæ—¶å¸¸å¬å¬å®å®çš„èƒå¿ƒä¹‹ç±»çš„ã€‚&lt;/p>
&lt;p>è™½ç„¶æ¯”è¾ƒç´§å¼ ï¼Œä½†æ•´ä½“è€Œè¨€ï¼Œæ›´å¤šçš„æ˜¯æ¬£å–œå’ŒæœŸå¾…ï¼ŒæœŸå¾…æœ‰ä¸ªå¥åº·çš„å®å®ï¼ŒæœŸå¾…å’Œæˆ‘çš„å°å¯çˆ±æŠŠæˆ‘ä»¬çš„ç”Ÿæ´»è¿‡çš„æ›´åŠ å¹¸ç¦ç¾å¥½ï¼&lt;/p>
&lt;h2 id="æ€»ç»“">æ€»ç»“&lt;/h2>
&lt;p>æˆ‘åœ¨å»å¹´çš„æ€»ç»“ &lt;a href="https://zhuanlan.zhihu.com/p/53641783">2018 å°å›é¡¾&lt;/a> ä¸­å®šäº†å‡ ä¸ªç›®æ ‡ï¼ˆæŒ‰æ–‡ç« å†…å®¹çš„å…ˆåé¡ºåºï¼‰ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>èŠ±æ›´å¤šæ—¶é—´å»ºè®¾çŸ¥ä¹ä¸“æ  &lt;a href="https://zhuanlan.zhihu.com/container">ã€k8sç”Ÿæ€ã€&lt;/a>ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ç¤¾åŒºä¸­ä¸»è¦æ´»è·ƒåœ¨ Docker å’Œ Kubernetes ç”Ÿæ€æ–¹å‘ã€‚ç»´æŠ¤ä¸€äº›å®˜æ–¹é•œåƒï¼Œåšæµ‹è¯•ï¼Œè§£å†³é—®é¢˜ï¼Œæäº¤ä»£ç ä¹‹ç±»çš„ï¼Œæ˜å¹´å¸Œæœ›åšçš„æ›´å¤šï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ç»§ç»­åœ¨äº‘åŸç”Ÿé¢†åŸŸçš„æ·±è€•ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¸Œæœ›èƒ½è¶Šæ¥è¶Šå¥½ï¼Œèƒ½è·Ÿå°å¯çˆ±è¶Šæ¥è¶Šå¹¸ç¦ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>ç°åœ¨çœ‹æ¥ï¼Œå®Œæˆåº¦è¿˜ä¸é”™ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>å¦‚ä¸Šæ–‡æ‰€è¨€ï¼ŒçŸ¥ä¹ä¸“æ  &lt;a href="https://zhuanlan.zhihu.com/container">ã€k8sç”Ÿæ€ã€&lt;/a> æ›´æ–°äº† 41 ç¯‡ã€Œk8s ç”Ÿæ€å‘¨æŠ¥ã€ï¼Œç°åœ¨å…±è®¡ 61 ç¯‡æ–‡ç« ï¼Œæœ‰ 846 ä¸ªå…³æ³¨ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ç¤¾åŒºæ´»åŠ¨æ–¹é¢ï¼Œå¹´åˆåšè¿‡ä¸€æ¬¡æ¼”è®²ï¼Œ6 æœˆä»½å‚åŠ äº† KubeCon ï¼Œè§äº†ä¸€äº›æœ‹å‹ï¼›å†åæ¥ PyCon China é‚£æ¬¡æœªèƒ½æˆè¡Œã€‚è¿™æ–¹é¢ç•¥æœ‰é—æ†¾å§ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>è‡³äºç¤¾åŒºè´¡çŒ®ï¼Œè´´ä¸€å¼ å›¾ï¼š&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://moelove.info/img/2019-oss.png" alt="2019 overview - https://moelove.info">&lt;/p>
&lt;ul>
&lt;li>
&lt;p>åœ¨äº‘åŸç”Ÿé¢†åŸŸå½“ç„¶æ˜¯åœ¨ç»§ç»­æ·±å…¥æ¢ç´¢å’Œå®è·µï¼Œæ•´ä½“è€Œè¨€ä¹Ÿè¿˜ç®—æ»¡æ„ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>è·Ÿå°å¯çˆ±ä¹Ÿæ›´åŠ å¹¸ç¦ï¼Œéå¸¸å¼€å¿ƒï¼›&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>æ¥ä¸‹æ¥ï¼Œè¿˜æ˜¯ä¸º 2020 å¹´å®šäº›å°ç›®æ ‡å§ï¼š&lt;/p>
&lt;ul>
&lt;li>å·¥ä½œæ–¹é¢å¸Œæœ›èƒ½æ¨åŠ¨æ›´å¤šä¸šåŠ¡çš„æ”¹é€ å’Œæ¥å…¥ï¼Œç®—æ˜¯ä¸ªé•¿çº¿è®¡åˆ’ï¼›&lt;/li>
&lt;li>ç¤¾åŒºæ´»åŠ¨æ–¹é¢ï¼Œä»Šå¹´å¸Œæœ›å¤šå‚ä¸ä¸€äº›ï¼ŒæŠŠä¸€äº›ç†å¿µå’Œå®è·µç»éªŒ push åˆ°ç¤¾åŒºï¼Œä¹Ÿèƒ½ä»ä¸­å­¦ä¹ åˆ°ç¤¾åŒºçš„ä¸€äº›ç»éªŒï¼›&lt;/li>
&lt;li>ç¤¾åŒºè´¡çŒ®æ–¹é¢ï¼Œä¼šç»§ç»­æŠ•å…¥æ›´å¤šç²¾åŠ›æ¥åšï¼Œä½†ä¸ 2019 å¹´çš„é‡ç‚¹å¯èƒ½ä¼šç¨æœ‰ä¸åŒï¼›&lt;/li>
&lt;li>ç”Ÿæ´»æ–¹é¢ï¼Œå¸Œæœ›å®å®å¥åº·çš„å‡ºç”Ÿï¼Œå’Œæˆ‘çš„å°å¯çˆ±å…±åŒç»è¥å¥½æˆ‘ä»¬çš„å®¶åº­ã€‚&lt;/li>
&lt;/ul>
&lt;hr>
&lt;p>å¯ä»¥é€šè¿‡ä¸‹é¢äºŒç»´ç è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘ï¼Œåœ¨å…¬ä¼—å·åå°å›å¤ k8s å¯åŠ å…¥æŠ€æœ¯åœˆäº¤æµã€‚&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category><category domain="https://moelove.info/tags/Life/">Life</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| Prometheus v2.15.0 æ­£å¼å‘å¸ƒ</title><link>https://moelove.info/2019/12/29/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Prometheus-v2.15.0-%E6%AD%A3%E5%BC%8F%E5%8F%91%E5%B8%83/</link><guid isPermaLink="true">https://moelove.info/2019/12/29/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Prometheus-v2.15.0-%E6%AD%A3%E5%BC%8F%E5%8F%91%E5%B8%83/</guid><pubDate>Sun, 29 Dec 2019 16:55:31 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="prometheus-v2150-æ­£å¼å‘å¸ƒ">Prometheus v2.15.0 æ­£å¼å‘å¸ƒ&lt;/h2>
&lt;p>æœ¬å‘¨ Prometheus å‘å¸ƒäº† v2.15.0 ç‰ˆæœ¬ï¼Œè¿™ä¸ªç‰ˆæœ¬åœ¨ TSDB æ–¹é¢æœ‰è¯¸å¤šæ”¹è¿›ï¼Œä»¥åŠæå‡äº† PromQL è§£æå™¨çš„æ€§èƒ½ã€‚&lt;/p>
&lt;p>TSDB æ–¹é¢ä¸»è¦æ˜¯å¯¹å†…å­˜ä½¿ç”¨ç›¸å…³çš„ä¼˜åŒ–ã€‚&lt;/p>
&lt;p>æŒ‰ç…§æ­¤ç‰ˆæœ¬ä¸­ &lt;a href="https://github.com/prometheus/prometheus/pull/6356">å¯¹ PromQL è§£æå™¨ç›¸å…³å˜æ›´çš„ PR&lt;/a>ï¼Œæœ¬æ¬¡è§£æå™¨æ€§èƒ½çš„æå‡èƒ½è¾¾åˆ°ä¹‹å‰çš„ 7 å€ã€‚&lt;/p>
&lt;p>åŒæ—¶ï¼Œæ­¤ç‰ˆæœ¬ä¸­ä¹Ÿå­˜åœ¨ä¸€ä¸ª bugï¼Œå¯èƒ½ä¼šå¯¼è‡´å¹¶å‘æŸ¥è¯¢æ•°æ®æ—¶ï¼Œå‡ºç° checksum ä¸åŒ¹é…çš„æƒ…å†µï¼Œæœ€ç›´æ¥çš„å½±å“å°±æ˜¯ Grafana çš„å›¾è¡¨ä¼šæ˜¾ç¤ºä¸å‡ºæ¥ã€‚&lt;/p>
&lt;p>æ‰€ä»¥ä¹‹åä¹Ÿå¿«é€Ÿå‘å¸ƒäº† v2.15.1 ç‰ˆæœ¬ã€‚å»ºè®®å¦‚æœä½¿ç”¨ v2.15.0 çš„æœ‹å‹å¯ä»¥å¿«é€Ÿå‡çº§è‡³ v2.15.1 ä»¥è§„é¿æ­¤é—®é¢˜ã€‚&lt;/p>
&lt;p>æ›´å¤šå…³äºæ­¤ç‰ˆæœ¬çš„å˜æ›´ï¼Œè¯·æŸ¥çœ‹å…¶ &lt;a href="https://github.com/prometheus/prometheus/releases/tag/v2.15.0">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="rancher-v240-alpha1-å‘å¸ƒ">Rancher v2.4.0-alpha1 å‘å¸ƒ&lt;/h2>
&lt;p>Rancher æœ¬å‘¨å‘å¸ƒäº† v2.4.0-alpha1 , æ­¤ç‰ˆæœ¬ä¸­åœ¨ç”¨æˆ·è§’è‰²æ–¹é¢æœ‰ä¸¤ä¸ªæŒºä¸é”™çš„æ”¹è¿›ã€‚&lt;/p>
&lt;ul>
&lt;li>ç®¡ç†å‘˜å¯ä»¥è‡ªå®šä¹‰å…¨å±€èŒƒå›´å†…çš„è§’è‰²ï¼Œå¹¶ä¸”å¯ä»¥è®©ç”¨æˆ·ç™»å½•åé»˜è®¤ä½¿ç”¨è¯¥è§’è‰²ã€‚&lt;/li>
&lt;li>åœ¨ä½¿ç”¨å¤–éƒ¨è®¤è¯æ–¹å¼æ—¶ï¼Œç®¡ç†å‘˜ä¹Ÿå¯ä»¥é»˜è®¤è®¾ç½®å±äºæŸä¸ªç»„çš„ç”¨æˆ·ï¼Œé»˜è®¤æˆäºˆçš„æƒé™ã€‚ï¼ˆæ¯”è¾ƒç±»ä¼¼äº Grafana ä½¿ç”¨ LDAP è®¤è¯æ—¶ï¼Œé»˜è®¤ç»™ç”¨æˆ·è®¾ç½®çš„æƒé™ï¼Œä½†æ›´çµæ´»ä¸€äº›ã€‚)&lt;/li>
&lt;/ul>
&lt;p>æ›´å¤šå…³äºæ­¤ç‰ˆæœ¬çš„ä¿¡æ¯ï¼Œå¯å‚è€ƒå…¶ &lt;a href="https://github.com/rancher/rancher/releases/tag/v2.4.0-alpha1">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="é¢˜å¤–è¯">é¢˜å¤–è¯&lt;/h2>
&lt;p>è¿™æ˜¯ä»Šå¹´ &lt;a href="https://zhuanlan.zhihu.com/container">ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€&lt;/a>çš„æœ€åä¸€ç¯‡äº†ï¼Œæœ¬ç¯‡ä¸­æ²¡æœ‰ä¸Šæ¸¸è¿›å±•ï¼Œä¸Šæ¸¸æœ€è¿‘çš„å˜æ›´å¹¶ä¸é¢‘ç¹ï¼Œ(å¤§æ¦‚æ˜¯å¹´åº•ä¼‘å‡çš„åŸå› ï¼‰&lt;/p>
&lt;p>ä» 2019 å¹´ 3 æœˆä»½å¼€å§‹ï¼Œä¾¿ä¸€ç›´ä¿æŒç€æ¯å‘¨æ›´æ–°ã€‚æ–°çš„ä¸€å¹´ï¼Œæˆ‘ä¹Ÿå°†ç»§ç»­ä¿æŒæ›´æ–°ï¼Œä¸ä½ åˆ†äº«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚&lt;/p>
&lt;p>&lt;strong>æ„Ÿè°¢å…³æ³¨ï¼&lt;/strong>&lt;/p>
&lt;hr>
&lt;p>å¯ä»¥é€šè¿‡ä¸‹é¢äºŒç»´ç è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘ï¼Œåœ¨å…¬ä¼—å·åå°å›å¤ k8s å¯åŠ å…¥æŠ€æœ¯åœˆäº¤æµã€‚&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| TUF æ­£å¼ä» CNCF æ¯•ä¸š</title><link>https://moelove.info/2019/12/21/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-TUF-%E6%AD%A3%E5%BC%8F%E4%BB%8E-CNCF-%E6%AF%95%E4%B8%9A/</link><guid isPermaLink="true">https://moelove.info/2019/12/21/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-TUF-%E6%AD%A3%E5%BC%8F%E4%BB%8E-CNCF-%E6%AF%95%E4%B8%9A/</guid><pubDate>Sat, 21 Dec 2019 16:55:31 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="tuf-æ­£å¼ä»-cncf-æ¯•ä¸š">TUF æ­£å¼ä» CNCF æ¯•ä¸š&lt;/h2>
&lt;p>æœ¬å‘¨ &lt;a href="https://theupdateframework.github.io/">The Update Framework (TUF)&lt;/a> æ­£å¼&lt;a href="https://www.cncf.io/announcement/2019/12/18/cloud-native-computing-foundation-announces-tuf-graduation/">ä» CNCF æ¯•ä¸š&lt;/a>ï¼Œç°åœ¨ TUF çš„å®˜æ–¹ Python å®ç°æœ‰ 954 ä¸ª star ï¼Œ142 ä¸ª fork ä»¥åŠ 43 ä½è´¡çŒ®è€…å’Œ 3525 æ¬¡ commit è®°å½•ã€‚&lt;/p>
&lt;p>TUF æ˜¯ä» CNCF æ­£å¼æ¯•ä¸šçš„ç¬¬ 9 ä¸ªé¡¹ç›®ï¼Œæ²¡è®°é”™çš„è¯ä¹Ÿæ˜¯è‡³ä»Šä¸ºæ­¢å”¯ä¸€ä¸€ä¸ª star æ•°æœªä¸Šåƒå°±æ­£å¼æ¯•ä¸šçš„é¡¹ç›®ã€‚ä¸è¿‡ TUF é¡¹ç›®æœ¬èº«ä¸å…¶ä»–é¡¹ç›®ä¸åŒï¼Œstar æ•°ä¹Ÿè¯´æ˜ä¸äº†é¡¹ç›®çŠ¶æ€ã€‚&lt;/p>
&lt;p>å¯èƒ½ä¸å°‘äººè§‰å¾— TUF é¡¹ç›®çš„å­˜åœ¨æ„Ÿå¾ˆä½ï¼Œæˆ–æ˜¯æ²¡æœ‰äº†è§£æˆ–ä½¿ç”¨è¿‡ TUF é¡¹ç›®ï¼Œæˆ‘å§‘ä¸”å¯¹å®ƒåšä¸€ç‚¹ä»‹ç»ã€‚&lt;/p>
&lt;p>TUF é¡¹ç›®å¤§æ¦‚æ˜¯åå¹´å‰å¯åŠ¨ï¼Œå¹¶äº 2017 å¹´å¼€å§‹æ‰˜ç®¡äº CNCFï¼Œå®ƒçš„ä¸»è¦ç›®æ ‡æ­£å¦‚å®ƒçš„åå­—ä¸€èˆ¬ï¼Œæä¾›ç”¨äºæ›´æ–°çš„æ¡†æ¶ï¼Œä½†å®ƒæ›´é‡è¦çš„ç‚¹åœ¨äºå®ƒçš„å®‰å…¨æ€§è®¾è®¡ä¸Šã€‚&lt;/p>
&lt;p>å®ƒå……åˆ†è€ƒè™‘åˆ°äº†å„ä¸ªç¯èŠ‚å¯èƒ½å‡ºç°çš„æ”»å‡»ï¼Œåœ¨æä¾›æ›´æ–°åŠŸèƒ½çš„åŒæ—¶ï¼Œä¹Ÿå¯ä»¥å¾ˆå¥½çš„ä¿æŠ¤ç°æœ‰ç¨‹åºæˆ–è€…æ˜¯éªŒè¯å¾…æ›´æ–°ç‰ˆæœ¬çš„å®‰å…¨å’Œå¯é æ€§ã€‚ä½ å¯èƒ½æƒ³é—®å®ƒæ˜¯å¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹çš„ï¼Œå…¶å®å®ƒä¸»è¦æ˜¯æä¾›äº†ä¸€å¥—æ ‡å‡†è§„èŒƒï¼Œå¹¶åœ¨å„ä¸ªç¯èŠ‚ä¸­å¢åŠ äº†æ›´å¤šçš„å…ƒæ•°æ®å’Œç›¸å…³çš„æ£€æŸ¥ï¼ŒåŒ…æ‹¬ç­¾åä¿¡æ¯ï¼Œæ–‡ä»¶ hash ï¼Œå…ƒæ•°æ®ç­¾åå’Œè¿‡æœŸæ—¶é—´ç­‰ã€‚&lt;/p>
&lt;p>è‡³äºå®ƒçš„å­˜åœ¨æ„Ÿå˜›ï¼Œä¸çŸ¥é“ä½ æ˜¯å¦æœ‰ä½¿ç”¨è¿‡ Docker Content Trust(DCT) ç›¸å…³çš„åŠŸèƒ½ï¼Œç®€å•æ¥è¯´ä½ å¯ä»¥å½“ä½œå°±æ˜¯ &lt;code>docker trust&lt;/code> æ‰€æ¶‰åŠåˆ°çš„ç›¸å…³åŠŸèƒ½ï¼Œè¿™å…¶ä¸­çš„éƒ¨åˆ†åŠŸèƒ½æ˜¯æ„å»ºåœ¨ &lt;a href="https://github.com/docker/notary/releases">Docker Notary&lt;/a> ä¹‹ä¸Šçš„ï¼Œè€Œ Docker Notary åˆ™æ˜¯ä½¿ç”¨ TUF ä½œä¸ºå…¶åŸºç¡€å®‰å…¨æ¡†æ¶çš„ã€‚(PSï¼šDocker Inc ä¹Ÿå·²ç»å°† Docker Notary æçŒ®ç»™äº† CNCF)&lt;/p>
&lt;p>ç°åœ¨å¤šæ•°å…¬æœ‰äº‘ï¼ˆæ¯”å¦‚ IBMï¼ŒAzure ç­‰ï¼‰æä¾›å¯ä¿¡é•œåƒä»“åº“æœåŠ¡æ—¶ï¼ŒåŸºæœ¬ä¹Ÿéƒ½é—´æ¥çš„ä¾èµ–äº Docker Notary å’Œ TUF äº†ï¼Œè¿™ä¹Ÿæ˜¯ TUF è¢«å¹¿æ³›ä½¿ç”¨çš„æ–¹é¢ã€‚ é™¤äº†å®¹å™¨ç”Ÿæ€å¤–ï¼Œä¸€äº›è¯­è¨€çš„åŒ…ç®¡ç†å™¨ä¹Ÿéƒ½åœ¨æ¢ç´¢åŸºäº TUF å®ç°å…¶å®‰å…¨æ›´æ–°ï¼ŒåŒ…æ‹¬ &lt;a href="https://github.com/pypa/interoperability-peps/blob/master/pep-0458-tuf-online-keys.rst">Python çš„ pip&lt;/a>, &lt;a href="http://www.well-typed.com/blog/2015/04/improving-hackage-security/">Haskell çš„ hackage&lt;/a> ä»¥åŠ &lt;a href="https://opam.ocaml.org/blog/Signing-the-opam-repository/">OCaml çš„ opam&lt;/a> ç­‰ã€‚&lt;/p>
&lt;p>ä¸è¿‡ç›¸å…³æ‰©å±•å†…å®¹ä¸æ˜¯æœ¬ç¯‡çš„é‡ç‚¹ï¼Œæš‚ä¸”è·³è¿‡ã€‚æœ€åå†æ¬¡æ­å–œ TUF é¡ºåˆ©æ¯•ä¸šï¼&lt;/p>
&lt;h2 id="linkerd-v261-å‘å¸ƒ">Linkerd v2.6.1 å‘å¸ƒ&lt;/h2>
&lt;p>Linkerd æœ¬å‘¨å‘å¸ƒäº† v2.6.1 ç‰ˆæœ¬ï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸å°çš„ bugfix ç‰ˆæœ¬ã€‚åœ¨è¿™é‡Œæåˆ°æ˜¯å› ä¸ºè¿™ä¸ªå°ç‰ˆæœ¬ä¸»è¦æ˜¯æ”¹å–„ Proxy çš„ç¨³å®šæ€§ï¼Œé€šè¿‡ä¿®å¤äº† Proxy å¯èƒ½åœæ­¢æ¥æ”¶æœåŠ¡å‘ç°æ›´æ–°ï¼Œå¯¼è‡´ 503 çš„ bug ã€‚&lt;/p>
&lt;p>å¯¹æ­¤é—®é¢˜æ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥å‚è€ƒ &lt;a href="https://github.com/linkerd/linkerd2-proxy">linkerd2-proxy&lt;/a> çš„æ›´æ–°è®°å½•ã€‚&lt;/p>
&lt;h2 id="ä¸Šæ¸¸è¿›å±•">ä¸Šæ¸¸è¿›å±•&lt;/h2>
&lt;p>Kubernetes v1.17 å·²ç»å‘å¸ƒäº†ï¼Œç°åœ¨ä¸Šæ¸¸ä¹Ÿè¿›å…¥äº† v1.18 çš„å¼€å‘é˜¶æ®µï¼Œæœ¬å‘¨å‘å¸ƒäº† v1.18.0-alpha.1 , å…¶ä¸­æœ‰ä¸ªå¾ˆæœ‰ç”¨çš„å˜æ›´ã€‚&lt;/p>
&lt;p>&lt;code>kubectl drain&lt;/code> åœ¨ &lt;code>--dry-run&lt;/code> çš„æ—¶å€™ï¼Œå¯ä»¥æ˜¾ç¤ºä¼šé©±é€æ‰çš„ &lt;code>pod&lt;/code> ä¿¡æ¯äº†ã€‚ ç¤ºä¾‹å¦‚ä¸‹ï¼š&lt;/p>
&lt;pre>&lt;code># kubectl v1.18.0-alpha.1
(MoeLove) âœ bin ./kubectl.v1.18 drain --dry-run=true 10.19.47.253
node/10.19.47.253 cordoned (dry run)
evicting pod infra/redis-7c647bfd97-fdk2r (dry run)
evicting pod kube-system/coredns-65b546d87d-6jmfp (dry run)
evicting pod kube-system/coredns-65b546d87d-pwqvh (dry run)
node/10.19.47.253 drained (dry run)
&lt;/code>&lt;/pre>&lt;p>è€Œä¹‹å‰ç‰ˆæœ¬ä¸­æ˜¯æ²¡æœ‰å±•ç¤ºè¢«é©±é€ &lt;code>pod&lt;/code> ä¿¡æ¯çš„ï¼š&lt;/p>
&lt;pre>&lt;code># kubectl below v1.18.0-alpha.1
(MoeLove) âœ bin ./kubectl.v1.17 drain --dry-run=true 10.19.47.253
node/10.19.47.253 cordoned (dry run)
node/10.19.47.253 drained (dry run)
&lt;/code>&lt;/pre>&lt;hr>
&lt;p>å¯ä»¥é€šè¿‡ä¸‹é¢äºŒç»´ç è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘ï¼Œåœ¨å…¬ä¼—å·åå°å›å¤ k8s å¯åŠ å…¥æŠ€æœ¯åœˆäº¤æµã€‚&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| Kubernetes v1.17 æ­£å¼å‘å¸ƒ</title><link>https://moelove.info/2019/12/15/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Kubernetes-v1.17-%E6%AD%A3%E5%BC%8F%E5%8F%91%E5%B8%83/</link><guid isPermaLink="true">https://moelove.info/2019/12/15/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Kubernetes-v1.17-%E6%AD%A3%E5%BC%8F%E5%8F%91%E5%B8%83/</guid><pubDate>Sun, 15 Dec 2019 23:16:14 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="kubernetes-v117-æ­£å¼å‘å¸ƒ">Kubernetes v1.17 æ­£å¼å‘å¸ƒ&lt;/h2>
&lt;p>æœ¬å‘¨ Kubernetes v1.17 æ­£å¼å‘å¸ƒäº†ï¼Œè¿™æ˜¯ 2019 å¹´çš„ç¬¬å››æ¬¡å‘å¸ƒï¼Œå½“ç„¶ä¹Ÿæ˜¯ä»Šå¹´æœ€åä¸€æ¬¡äº†ã€‚Kubernetes v1.17 åŒ…å« 22 ä¸ªå¢å¼ºåŠŸèƒ½ï¼Œå…¶ä¸­ 14 ä¸ªå·²ç» stable ï¼Œ4 ä¸ª beta ä»¥åŠå‰©ä½™ 4 ä¸ª alpha ã€‚&lt;/p>
&lt;p>æœ¬æ¬¡ç‰ˆæœ¬çš„ä¸»é¢˜æ˜¯ Stabilityï¼Œåœ¨å‘å¸ƒä¹‹æ—¶ Kubernetes å®˜æ–¹åšå®¢ä¸Šå·²ç»æœ‰äº†ä¸€ç¯‡ &lt;a href="https://kubernetes.io/blog/2019/12/09/kubernetes-1-17-release-announcement/">Kubernetes 1.17: Stability&lt;/a> æ–‡ç« ä»‹ç»ï¼ŒåŠ ä¸Šæ¯å‘¨çš„å‘¨æŠ¥ä¸­ä¹Ÿéƒ½æœ‰ä¸Šæ¸¸è¿›å±•çš„ä»‹ç»ï¼Œæˆ‘åœ¨è¿™é‡Œå°±ä¸èµ˜è¿°äº†ï¼Œç¨å¾®èŠä¸¤ä¸‰ä¸ªæˆ‘ä¸ªäººè®¤ä¸ºæ¯”è¾ƒæœ‰ç”¨çš„å†…å®¹ã€‚&lt;/p>
&lt;ul>
&lt;li>&lt;code>rbac.authorization.k8s.io/v1alpha1&lt;/code> å’Œ &lt;code>rbac.authorization.k8s.io/v1beta1&lt;/code> åœ¨ v1.17 è¢«æ ‡è®°ä¸ºåºŸå¼ƒï¼Œå¹¶ä¸”åœ¨ v1.20 å°†è¢«åºŸå¼ƒï¼›&lt;/li>
&lt;li>&lt;code>kubectl logs&lt;/code> å¢åŠ äº†ä¸€ä¸ª &lt;code>--prefix&lt;/code> çš„é€‰é¡¹ï¼Œä½¿ç”¨æ­¤é€‰é¡¹å¯ä»¥åœ¨è¾“å‡ºæ—¥å¿—çš„æ—¶å€™å±•ç¤ºä¸€ä¸ªå‰ç¼€ï¼Œæ ¼å¼æ˜¯ &lt;code>[pod/name/containerName] &lt;/code>&lt;/li>
&lt;li>åºŸå¼ƒå’Œæ·»åŠ äº†ä¸€å¤§å † metricsï¼Œ æ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥å‚è€ƒä¸‹ &lt;a href="https://github.com/kubernetes/kubernetes/blob/master/CHANGELOG-1.17.md#metrics-changes">ReleaseNote ä¸­ metrics çš„éƒ¨åˆ†&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>å…¶ä½™å†…å®¹å»ºè®®å‚è€ƒä¸‹å®Œæ•´çš„ &lt;a href="https://github.com/kubernetes/kubernetes/blob/master/CHANGELOG-1.17.md#changes">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="harbor-v110-æ­£å¼å‘å¸ƒ">Harbor v1.10 æ­£å¼å‘å¸ƒ&lt;/h2>
&lt;p>Harbor ç›®å‰åœ¨ GitHub æœ‰ 10.3k çš„ star ï¼Œè€Œä¸”ç›®å‰åœ¨å›½å†…è¢«ä½¿ç”¨çš„ä¹Ÿå¾ˆå¹¿æ³›ã€‚æˆ‘ä¹‹å‰åœ¨ &lt;a href="https://gitbook.cn/gitchat/column/5d70cfdc4dc213091bfca46f/topic/5d72052861c92c7091bd4bb1">Docker çš„è®¤è¯æµç¨‹å’ŒåŸç†&lt;/a> ä¸­ä¹Ÿä»‹ç»è¿‡ Harbor ï¼ˆå½“ç„¶ä¹ŸåŒ…æ‹¬ Quayï¼ŒGitHub registy å’Œ GitLab registry ç­‰ï¼‰ã€‚æˆ‘ä»¬æ¥çœ‹çœ‹æœ¬æ¬¡ç‰ˆæœ¬ä¸­ä¸€äº›äº®ç‚¹ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>æ”¯æŒæ’ä»¶åŒ–é…ç½®çš„æ‰«æå™¨ï¼Œç°åœ¨å¯æ”¯æŒçš„æ‰«æå™¨åŒ…æ‹¬ï¼š&lt;/p>
&lt;ul>
&lt;li>Clair&lt;/li>
&lt;li>Anchore&lt;/li>
&lt;li>Trivy&lt;/li>
&lt;li>CSP&lt;/li>
&lt;li>DoSec&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>Tag çš„ä¸å¯å˜æ€§ï¼Œå…è®¸ç®¡ç†å‘˜é…ç½®æŒ‡å®šçš„ Tag ä¸ºä¸å…è®¸å˜æ›´ï¼ˆæˆ–è€…è¦†ç›–ï¼‰;&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¤åˆ¶åŠŸèƒ½çš„å¢å¼ºï¼šå°†Gitlabï¼ŒQuay.io å’Œ Jfrog Artifactory æ·»åŠ åˆ°äº†å—æ”¯æŒåˆ—è¡¨ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¢åŠ äº†ä¸ª &lt;code>Limited Guest&lt;/code> çš„æƒé™ï¼Œå…è®¸ Pull é•œåƒï¼Œä½†æ˜¯ä¸å…è®¸æŸ¥çœ‹æ—¥å¿—ä¹‹ç±»çš„æ“ä½œï¼›&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>æ•´ä½“è€Œè¨€ï¼Œæœ¬æ¬¡ç‰ˆæœ¬è¿˜æ˜¯å¾ˆä¸é”™çš„ï¼Œä¹Ÿæ›´ç¬¦åˆ â€œä¼ä¸šçº§â€ çš„å®šä½ã€‚ç°åœ¨ Harbor ä¹Ÿåœ¨è®¡åˆ’ä» CNCF æ¯•ä¸šï¼Œå¤§æ¦‚æ˜å¹´èƒ½æ­£å¼æ¯•ä¸šå§ã€‚
æ›´å¤šå…³äºæ­¤ç‰ˆæœ¬çš„æ›´æ–°è¯·æŸ¥çœ‹ &lt;a href="https://github.com/goharbor/harbor/releases/tag/v1.10.0">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="é¡¹ç›®æ¨è">é¡¹ç›®æ¨è&lt;/h2>
&lt;p>&lt;a href="https://github.com/salesforce/sloop">Sloop - Kubernetes History Visualization&lt;/a> æ˜¯ä¸€ä¸ªå¯ç”¨äº Kubernetes ä¸­å†å²è®°å½•å¯è§†åŒ–çš„é¡¹ç›®ã€‚&lt;/p>
&lt;p>&lt;img src="https://github.com/salesforce/sloop/blob/master/other/architecture.png?raw=true" alt="Sloop - https://moelove.info">&lt;/p>
&lt;hr>
&lt;p>å¯ä»¥é€šè¿‡ä¸‹é¢äºŒç»´ç è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘ï¼Œåœ¨å…¬ä¼—å·åå°å›å¤ k8s å¯åŠ å…¥æŠ€æœ¯åœˆäº¤æµã€‚&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| containerd v1.3.2 å‘å¸ƒ</title><link>https://moelove.info/2019/12/09/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-containerd-v1.3.2-%E5%8F%91%E5%B8%83/</link><guid isPermaLink="true">https://moelove.info/2019/12/09/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-containerd-v1.3.2-%E5%8F%91%E5%B8%83/</guid><pubDate>Mon, 09 Dec 2019 01:09:07 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="kind-v061-å‘å¸ƒ">Kind v0.6.1 å‘å¸ƒ&lt;/h2>
&lt;p>æœ¬å‘¨ Kind &lt;a href="https://github.com/kubernetes-sigs/kind">Kubernetes In Docker&lt;/a> å‘å¸ƒäº† v0.6.1 ç‰ˆæœ¬ï¼Œè¿™æ˜¯å¯¹ v0.6.0 çš„ä¸€ä¸ªå° patch ç‰ˆæœ¬ï¼Œä¸»è¦å˜æ›´å¦‚ä¸‹ï¼š&lt;/p>
&lt;ul>
&lt;li>ä¿®å¤ containerd åœ¨å¤š control plane èŠ‚ç‚¹é›†ç¾¤ä¸‹çš„é…ç½®ï¼›&lt;/li>
&lt;li>ä¿®æ­£äº† v1alpha4 API ä¸­çš„ &lt;code>protocol&lt;/code> å’Œ &lt;code>propagation&lt;/code> é…ç½®ï¼›&lt;/li>
&lt;li>é‡æ–°æ¨é€äº†é•œåƒï¼Œv0.6.0 å‘å¸ƒçš„æ—¶å€™å¿˜è®°æŠŠ CNI çš„é•œåƒç»™é¢„åŠ è½½åˆ° Node é•œåƒä¸­äº†ã€‚ç°åœ¨çš„é»˜è®¤é•œåƒæ˜¯ &lt;code>kindest/node:v1.16.3@sha256:70ce6ce09bee5c34ab14aec2b84d6edb260473a60638b1b095470a3a0f95ebec&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>å¦å¤–ï¼šKind çš„ Node é•œåƒåœ¨ DockerHub ä¸Šçš„ä¸‹è½½é‡è¶…è¿‡äº† 500K+ ï¼Œä¹Ÿè¯´æ˜å…¶æ­£åœ¨è¢«å¹¿æ³›ä½¿ç”¨ã€‚ï¼ˆæŸ¥çœ‹äº†ä¸‹æˆ‘è‡ªå·±å‘å¸ƒçš„é•œåƒä¸­ï¼Œä¸‹è½½é‡æœ€å¤šçš„ä¹Ÿæ‰åªæœ‰ 50K+ï¼‰æ­å–œ Kind ï¼&lt;/p>
&lt;h2 id="containerd-v132-å‘å¸ƒ">containerd v1.3.2 å‘å¸ƒ&lt;/h2>
&lt;p>è¿™æ˜¯ containerd åœ¨ v1.3 ç³»åˆ—çš„ç¬¬äºŒä¸ª patch ç‰ˆæœ¬ã€‚ æ­¤ç‰ˆæœ¬ä¸»è¦çš„ä¿®å¤å†…å®¹å¦‚ä¸‹ï¼š&lt;/p>
&lt;ul>
&lt;li>ä¿®å¤äº†ä¸€ä¸ªå®¹å™¨ pid çš„é—®é¢˜ï¼Œä¼šå¯¼è‡´ Docker å¡ä½ï¼›&lt;/li>
&lt;li>ä½¿ç”¨å·²ç¼“å­˜çš„çŠ¶æ€è€Œä¸æ˜¯æ¯æ¬¡éƒ½æ‰§è¡Œ &lt;code>runc state&lt;/code> è·å–å®¹å™¨çŠ¶æ€ï¼Œç›¸å…³å½±å“æ˜¯ Kubernetes å¯ç”¨ liveness å’Œ readiness æ¢é’ˆä¼šé€ æˆ CPU é£™é«˜ä»¥åŠ Docker å®¹å™¨ä½¿ç”¨å¥åº·æ£€æŸ¥ä¹Ÿä¼šé€ æˆ CPU é£™é«˜ï¼›&lt;/li>
&lt;/ul>
&lt;p>ç»¼åˆæ¥çœ‹ï¼Œå»ºè®®æ›´æ–°åˆ°æ­¤ç‰ˆæœ¬ã€‚&lt;/p>
&lt;h2 id="helm-v301-å‘å¸ƒ">Helm v3.0.1 å‘å¸ƒ&lt;/h2>
&lt;p>è¿™æ˜¯ Helm v3 ç³»åˆ—çš„ç¬¬ä¸€ä¸ª patch ç‰ˆæœ¬ï¼Œè¿™æ¬¡åŒ…å«äº†ä¸å°‘ä¿®å¤ï¼Œä½†éƒ½æ˜¯ä¸€äº›æ¯”è¾ƒå°çš„ä¿®å¤ï¼Œæˆ‘å¤§è‡´ç¿»äº†ç¿»ï¼Œå°±ä¸å†å±•å¼€ä»‹ç»äº†ã€‚&lt;/p>
&lt;p>ä¸ºäº†æ›´å¥½çš„ä½“éªŒï¼Œå»ºè®®å‡çº§åˆ°æœ€æ–°çš„ç‰ˆæœ¬ã€‚å½“ç„¶ä»ä¸­ä¹Ÿå¯ä»¥çœ‹åˆ° Helm v3 è¿˜æ˜¯æœ‰ä¸å°‘éœ€è¦å®Œå–„çš„ç»†èŠ‚ã€‚&lt;/p>
&lt;h2 id="ä¸Šæ¸¸è¿›å±•">ä¸Šæ¸¸è¿›å±•&lt;/h2>
&lt;ul>
&lt;li>æˆæƒ webhook çš„ LRU ç¼“å­˜è¢«è°ƒå¤§äº† 8 å€ &lt;a href="https://github.com/kubernetes/kubernetes/pull/85957">#85957&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="æ–‡ç« æ¨è">æ–‡ç« æ¨è&lt;/h2>
&lt;p>&lt;img src="https://moelove.info/img/debug-for-k8s.png" alt="troubleshooting-kubernetes - https://moelove.info">&lt;/p>
&lt;p>via. &lt;a href="https://learnk8s.io/troubleshooting-deployments">A visual guide on troubleshooting Kubernetes deployments&lt;/a>&lt;/p>
&lt;hr>
&lt;p>å¯ä»¥é€šè¿‡ä¸‹é¢äºŒç»´ç è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘ï¼Œåœ¨å…¬ä¼—å·åå°å›å¤ k8s å¯åŠ å…¥æŠ€æœ¯åœˆäº¤æµã€‚&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| Rancher v2.3.3 å‘å¸ƒ</title><link>https://moelove.info/2019/12/01/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Rancher-v2.3.3-%E5%8F%91%E5%B8%83/</link><guid isPermaLink="true">https://moelove.info/2019/12/01/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Rancher-v2.3.3-%E5%8F%91%E5%B8%83/</guid><pubDate>Sun, 01 Dec 2019 10:15:15 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="rancher-v233-å‘å¸ƒ">Rancher v2.3.3 å‘å¸ƒ&lt;/h2>
&lt;p>æœ¬å‘¨ Rancher v2.3.3 å‘å¸ƒï¼Œæ­£å¼æ”¯æŒ Kubernetes v1.16ï¼Œå¹¶å°† v1.16.3 è®¾ç½®ä¸º Rancher é»˜è®¤çš„ Kubernetes ç‰ˆæœ¬ã€‚&lt;/p>
&lt;p>åœ¨æ­¤ç‰ˆæœ¬ä¸­ï¼Œå€¼å¾—å…³æ³¨çš„ä¿®å¤å¦‚ä¸‹ï¼š&lt;/p>
&lt;ul>
&lt;li>ä¿®å¤äº†å…¶ä¸æ”¯æŒ kube-proxy ä½¿ç”¨ IPVS æ¨¡å¼çš„é—®é¢˜;&lt;/li>
&lt;/ul>
&lt;p>å·²çŸ¥é—®é¢˜ï¼š&lt;/p>
&lt;ul>
&lt;li>Rancher v2.3.3 åœ¨å¼€å¯ SELinux çš„ RHEL 7.7 ä¸Šä½¿ç”¨ RHEL Docker 1.13 æ—¶ï¼Œéƒ¨ç½²é›†ç¾¤å°†å¯¼è‡´å¤±è´¥ï¼›&lt;/li>
&lt;/ul>
&lt;p>æ›´å¤šå…³äºæ­¤ç‰ˆæœ¬çš„ç‰¹æ€§åŠå·²çŸ¥é—®é¢˜ï¼Œè¯·å…³æ³¨ &lt;a href="https://github.com/rancher/rancher/releases/tag/v2.3.3">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="ä¸Šæ¸¸è¿›å±•">ä¸Šæ¸¸è¿›å±•&lt;/h2>
&lt;ul>
&lt;li>
&lt;p>api-server çš„ &lt;code>--runtime-config&lt;/code> å¯ä½¿ç”¨ &lt;code>api/beta=false&lt;/code> å‚æ•°ç¦ç”¨æ‰€æœ‰å†…ç½®çš„ç¬¦åˆ &lt;code>v[0-9]+beta[0-9]+&lt;/code> ç‰ˆæœ¬çš„ REST APIï¼›åŒæ—¶ &lt;code>--feature-gates&lt;/code> å¯ä½¿ç”¨ &lt;code>AllBeta=false&lt;/code> ç¦ç”¨æ‰€æœ‰å†…ç½®çš„ beta ç‰¹æ€§ã€‚&lt;a href="https://github.com/kubernetes/kubernetes/pull/84304">#84304&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>downward API ä¸º Dualstack å¢åŠ äº†æ”¯æŒï¼Œå‚æ•°åä¸º &lt;code>status.podIPs&lt;/code>ã€‚&lt;a href="https://github.com/kubernetes/kubernetes/pull/83123">#83123&lt;/a>&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="é¡¹ç›®æ¨è">é¡¹ç›®æ¨è&lt;/h2>
&lt;p>ä»‹ç»ä¸€ä¸ªé¡¹ç›® &lt;a href="https://github.com/kubernetes-sigs/kube-storage-version-migrator">kube-storage-version-migrator&lt;/a> å¯å¸®åŠ©ä½ å°† Kubernetes å­˜å‚¨åœ¨ etcd ä¸­æ•°æ®è¿ç§»è‡³æœ€æ–°çš„å­˜å‚¨ç‰ˆæœ¬ã€‚&lt;/p>
&lt;p>ç›¸å…³çš„ KEP åœ¨ï¼šhttps://github.com/kubernetes/enhancements/blob/master/keps/sig-api-machinery/0030-storage-migration.md&lt;/p>
&lt;p>&lt;a href="https://github.com/kubernetes/enhancements/blob/master/keps/sig-api-machinery/storage-migration-auto-trigger.md">https://github.com/kubernetes/enhancements/blob/master/keps/sig-api-machinery/storage-migration-auto-trigger.md&lt;/a>&lt;/p>
&lt;h2 id="é¢˜å¤–è¯">é¢˜å¤–è¯&lt;/h2>
&lt;p>æœ¬å‘¨æ•´ä½“æ¥çœ‹ï¼Œæ²¡æœ‰ç‰¹åˆ«å¤šçš„å†…å®¹ï¼Œåœ¨æ¥ä¸‹æ¥çš„ä¸¤å‘¨å†…ï¼Œå¦‚æœè¿›åº¦æ­£å¸¸ Kubernetes v1.17 ä¹Ÿå°±ä¼šæ­£å¼å‘å¸ƒäº†ã€‚è‡³æ­¤ï¼Œä»Šå¹´ Kubernetes çš„æœ€åä¸€ä¸ªç‰ˆæœ¬ä¹Ÿå°±æ­£å¼å®Œæˆã€‚&lt;/p>
&lt;hr>
&lt;p>å¯ä»¥é€šè¿‡ä¸‹é¢äºŒç»´ç è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘ï¼Œåœ¨å…¬ä¼—å·åå°å›å¤ k8s å¯åŠ å…¥æŠ€æœ¯åœˆäº¤æµã€‚&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| containerd v1.3.1 å‘å¸ƒ</title><link>https://moelove.info/2019/11/25/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-containerd-v1.3.1-%E5%8F%91%E5%B8%83/</link><guid isPermaLink="true">https://moelove.info/2019/11/25/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-containerd-v1.3.1-%E5%8F%91%E5%B8%83/</guid><pubDate>Mon, 25 Nov 2019 04:52:31 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="containerd-v131-å‘å¸ƒ">containerd v1.3.1 å‘å¸ƒ&lt;/h2>
&lt;p>æœ¬å‘¨ containerd v1.3.1 å‘å¸ƒäº†ï¼Œæˆ‘ä»¬ä¸€èµ·çœ‹çœ‹å…¶ä¸­å€¼å¾—æ³¨æ„çš„å˜åŒ–ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>å°† runc æ›´æ–°è‡³ v1.0.0-rc9 ï¼Œ å…¶ä¸­åŒ…å«äº†å¯¹ &lt;a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-16884">CVE-2019-16884&lt;/a> çš„ä¿®å¤ï¼Œå…³äºæ­¤æ¼æ´çš„æ›´å¤šç»†èŠ‚ä¹Ÿå¯å‚è€ƒ &lt;a href="https://github.com/opencontainers/runc/issues/2128">https://github.com/opencontainers/runc/issues/2128&lt;/a> ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä¿®å¤äº†ä¸€ä¸ª v1.3.0 åœ¨æ‹‰å–é•œåƒé‡åˆ°é”™è¯¯æ—¶ï¼Œè§£åŒ…è¿‡ç¨‹ä¸­çš„æ­»é”é—®é¢˜ &lt;a href="https://github.com/containerd/containerd/issues/3816">#3816&lt;/a> ;&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å®šä½äº†ä¸€ä¸ª containerd åœ¨ä¸»æœºæ„å¤–é‡å¯æ—¶ï¼Œå¯èƒ½æ— æ³•æ¢å¤æŸåçš„é•œåƒçš„é—®é¢˜ï¼Œè¿™ä¸ªé—®é¢˜æ˜¯æ¯”è¾ƒæœ‰æ„æ€çš„ï¼Œå¯èƒ½é‡åˆ°è¿™ç§æƒ…å†µçš„ç¯å¢ƒä¸»è¦æ˜¯ containerd æ•°æ®ç›®å½•æŒ‚è½½è‡³éæ ¹ç›®å½•æ‰€åœ¨çš„ç›˜ä¸­ï¼ˆå¤šæ•°ç¯å¢ƒä¸­ï¼Œç³»ç»Ÿç›˜çš„ç©ºé—´å¹¶ä¸ä¼šå¾ˆå¤§ï¼Œæ‰€ä»¥è¿™ç§å®‰è£…æƒ…å†µä¹Ÿç®—æ¯”è¾ƒå¸¸è§ï¼‰ã€‚å‘ç”Ÿæ­¤é—®é¢˜çš„æ ¹æœ¬åŸå› å°±åœ¨äºé‡å¯åå¯åŠ¨çš„æ—¶æœºä¸å¯¹ï¼ˆæˆ‘å€¾å‘äºè¿™æ ·è¡¨è¿°ï¼Œè™½ç„¶å®é™…çš„é€»è¾‘æ˜¯ gc åˆ é™¤äº†ä¸€äº›å…ƒæ•°æ®ï¼Œä½†å®ƒæœ¬èº«çš„è¡Œä¸ºæ˜¯æ­£å¸¸çš„ï¼‰ã€‚æ‰€ä»¥ä¿®å¤çš„åŠæ³•ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œ &lt;strong>å¦‚æœä½ çš„ containerd æ˜¯ä½¿ç”¨ systemd è¿›è¡Œç®¡ç†çš„ï¼Œé‚£ä¹ˆå¯ä»¥åœ¨ service çš„é…ç½®æ–‡ä»¶çš„ After å—ä¸­å¢åŠ  &lt;code>local-fs.target&lt;/code> çš„é…ç½®&lt;/strong>&lt;/p>
&lt;p>&lt;code>local-fs.target&lt;/code> æ˜¯ systemd ä¸­ä¸€ä¸ªç‰¹æ®Šçš„å•å…ƒï¼Œå’Œ &lt;code>dbus.service&lt;/code> ä¹‹ç±»çš„å¾ˆå¤šå•å…ƒç±»ä¼¼ï¼Œéƒ½å±äºç‰¹æ®Šçš„é‚£ä¸€ç±»ã€‚å…·ä½“æ¥è¯´å®ƒæ˜¯ç”¨æ¥é›†åˆæœ¬åœ°æ–‡ä»¶ç³»ç»ŸæŒ‚è½½ç‚¹çš„ç›®æ ‡å•å…ƒï¼Œå¬èµ·æ¥å¯èƒ½æ¯”è¾ƒæŠ½è±¡ã€‚å®é™…ä¸Šå°±æ˜¯ &lt;code>systemd-fstab-generator&lt;/code> ä¼šåœ¨æ‰€æœ‰æœ¬åœ°æ–‡ä»¶ç³»ç»ŸæŒ‚è½½å•å…ƒä¸­æ·»åŠ  &lt;code>Before=local-fs.target&lt;/code> è¿™ä¸€æ¡ï¼Œæ‰€ä»¥å‘¢ï¼Œå½“åœ¨ &lt;code>local-fs.target&lt;/code> ä¹‹åæ‰§è¡Œçš„ï¼Œå°±è¡¨ç¤ºç°åœ¨æœºå™¨ä¸Šçš„æ‰€æœ‰æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿå‡å·²ç»æ­£ç¡®æŒ‚è½½ã€‚(è¿™ä¹Ÿæ˜¯æˆ‘è®¤ä¸ºè¿™ä¸ªé—®é¢˜æœ‰æ„æ€çš„åœ°æ–¹ï¼‰&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>ä»¥ä¸Šå°±æ˜¯æˆ‘è®¤ä¸ºåœ¨æ­¤ç‰ˆæœ¬ä¸­æ¯”è¾ƒå€¼å¾—æ³¨æ„çš„ç‚¹äº†ï¼Œå¯¹æ­¤ç‰ˆæœ¬æœ‰å…´è¶£çš„æœ‹å‹å¯å‚é˜… &lt;a href="https://github.com/containerd/containerd/releases/tag/v1.3.1">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="kubernetes-v1170-rc1-å‘å¸ƒ">Kubernetes v1.17.0-rc.1 å‘å¸ƒ&lt;/h2>
&lt;p>è™½ç„¶æœ¬å‘¨åœ¨ä¸¾è¡Œ KubeCon ä½† Kubernetes çš„å‘å¸ƒè¿›åº¦ä¹Ÿæ²¡å—å¤ªå¤šå½±å“ï¼Œæœ¬å‘¨é¡ºåˆ©å‘å¸ƒäº† v1.17.0-rc.1 ç‰ˆæœ¬ï¼Œè¿™ä¸ªç‰ˆæœ¬ç›¸æ¯”äºä¸Šæ¬¡å‘å¸ƒçš„ v1.17.0-beta.2 è€Œè¨€ï¼Œå€¼å¾—å…³æ³¨çš„å˜åŒ–å¦‚ä¸‹ï¼š&lt;/p>
&lt;ul>
&lt;li>ä¿®å¤äº† kubeadm ä¸­æœªå¯¹ &lt;code>KubeProxy.FeatureGates&lt;/code> è¿›è¡Œåˆå§‹åŒ–å¯èƒ½å¯¼è‡´çš„ panic ï¼Œç¨å¾®æ¥çœ‹ä¸‹ä¿®å¤åçš„ä»£ç :&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="c1">// DefaultKubeProxyConfiguration assigns default values for the kube-proxy ComponentConfig
&lt;/span>&lt;span class="c1">&lt;/span>&lt;span class="kd">func&lt;/span> &lt;span class="nf">DefaultKubeProxyConfiguration&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">internalcfg&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">kubeadmapi&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">ClusterConfiguration&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">kind&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="s">&amp;#34;KubeProxyConfiguration&amp;#34;&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">internalcfg&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">ComponentConfigs&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">KubeProxy&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">internalcfg&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">ComponentConfigs&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">KubeProxy&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="o">&amp;amp;&lt;/span>&lt;span class="nx">kubeproxyconfigv1alpha1&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">KubeProxyConfiguration&lt;/span>&lt;span class="p">{&lt;/span>
&lt;span class="nx">FeatureGates&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kd">map&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="kt">string&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="kt">bool&lt;/span>&lt;span class="p">{},&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">internalcfg&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">ComponentConfigs&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">KubeProxy&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">FeatureGates&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">internalcfg&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">ComponentConfigs&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">KubeProxy&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">FeatureGates&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="kd">map&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="kt">string&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="kt">bool&lt;/span>&lt;span class="p">{}&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="nx">externalproxycfg&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">internalcfg&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">ComponentConfigs&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">KubeProxy&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">externalproxycfg&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">ClusterCIDR&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s">&amp;#34;&amp;#34;&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="nx">internalcfg&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Networking&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">PodSubnet&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="s">&amp;#34;&amp;#34;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">externalproxycfg&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">ClusterCIDR&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">internalcfg&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Networking&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">PodSubnet&lt;/span>
&lt;span class="p">}&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="nx">internalcfg&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Networking&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">PodSubnet&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="s">&amp;#34;&amp;#34;&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="nx">externalproxycfg&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">ClusterCIDR&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="nx">internalcfg&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Networking&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">PodSubnet&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nf">warnDefaultComponentConfigValue&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">kind&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;clusterCIDR&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">internalcfg&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Networking&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">PodSubnet&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">externalproxycfg&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">ClusterCIDR&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">externalproxycfg&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">ClientConnection&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Kubeconfig&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s">&amp;#34;&amp;#34;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">externalproxycfg&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">ClientConnection&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Kubeconfig&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">kubeproxyKubeConfigFileName&lt;/span>
&lt;span class="p">}&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="nx">externalproxycfg&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">ClientConnection&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Kubeconfig&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="nx">kubeproxyKubeConfigFileName&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nf">warnDefaultComponentConfigValue&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">kind&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;clientConnection.kubeconfig&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">kubeproxyKubeConfigFileName&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">externalproxycfg&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">ClientConnection&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Kubeconfig&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">enabled&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">present&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">internalcfg&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">FeatureGates&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nx">features&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">IPv6DualStack&lt;/span>&lt;span class="p">];&lt;/span> &lt;span class="nx">present&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">externalproxycfg&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">FeatureGates&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nx">features&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">IPv6DualStack&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">enabled&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¯¼è‡´ panic çš„åœ°æ–¹ä¹Ÿå°±æ˜¯æœ€åé‚£å¤„åˆ¤æ–­ï¼Œæ¢è¨€ä¹‹ï¼Œè¿™ä¸ªé—®é¢˜å½±å“çš„æ˜¯å¯ç”¨äº† dual-stack feature çš„ç”¨æˆ·ã€‚&lt;/p>
&lt;p>å…³äºæ­¤ç‰ˆæœ¬æœ‰å…´è¶£çš„æœ‹å‹å¯ä»¥å‚è€ƒ &lt;a href="https://github.com/kubernetes/kubernetes/releases/tag/v1.17.0-rc.1">ReleaseNote&lt;/a>ï¼Œä¸è¿‡æŒ‰ç…§å‘å¸ƒè®¡åˆ’ï¼Œè¿‘æœŸ v1.17 æ­£å¼ç‰ˆä¹Ÿå°±è¦å‘å¸ƒäº†ã€‚&lt;/p>
&lt;h2 id="ä¸Šæ¸¸è¿›å±•">ä¸Šæ¸¸è¿›å±•&lt;/h2>
&lt;p>è¿‘æœŸåœ¨ä¸¾è¡Œ KubeCon åŠ ä¸Šä¹Ÿåœ¨ v1.17 çš„å‘å¸ƒå‘¨æœŸä¸­ï¼Œä¸Šæ¸¸æœ€è¿‘æ²¡æœ‰å¤ªå¤šå˜åŒ–ï¼Œæœ¬æ¬¡å°±æš‚ä¸”è·³è¿‡å¥½äº†ã€‚&lt;/p>
&lt;h2 id="é¡¹ç›®æ¨è">é¡¹ç›®æ¨è&lt;/h2>
&lt;p>ä»‹ç»ä¸€ä¸ªé¡¹ç›®ï¼Œstash å¯ä»¥å¸®åŠ©ä½ å¤‡ä»½ Kubernetes é›†ç¾¤ä¸­çš„ Stateful çš„åº”ç”¨ã€‚&lt;/p>
&lt;p>&lt;img src="https://appscode.com/products/stash/v0.9.0-rc.2/images/concepts/stash_architecture.svg" alt="stash - https://moelove.info">&lt;/p>
&lt;hr>
&lt;p>å¯ä»¥é€šè¿‡ä¸‹é¢äºŒç»´ç è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘ï¼Œåœ¨å…¬ä¼—å·åå°å›å¤ k8s å¯åŠ å…¥æŠ€æœ¯åœˆäº¤æµã€‚&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| Helm v3.0.0 æ­£å¼å‘å¸ƒ</title><link>https://moelove.info/2019/11/17/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Helm-v3.0.0-%E6%AD%A3%E5%BC%8F%E5%8F%91%E5%B8%83/</link><guid isPermaLink="true">https://moelove.info/2019/11/17/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Helm-v3.0.0-%E6%AD%A3%E5%BC%8F%E5%8F%91%E5%B8%83/</guid><pubDate>Sun, 17 Nov 2019 22:15:01 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="helm-v300-æ­£å¼å‘å¸ƒ">Helm v3.0.0 æ­£å¼å‘å¸ƒ&lt;/h2>
&lt;p>æœ¬å‘¨ Helm v3.0.0 æ­£å¼å‘å¸ƒäº†ã€‚åœ¨ Helm v3 å‘å¸ƒç¬¬ä¸€ä¸ª alpha ç‰ˆæ—¶ï¼Œæˆ‘å°±å†™äº†ä¸€ç¯‡ &lt;a href="https://zhuanlan.zhihu.com/p/66058355">ã€Šåˆè¯• Helm 3ã€‹&lt;/a> åœ¨é‚£ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»‹ç»äº†ä¸€äº› Helm 3 çš„å˜åŒ–åŠç‰¹æ€§ã€‚ ç°åœ¨æ­£å¼ç‰ˆå‘å¸ƒäº†ï¼Œæˆ‘ä»¬æ¥æ­£å¼çš„çœ‹çœ‹è¿™ä¸ªç‰ˆæœ¬å¸¦æ¥äº†å“ªäº›å€¼å¾—æœŸå¾…çš„å†…å®¹ã€‚ï¼ˆPSï¼šæˆ‘ä¸ä¼šåœ¨æœ¬æ–‡ä¸­ä»‹ç»å…¶å…¨éƒ¨ç‰¹æ€§ï¼Œåªä¼šèŠèŠæˆ‘æ„Ÿå…´è¶£çš„ï¼Œå¯¹å…¨éƒ¨ç‰¹æ€§æ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥å‚è€ƒå…¶&lt;a href="https://helm.sh/docs/">å®˜æ–¹æ–‡æ¡£ https://helm.sh/docs/&lt;/a> ï¼‰&lt;/p>
&lt;h3 id="ç§»é™¤-tiller">ç§»é™¤ Tiller&lt;/h3>
&lt;p>è¿™ä¸ªç‰¹æ€§æƒ³å¿…åœ¨ä»»ä½•ä»‹ç» Helm 3 çš„æ–‡ç« ä¸­éƒ½ä¼šæœ‰æåˆ°ï¼Œå½“ç„¶åœ¨æˆ‘ä¹‹å‰çš„æ–‡ç« ä¸­ä¹Ÿæœ‰æåˆ°ã€‚åœ¨ Helm 2 æ—¶ï¼Œå¯¹äºå¯åŠ¨äº† RBAC çš„ Kubernetes é›†ç¾¤è€Œè¨€ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­æƒ³è¦å®‰å…¨çš„ç®¡ç† Tiller çš„æƒé™æ˜¯æ¯”è¾ƒéº»çƒ¦çš„ã€‚&lt;/p>
&lt;p>å¦‚æœä½¿ç”¨é»˜è®¤é…ç½®ï¼ˆç®€å•æ¥è¯´ä¹Ÿå°±æ˜¯æ²¡å•¥ç‰¹åˆ«çš„é™åˆ¶ï¼‰ï¼Œé‚£ä¹ˆä¸Šæ‰‹å¾ˆå®¹æ˜“ï¼Œä½†å¯¹äºå¤šç§Ÿæˆ·çš„é›†ç¾¤è€Œè¨€ï¼Œå°±æ²¡é‚£ä¹ˆå®‰å…¨äº†ã€‚&lt;/p>
&lt;p>åœ¨ Helm 2 æ—¶æœŸï¼Œä¸ºäº†ç®€å•æˆ–è€…è¯´ä¸ºäº†å®‰å…¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Tillerless çš„æ–¹å¼ï¼Œæ¥é¿å…åœ¨é›†ç¾¤ä¸­å®‰è£… Tillerï¼Œ åŒæ—¶è¿˜å¯ä»¥æ­£å¸¸çš„ä½¿ç”¨ Helm çš„åŠŸèƒ½ã€‚ï¼ˆå¾ˆæ—©å‰è®¡åˆ’å†™ç¯‡æ–‡ç« ä»‹ç»ä¸€ä¸‹è¿™ä¸ªç»éªŒæ¥ç€ï¼Œç»“æœè‡³ä»Šä¹Ÿè¿˜æ²¡æœ‰è…¾å‡ºæ—¶é—´å†™ï¼Œç°åœ¨ Helm 3 å‘å¸ƒï¼Œä¹Ÿå°±ä¸ç”¨å†™äº†ï¼Œè¿™é‡Œå¤§æ¦‚èŠä¸€ä¸‹ï¼‰&lt;/p>
&lt;p>Tillerless æ˜¯ä»€ä¹ˆå«ä¹‰å‘¢ï¼Ÿ ä¹Ÿå°±æ˜¯åœ¨æœ¬åœ°å¯åŠ¨ä¸€ä¸ª Tiller çš„æœåŠ¡ï¼Œè®©å®ƒä½¿ç”¨ä½ æœ¬åœ°çš„ KUBECONFIG çš„é…ç½®æ–‡ä»¶ä¸é›†ç¾¤è¿›è¡Œäº¤äº’ï¼Œè€Œ Helm åœ¨åˆå§‹åŒ–æ—¶ï¼Œåªéœ€è¦åˆå§‹åŒ– client å³å¯ï¼Œ ç„¶åå¯é€šè¿‡ &lt;code>$HELM_HOST&lt;/code> å˜é‡æ§åˆ¶è¿æ¥åˆ°æœ¬åœ°æ‰€å¯åŠ¨çš„ Tillerï¼Œ ä¹‹åä¾¿å¯ä»¥æ­£å¸¸ä½¿ç”¨äº†ã€‚(æ¯æ¬¡éƒ¨ç½²å®Œæˆåï¼Œå°† Tiller å…³é—­å³å¯)&lt;/p>
&lt;p>Helm 3 ä¸­ç§»é™¤ Tiller ä¹‹åï¼Œé‚£å®‰å…¨æ¨¡å‹ä¹Ÿå°±éƒ½ç¬¦åˆ Kubernetes è‡ªèº«çš„è®¾è®¡æ ‡å‡†äº†ï¼Œä½¿ç”¨ KUBECONFIG æ¥æ§åˆ¶å³å¯ã€‚&lt;/p>
&lt;h3 id="release-åç§°å¯åœ¨ä¸åŒ-ns-é—´é‡ç”¨">Release åç§°å¯åœ¨ä¸åŒ ns é—´é‡ç”¨&lt;/h3>
&lt;p>è¿™ä¸ªåŠŸèƒ½ï¼Œåœ¨æˆ‘ä¹‹å‰å†™ã€Šåˆè¯• Helm 3ã€‹è¿™ç¯‡æ–‡ç« æ—¶ï¼Œè¯¥åŠŸèƒ½è¿˜ä¸å¯ç”¨ï¼Œä¸è¿‡åæ¥å°±ä¿®å¤äº†ã€‚è¿™ä¸ªåŠŸèƒ½æ¢å¥è¯è¯´å°±æ˜¯ï¼ŒRelease ä½œç”¨åŸŸå¯ä»¥æ˜¯ namespace çº§åˆ«çš„äº†ã€‚&lt;/p>
&lt;p>è¿™ä¸ªä½¿å¾— Release å˜çš„æ›´æ˜“ç®¡ç†äº†ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„çŸ¥é“æ­¤ namespace ä¸‹åˆ°åº•æœ‰å“ªäº› Release ã€‚&lt;/p>
&lt;h3 id="æ¨é€é•œåƒåˆ°-oci-registry">æ¨é€é•œåƒåˆ° OCI Registry&lt;/h3>
&lt;p>è¿™ä¸ªåŠŸèƒ½é»˜è®¤æ²¡æœ‰å¯ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è®¾ç½® &lt;code>HELM_EXPERIMENTAL_OCI=1&lt;/code> ç¯å¢ƒå˜é‡å¯ç”¨æ­¤ç‰¹æ€§ã€‚è¿™ä¸ªåŠŸèƒ½çš„å¥½å¤„å°±æ˜¯å¯ä»¥æœ€å¤§é™åº¦çš„åˆ©ç”¨ç°æœ‰æŠ€æœ¯åŸºç¡€ï¼ŒåŒæ—¶åˆèƒ½å¤Ÿæœ‰æ•ˆçš„å‡å°‘èµ„æºçš„æµªè´¹ã€‚&lt;/p>
&lt;h3 id="å¼€å§‹æ”¯æŒä½¿ç”¨åŸºäº-xdg-çš„ç›®å½•">å¼€å§‹æ”¯æŒä½¿ç”¨åŸºäº XDG çš„ç›®å½•&lt;/h3>
&lt;p>å‰å‡ å¤©æˆ‘è¿˜æ­£è§£å†³äº†ä¸ª XDG ç›¸å…³çš„é—®é¢˜æ¥ç€ï¼Œä½¿ç”¨åŸºäº XDG çš„ç›®å½•ç®—æ˜¯ä¸€ç§é€šç”¨çš„è§„èŒƒã€‚&lt;/p>
&lt;ul>
&lt;li>&lt;code>$HELM_PATH_CONFIG&lt;/code> ï¼šé…ç½®ç›®å½•&lt;/li>
&lt;li>&lt;code>$HELM_PATH_CACHE&lt;/code> ï¼šç¼“å­˜ç›®å½•&lt;/li>
&lt;li>&lt;code>$HELM_PATH_DATA&lt;/code> ï¼šæ•°æ®ç›®å½•&lt;/li>
&lt;/ul>
&lt;p>å¦‚æœæ•°æ®æˆ–è€…é…ç½®ä¹‹ç±»çš„å‡ºé—®é¢˜ï¼Œå¯ä»¥å°è¯•æ£€æŸ¥ä¸‹æ˜¯å¦ç›®å½•è®¾ç½®æœ‰è¯¯ã€‚&lt;/p>
&lt;p>ä»¥ä¸Šä¾¿æ˜¯æˆ‘å¯¹ Helm 3 ä¸­ä¸€äº›æˆ‘è®¤ä¸ºå€¼å¾—å…³æ³¨çš„åŠŸèƒ½çš„ä»‹ç»ï¼Œå¯¹æ­¤ç‰ˆæœ¬æ„Ÿå…´è¶£çš„æœ‹å‹å¯å‚é˜… &lt;a href="https://github.com/helm/helm/releases/tag/v3.0.0">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="docker-ce-19035-å‘å¸ƒ">Docker CE 19.03.5 å‘å¸ƒ&lt;/h2>
&lt;p>ç»è¿‡ä¸¤ä¸ª beta å’Œä¸€ä¸ª rc ç‰ˆçš„è¿­ä»£ï¼Œ Docker CE 19.03.5 æ­£å¼å‘å¸ƒäº†ã€‚ æ­¤ç‰ˆæœ¬æˆ‘æœ€å…³æ³¨çš„ç‰¹æ€§æ˜¯ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;strong>ä¿®æ­£äº†å¯¹ OCI image çš„æ”¯æŒ&lt;/strong>&lt;/li>
&lt;/ul>
&lt;p>// å…¶å®æ²¡å¤šå°‘äººå…³æ³¨è¿™ä¸ªç‰¹æ€§ï¼Œ ä¹Ÿä»ä¾§é¢åæ˜ è¿˜æ˜¯ç”¨ Docker Image çš„ç”¨æˆ·æ›´å¤šã€‚&lt;/p>
&lt;h2 id="istio-140-æ­£å¼å‘å¸ƒ">Istio 1.4.0 æ­£å¼å‘å¸ƒ&lt;/h2>
&lt;p>è¿™ä¸ªç‰ˆæœ¬é›†ä¸­äºæ”¹è¿›ç”¨æˆ·ä½“éªŒå’Œæ€§èƒ½ä¸Šã€‚æˆ‘æ¯”è¾ƒæ„Ÿå…´è¶£çš„ä¸¤ä¸ªç‰¹æ€§æ˜¯ï¼š&lt;/p>
&lt;ul>
&lt;li>æ”¯æŒäº†æµé‡é•œåƒç™¾åˆ†æ¯”çš„åŠŸèƒ½ï¼›&lt;/li>
&lt;li>å®éªŒæ€§çš„æ”¯æŒäº† DNS è¯ä¹¦çš„æ”¯æŒï¼›&lt;/li>
&lt;/ul>
&lt;p>å…¶å®æœ¬æ¬¡çš„æ›´æ–°å†…å®¹è¿˜æ¯”è¾ƒå¤šï¼Œå¯¹å…¶ä»–ç‰¹æ€§æ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥å‚è€ƒå…¶ &lt;a href="https://istio.io/news/2019/announcing-1.4/change-notes/">ReleaseNote&lt;/a>&lt;/p>
&lt;h1 id="red-hat-å®£å¸ƒ-quay-å¼€æº">Red Hat å®£å¸ƒ Quay å¼€æº&lt;/h1>
&lt;p>&lt;a href="https://github.com/quay/quay">Quay&lt;/a> é¡¹ç›®æ˜¯ä¸€ä¸ªå¼€æºçš„é•œåƒå­˜å‚¨ä»“åº“ï¼ŒåŒ…å«å¤šç§ç™»å½•è®¤è¯èƒ½ï¼ŒåŠé•œåƒæ‰«æï¼Œæ„å»ºç­‰åŠŸèƒ½ã€‚&lt;/p>
&lt;p>å°±æˆ‘ä¸ªäººä½¿ç”¨ç»éªŒè€Œè¨€ï¼ŒQuay ä»…ä½œä¸ºä¸€ä¸ªé•œåƒä»“åº“è€Œè¨€ï¼Œæ˜¯è¶³å¤Ÿçš„ã€‚ä½†æ“ä½œä½“éªŒä¸Šå´æ¯”è¾ƒä¸€èˆ¬ã€‚&lt;/p>
&lt;p>Quay.io å’Œ Docker Hub ç›¸æ¯”ï¼ŒåŠŸèƒ½å¼±äº†å¾ˆå¤šï¼Œæ‰€ä»¥æˆ‘ä¸ªäººå¯¹äºå…¬å¼€é•œåƒè€Œè¨€ï¼Œæ›´å€¾å‘äºä½¿ç”¨ Docker Hubã€‚
å¯¹äºç§æœ‰é•œåƒçš„è¯ï¼Œæˆ‘ä¼šä½¿ç”¨è‡ªå·±çš„ç§æœ‰ä»“åº“ã€‚&lt;/p>
&lt;p>å¯¹ Quay æ„Ÿå…´è¶£çš„æœ‹å‹ï¼Œå¯ä»¥è®¿é—®&lt;a href="https://github.com/quay/quay">é¡¹ç›®ä¸»é¡µ&lt;/a>è¿›è¡Œäº†è§£ã€‚&lt;/p>
&lt;h2 id="ä¸Šæ¸¸è¿›å±•">ä¸Šæ¸¸è¿›å±•&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://events19.linuxfoundation.org/events/kubecon-cloudnativecon-north-america-2019">KubeCon North America 2019&lt;/a> å³å°†å¬å¼€ï¼›&lt;/li>
&lt;li>ä¸Šæ¸¸è¿›å…¥ä»£ç å†»ç»“é˜¶æ®µï¼Œæ­£å¥½å¯ä»¥å®‰å¿ƒçš„å‚åŠ  KubeConï¼›&lt;/li>
&lt;li>Kubernetes v1.17.0-beta.2 å³å°†å‘å¸ƒï¼›&lt;/li>
&lt;li>Kubernets v1.14.9ã€v1.15.6ã€v1.16.3 ç›¸ç»§å‘å¸ƒï¼Œv1.13 EOL ;&lt;/li>
&lt;li>Kubeadm ä¸­ kube-scheduler å’Œ kube-controller-manager å¼€å§‹ä½¿ç”¨å®‰å…¨ç«¯å£äº†ï¼Œéœ€è¦æ³¨æ„ &lt;a href="https://github.com/kubernetes/kubernetes/pull/85043">#85043&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="é¡¹ç›®æ¨è">é¡¹ç›®æ¨è&lt;/h2>
&lt;p>ä»‹ç»ä¸€ä¸ªé¡¹ç›®ï¼Œkubeview å¯ä»¥å¯è§†åŒ–çš„æŸ¥çœ‹ Kubernetes é›†ç¾¤å†…çš„çŠ¶æ€ã€‚&lt;/p>
&lt;p>&lt;img src="https://user-images.githubusercontent.com/14982936/53411103-87b68a00-39bd-11e9-81b2-df2fb9cd7b28.png" alt="kubeview - https://moelove.info">&lt;/p>
&lt;hr>
&lt;p>å¯ä»¥é€šè¿‡ä¸‹é¢äºŒç»´ç è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘ï¼Œåœ¨å…¬ä¼—å·åå°å›å¤ k8s å¯åŠ å…¥æŠ€æœ¯åœˆäº¤æµã€‚&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>2019 å®¹å™¨ä½¿ç”¨é‡æŠ¥å‘Š</title><link>https://moelove.info/2019/11/17/2019-%E5%AE%B9%E5%99%A8%E4%BD%BF%E7%94%A8%E9%87%8F%E6%8A%A5%E5%91%8A/</link><guid isPermaLink="true">https://moelove.info/2019/11/17/2019-%E5%AE%B9%E5%99%A8%E4%BD%BF%E7%94%A8%E9%87%8F%E6%8A%A5%E5%91%8A/</guid><pubDate>Sun, 17 Nov 2019 16:18:15 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;p>æœ€è¿‘ &lt;a href="https://sysdig.com/">sysdig&lt;/a> å‘å¸ƒäº† &lt;a href="https://sysdig.com/resources/papers/2019-container-usage-report/">2019 å®¹å™¨ä½¿ç”¨æŠ¥å‘Š&lt;/a>ï¼Œå†…å®¹è¿˜æ¯”è¾ƒæœ‰è¶£ï¼Œç‰¹åˆ«æ¥ä»‹ç»ä¸€ä¸‹ã€‚ å…³æ³¨å…¬ä¼—å·ã€ŒMoeloveã€å›å¤ &lt;strong>docker2019&lt;/strong> å³å¯è·å–å®Œæ•´ PDF æŠ¥å‘Šã€‚&lt;/p>
&lt;h2 id="å…³é”®ä¿¡æ¯">å…³é”®ä¿¡æ¯&lt;/h2>
&lt;p>&lt;img src="https://moelove.info/img/2019-sisdig-report-key.png" alt="keyinfo - https://moelove.info">&lt;/p>
&lt;h2 id="å®¹å™¨è¿è¡Œæ—¶">å®¹å™¨è¿è¡Œæ—¶&lt;/h2>
&lt;p>&lt;img src="https://moelove.info/img/2019-sisdig-report-runtime.png" alt="container-runtime - https://moelove.info">&lt;/p>
&lt;p>Docker ä»ç„¶æ˜¯å æ®å¸‚åœºè§„æ¨¡æœ€å¤§çš„å®¹å™¨è¿è¡Œæ—¶ ï¼ˆ79%ï¼‰ï¼Œè€Œå…¶ä»–çš„ï¼Œç±»ä¼¼ rktï¼Œlxcï¼Œpodman ä¹‹ç±»çš„å¸‚åœºå æ¯”å¾®ä¹å…¶å¾®ï¼Œç”šè‡³æ²¡æœ‰åœ¨æŠ¥å‘Šä¸­å‡ºç°ã€‚&lt;/p>
&lt;p>containerd æºè‡ª Dockerï¼Œç°åœ¨ä¹Ÿå æ®äº†ä¸€å¸­ä¹‹åœ°ï¼›è€Œå¯¹äº cri-o æŠ¥å‘Šä¸­æŒ‡å‡ºï¼Œä¹‹åå¸‚åœºä»½é¢å¯èƒ½ä¼šå¢åŠ ã€‚&lt;/p>
&lt;p>åœ¨æˆ‘ä¸ªäººçœ‹æ¥ï¼Œè¿‘ä¸€å¹´å†… Docker åœ¨ä¼ä¸šç”Ÿäº§ç¯å¢ƒçš„ä½¿ç”¨è§„æ¨¡ä»ç„¶ä¼šä¿æŒæœ€å¤§ã€‚&lt;/p>
&lt;h2 id="ç¼–æ’">ç¼–æ’&lt;/h2>
&lt;p>&lt;img src="https://moelove.info/img/2019-sisdig-report-orchestrator.png" alt="container orchestrators - https://moelove.info">&lt;/p>
&lt;p>å¯ä»¥çœ‹åˆ° Kubernetes é¥é¥é¢†å…ˆï¼ŒåŠ ä¸Šæ„å»ºåœ¨ Kubernetes ä¹‹ä¸Šçš„ OpenShift å’Œ Rancher ï¼Œè¿™ä¸ªéœ¸ä¸»åœ°ä½æ˜¯éå¸¸ç¨³äº†ã€‚&lt;/p>
&lt;p>ä¸ªäººçœ‹æ¥ï¼Œè¿‘ä¸€å¹´å†…ï¼ŒKubernetes çš„åœ°ä½æ˜¯ä¸å¯èƒ½è¢«æ’¼åŠ¨äº†ï¼Œè¶Šæ¥è¶Šå¤šçš„ä¼ä¸šä¹Ÿéƒ½ä¼šå°†æŠ€æœ¯æ ˆè¿ç§»ä¸Šå»æˆ–è€…è°ƒç ”åŸºäº Kubernetes çš„äº‘åŸç”Ÿè§£å†³æ–¹æ¡ˆã€‚&lt;/p>
&lt;h2 id="metrics">metrics&lt;/h2>
&lt;p>&lt;img src="https://moelove.info/img/2019-sisdig-report-metrics.png" alt="custom metrics - https://moelove.info">&lt;/p>
&lt;p>Prometheus å·²ç»æˆä¸ºäº‹å®æ ‡å‡†ï¼ŒåŠ ä¸Š Prometheus ä½œä¸º CNCF æ¯•ä¸šé¡¹ç›®ï¼Œä»¥åŠå›´ç»• CNCF åŠäº‘åŸç”Ÿç›¸å…³çš„å„ç±»åŸºç¡€è½¯ä»¶ç­‰ï¼Œéƒ½å¢åŠ äº†å„ç±» metricsï¼Œä»¥åŠå„ç±» exporter è¶Šæ¥è¶Šå¤šï¼Œå‡ ä¹å¯ä»¥æ¶µç›–ç”Ÿäº§ä¸­æ‰€éœ€çš„å„ç±» metrics çš„éœ€æ±‚äº†ã€‚&lt;/p>
&lt;h2 id="æŠ¥è­¦">æŠ¥è­¦&lt;/h2>
&lt;p>&lt;img src="https://moelove.info/img/2019-sisdig-report-alert.png" alt="alerts - https://moelove.info">&lt;/p>
&lt;p>è¿™ä¸ªå›¾ä¹Ÿå¯ä»¥ä»ä¾§é¢åæ˜ å‡ºï¼ŒèŠ‚ç‚¹çš„ç¨³å®šæ€§æ˜¯å¤§å¤šæ•°ç”¨æˆ·æ‰€å…³æ³¨çš„ç„¦ç‚¹ã€‚(æ— è®ºä¸Šå±‚å¦‚ä½•è°ƒåº¦ï¼Œåº•å±‚çš„ç¨³å®šæ€§ä¾ç„¶å¾ˆé‡è¦)&lt;/p>
&lt;h2 id="pods-è§„æ¨¡">Pods è§„æ¨¡&lt;/h2>
&lt;p>&lt;img src="https://moelove.info/img/2019-sisdig-report-pods.png" alt="Pods - https://moelove.info">&lt;/p>
&lt;p>å¤šæ•°é›†ç¾¤å±äºä¸­å°è§„æ¨¡çš„ï¼ˆä¹Ÿè¯´æ˜æ˜¯ä¸ªæ­£åœ¨å‘å±•çš„é˜¶æ®µï¼‰&lt;/p>
&lt;h2 id="ç»“è®º">ç»“è®º&lt;/h2>
&lt;p>å®¹å™¨ä»ç„¶åœ¨åº”ç”¨äº¤ä»˜ä¸Šå‘æŒ¥ç€é‡è¦çš„ä½œç”¨ï¼Œä»å»å¹´å‘å¸ƒæŠ¥å‘Šï¼ˆåœ¨å…¬ä¼—å·åå°å›å¤ &lt;strong>docker2018&lt;/strong> è·å–ï¼‰ä»¥æ¥ï¼Œå®¹å™¨æŠ€æœ¯çš„é‡‡ç”¨ç‡ä»åœ¨åŠ é€Ÿï¼Œå®¹å™¨å¯†åº¦ç¿»äº†ä¸€ç•ªï¼Œå¹¶ä¸”éšç€æŠ€æœ¯çš„æˆç†Ÿï¼Œä¹Ÿæœ‰äº†è¶Šæ¥è¶Šå¤šçš„æˆç†Ÿæ¡ˆä¾‹ã€‚&lt;/p>
&lt;p>Prometheus å·²ç»æˆä¸ºäº†äº‘åŸç”Ÿåº”ç”¨æŒ‡æ ‡çš„æ ‡å‡†åŒ–æ–¹æ¡ˆï¼Œå®¹å™¨ç¼–æ’æŠ€æœ¯ Kubernetes æˆä¸ºäº†äº‹å®çš„æ ‡å‡†ï¼Œä¼ä¸šåº”è¯¥åœ¨ Kubernetes ä¸Šè¿›è¡ŒæŠ•èµ„ï¼Œä»¥è·Ÿä¸ŠæŠ€æœ¯æ½®æµçš„æ­¥ä¼ã€‚&lt;/p>
&lt;hr>
&lt;p>å¯ä»¥é€šè¿‡ä¸‹é¢äºŒç»´ç è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘ï¼Œ åœ¨å…¬ä¼—å·åå°å›å¤ &lt;strong>docker2019&lt;/strong> å¯ä¸‹è½½å®Œæ•´æŠ¥å‘Šã€‚&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category><category domain="https://moelove.info/tags/Docker/">Docker</category><category domain="https://moelove.info/tags/Container/">Container</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| Vitess æ­£å¼ä» CNCF æ¯•ä¸š</title><link>https://moelove.info/2019/11/10/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Vitess-%E6%AD%A3%E5%BC%8F%E4%BB%8E-CNCF-%E6%AF%95%E4%B8%9A/</link><guid isPermaLink="true">https://moelove.info/2019/11/10/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Vitess-%E6%AD%A3%E5%BC%8F%E4%BB%8E-CNCF-%E6%AF%95%E4%B8%9A/</guid><pubDate>Sun, 10 Nov 2019 23:17:45 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="vitess-æ­£å¼ä»-cncf-æ¯•ä¸š">Vitess æ­£å¼ä» CNCF æ¯•ä¸š&lt;/h2>
&lt;p>CNCFï¼ˆäº‘åŸç”Ÿè®¡ç®—åŸºé‡‘ä¼šï¼‰åœ¨ç¾å›½æ—¶é—´ 2019 å¹´ 11 æœˆ 5 æ—¥å®£å¸ƒ &lt;a href="https://vitess.io/">Vitess&lt;/a> æ­£å¼æ¯•ä¸šäº†ã€‚&lt;/p>
&lt;p>è¿™æ˜¯ CNCF ä¸­ç¬¬ 8 ä¸ªæ­£å¼æ¯•ä¸šçš„é¡¹ç›®ï¼Œæœ€è¿‘çš„å‡ æ¬¡å‘¨æŠ¥ä¸­ï¼ŒåŸºæœ¬éƒ½ä¼šè°ˆåˆ°å…³äº CNCF é¡¹ç›®æ¯•ä¸šç›¸å…³çš„ä¿¡æ¯ï¼ˆå¿™ç¢Œçš„ Q4 å•Šï¼‰&lt;/p>
&lt;p>Vitess æœ€åˆç”± YouTube åœ¨ 2010 å¹´åˆ›å»ºï¼Œ ä¸»è¦æ˜¯ç”¨äº MySQL æ¨ªå‘æ‰©å±•çš„æ•°æ®åº“ç³»ç»Ÿã€‚æ®è¯´ Vitess ä¸€ç›´ä¸º YouTube çš„æ‰€æœ‰æ•°æ®åº“æä¾›æœåŠ¡ï¼Œå›½å†…è²Œä¼¼æ˜¯äº¬ä¸œä½¿ç”¨æ¯”è¾ƒå¤šã€‚&lt;/p>
&lt;p>è¡¥ä¸€å¼  Vitess çš„æ¶æ„å›¾ï¼š&lt;/p>
&lt;p>&lt;img src="https://vitess.io/docs/overview/img/VitessOverview.png" alt="Vitess - https://moelove.info">&lt;/p>
&lt;p>æœ€åï¼Œå†æ¬¡ &lt;a href="https://www.cncf.io/announcement/2019/11/05/cloud-native-computing-foundation-announces-vitess-graduation/">æ­å–œ Vitess é¡ºåˆ©æ¯•ä¸š&lt;/a>!&lt;/p>
&lt;h2 id="helm-v2160-æ­£å¼å‘å¸ƒ">Helm v2.16.0 æ­£å¼å‘å¸ƒ&lt;/h2>
&lt;p>åœ¨ä¹‹å‰çš„ &lt;a href="https://zhuanlan.zhihu.com/p/87696049">K8S ç”Ÿæ€å‘¨æŠ¥| Helm v2 æœ€åä¸€ä¸ªç‰¹æ€§ç‰ˆæœ¬å‘å¸ƒ&lt;/a>ä¸­ï¼Œæˆ‘ä»‹ç»äº† Helm æ­£å¼å‘å¸ƒäº† v2.15.0 ä½œä¸º v2 ç‰ˆæœ¬çš„æœ€åä¸€ä¸ªç‰¹æ€§ç‰ˆæœ¬ã€‚&lt;/p>
&lt;p>è€Œæœ¬æ¬¡å‘å¸ƒçš„ v2.16.0 ä¹Ÿç¡®å®æ²¡æœ‰ä¸»è¦çš„ç‰¹æ€§æ›´æ–°ï¼Œéƒ½æ˜¯ä¸€äº›é—®é¢˜ä¿®å¤å’Œå®‰å…¨æ›´æ–°ç­‰ï¼›ï¼ˆåœ¨è¿™æ¬¡ç‰ˆæœ¬ä¸­æ˜¯ 13 ä¸ªç‹¬ç«‹ committers ä¹‹ä¸€ :) ï¼‰&lt;/p>
&lt;p>å½“ç„¶ï¼Œæœ¬æ¬¡ç‰ˆæœ¬ä¸­ &lt;strong>å¢åŠ äº†å¯¹ Kubernetes v1.16 çš„æ”¯æŒ&lt;/strong> ã€‚&lt;/p>
&lt;p>å¯¹æ­¤ç‰ˆæœ¬æ„Ÿå…´è¶£çš„æœ‹å‹å¯å‚è€ƒ &lt;a href="https://github.com/helm/helm/releases/tag/v2.16.0">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="jaeger-v115-æ­£å¼å‘å¸ƒ">Jaeger v1.15 æ­£å¼å‘å¸ƒ&lt;/h2>
&lt;p>Jaeger åœ¨ä» CNCF æ¯•ä¸šåï¼Œæ­£å¼å‘å¸ƒäº† v1.15 ç‰ˆæœ¬ï¼Œæœ¬æ¬¡ç‰ˆæœ¬ä¸­æˆ‘è®¤ä¸ºå€¼å¾—æ³¨æ„çš„å†…å®¹æ˜¯ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;code>ingester.deadlockInterval&lt;/code> çš„é»˜è®¤å€¼ä» 1 åˆ†é’Ÿè®¾ç½®ä¸ºäº† 0ï¼Œ è¿™æ˜¯ä¸€ä¸ªç ´åæ€§å˜æ›´ï¼Œå¦‚æœç”±ä¾èµ–æ­¤å‚æ•°çš„é»˜è®¤è¡Œä¸ºï¼Œåˆ™éœ€è¦æ³¨æ„ï¼›&lt;/li>
&lt;li>&lt;code>--collector.grpc.tls.client.ca&lt;/code> å‚æ•°ç”± &lt;code>collector.grpc.tls.client-ca&lt;/code> ä»£æ›¿ï¼›&lt;/li>
&lt;li>æ”¯æŒé€šè¿‡ TLS è¿æ¥ Kafkaï¼›&lt;/li>
&lt;/ul>
&lt;p>å¯¹æ­¤ç‰ˆæœ¬æ„Ÿå…´è¶£çš„æœ‹å‹å¯å‚è€ƒ &lt;a href="https://github.com/jaegertracing/jaeger/releases/tag/v1.15.1">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="talos-å‘å¸ƒ-v030-alpha6">Talos å‘å¸ƒ v0.3.0-alpha.6&lt;/h2>
&lt;p>åœ¨ 7 æœˆä»½çš„ K8S å‘¨æŠ¥ä¸­ï¼Œæˆ‘ä¸ºä½ ä»‹ç»è¿‡ Talos é¡¹ç›®ï¼Œä¸€æ¬¾ç€é‡äº Kubernetes çš„å®‰å…¨çš„ç°ä»£åŒ–æ“ä½œç³»ç»Ÿï¼Œæ‰€æœ‰ç³»ç»Ÿç®¡ç†éƒ½é€šè¿‡ API å®Œæˆã€‚&lt;/p>
&lt;p>ç»è¿‡ä¸€æ®µæ—¶é—´çš„å‘å±•ï¼ŒTalos å·²ç»é€šè¿‡äº† CNCF çš„ Kubernetes ä¸€è‡´æ€§è®¤è¯ã€‚&lt;/p>
&lt;p>åœ¨æœ¬å‘¨ Talos å‘å¸ƒäº† v0.3.0-alpha ç‰ˆæœ¬ï¼Œä¹‹å Talos ä¼šå¢åŠ ä¸€äº›ä¼ä¸šçº§å…³æ³¨çš„åŠŸèƒ½ï¼Œæ¯”å¦‚å®¡è®¡ï¼ŒRBAC è¿˜æœ‰æ—¥å¿—ç­‰ã€‚åŒæ—¶ï¼Œä¹Ÿè€ƒè™‘åˆ°äº†ä¸€ä¸ªå¸¸è§„çš„éœ€æ±‚ - è¯ä¹¦æœ‰æ•ˆæœŸã€‚&lt;/p>
&lt;p>å¯¹æ­¤é¡¹ç›®æ„Ÿå…´è¶£çš„æœ‹å‹ï¼Œå¯ä»¥å‚è€ƒå®˜ç½‘è¿›è¡Œä½“éªŒã€‚https://www.talos.dev/&lt;/p>
&lt;h2 id="kubernetes-v1170-beta1-å‘å¸ƒ">Kubernetes v1.17.0-beta.1 å‘å¸ƒ&lt;/h2>
&lt;p>Kubernetes v1.17.0-beta.1 äºæœ¬å‘¨å‘å¸ƒï¼ŒæŒ‰ç…§å‘å¸ƒè®¡åˆ’ï¼Œå¾ˆå¿«æˆ‘ä»¬ä¹Ÿå°†ä¼šè¿æ¥æ­£å¼ç‰ˆäº†ã€‚&lt;/p>
&lt;p>è€Œåœ¨æœ¬å‘¨ï¼Œ Kubernetes æ­£å¸¸æƒ…å†µä¸‹å°†ä¼šç»Ÿä¸€å‘å¸ƒä¸€æ‰¹ patch ç‰ˆæœ¬ï¼Œä¸æ­¤åŒæ—¶ v1.13 ä¹Ÿå°†æ­£å¼çš„ EOLã€‚å¦‚æœè¿˜æœ‰åœ¨ä½¿ç”¨ v1.13 ç‰ˆæœ¬çš„ï¼Œæ¨èè¿›è¡Œå‡çº§ã€‚&lt;/p>
&lt;p>å¦å¤–ï¼Œåœ¨ v1.17 ä¸­ï¼Œ&lt;code>NodeStatusReportFrequency&lt;/code> å°†è¢«å‡å°‘è‡³ 5 åˆ†é’Ÿï¼Œä¹Ÿå¯ä»¥ç®—ä½œæ˜¯ä¸€ä¸ªä¸é”™çš„ä¼˜åŒ–ç‚¹äº†ã€‚&lt;/p>
&lt;p>&lt;code>TaintNodesByCondition&lt;/code> å’Œ &lt;code>ScheduleDaemonSetPods&lt;/code> ç­‰ç‰¹æ€§å·² GAï¼Œ&lt;/p>
&lt;p>è‡³äºå…¶ä»–å˜æ›´ï¼Œæ¯æ¬¡å‘¨æŠ¥çš„ â€œä¸Šæ¸¸è¿›å±•â€ éƒ¨åˆ†éƒ½æœ‰æ‰€æåŠï¼Œæœ¬æ¬¡æš‚ä¸”è·³è¿‡ï¼Œç­‰æ­£å¼ç‰ˆå‡ºæ¥å†è®¨è®ºã€‚&lt;/p>
&lt;p>å¯¹æ­¤æ¬¡ç‰ˆæœ¬å˜æ›´çš„å†…å®¹æœ‰å…´è¶£çš„æœ‹å‹ï¼Œå¯å‚é˜…å…¶ &lt;a href="https://github.com/kubernetes/kubernetes/blob/master/CHANGELOG-1.17.md#downloads-for-v1170-beta1">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="ä¸Šæ¸¸è¿›å±•">ä¸Šæ¸¸è¿›å±•&lt;/h2>
&lt;ul>
&lt;li>Alpha ç‰¹æ€§ &lt;code>MountContainers&lt;/code> å·²åˆ é™¤ &lt;a href="https://github.com/kubernetes/kubernetes/pull/84365">#84365&lt;/a>&lt;/li>
&lt;li>kube-proxy çš„ &lt;code>cleanup-ipvs&lt;/code> å‚æ•°å·²è¿‡æœŸï¼Œå¯ç›´æ¥ä½¿ç”¨ &lt;code>--cleanup&lt;/code> åˆ é™¤ ipvs çš„è§„åˆ™ &lt;a href="https://github.com/kubernetes/kubernetes/pull/83832">#83832&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="é¢˜å¤–è¯">é¢˜å¤–è¯&lt;/h2>
&lt;p>åŒåä¸€äº†ï¼Œæ¨èä¸€ä¸‹è‡ªå·±çš„ä¸“æ  &lt;a href="https://gitbook.cn/gitchat/column/5d70cfdc4dc213091bfca46f">ã€ŠDocker æ ¸å¿ƒçŸ¥è¯†å¿…çŸ¥å¿…ä¼šã€‹&lt;/a>ï¼Œå·²æœ‰ 1000+ ä¼™ä¼´è®¢é˜…ï¼&lt;/p>
&lt;p>&lt;img src="https://moelove.info/img/docker-course-all.jpg" alt="Docker æ ¸å¿ƒçŸ¥è¯†å¿…çŸ¥å¿…ä¼š">&lt;/p>
&lt;hr>
&lt;p>å¯ä»¥é€šè¿‡ä¸‹é¢äºŒç»´ç è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘ï¼Œåœ¨å…¬ä¼—å·åå°å›å¤ k8s å¯åŠ å…¥æŠ€æœ¯åœˆäº¤æµã€‚&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| Helm v2 çˆ†å‡ºå…¨ç‰ˆæœ¬æ¼æ´</title><link>https://moelove.info/2019/11/03/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Helm-v2-%E7%88%86%E5%87%BA%E5%85%A8%E7%89%88%E6%9C%AC%E6%BC%8F%E6%B4%9E/</link><guid isPermaLink="true">https://moelove.info/2019/11/03/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Helm-v2-%E7%88%86%E5%87%BA%E5%85%A8%E7%89%88%E6%9C%AC%E6%BC%8F%E6%B4%9E/</guid><pubDate>Sun, 03 Nov 2019 23:17:05 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="jaeger-é¡ºåˆ©ä»-cncf-æ¯•ä¸š">Jaeger é¡ºåˆ©ä» CNCF æ¯•ä¸š&lt;/h2>
&lt;p>CNCFï¼ˆäº‘åŸç”Ÿè®¡ç®—åŸºé‡‘ä¼šï¼‰åœ¨ç¾å›½æ—¶é—´ 2019 å¹´ 10 æœˆ 31 æ—¥å®£å¸ƒ &lt;a href="https://www.jaegertracing.io/">Jaeger&lt;/a> æ­£å¼æ¯•ä¸šäº†ã€‚&lt;/p>
&lt;p>è¿™æ˜¯ CNCF ä¸­ç¬¬ 7 ä¸ªæ­£å¼æ¯•ä¸šçš„é¡¹ç›®ï¼Œåœ¨&lt;a href="https://zhuanlan.zhihu.com/p/88777350">ä¸Šæ¬¡å‘¨æŠ¥çš„æœ€å&lt;/a> æˆ‘æ‰åˆšæè¿‡ä¸€äº›é¡¹ç›®æäº¤äº†æ¯•ä¸šç”³è¯·ï¼Œä¹ŸåŒæ—¶ä»¥ Jaeger ä¸ºæ—¶ä¸€å¹´çš„æ¯•ä¸šç”³è¯·ç”³è¯·ä¸¾äº†ä¸ªä¾‹å­ï¼Œæ²¡æƒ³åˆ°æœ¬å‘¨å°±æ¯•ä¸šäº†ã€‚:)&lt;/p>
&lt;p>Jaeger æœ€åˆæ˜¯ç”± Uber å— Dapper å’Œ OpenZipkin å¯å‘ï¼Œå¼€æºå‡ºæ¥çš„ä¸€å¥—åˆ†å¸ƒå¼è¿½è¸ªç³»ç»Ÿã€‚å®ƒä¸»è¦å¯ç”¨äºå¾®æœåŠ¡æ¶æ„ä¸‹çš„åˆ†å¸ƒå¼ç³»ç»Ÿçš„æ ¹å› åˆ†æï¼Œæ€§èƒ½/å»¶è¿Ÿä¼˜åŒ–ï¼ŒæœåŠ¡ä¾èµ–ç­‰æ–¹é¢ã€‚æˆªè‡³ç›®å‰ï¼Œå®ƒåœ¨ GitHub ä¸Šæœ‰ 9.4k çš„ star ï¼Œ986 ä¸ª fork ä»¥åŠ 115 ä½è´¡çŒ®è€…ã€‚&lt;/p>
&lt;p>å®ƒç°åœ¨çš„å­˜å‚¨åç«¯ä¸»è¦å°±æ”¯æŒä¸¤ç§ Cassandra 3.4+ å’Œ Elasticsearch 5.x/6.x ï¼Œåœ¨è¿™ç§ç³»ç»Ÿä¸­ï¼Œéšç€æœåŠ¡è§„æ¨¡çš„æ‰©å¤§ï¼Œå¯¹åç«¯å­˜å‚¨çš„è¦æ±‚ä¹Ÿä¼šå¾ˆé«˜ã€‚å¦å¤–ï¼Œå®ƒæœ‰ä¸€å¥—æ¯”è¾ƒç°ä»£åŒ–çš„ UIï¼Œæ˜¯åŸºäº react å¼€å‘çš„ã€‚&lt;/p>
&lt;p>æ•´ä½“æ¥çœ‹çš„è¯ï¼Œåœ¨ä½¿ç”¨ä¸ŠåŸºæœ¬æŠ€æœ¯æ ˆå°±ä¼šæˆä¸ºä¸‹é¢è¿™æ ·ï¼š&lt;/p>
&lt;p>&lt;img src="https://moelove.info/img/jaeger-apm.png" alt="Jaeger APM - https://moelove.info">&lt;/p>
&lt;p>å½“ç„¶å®é™…çš„æ¶æ„ä¹Ÿå¯èƒ½ä¼šå› ä¸ºåŸºç¡€è®¾æ–½è€Œæ”¹å˜ï¼Œæ¯”å¦‚è¯´å¦‚æœå·²ç»ä½¿ç”¨äº† SkyWalking çš„è¯ï¼Œä¸¤è€…å€’æ˜¯ä¹Ÿå¯ä»¥ç»“åˆï¼Œå¤§æ¦‚å°±ä¼šå˜æˆä¸‹é¢è¿™æ ·ï¼š&lt;/p>
&lt;p>&lt;img src="https://moelove.info/img/jaeger-skywalking.png" alt="Jaeger with SkyWalking - https://moelove.info">&lt;/p>
&lt;p>ä¸è¿‡ï¼Œå¯¹äºæŠ€æœ¯æ–¹æ¡ˆçš„é€‰æ‹©ï¼Œæˆ‘ä¸ªäººå»ºè®®æ˜¯è€ƒè™‘å®é™…éœ€æ±‚ï¼Œä»¥åŠå¯¹å„æ–¹æ¡ˆè¿›è¡Œç†æ€§çš„æƒè¡¡ï¼Œå¦åˆ™çš„è¯ï¼Œè¯´ä¸å®šä»€ä¹ˆæ—¶å€™å°±æ¼”å˜æˆäº†ä¸‹é¢è¿™æ ·ï¼šï¼ˆè¿™ä¸ªè°ƒç”¨é“¾è™½ç„¶æ˜¯å¯ä»¥èµ°é€šçš„ï¼Œä½†æ­¤å¤„æˆ‘æ˜¯å¼€ä¸ªç©ç¬‘çš„ï¼Œ &lt;strong>è¯·å‹¿å½“çœŸ&lt;/strong>ï¼‰&lt;/p>
&lt;p>&lt;img src="https://moelove.info/img/jaeger-with-all.png" alt="Jaeger with All - https://moelove.info">&lt;/p>
&lt;p>æœ€åï¼Œå†æ¬¡&lt;a href="https://www.cncf.io/announcement/2019/10/31/cloud-native-computing-foundation-announces-jaeger-graduation/">æ­å–œ Jaeger é¡ºåˆ©æ¯•ä¸š&lt;/a>ï¼&lt;/p>
&lt;h2 id="helm-2-çˆ†å‡ºå…¨ç‰ˆæœ¬å—å½±å“çš„æ¼æ´">Helm 2 çˆ†å‡ºå…¨ç‰ˆæœ¬å—å½±å“çš„æ¼æ´&lt;/h2>
&lt;p>æœ¬å‘¨ Helm å®˜æ–¹æŠ«éœ²å‡ºæ¥ä¸€ä¸ªå…¨ç‰ˆæœ¬ (Helm åœ¨ 2.0.0 åˆ° 2.15.2 ä¹‹é—´) å—å½±å“çš„æ¼æ´ï¼Œæ˜¯ç”± Cure53 å…¬å¸å‘ç°çš„ã€‚ä¸è¿‡è¿™ä¸ªé—®é¢˜æ˜¯ä»…å­˜åœ¨äºå®¢æˆ·ç«¯ä¸Šçš„ï¼ŒTiller å¹¶æ— å½±å“ã€‚&lt;/p>
&lt;p>æ¼æ´çš„å…·ä½“å†…å®¹æ˜¯ Chart ä¸­å¯èƒ½ä¼šåŒ…å«ä¸€äº›ç¬¦å·é“¾æ¥ï¼Œä½†æ˜¯æ²¡èƒ½æ­£ç¡®å¤„ç†ã€‚&lt;/p>
&lt;p>è§£å†³åŠæ³•å°±æ˜¯å‡çº§åˆ° Helm 2.15.2 ç‰ˆæœ¬ã€‚&lt;/p>
&lt;p>è¯¦ç»†å†…å®¹è¯·å‚è€ƒ &lt;a href="https://helm.sh/blog/2019-10-30-helm-symlink-security-notice/">Helm å®˜æ–¹å…¬å‘Š&lt;/a>&lt;/p>
&lt;h2 id="ä¸Šæ¸¸è¿›å±•">ä¸Šæ¸¸è¿›å±•&lt;/h2>
&lt;ul>
&lt;li>CSI çš„ RBAC roles &lt;code>system:csi-external-provisioner&lt;/code> å’Œ &lt;code>system:csi-external-attacher&lt;/code> å·²è¢«åºŸå¼ƒ &lt;a href="https://github.com/kubernetes/kubernetes/pull/84282">#84282&lt;/a>&lt;/li>
&lt;li>K8S 1.17 ä¸­ä¼šæŠŠ etcd client æ›´æ–°è‡³ v3.4.3 ï¼Œä½†éœ€è¦æ³¨æ„çš„æ˜¯åœ¨ 1.16 ä¸­ etcd client ç°åœ¨è¢«æ›´æ–°åˆ°äº† v3.3.17ï¼Œç”¨äºè§£å†³ IPv6 åœ°å€è§£æé”™è¯¯çš„é—®é¢˜ã€‚ &lt;a href="https://github.com/kubernetes/kubernetes/pull/83968">#83968&lt;/a>&lt;/li>
&lt;/ul>
&lt;hr>
&lt;p>å¯ä»¥é€šè¿‡ä¸‹é¢äºŒç»´ç è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘ï¼Œåœ¨å…¬ä¼—å·åå°å›å¤ k8s å¯åŠ å…¥æŠ€æœ¯åœˆäº¤æµã€‚&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| Helm v3 æœ€åä¸€ä¸ªbetaç‰ˆæœ¬å‘å¸ƒ</title><link>https://moelove.info/2019/10/27/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Helm-v3-%E6%9C%80%E5%90%8E%E4%B8%80%E4%B8%AAbeta%E7%89%88%E6%9C%AC%E5%8F%91%E5%B8%83/</link><guid isPermaLink="true">https://moelove.info/2019/10/27/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Helm-v3-%E6%9C%80%E5%90%8E%E4%B8%80%E4%B8%AAbeta%E7%89%88%E6%9C%AC%E5%8F%91%E5%B8%83/</guid><pubDate>Sun, 27 Oct 2019 23:01:41 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="helm-v300-beta5-å‘å¸ƒ">Helm v3.0.0-beta.5 å‘å¸ƒ&lt;/h2>
&lt;p>è¿™å°†æ˜¯æœ€åä¸€ä¸ª beta ç‰ˆæœ¬ï¼Œä¸‹ä¸€ä¸ªç‰ˆæœ¬å°†ä¼šæ˜¯ Helm v3.0.0-rc.1 ã€‚ç°åœ¨ä¸»è¦ç²¾åŠ›éƒ½é›†ä¸­åœ¨ä¸€äº› bugfix ä¸Šï¼Œä¹Ÿä¼šæœ‰ä¸€äº›è®¾è®¡æ–¹é¢çš„äº‹æƒ…è¿˜éœ€è¦æœ€ç»ˆç¡®è®¤ã€‚&lt;/p>
&lt;p>å¿«é€Ÿçš„çœ‹ä¸€ä¸‹åœ¨æ­¤ç‰ˆæœ¬ä¸­æ–°å¢çš„å†…å®¹ï¼š&lt;/p>
&lt;ul>
&lt;li>ä¸ºäº†èƒ½æä¾›æ›´å¤šå­å‘½ä»¤ï¼Œç°åœ¨ &lt;code>helm get&lt;/code> å’Œ &lt;code>helm show&lt;/code> åˆ†åˆ«ç§»åŠ¨åˆ°äº† &lt;code>helm get all&lt;/code> å’Œ &lt;code>helm show all&lt;/code>ï¼Œ &lt;strong>è¿™æ˜¯ä¸€ä¸ªç ´åæ€§å˜æ›´&lt;/strong>;&lt;/li>
&lt;li>å¯¹ &lt;code>helm get values&lt;/code> å¢åŠ äº†ä¸€ä¸ª &lt;code>--output&lt;/code> çš„é€‰é¡¹ï¼Œç°åœ¨æ”¯æŒä¸‰ç§æ ¼å¼ &lt;code>table&lt;/code>, &lt;code>json&lt;/code>, &lt;code>yaml&lt;/code>ï¼›&lt;/li>
&lt;li>&lt;code>helm test&lt;/code> æ–°å¢äº†ä¸€ä¸ª &lt;code>--logs&lt;/code> çš„å‚æ•°ï¼Œè¿™æ˜¯åœ¨ Helm 2 ä¸­æ–°å¢çš„ï¼›&lt;/li>
&lt;/ul>
&lt;p>å¯¹æ­¤ç‰ˆæœ¬æ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥å‚è€ƒ &lt;a href="https://github.com/helm/helm/releases/tag/v3.0.0-beta.5">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="docker-hub-æ–°å¢åŒå› ç´ è®¤è¯åŠŸèƒ½">Docker Hub æ–°å¢åŒå› ç´ è®¤è¯åŠŸèƒ½&lt;/h2>
&lt;p>æœ€è¿‘ Docker Hub ä¸Šçº¿äº† &lt;strong>åŒå› ç´ è®¤è¯&lt;/strong> çš„åŠŸèƒ½ã€‚è¿™ä¸ªäº‹æƒ…ä¸»è¦æœ‰ä¸¤ä¸ªæ–¹é¢çš„è€ƒè™‘ï¼š&lt;/p>
&lt;ul>
&lt;li>DockerHub å¸Œæœ›èƒ½ç»™ç”¨æˆ·æ›´å¤šçš„å®‰å…¨æ€§ï¼Œä»¥åŠæä¾›æ›´å®Œå–„çš„åŠŸèƒ½ï¼Œä»¥æ­¤æ¥å¸å¼•ä¸ªäººç”¨æˆ·/å¼€æºé¡¹ç›®/ç»„ç»‡/ä¼ä¸šç­‰ä½¿ç”¨ï¼›&lt;/li>
&lt;li>è¿™ä¸ªäº‹æƒ…å…¶å®ä¹Ÿç®—æ˜¯ 4 æœˆä»½è¢«æ”»å‡»äº‹ä»¶çš„åç»­ï¼Œåœ¨ä¸Šä¸ªæœˆçš„å‘¨æŠ¥ä¸­ï¼Œæˆ‘ä¹Ÿä»‹ç»äº† Docker Hub ä¸Šçº¿äº† Access Token çš„åŠŸèƒ½ã€‚è€Œè¿™æ¬¡ä¸Šçº¿ 2FA æ›´æ˜¯è¿›ä¸€æ­¥æé«˜äº†å…¶å®‰å…¨æ€§ï¼&lt;/li>
&lt;/ul>
&lt;p>å…³äºå¦‚ä½•å¯ç”¨ 2FA å¯ç›´æ¥å‚è€ƒ Docker Hub çš„æ–‡æ¡£ &lt;a href="https://docs.docker.com/docker-hub/2fa/">https://docs.docker.com/docker-hub/2fa/&lt;/a>&lt;/p>
&lt;h2 id="istio-140-beta0-å‘å¸ƒ">Istio 1.4.0-beta.0 å‘å¸ƒ&lt;/h2>
&lt;p>Istio ä»Šå¹´ç‰ˆæœ¬å‘å¸ƒå¯ä»¥è¯´æ˜¯éå¸¸é¢‘ç¹äº†ï¼Œå…¶ &lt;a href="https://github.com/istio/istio/releases/tag/1.3.0">1.3.0 ç‰ˆæœ¬&lt;/a>æ˜¯åœ¨ä»Šå¹´ 9 æœˆä»½å‘å¸ƒçš„ã€‚&lt;/p>
&lt;p>æœ¬å‘¨å‘å¸ƒäº† Istio 1.4.0-beta.0 ç‰ˆæœ¬ï¼Œæ­£å¼ç‰ˆæœ¬ä¹Ÿå°±ä¸ä¼šå¤ªè¿œäº†ã€‚åœ¨è¿™ä¸ªç‰ˆæœ¬ä¸­åŒ…å«äº†ä¸€äº› bugfix å½“ç„¶ä¹Ÿæœ‰äº›å…¶ä»–æ”¹åŠ¨ï¼Œæ¯”å¦‚è¯´æŠŠ DNS è¯ä¹¦å’Œå…¶ä»–è¯ä¹¦åˆ†å¼€ä¹‹ç±»çš„ï¼Œè¿˜æœ‰ä¸€äº›é¥æµ‹æ–¹é¢çš„æ”¹åŠ¨ã€‚å½“ç„¶ç°åœ¨è¿˜æœ‰ä¸å°‘éœ€è¦å®Œå–„çš„åœ°æ–¹ï¼Œæ•¬è¯·æœŸå¾…æ­£å¼ç‰ˆçš„åˆ°æ¥å§ã€‚&lt;/p>
&lt;p>æœ‰æ„å°é²œçš„æœ‹å‹ï¼Œå¯ç›´æ¥è®¿é—®&lt;a href="https://github.com/istio/istio/releases/tag/1.4.0-beta.0">æ­¤ç‰ˆæœ¬çš„ Release åœ°å€&lt;/a>ã€‚&lt;/p>
&lt;h2 id="ä¸Šæ¸¸è¿›å±•">ä¸Šæ¸¸è¿›å±•&lt;/h2>
&lt;ul>
&lt;li>kube-scheduler çš„ &lt;code>ScheduleDaemonSetPods&lt;/code> è½¬å‘ GAï¼Œå¹¶åœ¨ 1.18 ä¸­å°†ä» feature gate é…ç½®ä¸­ç§»é™¤ã€‚#82795&lt;/li>
&lt;/ul>
&lt;h2 id="é¢˜å¤–è¯">é¢˜å¤–è¯&lt;/h2>
&lt;p>æœ€è¿‘ä¸€äº› CNCF æ‰˜ç®¡çš„é¡¹ç›®ï¼ŒåŒ…æ‹¬ gRPC, Harbor (é•œåƒä»“åº“) ç­‰éƒ½åœ¨å‡†å¤‡ç”³è¯·ä» CNCF æ¯•ä¸šäº†ï¼Œä¸è¿‡ç°åœ¨å°šæœªæ­£å¼é€šè¿‡ã€‚æ•´ä¸ªè¿‡ç¨‹å‘¨æœŸå¯èƒ½ä¼šæ¯”è¾ƒé•¿ï¼Œæ¯”å¦‚ Jaeger çš„æ¯•ä¸šç”³è¯·ï¼Œå·²ç»å·®ä¸å¤šå¿«ä¸€å¹´äº†å§ã€‚&lt;/p>
&lt;p>ä¸è¿‡è¿™ä¹Ÿä»ä¾§é¢åæ˜ äº†è¿™äº›é¡¹ç›®å‘å±•çš„è¿˜ä¸é”™ï¼Œé¢„ç¥é¡ºåˆ©æ¯•ä¸šã€‚&lt;/p>
&lt;hr>
&lt;p>å¯ä»¥é€šè¿‡ä¸‹é¢äºŒç»´ç è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘ï¼Œåœ¨å…¬ä¼—å·åå°å›å¤ k8s å¯åŠ å…¥æŠ€æœ¯åœˆäº¤æµã€‚&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| Helm v2 æœ€åä¸€ä¸ªç‰¹æ€§ç‰ˆæœ¬å‘å¸ƒ</title><link>https://moelove.info/2019/10/21/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Helm-v2-%E6%9C%80%E5%90%8E%E4%B8%80%E4%B8%AA%E7%89%B9%E6%80%A7%E7%89%88%E6%9C%AC%E5%8F%91%E5%B8%83/</link><guid isPermaLink="true">https://moelove.info/2019/10/21/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Helm-v2-%E6%9C%80%E5%90%8E%E4%B8%80%E4%B8%AA%E7%89%B9%E6%80%A7%E7%89%88%E6%9C%AC%E5%8F%91%E5%B8%83/</guid><pubDate>Mon, 21 Oct 2019 10:01:23 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚ æ–‡æœ«æœ‰æ´»åŠ¨ï¼Œæ¬¢è¿å‚ä¸ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="docker-19034-æ­£å¼å‘å¸ƒ">Docker 19.03.4 æ­£å¼å‘å¸ƒ&lt;/h2>
&lt;p>åœ¨æœ¬å‘¨ Docker å‘å¸ƒäº† 19.03.4 ç‰ˆæœ¬ï¼Œè¿™ä¸ªç‰ˆæœ¬ä¸»è¦æ˜¯ä¸ºäº†ä¿®å¤ä¸Šå‘¨å‘¨æŠ¥ä¸­ä»‹ç»çš„ &lt;code>DOCKER-USER&lt;/code> iptables é“¾ä¸¢å¤±çš„é—®é¢˜ã€‚&lt;/p>
&lt;p>å¦‚æœè¦å‡çº§ Docker ç‰ˆæœ¬çš„è¯ï¼Œå¯é€‰æ‹©å‡çº§åˆ°æ­¤ç‰ˆæœ¬ã€‚&lt;/p>
&lt;h2 id="kubernetes-ä¿®å¤å…¨ç‰ˆæœ¬å½±å“æ¼æ´">Kubernetes ä¿®å¤å…¨ç‰ˆæœ¬å½±å“æ¼æ´&lt;/h2>
&lt;p>ä¸Šå‘¨å‘¨æŠ¥ä¸­çš„ &lt;strong>ä¸Šæ¸¸è¿›å±•&lt;/strong> éƒ¨åˆ†ï¼Œä»‹ç»äº†å¯¹ CVE-2019-11253 çš„ä¿®å¤ï¼Œé™åˆ¶ YAML/JSON çš„è§£ç å¤§å°ä¸º 3M ã€‚æœ¬å‘¨ç›¸ç»§å‘å¸ƒäº†ä»¥ä¸‹ç‰ˆæœ¬ï¼ŒåŒ…å«äº†å¯¹æ­¤æ¼æ´çš„ä¿®å¤ã€‚&lt;/p>
&lt;ul>
&lt;li>v1.13.12&lt;/li>
&lt;li>v1.14.8&lt;/li>
&lt;li>v1.15.5&lt;/li>
&lt;li>v1.16.2&lt;/li>
&lt;/ul>
&lt;p>å®é™…å—æ­¤æ¼æ´å½±å“çš„ç‰ˆæœ¬æ˜¯ï¼š&lt;/p>
&lt;ul>
&lt;li>Kubernetes v1.0.0-1.12.x&lt;/li>
&lt;li>Kubernetes v1.13.0-1.13.11 (ä¿®å¤äº v1.13.12)&lt;/li>
&lt;li>Kubernetes v1.14.0-1.14.7 (ä¿®å¤äº v1.14.8)&lt;/li>
&lt;li>Kubernetes v1.15.0-1.15.4 (ä¿®å¤äº v1.15.5)&lt;/li>
&lt;li>Kubernetes v1.16.0-1.16.1 (ä¿®å¤äº v1.16.2)&lt;/li>
&lt;/ul>
&lt;p>å»ºè®®å¯¹é›†ç¾¤è¿›è¡Œå‡çº§ã€‚ &lt;strong>ä½†æ˜¯å‡çº§å‰ï¼Œè¯·åŠ¡å¿…å…ˆé˜…è¯»å®Œ &lt;a href="https://github.com/kubernetes/kubernetes/issues/83253">https://github.com/kubernetes/kubernetes/issues/83253&lt;/a> çš„å†…å®¹&lt;/strong> åœ¨æ¸…æ¥šäº†è§£ä¸åŒç‰ˆæœ¬çš„è¡Œä¸ºåï¼Œå†åšå‡çº§ã€‚&lt;/p>
&lt;p>å¯¹æ­¤æ¼æ´æ„Ÿå…´è¶£çš„æœ‹å‹ï¼Œä¹Ÿå¯å‚é˜…&lt;a href="https://discuss.kubernetes.io/t/announce-cve-2019-11253-denial-of-service-vulnerability-from-malicious-yaml-or-json-payloads/8349">ç¤¾åŒºå…¬å‘Š&lt;/a>&lt;/p>
&lt;h2 id="prometheus-pushgateway-v10-æ­£å¼å‘å¸ƒ">Prometheus Pushgateway v1.0 æ­£å¼å‘å¸ƒ&lt;/h2>
&lt;p>Prometheus Pushgateway v1.0 åœ¨æœ¬å‘¨æ­£å¼å‘å¸ƒäº†ï¼Œä½œä¸º Prometheus å·¥å…·é“¾ä¸­çš„ä¸€ç¯ï¼ŒPushgateway èƒ½å¾ˆæ–¹ä¾¿çš„ä½œä¸ºæœåŠ¡çº§åˆ«çš„ metrics cache æˆ‘åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä¹Ÿæœ‰ä½¿ç”¨å®ƒæ¥æ”¶é›†ä¸€äº› Cassandra é›†ç¾¤é¢å¤–çš„æŒ‡æ ‡ã€‚&lt;/p>
&lt;p>å¯¹äºæ­¤ç‰ˆæœ¬ï¼Œéœ€è¦ &lt;strong>æ³¨æ„å®ƒä¸å†æ”¯æŒ v0.5~v0.9 çš„å­˜å‚¨æ ¼å¼ï¼›ä»…æ”¯æŒç”± v0.10+ åˆ›å»ºçš„æŒä¹…åŒ–æ–‡ä»¶ï¼Œæ‰€ä»¥å¦‚æœæœ‰è¿™ç§éœ€æ±‚çš„è¯ï¼Œéœ€è¦å…ˆå‡çº§åˆ° v0.10 æ¥è½¬æ¢æ–‡ä»¶æ ¼å¼ã€‚&lt;/strong>&lt;/p>
&lt;p>å¯¹æ­¤ç‰ˆæœ¬æ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥å‚è€ƒ &lt;a href="https://github.com/prometheus/pushgateway/releases/tag/v1.0.0">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="helm-v2150-æ­£å¼å‘å¸ƒ">Helm v2.15.0 æ­£å¼å‘å¸ƒ&lt;/h2>
&lt;p>æœ¬å‘¨ Helm v2.15.0 æ­£å¼å‘å¸ƒï¼Œè¿™æ˜¯ &lt;strong>Helm v2 çš„æœ€åä¸€ä¸ªç‰¹æ€§ç‰ˆæœ¬&lt;/strong> ï¼Œä¹‹å Helm v2 å¼€å§‹è¿›å…¥ç»´æŠ¤æœŸï¼Œåªæ¥æ”¶ bugfix å’Œå®‰å…¨æ›´æ–°ã€‚&lt;/p>
&lt;p>æ­¤ç‰ˆæœ¬ä¸­åŒ…å«äº† 71 ä¸ªç‹¬ç«‹ committer çš„ 195 ä¸ª commit ï¼Œä¹Ÿæ˜¯è‡³ä»Šä¸ºæ­¢æœ€å¤§çš„ä¸€æ¬¡ release ã€‚(å¾ˆè£å¹¸æˆ‘æ˜¯å…¶ä¸­ä¹‹ä¸€ï¼Œè´¡çŒ®äº†ä¸¤ä¸ª commit å˜¿å˜¿~)&lt;/p>
&lt;p>è‡ª 2016 å¹´å¼€å§‹ Helm v2 è‡³ä»Šå·²ç»èµ°è¿‡äº† 3 å¹´å·¦å³çš„æ—¶é—´ï¼Œæˆªè‡³ä»Šå¤© Helm ä»“åº“æœ‰ 14.4k çš„ star å’Œ 4.7k çš„ fork ä»¥åŠ 533 ä½è´¡çŒ®è€…ã€‚éå¸¸æ„Ÿè°¢ç¤¾åŒºçš„è´¡çŒ®ï¼Œåœ¨æ­¤æœŸé—´ Helm ä¹Ÿä¸ºæˆ‘ä»¬å¸¦æ¥äº†å¾ˆå¤šçš„ä¾¿åˆ©ã€‚&lt;/p>
&lt;p>å…³äºæ­¤ç‰ˆæœ¬çš„åŠŸèƒ½æ€§ä»‹ç»ï¼Œæœ¬ç¯‡å°±å…ˆä¸è°ˆäº†ï¼Œæœ‰å…´è¶£çš„æœ‹å‹è¯·å‚è€ƒ &lt;a href="https://github.com/helm/helm/releases/tag/v2.15.0">ReleaseNote&lt;/a>&lt;/p>
&lt;p>&lt;strong>Helm 3 é¢„è®¡ä¼šåœ¨æœ¬æœˆåº•å‘å¸ƒï¼Œç°åœ¨è¿˜æ²¡æœ‰äº†è§£ Helm 3 çš„æœ‹å‹ï¼Œæ¨èçœ‹çœ‹ Helm 3 çš„æ–‡æ¡£ï¼Œä»¥ä¾¿ä¸ºä¹‹åå‡çº§åšäº›å‡†å¤‡ã€‚&lt;/strong>&lt;/p>
&lt;h2 id="ä¸ªäººæ¨è">ä¸ªäººæ¨è&lt;/h2>
&lt;p>ç°åœ¨ GitChat åœ¨æ 1024 ä¸“å±æ´»åŠ¨ï¼Œæˆ‘çš„ä¸“æ  &lt;a href="https://gitbook.cn/gitchat/column/5d70cfdc4dc213091bfca46f">ã€ŠDocker æ ¸å¿ƒçŸ¥è¯†å¿…çŸ¥å¿…ä¼šã€‹&lt;/a> &lt;a href="https://gitbook.cn/gitchat/column/5d70cfdc4dc213091bfca46f">https://gitbook.cn/gitchat/column/5d70cfdc4dc213091bfca46f&lt;/a> æ­£åœ¨å‚åŠ æ´»åŠ¨ï¼Œ &lt;strong>é™æ—¶åŠä»·&lt;/strong>ä¼˜æƒ ï¼&lt;/p>
&lt;h2 id="æ´»åŠ¨ç»“æœ">æ´»åŠ¨ç»“æœ&lt;/h2>
&lt;p>åœ¨&lt;a href="https://zhuanlan.zhihu.com/p/86502209">ä¸Šç¯‡æ–‡ç« &lt;/a>æ–‡æœ«æœ‰ä¸ªå…è´¹å¢åŠ å…‘æ¢ç çš„æ´»åŠ¨ï¼Œæˆ‘å·²ç»ç»Ÿè®¡å‡ºæ¥äº†ç»“æœï¼Œæ­å–œ &lt;strong>ç…é±¼&lt;/strong> åŒå­¦è·å¾—äº†æ­¤å…‘æ¢ç ã€‚&lt;/p>
&lt;hr>
&lt;p>å¯ä»¥é€šè¿‡ä¸‹é¢äºŒç»´ç è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘ï¼Œåœ¨å…¬ä¼—å·åå°å›å¤ k8s å¯åŠ å…¥æŠ€æœ¯åœˆäº¤æµã€‚&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| Docker 19.03.3 DNS ä¸å†åŒºåˆ†å¤§å°å†™</title><link>https://moelove.info/2019/10/13/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Docker-19.03.3-DNS-%E4%B8%8D%E5%86%8D%E5%8C%BA%E5%88%86%E5%A4%A7%E5%B0%8F%E5%86%99/</link><guid isPermaLink="true">https://moelove.info/2019/10/13/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Docker-19.03.3-DNS-%E4%B8%8D%E5%86%8D%E5%8C%BA%E5%88%86%E5%A4%A7%E5%B0%8F%E5%86%99/</guid><pubDate>Sun, 13 Oct 2019 22:42:59 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚ æ–‡æœ«æœ‰æ´»åŠ¨ï¼Œæ¬¢è¿å‚ä¸ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="docker-19033-æ­£å¼å‘å¸ƒ">Docker 19.03.3 æ­£å¼å‘å¸ƒ&lt;/h2>
&lt;p>åœ¨æœ¬å‘¨ Docker å‘å¸ƒäº† 19.03.3 ç‰ˆæœ¬ï¼Œè¿™ä¸ªç‰ˆæœ¬çš„å˜æ›´å†…å®¹ &lt;strong>å¾ˆé‡è¦&lt;/strong>ï¼Œæˆ‘ä¼šå°†ä¸»è¦å†…å®¹éƒ½åˆ—å‡ºæ¥ã€‚(ä¸Šå‘¨å‘¨æŠ¥ä»‹ç»äº† 19.03.3-rc1 çš„ä¸€äº›æƒ…å†µ)&lt;/p>
&lt;h3 id="å·²çŸ¥é—®é¢˜">å·²çŸ¥é—®é¢˜&lt;/h3>
&lt;p>&lt;strong>&lt;code>DOCKER-USER&lt;/code> iptables é“¾ä¸¢å¤±ï¼›å¦‚æœä½ å¹¶ä¸éœ€è¦åœ¨ &lt;code>DOCKER-USER&lt;/code> é“¾ä¸Šå®šä¹‰è§„åˆ™çš„è¯ï¼Œé‚£ä½ ä¹Ÿå¹¶ä¸ä¼šå—æ­¤é—®é¢˜çš„å½±å“ã€‚&lt;/strong>&lt;/p>
&lt;p>ä¸´æ—¶è§£å†³åŠæ³•ï¼šæ‰‹åŠ¨æ·»åŠ ä¸¢å¤±çš„é“¾ï¼Œæ“ä½œå¦‚ä¸‹ï¼š&lt;/p>
&lt;pre>&lt;code>iptables -N DOCKER-USER
iptables -I FORWARD -j DOCKER-USER
iptables -A DOCKER-USER -j RETURN
&lt;/code>&lt;/pre>&lt;p>&lt;strong>è¿™ä¸ªé—®é¢˜ä¼šåœ¨ 19.03.4 ä¸­è¿›è¡Œä¿®å¤, å¾ˆå¿«ä¼šè¿›è¡Œå‘å¸ƒï¼›&lt;/strong> å®é™…ä¼šæŠŠ libnetwork ä¸­æœ‰é—®é¢˜çš„é‚£æ®µä»£ç å…ˆå»æ‰ã€‚ å¦‚æœå·²ç»å‡çº§äº†æ­¤ç‰ˆæœ¬çš„ç”¨æˆ·ï¼Œå—åˆ°æ­¤é—®é¢˜å½±å“çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨ä¸Šè¿°æ–¹å¼è¿›è¡Œä¸´æ—¶è§£å†³ã€‚&lt;/p>
&lt;h3 id="å®‰å…¨é—®é¢˜">å®‰å…¨é—®é¢˜&lt;/h3>
&lt;ul>
&lt;li>å°† runc æ›´æ–°åˆ°äº† v1.0.0-rc8-92-g84373aaa è¿™å…¶ä¸­åŒ…å«äº† runc ä¸­å¯¹ &lt;a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-18367">CVE-2017-18367&lt;/a> çš„ä¿®å¤ï¼Œè¯¥æ¼æ´çš„æ ¹æœ¬åŸå› åœ¨äº &lt;code>libseccomp-golang&lt;/code> ä¸­&lt;a href="https://github.com/seccomp/libseccomp-golang/commit/06e7a29f36a34b8cf419aeb87b979ee508e58f9e">ä¸€ä¸ªé”™è¯¯çš„é€»è¾‘è¿ç®—&lt;/a> ï¼Œæœ‰å…´è¶£çš„æœ‹å‹å¯ä»¥ç‚¹å¼€é“¾æ¥çœ‹çœ‹å®é™…çš„ä¿®å¤ä»£ç ï¼Œå¹¶ä¸”ä¹Ÿå¯ä»¥å‘ç°è¯¥ä»£ç å…¶å®åœ¨ 2017 å¹´ 4 æœˆå°±å·²ç»åˆå¹¶è¿› libseccomp-golang çš„ä¸»å¹²ä¸­äº†ï¼Œä½†å®é™…ä¸Šåœ¨ä»Šå¹´ 6 æœˆåœ¨ runc ä¸­æ‰çœŸæ­£ä¿®å¤ã€‚&lt;/li>
&lt;/ul>
&lt;p>è¿™ä¸ªé—®é¢˜å…¶å®åæ˜ å‡ºæ¥çš„æ˜¯å½“æˆ‘ä»¬åœ¨ç»´æŠ¤é¡¹ç›®æ—¶ï¼Œå¯¹è‡ªå·±æ‰€ç”¨çš„å„ç§ä¾èµ–éœ€è¦æœ‰æ‰€äº†è§£å’ŒæŠŠæ¡ï¼Œæ•´ä½“æ¥è®²ï¼Œå°½å¯èƒ½é¿å…ä¾èµ–é¡¹è¿‡æ—§æ˜¯ä¸ªå¥½äº‹å„¿ï¼›å¹¶ä¸”å®‰å…¨é—®é¢˜éå¸¸å€¼å¾—å…³æ³¨ã€‚&lt;/p>
&lt;h3 id="å¸¸è§„æ›´æ–°">å¸¸è§„æ›´æ–°&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>ä¿®æ”¹äº†ä»ä½¿ç”¨ &lt;code>schema1&lt;/code> è¿›è¡Œé•œåƒ push/pull æ“ä½œæ—¶çš„é€šçŸ¥é€»è¾‘ï¼Œæ—©åœ¨ä»Šå¹´ 6 æœˆä»½æˆ‘æ¨é€çš„å‘¨æŠ¥ä¸­å°±å·²ç»æåˆ°è¿‡å»ºè®®å‡çº§è‡³ &lt;code>schema2&lt;/code> æ¥è·å¾—é•¿ä¹…çš„æ”¯æŒï¼Œä»¥åŠæ›´å¥½çš„å…¼å®¹æ€§ã€‚å…·ä½“çš„å‡çº§ç‰ˆæœ¬ä¹‹ä¸€å°±æ˜¯ä½¿ç”¨æœ€æ–°ç‰ˆçš„ Dockerï¼Œ å°†é•œåƒ pull åå†é‡æ–° push å³å¯ï¼ˆé€‚ç”¨äºå¤§å¤šæ•°æƒ…å†µï¼‰ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æ ¹æ® &lt;a href="https://tools.ietf.org/html/rfc4343">&lt;code>RFC4343&lt;/code>&lt;/a> Docker ä¿®æ”¹äº†å†…éƒ¨ DNS çš„é€»è¾‘ï¼Œä½¿å…¶ç¬¦åˆäº† RFC4343 çš„è§„èŒƒï¼Œ &lt;strong>DNS å¼€å§‹ä¸å†åŒºåˆ†å¤§å°å†™äº†&lt;/strong> ã€‚å¦‚æœåœ¨å®é™…ä½¿ç”¨ä¸­æœ‰ä¾èµ–å¤§å°å†™è§£æçš„æƒ…å†µï¼Œè¯·åŠæ—¶ä¿®æ”¹é€»è¾‘ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>å¯¹æ­¤ç‰ˆæœ¬æ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥å‚è€ƒ &lt;a href="https://github.com/docker/docker-ce/releases/tag/v19.03.3">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="helm-v300-beta4-å‘å¸ƒ">Helm v3.0.0-beta.4 å‘å¸ƒ&lt;/h2>
&lt;p>Helm 3 å·²ç»è¿›å…¥å‘å¸ƒäº† beta4 çš„ç‰ˆæœ¬ï¼Œç°åœ¨è®¡åˆ’ä¸‹ä¸ªç‰ˆæœ¬æ˜¯ beta5ï¼Œä»ç„¶å°†ç»§ç»­ä¿®å¤ bug å’Œæå‡ç¨³å®šæ€§ã€‚&lt;/p>
&lt;p>è¿™é‡Œä¹Ÿæœ‰ä¸€ä¸ªå®‰å…¨é—®é¢˜ï¼š ä¿®å¤äº† &lt;a href="https://helm.sh/blog/helm-security-notice-2019/">CVE-2019-1000008&lt;/a> è¿™ä¸ªé—®é¢˜ä¸€å¼€å§‹æ˜¯ä¸º Helm 2 è€ŒæŠ¥å‘Šçš„ï¼Œä½†å®é™…ä¸Šåœ¨ Helm 3 ä¸­ä¹Ÿå­˜åœ¨ï¼Œæ‰€ä»¥æ­¤æ¬¡ beta4 ä¸­åŒ…å«äº†ä¿®å¤ä»£ç , å»ºè®®å‡çº§ã€‚&lt;/p>
&lt;p>è¿™æ¬¡çš„ break change å°± 4 ä¸ªï¼Œå¯¹äºå¤„äº beta æœŸçš„ Helm 3 ä¹Ÿè¿˜å¯ä»¥ç†è§£ã€‚&lt;/p>
&lt;p>ä»¥ä¸‹æ˜¯ä¸€äº›å€¼å¾—æ³¨æ„çš„ç‚¹ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;code>--recreate-pods&lt;/code> å‚æ•°è¢«åºŸå¼ƒï¼›&lt;/li>
&lt;li>&lt;code>app version&lt;/code> å­—æ®µè¢«æ·»åŠ åˆ°äº† &lt;code>helm list&lt;/code> å’Œ &lt;code>helm history&lt;/code> ä¸­ï¼›&lt;/li>
&lt;/ul>
&lt;p>å¯¹æ­¤ç‰ˆæœ¬æ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥å‚è€ƒ &lt;a href="https://github.com/helm/helm/releases/tag/v3.0.0-beta.4">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="ä¸Šæ¸¸è¿›å±•">ä¸Šæ¸¸è¿›å±•&lt;/h2>
&lt;ul>
&lt;li>
&lt;p>K8S æ–‡æ¡£å·¥ä½œç»„å°†ä¼šå¯¹ K8S æ–‡æ¡£ä¸­å¼•ç”¨çš„ç¬¬ä¸‰æ–¹å†…å®¹è¿›è¡Œæ¸…ç†å’Œç»„ç»‡ï¼Œä»¥é¿å…æ–‡æ¡£ä¸­å‡ºç°è¿‡å¤šçš„ â€œä½¿ç”¨ xx å·¥å…·éƒ¨ç½² Kubernetesâ€ ä¹‹ç±»çš„å†…å®¹ã€‚ï¼ˆæ¯”å¦‚â€œä½¿ç”¨ Kind æ¥éƒ¨ç½² Kubernetes æœ¬åœ°é›†ç¾¤â€ å°±æ˜¯å…è®¸å­˜åœ¨çš„å†…å®¹ï¼‰ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>åŒæ ·çš„ä¸ºäº†ä¿®å¤å®‰å…¨æ¼æ´ CVE-2019-11253 ï¼Œç°åœ¨é™åˆ¶ YAML/JSON çš„è§£ç å¤§å°ä¸º 3M ï¼Œ &lt;a href="https://github.com/kubernetes/kubernetes/pull/83261">#83261&lt;/a>&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="æ´»åŠ¨">æ´»åŠ¨&lt;/h2>
&lt;p>æœ¬å‘¨æˆ‘åœ¨ GitChat ä¸Šçš„æ–°ä¸“æ  &lt;a href="https://gitbook.cn/gitchat/column/5d70cfdc4dc213091bfca46f">Docker æ ¸å¿ƒçŸ¥è¯†å¿…çŸ¥å¿…ä¼š&lt;/a> &lt;a href="https://gitbook.cn/gitchat/column/5d70cfdc4dc213091bfca46f">https://gitbook.cn/gitchat/column/5d70cfdc4dc213091bfca46f&lt;/a> æ­£å¼ä¸Šçº¿äº†ï¼ ï¼ˆæˆ‘ä¹Ÿæ¥å®£ä¼ ä¸€æ³¢~ æ„Ÿè°¢å¤§å®¶æ”¯æŒ~&lt;/p>
&lt;p>è¿™ä¸ªä¸“æ æ¶µç›–äº† Docker çš„æ ¸å¿ƒçŸ¥è¯†ï¼Œä½†æ˜¯åˆä¸ä»…ä»…æ˜¯ Dockerï¼›æˆ‘è®¤ä¸ºæƒ³è¦çœŸæ­£æŒæ¡ Docker å®¹å™¨çŸ¥è¯†ï¼Œå¿…é¡»é€šè¿‡ç³»ç»Ÿæ€§çš„å­¦ä¹ ï¼Œå¾ˆå¤šä¸œè¥¿å…¶å®ä¾èµ–äºå†…æ ¸å®ç°çš„åŠŸèƒ½ï¼Œå¦‚æœä¸èƒ½å¾ˆå¥½çš„ç†è§£è¿™äº›åŸºç¡€åŠŸèƒ½ï¼Œé‚£ä»¥ååœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ Docker å®¹å™¨æŠ€æœ¯å°±ä¼šæ¯”è¾ƒåƒåŠ›äº†ã€‚&lt;/p>
&lt;p>ç°åœ¨å¤šæ•°å…¬å¸æ­£åœ¨å¾€å®¹å™¨åŒ–å’Œ Kubernetes çš„ç¯å¢ƒä¸Šè¿ç§»ï¼Œå¦‚æœèƒ½å¾ˆå¥½çš„æŒæ¡ Docker å®¹å™¨æŠ€æœ¯ï¼Œé‚£æ— è®ºæ˜¯åœ¨åšå®¹å™¨åŒ–ï¼Œè¿˜æ˜¯åœ¨ä½¿ç”¨æˆ–è€…å®šä½ k8s çš„é—®é¢˜æ—¶ï¼Œéƒ½ä¼šæ¸¸åˆƒæœ‰ä½™ã€‚&lt;/p>
&lt;p>ç°åœ¨æˆ‘å°†è¿™ä¸ªä¸“æ æ¨èç»™ä½ ï¼Œä¸‡ä¸ˆé«˜æ¥¼å¹³åœ°èµ·ï¼Œå¸Œæœ›èƒ½æœ‰æ‰€å¸®åŠ©ã€‚ï¼ˆæ‰«æä¸‹æ–¹äºŒç»´ç æˆ–è€…ä½¿ç”¨é“¾æ¥ &lt;a href="https://gitbook.cn/gitchat/column/5d70cfdc4dc213091bfca46f">https://gitbook.cn/gitchat/column/5d70cfdc4dc213091bfca46f&lt;/a> çš†å¯è®¿é—®ï¼‰&lt;/p>
&lt;p>&lt;img src="https://moelove.info/img/docker-course.jpg" alt="Docker æ ¸å¿ƒçŸ¥è¯†å¿…çŸ¥å¿…ä¼š">&lt;/p>
&lt;p>&lt;strong>å¦å¤–ï¼Œä¸ºäº†æ„Ÿè°¢å¤§å®¶çš„å…³æ³¨å’Œæ”¯æŒï¼Œå³æ—¥èµ·è‡³ 10 æœˆ 19 æ—¥æ™š 21 ç‚¹æ•´ï¼Œåœ¨æœ¬æ–‡ä¸‹æ–¹ç•™è¨€ï¼Œå¾—åˆ°ç‚¹èµæœ€å¤šçš„æœ‹å‹ï¼Œæˆ‘ä¼šé€å‡ºä¸€ä¸ªå…è´¹çš„å…‘æ¢ç ï¼Œç”¨äºå…‘æ¢æ­¤ä¸“æ ã€‚æ¬¢è¿å‚ä¸ã€‚&lt;/strong>&lt;/p>
&lt;p>ï¼ˆæˆ‘ä¼šåœ¨ä¸‹å‘¨å‘¨æŠ¥æ—¶ï¼Œå…¬å¸ƒç»“æœã€‚æ‰€æœ‰æ¸ é“å…±åŒå‚ä¸æ­¤æ´»åŠ¨ã€‚ï¼‰&lt;/p>
&lt;hr>
&lt;p>å¯ä»¥é€šè¿‡ä¸‹é¢äºŒç»´ç è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘ï¼Œåœ¨å…¬ä¼—å·åå°å›å¤ k8s å¯åŠ å…¥æŠ€æœ¯åœˆäº¤æµã€‚&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>Docker æ ¸å¿ƒçŸ¥è¯†å¿…çŸ¥å¿…ä¼š</title><link>https://moelove.info/2019/10/08/Docker-%E6%A0%B8%E5%BF%83%E7%9F%A5%E8%AF%86%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A/</link><guid isPermaLink="true">https://moelove.info/2019/10/08/Docker-%E6%A0%B8%E5%BF%83%E7%9F%A5%E8%AF%86%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A/</guid><pubDate>Tue, 08 Oct 2019 23:58:14 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;p>è‡ª 2013 å¹´èµ·ï¼Œéšç€ Docker çš„æ­£å¼é¢ä¸–ï¼Œå®¹å™¨æŠ€æœ¯è¿…é€Ÿæˆä¸ºäº†åŸºç¡€æŠ€æœ¯é¢†åŸŸä¸­çš„çƒ­é—¨ã€‚è€Œåœ¨è¿‘ä¸¤ä¸‰å¹´ä¸­ï¼Œéšç€å®¹å™¨ç¼–æ’é¢†åŸŸçš„æ··æˆ˜ç»“æŸï¼ŒKubernetes å·²ç»æˆä¸ºäº†å®¹å™¨ç¼–æ’é¢†åŸŸäº‹å®ä¸Šçš„æ ‡å‡†ã€‚&lt;/p>
&lt;p>æœ‰ä¸€äº›äººå­˜åœ¨è¯¯è§£ï¼Œè®¤ä¸º Kubernetes çš„å‡ºç°å–ä»£äº† Dockerã€‚ä½†äº‹å®ä¸Šï¼ŒDocker ä¸ Kubernetes æ˜¯ç›¸è¾…ç›¸æˆçš„ã€‚Kubernetes ä½¿ç”¨ Docker ä½œä¸ºå®¹å™¨è¿è¡Œæ—¶ï¼Œç”¨æ¥å¯åŠ¨åº”ç”¨ï¼›å½“ Docker å®¹å™¨è§„æ¨¡å˜å¤§æ—¶ï¼Œè‡ªç„¶æ˜¯éœ€è¦æœ‰å®¹å™¨ç¼–æ’å·¥å…·è¿›è¡Œç®¡ç†çš„ã€‚å¼•ç”¨æœ€è¿‘ä¸€æ¬¡çš„ç½‘ç»œç ”è®¨ä¼šåçš„æ–‡ç« å†…å®¹ï¼š&lt;/p>
&lt;blockquote>
&lt;p>In fact, Kubernetes is better with Docker. And Docker is better with Kubernetes.&lt;/p>
&lt;/blockquote>
&lt;p>æ— è®ºåœ¨ä½¿ç”¨ Docker æˆ–æ˜¯ Kubernetes äº¦æˆ–è€…æ˜¯ä½¿ç”¨åŸºäºè¿™äº›æŠ€æœ¯çš„å…¶ä»–è¡ç”ŸæŠ€æœ¯æ—¶ï¼Œéƒ½æœ‰å¯èƒ½ä¼šé‡åˆ°ä¸€äº›æ„æ–™ä¹‹å¤–çš„æƒ…å†µï¼Œå½“é—®é¢˜å‘ç”Ÿæ—¶ï¼Œæˆ‘ä»¬æ€»æ˜¯å¸Œæœ›å¯ä»¥å¿«é€Ÿå®šä½é—®é¢˜ï¼Œå¹¶ä¸”ä»æ ¹æœ¬ä¸Šè§£å†³é—®é¢˜ã€‚&lt;/p>
&lt;p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸Šå±‚çš„é—®é¢˜æ¯”è¾ƒå®¹æ˜“è§£å†³ï¼Œä½†å¦‚æœé—®é¢˜å‘ç”Ÿåœ¨è¿è¡Œæ—¶/Docker æˆ–å®¹å™¨ä¸Šæ—¶ï¼Œå¦‚æœæ²¡æœ‰ç³»ç»Ÿæ€§çš„çŸ¥è¯†ï¼Œå¾ˆéš¾ä»æ ¹æœ¬ä¸Šè§£å†³é—®é¢˜ï¼›å½“ç„¶ï¼Œæœ‰äº›æ—¶å€™é€šè¿‡æœç´¢å¼•æ“å¯ä»¥å¸®æˆ‘ä»¬æ‰¾åˆ°ä¸€äº›é—®é¢˜çš„è§£å†³åŠæ³•ï¼Œä½†å¦‚æœä¸å°†å…¶å½»åº•ææ‡‚ï¼Œä»¥åé‡åˆ°ç±»ä¼¼é—®é¢˜å¯èƒ½è¿˜æ˜¯æ²¡æ³•å¿«é€Ÿè§£å†³ã€‚&lt;/p>
&lt;p>æˆ‘è‡ª Docker 0.9 ç‰ˆæœ¬æ—¶å¼€å§‹å­¦ä¹ å’Œä½¿ç”¨ï¼Œè‡ªå·±è¸©è¿‡äº†å¾ˆå¤šå‘ï¼Œæ´»è·ƒåœ¨ç¤¾åŒºä¸­ï¼Œä¹Ÿå¸®åˆ«äººè§£å†³äº†å¾ˆå¤šé—®é¢˜ã€‚ç°åœ¨æˆ‘çš„æ–°ä¸“æ &lt;a href="https://gitbook.cn/gitchat/column/5d70cfdc4dc213091bfca46f">ã€ŠDocker æ ¸å¿ƒçŸ¥è¯†å¿…çŸ¥å¿…ä¼šã€‹&lt;/a>æ­£å¼ä¸Šçº¿äº†ï¼Œå…± 51 èŠ‚ï¼Œä» 7 ä¸ªæ ¸å¿ƒç»´åº¦æ¥ &lt;strong>ç³»ç»Ÿæ€§&lt;/strong> çš„è®²è§£ Docker å®¹å™¨æŠ€æœ¯çš„æ ¸å¿ƒç‰¹æ€§åŠåŸç†ï¼Œå®è·µä¸æºç ç›¸ç»“åˆï¼›éƒ¨åˆ†å†…å®¹ä¼šæ·±å…¥åˆ° Linux å†…æ ¸æºç ï¼Œä»¥æ­¤æ¥å»ºç«‹èµ·ä»å†…æ ¸åˆ° Docker å®¹å™¨æŠ€æœ¯çš„çŸ¥è¯†ä½“ç³»ã€‚&lt;/p>
&lt;p>æˆ‘å¸Œæœ›å€Ÿç”±è¿™ä¸ªè¯¾ç¨‹ï¼Œ&lt;strong>å°† Docker å®¹å™¨æŠ€æœ¯çš„æœ¬è´¨å’Œæ€æƒ³ä¸æˆ‘åœ¨å¼€å‘å’Œè¿ç»´ Docker è¿‡ç¨‹ä¸­å¯¹å…¶åŸç†å’Œå®è·µç»éªŒçš„æ€»ç»“è®²æ¸…æ¥šï¼Œå¹¶å°†ç»“åˆç€å®è·µå’Œæ ¸å¿ƒç‰¹æ€§çš„åŸç†ï¼ŒåŠ æ·±å¯¹ Docker å®¹å™¨æŠ€æœ¯çš„ç†è§£&lt;/strong>ã€‚&lt;/p>
&lt;p>å› æ­¤ï¼Œæˆ‘æŠŠè¯¾ç¨‹åˆ’åˆ†æˆäº†ä¸‰å¤§æ¨¡å—ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;strong>Docker å…¥é—¨&lt;/strong>: è¿™ä¸ªæ¨¡å—åˆ†æˆäº†ä¸‰ç¯‡å†…å®¹ï¼Œé€šè¿‡ç¬¬ä¸€ç¯‡ï¼Œå¸¦ä½ äº†è§£ Docker å®¹å™¨æŠ€æœ¯ç”Ÿæ€çš„å‘å±•è„‰ç»œï¼›ç¬¬äºŒç¯‡ï¼Œæ˜¯ä¸ºåˆšå…¥é—¨ Docker çš„è¯»è€…å‡†å¤‡çš„ï¼Œä¹Ÿæ˜¯ä¸ºåç»­ç« èŠ‚è¿›è¡Œé“ºå«ï¼›ç¬¬ä¸‰ç¯‡æ˜¯å¾ˆå¤šè¯»è€…æˆ–å…¬å¸éƒ½å¸¸ä¼šå›°æƒ‘çš„é—®é¢˜ï¼ŒDocker ä¸ Linux å†…æ ¸å…¼å®¹æ€§å¦‚ä½•ï¼Œè¦ä¸Šç”Ÿäº§ç¯å¢ƒè¯¥é€‰æ‹©å“ªä¸ªç‰ˆæœ¬ï¼Ÿæˆ‘ä¼šåœ¨è¿™ä¸€ç¯‡ä¸­ä¸ä½ åˆ†äº«ï¼Œè®©ä½ ä¸å†å›°æƒ‘ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>Docker æ ¸å¿ƒç‰¹æ€§&lt;/strong>ï¼šè¿™ä¸ªå¤§æ¨¡å—å›´ç»• Docker çš„æ ¸å¿ƒçŸ¥è¯†ç‚¹ï¼Œæ‹†åˆ†æˆäº† 7 å¤§éƒ¨åˆ†ï¼Œåˆ†åˆ«æ˜¯å®¹å™¨ã€é•œåƒã€CI/CDã€æ¶æ„ã€å­˜å‚¨ã€å®‰å…¨å’Œç½‘ç»œã€‚è¿™äº›æ˜¯è¯¥è¯¾ç¨‹çš„æ ¸å¿ƒå†…å®¹ï¼Œåœ¨è¿™éƒ¨åˆ†å†…å®¹ä¸­ï¼Œæˆ‘å°†åŸºæœ¬æŒ‰ç…§ä»å®è·µåˆ°åŸç†çš„æ–¹å¼è¿›è¡Œç»„ç»‡ï¼Œè®©ä½ ä»æ ¹å„¿ä¸ŠçŸ¥é“å¦‚ä½•ç”¨ï¼Œä»¥åŠä¸ºä»€ä¹ˆè¿™ä¹ˆç”¨ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>åœ¨å®¹å™¨ç¯‡ï¼Œæˆ‘ä¼šå…ˆç»™ä½ ä»‹ç»å®¹å™¨ç”Ÿå‘½å‘¨æœŸç®¡ç†ç›¸å…³çš„å†…å®¹ï¼Œé‚£ä½ å¯¹å®¹å™¨çš„ä½¿ç”¨æœ‰ä¸ªåŸºæœ¬è®¤è¯†ï¼›ä¹‹åä¼šå¯¹å®¹å™¨èµ„æºè¿›è¡Œç®¡ç†ï¼›å¹¶å¯¹å®¹å™¨çš„æ ¸å¿ƒè¿›è¡Œæ·±å…¥å‰–æï¼›æœ€ååŠ¨æ‰‹æ¥è‡ªå·±å†™å®¹å™¨ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>åœ¨é•œåƒç¯‡ï¼Œæˆ‘ä¼šç»™ä½ ä»‹ç»é•œåƒå®Œæ•´çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼›é•œåƒæ˜¯å¦‚ä½•æ„å»ºä¸åˆ†å‘çš„ï¼›å¦‚ä½•ä½¿ç”¨ Dockerfile è¿›è¡Œé•œåƒæ„å»ºï¼›å¹¶ä»‹ç» Docker çš„ä¸‹ä¸€ä»£æ„å»ºç³»ç»Ÿæ˜¯å¦‚ä½•æé€Ÿè¿‘ 10 å€çš„ï¼›æ¥ä¸‹æ¥ç»“åˆæˆ‘çš„å®é™…é•œåƒä¸ºä½ ä»‹ç» Dockerfile çš„ä¼˜åŒ–å’Œæœ€ä½³å®è·µï¼›æœ€ååˆ†åˆ«æ·±å…¥æºç ä¸ºä½ ä»‹ç»é•œåƒæ„å»ºã€åˆ†å‘çš„åŸç†ï¼Œä»¥åŠè®¤è¯æµç¨‹å’ŒåŸç†ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>åœ¨ CI/CD ç¯‡ï¼Œæˆ‘ä¼šä¸ºä½ ä»‹ç»å¦‚ä½•å°† Docker ä¸ CI/CD ç»“åˆï¼Œå¹¶ä¸ºä½ ä»‹ç»é€‚ç”¨äºç”Ÿäº§ç¯å¢ƒä½¿ç”¨çš„ CI/CD pipeline,å¸Œæœ›èƒ½ä¸ºä½ å»ºè®¾ CI/CD æä¾›ä¸€äº›å¯å‘ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æ¶æ„ç¯‡ä¸­æˆ‘ä¼šç»“åˆæºç ç»™ä½ ä»‹ç» Docker çš„æ ¸å¿ƒæ¶æ„ï¼Œä»¥åŠå…¶æ˜¯å¦‚ä½•åä½œçš„ï¼›Docker æä¾›äº†ä¸€ç§å¯æ‰©å±•çš„ Plugin æœºåˆ¶ï¼Œåœ¨ç‰¹å®šåœºæ™¯ä¸‹ä½¿ç”¨ Plugin æ‰©å±• Docker ä¹Ÿæ˜¯ä¸€ç§ä¸é”™çš„é€‰æ‹©ï¼›æ¥ä¸‹æ¥ä¼šç»“åˆå®é™…ç»éªŒä¸ºä½ ä»‹ç»å®¹å™¨ç›‘æ§å’Œæ—¥å¿—æ–¹é¢çš„å…·ä½“å®è·µæ–¹æ¡ˆï¼Œå¸Œæœ›èƒ½ä¸ºä½ åœ¨å®é™…ä½¿ç”¨ä¸­æä¾›ä¸€ä¸ªå‚è€ƒï¼›æœ€åä¼š &lt;strong>ä¸ä½ åˆ†äº«æˆ‘æ‰€æ€»ç»“çš„ Docker ç›¸å…³é—®é¢˜çš„å®šä½åŠè°ƒè¯•æ‰‹æ®µ&lt;/strong> æ­£ç¡®çš„æ–¹æ³•èƒ½è®©ä½ æ’æŸ¥é—®é¢˜çš„æ•ˆç‡ç¿»å€ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å­˜å‚¨ç¯‡ä¸»è¦ä»‹ç» Docker ä¸­ volume çš„ä½¿ç”¨ï¼›ä»¥åŠå¦‚ä½•è¿›è¡Œæ•°æ®å¤‡ä»½å’Œæ¢å¤ï¼›æœ€åä¼šæ·±å…¥å†…éƒ¨ä¸ºä½ ä»‹ç»ç°åœ¨ Docker æœ€æ¨èçš„ Overlay2 å­˜å‚¨é©±åŠ¨çš„å·¥ä½œåŸç†ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å®‰å…¨ç¯‡ä¼šæ¶‰åŠé•œåƒå’Œå®¹å™¨è¿è¡Œæ—¶çš„å®‰å…¨ï¼›ä»¥åŠä¼šæ¶‰åŠä¸€äº›çš„ Linux å†…æ ¸å®‰å…¨ç›¸å…³çš„çŸ¥è¯†ï¼Œä¸ºä½ è¯¦ç»†ä»‹ç»å¦‚ä½•åˆ©ç”¨ Linux å†…æ ¸çš„å®‰å…¨æ¨¡å—ä¸º Docker ä¿é©¾æŠ¤èˆªã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ç½‘ç»œç¯‡é™¤äº†ä»‹ç»åŸºç¡€ç½‘ç»œçŸ¥è¯†å¤–ï¼Œè¿˜ä¼šä¸ºä½ ä»‹ç»å¦‚ä½•å®šåˆ¶ bridge ç½‘ç»œï¼›iptables å§‹ç»ˆæ˜¯ä¸€ä¸ªå¾ˆæ ¸å¿ƒçš„çŸ¥è¯†ç‚¹ï¼Œæˆ‘ä¼šä¸ºä½ å°† Docker ä¸ iptables æ¢³ç†æ¸…æ¥šï¼Œä»¥åŠå¦‚ä½•è‡ªå®šä¹‰çš„è¿›è¡Œç½‘ç»œç®¡ç†ï¼›æœ€åä¼šä¸ºä½ è¯¦ç»†ä»‹ç» docker-proxy ï¼ŒDocker å†…éƒ¨ DNS ä»¥åŠ Docker çš„æ ¸å¿ƒç½‘ç»œçŸ¥è¯†ï¼Œè®©ç½‘ç»œä¸å†æˆä¸ºä¸€ä¸ªæ‹¦è·¯è™ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>ç”Ÿæ€æ‰©å±•&lt;/strong>ï¼šä¸å¾—ä¸è¯´â€œå¼€æºâ€æ˜¯ Docker æˆé•¿è¿…é€Ÿçš„å…³é”®ï¼Œåœ¨è¿™ä¸ªæ¨¡å—ä¸­ï¼Œæˆ‘å°†ä¸ºä½ ä»‹ç» Docker ä¸ Kubernetes é—´çš„è”ç³»ï¼Œä»¥åŠå®¹å™¨ç”Ÿæ€ä¸­çš„å…¶ä»–ç»„ä»¶ï¼›ä¸ä½ åˆ†äº«å¦‚ä½•å‚ä¸åˆ° Docker å®¹å™¨ç”Ÿæ€å†…ï¼Œå½“ç„¶è¿™é‡Œä¹Ÿä¼šæ¶‰åŠåˆ° Docker ç°åœ¨çš„ä»£ç ç»„ç»‡ç›¸å…³çš„å†…å®¹ï¼›æœ€åå°†ä¸ä½ æ¢è®¨ Docker ç”Ÿæ€æœªæ¥çš„èµ°å‘ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>ä¸“æ æ–°ä¸Šçº¿ï¼Œé™æ—¶ä¼˜æƒ ï¼å¯ç›´æ¥è®¿é—®é“¾æ¥ &lt;a href="https://gitbook.cn/gitchat/column/5d70cfdc4dc213091bfca46f">https://gitbook.cn/gitchat/column/5d70cfdc4dc213091bfca46f&lt;/a> å‚ä¸å­¦ä¹ ï¼Œæˆ–æ‰«æä¸‹æ–¹å›¾ç‰‡äºŒç»´ç å‚ä¸ï¼š&lt;/p>
&lt;p>&lt;img src="https://moelove.info/img/docker-course.jpg" alt="Docker æ ¸å¿ƒçŸ¥è¯†å¿…çŸ¥å¿…ä¼š">&lt;/p>
&lt;p>PSï¼šå¯ä»¥ç”Ÿæˆè‡ªå·±çš„åˆ†äº«æµ·æŠ¥ï¼Œå¾— 24.75&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Docker/">Docker</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| runc v1.0.0-rc9 å‘å¸ƒ</title><link>https://moelove.info/2019/10/06/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-runc-v1.0.0-rc9-%E5%8F%91%E5%B8%83/</link><guid isPermaLink="true">https://moelove.info/2019/10/06/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-runc-v1.0.0-rc9-%E5%8F%91%E5%B8%83/</guid><pubDate>Sun, 06 Oct 2019 23:07:49 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="runc-v100-rc9-å‘å¸ƒ">runc v1.0.0-rc9 å‘å¸ƒ&lt;/h2>
&lt;p>ä¸çŸ¥ä¸è§‰ï¼Œrunc v1.0.0-rc9 äºè¿‘æ—¥å‘å¸ƒäº†ã€‚æ—©å…ˆå…³æ³¨è¿‡æˆ‘æ–‡ç« çš„æœ‹å‹ä»¬åº”è¯¥çœ‹åˆ°è¿‡æˆ‘ä»å»å¹´å¼€å§‹æ¯æ¬¡åœ¨ runc æ–°ç‰ˆæœ¬å‘å¸ƒæ—¶éƒ½æœ‰ä¸“é—¨å†™ä¸€ç¯‡æ–‡ç« è¿›è¡Œä»‹ç»ã€‚è¿™æ¬¡ç‰ˆæœ¬çš„å®šä½ä¸»è¦æ˜¯ä¿®å¤ CVE-2019-16884 æ‰€ä»¥æˆ‘ä¹Ÿå°±ä¸å†å•ç‹¬å†™æ–‡ç« ä»‹ç»äº†ï¼ˆå¦ä¸€ä¸ªåŸå› æ˜¯ç°åœ¨åœ¨å‡æœŸï¼Œè¿˜æ˜¯å¤šæŠ½ç©ºé™ªé™ªå®¶äººï¼‰&lt;/p>
&lt;p>å…ˆå¯¹ &lt;a href="https://access.redhat.com/security/cve/cve-2019-16884">CVE-2019-16884&lt;/a> åšä¸ªç®€å•çš„ä»‹ç»ã€‚è¿™æ˜¯ä¸€ä¸ªä¸­ç­‰çº§åˆ«çš„æ¼æ´ï¼Œå…¶ä¸»è¦å½±å“æ˜¯ runc æºç ä¸­çš„ &lt;code>libcontainer/rootfs_linux.go&lt;/code> åœ¨æ–‡ä»¶æŒ‚è½½è‡³ &lt;code>/proc&lt;/code> æ—¶ï¼Œå°‘åšäº†ä¸€äº›æ£€æŸ¥ï¼Œå¯ç»•è¿‡ AppArmor çš„é™åˆ¶ï¼Œæ‰€ä»¥å¯èƒ½å¯¼è‡´è¢«ä¸€äº›æ¶æ„é•œåƒæ‰€åˆ©ç”¨ã€‚&lt;/p>
&lt;p>ä¸»è¦çš„ä¿®å¤æ–¹å¼æ˜¯å°†åŸå…ˆçš„ &lt;code>checkMountDestination&lt;/code> å‡½æ•°æ”¹å†™ä¸º &lt;code>checkProcMount&lt;/code>ï¼Œå¹¶åœ¨å…¶ä¸­æ·»åŠ äº†å¯¹æºæ–‡ä»¶ç±»å‹çš„åˆ¤æ–­ï¼Œåªå…è®¸ procfs ç±»å‹çš„æ–‡ä»¶æŒ‚è½½è‡³ &lt;code>/proc&lt;/code> ã€‚&lt;/p>
&lt;p>æ­¤æ¼æ´å½±å“åˆ°çš„èŒƒå›´æ˜¯ runc ä»¥åŠä¸€äº›ä½¿ç”¨ runc ä½œä¸ºåŸºç¡€ç»„ä»¶çš„å®¹å™¨ç®¡ç†è½¯ä»¶ã€‚è¯·å°½å¿«è¿›è¡Œå‡çº§ã€‚&lt;/p>
&lt;p>æ­¤ç‰ˆæœ¬çš„åœ°å€æ˜¯ï¼šhttps://github.com/opencontainers/runc/releases/tag/v1.0.0-rc9&lt;/p>
&lt;h2 id="docker-v19033-rc1-å‘å¸ƒ">Docker v19.03.3-rc1 å‘å¸ƒ&lt;/h2>
&lt;p>è‡ªä» Docker ä¿®æ”¹ç»´æŠ¤å‘¨æœŸåï¼ŒDocker å¯¹è½¯ä»¶çš„è´¨é‡è¦æ±‚æœ‰äº†æ˜¾è‘—æé«˜ï¼Œæ¯æ¬¡ç‰ˆæœ¬å‘å¸ƒå‰ä¼šç»å†å¤šé˜¶æ®µçš„æµ‹è¯•å’Œå›å½’ï¼Œç¡®ä¿è½¯ä»¶æ²¡æœ‰ä»€ä¹ˆé—®é¢˜åæ‰ä¼šå‘å¸ƒæ­£å¼ç‰ˆã€‚&lt;/p>
&lt;p>æŒ‰ç°åœ¨çš„è¿›åº¦æ¥çœ‹ v19.03.3 åº”è¯¥ä¼šåœ¨ä¸€ä¸¤å‘¨å†…æ”¾å‡ºã€‚æ–°ç‰ˆæœ¬ä¼šå°† containerd å‡çº§è‡³æœ€æ–°çš„ 1.2.10 ï¼Œå¹¶ä¿®å¤äº†ä¸€ä¸ªåœ¨ 5.2 ç‰ˆæœ¬å†…æ ¸ä¸Š overlay2 æ–‡ä»¶ç³»ç»ŸæŒ‚è½½æ—¶çš„é”™è¯¯ã€‚&lt;/p>
&lt;p>å…³äºæ­¤ç‰ˆæœ¬æ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥å‚è€ƒ &lt;a href="https://github.com/docker/docker-ce/releases/tag/v19.03.3-rc1">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="ä¸Šæ¸¸è¿›å±•">ä¸Šæ¸¸è¿›å±•&lt;/h2>
&lt;p>Kubernetes v1.17 å·²ç»è¿›å…¥å‘å¸ƒå‘¨æœŸï¼Œè¿™ä¸ªç‰ˆæœ¬çš„å‘å¸ƒå‘¨æœŸä¼šæ¯”è¾ƒçŸ­ï¼Œç°åœ¨å·²ç»å‘å¸ƒäº† v1.17.0-alpha ç‰ˆæœ¬ï¼Œè®¡åˆ’æ˜¯åœ¨ 12 æœˆ 9 æ—¥å¯ä»¥æœ€ç»ˆå‘å¸ƒã€‚(æƒ³æƒ³çœ‹ï¼Œè·ç°åœ¨ä¹Ÿå°±ä¸¤ä¸ªæœˆçš„æ—¶é—´ï¼Œä½ çš„é›†ç¾¤ç°åœ¨æ˜¯å“ªä¸ªç‰ˆæœ¬å‘¢ï¼Ÿ)&lt;/p>
&lt;p>å¦å¤–ï¼Œåœ¨è¿‘æœŸå°†ä¼šå‘å¸ƒ v1.13.12 ç‰ˆæœ¬ï¼Œè¿™å°†æ˜¯ v1.13 åˆ†æ”¯çš„æœ€åä¸€ä¸ªç‰ˆæœ¬ï¼Œå¦‚æœè¿˜æ˜¯ä½¿ç”¨æ­¤ç‰ˆæœ¬çš„æœ‹å‹ï¼Œè¯·å°½å¿«è¿›è¡Œå‡çº§äº†ã€‚ï¼ˆå½“ç„¶ï¼Œä¸å®ƒåŒæ—¶å‘å¸ƒçš„ä¹Ÿè¿˜æœ‰ 1.16.2ï¼Œ1.15.5 å’Œ 1.14.8 å¦‚æœè¦å‡çº§å¯ä»¥ç­‰è¿™å‡ ä¸ªç‰ˆæœ¬å‘å¸ƒåå†è¿›è¡Œå‡çº§ï¼Œå…å¾—è¿˜å¾—é‡å¤å‡çº§ï¼‰&lt;/p>
&lt;p>k8s.io/klog å‡çº§åˆ°äº† v1.0 &lt;a href="https://github.com/kubernetes/kubernetes/pull/83014">#83014&lt;/a>&lt;/p>
&lt;p>å¦å¤–ä¸€ä¸ªæœ‰è¶£çš„äº‹æƒ…æ˜¯ Kubernetes v1.17 ç°åœ¨æŠŠ golang ç‰ˆæœ¬æ›´æ–°åˆ°äº† 1.12.10 ï¼Œä¸å‡ºæ„å¤–çš„è¯ï¼Œ v1.17 å°†ä¼šä¸€ç›´ä½¿ç”¨ go 1.12.x ç‰ˆæœ¬ï¼Œç›´åˆ°ä¸‹ä¸ªç‰ˆæœ¬æ‰å¯èƒ½ä¼šå‡çº§è‡³ go 1.13.x (è¿™é‡Œæœ€ä¸»è¦çš„åŸå› æ˜¯åœ¨ go 1.13.0 å‘å¸ƒåï¼Œç»è¿‡å¤§é‡å›å½’æµ‹è¯•åå‘ç°ï¼Œ Kubernetes åœ¨ go 1.13.0 ä¸Šçš„è¡¨ç°ä¸å¦‚ go 1.12.x è€Œä¾æ® golang çš„ç»´æŠ¤å‘¨æœŸï¼Œä»¥åŠ kubernetes çš„ç»´æŠ¤å‘¨æœŸæ¥çœ‹çš„è¯ï¼Œä½¿ç”¨ go 1.12.x çœ‹èµ·æ¥æ²¡ä»€ä¹ˆé£é™©ï¼Œæ‰€ä»¥å¯èƒ½å°±ä¼šä¸€ç›´ä¿æŒè¿™ä¸ªå†³å®šå§ã€‚&lt;/p>
&lt;h2 id="é¢˜å¤–è¯">é¢˜å¤–è¯&lt;/h2>
&lt;p>å‡æœŸé©¬ä¸Šå°±è¦ç»“æŸäº†ï¼Œå¤§å®¶ä¼‘æ¯çš„æ€ä¹ˆæ ·å‘¢ï¼Ÿ&lt;/p>
&lt;hr>
&lt;p>å¯ä»¥é€šè¿‡ä¸‹é¢äºŒç»´ç è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘ï¼Œåœ¨å…¬ä¼—å·åå°å›å¤ k8s å¯åŠ å…¥æŠ€æœ¯åœˆäº¤æµã€‚&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| containerd v1.3 æ­£å¼å‘å¸ƒ</title><link>https://moelove.info/2019/09/29/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-containerd-v1.3-%E6%AD%A3%E5%BC%8F%E5%8F%91%E5%B8%83/</link><guid isPermaLink="true">https://moelove.info/2019/09/29/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-containerd-v1.3-%E6%AD%A3%E5%BC%8F%E5%8F%91%E5%B8%83/</guid><pubDate>Sun, 29 Sep 2019 21:44:09 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="containerd-v130-æ­£å¼å‘å¸ƒ">containerd v1.3.0 æ­£å¼å‘å¸ƒ&lt;/h2>
&lt;p>åœ¨ä¸Šä¸ªä¸»ç‰ˆæœ¬ï¼ˆv1.2.0ï¼‰åç»è¿‡ 11 ä¸ªæœˆï¼Œæˆ‘ä»¬ç»ˆäºè¿æ¥äº† containerd v1.3.0 çš„å‘å¸ƒï¼Œå½“ç„¶è¿™ä¸ªç‰ˆæœ¬ä¹Ÿæ˜¯ containerd è‡ª CNCF æ¯•ä¸šåçš„é¦–ä¸ªä¸»ç‰ˆæœ¬ã€‚ï¼ˆå…³äº containerd æ¯•ä¸šçš„ä¿¡æ¯å¯å‚è€ƒæˆ‘&lt;a href="https://zhuanlan.zhihu.com/p/58003521">ä¹‹å‰çš„æ–‡ç« &lt;/a>ï¼‰&lt;/p>
&lt;p>åœ¨ä¸‰å‘¨å‰ containerd v1.3.0-rc.0 å‘å¸ƒæ—¶ï¼Œæˆ‘ä¹Ÿæåˆ°è¿‡ä¸€äº›ï¼Œç°åœ¨æˆ‘ä»¬æ¥æ•´ä½“çœ‹ä¸€ä¸‹ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>å¢åŠ äº† Windows v2 çš„ runtime APIï¼Œ åŒæ—¶ç§»é™¤äº† Windows v1 APIï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä¸ºä¿®å¤ CVE-2019-16884 æ›´æ–°äº† runc ä¾èµ–ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¯é…ç½®çš„æ’ä»¶ç›®å½•ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å…è®¸æ’ä»¶æ³¨å†Œä¸ºä¸€ä¸ª TCP Server ï¼Œé€šè¿‡è¿™ç§æœºåˆ¶å…¶å®å¯ä»¥åšåˆ°å¾ˆå¤šçš„äº‹æƒ…äº†ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¢åŠ äº†æµå¼å¤„ç†çš„æ’ä»¶ï¼Œå…è®¸åœ¨è§£åŒ…çš„æ—¶å€™å¤„ç†è‡ªå®šä¹‰èµ„æºç±»å‹ï¼ˆè®¾è®¡ä¸Šè€ƒè™‘å¯ä½¿ç”¨æ­¤åŠŸèƒ½è¿›è¡ŒåŠ è§£å¯†ç›¸å…³çš„é€»è¾‘ï¼‰ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æ”¯æŒè·¨ä»“åº“æ¨é€é•œåƒï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æ–°å¢äº† devicemapper çš„å¿«ç…§æ”¯æŒï¼Œç„¶è€Œéœ€è¦æ³¨æ„çš„æ˜¯ Docker å·²ç»å°† devicemapper çš„å­˜å‚¨é©±åŠ¨æ ‡è®°ä¸ºäº†è¿‡æœŸï¼Œæ¨èå¤§å®¶ä½¿ç”¨ Overlay2 çš„å­˜å‚¨é©±åŠ¨ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>åœ¨ CRI æ–¹é¢ &lt;code>io.containerd.runtime.v1.linux&lt;/code> ä»ç„¶æ˜¯é»˜è®¤çš„è¿è¡Œæ—¶ï¼Œå¯é€‰é…ç½®ä¸ºæ–°çš„ &lt;code>io.containerd.runc.v2&lt;/code>ï¼Œæ–°çš„ç‰ˆæœ¬&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ç»è¿‡äº†ä¸€äº›æµ‹è¯•ï¼Œä½†ç”Ÿäº§ç¯å¢ƒä½¿ç”¨çš„è¯ï¼Œæˆ‘ä¸ªäººå»ºè®®è¿˜éœ€å¤§é‡æµ‹è¯•ï¼Œè°¨æ…ä¸€äº›ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¦å¤–å°±æ˜¯æœ‰äº›é…ç½®å·²ç»è¿‡æœŸäº†ï¼Œæ¯”å¦‚ &lt;code>plugins.cri.registry.auths&lt;/code> éœ€è¦ä¿®æ”¹ä¸º &lt;code>plugins.cri.registry.configs&lt;/code> è¿›è¡Œé…ç½®ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æ·»åŠ äº† &lt;code>pod_annotations&lt;/code> çš„è¿è¡Œæ—¶é€‰é¡¹ï¼Œè¿™å°†ä¼šä¼ é€’ç»™è¿è¡Œæ—¶ï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ªç‰¹æ€§æ¥åšä¸€äº›åŸºäº annotation çš„å®éªŒæ€§åŠŸèƒ½ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>IPv4/IPv6 åŒæ ˆæ”¯æŒï¼›&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>ä»æ•´ä½“ä¸Šæ¥çœ‹ï¼Œä¸€æ–¹é¢æ˜¯ä¸ºäº†æ‰©å±•å…¶åŠŸèƒ½ï¼ŒåŒ…æ‹¬å¯¹ Windows runtime çš„æ”¯æŒå’Œ Plugin ç›¸å…³çš„æ”¯æŒï¼›å¦ä¸€æ–¹é¢è¿˜æ˜¯åœ¨å°½é‡ä¿æŒ API çš„å…¼å®¹æ€§ï¼Œä»¥åŠé€‚é… CRI ç­‰ã€‚&lt;/p>
&lt;p>å¦‚æœç”Ÿäº§ç¯å¢ƒæƒ³è¦å‡çº§çš„è¯ï¼Œå»ºè®®å°½é‡å¤šæµ‹è¯•ä¸‹ï¼›æ­¤å¤– Docker ä¹Ÿæ­£åœ¨ç§¯æçš„å‘å¸ƒæ–°ç‰ˆæœ¬ï¼Œä¸ä¹…ä¹‹åä¹Ÿå¯ä¸€åŒè¿›è¡Œå‡çº§ã€‚ã€‚&lt;/p>
&lt;p>æ›´å¤šå†…å®¹è¯·å‚é˜… &lt;a href="https://github.com/containerd/containerd/releases/tag/v1.3.0">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="docker-v19033-beta2-å‘å¸ƒ">Docker v19.03.3-beta2 å‘å¸ƒ&lt;/h2>
&lt;p>æ­¤ç‰ˆæœ¬ä¸­ï¼Œæ›´æ–°äº† containerd ç›¸å…³çš„ä¾èµ–ï¼Œä»¥åŠä¿®å¤äº†ä¸¤ä¸ªåç«¯ API å¦‚æœä¼ é€’é”™è¯¯çš„ platform å‚æ•°æ—¶ï¼Œå¯èƒ½å¼•èµ·çš„ 500 é”™è¯¯ã€‚&lt;/p>
&lt;p>ä¸å‡ºæ„å¤–çš„è¯ï¼Œä¸‹å‘¨ä¼šå‘å¸ƒæ­£å¼ç‰ˆï¼Œå¯¹æ­¤ç‰ˆæœ¬æ„Ÿå…´è¶£çš„æœ‹å‹å¯å‚é˜… &lt;a href="https://github.com/docker/docker-ce/releases/tag/v19.03.3-beta2">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="istio-131-å‘å¸ƒåŒ…å«ä¼—å¤šæ›´æ–°">Istio 1.3.1 å‘å¸ƒåŒ…å«ä¼—å¤šæ›´æ–°&lt;/h2>
&lt;p>å¸¸è§„çš„ bugfix ç‰ˆæœ¬ï¼Œè¿™ä¸ªç‰ˆæœ¬ä¸­åŒ…å«çš„ä¸»è¦éƒ½æ˜¯ä¸€äº›é”™è¯¯ä¿®å¤ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ä¿®å¤äº†ä¸€ä¸ªè‡ª Istio 1.2.4 ä»¥æ¥ï¼Œå¯èƒ½å‡ºç°çš„ Envoy å´©æºƒçš„é—®é¢˜ã€‚ &lt;a href="https://github.com/istio/istio/issues/16357">#16357&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æ·»åŠ äº† &lt;code>istioctl experimental analyze&lt;/code> ç”¨äºå¤šèµ„æºçš„åˆ†æå’ŒéªŒè¯&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>ä»¥ä¸Šæ˜¯æˆ‘è®¤ä¸ºå€¼å¾—å…³æ³¨çš„ä¿®å¤å’Œå°çš„æ–°ç‰¹æ€§ï¼Œå¯¹æ­¤ç‰ˆæœ¬æ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥å‚é˜… &lt;a href="https://istio.io/news/2019/announcing-1.3.1/">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="é¢˜å¤–è¯">é¢˜å¤–è¯&lt;/h2>
&lt;p>æ˜å¤©å°±æ˜¯å›½åº†å‡æœŸäº†ï¼Œå¸Œæœ›å¤§å®¶ç©çš„å¼€å¿ƒã€‚&lt;/p>
&lt;p>ä¹‹åä¾¿æ˜¯ä¸‹ä¸€å­£åº¦äº†ï¼Œæ•´ä¸ªç¤¾åŒºä»¥åŠå‘¨è¾¹ç”Ÿæ€çš„å„ç±»ç»„ä»¶çš„å¼€å‘å›¢é˜Ÿä¹Ÿéƒ½åœ¨æ¢³ç†é—ç•™çš„é—®é¢˜ï¼Œä»¥åŠåŠ é€Ÿè¿›è¡Œå¼€å‘å’Œå‘ç‰ˆäº†ï¼Œé¢„è®¡ä¸‹ä¸€å­£åº¦è¿˜æ˜¯ä¼šæœ‰å¾ˆå¤šå€¼å¾—æœŸå¾…çš„æ¶ˆæ¯çš„ã€‚&lt;/p>
&lt;hr>
&lt;p>å¯ä»¥é€šè¿‡ä¸‹é¢äºŒç»´ç è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘ï¼Œåœ¨å…¬ä¼—å·åå°å›å¤ k8s å¯åŠ å…¥æŠ€æœ¯åœˆäº¤æµã€‚&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| Kubernetes v1.16 æ­£å¼å‘å¸ƒ</title><link>https://moelove.info/2019/09/22/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Kubernetes-v1.16-%E6%AD%A3%E5%BC%8F%E5%8F%91%E5%B8%83/</link><guid isPermaLink="true">https://moelove.info/2019/09/22/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Kubernetes-v1.16-%E6%AD%A3%E5%BC%8F%E5%8F%91%E5%B8%83/</guid><pubDate>Sun, 22 Sep 2019 23:45:37 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="kubernetes-v116-æ­£å¼å‘å¸ƒ">Kubernetes v1.16 æ­£å¼å‘å¸ƒ&lt;/h2>
&lt;p>æ­£å¦‚æˆ‘åœ¨ä¸Šæ¬¡å‘¨æŠ¥ä¸­æ‰€è¯´ï¼Œæœ¬å‘¨ Kubernetes v1.16 æ­£å¼å‘å¸ƒäº†ã€‚æ­¤ç‰ˆæœ¬ä¸­å…±åŒ…å« 31 é¡¹åŠŸèƒ½å¢å¼ºï¼šå…¶ä¸­ 8 é¡¹å¤„äº stable é˜¶æ®µï¼Œ8 é¡¹å¤„äº beta é˜¶æ®µï¼Œå‰©ä¸‹çš„ 15 é¡¹å¤„äº alpha é˜¶æ®µã€‚&lt;/p>
&lt;p>å¦‚æœä¸€ç›´å…³æ³¨æœ¬å‘¨æŠ¥ç³»åˆ—æ–‡ç« çš„è¯ï¼Œè¿™ä¸ªç‰ˆæœ¬ä¸­æ¯”è¾ƒé‡è¦çš„åŠŸèƒ½æˆ‘åŸºæœ¬éƒ½å·²ç»æåˆ°è¿‡äº†ï¼ˆè¿™é‡Œåˆ’ä¸ªé‡ç‚¹ï¼‰ã€‚&lt;/p>
&lt;ul>
&lt;li>CRD è¾¾åˆ° GA ï¼Œè¿™æ˜¯å½“å‰ç¤¾åŒºæœ€ä¸ºæ¨å´‡çš„ä¸€ç§æ‰©å±• Kubernetes çš„æ–¹å¼ï¼Œå¹¶ä¸”è‡ªä» 1.7 åŠ å…¥åï¼Œä¹Ÿè¢«è¶Šæ¥è¶Šå¹¿æ³›çš„ä½¿ç”¨äº†ï¼›&lt;/li>
&lt;li>å‡†å…¥æ§åˆ¶ webhooks è¾¾åˆ° GA ï¼Œå‡†å…¥æ§åˆ¶åœ¨ Kubernetes ä¸­å¤ªè¿‡äºé‡è¦äº†ï¼Œè‡ª 1.9 è¯¥åŠŸèƒ½åŠ å…¥ä»¥æ¥ï¼Œè¢«å¹¿æ³›ç”¨äºæ‰©å±• Kubernetes ç›¸å…³åŠŸèƒ½ï¼›&lt;/li>
&lt;li>ç°åœ¨ CSI è§„èŒƒä¸­æ”¯æŒè°ƒæ•´å·å¤§å°ï¼Œå½“å‰æ­£åœ¨è¿ç§»è‡³ Beta é˜¶æ®µï¼›&lt;/li>
&lt;li>IPv4/IPv6 åŒæ ˆæ”¯æŒï¼›&lt;/li>
&lt;li>ä¸ºäº†æ›´å¥½çš„æ§åˆ¶ kube-apiserver çš„ç½‘ç»œæµé‡ï¼Œæ­£åœ¨å°è¯•ç»™å®ƒå¢åŠ ä¸€ä¸ª&lt;a href="https://github.com/kubernetes/enhancements/blob/master/keps/sig-api-machinery/20190226-network-proxy.md">ä»£ç†&lt;/a>ï¼Œè¯¦æƒ…å¯ç‚¹å‡»é“¾æ¥æŸ¥çœ‹ï¼›&lt;/li>
&lt;/ul>
&lt;p>å…¶ä½™è¿˜æœ‰ä¸€äº›æ¯”è¾ƒé‡è¦çš„å†…å®¹ï¼š&lt;/p>
&lt;ul>
&lt;li>ç°åœ¨ kubeadm åœ¨ TLS bootstrap ä¹‹åï¼Œå°†ä¼šåˆ é™¤ &lt;code>bootstrap-kubelet.conf&lt;/code>ï¼Œå¦‚æœæœ‰ä¾èµ–æ­¤æ–‡ä»¶çš„å°ä¼™ä¼´ï¼Œè¯·å°½å¿«è¿ç§»ä½¿ç”¨ &lt;code>kubelet.conf&lt;/code> ï¼Œæ­¤å¤–ä¹Ÿå»ºè®®å…ˆçœ‹çœ‹ RBAC ç›¸å…³çš„å†…å®¹ï¼Œäº†è§£ä¸‹åˆ‡æ¢çš„æ„ä¹‰ï¼›&lt;/li>
&lt;li>&lt;code>beta.kubernetes.io/metadata-proxy-ready&lt;/code> å’Œ &lt;code>beta.kubernetes.io/kube-proxy-ds-ready&lt;/code> éƒ½è¢«ç§»é™¤äº†ï¼›&lt;/li>
&lt;li>è¿˜æœ‰ä¹‹å‰æåˆ°è¿‡çš„ &lt;code>pps/v1beta1&lt;/code> å’Œ &lt;code>apps/v1beta2&lt;/code> å·²ç»è¢« &lt;code>apps/v1&lt;/code> å–ä»£ç­‰ï¼Œè¿™é‡Œä¸å†ä¸€ä¸€åˆ—ä¸¾äº†ï¼Œæœ‰å…´è¶£å¯å‚è€ƒä¹‹å‰çš„å‘¨æŠ¥å†…å®¹ã€‚&lt;/li>
&lt;/ul>
&lt;p>æ•´ä½“æ¥è¯´ Kubernetes 1.16 æ˜¯ä¸ªå¾ˆä¸é”™çš„ç‰ˆæœ¬ï¼Œå½“ç„¶ä¸Šé¢çš„å†…å®¹ä¹Ÿå¹¶ä¸æ˜¯å…¶æ›´æ–°åŠŸèƒ½çš„å…¨éƒ¨ï¼Œå»ºè®®é˜…è¯» &lt;a href="https://relnotes.k8s.io">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="kubernetes-ä¸Šçº¿-releasenote-ä¸“ç”¨ç½‘ç«™">Kubernetes ä¸Šçº¿ ReleaseNote ä¸“ç”¨ç½‘ç«™&lt;/h2>
&lt;p>Kubernetes ä¸Šçº¿äº†ä¸“ç”¨çš„ ReleaseNote çš„ç½‘ç«™ &lt;a href="https://relnotes.k8s.io">https://relnotes.k8s.io&lt;/a> ç›´æ¥åˆ©ç”¨æ ‡ç­¾åˆ’åˆ†äº†ç›¸å…³é¢†åŸŸçš„åŠŸèƒ½ï¼Œå¯ä»¥æ›´åŠ æ¸…æ™°çš„è®©å¤§å®¶äº†è§£åˆ°è‡ªå·±æƒ³çŸ¥é“çš„åŠŸèƒ½å˜æ›´ç›¸å…³çš„å†…å®¹ã€‚&lt;/p>
&lt;h2 id="dockerhub-æ–°åŠŸèƒ½personal-access-tokens">DockerHub æ–°åŠŸèƒ½ï¼šPersonal Access Tokens&lt;/h2>
&lt;p>åœ¨ä¸Šä¸ªå­£åº¦ï¼Œæˆ‘æ›¾åœ¨ k8s ç”Ÿæ€å‘¨æŠ¥ä¸­æœ‰æåˆ°è¿‡å…³äº DockerHub è¢«æ”»å‡»äº‹ä»¶ã€‚ç»è¿‡è¿™æ®µæ—¶é—´çš„åŠªåŠ›ï¼Œç°åœ¨ DockerHub ä¸Šçº¿äº†æ–°åŠŸèƒ½ï¼Œå…è®¸ç”¨æˆ·åˆ›å»ºè‡ªå·±çš„ Access Token ã€‚&lt;/p>
&lt;p>é€šè¿‡è¿™ä¸€æ–¹å¼ï¼Œç”¨æˆ·å¯ä»¥æ›´åŠ çµæ´»çš„æ§åˆ¶è®¤è¯é€»è¾‘ã€‚å½“ä¸å…¶ä»–å·¥å…·è¿›è¡Œé›†æˆçš„æ—¶å€™ï¼Œä¹Ÿå¯é¿å…æš´éœ²è‡ªå·±çš„å¯†ç ä¿¡æ¯ç­‰ã€‚&lt;/p>
&lt;p>å½“ç„¶ä»Šåè¿™ä¸€åŠŸèƒ½è¿˜å¯ä»¥ç”¨äºå‘å±•å¤šå› ç´ èº«ä»½éªŒè¯æˆ–è€…åšåŸºäºå›¢é˜Ÿçš„è®¿é—®æ§åˆ¶ã€‚ å¦å¤–æˆ‘å°è¯•è¿‡äº†å¤šæ¬¡ï¼ŒToken çš„æ›´æ–°è¿˜æ˜¯å¾ˆåŠæ—¶çš„ã€‚&lt;/p>
&lt;p>&lt;img src="https://moelove.info/img/dockerhub-token.png" alt="DockerHub Access Token - moelove.info">&lt;/p>
&lt;h3 id="é¢˜å¤–è¯">é¢˜å¤–è¯&lt;/h3>
&lt;p>æœ¬å‘¨æˆ‘ä¸»è¦å¿™ç€ä¸¾åŠå©šç¤¼ï¼Œè¿™ç¯‡å†…å®¹ç¯‡å¹…è¾ƒçŸ­ï¼Œå°±åªåŒ…å«äº†æˆ‘æœ¬å‘¨æ‰€å…³æ³¨åˆ°çš„ä¿¡æ¯ã€‚
æ„Ÿè°¢æˆ‘çš„å°å¯çˆ±ï¼Œæ„Ÿè°¢äº²æœ‹å¥½å‹ä»¬çš„æ”¯æŒï¼Œæ„Ÿè°¢æ‰€æœ‰å…³æ³¨çš„è¯»è€…æœ‹å‹ä»¬çš„æ”¯æŒï¼Œè°¢è°¢ä½ ä»¬ã€‚&lt;/p>
&lt;hr>
&lt;p>å¯ä»¥é€šè¿‡ä¸‹é¢äºŒç»´ç è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘ï¼Œåœ¨å…¬ä¼—å·åå°å›å¤ k8s å¯åŠ å…¥æŠ€æœ¯åœˆäº¤æµã€‚&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| Istio 1.3 æ­£å¼å‘å¸ƒ</title><link>https://moelove.info/2019/09/15/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Istio-1.3-%E6%AD%A3%E5%BC%8F%E5%8F%91%E5%B8%83/</link><guid isPermaLink="true">https://moelove.info/2019/09/15/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Istio-1.3-%E6%AD%A3%E5%BC%8F%E5%8F%91%E5%B8%83/</guid><pubDate>Sun, 15 Sep 2019 23:45:23 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="istio-130-æ­£å¼å‘å¸ƒ">Istio 1.3.0 æ­£å¼å‘å¸ƒ&lt;/h2>
&lt;p>ä¸Šå‘¨ k8s ç”Ÿæ€å‘¨æŠ¥ä¸­ï¼Œæˆ‘æ¨é€äº†å…³äº Istio 1.3.0-rc2 å‘å¸ƒçš„æ¶ˆæ¯åï¼Œæœ‰å°ä¼™ä¼´ä¸“é—¨ç§èŠæˆ‘ï¼Œè¯´æƒ³é—®é—® Istio 1.3 åˆ°åº•æœ‰ä»€ä¹ˆæ–°ç‰¹æ€§ï¼›ä»¥åŠä¸ºä½•ä¸Šæ¬¡æ²¡æœ‰å¯¹ Istio 1.3 çš„æ–°ç‰¹æ€§è¿›è¡Œä»‹ç»ã€‚&lt;/p>
&lt;p>è¿™é‡Œæˆ‘æ¥åšä¸‹è¯´æ˜ï¼Œé¦–å…ˆå…³äºä¸ºä½•ä¸Šæ¬¡æ²¡æœ‰å¯¹ Istio 1.3 æ–°ç‰¹æ€§è¿›è¡Œä»‹ç»ã€‚æœ‰ä¸¤ä¸ªä¸»è¦åŸå› ï¼š1. ä¸Šå‘¨æ—¶ï¼Œæ­£å¼ç‰ˆå°šæœªå‘å¸ƒï¼›2. å¯¹ 1.3 è¿™ä¸ªç‰ˆæœ¬è€Œè¨€æ²¡æœ‰å¤ªå¤šæ–°ç‰¹æ€§ï¼Œæ­¤ç‰ˆæœ¬ä¸»è¦åœ¨äºæ”¹å–„ç”¨æˆ·ä½“éªŒã€‚&lt;/p>
&lt;p>å¯¹ Istio è€Œè¨€ï¼Œä»Šå¹´æ˜¯ä¸ªå¾ˆé‡è¦çš„èŠ‚ç‚¹ï¼Œè€Œä¸”è‡ªä» 3 æœˆä»½å‘å¸ƒ 1.1 ç‰ˆæœ¬ä»¥æ¥ï¼Œ Istio çš„æ›´æ–°é¢‘ç‡åŸºæœ¬ç¨³å®šåœ¨äº† 3 ä¸ªæœˆå‘å¸ƒä¸€ä¸ªç‰ˆæœ¬ã€‚1.1 ç‰ˆæœ¬ä¸“æ³¨äºä¼ä¸šå°±ç»ªï¼Œåœ¨æ­¤ç‰ˆæœ¬ä¸­ä¸€æ–¹é¢æ˜¯æå‡ç³»ç»Ÿçš„ç¨³å®šæ€§ï¼Œå¦ä¸€æ–¹é¢åˆ™æ˜¯è§£å†³ä¼ä¸šè½åœ°æ—¶ï¼Œå¯èƒ½é‡åˆ°çš„ä¸€äº›é—®é¢˜ï¼Œæ‰€ä»¥ 1.1 ä¸­æœ‰å¤§é‡çš„æ–°ç‰¹æ€§ã€‚è€Œ 1.2 ç‰ˆæœ¬å…¶å®ä¹Ÿç±»ä¼¼ï¼Œè™½ç„¶èŠ±è´¹äº†å¾ˆå¤šç²¾åŠ›åœ¨ä¿è¯è´¨é‡ä¸Šï¼Œä½†å…¶ä¸­ä¹Ÿæœ‰ä¸å°‘åŠŸèƒ½ä» Beta åˆ°äº† Stable é˜¶æ®µã€‚&lt;/p>
&lt;p>å…¶æ¬¡æ˜¯å…³äº 1.3 ç‰ˆæœ¬åˆ°åº•æœ‰å“ªäº›æ–°ç‰¹æ€§ï¼š&lt;/p>
&lt;ul>
&lt;li>å‡ºç«™æµé‡è‡ªåŠ¨ç¡®å®šåè®®ï¼šä¹‹å‰ç‰ˆæœ¬ä¸­ï¼ŒIstio è¦æ±‚ Service éœ€è¦æŒ‰ç…§æŒ‡å®šçš„è§„åˆ™è¿›è¡Œå‘½åæ‰å¯ä»¥è‡ªåŠ¨ç¡®è®¤å…¶åè®®ï¼Œè€Œåœ¨æ­¤ç‰ˆæœ¬ä¸­åˆ™å¯ä»¥è‡ªåŠ¨ç¡®è®¤å…¶æ˜¯ HTTP æˆ– HTTP/2 æµé‡ï¼Œå¦‚æœæ— æ³•è‡ªåŠ¨ç¡®è®¤ï¼Œåˆ™è®¤ä¸ºå…¶æ˜¯çº¯ TCP æµé‡ï¼Œå¦‚æœæ˜¯é€šè¿‡ Helm å®‰è£…çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨ &lt;code>--set pilot.enableProtocolSniffing=false&lt;/code> å…³é—­æ­¤åŠŸèƒ½ï¼›&lt;/li>
&lt;li>Pod spec ä¸­ä¸å†éœ€è¦å®šä¹‰ &lt;code>containerPort&lt;/code>ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¼šæ•è·æ‰€æœ‰ç«¯å£ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥é€šè¿‡ &lt;code>traffic.sidecar.istio.io/includeInboundPorts&lt;/code> è¦†ç›–æ­¤è¡Œä¸ºæˆ–è€…é€šè¿‡ &lt;code>traffic.sidecar.istio.io/excludeOutboundPorts&lt;/code> ç»•è¿‡è¦æ•è·çš„ç«¯å£ï¼›&lt;/li>
&lt;li>å½“ä½¿ç”¨ Redis proxy æ—¶ï¼Œç°åœ¨é»˜è®¤çš„è´Ÿè½½å‡è¡¡å™¨æ˜¯ Envoy çš„ &lt;a href="https://www.envoyproxy.io/docs/envoy/v1.6.0/intro/arch_overview/load_balancing#maglev">MAGLEV&lt;/a>ï¼›&lt;/li>
&lt;li>æ”¹å–„äº† &lt;code>EnvoyFilter&lt;/code> API ç°åœ¨ä½ å¯ä»¥æ·»åŠ æˆ–æ›´æ–°æ‰€æœ‰é…ç½®ï¼›&lt;/li>
&lt;li>å®éªŒæ€§çš„ä½¿ç”¨ Prometheus ä¸ºä»£ç†å†…ç”ŸæˆæœåŠ¡æŒ‡æ ‡çš„æ”¯æŒï¼›&lt;/li>
&lt;li>åºŸå¼ƒäº† Mixer adapters ä¸¤ä¸ªç‰ˆæœ¬åç§»é™¤ï¼›&lt;/li>
&lt;li>istioctl å‘½ä»¤æœ‰äº†ä¸€äº›å˜åŒ–ï¼š &lt;code>istioctl experimental dashboard&lt;/code> æ™‹å‡ä¸ºäº† &lt;code>istioctl dashboard&lt;/code> ï¼Œ&lt;code>istioctl experimental convert-ingress&lt;/code> æ™‹å‡ä¸ºäº† &lt;code>istioctl convert-ingress&lt;/code>ï¼Œä»¥åŠå¢åŠ äº†ä¸€äº›ä¾¿äºè°ƒè¯•ä½¿ç”¨çš„ &lt;code>metrics&lt;/code> æˆ–è€… &lt;code>describe pod&lt;/code> ä¹‹ç±»çš„å®éªŒæ€§å‘½ä»¤ï¼›&lt;/li>
&lt;/ul>
&lt;p>ä»¥ä¸Šä¾¿æ˜¯æˆ‘ä¸ªäººçœ‹æ¥ 1.3 ä¸­å€¼å¾—å…³æ³¨çš„å†…å®¹ï¼Œä½†å…¶å®å¾ˆæ˜æ˜¾ï¼Œè¿™ä¸ªç‰ˆæœ¬çš„ä¸»é¢˜ç¡®å®è¿˜éƒ½åœ¨æ”¹å–„ç”¨æˆ·ä½“éªŒä¸Šï¼Œå¦‚æœå¯¹æ­¤ç‰ˆæœ¬æœ‰å…´è¶£çš„å°ä¼™ä¼´ï¼Œå¯è‡ªè¡Œå‚çœ‹ &lt;a href="https://istio.io/about/notes/1.3/">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="ä»-helm-v2-è¿ç§»è‡³-helm-v3">ä» Helm v2 è¿ç§»è‡³ Helm v3&lt;/h2>
&lt;p>&lt;a href="https://helm.sh/blog/migrate-from-helm-v2-to-helm-v3/">è¿™æ˜¯æ¥è‡ª Helm å®˜æ–¹åšå®¢çš„ä¸€ç¯‡æ–‡ç« &lt;/a> å…ˆæ¥ä¸€å¼ å›¾ï¼š&lt;/p>
&lt;p>&lt;img src="https://helm.sh/blog/images/helm-2to3.png" alt="helm-2to3-moelove.info">&lt;/p>
&lt;p>å…¶å®è¿™ç¯‡æ–‡ç« ä¸»æ—¨å°±æ˜¯ä»‹ç»ä¸€ä¸ª Helm çš„æ’ä»¶ &lt;a href="https://github.com/helm/helm-2to3">helm-2to3&lt;/a> è¿™ä¹Ÿæ˜¯â€œå®˜æ–¹å·¥å…·â€ï¼Œæ¨èéœ€è¦ä» Helm v2 è¿ç§»è‡³ v3 çš„å°ä¼™ä¼´ä½¿ç”¨ã€‚&lt;/p>
&lt;p>å¦å¤–ï¼Œçœ‹ Helm v3 ç°åœ¨çš„çŠ¶æ€ï¼Œè™½ç„¶æ­£å¼ç‰ˆä»æœªå‘å¸ƒï¼Œä½†ä¹Ÿåº”è¯¥ä¸ä¼šå¤ªä¹…äº†ã€‚&lt;/p>
&lt;h2 id="ä¸Šæ¸¸è¿›å±•">ä¸Šæ¸¸è¿›å±•&lt;/h2>
&lt;p>Kubernetes v1.16.0 æ­£å¼ç‰ˆå³å°†å‘å¸ƒï¼Œä¸å‡ºæ„å¤–çš„è¯ï¼Œåº”è¯¥ä¹Ÿå°±æ˜¯æœ€åä¸€å‘¨äº†ã€‚å½“ç„¶ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“ Kubernetes å‘å¸ƒæ–°ç‰ˆæœ¬åï¼Œæ„å‘³ç€æ—§ç‰ˆæœ¬å°†æœ‰ä¸€ä¸ª EOL è¯·åŠæ—¶å‡çº§ã€‚&lt;/p>
&lt;p>å› ä¸ºç°åœ¨æ˜¯ Code Freeze é˜¶æ®µï¼Œæ‰€ä»¥ä¸Šæ¸¸çš„å¼€å‘è¿›å±•æ²¡æœ‰å¾ˆå¤šã€‚&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/pull/82199">#82199&lt;/a> å°† etcd server ä» 3.3.10 æ›´æ–°åˆ°äº† 3.3.15 ï¼Œå®é™…ä¸Šè¿™ä¸ªå˜æ›´å¯èƒ½æ˜¯ä¸ªé—æ¼ hah&lt;/li>
&lt;/ul>
&lt;hr>
&lt;p>å¯ä»¥é€šè¿‡ä¸‹é¢äºŒç»´ç è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘ï¼Œåœ¨å…¬ä¼—å·åå°å›å¤ k8s å¯åŠ å…¥æŠ€æœ¯åœˆäº¤æµã€‚&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| Harbor v1.9 å¸¦æ¥ä¼—å¤šæ–°ç‰¹æ€§</title><link>https://moelove.info/2019/09/08/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Harbor-v1.9-%E5%B8%A6%E6%9D%A5%E4%BC%97%E5%A4%9A%E6%96%B0%E7%89%B9%E6%80%A7/</link><guid isPermaLink="true">https://moelove.info/2019/09/08/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Harbor-v1.9-%E5%B8%A6%E6%9D%A5%E4%BC%97%E5%A4%9A%E6%96%B0%E7%89%B9%E6%80%A7/</guid><pubDate>Sun, 08 Sep 2019 22:43:44 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="docker-ce-19032-å‘å¸ƒ">Docker CE 19.03.2 å‘å¸ƒ&lt;/h2>
&lt;p>Docker CE 19.03.2 å·²äºè¿‘æ—¥å‘å¸ƒï¼Œäº‹å®ä¸Šæ­¤ç‰ˆæœ¬å†…æ›´æ–°çš„å†…å®¹æœ¬è¯¥åœ¨ 19.03.1 ä¸­å‘å¸ƒçš„ï¼Œä¸è¿‡ 19.03.1 ä¸»è¦æ˜¯ä¸ºäº†ä¿®æ­£ &lt;a href="https://nvd.nist.gov/vuln/detail/CVE-2019-14271">CVE-2019-14271&lt;/a> å¦‚æœä½ æ­£åœ¨ä½¿ç”¨ 19.03.0 é‚£æˆ‘å»ºè®®ä½ è¿›è¡Œå‡çº§ã€‚&lt;/p>
&lt;p>ä¸ºäº†ä¿è¯å°½å¯èƒ½å¿«çš„ä¿®å¤é—®é¢˜ï¼Œæ‰€ä»¥ä¸“ç¨‹å‘å¸ƒäº† 19.03.1 ç‰ˆæœ¬ï¼Œè€ŒæŠŠåŸå…ˆé¢„æœŸçš„åŠŸèƒ½è½¬ç§»è‡³ 19.03.2 ä¸­è¿›è¡Œå‘å¸ƒã€‚è¿™å…¶å®ä¹Ÿæ˜¯ Docker åšçš„æ¯”è¾ƒå¥½çš„ä¸€ä¸ªäº‹æƒ…ï¼ŒDocker çš„ç‰ˆæœ¬å‘å¸ƒå¾ˆæœ‰åŸåˆ™ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬æ¥çœ‹çœ‹ 19.03.2 ä¸­å¸¦æ¥äº†å“ªäº›å˜åŒ–ï¼š&lt;/p>
&lt;ul>
&lt;li>ä¿®æ­£äº†Docker CLI å¯¹ HTTP Proxy ç¯å¢ƒå˜é‡çš„æ”¯æŒï¼›&lt;/li>
&lt;li>ä¿®æ­£äº†ä¸€ä¸ªä¸ºå®¹å™¨ä½¿ç”¨ XFS ç£ç›˜é…é¢å¯èƒ½äº§ç”Ÿçš„ panicï¼›&lt;/li>
&lt;/ul>
&lt;p>å…¶ä»–å˜åŒ–ï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥å‚çœ‹å…¶ &lt;a href="https://github.com/docker/docker-ce/releases/tag/v19.03.2">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="containerd-130-rc0-å‘å¸ƒ">containerd 1.3.0-rc.0 å‘å¸ƒ&lt;/h2>
&lt;p>1.3 å°†ä¼šæ˜¯ containerd çš„ä¸‹ä¸€ä¸ªä¸»ç‰ˆæœ¬ï¼›è€Œè‡ª containerd 1.2 å‘å¸ƒä»¥æ¥å·²ç»è¿‡å»äº†è¿‘ 9 ä¸ªæœˆã€‚æˆ‘ä»¬æ¥å¤§è‡´çœ‹çœ‹ 1.3 ä¸­æœ‰å“ªäº›å€¼å¾—æœŸå¾…çš„åŠŸèƒ½ã€‚&lt;/p>
&lt;ul>
&lt;li>å¢åŠ äº† Windows v2 çš„ runtime APIï¼Œ åŒæ—¶ç§»é™¤äº† Windows v1 APIï¼›&lt;/li>
&lt;li>æ–°å¢äº† devicemapper çš„å¿«ç…§æ”¯æŒï¼Œç„¶è€Œéœ€è¦æ³¨æ„çš„æ˜¯ Docker å·²ç»å°† devicemapper çš„å­˜å‚¨é©±åŠ¨æ ‡è®°ä¸ºäº†è¿‡æœŸï¼Œæ¨èå¤§å®¶ä½¿ç”¨ Overlay2 çš„å­˜å‚¨é©±åŠ¨ï¼›&lt;/li>
&lt;li>å…è®¸æ’ä»¶æ³¨å†Œä¸ºä¸€ä¸ª TCP Server ï¼Œé€šè¿‡è¿™ç§æœºåˆ¶å…¶å®å¯ä»¥åšåˆ°å¾ˆå¤šçš„äº‹æƒ…äº†ï¼›&lt;/li>
&lt;li>å¯é…ç½®çš„æ’ä»¶ç›®å½•ï¼›&lt;/li>
&lt;li>åœ¨ CRI æ–¹é¢ &lt;code>io.containerd.runtime.v1.linux&lt;/code> ä»ç„¶æ˜¯é»˜è®¤çš„è¿è¡Œæ—¶ï¼Œå¯é€‰é…ç½®ä¸ºæ–°çš„ &lt;code>io.containerd.runc.v2&lt;/code>ï¼Œæ–°çš„ç‰ˆæœ¬ç»è¿‡äº†ä¸€äº›æµ‹è¯•ï¼Œä½†ç”Ÿäº§ç¯å¢ƒä½¿ç”¨çš„è¯ï¼Œæˆ‘ä¸ªäººå»ºè®®è¿˜éœ€å¤§é‡æµ‹è¯•ï¼Œè°¨æ…ä¸€äº›ï¼›&lt;/li>
&lt;li>å¦å¤–å°±æ˜¯æœ‰äº›é…ç½®å·²ç»è¿‡æœŸäº†ï¼Œæ¯”å¦‚ &lt;code>plugins.cri.registry.auths&lt;/code> éœ€è¦ä¿®æ”¹ä¸º &lt;code>plugins.cri.registry.configs&lt;/code> è¿›è¡Œé…ç½®ï¼›&lt;/li>
&lt;/ul>
&lt;p>ä»¥ä¸Šæ˜¯æˆ‘ä¸ªäººè§‰å¾—éœ€è¦å…³æ³¨çš„ç‚¹ï¼Œå½“ç„¶ä½œä¸ºä¸€ä¸ªä¸»ç‰ˆæœ¬çš„å‘å¸ƒï¼Œå®é™…åŒ…å«çš„å†…å®¹è¿˜æ˜¯å¾ˆå¤šçš„ã€‚è‹¥æ˜¯å¯¹æ­¤ç‰ˆæœ¬æ„Ÿå…´è¶£ï¼Œå¯ä»¥å‚çœ‹å…¶ &lt;a href="https://github.com/containerd/containerd/releases/tag/v1.3.0-rc.0">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="harbor-v190-rc1-å‘å¸ƒ">Harbor v1.9.0-rc1 å‘å¸ƒ&lt;/h2>
&lt;p>Harbor æ˜¯ç”± VMware å¼€æºçš„ä¸€æ¬¾é•œåƒä»“åº“ï¼Œç°åœ¨ GitHub ä¸Šæœ‰ 9k star ä¹Ÿç®—æ˜¯ä¸ªæ¯”è¾ƒçƒ­é—¨çš„é¡¹ç›®ï¼Œæˆ‘çŸ¥é“å›½å†…å¾ˆå¤šå…¬å¸éƒ½åœ¨ç”¨ Harbor ï¼ŒåŒ…æ‹¬æˆ‘ä¹ŸåŒæ ·æœ‰åœ¨ç”¨ã€‚&lt;/p>
&lt;p>åœ¨è¿™ä¸ªæ–°ç‰ˆæœ¬ä¸­ï¼Œå¢åŠ äº†ä¸€äº›æœ‰è¶£çš„ç‰¹æ€§ï¼Œæˆ‘ä»¬ä¸€èµ·çœ‹ä¸‹ï¼š&lt;/p>
&lt;ul>
&lt;li>å…è®¸ç³»ç»Ÿç®¡ç†å‘˜é™åˆ¶é¡¹ç›®èµ„æºé…é¢ï¼›&lt;/li>
&lt;li>å¯ä»¥è‡ªè¡Œå®šåˆ¶ Tag çš„ä¿ç•™ç­–ç•¥ï¼Œæ— è®ºæ˜¯è¿™ä¸ªç‰¹æ€§ï¼Œè¿˜æ˜¯ä¸Šé¢çš„é‚£ä¸ªç‰¹å®šï¼Œéƒ½å±äºæ¯”è¾ƒå‘¼å£°æ¯”è¾ƒé«˜çš„éœ€æ±‚ï¼Œæœ‰äº†è¿™ä¸¤ä¸ªåŠŸèƒ½ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„æ¥å¯¹èµ„æºè¿›è¡Œç®¡ç†ï¼›&lt;/li>
&lt;li>å®‰å…¨æ¼æ´ç™½åå•ï¼Œåœ¨ç³»ç»Ÿä¸­å¯ä»¥é…ç½®å…¨å±€æˆ–è€…é¡¹ç›®çš„æ¼æ´ç™½åå•ï¼Œè¿™ä¸ªåŠŸèƒ½ä¼°è®¡æœ€ç»ˆä½¿ç”¨çš„ç”¨æˆ·ä¸ä¼šå¾ˆå¤šï¼Œä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Ÿå¦‚æœå¯¹å®‰å…¨æ¼æ´å¢åŠ ç™½åå•ï¼Œé‚£å‰ææ˜¯ä½ éœ€è¦çœŸçš„å»äº†è§£è¯¥æ¼æ´çš„èµ·å› ï¼Œç»†åˆ™ï¼Œä»¥åŠæœ€ç»ˆçš„å½±å“èŒƒå›´ã€‚è´¸ç„¶åŠ å…¥ç™½åå•çš„è¯ï¼Œå¾ˆå®¹æ˜“é€ æˆä¸€äº›æ„æ–™ä¹‹å¤–çš„æƒ…å†µäº†ã€‚&lt;/li>
&lt;li>å¢åŠ äº† Webhook çš„æ”¯æŒï¼Œè¦è®©é¡¹ç›®æ›´æœ‰æ´»åŠ›ï¼Œå½“ç„¶æ˜¯éœ€è¦è®©å®ƒæ›´æ˜“ä¸å…¶ä»–ç³»ç»Ÿé›†æˆæˆ–å¼€æ”¾æ¥å£ï¼›&lt;/li>
&lt;li>å¤åˆ¶åŠŸèƒ½æœ‰æ‰€å¢å¼º&lt;/li>
&lt;/ul>
&lt;p>ä»¥ä¸Šæ˜¯æˆ‘ä¸ªäººè§‰å¾—éœ€è¦å…³æ³¨çš„ç‚¹ï¼Œè‹¥æ˜¯å¯¹æ­¤ç‰ˆæœ¬æ„Ÿå…´è¶£ï¼Œå¯ä»¥å‚çœ‹å…¶ &lt;a href="https://github.com/goharbor/harbor/releases/tag/v1.9.0-rc1">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="helm-v300-beta3-å‘å¸ƒ">Helm v3.0.0-beta.3 å‘å¸ƒ&lt;/h2>
&lt;p>Helm ä»ç„¶åœ¨ä¸º v3 ç‰ˆæœ¬åŠªåŠ›ä¸­ï¼Œæ­¤æ¬¡ç‰ˆæœ¬çš„å‘å¸ƒï¼Œå…¶ä¸­ä¸»è¦å¤šæ˜¯ç”¨äºä¿®æ­£ä¸€äº›é—®é¢˜å’Œæ”¹å–„æ–‡æ¡£ä¹‹ç±»çš„ã€‚&lt;/p>
&lt;p>å¦‚æœä½ å¯¹æ­¤ç‰ˆæœ¬æœ‰å…´è¶£ï¼Œå¯ä»¥å‚çœ‹å…¶ &lt;a href="https://github.com/helm/helm/releases/tag/v3.0.0-beta.3">ReleaseNote&lt;/a> ,éå¸¸æ¨èä½ åœ¨æœ¬åœ°è¿›è¡Œè¯•ç”¨ï¼Œå¯èƒ½è¿˜æœ‰ä¸€äº›é—®é¢˜ï¼Œè¯·åŠæ—¶åé¦ˆã€‚&lt;/p>
&lt;h2 id="istio-130-rc2-å‘å¸ƒ">Istio 1.3.0-rc2 å‘å¸ƒ&lt;/h2>
&lt;p>Istio 1.3 ä¹Ÿåœ¨è ¢è ¢æ¬²åŠ¨ï¼Œæœ€è¿‘ Istio çš„ç‰ˆæœ¬æ›´æ–°ç®—æ˜¯æ¯”è¾ƒé¢‘ç¹çš„äº†ï¼ŒæŒ‰ä¹‹å‰çš„ä¹ æƒ¯ï¼Œä¸€èˆ¬å‘ 3 ä¸ª rc ç‰ˆå°±åŸºæœ¬ä¼šå‘å¸ƒæ­£å¼ç‰ˆäº†ã€‚ å¦‚æœæ²¡æœ‰å•¥å¤§é—®é¢˜ï¼Œä¼°è®¡æœ¬æœˆèƒ½å‘å¸ƒæ­£å¼ç‰ˆã€‚&lt;/p>
&lt;p>å¯¹äºè¿™ä¸ªç‰ˆæœ¬å…¶å®æ²¡æœ‰å¤ªå¤šæƒ³è¯´çš„ï¼Œè¿˜æ˜¯ç­‰æ­£å¼ç‰ˆå‡ºæ¥å¥½äº†ã€‚&lt;/p>
&lt;h2 id="ä¸Šæ¸¸è¿›å±•">ä¸Šæ¸¸è¿›å±•&lt;/h2>
&lt;p>ä¸çŸ¥é“ä½ æ˜¯å¦è¿˜è®°å¾—ä¹‹å‰ Kubernetes çš„ä¸€ä¸ªå®‰å…¨æ¼æ´ï¼ˆå¯ä»¥ç¿»ç¿»æœ¬ç³»åˆ—å‘¨æŠ¥ï¼Œå‰é¢æœ‰æè¿°ï¼‰ï¼Œå…¶å®å—å½±å“çš„ä¸»è¦æ˜¯ &lt;code>kubectl cp&lt;/code> å‘½ä»¤ã€‚&lt;/p>
&lt;p>è€ƒè™‘åˆ°è¿™ä¸ªå‘½ä»¤å¯èƒ½å¸¦æ¥çš„å®‰å…¨é—®é¢˜ï¼Œä»¥åŠå¯¹æ¯”è¯¥å‘½ä»¤æ‰€å¸¦æ¥çš„æ”¶ç›Šï¼ˆæˆ–è€…è¯´ç”¨æˆ·ä½¿ç”¨é¢‘æ¬¡ï¼‰ï¼Œåœ¨ä¸‹ä¸€ä¸ªç‰ˆæœ¬ä¸­ &lt;code>kubectl cp&lt;/code> ä¹Ÿè®¸å°±è¢«ç§»é™¤æ‰äº†ã€‚ è€Œè®¨è®ºä¸­ï¼Œæœ‰äº›äººè®¤ä¸º &lt;code>docker cp&lt;/code> å¯ä»¥æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æ›¿ä»£é€‰æ‹©ã€‚&lt;/p>
&lt;p>&lt;code>kubectl log&lt;/code> è¢«ç§»é™¤æ‰äº†ã€‚è¿™ä¸ªå‘½ä»¤å¾ˆæ—©ä¹‹å‰å°±å·²ç»æ ‡è®°ä¸ºåºŸå¼ƒäº†ï¼Œä½†æ˜¯å¾ˆå¤šäººä¸ºäº†æ–¹ä¾¿å¯èƒ½è¿˜æ˜¯ä¼šä½¿ç”¨ &lt;code>log&lt;/code> å‘½ä»¤ã€‚å·²ç»æ ‡è®°ä¸ºåºŸå¼ƒé•¿å¤§ 4 å¹´å·¦å³äº†ï¼Œæ˜¯æ—¶å€™æŠŠå®ƒç»™ç§»é™¤æ‰äº†ã€‚&lt;/p>
&lt;p>å…¶ä»–çš„ï¼Œæ¯”å¦‚ CoreDNS å‡çº§åˆ°äº† 1.6.2 è¿™äº›ä¹Ÿéƒ½å€¼å¾—å…³æ³¨ä¸€ä¸‹ï¼Œ æˆ‘è®°å¾—ä¹‹å‰çš„å‘¨æŠ¥ä¸­å¤§æ¦‚è¯´è¿‡ CoreDNS çš„æ–°ç‰ˆæœ¬çš„å†…å®¹ã€‚&lt;/p>
&lt;hr>
&lt;p>å¯ä»¥é€šè¿‡ä¸‹é¢äºŒç»´ç è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘ï¼Œåœ¨å…¬ä¼—å·åå°å›å¤ k8s å¯åŠ å…¥æŠ€æœ¯åœˆäº¤æµã€‚&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| etcd v3.4.0 å¸¦æ¥ä¼—å¤šæ›´æ–°</title><link>https://moelove.info/2019/09/01/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-etcd-v3.4.0-%E5%B8%A6%E6%9D%A5%E4%BC%97%E5%A4%9A%E6%9B%B4%E6%96%B0/</link><guid isPermaLink="true">https://moelove.info/2019/09/01/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-etcd-v3.4.0-%E5%B8%A6%E6%9D%A5%E4%BC%97%E5%A4%9A%E6%9B%B4%E6%96%B0/</guid><pubDate>Sun, 01 Sep 2019 23:56:38 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="helm-3-beta2-å‘å¸ƒ">Helm 3 beta2 å‘å¸ƒ&lt;/h2>
&lt;p>Helm 3 ä» Alpha ä¹‹åï¼Œå°±ä¸€ç›´è¿›å…¥äº†æŒç»­æ”¹è¿›é˜¶æ®µã€‚ç»ˆäºç°åœ¨ beta2 å‘å¸ƒäº†ï¼ŒæŒ‰ç°åœ¨ç¤¾åŒºçš„å¼€å‘è¿›åº¦æ¥çœ‹ï¼Œä»Šå¹´å‘å¸ƒæ­£å¼ç‰ˆçš„å¸Œæœ›è¿˜æ˜¯å¾ˆå¤§çš„ã€‚&lt;/p>
&lt;p>æ„Ÿå…´è¶£è¿˜æ˜¯å»ºè®®å¯ä»¥å…ˆå°è¯•ä¸‹ï¼Œä»¥å…ä¹‹åå‡çº§æ—¶å¸¦æ¥ä¸é€‚ã€‚&lt;/p>
&lt;h2 id="coredns-v163-å‘å¸ƒ">CoreDNS v1.6.3 å‘å¸ƒ&lt;/h2>
&lt;ul>
&lt;li>&lt;code>federation&lt;/code> å°†åœ¨ 1.7.0 ä¸­è¢«å®Œå…¨åºŸå¼ƒï¼›&lt;/li>
&lt;li>æ–°å¢ä¸¤ä¸ªæ’ä»¶ &lt;code>clouddns&lt;/code> å’Œ &lt;code>sign&lt;/code>ï¼Œå…¶ä¸­ &lt;code>clouddns&lt;/code> é¡¾åæ€ä¹‰æ˜¯ä¸ºäº‘ç¯å¢ƒè®¾è®¡çš„ï¼Œç°åœ¨å®ƒæ”¯æŒ GCP ï¼ˆGoogle Cloud Platformï¼‰Cloud DNS æä¾›çš„ zone æ•°æ®ï¼Œå®é™…ä¸Šå®ƒæ˜¯é€šè¿‡ Google Cloud çš„ API æ¥è·å–è¿™äº›ä¿¡æ¯çš„ï¼Œå¦‚æœä½ æ²¡æœ‰åœ¨ä½¿ç”¨ GCP Cloud DNS çš„è¯ï¼Œç›®å‰è¿™ä¸ªæ’ä»¶åº”è¯¥æ˜¯ç”¨ä¸åˆ°çš„ï¼›&lt;code>sign&lt;/code> æ’ä»¶åˆ™æ˜¯æ ¹æ® RFC 6781 å¯¹ Zone ä½¿ç”¨ NSEC ç­¾åï¼Œä½†éœ€è¦æ³¨æ„çš„æ˜¯ç­¾åæ˜¯æœ‰æ—¶æ•ˆçš„ï¼Œå¦‚æœåˆ°äº†è¿‡æœŸæ—¶é—´ï¼Œåˆ™ Zone ä¿¡æ¯ä¼šå˜æˆ Bad çŠ¶æ€ï¼ˆRFC 4035ï¼‰ï¼Œæ‰€ä»¥å¦‚æœä½ æƒ³è¦ä½¿ç”¨è¿™ä¸ªæ’ä»¶ï¼Œè¯·æ˜ç¡®çŸ¥é“è‡ªå·±éœ€è¦åšä»€ä¹ˆä»¥åŠä¸ºä½•ä½¿ç”¨å®ƒï¼›&lt;/li>
&lt;li>&lt;code>file&lt;/code> æ’ä»¶ä¿®å¤äº†ä¸€äº›å†…å­˜æ³„æ¼çš„é—®é¢˜ï¼›&lt;/li>
&lt;/ul>
&lt;p>é™¤äº†ä¸Šè¿°æåˆ°çš„å†…å®¹å¤–ï¼Œæƒ³ç¨å¾®å†æä¸€ä¸‹åœ¨ v1.6.2 ä¸­æ–°å¢çš„ &lt;code>azure&lt;/code> æ’ä»¶ï¼Œå®ƒå…¶å®å’Œ &lt;code>clouddns&lt;/code> åšçš„äº‹æƒ…ç±»ä¼¼ï¼Œåªä¸è¿‡æ˜¯ä» Azure è·å–è®°å½•ç½¢äº†ã€‚å¦å¤–ä» v1.6.1 å¼€å§‹ &lt;code>reload&lt;/code> æ’ä»¶å¯ä»¥æ­£ç¡®çš„æ£€æŸ¥åœ¨ Corefile ä¸­å¯¼å…¥çš„æ–‡ä»¶çš„å˜åŒ–äº†ã€‚&lt;/p>
&lt;p>æ›´å¤šå…³äºæ­¤ç‰ˆæœ¬çš„ä¿¡æ¯ï¼Œè¯·å‚è€ƒ &lt;a href="https://coredns.io/2019/08/31/coredns-1.6.3-release/">Release Note&lt;/a>&lt;/p>
&lt;h2 id="strimzi-æˆä¸º-cncf-sandbox-é¡¹ç›®">Strimzi æˆä¸º CNCF sandbox é¡¹ç›®&lt;/h2>
&lt;p>&lt;a href="https://strimzi.io/">Strimzi&lt;/a> æ˜¯ä¸€ä¸ªè‡´åŠ›äºå°† Apache Kafka è¿è¡Œåœ¨ Kubernetes ä¸Šçš„é¡¹ç›®ï¼Œä¸è¿‡åœ¨å®ƒè¿™æ¬¡ç”³è¯·æˆä¸º CNCF sandbox é¡¹ç›®ä¹‹å‰ï¼Œå®ƒçš„å¦ä¸€ä¸ªæ–¹å‘æ˜¯è®© Apache Kafka è¿è¡Œåœ¨ OpenShift ä¸Šã€‚ä¸ºäº†æˆä¸º CNCF çš„ sandbox é¡¹ç›®ï¼Œæ‰€ä»¥ç°åœ¨ä½ èƒ½åœ¨ç½‘ç«™ä¸Šçœ‹åˆ°çš„å†…å®¹å·²ç»å¤§éƒ¨åˆ†éƒ½é‡å†™æˆä¸ºäº†è®©å…¶åœ¨ Kubernetes ä¸Šè¿è¡Œäº†ã€‚&lt;/p>
&lt;p>æ‰€ä»¥å¦‚æœä½ åœ¨ä½¿ç”¨ Openshift é‚£å€’æ˜¯ä¹Ÿå¯ä»¥å°è¯•ä¸‹æ­¤é¡¹ç›®ã€‚é™„ä¸€å¼ æ¶æ„å›¾&lt;/p>
&lt;p>&lt;img src="https://strimzi.io/docs/latest/images/operators.png" alt="Strimzi - https://moelove.info">&lt;/p>
&lt;h2 id="etcd-v340-æ­£å¼å‘å¸ƒ">etcd v3.4.0 æ­£å¼å‘å¸ƒ&lt;/h2>
&lt;p>etcd &lt;a href="https://github.com/etcd-io/etcd/releases/tag/v3.4.0">v3.4.0&lt;/a> å·²äºè¿‘æ—¥å‘å¸ƒï¼Œè¿™ä¸ªç‰ˆæœ¬ä¸­åŒ…å«äº†å¤§é‡çš„æ›´æ–°ã€‚&lt;/p>
&lt;ul>
&lt;li>æ·»åŠ  Raft learnerï¼šæ¨èç›´æ¥æŸ¥çœ‹&lt;a href="https://github.com/etcd-io/etcd/blob/master/Documentation/learning/design-learner.md">è®¾è®¡æ–‡æ¡£&lt;/a>&lt;/li>
&lt;li>åç«¯å®Œå…¨å¹¶å‘è¯»ï¼šé€šè¿‡è¿™ä¸ªæ”¹è¿›ï¼Œå†™å…¥ååå¯å¢åŠ  70%ï¼ŒP99 å†™å…¥å»¶è¿Ÿå‡å°‘ 90% ï¼Œ&lt;a href="https://github.com/etcd-io/etcd/pull/10523">ç›¸å…³ PR&lt;/a>ï¼›&lt;/li>
&lt;li>ä½¿ç”¨ gRPC balancer API é‡å†™äº† client v3 çš„è´Ÿè½½å‡è¡¡å®ç°ï¼šå½“ç„¶åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œå°† gRPC ä¾èµ–å‡çº§åˆ°äº† v1.23.0 ï¼ŒåŒæ—¶ä¹Ÿä¿®æ­£äº†ä¸€ä¸ª Kubernetes ä¸­é‡åˆ°çš„ etcd çš„é—®é¢˜ï¼Œè¯¦ç»†å†…å®¹è¯·å‚è€ƒ &lt;a href="https://github.com/kubernetes/kubernetes/issues/72102">k/k#72102&lt;/a>&lt;/li>
&lt;li>&lt;code>ETCDCTL_API=3 etcdctl&lt;/code> å’Œ &lt;code>etcd --enable-v2=false&lt;/code> æˆä¸ºäº†é»˜è®¤é…ç½®ï¼›&lt;/li>
&lt;li>æ·»åŠ äº†å¤§é‡ Metrics ä¿¡æ¯ï¼›&lt;/li>
&lt;li>è¿˜æœ‰ä¸€ä¸ªé‡å¤§å˜åŒ–æ˜¯ç°åœ¨è¦æ±‚ GO 1.12+ äº†ï¼Œä¾èµ–ç®¡ç†ä¹Ÿä» &lt;code>glide&lt;/code> è½¬å˜ä¸ºäº† GO Moduleï¼›&lt;/li>
&lt;/ul>
&lt;p>æ­¤æ¬¡çš„æ›´æ–°éå¸¸å¤šï¼Œå»ºè®®å‡çº§å‰è¯¦ç»†æŸ¥çœ‹æ–‡æ¡£ã€‚&lt;/p>
&lt;p>æ›´å¤šå…³äºæ­¤ç‰ˆæœ¬çš„ä¿¡æ¯ï¼Œè¯·å‚è€ƒ &lt;a href="https://github.com/etcd-io/etcd/blob/master/CHANGELOG-3.4.md">Release Note&lt;/a>&lt;/p>
&lt;h2 id="ä¸Šæ¸¸å¼€å‘è¿›å±•">ä¸Šæ¸¸å¼€å‘è¿›å±•&lt;/h2>
&lt;ul>
&lt;li>kubeadm é»˜è®¤ä½¿ç”¨çš„ CoreDNS ç‰ˆæœ¬å·²ç»æ›´æ–°æˆäº† v1.6.2 ï¼Œå¦‚æœä½ ä¸€ç›´éƒ½æœ‰çœ‹æˆ‘å‘å¸ƒçš„K8S ç”Ÿæ€å‘¨æŠ¥çš„è¯ï¼Œç›¸å…³å˜æ›´éœ€è¦æ³¨æ„çš„å†…å®¹å°±åŸºæœ¬éƒ½è®¨è®ºè¿‡äº†ã€‚ä¸è¿‡è¿™é‡Œç¨å¾®å¤šæä¸€ä¸‹ï¼Œç°åœ¨çš„ CoreDNS çš„ Deployment é€šè¿‡ &lt;code>ready&lt;/code> æ’ä»¶æ¥åš readiness æ£€æŸ¥ï¼Œä¹‹å‰å…¶å®è¿™é‡Œå­˜åœ¨ç€é—®é¢˜æ¥ç€ï¼›å¦å¤– &lt;code>proxy&lt;/code> æ’ä»¶å·²ç»è¢«åºŸå¼ƒæ‰äº†ï¼Œæ‰€ä»¥å¦‚æœä½ è¦å‡çº§é›†ç¾¤çš„è¯ï¼Œéœ€è¦æ³¨æ„ä¸‹ Corefile æ˜¯å¦éœ€è¦åšè°ƒæ•´ï¼›&lt;/li>
&lt;li>kubeadm çš„å†…æ ¸æ ¡éªŒè§„åˆ™æ”¹æˆäº†æ”¯æŒæ‰€æœ‰ 3.10+ çš„å†…æ ¸ï¼›&lt;/li>
&lt;/ul>
&lt;hr>
&lt;p>å¯ä»¥é€šè¿‡ä¸‹é¢äºŒç»´ç è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘ï¼Œåœ¨å…¬ä¼—å·åå°å›å¤ k8s å¯åŠ å…¥æŠ€æœ¯åœˆäº¤æµã€‚&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| cilium 1.6 å‘å¸ƒ 100% kube-proxy çš„æ›¿ä»£å“</title><link>https://moelove.info/2019/08/25/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-cilium-1.6-%E5%8F%91%E5%B8%83-100-kube-proxy-%E7%9A%84%E6%9B%BF%E4%BB%A3%E5%93%81/</link><guid isPermaLink="true">https://moelove.info/2019/08/25/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-cilium-1.6-%E5%8F%91%E5%B8%83-100-kube-proxy-%E7%9A%84%E6%9B%BF%E4%BB%A3%E5%93%81/</guid><pubDate>Sun, 25 Aug 2019 21:19:10 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="kindkubernetes-in-docker-v051-æ­£å¼å‘å¸ƒ">Kind(Kubernetes In Docker) v0.5.1 æ­£å¼å‘å¸ƒ&lt;/h2>
&lt;p>Kind(Kubernetes In Docker) å·²ç»å¹¿æ³›çš„åº”ç”¨äº Kubernetes ä¸Šæ¸¸åŠç›¸å…³é¡¹ç›®çš„ CI ç¯å¢ƒä¸­ï¼Œä½œä¸ºä¸ªäººæœ¬åœ°çš„æµ‹è¯•ç¯å¢ƒä¹Ÿå¾ˆæ–¹ä¾¿ï¼Œæ¨èå¤§å®¶å°è¯•ã€‚&lt;/p>
&lt;p>æœ¬æ¬¡å‘å¸ƒï¼Œå°†é»˜è®¤çš„ Kubernetes ç‰ˆæœ¬æ›´æ–°ä¸º v1.15.3 ï¼›æ”¯æŒäº† UDP å’Œ SCTP åè®®çš„ç«¯å£è½¬å‘ï¼›å¯¹æ„å»º Node é•œåƒè¿›è¡Œäº†ä¼˜åŒ–ï¼Œä½¿å®ƒæ›´å¿«ï¼›åŒæ—¶ä¹Ÿå¯¹ arm32 å¢åŠ äº†æœ‰é™çš„æ”¯æŒã€‚&lt;/p>
&lt;p>å¯¹ kind load-image è¿›è¡Œäº†æ”¹è¿›ï¼Œä»åŸå…ˆçš„åªæ˜¯åˆ¤æ–­é•œåƒåç§°å’Œ tag åˆ°ç°åœ¨å¢åŠ äº†å¯¹å“ˆå¸Œå€¼çš„æ ¡éªŒï¼›ä¿®æ­£äº†åœ¨ä½¿ç”¨ Proxy æ—¶ï¼Œéƒ¨åˆ†æœåŠ¡å¯èƒ½å—ä»£ç†å½±å“å¯¼è‡´çš„é—®é¢˜ï¼ˆå¯¹å›½å†…ç”¨æˆ·å‹å¥½ï¼‰ã€‚&lt;/p>
&lt;p>æ›´å¤šå…³äºæ­¤ç‰ˆæœ¬çš„å†…å®¹ï¼Œè¯·å‚è€ƒ &lt;a href="https://github.com/kubernetes-sigs/kind/releases">ReleaseNote&lt;/a>ï¼Œæ¬¢è¿ä½¿ç”¨å’Œåé¦ˆã€‚&lt;/p>
&lt;h2 id="kubernetes-å—-go-çš„-nethttp-å®‰å…¨æ¼æ´å½±å“">Kubernetes å— Go çš„ net/http å®‰å…¨æ¼æ´å½±å“&lt;/h2>
&lt;p>Kubernetes è¿‘æœŸç´§æ€¥å‘å¸ƒäº† v1.15.3, v1.14.6, v1.13.10 ç‰ˆæœ¬ï¼Œè·ç¦»ä¸Šä¸ªé›†ä½“æ›´æ–°å‘å¸ƒä»…è¿‡äº†ä¸¤å‘¨è€Œå·²ï¼Œä¸Šæ¬¡çš„è¯´æ˜è¯·å‚è€ƒ&lt;a href="https://zhuanlan.zhihu.com/p/77664404">ä¸¤å‘¨å‰çš„ k8s ç”Ÿæ€å‘¨æŠ¥&lt;/a>ï¼Œä¸è¿‡æœ¬æ¬¡çš„æ¼æ´çš„æ ¹æœ¬åŸå› ä¸åœ¨ Kubernetes çš„åŠŸèƒ½é€»è¾‘ä¸Šï¼Œè¿˜æ˜¯åœ¨äºå…¶ä½¿ç”¨çš„ Go è¯­è¨€çš„ &lt;code>net/http&lt;/code> åº“çš„å®‰å…¨æ¼æ´ CVE-2019-9512 å’Œ CVE-2019-9514 ã€‚&lt;/p>
&lt;p>å…³äºæ­¤æ¬¡æ¼æ´çš„ä¿¡æ¯ï¼Œå¯å‚è€ƒ &lt;a href="https://github.com/golang/go/issues/33606">golang/go#33606&lt;/a>ï¼Œå¦å¤– Go æœ€è¿‘é™†ç»­å‘å¸ƒäº†å‡ ä¸ªç‰ˆæœ¬ï¼Œå»ºè®®å¤§å®¶ä¹Ÿæœ€å¥½å‡åˆ° v1.12.9 ç‰ˆæœ¬ã€‚&lt;/p>
&lt;p>ä½œä¸ºæ ‡å‡†åº“æ¥è¯´ï¼Œå…¶å®å½±å“é¢è¿˜æ˜¯æ¯”è¾ƒå¤§çš„ï¼ŒK8S æœ€è¿‘ä¹Ÿæ˜¯ç›¸ç»§ä» 1.12.6 é™†ç»­å‡çº§åˆ°äº† 1.12.9 , å½“ç„¶ä¹ŸåŒ…æ‹¬ Docker å›¢é˜Ÿç­‰ï¼Œä¹Ÿéƒ½åšäº†ç›¸å…³çš„æ›´æ–°ã€‚&lt;/p>
&lt;p>æœ€åï¼Œè¿˜æ˜¯å»ºè®®å°½å¿«å‡çº§ã€‚&lt;/p>
&lt;h2 id="kubernetes-v1160-beta1-å‘å¸ƒ">Kubernetes v1.16.0-beta.1 å‘å¸ƒ&lt;/h2>
&lt;p>æœ¬æ¬¡çš„å¼€å‘è¿›åº¦åŸºæœ¬éƒ½æ˜¯æŒ‰ç…§é¢„æœŸè¿›è¡Œçš„ï¼Œæœ¬å‘¨å‘å¸ƒäº† v1.16.0-beta.1 ç‰ˆæœ¬ï¼Œç›¸ä¿¡å¾ˆå¿«å°±ä¼šå‘å¸ƒæ­£å¼ç‰ˆäº†ã€‚&lt;/p>
&lt;p>æœ¬æ¬¡çš„æ›´æ–°å†…å®¹æš‚ä¸å±•å¼€äº†ï¼Œæœ‰å…´è¶£çš„æœ‹å‹å¯ä»¥ç›´æ¥å‚çœ‹ &lt;a href="https://github.com/kubernetes/kubernetes/blob/master/CHANGELOG-1.16.md#changelog-since-v1160-alpha3">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="weaveworks-å‡ºå“çš„-flux-æˆä¸º-cncf-sandbox-é¡¹ç›®">weaveworks å‡ºå“çš„ Flux æˆä¸º CNCF sandbox é¡¹ç›®&lt;/h2>
&lt;p>Flux ä½œä¸º Kubernetes GitOps operator æˆåŠŸåŠ å…¥äº† CNCFã€‚&lt;/p>
&lt;p>å®ƒæœ€åˆæ˜¯ weaveworks å†…éƒ¨ä¸ºäº†åŠ é€Ÿå¼€å‘å·¥ä½œæµè€Œäº§ç”Ÿçš„ï¼Œä½†å‘å±•è‡³åæœŸï¼Œæ¯”è¾ƒç‹¬ç«‹äº†ï¼Œé¡¹ç›®è§„åˆ’ä¹Ÿæ¯”è¾ƒæˆç†Ÿäº†ï¼Œæ‰€ä»¥ç°åœ¨å°±æ‰˜ç®¡è‡³ CNCF äº†ã€‚&lt;/p>
&lt;p>Flux å¯ä»¥ç¡®ä¿é›†ç¾¤çš„é…ç½®ä¸ Git ä»“åº“ä¸­çš„å†…å®¹ç›¸ç¬¦ï¼ŒåŒæ—¶åˆå¯è‡ªåŠ¨åŒ–ä½ çš„éƒ¨ç½²ã€‚å…¶å®æ˜¯ä¸€ä¸ªå¾ˆä¸é”™çš„å·¥å…·é›†ï¼Œå› ä¸ºå®é™…ä¸Šå®ƒåŸºæœ¬èƒ½æ»¡è¶³å¤§å¤šæ•°äººçš„åº”ç”¨åœºæ™¯ã€‚&lt;/p>
&lt;p>&lt;img src="https://fluxcd.io/img/flux-cd-diagram.png" alt="flux cd - moelove.info">&lt;/p>
&lt;p>å…³äºæ­¤æ¬¡&lt;a href="https://www.weave.works/blog/flux-joins-the-cncf-sandbox">æˆä¸º CNCF sandbox é¡¹ç›®å®˜å®£æ–‡ç« è¯·æŸ¥çœ‹å…¶å®˜æ–¹åšå®¢&lt;/a>&lt;/p>
&lt;h2 id="cilium-16-å‘å¸ƒ-100-kube-proxy-çš„æ›¿ä»£å“">cilium 1.6 å‘å¸ƒ 100% kube-proxy çš„æ›¿ä»£å“&lt;/h2>
&lt;p>cilium 1.6 å‘å¸ƒï¼Œæœ¬æ¬¡æœ€å¤§çš„æ–°é—»æ˜¯å®ƒå®Œæˆäº†æœ€åçš„ä¸¤ä¸ªæ ¸å¿ƒéœ€æ±‚ï¼ŒæˆåŠŸçš„åœ¨ä½¿ç”¨ cilium æ—¶å¯ä»¥ä¸å†éœ€è¦ kube-proxy å³å®ƒå¯ 100% æ›¿æ¢ kube-proxy ã€‚&lt;/p>
&lt;p>è¿™é‡Œå…ˆå¯¹ cilium åšä¸ªåŸºæœ¬ä»‹ç»ï¼Œå®ƒæ˜¯ä¸€ä¸ªåŸºäº eBPF å®ç°çš„å¯ç”¨äºé€æ˜çš„æä¾›å’Œä¿æŠ¤ä½¿ç”¨ Kubernetes å’Œ Docker ç­‰å®¹å™¨ç®¡ç†å¹³å°éƒ¨ç½²çš„åº”ç”¨ç¨‹åºæœåŠ¡ä¹‹é—´çš„ç½‘ç»œå’Œ API è¿æ¥ã€‚&lt;/p>
&lt;p>è¯´çš„æ¯”è¾ƒç»•å£ï¼Œè¯´ç›´ç™½ç‚¹å°±æ˜¯åŸºäº eBPF çš„ä¸€ä¸ªæ€§èƒ½è¶…å‰å®³çš„ç½‘ç»œç»„ä»¶ã€‚è‡³äºå®ƒå…·å¤‡çš„èƒ½åŠ›ä¸‹é¢è¿™å¼ å›¾è¿˜æ˜¯æ¯”è¾ƒæ˜ç™½çš„ï¼Œæœ‰å…´è¶£ç ”ç©¶çš„æœ‹å‹ä»¬æ¨èçœ‹å®ƒçš„å®˜æ–¹æ–‡æ¡£ã€‚&lt;/p>
&lt;p>&lt;img src="https://camo.githubusercontent.com/ba490f8f5ef1241512f8cb7d30dc6f9d4a56e33e/68747470733a2f2f63646e2e7261776769742e636f6d2f63696c69756d2f63696c69756d2f6d61737465722f446f63756d656e746174696f6e2f696d616765732f63696c69756d2d617263682e706e67" alt="cilium - moelove.info">&lt;/p>
&lt;p>kube-proxy ä½œä¸º Kubernetes é›†ç¾¤ä¸­çš„ä¸€ä¸ªé‡è¦ç»„ä»¶ï¼Œå®ƒçš„æ€§èƒ½é—®é¢˜ç»å¸¸è¢«äººæ‹¿å‡ºæ¥è¯´ã€‚å…¶å®å®ƒçš„æ€§èƒ½å¯¹å¤šæ•°å…¬å¸/åœºæ™¯ä¸‹ä¹Ÿè¡¨ç°æŒºå¥½äº†ï¼Œä½†è¿½æ±‚æè‡´æ‰æ˜¯å‰è¿›çš„åŠ¨åŠ›å˜›ã€‚ç°åœ¨ cilium å‘å¸ƒ 1.6 ç‰ˆæœ¬ï¼Œæœ€å¤§çš„æ–°é—»å°±æ˜¯å¯ä»¥ 100% æ›¿æ¢ kube-proxy äº†ï¼Œæ€§èƒ½æµ‹è¯•å¦‚ä¸‹å›¾ï¼š&lt;/p>
&lt;p>&lt;img src="https://cilium.io/static/k8s-service-benchmark-81bd650b0c6e51860472f409e3c03d37-84ad3.png" alt="cilium performance - moelove.info">&lt;/p>
&lt;p>è¿™é‡Œç¨å¾®è¯´å‡ å¥æˆ‘å…³äº cilium çš„çœ‹æ³•ï¼š&lt;/p>
&lt;ul>
&lt;li>å‰ä¸å‰å®³ï¼Ÿå‰å®³ã€‚&lt;/li>
&lt;li>å€¼ä¸å€¼å¾—ç ”ç©¶ï¼Ÿå€¼å¾—ã€‚&lt;/li>
&lt;li>ä¼šä¸ä¼šæ”¾åˆ°è‡ªå·±çš„é›†ç¾¤æ›¿ä»£ kube-proxy ï¼Ÿä¸ä¼šï¼Œæœ€èµ·ç ç›®å‰ä¸ä¼šã€‚&lt;/li>
&lt;/ul>
&lt;p>å¦‚æœä½ æƒ³è¦é€šè¿‡ cilium ç ”ç©¶ eBPF æˆ–è€… XDP æˆ‘å€’æ˜¯å»ºè®®ä½ å¯ä»¥çœ‹çœ‹ï¼Œæ˜¯ä¸ªå¾ˆä¸é”™çš„é¡¹ç›®ï¼Œè€Œä¸”é€šè¿‡è¿™ä¸ªé¡¹ç›®èƒ½åŠ æ·±å¾ˆå¤šç½‘ç»œæ–¹é¢çš„è®¤è¯†ã€‚è¿™ä¹ˆè¯´å§ï¼Œå¦‚æœæŠŠ cilium çš„æºç åŠæ‰€æ¶‰åŠåŸç†éƒ½ç ”ç©¶é€šé€äº†ï¼Œé‚£å°±å¾ˆå‰å®³äº†ã€‚&lt;/p>
&lt;p>è‡³äºè¦ä¸è¦æ›¿æ¢ kube-proxy åœ¨æˆ‘çœ‹æ¥ï¼Œæœ€èµ·ç ç›®å‰æˆ‘ä¸ä¼šè¿™æ ·å»åšã€‚è§£å†³é—®é¢˜çš„åŠæ³•æœ‰å¾ˆå¤šç§ï¼Œè€Œæ›¿æ¢æ‰ä¸€ä¸ªæ ¸å¿ƒç»„ä»¶ï¼Œå´ä¸ä¸€å®šæ˜¯ä¸€ä¸ªæœ€å€¼å¾—çš„é€‰æ‹©ã€‚&lt;/p>
&lt;p>å…³äºæ­¤æ¬¡çš„æ€§èƒ½æµ‹è¯•ï¼Œè¯·å‚è€ƒå…¶&lt;a href="https://cilium.io/blog/2019/08/20/cilium-16/">å®˜æ–¹åšå®¢&lt;/a>&lt;/p>
&lt;hr>
&lt;p>å¯ä»¥é€šè¿‡ä¸‹é¢äºŒç»´ç è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘ï¼Œåœ¨å…¬ä¼—å·åå°å›å¤ k8s å¯åŠ å…¥æŠ€æœ¯åœˆäº¤æµã€‚&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| 2019-08-12~2019-08-18</title><link>https://moelove.info/2019/08/19/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-2019-08-12~2019-08-18/</link><guid isPermaLink="true">https://moelove.info/2019/08/19/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-2019-08-12~2019-08-18/</guid><pubDate>Mon, 19 Aug 2019 01:08:00 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="rkt-é¡¹ç›®æ­£å¼è¢«-cncf-å½’æ¡£">rkt é¡¹ç›®æ­£å¼è¢« CNCF å½’æ¡£&lt;/h2>
&lt;p>8 æœˆ 16 æ—¥ï¼ŒCNCF å®£å¸ƒæŠ€æœ¯å§”å‘˜ä¼šå·²ç»æŠ•ç¥¨é€šè¿‡å°† &lt;code>rkt&lt;/code> é¡¹ç›®å½’æ¡£ã€‚&lt;/p>
&lt;p>è¿™ä¸ªäº‹æƒ…ï¼Œæˆ‘åœ¨å‡ å‘¨å‰çš„å‘¨æŠ¥å¤§æ¦‚ä»‹ç»è¿‡ï¼Œæ—¢ç„¶ç°åœ¨å·²ç»å°˜åŸƒè½å®šï¼Œä¸å¦‚ä¸€èµ·æ¥çœ‹çœ‹ &lt;code>rkt&lt;/code> çš„å‰ä¸–ä»Šç”Ÿï¼Œæ¯•ç«Ÿå®ƒåœ¨å®¹å™¨æŠ€æœ¯çš„å‘å±•ä¸­ä¹Ÿæ›¾åšå‡ºäº†å¾ˆå¤šè´¡çŒ®ã€‚&lt;/p>
&lt;p>&lt;code>rkt&lt;/code> æœ€æ—©æ˜¯ç”± CoreOS å…¬å¸åˆ›å»ºçš„ï¼Œè€Œ CoreOS æœ€æ—©åº”è¯¥ä¹Ÿç®—æ˜¯ Docker çš„ç”¨æˆ·ä¹‹ä¸€ã€‚ä½†æ˜¯éšç€ Docker å‘å±•çš„æ—¥è¶‹å£®å¤§ï¼ŒCoreOS å°±æƒ³è¦è„±ç¦» Dockerï¼Œæˆç«‹è‡ªå·±çš„æ ‡å‡†ã€‚&lt;/p>
&lt;p>ä¹‹å CoreOS å‘å¸ƒäº† AppC è§„èŒƒï¼ˆè¿™ä¸ªè§„èŒƒæˆ‘ä¹Ÿæ›¾ä»”ç»†ç ”ç©¶è¿‡ï¼‰ï¼Œè€Œ CoreOS ä¸»æ‰“çš„æ——å·æ˜¯å¼€æ”¾ï¼Œæ¯•ç«Ÿå½“æ—¶ Docker ä¸€æç‹¬ç§€ï¼Œæ‰€ä»¥ä¹Ÿå°±å¸å¼•äº†ä¸å°‘çš„ä¼™ä¼´å‚ä¸ã€‚å½“ç„¶ &lt;code>rkt&lt;/code> ä¹Ÿå°±å€Ÿç€è¿™è‚¡é£ï¼Œå¾—åˆ°äº†ä¸å°‘äººçš„é’çã€‚&lt;/p>
&lt;p>è¿™é‡Œä¸”ä¸è¯´ &lt;code>rkt&lt;/code> åŠŸèƒ½æˆ–æ˜¯è§„èŒƒå¦‚ä½•ï¼Œæˆ‘ä»¬å•ç‹¬æ¥çœ‹çœ‹é‚£åœºå®¹å™¨å¸‚åœºä»½é¢çš„äº‰å¤ºæˆ˜æ˜¯å¦‚ä½•æ‰“çš„ã€‚&lt;/p>
&lt;p>åœ¨é‚£æ—¶å€™ï¼ŒåŒæ—¶è¿›è¡Œçš„å¦å¤–ä¸€åœºæˆ˜å½¹æ˜¯å®¹å™¨ç¼–æ’ç³»ç»Ÿçš„æˆ˜å½¹ã€‚æ‰€ä»¥ &lt;code>rkt&lt;/code> ä¹Ÿç®—æ˜¯åšäº†åŠªåŠ›ï¼Œå®ƒé€‰æ‹©äº†ä¸ Kubernetes çš„åˆä½œï¼ˆå¤§æ¦‚ç®—æ˜¯å…±åŒé˜µè¥çš„åˆä½œå§ï¼‰ï¼Œæ‰€ä»¥åœ¨ 2016 å¹´ Kubernetes 1.3 ç‰ˆæœ¬ä¸­ï¼Œå®£å¸ƒäº†æ”¯æŒ &lt;code>rkt&lt;/code> ä½œä¸ºå®¹å™¨è¿è¡Œæ—¶çš„ä¸€ä¸ªå¯é€‰æƒ³ã€‚&lt;/p>
&lt;p>ä½† Docker çš„å‘å±•ï¼ˆæŒ‡ Docker é¡¹ç›®ï¼‰ï¼Œå´å‡ ä¹æ²¡æœ‰å—åˆ°å½±å“ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ Docker æ—©å·²å‡­å€Ÿè‡ªèº«çš„ç¨³å®šæ€§å’Œæ˜“ç”¨æ€§å é¢†äº†å¤§æ‰¹çš„ç”¨æˆ·ï¼Œå³ä½¿æœ‰ç”¨æˆ·é€‰æ‹© &lt;code>rkt&lt;/code> å¤§å¤šä¹Ÿåªæ˜¯ç”¨äºå°è¯•ï¼ˆå¿ƒç–¼é€‰æ‹© &lt;code>rkt&lt;/code> æ”¾å…¥ç”Ÿäº§ç¯å¢ƒä¸­çš„é‚£æ‰¹ï¼‰ã€‚è€Œä¸”ä¸å¾—ä¸è¯´ï¼ŒDocker åœ¨ç”¨æˆ·å¿ƒä¸­å‡ ä¹æ˜¯å®¹å™¨çš„ä»£åè¯ï¼Œæ˜¯ä¸€ä¸ªé»˜è®¤é€‰é¡¹ã€‚&lt;/p>
&lt;p>æ‰€ä»¥å¾ˆè‡ªç„¶çš„ &lt;code>rkt&lt;/code> åœ¨æ­¤æˆ˜å½¹ä¸­å¤±è´¥ï¼Œä¹‹å Kubernetes ä¹ŸæŠ›å¼ƒäº†å¯¹ rkt çš„æ”¯æŒã€‚ å¦å¤–ï¼ŒCoreOS å…¬å¸çš„å‘å±•å¯èƒ½å¯¹é€ æˆ &lt;code>rkt&lt;/code> çš„ç°çŠ¶ä¹Ÿæœ‰å¾ˆå¤§çš„å…³ç³»ã€‚&lt;/p>
&lt;p>æœ€åï¼Œæœ€å…³é”®çš„å…¶å®è¿˜æ˜¯å› ä¸ºé¡¹ç›®å­˜æ´»ç‡ï¼Œæˆ‘ä»¬æ¥ç”¨æ•°æ®è¯´è¯ï¼š&lt;/p>
&lt;p>&lt;img src="https://moelove.info/img/rkt-health.png" alt="rkt é¡¹ç›®å¥åº·å€¼">&lt;/p>
&lt;p>å…³äºäº‹æƒ…çš„å®˜æ–¹æŠ¥é“æ˜¯ï¼š&lt;a href="https://www.cncf.io/blog/2019/08/16/cncf-archives-the-rkt-project/">CNCF Archives the rkt Project&lt;/a>&lt;/p>
&lt;h2 id="cni-plugins-v082-å‘å¸ƒ">CNI Plugins v0.8.2 å‘å¸ƒ&lt;/h2>
&lt;p>æ˜¯ä¸€ä¸ª bugfix çš„ç‰ˆæœ¬ï¼Œä½†æ˜¯è¦æ³¨æ„çš„æ˜¯è¿™ä¸ªç‰ˆæœ¬ä¸­åŒ…å«äº†ä¸€ä¸ªé”™è¯¯ä¿®å¤ #366 , å½“åœ¨èŠ‚ç‚¹å¯åŠ¨æ—¶ï¼ŒåŒæ—¶è¿è¡Œå¤šä¸ª Pod ï¼Œ&lt;code>cni0&lt;/code> ç½‘æ¡¥å°†è¢«å¤šä¸ª &lt;code>goroutine&lt;/code> åˆ›å»ºï¼Œè¿™å°±æœ‰å¯èƒ½å¼•èµ·ä¸€ä¸ªé”™è¯¯ &lt;code>failed to set bridge addr: could not add IP address to \&amp;quot;cni0\&amp;quot;: file exists.&lt;/code>&lt;/p>
&lt;p>å…³äºæ­¤ç‰ˆæœ¬çš„æ›´å¤šç»†èŠ‚è¯·æŸ¥çœ‹ &lt;a href="https://github.com/containernetworking/plugins/releases/tag/v0.8.2">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="istio-124-å‘å¸ƒå¤§é‡å®‰å…¨æ›´æ–°">Istio 1.2.4 å‘å¸ƒï¼Œå¤§é‡å®‰å…¨æ›´æ–°&lt;/h2>
&lt;p>&lt;strong>è¿™ä¸ªç‰ˆæœ¬ä¸­æœ‰å¤§é‡çš„å®‰å…¨æ›´æ–°ï¼Œå»ºè®®å°½å¿«å‡çº§ã€‚&lt;/strong>&lt;/p>
&lt;p>æˆ‘ä»¬æ¥çœ‹çœ‹æ¼æ´çš„å½±å“ï¼Œä¸»è¦æ˜¯ CVE-2019-14993ï¼Œ CVE-2019-9512ï¼ŒCVE-2019-9513ï¼ŒCVE-2019-9515ï¼ŒCVE-2019-9518 è¿™äº›æ¼æ´ä¸»è¦æ˜¯å¯èƒ½è¢«ç”¨æ¥åš DoS æ”»å‡»ã€‚å½“ç„¶åŸé—®é¢˜æ˜¯åœ¨ &lt;a href="https://github.com/envoyproxy/envoy/issues/7728">Envoy ä¸Š&lt;/a> çš„ã€‚&lt;/p>
&lt;p>å…³äºæ­¤ç‰ˆæœ¬çš„æ›´å¤šå†…å®¹è¯·å‚è€ƒ &lt;a href="https://istio.io/about/notes/1.2.4/">ReleaseNote&lt;/a>&lt;/p>
&lt;hr>
&lt;p>å¯ä»¥é€šè¿‡ä¸‹é¢äºŒç»´ç è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘ï¼Œåœ¨å…¬ä¼—å·åå°å›å¤ k8s å¯åŠ å…¥æŠ€æœ¯åœˆäº¤æµã€‚&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>Kubernetes 1.15 æ–°ç‰¹æ€§è§£è¯»</title><link>https://moelove.info/2019/08/13/Kubernetes-1.15-%E6%96%B0%E7%89%B9%E6%80%A7%E8%A7%A3%E8%AF%BB/</link><guid isPermaLink="true">https://moelove.info/2019/08/13/Kubernetes-1.15-%E6%96%B0%E7%89%B9%E6%80%A7%E8%A7%A3%E8%AF%BB/</guid><pubDate>Tue, 13 Aug 2019 06:22:13 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>k8s v1.15 äº 2019 å¹´ 6 æœˆ 19 æ—¥æ­£å¼å‘å¸ƒï¼Œè¿™ä¸ªç‰ˆæœ¬ä¸­åŒ…å«äº† 25 ä¸ªç‰¹æ€§å˜æ›´ï¼šå…¶ä¸­ 2 ä¸ªæˆä¸º stable ï¼Œ13 ä¸ªå¤„äº beta ä»¥åŠ 10 ä¸ªå¤„äº alpha é˜¶æ®µã€‚&lt;/p>
&lt;p>è¿™ä¸ªç‰ˆæœ¬æ‰€å›´ç»•çš„ä¸»é¢˜æ˜¯æé«˜ç¨³å®šæ€§å’Œå¯æ‰©å±•æ€§ã€‚æ‰€ä»¥æ­¤ç‰ˆæœ¬ä¸­ CRD ç›¸å…³çš„å˜æ›´æ¯”è¾ƒå¤šã€‚&lt;/p>
&lt;p>æœ¬æ–‡å°†å›´ç»• Kubernetes 1.15 çš„æ–°ç‰¹æ€§è¿›è¡Œå±•å¼€ï¼Œé›†ä¸­åœ¨ CRD å’Œ kubeadm ä¹‹ä¸Šã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="customresourcedefinition-crd-çš„åŸºæœ¬ä»‹ç»">CustomResourceDefinition (CRD) çš„åŸºæœ¬ä»‹ç»&lt;/h2>
&lt;h2 id="ç¯å¢ƒå‡†å¤‡">ç¯å¢ƒå‡†å¤‡&lt;/h2>
&lt;p>æˆ‘ä»¬ä½¿ç”¨ &lt;a href="https://kind.sigs.k8s.io">&lt;code>kind&lt;/code>&lt;/a> åˆ›å»ºæˆ‘ä»¬æ‰€éœ€çš„ Kubernetes 1.15 çš„ç¯å¢ƒã€‚&lt;/p>
&lt;pre>&lt;code>(MoeLove) âœ ~ kind create cluster --image kindest/node:v1.15.0 --name 115
Creating cluster &amp;quot;115&amp;quot; ...
âœ“ Ensuring node image (kindest/node:v1.15.0) ğŸ–¼
âœ“ Preparing nodes ğŸ“¦
âœ“ Creating kubeadm config ğŸ“œ
âœ“ Starting control-plane ğŸ•¹ï¸
âœ“ Installing CNI ğŸ”Œ
âœ“ Installing StorageClass ğŸ’¾
Cluster creation complete. You can now use the cluster with:
export KUBECONFIG=&amp;quot;$(kind get kubeconfig-path --name=&amp;quot;115&amp;quot;)&amp;quot;
kubectl cluster-info
(MoeLove) âœ ~ export KUBECONFIG=&amp;quot;$(kind get kubeconfig-path --name=&amp;quot;115&amp;quot;)&amp;quot;
(MoeLove) âœ ~ kubectl get nodes
NAME STATUS ROLES AGE VERSION
115-control-plane Ready master 41s v1.15.0
&lt;/code>&lt;/pre>&lt;p>æ¥ä¸‹æ¥éƒ¨ç½²æˆ‘ä»¬çš„ CRDï¼Œå…³äº CRD çš„å¼€å‘ç›¸å…³çŸ¥è¯†ä¸æ˜¯æœ¬æ–‡çš„é‡ç‚¹ï¼Œæš‚ä¸”å¿½ç•¥ï¼Œæœ‰å…´è¶£çš„æœ‹å‹å¯ä»¥çœ‹çœ‹å®˜æ–¹æ–‡æ¡£çš„ä»‹ç»ã€‚&lt;/p>
&lt;pre>&lt;code>(MoeLove) âœ ~ kubectl get crd -o name
customresourcedefinition.apiextensions.k8s.io/hobbies.moe.moelove.info
(MoeLove) âœ ~ kubectl get hobby
NAME AGE
music 44s
&lt;/code>&lt;/pre>&lt;p>å¯ä»¥çœ‹åˆ°å·²ç»éƒ¨ç½²æˆåŠŸäº†ã€‚æ—¢ç„¶ç¯å¢ƒå·²ç»å‡†å¤‡å°±ç»ªï¼Œæˆ‘ä»¬å›åˆ°æœ¬æ–‡çš„é‡ç‚¹æ¥çœ‹çœ‹ Kubernetes 1.15 ä¸­æˆ‘ä»¬æ‰€éœ€è¦å…³æ³¨çš„æ ¸å¿ƒç‰¹æ€§ã€‚&lt;/p>
&lt;h2 id="beta-customresourcedefinition-webhook-conversion">beta: CustomResourceDefinition Webhook Conversion&lt;/h2>
&lt;p>CRD API å½“ä¸­æœ‰ä¸ª &lt;code>versions&lt;/code> å­—æ®µï¼Œå¯ä»¥ç”¨æ¥é…ç½® CR çš„ç‰ˆæœ¬ï¼Œå¹¶ä¸” Kubernetes å…è®¸æˆ‘ä»¬æœ‰å¤šä¸ªç‰ˆæœ¬çš„ CR å­˜åœ¨ã€‚é€šè¿‡ kubectl å¯ä»¥è¿›è¡ŒæŸ¥çœ‹&lt;/p>
&lt;pre>&lt;code># ç¯‡å¹…åŸå› ï¼Œçœç•¥äº†æ— å…³è¾“å‡º
(MoeLove) âœ ~ kubectl get crd hobbies.moe.moelove.info -o yaml
...
version: v1alpha1
versions:
- name: v1alpha1
served: true
storage: true
- name: v1beta1
served: true
storage: false
...
&lt;/code>&lt;/pre>&lt;p>æ³¨æ„ä½ ä¼šçœ‹åˆ°è¿™é‡Œæœ‰ &lt;code>version&lt;/code> å­—æ®µå’Œ &lt;code>versions&lt;/code> å­—æ®µï¼Œä¸è¿‡ &lt;code>version&lt;/code> å­—æ®µå·²è¿‡æœŸï¼Œå¹¶ä¸”æ˜¯å¯é€‰çš„ï¼Œå¦‚æœè¯¥å­—æ®µä¸ä¸ºç©ºï¼Œåˆ™å®ƒåº”è¯¥ä¸ &lt;code>versions&lt;/code> ä¸­çš„ç¬¬ä¸€ä¸ªé¡¹åŒ¹é…ã€‚&lt;/p>
&lt;p>Kubernetes æä¾›äº†ä¸€ä¸ª CRD è½¬æ¢çš„æœºåˆ¶ï¼Œå¯å…è®¸æˆ‘ä»¬åœ¨å¤šä¸ªä¸åŒçš„ç‰ˆæœ¬ä¹‹é—´è¿›è¡Œè½¬æ¢ã€‚å½“ç„¶ï¼Œè¿™ä¸ªè½¬æ¢å¯ä»¥æ ¹æ®ä½ å…·ä½“çš„é…ç½®è¿›è¡Œè½¬æ¢ã€‚æ¯”å¦‚è®¾ç½®ä¸º &lt;code>None&lt;/code> æ¨¡å¼çš„è¯ï¼Œåˆ™åªæ˜¯é’ˆå¯¹äº API ç‰ˆæœ¬çš„è½¬æ¢ï¼Œå¹¶ä¸ä¼šéšæ„å˜æ›´èµ„æºä¸­çš„å…¶ä»–å†…å®¹ã€‚&lt;/p>
&lt;p>è¿™é‡Œè¿˜æä¾›äº†ä¸€ç§ä½¿ç”¨ Webhook çš„æ–¹å¼ï¼Œå…è®¸ä½ è¿›è¡Œæ›´å¤šçµæ´»çš„è½¬æ¢è§„åˆ™ã€‚ä¸»è¦å°† &lt;code>conversion&lt;/code> å­—æ®µé…ç½®ä¸º &lt;code>Webhook&lt;/code>ã€‚&lt;/p>
&lt;p>å…·ä½“çš„å®ç°å¯ä»¥å‚è€ƒ &lt;a href="https://github.com/kubernetes/kubernetes/tree/v1.15.0/test/images/crd-conversion-webhook">å®˜æ–¹ä»£ç åº“ä¸­ç”¨äº Kubernetes e2e æµ‹è¯•çš„ webhook server&lt;/a> è¿™é‡Œå°±ä¸å†è¿›è¡Œå±•å¼€äº†ã€‚&lt;/p>
&lt;h2 id="beta-customresourcedefinition-openapi-publishing">beta: CustomResourceDefinition OpenAPI Publishing&lt;/h2>
&lt;p>å¦ä¸€ä¸ªå˜åŒ–åœ¨äº Kubernetes å¯ä¸º CRD å‘å¸ƒ OpenAPIï¼Œå…·ä½“çš„ææ¡ˆå¯ä»¥æŸ¥çœ‹ &lt;a href="https://github.com/kubernetes/enhancements/blob/master/keps/sig-api-machinery/00xx-publish-crd-openapi.md">publish-crd-openapi&lt;/a> ã€‚&lt;/p>
&lt;p>é‚£å®ƒçš„æ„ä¹‰æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ é€šè¿‡å‘å¸ƒ OpenAPI å¯ä»¥å¾ˆæ–¹ä¾¿çš„æ”¯æŒå®¢æˆ·ç«¯ä¾§çš„éªŒè¯ï¼Œæ¨¡å¼è¯´æ˜ä¹‹ç±»çš„ã€‚&lt;/p>
&lt;p>æ¯”å¦‚è¯´ï¼Œå¦‚æœä½ è¦ &lt;code>kubectl apply&lt;/code> ä¸€ä¸ª CRD çš„ YAML ï¼Œåœ¨å·²ç»å‘å¸ƒ OpenAPI çš„æƒ…å†µä¸‹ï¼Œå®¢æˆ·ç«¯ä¾§å¯ä»¥å¾ˆæ–¹ä¾¿çš„è¿›è¡ŒéªŒè¯ï¼Œå…·å¤‡æ‰æœªåŒ…å«æˆ–è€…æœªé€šè¿‡éªŒè¯çš„åœ¨ CRD ä¸­çš„å­—æ®µã€‚&lt;/p>
&lt;p>è¿˜æœ‰ä¾¿æ˜¯é€šè¿‡æ­¤é¡¹åŠŸèƒ½ï¼Œä¹Ÿå¯ä»¥è®©&lt;code>kubectl explain&lt;/code> æ”¯æŒ CRDï¼š&lt;/p>
&lt;pre>&lt;code>(MoeLove) âœ ~ kubectl explain hobbies.moe.moelove.info
KIND: Hobby
VERSION: moe.moelove.info/v1beta1
DESCRIPTION:
&amp;lt;empty&amp;gt;
&lt;/code>&lt;/pre>&lt;p>è®©æˆ‘ä»¬å¾—åˆ°ä¸€ç§ç±»ä¼¼åŸç”Ÿèµ„æºçš„ä½“éªŒã€‚&lt;/p>
&lt;h2 id="beta-customresourcedefinitions-pruning-å’Œ-alpha-customresourcedefinition-defaulting">beta: CustomResourceDefinitions Pruning å’Œ alpha: CustomResourceDefinition Defaulting&lt;/h2>
&lt;p>å¦å¤–è¿™ä¸¤ä¸ªç‰¹æ€§ï¼Œä¸»è¦éƒ½æ˜¯å¯¹äºç»“æ„åŒ–çš„ CRD æ¥è®²çš„ï¼Œå¯ä»¥é€šè¿‡é…ç½®è®¾ç½®é»˜è®¤å€¼ï¼Œæˆ–è€…æ˜¯è‡ªåŠ¨æ¸…ç†æ‰æœªåŒ…å«åœ¨ CRD ç»“æ„ä¸­çš„å­—æ®µã€‚&lt;/p>
&lt;p>è¿™ä¸¤ä¸ªç‰¹æ€§ä¹Ÿå°±ä¸é¢å¤–å±•å¼€äº†ã€‚&lt;/p>
&lt;h2 id="kubeadm-é›†ç¾¤ç”Ÿå‘½å‘¨æœŸçš„ç¨³å®šæ€§å’Œå¯ç”¨æ€§çš„æ”¹è¿›">kubeadm: é›†ç¾¤ç”Ÿå‘½å‘¨æœŸçš„ç¨³å®šæ€§å’Œå¯ç”¨æ€§çš„æ”¹è¿›&lt;/h2>
&lt;p>kubeadm æ˜¯ä¸€ä¸ªå¾ˆæ–¹ä¾¿çš„é›†ç¾¤éƒ¨ç½²ï¼Œç®¡ç†å’Œå‡çº§çš„å·¥å…·ï¼Œä¹ŸåŒæ—¶ä¸Šæ¸¸ç¤¾åŒºä¹Ÿæœ‰åºå¤§çš„ç»´æŠ¤å›¢é˜Ÿè‡´åŠ›äºå°† kubeadm å˜å¾—æ›´åŠ ç¨³å®šå’Œæ˜“ç”¨ã€‚&lt;/p>
&lt;p>å¯¹ä½¿ç”¨ kubeadm éƒ¨ç½²çš„é›†ç¾¤è€Œè¨€ï¼Œè¯ä¹¦ç®¡ç†ç®—æ˜¯ä¹‹å‰çš„ä¸€ä¸ªçŸ­æ¿ã€‚è€Œåœ¨ 1.15 ä¸­ï¼Œkubeadm å¯ä»¥æ— ç¼çš„å¯¹è¯ä¹¦è¿›è¡Œéœ€æ±‚ã€‚è¿™ä¼šå¤§å¤§æ–¹ä¾¿æ‰€æœ‰ä½¿ç”¨ kubeadm éƒ¨ç½²é›†ç¾¤çš„ç»´æŠ¤è€…ã€‚&lt;/p>
&lt;p>å¦å¤–ï¼Œåœ¨æ­¤ç‰ˆæœ¬ä¸­ kubeadm åœ¨ HA é›†ç¾¤çš„éƒ¨ç½²ä¸Šä¹Ÿåšäº†å¾ˆå¤šæ”¹è¿›ã€‚æ¯”å¦‚ç°åœ¨ä½ å¯ä»¥é€šè¿‡ &lt;code>kubeadm join --control-plane&lt;/code> æ¥åŠ å…¥å…¶ä»–æ§åˆ¶é¢çš„èŠ‚ç‚¹ï¼Œå¹¶ä¸”ä» 1.15 å¼€å§‹å…è®¸å¹¶è¡ŒåŠ å…¥å¤šä¸ªæ§åˆ¶é¢èŠ‚ç‚¹ã€‚&lt;/p>
&lt;p>kubeadm ä¸ºäº†èƒ½æå‡å…¶ç¨³å®šæ€§ï¼ŒåŸºäº &lt;a href="https://kind.sigs.k8s.io">kind&lt;/a> å¼€å‘äº†ä¸€å¥—æµ‹è¯•ç»„ä»¶ï¼Œå¯æå¤§çš„åœ¨æµ‹è¯•è¿‡ç¨‹ä¸­æ¨¡æ‹ŸçœŸå®é›†ç¾¤çš„æƒ…å†µã€‚ï¼ˆKind æ˜¯é€šè¿‡ CNCF Kubernetes ä¸€è‡´æ€§è®¤è¯çš„å®‰è£…å·¥å…·ï¼‰&lt;/p>
&lt;h2 id="æ€»ç»“">æ€»ç»“&lt;/h2>
&lt;p>ä»¥ä¸Šå†…å®¹ä¾¿æ˜¯ Kubernetes 1.15 ä¸­æ¯”è¾ƒå…³é”®çš„ä¸€äº›ä¿¡æ¯äº†ã€‚ åœ¨ kubernetes 1.16 ä¸­ï¼Œ CRD API å°†è¾¾åˆ° GA çº§åˆ«ã€‚è¿™ä¹Ÿæ˜¯ Kubernetes çš„ä¸€ä¸ªé‡è¦å‘å±•æ–¹å‘ã€‚&lt;/p>
&lt;hr>
&lt;p>æ¬¢è¿è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://gitee.com/tlrr/awesome/raw/master/2020-9-9/1599632564572-mp-qrcode.png" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category><category domain="https://moelove.info/tags/kubeadm/">kubeadm</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| 2019-08-05~2019-08-11</title><link>https://moelove.info/2019/08/12/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-2019-08-05~2019-08-11/</link><guid isPermaLink="true">https://moelove.info/2019/08/12/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-2019-08-05~2019-08-11/</guid><pubDate>Mon, 12 Aug 2019 07:14:40 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="kubernetes-ä¸¤ä¸ªé‡è¦æ¼æ´ä¿®å¤">Kubernetes ä¸¤ä¸ªé‡è¦æ¼æ´ä¿®å¤&lt;/h2>
&lt;p>æœ€è¿‘ Kubernetes å‘å¸ƒäº† 1.13.9, 1.14.5, å’Œ 1.15.2 ç‰ˆæœ¬ï¼Œæ—¨åœ¨ä¿®å¤ä¸¤ä¸ªé‡è¦æ¼æ´å¯¹ Kubernetes å¸¦æ¥çš„å½±å“ï¼Œ &lt;strong>å¼ºçƒˆå»ºè®®å°†é›†ç¾¤åŠ kubectl è¿›è¡Œå‡çº§&lt;/strong>&lt;/p>
&lt;p>&lt;strong>CVE-2019-11247&lt;/strong> ç®€å•æ¥è¯´å…¶å½±å“å°±æ˜¯å¯ä»¥è®¿é—®å•ä¸ªå‘½åç©ºé—´ä¸­çš„è‡ªå®šä¹‰èµ„æºçš„ç”¨æˆ·å¯ä»¥è®¿é—®å…·æœ‰é›†ç¾¤èŒƒå›´çš„è‡ªå®šä¹‰èµ„æºã€‚å½“ç„¶ï¼Œè¿™é‡Œçš„ä¿®æ­£ä¸»è¦æ˜¯ &lt;strong>é’ˆå¯¹ CRD&lt;/strong> ã€‚æ ¸å¿ƒçš„ä¿®æ­£ä»£ç å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-go" data-lang="go"> &lt;span class="kd">var&lt;/span> &lt;span class="nx">possiblyAcrossAllNamespacesVerbs&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">sets&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">NewString&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;list&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;watch&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="nx">namespacedCRD&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">namespacedReq&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">crd&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Spec&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Scope&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="nx">apiextensions&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">NamespaceScoped&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nb">len&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">requestInfo&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Namespace&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">&amp;gt;&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="p">!&lt;/span>&lt;span class="nx">namespacedCRD&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="nx">namespacedReq&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">r&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">delegate&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">ServeHTTP&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">w&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">req&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">return&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">namespacedCRD&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="p">!&lt;/span>&lt;span class="nx">namespacedReq&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="p">!&lt;/span>&lt;span class="nx">possiblyAcrossAllNamespacesVerbs&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Has&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">requestInfo&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Verb&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">r&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">delegate&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">ServeHTTP&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">w&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">req&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">return&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>å½“æœªé€šè¿‡æ£€æŸ¥æ—¶ï¼Œdelegate å°†ä¼šè§¦å‘ä¸€ä¸ª 404 ã€‚å¯¹æ­¤é—®é¢˜æ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥æŸ¥çœ‹ &lt;a href="https://github.com/kubernetes/kubernetes/issues/80983">#80983&lt;/a> ã€‚&lt;/p>
&lt;p>&lt;strong>CVE-2019-11249&lt;/strong> åˆ™æ˜¯å¯¹äºä¹‹å‰æš´å‡ºæ¥çš„ä½¿ç”¨ &lt;code>kubectl cp&lt;/code> å¯è¿›è¡Œæ¶æ„ç›®å½•æµè§ˆçš„æ¼æ´ CVE-2019-1002101 å’Œ CVE-2019-11246 çš„ä¸å®Œæ•´ä¿®å¤ã€‚æœ‰å…´è¶£å¯ä»¥å‚è€ƒ &lt;a href="https://github.com/kubernetes/kubernetes/pull/80436">#80436&lt;/a> ã€‚&lt;/p>
&lt;h2 id="coredns-v161-å‘å¸ƒ">CoreDNS v1.6.1 å‘å¸ƒ&lt;/h2>
&lt;p>ä¸»è¦æ˜¯ä¿®å¤äº† &lt;code>host&lt;/code> æ’ä»¶çš„é”™è¯¯å¤„ç†ï¼›&lt;code>reload&lt;/code> æ’ä»¶ä¹Ÿå¯ä»¥æ£€æµ‹ Corefile ä¸­å¯¼å…¥çš„æ–‡ä»¶çš„å˜åŒ–äº†ã€‚&lt;/p>
&lt;p>æ›´å¤šå…³äºæ­¤ç‰ˆæœ¬çš„ä¿¡æ¯è¯·å‚è€ƒ &lt;a href="https://coredns.io/2019/08/01/coredns-1.6.1-release/">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="nginx-ingress-controller-153-å‘å¸ƒ">NGINX Ingress Controller 1.5.3 å‘å¸ƒ&lt;/h2>
&lt;p>è¿™ä¸ªç‰ˆæœ¬å…¶å®æ²¡å•¥è¯´çš„ï¼ŒæŠŠ NGINX Plus ç‰ˆæœ¬æ›´æ–°åˆ°äº† R18p1. å‡çº§çš„è¯ï¼Œç›´æ¥ä¿®æ”¹é•œåƒçš„ tag åˆ° 1.5.3 æˆ–è€… Helm chart ä½¿ç”¨ 0.3.3 ç‰ˆæœ¬å³å¯ã€‚&lt;/p>
&lt;h2 id="kubernetes-ä¸Šæ¸¸å¼€å‘è¿›å±•">Kubernetes ä¸Šæ¸¸å¼€å‘è¿›å±•&lt;/h2>
&lt;p>1.16 å°†ä¼šæœ‰ 39 é¡¹ç‰¹æ€§å¢å¼ºï¼Œçœ‹ç°åœ¨çš„å‘å¸ƒè¿›åº¦ä¹Ÿè¿˜ç®—æ˜¯æŒ‰ç…§é¢„æœŸçš„ï¼ŒæœŸå¾…åç»­é¡ºåˆ©ã€‚&lt;/p>
&lt;p>æœ€è¿‘åˆå¹¶çš„ PR ä¸­æˆ‘è®¤ä¸ºå€¼å¾—æ³¨æ„çš„æ˜¯ &lt;a href="https://github.com/kubernetes/kubernetes/pull/80231">#80231 AdmissionReview ç‰ˆæœ¬è‡³ v1 &lt;/a> è¿™é‡Œæ²¡æœ‰ schema çš„å˜åŒ–ï¼Œä½†æ˜¯æ‰€æœ‰çš„ç³»ç»Ÿéƒ½å°†æ¥æ”¶ v1 ç‰ˆæœ¬çš„å¯¹è±¡å’Œæ•°æ®ï¼Œå½“å‘é€å› v1 å“åº”çš„æ—¶å€™ï¼Œå“åº”éªŒè¯æ¯” beta æ—¶å€™æ›´åŠ ä¸¥æ ¼ã€‚&lt;/p>
&lt;p>æ³¨æ„ï¼Œç°åœ¨è¦ä½¿ç”¨çš„ API ç‰ˆæœ¬æ˜¯ &lt;code>apiVersion: &amp;quot;admission.k8s.io/v1&amp;quot;&lt;/code> å¦‚æœå‡çº§çš„è¯ï¼Œè¯·æ³¨æ„æ£€æŸ¥å¯¹åº”ä»£ç çš„å˜åŒ–ã€‚&lt;/p>
&lt;hr>
&lt;p>å¯ä»¥é€šè¿‡ä¸‹é¢äºŒç»´ç è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘ï¼Œåœ¨å…¬ä¼—å·åå°å›å¤ k8s å¯åŠ å…¥æŠ€æœ¯åœˆäº¤æµã€‚&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| 2019-07-29~2019-08-04</title><link>https://moelove.info/2019/08/05/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-2019-07-29~2019-08-04/</link><guid isPermaLink="true">https://moelove.info/2019/08/05/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-2019-07-29~2019-08-04/</guid><pubDate>Mon, 05 Aug 2019 00:47:54 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="containerd-130-beta0-å‘å¸ƒ">containerd 1.3.0-beta.0 å‘å¸ƒ&lt;/h2>
&lt;p>containerd 2014 å¹´ä» Docker å­µåŒ–å‡ºæ¥ï¼Œæœ€åˆæ˜¯ä½œä¸º Docker å¼•æ“çš„åº•å±‚ç®¡ç†å™¨ï¼›åœ¨ 2017 å¹´ 3 æœˆè¢« CNCF æ¥å—åï¼Œcontainerd å‡ ä¹æˆä¸ºäº†è¡Œä¸šå®¹å™¨è¿è¡Œå¼•æ“çš„æ ‡å‡†ï¼Œå®ƒä¸“æ³¨äºç®€å•ï¼Œå¥å£®å’Œå¯ç§»æ¤æ€§ï¼Œä»»ä½•äººéƒ½å¯ä»¥ä½¿ç”¨å®ƒæ¥æ„å»ºè‡ªå·±çš„å®¹å™¨å¼•æ“/å¹³å°ã€‚å®ƒæ˜¯ä» CNCF æ¯•ä¸šçš„ç¬¬ 5 ä¸ªé¡¹ç›®ï¼Œç›®å‰å‘å±•åŠ¿å¤´è‰¯å¥½ã€‚&lt;/p>
&lt;p>æœ¬æ¬¡å‘å¸ƒçš„ 1.3.0-beta.0 ç‰ˆæœ¬æ˜¯ containerd çš„ç¬¬ 4 ä¸ªä¸»è¦ç‰ˆæœ¬ï¼Œä¸»è¦æ˜¯ä¸ºäº†æå‡é¡¹ç›®çš„ç¨³å®šæ€§ï¼Œä»¥åŠä¸ºäº†ä¿æŒé¡¹ç›®çš„æ´»åŠ›è€ŒæŒç»­åŠ å…¥äº†å¾ˆå¤šæ–°çš„ç‰¹æ€§ã€‚&lt;/p>
&lt;p>è¿™æ¬¡çš„å‘å¸ƒå’Œä¹‹å‰ç‰ˆæœ¬ç±»ä¼¼ï¼Œä¿æŒç€ containerd çš„ä¸€è´¯ä½œé£ï¼ŒAPI å˜åŒ–å¾ˆå°ï¼›å¹¶ä¸”ä¹Ÿä¿æŒå‘åå…¼å®¹ã€‚æ’ä»¶ç”Ÿæ€å’Œç”¨æˆ·çš„å‘å±•ä¹Ÿä¿ƒä½¿äº† containerd å˜å¾—æ›´æ˜“ç”¨ï¼Œå¯é…ç½®å’Œæ›´çµæ´»ã€‚&lt;/p>
&lt;p>åœ¨ Windows ä¸Šï¼Œæ­¤æ¬¡ç‰ˆæœ¬å¸¦æ¥äº†ä¸€ä¸ªæ–°è¿è¡Œæ—¶ï¼ˆä½¿ç”¨ &lt;code>hcsshim&lt;/code>ï¼‰; å¯¹äºå®¢æˆ·ç«¯è€Œè¨€ï¼Œæœ¬æ¬¡ä¹Ÿå¸¦æ¥äº†å¾ˆå¤šç‰¹æ€§å’Œå‡çº§ã€‚&lt;/p>
&lt;p>è¿™é‡Œæˆ‘åªè¯´ä¸¤ç‚¹ï¼Œå…¶ä½™çš„ç­‰æ­£å¼ç‰ˆå‡ºæ¥çœ‹æƒ…å†µå†è¿›è¡Œä»‹ç»ã€‚&lt;/p>
&lt;ul>
&lt;li>å¢åŠ äº† &lt;code>devicemapper&lt;/code> çš„å¿«ç…§æ’ä»¶ã€‚è¿™ä¸ªåŠŸèƒ½æœ¬èº«æ˜¯ä¸ªå¥½äº‹å„¿ï¼Œå¦‚æœç”¨è¿‡æ—§ç‰ˆæœ¬ Docker æˆ–è€…ç³»ç»Ÿå†…æ ¸è¾ƒä½çš„æœ‹å‹ä»¬ï¼Œåº”è¯¥å¯¹ Docker çš„ &lt;code>devicemapper&lt;/code> å­˜å‚¨é©±åŠ¨ä¸ä¼šå¤ªé™Œç”Ÿçš„ï¼ˆè™½ç„¶ç°åœ¨ Docker çš„æ–°ç‰ˆæœ¬ä¸­å·²ç»å°† &lt;code>devicemapper&lt;/code> çš„å­˜å‚¨é©±åŠ¨åºŸå¼ƒæ‰äº†ï¼‰ï¼›è‡³äº containerd ä¸­å¢åŠ çš„ &lt;code>devicemapper&lt;/code> å¿«ç…§æ’ä»¶ï¼Œæˆ‘è¿˜æ²¡æœ‰æ¥å¾—åŠå…·ä½“æµ‹è¯•ï¼Œæ‰€ä»¥è¿™é‡Œä¸è¯´å¤ªå¤šäº†ã€‚&lt;/li>
&lt;li>å®¢æˆ·ç«¯æ”¯æŒäº†è·¨ repository push é•œåƒï¼Œå¯¹æ­¤åŠŸèƒ½æ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥å‚è€ƒ &lt;a href="https://github.com/containerd/containerd/pull/2697">#2697&lt;/a> çš„è®¨è®ºã€‚&lt;/li>
&lt;/ul>
&lt;p>æ›´å¤šå…³äºæ­¤ç‰ˆæœ¬çš„ä¿¡æ¯è¯·å‚è€ƒ &lt;a href="https://github.com/containerd/containerd/releases/tag/v1.3.0-beta.0">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="kubernetes-v1160-alpha2-å‘å¸ƒ">Kubernetes v1.16.0-alpha.2 å‘å¸ƒ&lt;/h2>
&lt;p>æœ¬å‘¨æŒ‰ç…§é¢„æœŸå‘å¸ƒäº† v1.16.0 çš„ alpha.2 ç‰ˆæœ¬ï¼Œè¿™ä¸ªç‰ˆæœ¬ç°åœ¨ä»‹ç»æœªå…æœ‰ç‚¹æ—©ï¼Œä¹Ÿå°±å…ˆä¸å†å¤šè¯´äº†ï¼Œä¸€ä¼šå„¿è¯´åˆ°ä¸Šæ¸¸å¼€å‘è¿›å±•çš„æ—¶å€™å†æä¸€äº›ã€‚&lt;/p>
&lt;p>æ›´å¤šå…³äºæ­¤ç‰ˆæœ¬çš„ä¿¡æ¯è¯·å‚è€ƒ &lt;a href="https://github.com/kubernetes/kubernetes/releases/tag/v1.16.0-alpha.2">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="helm-v2143-å‘å¸ƒ">Helm v2.14.3 å‘å¸ƒ&lt;/h2>
&lt;p>æœ¬å‘¨ä¹Ÿå‘å¸ƒäº† Helm çš„ v2.14.3 ç‰ˆæœ¬ï¼Œè¿™ä¸ªç‰ˆæœ¬ä¸­ä¸»è¦å°±ä¿®å¤äº†åœ¨ upgrade CRD çš„æ—¶å€™çš„é—®é¢˜ï¼Œç®—æ˜¯ä¸ªé—ç•™é—®é¢˜å§ã€‚æœ‰å…´è¶£çš„æœ‹å‹å¯ä»¥çœ‹çœ‹ &lt;a href="https://github.com/helm/helm/issues/5853">#5853&lt;/a> çš„è®¨è®ºã€‚ä¸è¿‡å…¶å®ä¹Ÿæ¯”è¾ƒæœ‰æ„æ€ï¼Œé€šå¸¸å¤§å®¶ä¼šè®¤ä¸ºåŸºç¡€å·¥å…·ä¼šå¾ˆå¯é ï¼Œæ‰€ä»¥åœ¨é‡åˆ°è¿™ç§é—®é¢˜çš„æ—¶å€™ï¼Œä¼šåå¤éªŒè¯æ˜¯ä¸æ˜¯è‡ªå·±æé”™äº†ï¼Œæˆ–è€…æ˜¯ä¸æ˜¯è‡ªå·±ä½¿ç”¨å§¿åŠ¿çš„é—®é¢˜ä¹‹ç±»çš„ã€‚&lt;/p>
&lt;p>å¦å¤–ï¼Œä¹‹åä¼šå‘å¸ƒç‰ˆæœ¬åº”è¯¥ä¼šæ˜¯ v2.15 ç³»åˆ—ï¼Œè‡³äº Helm v3 å˜›ï¼Œè¿˜å¾—å†ç­‰ç­‰ã€‚&lt;/p>
&lt;p>æ›´å¤šå…³äºæ­¤ç‰ˆæœ¬çš„ä¿¡æ¯è¯·å‚è€ƒ &lt;a href="https://github.com/helm/helm/releases/tag/v2.14.3">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="kubernetes-ä¸Šæ¸¸å¼€å‘è¿›å±•">Kubernetes ä¸Šæ¸¸å¼€å‘è¿›å±•&lt;/h2>
&lt;p>æœ€è¿‘åˆå¹¶çš„ PR ä¸­æˆ‘ä¸ªäººè®¤ä¸ºå€¼å¾—æ³¨æ„çš„æ˜¯ &lt;a href="https://github.com/kubernetes/kubernetes/pull/79992">#79992 ä¸ºä¿ç•™çš„ API ç»„æ·»åŠ ä¿æŠ¤&lt;/a> è¿™ä¸ª PR åº”è¯¥å½’å±äº &lt;a href="https://github.com/kubernetes/enhancements/pull/1111">kubernetes/enhancements#1111&lt;/a>ã€‚&lt;/p>
&lt;p>å®ƒä¸»è¦æ˜¯è¦æ±‚æ‰€æœ‰åœ¨ &lt;code>k8s.io&lt;/code> å’Œ &lt;code>kubernetes.io&lt;/code> å‘½åç©ºé—´ä¸‹çš„ CRD éƒ½å¿…é¡»æœ‰ä¸ª annotation é“¾æ¥åˆ°æ ‡è®°å®ƒä»¬è¢« approved çš„åœ°æ–¹ã€‚è¿™å¯ä»¥é¿å…ä¸€äº›å°šæœªç»è¿‡å®Œæ•´éªŒè¯æµç¨‹çš„ API çš„å‘å¸ƒï¼Œå¹¶ä¸”ä¹Ÿå¸Œæœ›é€šè¿‡å®ƒæ¥æé«˜ API çš„ä¸€è‡´æ€§ã€‚&lt;/p>
&lt;hr>
&lt;p>å¯ä»¥é€šè¿‡ä¸‹é¢äºŒç»´ç è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘ï¼Œåœ¨å…¬ä¼—å·åå°å›å¤ k8s å¯åŠ å…¥æŠ€æœ¯åœˆäº¤æµã€‚&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| 2019-07-21~2019-07-28</title><link>https://moelove.info/2019/07/28/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-2019-07-21~2019-07-28/</link><guid isPermaLink="true">https://moelove.info/2019/07/28/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-2019-07-21~2019-07-28/</guid><pubDate>Sun, 28 Jul 2019 22:14:44 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="docker-ce-v1903-æ­£å¼å‘å¸ƒ">Docker CE v19.03 æ­£å¼å‘å¸ƒ&lt;/h2>
&lt;p>7 æœˆ 22 æ—¥ï¼Œæ­£å¼å‘å¸ƒäº† Docker CE v19.03 ç‰ˆæœ¬ï¼ŒæŒ‰ç…§ Docker CE ç‰ˆæœ¬çš„ç”Ÿå‘½å‘¨æœŸï¼Œæ­¤æ¬¡çš„ v19.03 å¯ä»¥è¯´æ˜¯åƒå‘¼ä¸‡å”¤å§‹å‡ºæ¥ï¼ŒåŸæœ¬æŒ‰è¯­ä¹‰åº”è¯¥æ˜¯åœ¨ 3 æœˆï¼Œä¸è¿‡ä¹‹å‰çš„å‘å¸ƒè®¡åˆ’ä¸­å¼€å§‹æ˜¯è®¾å®šåœ¨äº† 5 æœˆä»½ï¼Œè€Œä¸€è½¬çœ¼ç°åœ¨å·²ç»åˆ° 7 æœˆåº•äº†ã€‚
å…ˆè·³è¿‡è¿™æ¬¡å‘å¸ƒæ—¶é—´å»¶æœŸçš„é—®é¢˜ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹æ­¤ç‰ˆæœ¬ä¸­æœ€å€¼å¾—æ³¨æ„çš„ä¸€äº›å˜åŒ–ã€‚&lt;/p>
&lt;p>é¦–å…ˆæ¥çœ‹çœ‹è¢«åºŸå¼ƒçš„éƒ¨åˆ†ï¼š&lt;/p>
&lt;ul>
&lt;li>åºŸå¼ƒ &lt;code>aufs&lt;/code> å­˜å‚¨é©±åŠ¨ï¼Œåœ¨æ­¤ç‰ˆæœ¬ä¹‹å‰ &lt;code>devicemapper&lt;/code> å’Œ &lt;code>overlay&lt;/code> ä¹Ÿéƒ½å·²ç»è¢«åºŸå¼ƒ;&lt;/li>
&lt;li>å½“ docker daemon è¿è¡Œæ—¶ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šå­˜å‚¨é©±åŠ¨ï¼Œåˆ™ä¼šè‡ªåŠ¨é€‰æ‹©ä¸€ä¸ªï¼Œv19.03 ä¸­å¢åŠ äº†è‡ªåŠ¨é€‰æ‹©æ—¶è·³è¿‡å·²è¢«åºŸå¼ƒçš„å­˜å‚¨é©±åŠ¨çš„é€»è¾‘ï¼›&lt;/li>
&lt;li>åºŸå¼ƒ image manifest v2 schema1 ä»¥æ”¯æŒ v2 schema2 ï¼Œè¿™é‡Œçš„åºŸå¼ƒæ¶‰åŠåˆ°çš„å†…å®¹å¾ˆå¤šï¼Œå°¤å…¶æ˜¯æ¶‰åŠåˆ°äº† image registry çš„éƒ¨åˆ†, æ‰€ä»¥åç»­è¿˜æœ‰å¾ˆé•¿çš„è·¯è¦èµ°ã€‚è¿˜è®°å¾—ä¹‹å‰æ¨é€è¿‡ Docker Hub ä»Šå¹´ 6 æœˆä»½åœæ­¢ v1 API è¿›è¡Œ Pull æ“ä½œçš„äº‹æƒ…å—ï¼Ÿæ—©å¹´ 2015 å¹´ 11 æœˆçš„æ—¶å€™ï¼Œå®ƒå°±å·²ç»ç¦æ­¢äº† v1 API çš„ Push æ“ä½œã€‚ä»è¿™ç‚¹ä¸Šä¹Ÿèƒ½çœ‹åˆ° Docker åœ¨åŠŸèƒ½å¼ƒç”¨ä¸Šå…¶å®ä¸ºç”¨æˆ·è€ƒè™‘äº†å¾ˆå¤šï¼Œå¹¶ä¸”ä¹Ÿç»™äº†è¶³å¤Ÿé•¿çš„æ—¶é—´æ¥è®©ç”¨æˆ·è¿›è¡Œè¿ç§»ã€‚&lt;/li>
&lt;/ul>
&lt;p>å…¶æ¬¡ï¼Œæˆ‘ä»¬çœ‹çœ‹åŠŸèƒ½å¢å¼ºçš„éƒ¨åˆ†ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;strong>å¯¹ NVIDIA GPU è®¾å¤‡çš„æ”¯æŒ&lt;/strong>ï¼Œåœ¨ docker CLI çš„ &lt;code>docker run&lt;/code> å‘½ä»¤ä¸­æ·»åŠ äº† &lt;code>--gpus&lt;/code> å‚æ•°ï¼Œç”¨äºä¸ºå®¹å™¨æ·»åŠ  GPU è®¾å¤‡ã€‚äº‹å®ä¸Šï¼Œå¤§å®¶éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œä¸¥æ ¼çš„è¡¨è¿°åº”è¯¥æ˜¯å®ƒç›®å‰æ˜¯å¯¹ &lt;strong>NVIDIA GPUçš„æ”¯æŒ&lt;/strong>è€Œä¸æ˜¯å¾ˆå¤šå›½å†…åª’ä½“æŠ¥é“çš„ï¼Œå¯¹ GPU çš„æ”¯æŒï¼ˆæ¯•ç«Ÿåš GPU çš„æœ‰å¾ˆå¤šå®¶ï¼‰ï¼Œè€Œä¸”ç°åœ¨å¯¹ NVIDIA çš„æ”¯æŒï¼Œä¹Ÿéƒ½æ˜¯ç¡¬ç¼–ç åœ¨ä»£ç ä¸­çš„ï¼Œä¹‹åè¿˜æœ‰å¾ˆé•¿çš„è·¯è¦èµ°ã€‚è‡³äºå¾ˆå¤šäººå¯èƒ½æƒ³é—®ï¼Œå®ƒæ·»åŠ è¿™ä¸ªæ”¯æŒåï¼Œæ˜¯å¦è¿˜éœ€è¦å®‰è£…é©±åŠ¨ï¼Œå®‰è£… CUDA æ˜¯å¦éœ€è¦å®‰è£… nvidia-docker2 ä¹‹ç±»çš„ï¼Œ æˆ‘åœ¨è¿™éƒ¨åˆ†é€»è¾‘åˆšåˆå¹¶åå°±åœ¨æœºå™¨ä¸Šå®éªŒè¿‡äº†ï¼Œ &lt;strong>ä»£ç ä¸­ç¡¬ç¼–ç äº†å¯¹ &lt;code>nvidia-container-cli&lt;/code> çš„ä¾èµ–ï¼Œç°åœ¨ä¿®æ”¹æˆäº†å¯¹ &lt;code>vidia-container-runtime-hook&lt;/code> çš„ä¾èµ–ï¼Œ&lt;/strong> æ‰€ä»¥ï¼Œåƒé©±åŠ¨å•Š &lt;code>nvidia-container-cli&lt;/code> ä¹‹ç±»çš„ä¸œè¥¿è¿˜æ˜¯éœ€è¦è£…çš„ï¼Œåªä¸è¿‡ç”¨æˆ·ä½¿ç”¨ä¸Šå’ŒåŸå…ˆç”¨æ³•ä¸ä¸€æ ·äº†ç½¢äº†ã€‚ï¼ˆè¿™é‡Œéå¸¸å¸Œæœ›å¤§å®¶èƒ½è‡ªè¡Œå°è¯•ä¸‹ï¼‰&lt;/li>
&lt;li>API æ›´æ–°è‡³äº† v1.40ï¼›&lt;/li>
&lt;li>å¯¹ &lt;code>/_ping&lt;/code> æ¥å£æ·»åŠ äº†å¯¹ &lt;code>HEAD&lt;/code> è¯·æ±‚çš„æ”¯æŒï¼Œè¿”å›ç»“æœä¸­ä¼šåŒ…å«å½“å‰ docker daemon çš„ API å’Œç‰ˆæœ¬ï¼Œç³»ç»Ÿç±»å‹ç­‰ä¿¡æ¯ï¼›&lt;/li>
&lt;li>æ„å»ºç³»ç»Ÿæœ‰äº†å¾ˆå¤šçš„æ”¹è¿›ï¼Œè¿™é‡Œä¸å†ä¸€ä¸€ç»†è¿°ï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥çœ‹æˆ‘å†™çš„æ–‡ç«  &lt;a href="https://gitbook.cn/gitchat/activity/5cf026eaff33b82ee0eb425b">ã€ŒDocker é•œåƒæ„å»ºåŸç†åŠæºç åˆ†æã€&lt;/a> è¿™ç¯‡æ–‡ç« ä¸­ä½¿ç”¨çš„æºç ç‰ˆæœ¬æ˜¯ v19.03.0-rc2 å†…å®¹å¾ˆæ–°ï¼›&lt;/li>
&lt;li>æ”¯æŒ &lt;code>Rootless&lt;/code> æ¨¡å¼ï¼Œäº‹å®ä¸Šè¿™ä¸ªåŠŸèƒ½åœ¨å»å¹´å°±å·²ç»åœ¨é€æ­¥æ¨è¿›äº†ï¼Œä½†å³ä½¿æ˜¯ç°åœ¨ï¼Œæˆ‘ä¹Ÿå°šä¸æ¨èå°†æ­¤åŠŸèƒ½åº”ç”¨äºç”Ÿäº§ç¯å¢ƒã€‚ï¼ˆå›½å†…æœ‰å¾ˆå¤šåª’ä½“å¯¹æ­¤å¤§è‚†å®£æ‰¬æ¥ç€ï¼Œè¯´ä»¥åå¯ä»¥ä¸ç”¨ &lt;code>root&lt;/code> æƒé™äº†å¦‚ä½•å¦‚ä½• - - æˆ‘åªæƒ³è¯´ä½ ä»¬æœ‰æ²¡æœ‰çœŸçš„ç”¨è¿‡ &lt;code>Rootless&lt;/code> æ¨¡å¼ï¼Œæˆ–è€…æœ‰æ²¡æœ‰åœ¨ç”Ÿäº§å®è·µä¸­éªŒè¯è¿‡ï¼‰ è¿™ä¸ªåŠŸèƒ½ç¡®å®æ˜¯æœ‰äº†ï¼Œä½†å°šä¸å®Œå–„ï¼Œä¹Ÿå°šå¹¶ä¸èƒ½è¾¾åˆ°æ›¿ä»£å½“å‰ docker å…¨éƒ¨èƒ½åŠ›çš„æ—¶å€™ï¼ŒåŒ…æ‹¬å®ƒçš„ç½‘ç»œèƒ½åŠ›ï¼Œå®ƒçš„å­˜å‚¨èƒ½åŠ›ç­‰ç›®å‰éƒ½è¿˜æœ‰å¾ˆå¤šè·¯è¦èµ°ï¼›&lt;/li>
&lt;li>å¯¹ &lt;code>docker network&lt;/code> æ”¯æŒäº† &lt;code>dangling&lt;/code> çŠ¶æ€çš„ç­›é€‰æ”¯æŒã€‚&lt;/li>
&lt;/ul>
&lt;p>ä»¥ä¸Šä¾¿æ˜¯ v19.03 ä¸­æˆ‘ä¸ªäººè®¤ä¸ºæœ€å€¼å¾—æ³¨æ„çš„å†…å®¹ã€‚å½“ç„¶ï¼Œç°åœ¨æˆ‘è¿˜è¦é¢å¤–å¤šè¯´ä¸€ç‚¹ï¼ˆåˆ’é‡ç‚¹ï¼‰ï¼š&lt;/p>
&lt;p>ä½¿ç”¨æ­¤ç‰ˆæœ¬ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸€å°æœºå™¨ä¸ŠåŒæ—¶ç®¡ç†å¤šä¸ª Docker Engine è¿™æ˜¯æˆ‘ç”¨äº†å¾ˆé•¿æ—¶é—´çš„åŠŸèƒ½ï¼Œç‰¹åˆ«æœ‰ç”¨ï¼Œä¸å¤§å®¶åˆ†äº«ä¸€ä¸‹å…·ä½“ä½¿ç”¨æ–¹æ³•ï¼š&lt;/p>
&lt;pre>&lt;code>(MoeLove) âœ ~ docker context create build-context --description &amp;quot;build context&amp;quot; --docker &amp;quot;host=tcp://172.17.0.3:2375&amp;quot;
build-context
Successfully created context &amp;quot;build-context&amp;quot;
(MoeLove) âœ ~ docker context ls
NAME DESCRIPTION DOCKER ENDPOINT KUBERNETES ENDPOINT ORCHESTRATOR
build-context build context tcp://172.17.0.3:2375
default * Current DOCKER_HOST based configuration unix:///var/run/docker.sock https://10.234.9.30:8443 (default) swarm
&lt;/code>&lt;/pre>&lt;p>ä½¿ç”¨è¯¥ &lt;code>context&lt;/code>&lt;/p>
&lt;pre>&lt;code>(MoeLove) âœ ~ docker context use build-context
build-context
Current context is now &amp;quot;build-context&amp;quot;
&lt;/code>&lt;/pre>&lt;p>è¿™æ ·ï¼Œæˆ‘ä»¬ä¾¿å¯ä»¥ç›´æ¥åœ¨æœ¬æœºç®¡ç†è¿œç¨‹çš„ä¸€å°æœºå™¨ä¸Šçš„ Docker Engine äº†ï¼Œå½“ç„¶å®ƒä¹Ÿå¯ä»¥æ”¯æŒç”¨ &lt;code>ssh&lt;/code> è¿æ¥è¿œç¨‹ä¸»æœºçš„æ¨¡å¼ã€‚&lt;/p>
&lt;p>å¥½äº†ï¼Œå…³äºæ­¤ç‰ˆæœ¬çš„ä»‹ç»å°±åˆ°è¿™é‡Œï¼Œå¯¹æ­¤ç‰ˆæœ¬ä¸­æ„å»ºç³»ç»Ÿæœ‰æƒ³æ·±å…¥çš„äº†è§£çš„è¿˜æ˜¯åŒæ ·å»ºè®®é˜…è¯» &lt;a href="https://gitbook.cn/gitchat/activity/5cf026eaff33b82ee0eb425b">ã€ŒDocker é•œåƒæ„å»ºåŸç†åŠæºç åˆ†æã€&lt;/a> å…³äºæ­¤ç‰ˆæœ¬ä¸­æ›´å¤šçš„æ›´æ–°å†…å®¹è¯·å‚è€ƒ &lt;a href="https://github.com/docker/docker-ce/releases/tag/v19.03.1">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="helm-v300-alpha2-å‘å¸ƒ">Helm v3.0.0-alpha.2 å‘å¸ƒ&lt;/h2>
&lt;p>è¿™ä¸ªç‰ˆæœ¬ä¸­ä¸»è¦æ˜¯å¯¹ Helm 3 å†…éƒ¨çš„æ¶æ„è¿›è¡Œäº†ä¼˜åŒ–ï¼Œæ‰€ä»¥å¤–éƒ¨çœ‹åˆ°çš„åŠŸèƒ½ç‰¹æ€§å˜åŒ–å¹¶ä¸æ˜¯å¾ˆå¤§ã€‚ å¦‚æœå¯¹ Helm 3 è¿˜ä¸äº†è§£çš„æœ‹å‹ï¼Œæ¨èé˜…è¯» &lt;a href="https://zhuanlan.zhihu.com/p/66058355">åˆè¯• Helm 3&lt;/a> ã€‚&lt;/p>
&lt;p>æ›´å¤šå…³äºæ­¤ç‰ˆæœ¬çš„ä¿¡æ¯è¯·å‚è€ƒ &lt;a href="https://github.com/helm/helm/releases/tag/v3.0.0-alpha.2">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="kubernetes-ä¸Šæ¸¸å¼€å‘è¿›å±•">Kubernetes ä¸Šæ¸¸å¼€å‘è¿›å±•&lt;/h2>
&lt;p>æŒ‰ç…§é¢„æœŸï¼Œç‰¹æ€§å†»ç»“çš„ deadline æ˜¯ 7 æœˆ 30 æ—¥ï¼Œè¿‡æ®µæ—¶é—´ï¼Œä¸‹ä¸€ä¸ªç‰ˆæœ¬å°±å°†ä¼šæ­£å¼å‘å¸ƒäº†ã€‚&lt;/p>
&lt;p>æœ€è¿‘åˆå¹¶çš„ PR ä¸­æœ€å€¼å¾—æ³¨æ„çš„æˆ‘ä¸ªäººè®¤ä¸ºåº”è¯¥æ˜¯ &lt;a href="https://github.com/kubernetes/kubernetes/pull/59416">#59416 å°† Ephemeral Containers æ·»åŠ åˆ° Kubernetes æ ¸å¿ƒ API&lt;/a> è¿™ä¸ª PR åº”è¯¥å½’å±äº &lt;a href="https://github.com/kubernetes/enhancements/blob/master/keps/sig-node/20190212-ephemeral-containers.md">Ephemeral Containers ç›¸å…³ KEP&lt;/a> çš„ä¸€éƒ¨åˆ†ã€‚&lt;/p>
&lt;p>å…¶ä¸»è¦ç›®çš„åœ¨äºæä¾›ä¸€ç§æœºåˆ¶ï¼Œæ–¹ä¾¿è¿›è¡Œå®¹å™¨çš„åœ¨çº¿è°ƒè¯•æˆ–è€…ç›‘æµ‹ã€‚å¯ä»¥ç†è§£ä¸ºå¯åŠ¨ä¸€ä¸ªä¸å¾…è°ƒè¯•å®¹å™¨å…·å¤‡ç›¸åŒç½‘ç»œå’Œ Namespace çš„å®¹å™¨ï¼Œä»¥æ­¤æ¥è¿›è¡Œè°ƒè¯•ã€‚ç°åœ¨æˆ‘ä»¬ä¸€èˆ¬åšè¿™ä¸ªäº‹æƒ…ä¸€èˆ¬æ˜¯æ‰‹åŠ¨å®Œæˆæˆ–è€…å€ŸåŠ©ä¸€äº›å…¶ä»–å·¥å…·ï¼Œä½†å…¶å®ä¸å¤Ÿ&amp;quot;ä¼˜é›…&amp;quot;ï¼Œéšç€è¿™ä¸ª KEP çš„å®Œå–„ï¼Œå¸Œæœ›èƒ½å¼¥è¡¥è¿™éƒ¨åˆ†çš„ç©ºç¼ºã€‚&lt;/p>
&lt;hr>
&lt;p>å¯ä»¥é€šè¿‡ä¸‹é¢äºŒç»´ç è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| 2019-07-15~2019-07-21</title><link>https://moelove.info/2019/07/22/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-2019-07-15~2019-07-21/</link><guid isPermaLink="true">https://moelove.info/2019/07/22/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-2019-07-15~2019-07-21/</guid><pubDate>Mon, 22 Jul 2019 00:07:54 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="kubernetes-v1160-alpha1-å‘å¸ƒ">Kubernetes v1.16.0-alpha.1 å‘å¸ƒ&lt;/h2>
&lt;p>Kubernetes äºè¿‘æ—¥å‘å¸ƒäº† v1.16.0-alpha.1 ç‰ˆæœ¬ï¼Œå˜åŒ–æ˜¯æ¯”è¾ƒå¤§ï¼Œä½†è¿™é‡Œæš‚æ—¶å…ˆä¸ç»†è¯´äº†ï¼Œç­‰åˆ° 9 æœˆä»½æ­£å¼ç‰ˆæœ¬å‘å¸ƒå‰åå†æ…¢æ…¢è¯´ã€‚å½“ç„¶ä¹Ÿç¨å¾®èŠä¸€äº› :) æ¯”å¦‚ï¼š&lt;/p>
&lt;p>å®˜æ–¹ &lt;code>etcd&lt;/code> é•œåƒä¸­ä¸å†æä¾› &lt;code>etcd&lt;/code> 2 å’Œ 3 çš„å…¼å®¹å·¥å…·äº†ï¼Œå¯¹ &lt;code>etcd&lt;/code> 2 çš„å…¼å®¹ä»£ç ä¹Ÿéƒ½å…¨éƒ¨åˆ æ‰äº†ï¼ˆå¯¹ &lt;code>etcd&lt;/code> 2 çš„æ”¯æŒå…¶å®ä» 1.13 å°±å·²ç»åœæ­¢äº†ï¼‰#80037 ï¼›&lt;/p>
&lt;p>1.16 ä¸­å¯¹ä»¥ä¸‹å››ç§ç±»å‹èµ„æºçš„ API æœ‰æ‰€è°ƒæ•´ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;code>NetworkPolicy&lt;/code>&lt;/li>
&lt;li>&lt;code>PodSecurityPolicy&lt;/code>&lt;/li>
&lt;li>&lt;code>DaemonSet&lt;/code>, &lt;code>Deployment&lt;/code>, &lt;code>StatefulSet&lt;/code> å’Œ &lt;code>ReplicaSet&lt;/code>&lt;/li>
&lt;li>&lt;code>Ingress&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>å…·ä½“è°ƒæ•´ç»†èŠ‚å¦‚ä¸‹ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;code>NetworkPolicy&lt;/code> å°†ä½¿ç”¨ä» v1.8 ç‰ˆæœ¬å¼€å§‹æä¾›çš„ &lt;code>networking.k8s.io/v1&lt;/code> API;&lt;/li>
&lt;li>&lt;code>PodSecurityPolicy&lt;/code> å°†ä½¿ç”¨ä» v1.10 å¼€å§‹æä¾›çš„ &lt;code>policy/v1beta1&lt;/code> API;&lt;/li>
&lt;li>&lt;code>DaemonSet&lt;/code>, &lt;code>Deployment&lt;/code>, &lt;code>StatefulSet&lt;/code> å’Œ &lt;code>ReplicaSet&lt;/code> å°†ä½¿ç”¨ä» v1.9 ç‰ˆæœ¬å¼€å§‹æä¾›çš„ &lt;code>apps/v1&lt;/code> API;&lt;/li>
&lt;li>&lt;code>Ingress&lt;/code> è¿ç§»åˆ° &lt;code>networking.k8s.io/v1beta1&lt;/code> API;&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>æ³¨æ„ï¼šåªæ˜¯èµ„æºçš„ API è¿›è¡Œäº†è°ƒæ•´ï¼Œå¹¶ä¸ä¼šåˆ é™¤è¿™äº›èµ„æº&lt;/strong> ç°åœ¨è¿˜æœ‰è¶³å¤Ÿçš„æ—¶é—´å°† API è¿›è¡Œè°ƒæ•´å’Œæ›´æ–°ã€‚&lt;/p>
&lt;p>å¯ä»¥ç›´æ¥é€šè¿‡ &lt;code>kubectl&lt;/code> æ¥å®Œæˆ API å‡çº§çš„è½¬æ¢ï¼Œæ¯”å¦‚ &lt;code>kubectl convert -f &amp;lt;file&amp;gt; --output-version &amp;lt;group&amp;gt;/&amp;lt;version&amp;gt;&lt;/code> ã€‚éªŒè¯çš„è¯ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡ä¿®æ”¹ &lt;code>api-server&lt;/code> çš„ &lt;code>runtime-config&lt;/code> å‚æ•°æ¥è¿›è¡ŒéªŒè¯ã€‚ï¼ˆå½“ç„¶æ›´ç®€å•çš„æ–¹å¼æ˜¯ä½¿ç”¨ Kind æ¥å®Œæˆï¼‰&lt;/p>
&lt;p>å¦å¤– &lt;code>MutatingWebhookConfiguration&lt;/code> å’Œ &lt;code>ValidatingWebhookConfiguration&lt;/code> API ä¹Ÿè¢«æå‡ä¸º &lt;code>admissionregistration.k8s.io/v1&lt;/code> å¹¶ä¸”ä¸€äº›é»˜è®¤å€¼ï¼Œæ¯”å¦‚ &lt;code>failurePolicy&lt;/code> ä¹Ÿä» &lt;code>Ignore&lt;/code> æ”¹ä¸ºäº† &lt;code>Fail&lt;/code> &lt;strong>æ³¨æ„ï¼šåªå½±å“äº† v1 API&lt;/strong> æ›´å¤šç»†èŠ‚å¯å‚è€ƒ #79549&lt;/p>
&lt;p>å…³äº Kubernetes v1.16.0-alpha.1 ç‰ˆæ›´å¤šå†…å®¹è¯·å‚è€ƒ &lt;a href="https://github.com/kubernetes/kubernetes/blob/master/CHANGELOG-1.16.md#v1160-alpha1">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="docker-ce-v18098-å‘å¸ƒ">Docker CE v18.09.8 å‘å¸ƒ&lt;/h2>
&lt;p>è¿™æ˜¯ä¸ªå¸¸è§„çš„ bugfix ç‰ˆæœ¬ï¼Œæœ¬æ¬¡æ›´æ–°çš„ä¸»è¦å†…å®¹æ˜¯ä¿®å¤ CVE-2019-13509 ï¼Œå»ºè®®å¤§å®¶å‡çº§ã€‚
å¦å¤–ï¼Œå¦‚æœæ˜¯å°† Docker daemon çš„ API æš´éœ²å‡ºæ¥çš„è¯ï¼Œå»ºè®®å¢åŠ  TLS ï¼Œä»¥ç¡®ä¿å®‰å…¨ã€‚&lt;/p>
&lt;p>æ›´å¤šå†…å®¹è¯·å‚è€ƒ &lt;a href="https://github.com/docker/docker-ce/releases/tag/v18.09.8">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="thanos-æ­£å¼æˆä¸º-cncf-sandbox-å­µåŒ–é¡¹ç›®">thanos æ­£å¼æˆä¸º CNCF Sandbox å­µåŒ–é¡¹ç›®&lt;/h2>
&lt;p>&lt;a href="https://github.com/thanos-io/thanos">thanos&lt;/a> æ˜¯ä¸€ä¸ªè‡´åŠ›äºæä¾› Prometheus é«˜å¯ç”¨æ–¹æ¡ˆçš„ä¸€å¥—ç»„ä»¶ï¼Œå¯åœ¨ç°æœ‰ Prometheus åŸºç¡€ä¸Šæ— ç¼æ·»åŠ ã€‚&lt;/p>
&lt;p>å…·ä½“è€Œè¨€ï¼Œé€šè¿‡ thanos å¯ä»¥â€œæ— é™â€çš„ä¿å­˜æŒ‡æ ‡ï¼Œå¯ä»¥æä¾›å…¨å±€æŸ¥è¯¢è§†å›¾ï¼Œå¯æä¾›åŒ…æ‹¬ Prometheus åœ¨å†…ç»„ä»¶çš„é«˜å¯ç”¨ã€‚&lt;/p>
&lt;p>éšç€ Kubernetes çš„å‘å±•ï¼ŒPrometheus å‡ ä¹æˆä¸ºäº†å½“å‰äº‘åŸç”Ÿæ—¶ä»£ä¸‹çš„é¦–é€‰ç›‘æ§ç³»ç»Ÿäº†ï¼Œå¦‚æœä½ åœ¨ç”¨ Prometheus æˆ‘æ¨èä½ çœ‹çœ‹ thanosã€‚&lt;/p>
&lt;p>è´´ä¸€å¼ å®˜æ–¹çš„æ¶æ„å›¾ï¼š&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/thanos-io/thanos/master/docs/img/arch.jpg" alt="thanos's arch - moelove.info">&lt;/p>
&lt;h2 id="kubernetes-nginx-ingress-0250-æ­£å¼å‘å¸ƒ">Kubernetes NGINX Ingress 0.25.0 æ­£å¼å‘å¸ƒ&lt;/h2>
&lt;p>&lt;a href="https://moelove.info/2019/07/07/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-2019-07-01~2019-07-07/#nginx-ingress-controller-1-5-1-%E5%8F%91%E5%B8%83">å‰ä¸¤å‘¨ NGINX Ingress ä¹Ÿå‘å¸ƒè¿‡æ–°ç‰ˆæœ¬&lt;/a>ï¼Œçœ‹å½“å‰ç¤¾åŒºçš„æƒ…å†µï¼Œä¸¤è€…éƒ½æœ‰äººåœ¨ä½¿ç”¨ã€‚&lt;/p>
&lt;p>æœ¬æ¬¡ Kubernetes NGINX Ingress æ–°ç‰ˆæœ¬ä¸­æœ€é‡è¦çš„ç‚¹ä¹‹ä¸€è«è¿‡äº &lt;strong>å°† &lt;code>NGINX&lt;/code> è¿ç§»åˆ°äº† &lt;code>OpenResty&lt;/code>&lt;/strong> ï¼Œé€šè¿‡è¿™ä¸€æ”¹å˜ï¼Œä¹Ÿå¯ä»¥åˆ©ç”¨ &lt;code>OpenResty&lt;/code> ç¤¾åŒºçš„å·¥å…·å’Œæ¨¡å—ç­‰æ‰©å±•ä¸€äº›åŠŸèƒ½ï¼ˆæˆ‘è€ƒè™‘ä¹Ÿå¯èƒ½æ˜¯ä¸ºäº†å¸å¼•ä¸€éƒ¨åˆ†ç”¨æˆ·ï¼‰&lt;/p>
&lt;p>å…³äºæ­¤ç‰ˆæœ¬çš„æ›´å¤šç»†èŠ‚è¯·å‚è€ƒ &lt;a href="https://github.com/kubernetes/ingress-nginx/releases/tag/nginx-0.25.0">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="kubectl-get--w-æ–°å¢äº†äº‹ä»¶åˆ—">&lt;code>kubectl get -w&lt;/code> æ–°å¢äº†äº‹ä»¶åˆ—&lt;/h2>
&lt;p>é€šè¿‡æŒ‡å®š &lt;code>--output-watch-events&lt;/code> å¯ä»¥ä¸º &lt;code>kubectl get -w&lt;/code> çš„è¾“å‡ºå¢åŠ äº‹ä»¶åˆ—ï¼Œä¹‹åé…åˆå…¶ä»–ç®€å•çš„ä»£ç ä¾¿å¯å®Œæˆå¾ˆå¤šæœ‰è¶£çš„äº‹æƒ…äº†ï¼Œæ¯”å¦‚è¯´ Node çš„ç™»è®°å˜æ›´ç­‰ã€‚ è¿™ä¸ªåŠŸèƒ½é¢„æœŸä¼šåœ¨ä¸‹ä¸ªç‰ˆæœ¬å‘å¸ƒã€‚&lt;/p>
&lt;pre>&lt;code>(MoeLove) âœ ~ kubectl get ns -w --output-watch-events
EVENT NAME STATUS AGE
ADDED default Active 19m
ADDED kube-node-lease Active 19m
ADDED kube-public Active 19m
ADDED kube-system Active 19m
ADDED moelove Active 56s
MODIFIED moelove Terminating 76s
DELETED moelove Terminating 81s
ADDED moelove Active 0s
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
(MoeLove) âœ ~ kubectl delete ns moelove
namespace &amp;quot;moelove&amp;quot; deleted
(MoeLove) âœ ~ kubectl create ns moelove
namespace/moelove created
(MoeLove) âœ ~
&lt;/code>&lt;/pre>&lt;p>&lt;img src="https://moelove.info/img/kubectl-watch-out-event.jpg" alt="kubectl-watch-out-event - moelove.info">&lt;/p>
&lt;hr>
&lt;p>å¯ä»¥é€šè¿‡ä¸‹é¢äºŒç»´ç è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| 2019-07-08~2019-07-14</title><link>https://moelove.info/2019/07/15/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-2019-07-08~2019-07-14/</link><guid isPermaLink="true">https://moelove.info/2019/07/15/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-2019-07-08~2019-07-14/</guid><pubDate>Mon, 15 Jul 2019 05:44:22 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚
æœ¬å‘¨ä¸ºä»€ä¹ˆå‘å¸ƒæ—¶é—´æ¯”å¾€å¸¸è¿Ÿå‘¢ï¼Ÿå› ä¸ºæˆ‘åœ¨å¿™ç»“å©šå‘€ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="coredns-v152-å‘å¸ƒ">CoreDNS v1.5.2 å‘å¸ƒ&lt;/h2>
&lt;p>è¿™æ˜¯ CoreDNS åœ¨ 1.5.x ç‰ˆæœ¬ä¸­å‘å¸ƒçš„ç¬¬äºŒä¸ªå°ç‰ˆæœ¬ï¼Œå…³äº 1.5.1 ç‰ˆæœ¬çš„è¯´æ˜å¯å‚è€ƒä¸Šä¸Šå‘¨çš„æ–‡ç« ã€‚&lt;/p>
&lt;p>åœ¨æ­¤ç‰ˆæœ¬ä¸­ï¼Œä¸€ä¸ªé‡è¦çš„å˜æ›´ä¾¿æ˜¯ç§»é™¤æ‰äº† &lt;code>upstream&lt;/code> æ’ä»¶ç›¸å…³çš„æ‰€æœ‰æ–‡æ¡£å’Œè¯´æ˜ã€‚æ¯”å¦‚ï¼ŒKubernetes 1.14 ç‰ˆæœ¬ä¸­é»˜è®¤çš„ CoreDNS çš„é…ç½®æ–‡ä»¶çš„å†…å®¹å¦‚ä¸‹ï¼š&lt;/p>
&lt;pre>&lt;code>.:53 {
errors
health
kubernetes cluster.local in-addr.arpa ip6.arpa {
pods insecure
upstream
fallthrough in-addr.arpa ip6.arpa
}
prometheus :9153
forward . /etc/resolv.conf
cache 30
loop
reload
loadbalance
}
&lt;/code>&lt;/pre>&lt;p>å…¶ä¸­ &lt;code>kubernetes&lt;/code> æ’ä»¶ä¸­æœ‰ä¸€è¡Œ &lt;code>upstream&lt;/code> çš„é…ç½®ï¼Œå®ƒæ˜¯å®šä¹‰äº†ç”¨äºè§£ææŒ‡å‘å¤–éƒ¨ä¸»æœºçš„æœåŠ¡çš„ä¸Šæ¸¸è§£æå™¨ï¼ˆä¹Ÿç§°ä¹‹ä¸ºå¤–éƒ¨æœåŠ¡ï¼ŒCNAMEï¼‰CoreDNS å°†é’ˆå¯¹è‡ªèº«è§£æè¯¥æœåŠ¡ã€‚&lt;/p>
&lt;p>åœ¨æ­¤æ¬¡å˜æ›´ä¹‹åï¼Œ &lt;code>upstream&lt;/code> é…ç½®è¡Œä¾¿å¯ç›´æ¥ç§»é™¤ã€‚&lt;/p>
&lt;p>å¦å¤– &lt;code>template&lt;/code> æ’ä»¶æ”¯æŒå…ƒæ•°æ®äº†ã€‚æ¯”å¦‚è¯´å¯ä»¥ç»™å®ƒå¢åŠ ä¸€ä¸ªé…ç½® &lt;code>.Meta &amp;quot;kubernetes/my-namespace&amp;quot;&lt;/code>ã€‚&lt;/p>
&lt;p>å…³äºæ­¤ç‰ˆæœ¬çš„æ›´è¯¦ç»†è¯´æ˜å¯é˜…è¯» &lt;a href="https://coredns.io/2019/07/03/coredns-1.5.2-release/">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="envoy-v1110-æ­£å¼å‘å¸ƒ">Envoy v1.11.0 æ­£å¼å‘å¸ƒ&lt;/h2>
&lt;p>è¿™ä¸ªç‰ˆæœ¬çš„å˜åŒ–å…¶å®è¿˜æ¯”è¾ƒå¤šï¼Œä¸»è¦é›†ä¸­åœ¨ç‰¹æ€§å¢å¼ºå’Œå„ç±»å…¼å®¹æ€§æ”¯æŒä¸Šã€‚&lt;/p>
&lt;p>åœ¨æ­¤ç‰ˆæœ¬ä¸­å¢åŠ äº†å¯¹ Redis Cluster å‘½ä»¤è·¯ç”±çš„æ”¯æŒï¼Œæ·»åŠ äº† &lt;code>prefix routing&lt;/code> ä»¥æ”¯æŒå¯¹ Redis æŒ‰ç…§ key å‰ç¼€è¿›è¡Œè·¯ç”±çš„èƒ½åŠ›ã€‚&lt;/p>
&lt;p>åœ¨ç®¡ç†æ–¹é¢å¢åŠ äº†ä¸»æœºçš„ä¼˜å…ˆçº§ï¼Œready æ£€æŸ¥çš„æ¥å£ç­‰ã€‚&lt;/p>
&lt;p>å…³äºæ­¤ç‰ˆæœ¬æ›´è¯¦ç»†è¯´æ˜å¯é˜…è¯» &lt;a href="https://www.envoyproxy.io/docs/envoy/v1.11.0/intro/version_history">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="ä¸º-kubernetes-è€Œç”Ÿçš„æ“ä½œç³»ç»Ÿ---talos">ä¸º Kubernetes è€Œç”Ÿçš„æ“ä½œç³»ç»Ÿ - Talos&lt;/h2>
&lt;p>æ­£å¦‚è¯¥é¡¹ç›®çš„ä»‹ç»ä¸­è¯´çš„ &lt;a href="https://github.com/talos-systems/talos">Talos&lt;/a> æ˜¯ä¸€æ¬¾ç°ä»£æ“ä½œç³»ç»Ÿï¼Œæ—¨åœ¨æä¾›å®‰å…¨ï¼Œä¸å¯å˜å’Œæœ€å°çš„åŠŸèƒ½ã€‚æ‰€æœ‰ç³»ç»Ÿç®¡ç†éƒ½æ˜¯é€šè¿‡ API å®Œæˆçš„ï¼Œæ²¡æœ‰ shell æˆ–äº¤äº’å¼æ§åˆ¶å°ã€‚&lt;/p>
&lt;p>Talos æä¾›çš„ä¸€äº›åŠŸèƒ½å’Œå¥½å¤„åŒ…æ‹¬:&lt;/p>
&lt;ul>
&lt;li>Securityï¼šTalos é€šè¿‡å®è·µæœ€å°ç‰¹æƒåŸåˆ™ï¼ˆPoLPï¼‰å¹¶é€šè¿‡ç›¸äº’ TLSï¼ˆmTLSï¼‰èº«ä»½éªŒè¯æ¥ä¿æŠ¤ API æ¥å‡å°‘æ”»å‡»é¢ã€‚&lt;/li>
&lt;li>Predictabilityï¼šTalos é€šè¿‡é‡‡ç”¨ä¸å¯å˜çš„åŸºç¡€æ¶æ„æ„è¯†å½¢æ€æ¥æ¶ˆé™¤ä¸å¿…è¦çš„å˜é‡å¹¶å‡å°‘ç¯å¢ƒä¸­çš„æœªçŸ¥å› ç´ ã€‚&lt;/li>
&lt;li>Evolvabilityï¼šTalos ç®€åŒ–äº†ä½ çš„æ¶æ„ï¼Œæé«˜äº†è½»æ¾é€‚åº”æœªæ¥å˜åŒ–çš„èƒ½åŠ›ã€‚&lt;/li>
&lt;/ul>
&lt;p>è¿™ä¸ªé¡¹ç›®å…¶å®æŒºæœ‰æ„æ€çš„ï¼Œå®ƒç¤ºä¾‹ä¸­çš„åšæ³•å…¶å®å¾ˆåƒæˆ‘ä»¬çš„ &lt;a href="https://github.com/kubernetes-sigs/kind">Kubernetes In Docker&lt;/a> é¡¹ç›®ã€‚æˆ‘ä¹Ÿä¼šæŒç»­å…³æ³¨å®ƒçš„å‘å±•ã€‚&lt;/p>
&lt;p>æˆ‘ä¼šåœ¨è¿‘æœŸåˆ†äº«ä¸€ç¯‡å…³äºè¿™ç±»æ“ä½œç³»ç»Ÿçš„æ–‡ç« (flag+1) ï¼Œå¤§æ¦‚å†…å®¹å°±æ˜¯å…³äº k3osï¼Œ Talos, æ›¾ç»çš„ CoreOS ä¹‹ç±»çš„æ“ä½œç³»ç»Ÿçš„ä»‹ç»å’Œåˆ†æå§ï¼Œæ•¬è¯·æœŸå¾…ã€‚&lt;/p>
&lt;h2 id="åˆ†äº«ä¸€ä¸ªå·¥å…·---kubectl-bindrole">åˆ†äº«ä¸€ä¸ªå·¥å…· - kubectl-bindrole&lt;/h2>
&lt;p>&lt;a href="https://github.com/Ladicle/kubectl-bindrole">kubectl-bindrole&lt;/a> æ˜¯ä¸€æ¬¾ kubectl æ’ä»¶ï¼Œå¯ç”¨äºå¸®åŠ©æŸ¥æ‰¾ Kubernetes é›†ç¾¤ä¸­æŒ‡å®š SA/Group/User çš„æƒé™ç­‰ä¿¡æ¯ã€‚&lt;/p>
&lt;p>å¯ä»¥ç›´æ¥åœ¨é¡¹ç›®çš„ &lt;a href="https://github.com/Ladicle/kubectl-bindrole/releases">Relase é¡µé¢&lt;/a>è¿›è¡Œä¸‹è½½å®‰è£…ã€‚&lt;/p>
&lt;pre>&lt;code>(MoeLove) âœ ~ kubectl bindrole -n kube-system kube-proxy
ServiceAccount: kube-system/kube-proxy
Secrets:
â€¢ */kube-proxy-token-2f5ll
Policies:
â€¢ Name: */system:node-proxier
Resource Name Exclude Verbs G L W C U P D DC
endpoints [*] [-] [-] âœ– âœ” âœ” âœ– âœ– âœ– âœ– âœ–
events [*] [-] [-] âœ– âœ– âœ– âœ” âœ” âœ” âœ– âœ–
nodes [*] [-] [-] âœ” âœ– âœ– âœ– âœ– âœ– âœ– âœ–
services [*] [-] [-] âœ– âœ” âœ” âœ– âœ– âœ– âœ– âœ–
(MoeLove) âœ ~ kubectl bindrole -n kube-system node-controller
ServiceAccount: kube-system/node-controller
Secrets:
â€¢ */node-controller-token-kfgf2
Policies:
â€¢ Name: */system:controller:node-controller
Resource Name Exclude Verbs G L W C U P D DC
events [*] [-] [-] âœ– âœ– âœ– âœ” âœ” âœ” âœ– âœ–
nodes [*] [-] [-] âœ” âœ” âœ– âœ– âœ” âœ” âœ” âœ–
nodes/status [*] [-] [-] âœ– âœ– âœ– âœ– âœ” âœ” âœ– âœ–
pods [*] [-] [-] âœ– âœ” âœ– âœ– âœ– âœ– âœ” âœ–
pods/status [*] [-] [-] âœ– âœ– âœ– âœ– âœ” âœ– âœ– âœ–
&lt;/code>&lt;/pre>&lt;p>åœ¨ç»ˆç«¯ä¸‹å®ƒçœ‹èµ·æ¥æ˜¯è¿™æ ·ï¼š&lt;/p>
&lt;p>&lt;img src="https://moelove.info/img/kubectl-bindrole.png" alt="kubectl-bindrole preview - moelove.info">&lt;/p>
&lt;hr>
&lt;p>å¯ä»¥é€šè¿‡ä¸‹é¢äºŒç»´ç è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| 2019-07-01~2019-07-07</title><link>https://moelove.info/2019/07/07/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-2019-07-01~2019-07-07/</link><guid isPermaLink="true">https://moelove.info/2019/07/07/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-2019-07-01~2019-07-07/</guid><pubDate>Sun, 07 Jul 2019 23:20:10 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="kubernetes-v116-å‘å¸ƒå‘¨æœŸå¼€å§‹">Kubernetes v1.16 å‘å¸ƒå‘¨æœŸå¼€å§‹&lt;/h2>
&lt;p>éšç€å‰æ®µæ—¶é—´ Kubernetes v1.15 çš„å‘å¸ƒï¼Œv1.16 çš„å‘å¸ƒå‘¨æœŸå¼€å§‹äº†ã€‚æœ¬æ¬¡çš„å‘å¸ƒå‘¨æœŸä¸€å¦‚å¾€å¸¸ï¼Œæœ¬æœˆåº•å¢å¼ºåŠŸèƒ½å†»ç»“ï¼Œä¸‹æœˆåº•ä»£ç å†»ç»“ï¼Œ9 æœˆåˆå®Œå–„æ–‡æ¡£ï¼Œè®¡åˆ’åœ¨ 9 æœˆä¸­å‘å¸ƒ v1.16 ç‰ˆæœ¬ã€‚&lt;/p>
&lt;p>å…¶å®æŒ‰è¿™ä¸ªèŠ‚å¥çœ‹å¾—è¯ï¼Œå¤§å®¶å¦‚æœéœ€è¦ç»´æŠ¤ç”Ÿäº§ä¸­çš„ Kubernetes é›†ç¾¤çš„è¯ï¼Œè¿˜æ˜¯å°½å¿«æµ‹è¯•éªŒè¯å¹¶å®Œæˆå‡çº§ï¼Œä»¥å…æ‰€ç”¨ç‰ˆæœ¬ EOLï¼Œå¸¦æ¥ä¸€äº›å…¶ä»–çš„é—®é¢˜ã€‚&lt;/p>
&lt;h2 id="knative-serving-v07x-å‘å¸ƒ">Knative Serving v0.7.x å‘å¸ƒ&lt;/h2>
&lt;p>æœ¬å‘¨ Knative Serving å‘å¸ƒäº† v0.7.1 ç‰ˆæœ¬ï¼ŒKnative è¿‘æœŸçš„å¼€å‘è¿˜æ˜¯æ¯”è¾ƒæ´»è·ƒçš„ã€‚&lt;/p>
&lt;p>éœ€è¦æ³¨æ„çš„æ˜¯è‹¥ä½¿ç”¨ v0.7.x ç‰ˆæœ¬ä¸­æ–°å¢çš„ &lt;code>serving.knative.dev/v1beta1&lt;/code> API çš„è¯ï¼Œåˆ™éœ€è¦ Kubernetes v1.14 ç‰ˆæœ¬ä»¥ä¸Šã€‚å…·ä½“åŸå› è¯·å‚è€ƒ &lt;a href="https://github.com/knative/serving/issues/4533">#4533&lt;/a>&lt;/p>
&lt;p>Non-root å®¹å™¨ï¼šåœ¨è¿™ä¸ªç‰ˆæœ¬ä¸­æ‰€æœ‰å‘å¸ƒçš„å®¹å™¨å‡ä»¥é root ç”¨æˆ·è¿è¡Œï¼Œè¿™ä½¿å¾—æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ›´ä¸¥æ ¼çš„ PSPã€‚&lt;/p>
&lt;p>å½“ç„¶æ­¤ç‰ˆæœ¬ä¸­ä¹ŸåŒ…å«ä¸€äº›ç ´åæ€§å˜æ›´ï¼Œæ¯”å¦‚ status å­—æ®µåºŸå¼ƒã€‚&lt;/p>
&lt;p>å…³äºæ­¤ç‰ˆæœ¬æ›´å¤šçš„ç»†èŠ‚è¯·å‚è€ƒ &lt;a href="https://github.com/knative/serving/releases/tag/v0.7.1">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="debian-10-buster-æ­£å¼å‘å¸ƒ">Debian 10 buster æ­£å¼å‘å¸ƒ&lt;/h2>
&lt;p>Debian 10 æ­£å¼å‘å¸ƒäº†ï¼Œå…¶å®æŒ‰ä¸€èˆ¬çš„è§’åº¦æ¥çœ‹ï¼ŒLinux çš„ä¸€ä¸ªå‘è¡Œç‰ˆå‘å¸ƒä¸ä¼šå‡ºç°åœ¨ K8S ç”Ÿæ€å‘¨æŠ¥ä¸­çš„ã€‚&lt;/p>
&lt;p>ä½†è¿™é‡Œæœ‰ä¸ªéœ€è¦æ³¨æ„çš„ç‚¹ï¼Œå¯¹äºä½¿ç”¨æ­¤ç‰ˆæœ¬éƒ¨ç½² Kubernetes æ—¶ï¼Œéœ€è¦æ³¨æ„ä¸€ä¸‹ã€‚æ­¤ç‰ˆæœ¬ä¸­ä½¿ç”¨çš„ &lt;code>systemd&lt;/code> ç‰ˆæœ¬æ˜¯ 241.5 è€Œè¿™ä¸ªç‰ˆæœ¬ä¸­æœ‰ä¸ªå¯¹äºä½¿ç”¨ Kubernetes è€Œè¨€å€¼å¾—æ³¨æ„çš„ç‚¹ã€‚&lt;/p>
&lt;p>è¿™ä¸ªç‰ˆæœ¬çš„ systemd å¯èƒ½ä¼šç ´å LXD å®¹å™¨çš„ç½‘ç»œï¼Œè¡¨ç°åœ¨å¯èƒ½æ— æ³•ç”Ÿæˆ MAC åœ°å€ä¸Šã€‚ï¼ˆæˆ‘çŒœæµ‹ç°åœ¨å…³æ³¨ LXD çš„ç”¨æˆ·æ²¡æœ‰é‚£ä¹ˆå¤šäº†ï¼Œè¿™é‡Œæˆ‘ä¹Ÿå°±ä¸è¿‡å¤šè§£é‡Šäº†ã€‚ï¼‰å½“ç„¶è¿™ä¸ªé—®é¢˜åŒæ ·ä¹Ÿå¯èƒ½ä¼šå‡ºç°åœ¨ä½¿ç”¨ Docker/runc/cri-o ç­‰å®¹å™¨è¿è¡Œæ—¶çš„åœºæ™¯ä¸­ã€‚&lt;/p>
&lt;p>æœ€åï¼Œè¿˜æ˜¯åº†ç¥ä¸€ä¸‹ Debian 10 çš„æ­£å¼å‘å¸ƒï¼Œæ­¤ç‰ˆæœ¬å†…æ ¸ä¹Ÿå·²ç»å‡çº§åˆ°äº† 4.19 ã€‚å¹¶ä¸”è¿™ä¸ªç‰ˆæœ¬ä¹Ÿæœ‰å¾ˆå¤šçš„æ”¹å–„å’Œå‡çº§ã€‚å…·ä½“å†…å®¹å¯å‚è€ƒå…¶ &lt;a href="https://www.debian.org/releases/buster/">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="nginx-ingress-controller-151-å‘å¸ƒ">NGINX Ingress Controller 1.5.1 å‘å¸ƒ&lt;/h2>
&lt;p>NGINX Ingress Controller æ˜¯ç”± NGINX ç¤¾åŒºå¼€å‘çš„ Ingress Controller ç›¸æ¯”äº Kubernetes çš„ Nginx Ingress Controller è€Œè¨€ä¸»è¦åŒºåˆ«å¦‚ä¸‹ï¼š&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Aspect or Feature&lt;/th>
&lt;th>kubernetes/ingress-nginx&lt;/th>
&lt;th>nginxinc/kubernetes-ingress with NGINX&lt;/th>
&lt;th>nginxinc/kubernetes-ingress with NGINX Plus&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;strong>Fundamental&lt;/strong>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Authors&lt;/td>
&lt;td>Kubernetes community&lt;/td>
&lt;td>NGINX Inc and community&lt;/td>
&lt;td>NGINX Inc and community&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>NGINX version&lt;/td>
&lt;td>&lt;a href="https://github.com/kubernetes/ingress-nginx/tree/master/images/nginx">Custom&lt;/a> NGINX build that includes several third-party modules&lt;/td>
&lt;td>NGINX official mainline &lt;a href="https://github.com/nginxinc/docker-nginx">build&lt;/a>&lt;/td>
&lt;td>NGINX Plus&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Commercial support&lt;/td>
&lt;td>N/A&lt;/td>
&lt;td>N/A&lt;/td>
&lt;td>Included&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;strong>Load balancing configuration via the Ingress resource&lt;/strong>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Merging Ingress rules with the same host&lt;/td>
&lt;td>Supported&lt;/td>
&lt;td>Supported via &lt;a href="../examples/mergeable-ingress-types">Mergeable Ingresses&lt;/a>&lt;/td>
&lt;td>Supported via &lt;a href="../examples/mergeable-ingress-types">Mergeable Ingresses&lt;/a>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>HTTP load balancing extensions - Annotations&lt;/td>
&lt;td>See the &lt;a href="https://github.com/kubernetes/ingress-nginx/blob/master/docs/user-guide/nginx-configuration/annotations.md">supported annotations&lt;/a>&lt;/td>
&lt;td>See the &lt;a href="configmap-and-annotations.md">supported annotations&lt;/a>&lt;/td>
&lt;td>See the &lt;a href="configmap-and-annotations.md">supported annotations&lt;/a>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>HTTP load balancing extensions -- ConfigMap&lt;/td>
&lt;td>See the &lt;a href="https://github.com/kubernetes/ingress-nginx/blob/master/docs/user-guide/nginx-configuration/configmap.md">supported ConfigMap keys&lt;/a>&lt;/td>
&lt;td>See the &lt;a href="configmap-and-annotations.md">supported ConfigMap keys&lt;/a>&lt;/td>
&lt;td>See the &lt;a href="configmap-and-annotations.md">supported ConfigMap keys&lt;/a>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>TCP/UDP&lt;/td>
&lt;td>Supported via a ConfigMap&lt;/td>
&lt;td>Supported via a ConfigMap with native NGINX configuration&lt;/td>
&lt;td>Supported via a ConfigMap with native NGINX configuration&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Websocket&lt;/td>
&lt;td>Supported&lt;/td>
&lt;td>Supported via an &lt;a href="../examples/websocket">annotation&lt;/a>&lt;/td>
&lt;td>Supported via an &lt;a href="../examples/websocket">annotation&lt;/a>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>TCP SSL Passthrough&lt;/td>
&lt;td>Supported via a ConfigMap&lt;/td>
&lt;td>Not supported&lt;/td>
&lt;td>Not supported&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>JWT validation&lt;/td>
&lt;td>Not supported&lt;/td>
&lt;td>Not supported&lt;/td>
&lt;td>Supported&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Session persistence&lt;/td>
&lt;td>Supported via a third-party module&lt;/td>
&lt;td>Not supported&lt;/td>
&lt;td>Supported&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Canary testing (by header, cookie, weight)&lt;/td>
&lt;td>Supported via annotations&lt;/td>
&lt;td>Supported via custom resources&lt;/td>
&lt;td>Supported via custom resources&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Configuration templates *1&lt;/td>
&lt;td>See the &lt;a href="https://github.com/kubernetes/ingress-nginx/blob/master/rootfs/etc/nginx/template/nginx.tmpl">template&lt;/a>&lt;/td>
&lt;td>See the &lt;a href="../internal/configs/version1">templates&lt;/a>&lt;/td>
&lt;td>See the &lt;a href="../internal/configs/version1">templates&lt;/a>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;strong>Load balancing configuration via Custom Resources&lt;/strong>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>HTTP load balancing&lt;/td>
&lt;td>Not supported&lt;/td>
&lt;td>See &lt;a href="virtualserver-and-virtualserverroute.md">VirtualServer and VirtualServerRoute&lt;/a> resources.&lt;/td>
&lt;td>See &lt;a href="virtualserver-and-virtualserverroute.md">VirtualServer and VirtualServerRoute&lt;/a> resources.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;strong>Deployment&lt;/strong>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Command-line arguments *2&lt;/td>
&lt;td>See the &lt;a href="https://github.com/kubernetes/ingress-nginx/blob/master/docs/user-guide/cli-arguments.md">arguments&lt;/a>&lt;/td>
&lt;td>See the &lt;a href="cli-arguments.md">arguments&lt;/a>&lt;/td>
&lt;td>See the &lt;a href="cli-arguments.md">arguments&lt;/a>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>TLS certificate and key for the default server&lt;/td>
&lt;td>Required as a command-line argument/ auto-generated&lt;/td>
&lt;td>Required as a command-line argument&lt;/td>
&lt;td>Required as a command-line argument&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Helm chart&lt;/td>
&lt;td>Supported&lt;/td>
&lt;td>Supported&lt;/td>
&lt;td>Supported&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;strong>Operational&lt;/strong>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Reporting the IP address(es) of the Ingress controller into Ingress resources&lt;/td>
&lt;td>Supported&lt;/td>
&lt;td>Supported&lt;/td>
&lt;td>Supported&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Extended Status&lt;/td>
&lt;td>Supported via a third-party module&lt;/td>
&lt;td>Not supported&lt;/td>
&lt;td>Supported&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Prometheus Integration&lt;/td>
&lt;td>Supported&lt;/td>
&lt;td>Supported&lt;/td>
&lt;td>Supported&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Dynamic reconfiguration of endpoints (no configuration reloading)&lt;/td>
&lt;td>Supported with a third-party Lua module&lt;/td>
&lt;td>Not supported&lt;/td>
&lt;td>Supported&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>&lt;em>å†…å®¹æ¥æºï¼š&lt;a href="https://github.com/nginxinc/kubernetes-ingress/blob/master/docs/nginx-ingress-controllers.md">NGINX Ingress Controller æ–‡æ¡£&lt;/a>&lt;/em>&lt;/p>
&lt;p>æœ¬æ¬¡å‘å¸ƒçš„ 1.5.1 å°† NGINX ç‰ˆæœ¬æ›´æ–°åˆ°äº† 1.17.1 ï¼Œå‡çº§æ—¶å¯ç›´æ¥ä½¿ç”¨ &lt;code>nginx/nginx-ingress:1.5.1&lt;/code> æˆ– &lt;code>nginx/nginx-ingress:1.5.1-alpine&lt;/code> ä¹Ÿå¯ç›´æ¥ä½¿ç”¨ 0.3.1 çš„ Helm Chart&lt;/p>
&lt;p>æ›´å¤šä¿¡æ¯è¯·å‚è€ƒ &lt;a href="https://github.com/nginxinc/kubernetes-ingress/releases/tag/v1.5.1">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="kubernetes-ä¸Šæ¸¸è¿›å±•">Kubernetes ä¸Šæ¸¸è¿›å±•&lt;/h2>
&lt;p>æ¥è¯´ä¸€ç‚¹ä¸Šæ¸¸å¼€å‘çš„è¿›å±•å§&lt;/p>
&lt;ul>
&lt;li>
&lt;p>æ–°å¢äº† &lt;code>Runtimeclass&lt;/code> çš„å‡†å…¥æ§åˆ¶ï¼Œé€šè¿‡è¿™ä¸ªæ–°çš„ç‰¹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥è®¡ç®—å’Œ Pod çš„ sanbox ç»‘å®šçš„èµ„æºäº†, å‚è§ &lt;a href="https://github.com/kubernetes/kubernetes/pull/78484">78484&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æ–°å¢äº†å¯¹åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šå¯éƒ¨ç½²çš„æ¯ä¸ªå·ç±»å‹çš„æ•°é‡çš„é™åˆ¶, å‚è§ &lt;a href="https://github.com/kubernetes/kubernetes/pull/77595">77595&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>kubeadm ä¿®å¤äº†ä¸€ä¸ª &lt;code>reset&lt;/code> å‘½ä»¤æ—¶å€™ä½¿ç”¨é”™è¯¯çš„å‡½æ•°, å‚è§ &lt;a href="https://github.com/kubernetes/kubernetes/pull/79326">79326&lt;/a>&lt;/p>
&lt;/li>
&lt;/ul>
&lt;hr>
&lt;p>å¯ä»¥é€šè¿‡ä¸‹é¢äºŒç»´ç è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| 2019-06-24~2019-06-30</title><link>https://moelove.info/2019/06/30/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-2019-06-24~2019-06-30/</link><guid isPermaLink="true">https://moelove.info/2019/06/30/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-2019-06-24~2019-06-30/</guid><pubDate>Sun, 30 Jun 2019 23:12:13 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="kind-kubernetes-in-docker-v040-æ­£å¼å‘å¸ƒ">kind (Kubernetes In Docker) v0.4.0 æ­£å¼å‘å¸ƒ&lt;/h2>
&lt;p>kind (Kubernetes In Docker) æ˜¯æˆ‘å¾ˆå–œæ¬¢å¹¶ä¸”ä¸€ç›´æŒç»­å‚ä¸è´¡çŒ®çš„é¡¹ç›®ï¼Œæœ¬å‘¨å‘å¸ƒäº† v0.4.0 ç‰ˆæœ¬ã€‚å…³äº Kind çš„ä»‹ç»å’ŒåŸºç¡€ä½¿ç”¨ï¼Œå¯ä»¥å‚è€ƒæˆ‘ä¹‹å‰å†™çš„æ–‡ç«  &lt;a href="https://zhuanlan.zhihu.com/p/60464867">ã€Šä½¿ç”¨ Kind æ­å»ºä½ çš„æœ¬åœ° Kubernetes é›†ç¾¤ã€‹&lt;/a>&lt;/p>
&lt;p>v0.4.0 ç‰ˆæœ¬ä¸­ï¼Œé»˜è®¤çš„ Kubernetes ç‰ˆæœ¬å‡çº§åˆ°äº† v1.15 ç‰ˆæœ¬ï¼Œä¸” &lt;code>kind.sigs.k8s.io/v1alpha2&lt;/code> ç‰ˆæœ¬çš„ API å·²ç»è¿‡æœŸï¼Œè¯·æ›´æ–°ä½¿ç”¨ &lt;code>kind.sigs.k8s.io/v1alpha3&lt;/code> ã€‚&lt;/p>
&lt;p>ç›®å‰æš‚æ—¶ç§»é™¤äº†ä½¿ç”¨ &lt;code>apt&lt;/code> æ„å»º Node é•œåƒçš„é€‰é¡¹ï¼Œä¹‹åç‰ˆæœ¬ä¸­å¯èƒ½ä¼šåŠ å›æ¥ï¼Œç›´æ¥ä½¿ç”¨ä¸Šæ¸¸æ„å»ºå¥½çš„äºŒè¿›åˆ¶æ–‡ä»¶è¿›è¡Œå®‰è£…ã€‚&lt;/p>
&lt;p>åœ¨æ­¤ç‰ˆæœ¬ä¸­ï¼Œæˆ‘ä»¬å¢åŠ äº†ä¸€ä¸ª &lt;code>nodes[].extraPortMappings&lt;/code> çš„é…ç½®ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡æ­¤é…ç½®è¿›è¡Œç«¯å£çš„è½¬å‘ï¼Œä»¥ä¾¿ä»å®¿ä¸»æœºä¸Šç›´æ¥è®¿é—®åˆ°é›†ç¾¤ä¸Šä½¿ç”¨ &lt;code>NodePort&lt;/code> æ–¹å¼éƒ¨ç½²çš„æœåŠ¡ï¼Œè¿™æ ·æ›´å®¹æ˜“æ¨¡æ‹ŸçœŸå®çš„ç½‘ç»œç¯å¢ƒï¼Œå¦åˆ™åªèƒ½é€šè¿‡å…¶ä»–çš„è½¬å‘æˆ–è€…ç½‘ç»œä»£ç†çš„æ–¹å¼æ¥è¿›è¡Œé€šä¿¡äº†ã€‚&lt;/p>
&lt;p>åŒæ ·çš„ï¼Œç´§è·Ÿç€ä¸Šæ¸¸çš„å¼€æ”¾ï¼Œè¿™ä¸ªç‰ˆæœ¬ä¸­ä¹Ÿå¢åŠ äº†å¯¹ IPv6 çš„æ”¯æŒï¼Œå¯ä»¥ç›´æ¥é€šè¿‡ &lt;code>networking.ipFamily&lt;/code> çš„é…ç½®è¿›è¡Œä½¿ç”¨ã€‚&lt;/p>
&lt;p>ä¸ºäº†èƒ½è®© kind æ›´åŠ æ˜“ç”¨ï¼Œä¸”æ»¡è¶³å¤šæ•° CI æˆ–è€…æµ‹è¯•ä½¿ç”¨çš„åœºæ™¯ï¼Œåœ¨è¿™ä¸ªç‰ˆæœ¬ä¸­ï¼Œæˆ‘ä»¬å°¤å…¶å¯¹å•èŠ‚ç‚¹é›†ç¾¤çš„å¯åŠ¨æ—¶é—´åšäº†ä¼˜åŒ–ï¼Œå¯ä»¥æ›´å¿«é€Ÿçš„å¯åŠ¨é›†ç¾¤ã€‚&lt;/p>
&lt;p>é¡ºä¾¿å…¬å¸ƒä¸€ä¸ªæ•°æ®ï¼Œkind ç›®å‰çš„ star æ•°æ˜¯ 2.2k ä¸Šä¸ªç‰ˆæœ¬å‘å¸ƒæ—¶æ˜¯ 1.8k å¹¶ä¸”è¿˜åœ¨æŒç»­å¢é•¿ä¸­ :)&lt;/p>
&lt;p>æ›´å¤šçš„ç»†èŠ‚å’Œä¿¡æ¯è¯·å‚è€ƒ &lt;a href="https://github.com/kubernetes-sigs/kind/releases/tag/v0.4.0">ReleaseNote&lt;/a> æ¬¢è¿å¤§å®¶ä½¿ç”¨ï¼&lt;/p>
&lt;h2 id="docker-ce-18097-å‘å¸ƒ">Docker CE 18.09.7 å‘å¸ƒ&lt;/h2>
&lt;p>è¿™æ˜¯ä¸€ä¸ªä¾‹è¡Œçš„ bugfix ç‰ˆæœ¬ï¼Œæ­¤ç‰ˆæœ¬ä¸­åŒ…å«ä¸¤ä¸ªæ¯”è¾ƒé‡è¦çš„ä¿®å¤ï¼š&lt;/p>
&lt;ul>
&lt;li>ä¿®å¤äº†æ„å»ºç³»ç»Ÿåœ¨æ„å»ºåªå«æœ‰æ³¨é‡Šçš„ Dockerfile çš„æ—¶å€™çš„ panic&lt;/li>
&lt;li>ä¿®å¤äº† CVE-2018-15664 æ¼æ´ï¼Œå…³äºæ­¤æ¼æ´çš„è¯´æ˜è¯·å‚è€ƒ&lt;a href="https://zhuanlan.zhihu.com/p/67674642">æˆ‘ä¹‹å‰çš„æ–‡ç« &lt;/a>&lt;/li>
&lt;/ul>
&lt;p>å…³äºæ­¤ç‰ˆæœ¬çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è€ƒ &lt;a href="https://github.com/docker/docker-ce/releases/tag/v18.09.7">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="linkerd2-edge-1964-å‘å¸ƒ">Linkerd2 Edge 19.6.4 å‘å¸ƒ&lt;/h2>
&lt;p>Linkerd2 æœ‰ä¸¤ä¸ªä¸»è¦å‘å¸ƒé€šé“ï¼Œé™¤å» Stable å¤–ä¾¿æ˜¯ Edge é€šé“ã€‚Edge ç‰ˆæœ¬ä¸»è¦é›†ä¸­åœ¨æ–°åŠŸèƒ½å‘å¸ƒä¸Šï¼Œå‘å¸ƒå…¶å®æ¯”è¾ƒé¢‘ç¹çš„ã€‚&lt;/p>
&lt;p>åœ¨è¿™ä¸ªç‰ˆæœ¬ä¸­æœ€ä¸»è¦çš„ç‰¹æ€§åœ¨äºæ”¯æŒäº† &lt;a href="https://github.com/deislabs/smi-spec/blob/master/traffic-split.md">SMI çš„ æµé‡åˆ‡å‰² API&lt;/a>ã€‚&lt;/p>
&lt;p>å½“åˆ›å»ºäº† TrafficSplit èµ„æºåï¼ŒLinkerd ä¾¿å¯æ ¹æ®é…ç½®å¯¹æµé‡è¿›è¡Œåˆ‡å‰²ã€‚&lt;/p>
&lt;p>å…ˆæš‚ä¸”ä¸è¯´è¿™ä¸ªåŠŸèƒ½åˆ°åº•å¦‚ä½•ï¼Œåªè¯´ Linkerd æ”¯æŒ SMI è¿™ä¸ªäº‹æƒ…ï¼Œå°±å·²ç»æ˜¯åœ¨å¾€å¥½çš„æ–¹é¢èµ°äº†ï¼Œè¿™å¾ˆæœ‰åˆ©äº SMI çš„æ ‡å‡†åŒ–æ¨è¿›ã€‚&lt;/p>
&lt;p>å…³äºæ­¤ç‰ˆæœ¬çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è€ƒ &lt;a href="https://github.com/linkerd/linkerd2/releases/tag/edge-19.6.4">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="istio-122-å‘å¸ƒ">Istio 1.2.2 å‘å¸ƒ&lt;/h2>
&lt;p>æœ€è¿‘ Istio å‘å¸ƒå¾ˆé¢‘ç¹ï¼ŒåŒ…æ‹¬ 1.0.9ã€1.1.10 å’Œ 1.2.1 éƒ½æ˜¯åœ¨æœ¬å‘¨å†…å‘å¸ƒçš„ã€‚&lt;/p>
&lt;p>å…¶å®ä¸»è¦å†…å®¹éƒ½æ˜¯ bugfix ä½†ä¹Ÿæœ‰ä¸€äº›ç‰¹æ€§çš„å¢åŠ ï¼Œæ¯”å¦‚å…è®¸é€šè¿‡è®¾ç½®ä¸º 0 ä»¥ç¦æ­¢ Istio é»˜è®¤çš„é‡è¯•æ¬¡æ•°ã€‚&lt;/p>
&lt;p>è¿™é‡Œä¸åšå¤ªå¤šå±•å¼€äº†ï¼Œå…³äºæ­¤ç‰ˆæœ¬çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è€ƒ &lt;a href="https://istio.io/about/notes/1.2.2/">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="coredns-151-æ­£å¼å‘å¸ƒ">CoreDNS 1.5.1 æ­£å¼å‘å¸ƒ&lt;/h2>
&lt;p>CoreDNS å‘å¸ƒäº† 1.5.1 ç‰ˆæœ¬ï¼Œæ­¤ç‰ˆæœ¬ä¸­åŒ…å«äº†ä¸å°‘çš„ bugfixï¼Œå½“ç„¶ä¹Ÿæœ‰äº›ç‰¹æ€§å¢å¼ºã€‚&lt;/p>
&lt;p>æ­¤ç‰ˆæœ¬å¢åŠ äº†ä¸€ä¸ªæ–°çš„ &lt;code>any&lt;/code> æ’ä»¶ï¼Œå¯ä»¥é€šè¿‡æ­¤æ’ä»¶ç¦æ­¢ä»»æ„çš„æŸ¥è¯¢ã€‚&lt;/p>
&lt;p>ä¿®å¤äº†é‡å¯æ—¶çš„é—®é¢˜ï¼Œå½“é‡å¯æˆ–è€…é…ç½®æ–‡ä»¶ä¸è§„èŒƒçš„æ—¶å€™ï¼Œ &lt;code>ready&lt;/code> &lt;code>health&lt;/code> å’Œ &lt;code>prometheus&lt;/code> æ’ä»¶ç­‰éƒ½å°†ç»§ç»­å·¥ä½œã€‚&lt;/p>
&lt;p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¢åŠ äº†å¯¹å®¢æˆ·ç«¯ TLS è¯ä¹¦çš„éªŒè¯ï¼Œä¸è¿‡æ­¤ç‰ˆæœ¬ä¸­å¹¶æ²¡æœ‰æ›´æ”¹é»˜è®¤è¡Œä¸ºï¼Œé¢„æœŸåœ¨ 1.6 ç‰ˆæœ¬ä¸­ï¼Œä¼šå°† TLS çš„é»˜è®¤è¡Œä¸ºä¿®æ”¹ä¸º &lt;code>required_and_verify&lt;/code> ã€‚&lt;/p>
&lt;p>å…³äºæ­¤ç‰ˆæœ¬çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è€ƒ &lt;a href="https://coredns.io/2019/06/26/coredns-1.5.1-release/">ReleaseNote&lt;/a>&lt;/p>
&lt;hr>
&lt;p>å¯ä»¥é€šè¿‡ä¸‹é¢äºŒç»´ç è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| 2019-06-17~2019-06-23</title><link>https://moelove.info/2019/06/22/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-2019-06-17~2019-06-23/</link><guid isPermaLink="true">https://moelove.info/2019/06/22/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-2019-06-17~2019-06-23/</guid><pubDate>Sat, 22 Jun 2019 23:23:17 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="kubernetes-v1150-æ­£å¼å‘å¸ƒ">Kubernetes v1.15.0 æ­£å¼å‘å¸ƒ&lt;/h2>
&lt;p>ç»è¿‡äº†ä¸‰ä¸ªæœˆå·¦å³çš„å¼€å‘ï¼ŒKubernetes v1.15.0 æ­£å¼å‘å¸ƒäº†ã€‚&lt;/p>
&lt;p>è¿™æ˜¯ 2019 å¹´ Kubernetes å‘å¸ƒçš„ç¬¬äºŒä¸ªç‰ˆæœ¬ï¼Œè¿™ä¸ªç‰ˆæœ¬ç”± 25 ä¸ªå¢å¼ºåŠŸèƒ½ç»„æˆï¼Œå…¶ä¸­ 2 ä¸ªç§»åŠ¨åˆ° stable ï¼Œ13 ä¸ª beta ä»¥åŠ 10 ä¸ª alpha ï¼Œæ•´ä½“ä¸Šé›†ä¸­äºç¨³å®šæ€§æ”¹è¿›å’Œæ‰©å±•çš„å¢å¼ºã€‚&lt;/p>
&lt;p>CRD (Custom Resource Definition) æ˜¯ Kubernetes æä¾›çš„ä¸€ç§å¯ç”¨äºæ‰©å±•å…¶èƒ½åŠ›çš„æ–¹å¼ï¼Œå½“å‰æœ‰å¾ˆå¤šä½¿ç”¨ CRD æ„å»ºäº Kubernetes ä¸Šçš„å¹³å°/ç³»ç»Ÿï¼Œå¯ä»¥è¯´ä¹‹åå¯¹ Kubernetes çš„æ‰©å±•ï¼Œæˆ–è€…è¯´æƒ³è¦åŸºäº Kubernetes å¼€å‘ï¼ŒåŒæ—¶åˆæƒ³ä¸ä¸Šæ¸¸ä¿æŒåŒæ­¥çš„è¯ï¼ŒCRD æ˜¯ä¸ªæœ€ä½³çš„é€‰æ‹©ã€‚&lt;/p>
&lt;p>Kubeadm åœ¨æ­¤ç‰ˆæœ¬å¼€å§‹æœ‰äº†è‡ªå·±ç‹¬ç«‹çš„ LOGO ï¼ŒåŒæ—¶åœ¨è¿™ä¸ªç‰ˆæœ¬ä¸­ kubeadm çš„åŠŸèƒ½ä¹Ÿå¾—åˆ°äº†å¾ˆå¤šçš„å®Œå–„å’Œè¡¥å……ã€‚è¿™ä½¿å¾— kubeadm æˆä¸ºæ›´æ™®é/æ›´å¥½ç”¨çš„æ­å»ºé›†ç¾¤çš„å·¥å…·ï¼ŒåŒæ—¶å¯¹é›†ç¾¤ç”Ÿå‘½å‘¨æœŸçš„ç®¡ç†ä¹Ÿåšçš„æ›´åŠ åˆ°ä½äº†ã€‚è¿™éƒ¨åˆ†çš„åŠŸèƒ½æˆ‘å¾ˆå–œæ¬¢ä¹Ÿä¸€ç›´åœ¨å…³æ³¨ï¼Œè¿‘æœŸæˆ‘ä¼šé’ˆå¯¹è¿™éƒ¨åˆ†å†™ç¯‡æ–‡ç« å‡ºæ¥ã€‚æ„Ÿå…´è¶£çš„æœ‹å‹ä»¬å¯ä»¥&lt;a href="https://gitbook.cn/gitchat/activity/5d0b4ed9a81a44231ac6c9ba">å…³æ³¨ä¸‹&lt;/a>&lt;/p>
&lt;p>å…³äºæ­¤ç‰ˆæœ¬æ›´å¤šçš„ä»‹ç»ï¼Œå¯å‚è€ƒ &lt;a href="https://github.com/kubernetes/kubernetes/releases/tag/v1.15.0">Kubernetes v1.15 ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="istio-120-æ­£å¼å‘å¸ƒ">Istio 1.2.0 æ­£å¼å‘å¸ƒ&lt;/h2>
&lt;p>ç»è¿‡ä¸‰ä¸ª rc ç‰ˆæœ¬ä¹‹åï¼Œ Istio 1.2.0 ç‰ˆæœ¬æ­£å¼å‘å¸ƒã€‚&lt;/p>
&lt;p>åœ¨è¿™ä¸ªç‰ˆæœ¬ä¸­ï¼Œå®ƒæ·»åŠ äº†å¯¹ Kubernetes IPv6 çš„å®éªŒæ€§æ”¯æŒã€‚Kind ï¼ˆKubernetes in Dockerï¼‰ é¡¹ç›®ä¹Ÿæ˜¯æœ¬å‘¨å†…åˆšå¢åŠ äº† IPv6 çš„æ”¯æŒ :)&lt;/p>
&lt;p>åŒæ—¶åœ¨è¿™ä¸ªç‰ˆæœ¬ä¸­ï¼Œè‡ªç­¾åè¯ä¹¦çš„æœ‰æ•ˆæœŸä¹Ÿè¢«è®¾ç½®æˆäº† 10 å¹´ï¼Œè¿™å¯ä»¥å¤§å¤§é¿å…å¾ˆå¤šäººçš„æ‹…å¿§ï¼Œæœ‰åˆ©äºä¿ƒè¿›ç”¨æˆ·çš„ä½¿ç”¨ã€‚&lt;/p>
&lt;p>æ­¤å¤–å®ƒè¿˜å¯¹å¾ˆå¤šåŠŸèƒ½åšäº†å‡çº§ï¼ŒåŒæ—¶å®ƒä¹Ÿå¢åŠ äº†å¯¹ CRD çš„éªŒè¯ä¹‹ç±»çš„ã€‚&lt;/p>
&lt;p>æ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥é˜…è¯» &lt;a href="https://istio.io/about/notes/1.2/">Istio 1.2.0 ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="alpine-linux-310-æ­£å¼å‘å¸ƒ">Alpine Linux 3.10 æ­£å¼å‘å¸ƒ&lt;/h2>
&lt;p>Alpine Linux å‡­å€Ÿå…¶å®‰å…¨åŠä½“ç§¯å°ç­‰ä¼˜åŠ¿ï¼Œåœ¨å®¹å™¨åŒ–æ—¶ä»£å¸¦æ¥äº†ä¸€å¤§æ‰¹çš„æ”¯æŒè€…ï¼Œç°åœ¨ç¤¾åŒºå‘å±•ä¹Ÿç®—æ¯”è¾ƒæ´»è·ƒã€‚&lt;/p>
&lt;p>è¿™æ¬¡å‘å¸ƒäº† 3.10 ç‰ˆæœ¬ï¼Œå„ç±»è½¯ä»¶åŒ…éƒ½å·²ç»å‡çº§åˆ°äº†æœ€æ–°ç‰ˆï¼ŒåŒæ—¶æ¼æ´ä¹Ÿä¼šç›¸å¯¹å°‘ä¸€ç‚¹ã€‚&lt;/p>
&lt;p>æ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥å‚è€ƒ &lt;a href="https://alpinelinux.org/posts/Alpine-3.10.0-released.html">Alpine Linux 3.10 ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="kubecon--cloudnativecon-å°†åœ¨ä¸Šæµ·å¬å¼€">KubeCon + CloudNativeCon å°†åœ¨ä¸Šæµ·å¬å¼€&lt;/h2>
&lt;p>2019å¹´ï¼ŒKubeCon + CloudNativeCon å’Œ Open Source Summit å°†åœ¨ä¸Šæµ·ä¸–åšä¸­å¿ƒä¸¾åŠä¸ºæœŸä¸‰å¤©çš„å¤§ä¼šï¼Œå±Šæ—¶ä¼šæœ‰å¾ˆå¤š CNCF é¡¹ç›®çš„ç»´æŠ¤è€…å‚ä¸ï¼Œä¹Ÿä¼šæœ‰å›½å†…å¤–å…¬å¸çš„æŠ€æœ¯åˆ†äº«ï¼Œå€¼å¾—å…³æ³¨ã€‚&lt;/p>
&lt;p>å†™è¿™ç¯‡ k8s å‘¨æŠ¥çš„æ—¶å€™ï¼Œæˆ‘å·²ç»åœ¨ä¸Šæµ·äº†ã€‚ä¼šå’Œå¤§å®¶åˆ†äº«ä¸€äº›æˆ‘çš„æ‰€è§æ‰€é—»åŠäº†è§£åˆ°çš„ä¿¡æ¯ã€‚ ä¹ŸæœŸå¾…å’Œå¾ˆå¤šä¸€ç›´åˆä½œ/ç½‘ç»œäº¤æµçš„æœ‹å‹ä»¬é¢åŸºä¸‹ã€‚&lt;/p>
&lt;p>å¤§ä¼šæ—¥ç¨‹ï¼š &lt;a href="https://www.lfasiallc.com/events/kubecon-cloudnativecon-china-2019/">https://www.lfasiallc.com/events/kubecon-cloudnativecon-china-2019/&lt;/a>&lt;/p>
&lt;hr>
&lt;p>å¯ä»¥é€šè¿‡ä¸‹é¢äºŒç»´ç è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| 2019-06-10~2019-06-16</title><link>https://moelove.info/2019/06/16/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-2019-06-10~2019-06-16/</link><guid isPermaLink="true">https://moelove.info/2019/06/16/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-2019-06-10~2019-06-16/</guid><pubDate>Sun, 16 Jun 2019 23:17:17 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="helm-æ–°ä¸‹è½½åŸŸåæ­£å¼ä¸Šçº¿">Helm æ–°ä¸‹è½½åŸŸåæ­£å¼ä¸Šçº¿&lt;/h2>
&lt;p>&lt;a href="https://get.helm.sh/">https://get.helm.sh/&lt;/a> æ­£å¼ä¸Šçº¿ã€‚ç”¨æˆ·ä¹‹åä¸‹è½½ Helm é¢„ç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶æ–‡ä»¶æ—¶ï¼Œå¯é€šè¿‡æ­¤åŸŸåè¿›è¡Œä¸‹è½½ã€‚&lt;/p>
&lt;p>åŸæ¥ Kubernetes å°šæœªæˆä¸º CNCF æ‰˜ç®¡é¡¹ç›®æ—¶ï¼ŒHelm æ˜¯ä½œä¸º Kubernetes é¡¹ç›®çš„ä¸€éƒ¨åˆ†çš„ï¼Œæ‰€ä»¥å¾ˆè‡ªç„¶çš„ä½¿ç”¨äº† Google çš„ä¸€ä¸ªäº‘å­˜å‚¨ä»“åº“ã€‚ä½†éšç€é¡¹ç›®æ‰˜ç®¡è‡³ CNCF ä»¥åŠåç»­ Helm çš„ç‹¬ç«‹å‘å±•ï¼Œç°åœ¨ä½¿ç”¨æ‰˜ç®¡äº Google çš„äº‘å­˜å‚¨ä¸é‚£ä¹ˆåˆé€‚äº†ï¼Œä¸€æ–¹é¢åœ¨äº CNCF æ­£åœ¨æ¥ç®¡ K8S çš„åŸºç¡€è®¾æ–½ï¼Œå¦ä¸€æ–¹é¢åœ¨äºåœ¨äºè¿™ä¸ªä»“åº“ä¸åªå— Helm çš„æ§åˆ¶ã€‚&lt;/p>
&lt;p>è€ƒè™‘åˆ°é¡¹ç›®çš„ç‹¬ç«‹æ€§ï¼Œä»¥åŠ &lt;strong>å¤§é™†ç”¨æˆ·æ— æ³•æ­£å¸¸è®¿é—® GCloud å­˜å‚¨çš„é—®é¢˜&lt;/strong> ç»è¿‡ç»´æŠ¤è€…ä»¬çš„æ…é‡è€ƒè™‘ä»¥åŠå®é™…æµ‹è¯•ï¼Œç»ˆäºå†³å®šé€‰æ‹© Azure çš„ Blob å­˜å‚¨ + CDN å¯æ»¡è¶³å½“å‰æ‰€æœ‰åœ°åŒºçš„å¿«é€Ÿè®¿é—®ï¼ˆå°¤å…¶æ˜¯å›½å†…å¯ä»¥ç›´æ¥è®¿é—®å¹¶ä¸‹è½½ï¼‰ï¼Œä¸å†éœ€è¦èŠ±è´¹æ—¶é—´ç²¾åŠ›è§£å†³ç½‘ç»œç­‰é—®é¢˜äº†ã€‚&lt;/p>
&lt;p>&lt;strong>è¿™æ¬¡çš„æ›´æ”¹ä»…é™äº Helm å®¢æˆ·ç«¯çš„ä¸‹è½½ä½ç½®ï¼Œç±»ä¼¼ Tiller æˆ–è€… Chart ç­‰å¹¶æ²¡æœ‰è¢«åŒ…å«åœ¨å†…ã€‚&lt;/strong>&lt;/p>
&lt;p>å¼ºçƒˆå»ºè®®æ›´æ–°æœ‰åœ¨ CI/è‡ªåŠ¨åŒ–ä»»åŠ¡ä¸­ä½¿ç”¨çš„ Helm ä¸‹è½½åœ°å€ï¼Œä½¿ç”¨ &lt;a href="https://get.helm.sh/">https://get.helm.sh/&lt;/a> æ¥è¿›è¡Œæ›¿æ¢ã€‚&lt;/p>
&lt;p>å¯¹æ­¤å†…å®¹æ„Ÿå…´è¶£çš„æœ‹å‹å¯å‚è€ƒ &lt;a href="https://github.com/helm/helm/issues/5663">Move Helm Downloads&lt;/a> çš„è®¨è®º&lt;/p>
&lt;h2 id="apple-ä½œä¸ºç™½é‡‘ç»ˆç«¯ç”¨æˆ·æˆå‘˜åŠ å…¥-cncf">Apple ä½œä¸ºç™½é‡‘ç»ˆç«¯ç”¨æˆ·æˆå‘˜åŠ å…¥ CNCF&lt;/h2>
&lt;p>Apple åœ¨ K8S ç¤¾åŒºä¸­åœ¨è¿™ä¹‹å‰ä¹Ÿç®—ç›¸å¯¹ä½è°ƒï¼Œå¹¶æ²¡æœ‰åƒå„ç±»äº‘å‚å•†æˆ–å…¶ä»–å…¬å¸é‚£æ ·ç–¯ç‹‚å®‰åˆ©æˆ–è€…è¾“å‡ºä¹‹ç±»çš„ã€‚ä½†æ˜¯è¿™æ¬¡çªç„¶åŠ å…¥ CNCF è€Œä¸”ä½œä¸ºç™½é‡‘ä¼šå‘˜ï¼Œæ˜¯å¯å…·å¤‡è¯è¯­æƒçš„ã€‚&lt;/p>
&lt;p>ä¹‹åä¼šæœ‰ä»€ä¹ˆåŠ¨ä½œï¼Œç›®å‰ä¸å¾—è€ŒçŸ¥ï¼Œä½†æ˜¯éšç€ Apple ä½œä¸ºç™½é‡‘ä¼šå‘˜åŠ å…¥ï¼Œå¯¹äº CNCF å½“ç„¶æ˜¯ä»¶åˆ©å¥½çš„äº‹æƒ…ï¼ŒæœŸå¾…åç»­çš„è¿›å±•ã€‚&lt;/p>
&lt;p>å¯¹æ­¤å†…å®¹æ„Ÿå…´è¶£çš„æœ‹å‹å¯å‚è€ƒ &lt;a href="https://www.cncf.io/blog/2019/06/11/apple-joins-cloud-native-computing-foundation-as-platinum-end-user-member/">Apple Join CNCF&lt;/a> çš„å®˜æ–¹è¯´æ˜ã€‚&lt;/p>
&lt;h2 id="containerd-127-æ­£å¼å‘å¸ƒ">containerd 1.2.7 æ­£å¼å‘å¸ƒ&lt;/h2>
&lt;p>è¿™ä¸ªç‰ˆæœ¬å…¶å®ä¹Ÿæ˜¯ä¸ª patch ç‰ˆæœ¬ï¼Œä½†å…¶ä¸­ä¹ŸåŒ…å«äº†ä¸€äº›æ¯”è¾ƒé‡è¦çš„ç‰¹æ€§ã€‚&lt;/p>
&lt;p>è¿™ä¸ªç‰ˆæœ¬æ”¯æŒäº† OCI é•œåƒæè¿°ç¬¦çš„æ³¨è§£æ”¯æŒï¼›åŒ…æ‹¬äº†å¯¹ containerd shim æ—¥å¿—ã€å®¹å™¨çš„å¯/åœã€cri æ’ä»¶å’Œ SELinux çš„ä¸€äº›ä¿®å¤ã€‚&lt;/p>
&lt;p>å¦å¤–åŒ…å«äº†ä¸€äº› fd å’Œ goroutine æ³„æ¼çš„ä¿®å¤ã€‚&lt;/p>
&lt;p>ä»¥åŠ runc ä¹Ÿç»ˆäºæ›´æ–°åˆ°äº† v1.0.0-rc8 ä¹‹åä½¿ç”¨ containerd çš„æœ‹å‹ä»¬éœ€è¦ç‰¹åˆ«å…³æ³¨å†…æ ¸ç‰ˆæœ¬ä»¥åŠ SELinux ç›¸å…³çš„é…ç½®ç­‰ä¿¡æ¯ã€‚&lt;/p>
&lt;p>å¯¹æ­¤å†…å®¹æ„Ÿå…´è¶£çš„æœ‹å‹å¯å‚è€ƒ &lt;a href="https://github.com/containerd/containerd/releases/tag/v1.2.7">containerd v1.2.7 ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="kubernetes-v1150-rc1-å‘å¸ƒ">Kubernetes v1.15.0-rc1 å‘å¸ƒ&lt;/h2>
&lt;p>ä»ç„¶æ˜¯ä¾‹è¡Œçš„æ­£å¼å‘å¸ƒå‰çš„ rc ç‰ˆæœ¬ï¼Œä½†æœ‰å‡ ä¸ªç‚¹å°¤å…¶éœ€è¦æ³¨æ„ã€‚&lt;/p>
&lt;ul>
&lt;li>CoreDNS å›æ»šåˆ°äº† 1.3.1 ç‰ˆæœ¬ã€‚è¿™æ˜¯ç”±äº 1.5.0 é…ç½®åˆå¹¶çš„é—®é¢˜ï¼Œç­‰ä¹‹åæœ‰ç©ºå†æ¥ä»‹ç»è¿™ä¸ªï¼Œå½“ç„¶å¦‚æœæ²¡æœ‰å¯¹ CoreDNS å•ä¸ªç»„ä»¶æœ‰å¤ªå¤šå…¶ä»–éœ€æ±‚æˆ–è€…æŒç»­è¿½æ±‚æ–°ç‰ˆæœ¬çš„è¯ï¼Œè¿™ä¸ªé—®é¢˜ä¹Ÿå¯ä»¥è·³è¿‡ï¼›&lt;/li>
&lt;li>&lt;code>ResourceQuotaScopeSelectors&lt;/code> çš„ç‰¹æ€§åˆç”± GA é€€å›åˆ°äº† Beta ç‰ˆæœ¬ï¼Œç”±æƒ³è¦å°è¯•çš„å°ä¼™ä¼´è¦æ³¨æ„ã€‚&lt;/li>
&lt;/ul>
&lt;p>å¯¹æ­¤å†…å®¹æ„Ÿå…´è¶£çš„æœ‹å‹å¯å‚è€ƒ &lt;a href="https://github.com/kubernetes/kubernetes/releases/tag/v1.15.0-rc.1">Kubernetes v1.15.0-rc1 ReleaseNote&lt;/a>&lt;/p>
&lt;hr>
&lt;p>å¯ä»¥é€šè¿‡ä¸‹é¢äºŒç»´ç è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| 2019-06-03~2019-06-09</title><link>https://moelove.info/2019/06/09/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-2019-06-03~2019-06-09/</link><guid isPermaLink="true">https://moelove.info/2019/06/09/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-2019-06-03~2019-06-09/</guid><pubDate>Sun, 09 Jun 2019 22:15:11 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="kubernetes-cve-2019-11245-æ¼æ´">Kubernetes CVE-2019-11245 æ¼æ´&lt;/h2>
&lt;p>è¿™æ˜¯ä¸€ä¸ªè¯„åˆ†ä¸º 4.9 çš„æ¼æ´ï¼Œç®—æ˜¯ä¸€ä¸ªä¸­ç­‰æ¼æ´ã€‚ &lt;strong>å—æ­¤æ¼æ´å½±å“çš„ç‰ˆæœ¬ä¸º v1.13.6 å’Œ v1.14.2&lt;/strong> ï¼Œæ‰€ä»¥æœ¬å‘¨ä¹ŸåŠ ç´§å‘å¸ƒäº† v1.13.7 å’Œ v1.14.3 ç‰ˆæœ¬ï¼Œä»¥é¿å…å—æ­¤æ¼æ´å½±å“ã€‚ å¦‚æœæœ‰ä½¿ç”¨ v1.13.6 å’Œ v1.14.2 ç‰ˆæœ¬çš„å°ä¼™ä¼´ï¼Œè¯·å°½å¿«è¿›è¡Œ &lt;strong>å‡çº§&lt;/strong> ä»¥å…å—åˆ°å½±å“ã€‚&lt;/p>
&lt;p>ä¸Šé¢è¯´äº†æœ€ç›´æ¥çš„è§£å†³åŠæ³•ï¼Œæ¥ä¸‹æ¥å¯¹æ­¤æ¼æ´å¤§è‡´åšä¸‹ä»‹ç»ï¼š&lt;/p>
&lt;p>è¿™ä¸ªæ¼æ´å½±å“äº† v1.13.6 å’Œ v1.14.2 ç‰ˆæœ¬çš„ &lt;code>kubelet&lt;/code>ï¼Œå…·ä½“è¡¨ç°ä¸ºï¼Œ 1) å¦‚æœ Pod ä¸­çš„å®¹å™¨ï¼Œå¼€å§‹æ—¶æ˜¯ä»¥æŸä¸ªé root ç”¨æˆ·å¯åŠ¨çš„ï¼Œä½†æ˜¯å½“å®ƒé‡å¯åï¼Œåˆ™ä¼šä»¥ root (uid 0) çš„èº«ä»½å¯åŠ¨ã€‚2) æˆ–è€…æ˜¯ Node èŠ‚ç‚¹ä¸Šå·²ç»å­˜åœ¨äº†å¯åŠ¨å®¹å™¨æ‰€éœ€çš„é•œåƒã€‚&lt;/p>
&lt;p>ç¬¬ 2 ä¸ªæƒ…å†µæ¯”è¾ƒå¸¸è§ï¼Œä¸å†å…·ä½“ä»‹ç»ã€‚æˆ‘ä»¬æ¥çœ‹ä¸‹ç¬¬ 1 ç§æƒ…å†µã€‚ä¸¾ä¸ªæ —å­ï¼š&lt;/p>
&lt;p>é€šå¸¸æƒ…å†µä¸‹ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨ Docker å®˜æ–¹çš„ Redis é•œåƒè¿›è¡Œéƒ¨ç½²çš„æ—¶å€™ï¼Œé»˜è®¤æƒ…å†µä¸‹å°†ä¼šä»¥ &lt;code>redis&lt;/code> ç”¨æˆ·å¯åŠ¨ï¼›è€Œå¦‚æœå—æ­¤æ¼æ´å½±å“ï¼Œå½“å®¹å™¨é‡å¯åï¼Œåˆ™å½“å‰çš„ç”¨æˆ·å¯èƒ½ä¼šå˜æˆ root (uid 0) ã€‚ä½¿ç”¨ root ç”¨æˆ·å¯åŠ¨æœåŠ¡å¯èƒ½å¸¦æ¥çš„å±å®³ï¼Œè¿™é‡Œä¹Ÿä¸å†å¤šè¿›è¡Œå±•å¼€äº†ã€‚&lt;/p>
&lt;p>ä¹Ÿå­˜åœ¨ä¾‹å¤–ï¼Œæ¯”å¦‚å·²ç»æ˜¾å¼çš„é€šè¿‡ &lt;code>runAsUser&lt;/code> æŒ‡å®šäº†è¿è¡Œç”¨æˆ·ï¼Œåˆ™ä¸ä¼šå—åˆ°æ­¤æ¼æ´å½±å“ã€‚&lt;/p>
&lt;p>æ‰€ä»¥é™¤äº†å¼€å¤´è¯´çš„å‡çº§åˆ° v1.13.7 æˆ–è€… v1.14.3 ç‰ˆæœ¬å¤–ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æ˜¾å¼çš„æŒ‡å®š &lt;code>runAsUser&lt;/code> ä»¥ç¼“è§£æ­¤æ¼æ´çš„å½±å“ã€‚&lt;/p>
&lt;p>æ›´å¤šä¿¡æ¯å¯è®¿é—® &lt;a href="https://github.com/kubernetes/kubernetes/blob/master/CHANGELOG-1.13.md#v1137">v1.13.7 ReleaseNote&lt;/a> &lt;a href="https://github.com/kubernetes/kubernetes/blob/master/CHANGELOG-1.14.md#changelog-since-v1142">v1.14.3 ReleaseNote&lt;/a> å’Œ &lt;a href="https://github.com/kubernetes/kubernetes/issues/78308">CVE-2019-11245 issues&lt;/a>&lt;/p>
&lt;h2 id="docker-cve-2018-15664-å·²ç»è§£å†³">Docker CVE-2018-15664 å·²ç»è§£å†³&lt;/h2>
&lt;p>åœ¨ä¸Šå‘¨çš„ &lt;a href="https://zhuanlan.zhihu.com/p/67674642">K8S å‘¨æŠ¥&lt;/a> ä¸­ï¼Œæˆ‘æåˆ°äº† &lt;strong>Docker CVE-2018-15664 å®‰å…¨æ¼æ´&lt;/strong> , å½“æ—¶å›½å†…å¾ˆå¤šè‡ªåª’ä½“å‘å¸ƒäº†å„ç§çœ‹èµ·æ¥å¾ˆå¯æ€•çš„æ ‡é¢˜ï¼ˆè¿™é‡Œå°±ä¸ä¸¾ä¾‹äº†ï¼‰ï¼Œå®é™…ä¸Šé‚£ä¸ªæ¼æ´çš„å½±å“æ­£å¦‚æˆ‘è¯´çš„é‚£æ ·å¹¶æ²¡æœ‰ç‰¹åˆ«å¤§ã€‚&lt;/p>
&lt;p>ç°åœ¨è¯¥æ¼æ´å·²ç»ä¿®å¤ï¼Œå¹¶å°†ç§»æ¤åˆ° Docker 18.09 å’Œ 19.03 ç‰ˆæœ¬ä¸­ï¼Œæœ¬å‘¨å‘å¸ƒçš„ Docker 19.03-rc2 å°±å·²ç»åŒ…å«äº†æ­¤é¡¹ä¿®å¤ã€‚&lt;/p>
&lt;p>æ„Ÿå…´è¶£çš„æœ‹å‹å¯é˜…è¯»å…³äº &lt;a href="https://github.com/moby/moby/pull/39292">CVE-2018-15664 çš„ç›¸å…³è®¨è®º&lt;/a>&lt;/p>
&lt;h2 id="docker-1903-rc2-å‘å¸ƒ">Docker 19.03-rc2 å‘å¸ƒ&lt;/h2>
&lt;p>è¿™ä»ç„¶æ˜¯ä¸€ä¸ªæ­£å¼ç‰ˆæœ¬å‘å¸ƒå‰çš„å¸¸è§„æµ‹è¯•ç‰ˆæœ¬ï¼Œæ­£å¦‚ä¸Šé¢æåˆ°çš„ï¼Œè¿™ä¸ªç‰ˆæœ¬ä¸­åŒ…å«äº†å¯¹ CVE-2018-15664 çš„ä¿®å¤ã€‚åŒæ—¶åœ¨æ­¤ç‰ˆæœ¬ä¸­ï¼Œè¿˜åŒ…å«äº†æ„å»ºç³»ç»Ÿä¸­ï¼Œå¯èƒ½å¯¼è‡´é”™è¯¯çš„ä¸€äº› bug ã€‚&lt;/p>
&lt;p>å¯¹æ­¤ç‰ˆæœ¬æœ‰å…´è¶£çš„æœ‹å‹å¯é˜…è¯» &lt;a href="https://github.com/docker/docker-ce/releases/tag/v19.03.0-rc2">19.03-rc2 ReleaseNote&lt;/a>; å¯¹ Docker æ„å»ºç³»ç»Ÿæœ‰å…´è¶£çš„æœ‹å‹å¯ä»¥é˜…è¯»æˆ‘å†™çš„ &lt;a href="https://moelove.info/2019/06/01/Docker-%E9%95%9C%E5%83%8F%E6%9E%84%E5%BB%BA%E4%B8%89%E9%83%A8%E6%9B%B2/">Docker æ„å»ºä¸‰éƒ¨æ›²&lt;/a>&lt;/p>
&lt;h2 id="istio-120-rc0-å‘å¸ƒ">Istio 1.2.0-rc.0 å‘å¸ƒ&lt;/h2>
&lt;p>è¿™ä¸ªç‰ˆæœ¬çš„å˜åŠ¨å…¶å®è¿˜ç®—æ¯”è¾ƒå¤§ï¼Œä½†è¿™é‡Œæš‚æ—¶å…ˆä¸ä»‹ç»äº†ï¼Œè¿˜åœ¨æŒç»­è¿­ä»£ä¸­ï¼Œå…·ä½“çš„ä»‹ç»æˆ‘ç­‰æ­£å¼ç‰ˆå‘å¸ƒåå†ä»‹ç»å¥½äº†ã€‚&lt;/p>
&lt;p>è¿™é‡Œåªè¯´ä¸€ä¸ªå¯èƒ½å¾ˆå¤šç”¨æˆ·éƒ½ä¼šåœ¨æ„çš„æ”¹åŠ¨ï¼ŒIstio ä¸­è‡ªç­¾çš„ CA æ ¹è¯ä¹¦é»˜è®¤æœ‰æ•ˆæœŸæ˜¯ 1 å¹´ï¼Œä½†æ˜¯åœ¨ 1.2 ä¸­ï¼Œæœ‰æ•ˆæœŸå·²ç»ä¿®æ”¹æˆäº†é»˜è®¤ 10 å¹´ã€‚å¤§æ¦‚è¿™ä¸ªæ”¹åŠ¨èƒ½å…é™¤ä¸€äº›ç”¨æˆ·çš„æ‹…å¿§ã€‚&lt;/p>
&lt;p>å¯¹æ­¤ç‰ˆæœ¬æ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥åœ¨ &lt;a href="https://github.com/istio/istio/releases/tag/1.2.0-rc.0">Istio 1.2.0-rc.0 çš„ Release é¡µé¢&lt;/a> è¿›è¡Œå°é²œä½“éªŒ&lt;/p>
&lt;hr>
&lt;p>å¯ä»¥é€šè¿‡ä¸‹é¢äºŒç»´ç è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>Docker é•œåƒæ„å»ºä¸‰éƒ¨æ›²</title><link>https://moelove.info/2019/06/01/Docker-%E9%95%9C%E5%83%8F%E6%9E%84%E5%BB%BA%E4%B8%89%E9%83%A8%E6%9B%B2/</link><guid isPermaLink="true">https://moelove.info/2019/06/01/Docker-%E9%95%9C%E5%83%8F%E6%9E%84%E5%BB%BA%E4%B8%89%E9%83%A8%E6%9B%B2/</guid><pubDate>Sat, 01 Jun 2019 00:19:03 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>æˆ‘æœ€è¿‘åœ¨ GitChat å†™äº†ä¸€äº› Docker æ„å»ºé•œåƒç›¸å…³çš„æ–‡ç« ï¼Œè¿™ä¸ªç³»åˆ—å†™äº†ä¸‰ç¯‡ï¼Œé€šè¿‡è¿™ä¸‰ç¯‡å°† Docker æ„å»ºé•œåƒç›¸å…³çš„äº‹æƒ…åŸºæœ¬å°±è®²æ˜ç™½äº†ï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹æ‰«æäºŒç»´ç æˆ–è€…ç‚¹å‡»é“¾æ¥å³å¯ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="é«˜æ•ˆæ„å»º-docker-é•œåƒçš„æœ€ä½³å®è·µ">é«˜æ•ˆæ„å»º Docker é•œåƒçš„æœ€ä½³å®è·µ&lt;/h2>
&lt;p>Docker å¯è°“æ˜¯å¼€å¯äº†å®¹å™¨åŒ–æŠ€æœ¯çš„æ–°æ—¶ä»£ï¼Œç°åœ¨æ— è®ºå¤§ä¸­å°å…¬å¸åŸºæœ¬ä¸Šéƒ½å¯¹å®¹å™¨åŒ–æŠ€æœ¯æœ‰ä¸åŒç¨‹åº¦çš„å°è¯•ï¼Œæˆ–æ˜¯å·²ç»è¿›è¡Œäº†å¤§é‡å®¹å™¨åŒ–çš„æ”¹é€ ã€‚ä¼´éšç€ Kubernetes å’Œ Cloud Native ç­‰æŠ€æœ¯å’Œç†å¿µçš„æ™®åŠï¼Œä¹Ÿå¤§å¤§å¢åŠ äº†ä¸šåŠ¡å®¹å™¨åŒ–éœ€æ±‚ã€‚&lt;/p>
&lt;p>è€Œè¿™ä¸€åˆ‡çš„æ¨è¿›ï¼Œä¸å¯é¿å…çš„æŠ€æœ¯ä¹‹ä¸€ä¾¿æ˜¯æ„å»ºå®¹å™¨é•œåƒã€‚&lt;/p>
&lt;p>åœ¨æœ¬åœº Chat ä¸­ï¼Œä¼šè®²åˆ°å¦‚ä¸‹å†…å®¹ï¼š&lt;/p>
&lt;ul>
&lt;li>Docker é•œåƒæ˜¯ä»€ä¹ˆ&lt;/li>
&lt;li>Docker é•œåƒå¸¸è§„ç®¡ç†æ“ä½œ&lt;/li>
&lt;li>å¦‚ä½•æ„å»º Docker é•œåƒ&lt;/li>
&lt;li>é€æ­¥åˆ†è§£æ„å»º Docker é•œåƒçš„æœ€ä½³å®è·µ&lt;/li>
&lt;li>å¦‚ä½•æå‡æ„å»ºæ•ˆç‡&lt;/li>
&lt;/ul>
&lt;p>é€‚åˆäººç¾¤ï¼š å¯¹é«˜æ•ˆæ„å»º Docker é•œåƒæœ‰å…´è¶£çš„æŠ€æœ¯äººå‘˜&lt;/p>
&lt;p>&lt;img src="https://moelove.info/img/docker-chat-1.jpg" alt="é«˜æ•ˆæ„å»º Docker é•œåƒçš„æœ€ä½³å®è·µ">&lt;/p>
&lt;p>åœ°å€ï¼šhttps://gitbook.cn/gitchat/activity/5cd527e864de19331ba79278&lt;/p>
&lt;h2 id="è¿›é˜¶dockerfile-é«˜é˜¶ä½¿ç”¨æŒ‡å—åŠé•œåƒä¼˜åŒ–">è¿›é˜¶ï¼šDockerfile é«˜é˜¶ä½¿ç”¨æŒ‡å—åŠé•œåƒä¼˜åŒ–&lt;/h2>
&lt;p>åœ¨ä¸Šæ¬¡çš„ Chat &lt;a href="https://gitbook.cn/gitchat/activity/5cd527e864de19331ba79278">é«˜æ•ˆæ„å»º Docker é•œåƒçš„æœ€ä½³å®è·µ&lt;/a> ä¸­ï¼Œæˆ‘ä»¬é‡ç‚¹æ·±å…¥å†…éƒ¨ä»‹ç»äº† Docker é•œåƒæ˜¯ä»€ä¹ˆï¼›ä»¥åŠæ„å»º Docker é•œåƒçš„æœ€ä½³å®è·µç­‰ã€‚&lt;/p>
&lt;p>å³å°†å‘å¸ƒçš„ Docker 19.03 ç‰ˆæœ¬ä¸­ Dockerfile åŠæ„å»ºç³»ç»Ÿæœ‰äº†å¾ˆå¤šå˜åŒ–ã€‚&lt;/p>
&lt;p>åœ¨æœ¬åœº Chat ä¸­ï¼Œä¼šè®²åˆ°å¦‚ä¸‹å†…å®¹ï¼š&lt;/p>
&lt;ul>
&lt;li>Dockerfile é«˜é˜¶ä½¿ç”¨åŠæ–°ç‰¹æ€§è§£è¯»&lt;/li>
&lt;li>Docker 19.03 æ„å»ºç³»ç»Ÿè§£è¯»&lt;/li>
&lt;li>Docker é•œåƒå®‰å…¨å®è·µ&lt;/li>
&lt;li>å‘ç°å¹¶ä¼˜åŒ–é•œåƒå¤§å°&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://moelove.info/img/docker-chat-2.jpg" alt="è¿›é˜¶ï¼šDockerfile é«˜é˜¶ä½¿ç”¨æŒ‡å—åŠé•œåƒä¼˜åŒ–">&lt;/p>
&lt;p>åœ°å€ï¼šhttps://gitbook.cn/gitchat/activity/5cdc40db94539c0c5ded160c&lt;/p>
&lt;h2 id="docker-é•œåƒæ„å»ºåŸç†åŠæºç åˆ†æ">Docker é•œåƒæ„å»ºåŸç†åŠæºç åˆ†æ&lt;/h2>
&lt;p>é€šè¿‡å‰ä¸¤æ¬¡çš„ Chatã€Šé«˜æ•ˆæ„å»º Docker é•œåƒçš„æœ€ä½³å®è·µã€‹å’Œã€Šè¿›é˜¶ï¼šDockerfile é«˜é˜¶ä½¿ç”¨æŒ‡å—åŠé•œåƒä¼˜åŒ–ã€‹æˆ‘ä»¬å¯¹ Dockerfile çš„å®è·µã€é•œåƒä¼˜åŒ–ä»¥åŠ Docker çš„æ„å»ºç³»ç»Ÿåº”è¯¥æœ‰äº†å¾ˆæ·±å±‚æ¬¡çš„äº†è§£ã€‚&lt;/p>
&lt;p>æœ¬æ¬¡ Chat æ˜¯ç»§ç»­æ·±å…¥ Docker é•œåƒçš„æ„å»ºï¼Œç»“åˆæºç åˆ†æä¸Šä¸€ä»£çš„æ„å»ºç³»ç»Ÿä¸æ–°ä¸€ä»£æ„å»ºç³»ç»Ÿçš„å·®å¼‚ï¼Œå¸®ä½ æ›´å¥½çš„æŒæ¡æ–°ä¸€ä»£çš„æ„å»ºç³»ç»Ÿçš„ç‰¹æ€§ï¼Œä»¥åŠå¦‚ä½•èƒ½æ›´å¥½çš„ä½¿ç”¨å®ƒã€‚&lt;/p>
&lt;p>é€‚å®œäººç¾¤ï¼šæƒ³æ·±å…¥ Docker æ„å»ºç³»ç»Ÿçš„å¼€å‘è€…&lt;/p>
&lt;p>&lt;img src="https://moelove.info/img/docker-chat-3.jpg" alt="Docker é•œåƒæ„å»ºåŸç†åŠæºç åˆ†æ">&lt;/p>
&lt;p>åœ°å€ï¼šhttps://gitbook.cn/gitchat/activity/5cf026eaff33b82ee0eb425b&lt;/p>
&lt;hr>
&lt;p>å¯ä»¥é€šè¿‡ä¸‹é¢äºŒç»´ç è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Docker/">Docker</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| 2019-05-27~2019-06-02</title><link>https://moelove.info/2019/05/31/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-2019-05-27~2019-06-02/</link><guid isPermaLink="true">https://moelove.info/2019/05/31/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-2019-05-27~2019-06-02/</guid><pubDate>Fri, 31 May 2019 07:42:37 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="kubernetes-v1150-beta1-å‘å¸ƒ">Kubernetes v1.15.0-beta.1 å‘å¸ƒ&lt;/h2>
&lt;p>éšç€ KubeCon EU çš„ç»“æŸï¼ŒKubernetes çš„å¼€å‘å·¥ä½œç»§ç»­å›å½’æ­£å¸¸ï¼Œæœ¬å‘¨ç›¸ç»§å‘å¸ƒäº† &lt;a href="https://github.com/kubernetes/kubernetes/releases/tag/v1.12.9">v1.12.9&lt;/a> å’Œ &lt;a href="https://github.com/kubernetes/kubernetes/releases/tag/v1.15.0-beta.1">v1.15.0-beta.1&lt;/a>ã€‚&lt;/p>
&lt;p>éšç€ v1.15 çš„æ­£å¼ç‰ˆä¸´è¿‘ï¼Œç»´æŠ¤æœŸçš„ Kubernetes ç‰ˆæœ¬ä¹Ÿå°†å˜æˆ 1.12~1.15ï¼Œè¯·å°½å¿«å‡çº§ã€‚&lt;/p>
&lt;p>è¿™ä¸ªç‰ˆæœ¬çš„å˜åŒ–ï¼Œç­‰æ­£å¼ç‰ˆå‘å¸ƒæ—¶å€™å†è¿›è¡Œä»‹ç»å¥½äº†ï¼Œæœ‰å…´è¶£å¯ä»¥å…ˆçœ‹ &lt;a href="https://github.com/kubernetes/kubernetes/releases/tag/v1.15.0-beta.1">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="docker-v19030-beta5-å‘å¸ƒ">Docker v19.03.0-beta5 å‘å¸ƒ&lt;/h2>
&lt;p>æŒ‰ç…§æ­£å¸¸è§„å¾‹ Docker 19.03 æ­£å¼ç‰ˆä¹Ÿå°†åœ¨è¿‘æœŸè¿›è¡Œå‘å¸ƒï¼Œè€Œæœ€è¿‘çš„æ‰€æœ‰æµ‹è¯•ç‰ˆæœ¬ä¸­ï¼Œå…¶å®å˜åŒ–æ¯”è¾ƒå¤§çš„ä¸œè¥¿ä¸»è¦åœ¨ &lt;strong>æ„å»ºç³»ç»Ÿ&lt;/strong> ä¸Šï¼›æ„å»ºç³»ç»Ÿçš„å‡çº§å¯ä»¥ä½¿æ„å»ºé€Ÿåº¦æ›´å¿«ï¼ŒåŒæ—¶ä¹Ÿå¢åŠ äº†æ›´å¤šçš„å®‰å…¨ç‰¹æ€§ã€‚&lt;/p>
&lt;p>è¿™æ¬¡çš„ beta5 ä¹Ÿæ˜¯å¸¸è§„ä¿®å¤ï¼Œæœ‰å…´è¶£å¯ä»¥å…ˆçœ‹ &lt;a href="https://github.com/docker/docker-ce/releases/tag/v19.03.0-beta5">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="docker-cve-2018-15664-å®‰å…¨æ¼æ´">Docker CVE-2018-15664 å®‰å…¨æ¼æ´&lt;/h2>
&lt;p>åœ¨ 5 æœˆ 29 æ—¥æˆ‘çœ‹åˆ°äº† &lt;a href="https://seclists.org/oss-sec/2019/q2/131">CVE çš„ä¿¡æ¯&lt;/a>ï¼Œè¿™ä¸ªæ¼æ´ä¼šå½±å“ Docker çš„å…¨éƒ¨ç‰ˆæœ¬ï¼Œæ¼æ´æ”»å‡»çš„ä¸»è¦é€”å¾„æ˜¯ &lt;code>docker cp&lt;/code> ç›¸å…³çš„æ“ä½œã€‚&lt;/p>
&lt;p>ä½†æ˜¯ä¸å¿…å¤ªè¿‡ç´§å¼ ï¼Œå› ä¸ºè¿™ä¸ªæ¼æ´çš„æ”»å‡»èŒƒå›´å…¶å®ä¸ç®—å¤ªå¤§ï¼›æœ€ä¸»è¦å¯èƒ½è¢«æ”»å‡»çš„å¯¹è±¡å…¶å®æ˜¯å…¬æœ‰äº‘ã€‚å¯¹äºæ™®é€šç”¨æˆ·è€Œè¨€ï¼Œå¦‚æœå—æ­¤æ”»å‡»ï¼Œé‚£å‰ææ˜¯æ”»å‡»è€…å·²ç»å…·å¤‡äº†æœºå™¨çš„æƒé™å’Œ Docker çš„æ“ä½œæƒé™ï¼ˆä¸€èˆ¬ç”¨æˆ·åªè¦è‡ªè¡Œæ§åˆ¶æƒé™ä¾¿å¯é¿å…æ”»å‡»çš„å‘ç”Ÿï¼‰ã€‚&lt;/p>
&lt;p>æ¼æ´å‘ç°è€… Aleksa Sarai å¼€å§‹æäº†ä¸€ä¸ª &lt;a href="https://github.com/moby/moby/pull/39252">PR&lt;/a> (ä»–çš„å®ç°æ–¹å¼æ˜¯åœ¨ &lt;code>docker cp&lt;/code> æ“ä½œçš„åŒæ—¶æš‚åœå®¹å™¨)ï¼Œä¸è¿‡ç°åœ¨å·²ç»è¢«ä¸€ä¸ªæ–°çš„ &lt;a href="https://github.com/moby/moby/pull/39292">PR&lt;/a> ç»™å–ä»£äº†ï¼Œæ¯•ç«Ÿæš‚åœå®¹å™¨æ„å‘³ç€åœæ­¢æœåŠ¡ï¼Œè¿™æ˜¯éš¾ä»¥æ¥å—çš„ã€‚&lt;/p>
&lt;p>ç±»ä¼¼ Podman ä¹‹ç±»çš„å…¶å®ä¹Ÿå­˜åœ¨ç›¸åŒçš„é—®é¢˜ï¼Œä¸è¿‡ç°åœ¨ä¹Ÿå·²ç»è¢«ä¿®å¤äº†ã€‚&lt;/p>
&lt;p>æ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥å…³æ³¨ä¸‹ PR çš„è¿›å±•ã€‚&lt;/p>
&lt;h2 id="æ¨èé˜…è¯»jaegerå’Œopentelemetry">æ¨èé˜…è¯»ï¼šJaegerå’ŒOpenTelemetry&lt;/h2>
&lt;p>æœ€è¿‘ OpenTelemetry è¢«å®£å¸ƒæˆä¸º CNCF çš„ sandbox é¡¹ç›®ï¼Œå®ƒç”± OpenTracing å’Œ OpenCensus åˆå¹¶è€Œæˆã€‚è¿™ç¯‡æ–‡ç« æ˜¯ä¸ºäº†å›ç­” OpenTelemetry çš„è¯ç”Ÿå¯¹äº Jaeger é¡¹ç›®çš„å½±å“ã€‚&lt;/p>
&lt;p>ä½œè€…é¢„æœŸæ˜¯å°† Jaeger ä¸ OpenTelemetry ç»“åˆï¼Œæ”¾å¼ƒä¸€äº› Jaeger è‡ªå·±ç»´æŠ¤çš„ç»„ä»¶ï¼Œè½¬è€Œé€‰æ‹© OpenTelemetry æä¾›çš„åŸºç¡€ç»„ä»¶ã€‚&lt;/p>
&lt;p>æ–‡ç« åœ°å€ï¼š &lt;a href="https://medium.com/jaegertracing/jaeger-and-opentelemetry-1846f701d9f2">https://medium.com/jaegertracing/jaeger-and-opentelemetry-1846f701d9f2&lt;/a>&lt;/p>
&lt;hr>
&lt;p>å¯ä»¥é€šè¿‡ä¸‹é¢äºŒç»´ç è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| 2019-05-20~2019-05-26</title><link>https://moelove.info/2019/05/26/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-2019-05-20~2019-05-26/</link><guid isPermaLink="true">https://moelove.info/2019/05/26/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-2019-05-20~2019-05-26/</guid><pubDate>Sun, 26 May 2019 23:24:46 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="kubecon-eu-ä¸¾åŠ">KubeCon EU ä¸¾åŠ&lt;/h2>
&lt;p>2019 å¹´ç¬¬ä¸€ä¸ª KubeCon + CloudNativeCon äº 5 æœˆ 20 ~ 23 æ—¥åœ¨å·´å¡ç½—é‚£æˆåŠŸä¸¾åŠï¼Œè¿™æ¬¡å¤§ä¼šå¸å¼•äº†ä¸ƒåƒå¤šåå‚ä¼šè€…è¿œè¶…å»å¹´çš„å‚ä¼šäººæ•°ã€‚ &lt;strong>è¿™ä¹Ÿä»å¦ä¸€ä¸ªä¾§é¢åæ˜ äº† Kubernetes å’Œäº‘åŸç”Ÿåœ¨å¤§å¤§çš„æ™®åŠ&lt;/strong>&lt;/p>
&lt;p>åœ¨å¤§ä¼šä¸Šå®£å¸ƒäº†ä¸å°‘å€¼å¾—å…³æ³¨çš„ä¿¡æ¯, æˆ‘åœ¨æ­¤å¤§è‡´åˆ—ä¸€ä¸‹æˆ‘è®¤ä¸ºå€¼å¾—å…³æ³¨çš„ä¿¡æ¯ï¼ˆè™½ç„¶æœ‰äº›å†…å®¹ä¹‹å‰å·²ç»å…³æ³¨åˆ°äº†ï¼‰ï¼š&lt;/p>
&lt;ul>
&lt;li>OpenTracing, OpenCensus åˆå¹¶ä¸º OpenTelemetryï¼›&lt;/li>
&lt;li>å¾®è½¯æ¨å‡º Service Mesh Interfaceï¼ˆSMIï¼‰è§„èŒƒï¼›&lt;/li>
&lt;li>NGINX Ingress Controller å‘å¸ƒ 1.5.0 ç‰ˆæœ¬ï¼›&lt;/li>
&lt;li>Google å®£å¸ƒ GKE å°†ä¼šæ”¯æŒ Windows Server Containerï¼›&lt;/li>
&lt;li>Helm 3 çš„å‘å±•å†ç¨‹ï¼›ï¼ˆæ¨èé˜…è¯»æˆ‘ä¹‹å‰å†™çš„ &lt;a href="https://zhuanlan.zhihu.com/p/66058355">åˆè¯• Helm 3&lt;/a>ï¼‰&lt;/li>
&lt;/ul>
&lt;p>å½“ç„¶ï¼Œå¤§ä¼šä¸Šå…¬å¸ƒçš„ä¿¡æ¯è¿˜æœ‰å¾ˆå¤šï¼Œè¿˜æœ‰ä¸€äº› CNCF çš„è®¡åˆ’ç­‰ï¼Œè¿™é‡Œæš‚ä¸”ä¸æï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥è‡ªè¡Œæœç´¢æˆ–è€…å‚åŠ ä¸‹ä¸ªæœˆåœ¨ä¸Šæµ·ä¸¾åŠçš„ KubeCon + CloudNativeCon&lt;/p>
&lt;h2 id="å¾®è½¯æ¨å‡º-service-mesh-interface-smi">å¾®è½¯æ¨å‡º Service Mesh Interface ï¼ˆSMIï¼‰&lt;/h2>
&lt;p>Service Mesh ä¹Ÿæ˜¯ä¸€ä¸ªè¶‹åŠ¿ï¼Œä½†ç°åœ¨å¹¶æ²¡æœ‰ä¸€ä¸ªç»Ÿä¸€çš„è§„èŒƒï¼Œå„ä¸ªå‚å•†çš„å®ç°ä¹Ÿéƒ½å„æœ‰ä¸åŒã€‚å¾®è½¯æœ¬æ¬¡æå‡ºçš„ SMI ä¸»è¦æ˜¯ä¸º Kubernetes æœåŠ¡ç½‘æ ¼æä¾›é€šç”¨æ¥å£ï¼Œä»¥ä¾¿èƒ½è®© Service Mesh æœ‰æ›´åŠ é€šç”¨çš„è§„èŒƒ ï¼ˆå°±åƒå½“åˆ CNI/CRI é‚£æ ·å­ï¼‰&lt;/p>
&lt;p>è¿™é‡Œæˆ‘ä¸æƒ³å¼•èµ·å…¶ä»–é—®é¢˜ï¼Œä½† K8S ç”Ÿæ€ä¸­è¿˜æ˜¯å­˜åœ¨ç€å„ç§å„æ ·çš„é€‰æ‹©ï¼Œå¸Œæœ›å¤§å®¶ç†æ€§é€‰æ‹©ï¼ŒåŒæ—¶éœ€è¦æ³¨æ„çš„æ˜¯ï¼šè¿™ä¸ª SMI ä¸­å…¬å¸ƒçš„å‚å•†ä¸­å”¯ç‹¬æ²¡æœ‰ Google çš„å­˜åœ¨ã€‚&lt;/p>
&lt;p>å¯¹ SMI æ„Ÿå…´è¶£çš„æœ‹å‹ï¼Œæ¨èé˜…è¯»&lt;a href="https://cloudblogs.microsoft.com/opensource/2019/05/21/service-mesh-interface-smi-release/">å®˜æ–¹çš„è¯´æ˜&lt;/a> ï¼›ä¸æƒ³çœ‹è‹±æ–‡è¯´æ˜çš„ä¹Ÿå¯ä»¥çœ‹ä¸‹å´”æ€»&lt;a href="https://mp.weixin.qq.com/s?timestamp=1558886684&amp;amp;src=3&amp;amp;ver=1&amp;amp;signature=4NGtDd7kZHl9y9XxOpylxI6iGVN0p-RycPibVWX5onpgNatyNU06MSXfpQp3iKBhDrslQJtdahrxcUBK1fakeLBVXc0D1eD7GIkriqC1JxdNGb7zJya7b3mVwxbwV-cjBfbQqxjW9ipRQAwGxc3gJg*5ZfZ*viCQOlK6yR2F9CA=">å¯¹ SMI çš„ä»‹ç»&lt;/a>&lt;/p>
&lt;h2 id="openfaas-å‘å¸ƒ-0131">OpenFaaS å‘å¸ƒ 0.13.1&lt;/h2>
&lt;p>OpenFaaSÂ® (Functions as a Service) æ˜¯ä¸€ä¸ªé€šè¿‡ä½¿ç”¨ Docker å’Œ Kubernetes æ„å»ºæ— æœåŠ¡å‡½æ•°çš„æ¡†æ¶ï¼Œå¹¶ä¸”å…·å¤‡ä¸€æµçš„æŒ‡æ ‡æ”¯æŒï¼›ä»»ä½•æµç¨‹éƒ½å¯ä»¥æ‰“åŒ…èµ·æ¥ï¼Œè¿™æ ·å¯ä»¥é¿å…ç¼–å†™é‡å¤çš„ä»£ç ã€‚&lt;/p>
&lt;p>å®ƒçš„ç‰¹æ€§ä¸»è¦åŒ…æ‹¬ï¼š&lt;/p>
&lt;ul>
&lt;li>å¯ç›´æ¥é€šè¿‡ UI ä¸€é”®å®‰è£…ä½¿ç”¨&lt;/li>
&lt;li>å¯ä»¥ä»»ä½•ç¼–ç¨‹è¯­è¨€ç¼–å†™é¡¹ç›®ï¼Œæœ€ç»ˆæ‰“åŒ…æˆå®¹å™¨é•œåƒè¿è¡Œï¼›&lt;/li>
&lt;li>åœ¨ç°æœ‰çš„å…¬æœ‰äº‘/ç§æœ‰äº‘å‡å¯è¿è¡Œï¼šåŸç”Ÿæ”¯æŒ Kubernetes å’Œ Docker Swarmï¼›&lt;/li>
&lt;li>CLI ä½¿ç”¨ YAML æ ¼å¼ä¾¿äºæ¨¡æ¿åŒ–å’Œå®šä¹‰åŠŸèƒ½&lt;/li>
&lt;li>å¯è¿›è¡Œè‡ªåŠ¨æ‰©ç¼©å®¹ï¼›&lt;/li>
&lt;/ul>
&lt;p>è´´ä¸€ä¸ªå®˜æ–¹æ¶æ„å›¾ï¼š&lt;/p>
&lt;p>&lt;img src="https://camo.githubusercontent.com/08bc7c0c4f882ef5eadaed797388b27b1a3ca056/68747470733a2f2f7062732e7477696d672e636f6d2f6d656469612f4446726b46344e586f41414a774e322e6a7067" alt="OpenFaaS - moelove.info">&lt;/p>
&lt;p>æœ¬æ¬¡çš„ Release ç®—æ˜¯ä¸€ä¸ªå¸¸è§„æ›´æ–°ï¼Œå‘å¸ƒäº† watchdog çš„ Docker é•œåƒã€‚&lt;/p>
&lt;p>æ›´å¤šå†…å®¹æ¨èé˜…è¯» &lt;a href="https://github.com/openfaas/faas/releases/tag/0.13.1">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="é¡¹ç›®æ¨è-kui">é¡¹ç›®æ¨èï¼š Kui&lt;/h2>
&lt;p>Kui æ˜¯ IBM å¼€æºçš„ä¸€æ¬¾ç”¨äºäº‘åŸç”Ÿåº”ç”¨å¼€å‘çš„å¯è§†åŒ–å·¥å…·ï¼Œæ¨èé˜…è¯» &lt;a href="https://zhuanlan.zhihu.com/p/66975768">äº‘åŸç”Ÿåº”ç”¨å¼€å‘æ–°ä½“éªŒï¼šKui&lt;/a>&lt;/p>
&lt;hr>
&lt;p>å¯ä»¥é€šè¿‡ä¸‹é¢äºŒç»´ç è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>äº‘åŸç”Ÿåº”ç”¨å¼€å‘æ–°ä½“éªŒï¼šKui</title><link>https://moelove.info/2019/05/24/%E4%BA%91%E5%8E%9F%E7%94%9F%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91%E6%96%B0%E4%BD%93%E9%AA%8CKui/</link><guid isPermaLink="true">https://moelove.info/2019/05/24/%E4%BA%91%E5%8E%9F%E7%94%9F%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91%E6%96%B0%E4%BD%93%E9%AA%8CKui/</guid><pubDate>Fri, 24 May 2019 10:19:03 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>äº‘åŸç”Ÿï¼ˆCloud Nativeï¼‰åº”ç”¨æ˜¯ä¼´éšç€ Kubernetes åº”ç”¨èŒƒå›´çš„æ‰©å¤§ï¼ŒåŸºäºäº‘æ¨¡å‹è€Œæå‡ºçš„ä¸€ç§æ¦‚å¿µã€‚&lt;/p>
&lt;/blockquote>
&lt;p>æœ¬æ–‡æ¥ä»‹ç»ä¸€ä¸ªäº‘åŸç”Ÿåº”ç”¨å¼€å‘çš„å·¥å…· &lt;a href="https://github.com/IBM/kui">Kui&lt;/a>, è¿™æ˜¯ä¸€æ¬¾ç”± IBM å¼€æºçš„å·¥å…·ï¼Œä½¿ç”¨ &lt;a href="https://electronjs.org/">Electron&lt;/a> æä¾› GUI èƒ½åŠ›ã€‚&lt;/p>
&lt;blockquote>
&lt;p>Kui Shell offers a new development experience for building cloud-native applications. By combining the power of familiar CLIs with visualizations in high-impact areas, Kui enables you to manipulate complex JSON and YAML data models, integrate disparate tooling, and provides quick access to aggregate views of operational data.&lt;/p>
&lt;/blockquote>
&lt;p>æ­£å¦‚ä»¥ä¸Šä»‹ç»ä¸­æåˆ°çš„ï¼ŒKui æä¾›äº†ä¸€ç§æ–°çš„å¼€å‘ä½“éªŒï¼ˆåŸå…ˆå¤§å¤šæ•°æ—¶å€™æˆ‘ä»¬æ˜¯é€šè¿‡ &lt;code>kubectl&lt;/code> ä¸ Kubernetes ä¸­çš„èµ„æºè¿›è¡Œäº¤äº’ï¼‰ï¼ŒKui ç»“åˆäº†åŸæœ‰ CLI çš„å¼ºå¤§åŠŸèƒ½ï¼Œå¹¶æä¾›ä¸€ç§å¯è§†åŒ–çš„æ–¹å¼ï¼Œæ–¹ä¾¿æˆ‘ä»¬å¯¹ Kubernetes ä¸­ YAML æˆ–è€… JSON æ ¼å¼æ•°æ®çš„å¤„ç†ã€‚&lt;/p>
&lt;p>ä»‹ç»å°±å…ˆåˆ°è¿™é‡Œï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹å®ƒçš„å®‰è£…åŠä¸»ä½“åŠŸèƒ½ï¼Œçœ‹çœ‹å®ƒèƒ½ä¸ºæˆ‘ä»¬å¸¦æ¥ä»€ä¹ˆã€‚&lt;/p>
&lt;h2 id="å®‰è£…">å®‰è£…&lt;/h2>
&lt;p>å®‰è£…æ–¹å¼å…¶å®å¾ˆç®€å•ï¼Œé¡¹ç›®çš„&lt;a href="https://github.com/IBM/kui/blob/master/docs/installation.md">å®‰è£…æ–‡æ¡£&lt;/a>å·²ç»éå¸¸è¯¦ç»†äº†ã€‚æˆ‘ä¸»è¦æ¨èä¸¤ç§åœ¨ Linux ä¸‹çš„å®‰è£…æ–¹å¼ï¼ˆå½“ç„¶ï¼ŒKui æ˜¯æ”¯æŒè·¨å¹³å°çš„ macOS å’Œ Windows ä¹Ÿéƒ½å¯ä»¥ç”¨ï¼‰ï¼š&lt;/p>
&lt;ul>
&lt;li>ä¸‹è½½é¢„æ„å»ºå¥½çš„äºŒè¿›åˆ¶åŒ…ï¼š&lt;/li>
&lt;/ul>
&lt;pre>&lt;code>(MoeLove) âœ wget -O kui.zip https://linux-zip.kui-shell.org/
(MoeLove) âœ unzip kui.zip
(MoeLove) âœ ./Kui-linux-x64/Kui shell
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>æºç å®‰è£…ï¼š&lt;/li>
&lt;/ul>
&lt;p>è¿™æ˜¯æˆ‘æœ€ä¸ºæ¨èçš„æ–¹å¼ï¼Œä»¥ä¸‹å†…å®¹ä¹Ÿå‡æ˜¯ä»¥æ­¤æ–¹å¼å®‰è£…æ¥ä»‹ç»çš„ã€‚ &lt;strong>æ³¨æ„ï¼Œæ­¤æ–¹å¼éœ€è¦ä½ æœºå™¨ä¸Šå·²ç»è£…å¥½äº† NodeJS ç›¸å…³çš„ç¯å¢ƒ&lt;/strong>&lt;/p>
&lt;pre>&lt;code>(MoeLove) âœ git clone https://github.com/IBM/kui.git
(MoeLove) âœ cd kui
(MoeLove) âœ npm install
(MoeLove) âœ export PATH=$PWD/bin/:$PATH
&lt;/code>&lt;/pre>&lt;p>åœ¨æ‰§è¡Œå®Œä¸Šè¿°å‘½ä»¤åï¼Œä¾¿å®‰è£…äº†ç›¸å…³çš„ä¾èµ–ï¼Œä»¥åŠ &lt;code>bin&lt;/code> ç›®å½•ä¸‹çš„ &lt;code>kubectl-kui&lt;/code> å‘½ä»¤ä¼šé€šè¿‡ &lt;code>kubectl&lt;/code> çš„æ’ä»¶æœºåˆ¶ï¼Œè‡ªåŠ¨æ³¨å†Œå¥½ã€‚&lt;/p>
&lt;p>é€šè¿‡ä»¥ä¸‹å‘½ä»¤å¯è¿›è¡ŒéªŒè¯ï¼š&lt;/p>
&lt;pre>&lt;code>(MoeLove) âœ kui git:(master) kui version
2.33.0
(MoeLove) âœ kui git:(master) kubectl kui version
2.33.0
&lt;/code>&lt;/pre>&lt;h2 id="ä½¿ç”¨">ä½¿ç”¨&lt;/h2>
&lt;p>ä½ çš„æœºå™¨ä¸Šéœ€è¦æå‰é…ç½®å¥½ &lt;code>KUBECONFIG&lt;/code> çš„ç¯å¢ƒå˜é‡æˆ–è€…æ˜¯å°†é…ç½®æ–‡ä»¶æ”¾åˆ°äº†æ­£ç¡®çš„ä½ç½® i.e. &lt;code>$HOME/.kube/config&lt;/code>&lt;/p>
&lt;p>å¦‚æœä½ è¿˜æ²¡æœ‰ä¸€ä¸ªå¯è®¿é—®çš„ Kubernetes é›†ç¾¤ï¼Œå¼ºçƒˆå»ºè®®ä½ é˜…è¯»æˆ‘ä¹‹å‰çš„æ–‡ç«  &lt;a href="https://zhuanlan.zhihu.com/p/60464867">ä½¿ç”¨ Kind æ­å»ºä½ çš„æœ¬åœ° Kubernetes é›†ç¾¤&lt;/a>ï¼Œ Kind æ˜¯ä¸€ä¸ªéå¸¸ä¼˜ç§€ä¹Ÿéå¸¸æ–¹ä¾¿çš„å·¥å…·ã€‚&lt;/p>
&lt;p>å¦‚æœä½ å¯¹ Kubernetes è¿˜ä¸ç”šäº†è§£çš„è¯ï¼Œä¹Ÿæ¨èé˜…è¯»æˆ‘å†™çš„ &lt;a href="https://zhuanlan.zhihu.com/p/53244821">ã€ŠKubernetes ä»ä¸Šæ‰‹åˆ°å®è·µã€‹&lt;/a> è¿›è¡Œå­¦ä¹ ã€‚&lt;/p>
&lt;p>å›åˆ°æ­£é¢˜ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹ Kui çš„ä¸»ä½“åŠŸèƒ½ã€‚&lt;/p>
&lt;h3 id="å¯è§†åŒ–å±•ç¤º">å¯è§†åŒ–å±•ç¤º&lt;/h3>
&lt;p>&lt;img src="https://moelove.info/img/kui-intro-1.png" alt="Kui å¯è§†åŒ– - Moelove.info">&lt;/p>
&lt;p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœæˆ‘ä»¬æ²¡æœ‰ç»™ &lt;code>kui&lt;/code> ä¼ é€’ &lt;code>--ui&lt;/code> å‚æ•°çš„è¯ï¼Œå®ƒå’Œæ­£å¸¸ä½¿ç”¨ &lt;code>kubectl&lt;/code> çš„è¡Œä¸ºä¸€è‡´ï¼Œä»ç„¶åœ¨ç»ˆç«¯ä¸‹è¾“å‡ºå†…å®¹ã€‚&lt;/p>
&lt;p>ç±»ä¼¼è¿™æ ·ï¼š&lt;/p>
&lt;pre>&lt;code>(MoeLove) âœ kui git:(master) kubectl kui get pods -n kube-system
NAME READY STATUS RESTARTS AGE
coredns-fb8b8dccf-292wk 1/1 Running 0 153m
coredns-fb8b8dccf-lbj2g 1/1 Running 0 153m
etcd-moelove-control-plane 1/1 Running 0 152m
kube-apiserver-moelove-control-plane 1/1 Running 0 152m
kube-controller-manager-moelove-control-plane 1/1 Running 0 152m
kube-proxy-jltdj 1/1 Running 0 153m
kube-proxy-thpq5 1/1 Running 0 153m
kube-scheduler-moelove-control-plane 1/1 Running 0 152m
weave-net-dws2l 2/2 Running 0 153m
weave-net-tt82h 2/2 Running 0 153m
&lt;/code>&lt;/pre>&lt;p>ä½†å¦‚æœæˆ‘ä»¬ç»™å®ƒä¼ é€’äº† &lt;code>--ui&lt;/code> çš„å‚æ•°ï¼Œåˆ™å®ƒä¼šæ‰“å¼€ä¸€ä¸ªæ–°çš„çª—å£ï¼Œå¹¶å°†å†…å®¹å±•ç¤ºå‡ºæ¥ã€‚&lt;/p>
&lt;p>ç‚¹å‡»å…¶ä¸­çš„ä»»æ„èµ„æºï¼Œä¾¿å¯æ‰“å¼€å…¶è¯¦ç»†å†…å®¹ï¼š&lt;/p>
&lt;p>&lt;img src="https://moelove.info/img/kui-intro-yaml.png" alt="Kui YAML - Moelove.info">&lt;/p>
&lt;p>åº•éƒ¨ tab å¯è¿›è¡Œå†…å®¹åˆ‡æ¢ï¼Œæ¯”å¦‚å¯æŸ¥çœ‹å®ƒçš„çŠ¶æ€æˆ–è€…å®ƒå…¶ä¸­çš„ Container ç­‰ã€‚&lt;/p>
&lt;p>&lt;img src="https://moelove.info/img/kui-intro-conditions.png" alt="Kui Conditions - Moelove.info">&lt;/p>
&lt;p>å½“ç„¶ï¼Œå³ä¸‹è§’è¿˜æœ‰ä¸€ä¸ªåˆ é™¤æŒ‰é’®ï¼Œå¯ç”¨äºåˆ é™¤æ­¤èµ„æºï¼ˆæ²¡æœ‰äºŒæ¬¡ç¡®è®¤çš„ï¼Œè¯·æ…é‡ï¼‰&lt;/p>
&lt;h3 id="æˆªå›¾">æˆªå›¾&lt;/h3>
&lt;p>&lt;img src="https://moelove.info/img/kui-intro-screenshot.png" alt="Kui æˆªå›¾ - Moelove.info">&lt;/p>
&lt;p>åœ¨çª—å£çš„å³ä¸‹è§’æœ‰ä¸€ä¸ªæˆªå›¾æŒ‰é’®ï¼Œä½¿ç”¨æ­¤æŒ‰é’®å¯ä»¥æ–¹ä¾¿çš„å¯¹å½“å‰çª—å£çš„å›¾åƒè¿›è¡Œæ‹·è´å’Œä¿å­˜ã€‚&lt;/p>
&lt;h3 id="äº¤äº’å¼-shell">äº¤äº’å¼ Shell&lt;/h3>
&lt;p>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¯ä»¥æ‰“å¼€äº¤äº’å¼ Shell çª—å£ï¼š&lt;/p>
&lt;pre>&lt;code>kubectl kui shell
&lt;/code>&lt;/pre>&lt;p>&lt;img src="https://moelove.info/img/kui-intro-shell.png" alt="Kui Shell - Moelove.info">&lt;/p>
&lt;p>åœ¨æ­¤äº¤äº’å¼ Shell çª—å£ä¸­ï¼Œä½ å¯ä»¥æ­£å¸¸çš„æ‰§è¡Œä½ æ—¥å¸¸ä½¿ç”¨çš„å‘½ä»¤ï¼š&lt;/p>
&lt;p>&lt;img src="https://moelove.info/img/kui-intro-git.png" alt="Kui Shell - Moelove.info">&lt;/p>
&lt;p>å½“ç„¶é™¤äº†åƒæ­£å¸¸åœ¨ç»ˆç«¯ä¸­çš„å‘½ä»¤è¾“å‡ºå¤–ï¼Œå¦‚æœè¾“å‡ºå†…å®¹æ˜¯ JSON æˆ–è€… YAML çš„è¯ï¼Œåˆ™ä¼šè‡ªåŠ¨æ‰“å¼€ kui çš„ä¸€ä¸ªçª—å£è¿›è¡Œå±•ç¤ºã€‚&lt;/p>
&lt;p>&lt;img src="https://moelove.info/img/kui-intro-json.png" alt="Kui JSON - Moelove.info">&lt;/p>
&lt;p>å·¦ä¾§çš„ + å·å¯ä»¥ç”¨äºæ–°å¢æ ‡ç­¾ã€‚&lt;/p>
&lt;h3 id="å¼€å‘éƒ¨ç½²">å¼€å‘éƒ¨ç½²&lt;/h3>
&lt;p>ä½ å¯ä»¥ä½¿ç”¨ &lt;strong>å†…ç½®ç¼–è¾‘å™¨&lt;/strong> æˆ–è€…ä»»æ„ä½ å–œæ¬¢çš„ç¼–è¾‘å™¨ç¼–è¾‘ä½ çš„é…ç½®æ–‡ä»¶ï¼Œæ¯”å¦‚æˆ‘ä»¬æƒ³è¦éƒ¨ç½²ä¸€ä¸ª Redis åœ¨ Kubernetes é›†ç¾¤ä¸­ã€‚&lt;/p>
&lt;p>ä½ å¯ä»¥å†™ä¸€ä¸ªé…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š&lt;/p>
&lt;pre>&lt;code>apiVersion: apps/v1
kind: Deployment
metadata:
labels:
run: redis
name: redis
spec:
replicas: 1
selector:
matchLabels:
run: redis
strategy: {}
template:
metadata:
labels:
run: redis
spec:
containers:
- image: redis:alpine
name: redis
resources: {}
&lt;/code>&lt;/pre>&lt;p>ä¿å­˜ä¸º &lt;code>deploy.yaml&lt;/code> ä½¿ç”¨ &lt;code>open deploy.yaml&lt;/code> å³å¯åœ¨å³ä¾§çª—å£æŸ¥çœ‹è¯¥å†…å®¹, å¹¶ä¸”åœ¨å·¦ä¾§è¿›è¡Œéƒ¨ç½²åï¼Œä¹Ÿå¯åœ¨å³ä¾§è¿›è¡Œç®¡ç†ç­‰æ“ä½œã€‚&lt;/p>
&lt;p>&lt;img src="https://moelove.info/img/kui-intro-deploy.png" alt="Kui deploy - Moelove.info">&lt;/p>
&lt;h3 id="æ˜“æ‰©å±•">æ˜“æ‰©å±•&lt;/h3>
&lt;p>é¡¹ç›®ä»£ç æ¯”è¾ƒç®€å•ï¼Œ&lt;a href="https://github.com/IBM/kui/blob/master/docs/dev/custom-clients.md">æ–‡æ¡£&lt;/a>ä¸­ä¹Ÿæœ‰å¼€å‘æ–‡æ¡£ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„è‡ªä¿¡è¿›è¡Œæ‰©å±•ã€‚ï¼ˆä¸å±•å¼€äº†ï¼‰&lt;/p>
&lt;h3 id="tutorials">tutorials&lt;/h3>
&lt;p>å½“è¾“å…¥æ­¤å‘½ä»¤åï¼Œä¼šçœ‹åˆ°å…¶å†…ç½®çš„å‡ ä¸ªä½¿ç”¨æ•™ç¨‹ï¼Œæ›´å¤šåŠŸèƒ½å¯ä»¥é€šè¿‡æ­¤å‘½ä»¤è¿›è¡Œæ¢ç´¢ã€‚&lt;/p>
&lt;p>ä¾‹å¦‚è¿™ç§ Preview çš„åŠŸèƒ½ä¹‹ç±»çš„ã€‚&lt;/p>
&lt;p>&lt;img src="https://moelove.info/img/kui-intro-preview.png" alt="Kui preview - Moelove.info">&lt;/p>
&lt;p>Enjoy your Cloud Native!&lt;/p>
&lt;hr>
&lt;p>å¯ä»¥é€šè¿‡ä¸‹é¢äºŒç»´ç è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category><category domain="https://moelove.info/tags/Electron/">Electron</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| 2019-05-13~2019-05-19</title><link>https://moelove.info/2019/05/19/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-2019-05-13~2019-05-19/</link><guid isPermaLink="true">https://moelove.info/2019/05/19/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-2019-05-13~2019-05-19/</guid><pubDate>Sun, 19 May 2019 23:13:42 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="kind-v030-æ­£å¼å‘å¸ƒ">kind v0.3.0 æ­£å¼å‘å¸ƒ&lt;/h2>
&lt;p>kind (Kubernetes In Docker) æ˜¯æˆ‘å¾ˆå–œæ¬¢å¹¶ä¸”ä¸€ç›´æŒç»­å‚ä¸è´¡çŒ®çš„é¡¹ç›®ï¼Œæœ¬å‘¨å‘å¸ƒäº† v0.3.0 ç‰ˆæœ¬ã€‚å…³äº Kind çš„ä»‹ç»å’ŒåŸºç¡€ä½¿ç”¨ï¼Œå¯ä»¥å‚è€ƒæˆ‘ä¹‹å‰å†™çš„æ–‡ç«  &lt;a href="https://zhuanlan.zhihu.com/p/60464867">ã€Šä½¿ç”¨ Kind æ­å»ºä½ çš„æœ¬åœ° Kubernetes é›†ç¾¤ã€‹&lt;/a>&lt;/p>
&lt;p>æœ¬æ¬¡çš„å‘å¸ƒä¸»è¦ä¾§é‡äºåŠ é€Ÿé›†ç¾¤çš„å¯åŠ¨é€Ÿåº¦åŠæé«˜ç¨³å®šæ€§ï¼Œä¼˜åŒ–é•œåƒå¤§å°ï¼Œä»¥åŠå¯¹ç½‘ç»œçš„ä¼˜åŒ–å’Œä¸€äº› bugfix ç­‰ï¼›å…¶ä¸­æœ€ä¸»è¦çš„å†…å®¹æ˜¯å°†é»˜è®¤çš„ CRI ä» Docker æ¢æˆäº† Containerdï¼Œä»¥æ­¤å¯ä»¥ç¼©å°é•œåƒä½“ç§¯ï¼Œä»¥åŠåŠ å¿«é›†ç¾¤çš„å¯åŠ¨ã€‚&lt;/p>
&lt;p>v0.3.0 ç‰ˆæœ¬ä¸­ï¼Œå¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶è‡ªè¡Œéƒ¨ç½²ä¸åŒçš„ CNIï¼Œæ›´æœ‰åˆ©äºç”¨æˆ·æµ‹è¯•å®é™…çš„é›†ç¾¤æƒ…å†µï¼›ç°åœ¨ç‰ˆæœ¬ä¸­å·²ç»å°†é»˜è®¤çš„ Kubernetes ç‰ˆæœ¬å‡çº§åˆ°äº†æœ€æ–°çš„ v1.14.2 ã€‚&lt;/p>
&lt;p>å½“ç„¶ï¼Œä¹Ÿè¿˜æœ‰ä¸€äº›æ­£åœ¨å¢åŠ çš„ç‰¹æ€§ï¼Œé¢„è®¡ä¼šåœ¨ v0.4.0 ç‰ˆæœ¬ä¸­å‘å¸ƒï¼Œä¸»è¦é›†ä¸­äº IPv6 å’Œé›†ç¾¤é‡å¯çš„æ”¯æŒï¼ˆç›¸ä¿¡å¾ˆå¿«å°±å¯ä»¥å®Œæˆäº†ï¼‰ã€‚&lt;/p>
&lt;p>é¡ºä¾¿å…¬å¸ƒä¸€ä¸ªæ•°æ®ï¼ŒKind ç›®å‰çš„ star æ•°æ˜¯ 1.8k è¿˜åœ¨æŒç»­å¢é•¿ä¸­ :)&lt;/p>
&lt;p>æ›´å¤šçš„ç»†èŠ‚å’Œä¿¡æ¯è¯·å‚è€ƒ &lt;a href="https://github.com/kubernetes-sigs/kind/releases/tag/v0.3.0">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="kubernetes-v1142-æ­£å¼å‘å¸ƒ">Kubernetes v1.14.2 æ­£å¼å‘å¸ƒ&lt;/h2>
&lt;p>è¿™æ˜¯ä¸€ä¸ªå¸¸è§„çš„ bugfix ç‰ˆæœ¬ï¼Œä½†æœ‰ä¸ªå€¼å¾—å…³æ³¨çš„ç‚¹ï¼š&lt;/p>
&lt;ul>
&lt;li>å‡çº§åˆ°äº† golang v1.12.5 ç‰ˆæœ¬ã€‚&lt;/li>
&lt;/ul>
&lt;p>ä½ å¯èƒ½è¦é—®ä¸ºä»€ä¹ˆéœ€è¦å…³æ³¨ golang ç‰ˆæœ¬çš„å‡çº§ï¼Ÿè¿™æ˜¯å› ä¸ºåœ¨æ­¤ç‰ˆæœ¬ä¸­ golang æœ‰ä¸€äº›å…³äºè¿è¡Œæ—¶çš„ä¿®æ”¹ï¼Œå°¤å…¶æ˜¯å…¶ä¸­å…³äºäºŒå‰æ ‘æŸ¥æ‰¾éƒ¨åˆ†çš„&lt;a href="https://github.com/golang/go/commit/438b1a5dae01812a2b91b648c762414d4854ccd7">ä¿®æ”¹&lt;/a>ç­‰éƒ¨åˆ†çš„ä¿®æ”¹ï¼Œå¯æœ‰æ•ˆçš„é™ä½ Kubernetes API server çš„å»¶è¿Ÿã€‚&lt;/p>
&lt;p>å»¶è¿Ÿå¢å¤§çš„ç°è±¡å…¶å®æ˜¯ä»å‡çº§åˆ° golang 1.12 ç‰ˆæœ¬ä¹‹åå°±å‡ºç°çš„ï¼š&lt;/p>
&lt;p>&lt;img src="https://user-images.githubusercontent.com/25119199/55189408-25100400-519e-11e9-9b6e-762f3896e61c.png" alt="">&lt;/p>
&lt;p>ä¸è¿‡ç»è¿‡è¿™æ¬¡å‡çº§ä¹‹åï¼Œä¹Ÿå°±å»¶è¿Ÿä¹Ÿå°±é™ä¸‹æ¥äº†ï¼Œå»ºè®®å‡çº§ã€‚&lt;/p>
&lt;p>æ›´å¤šè¯¦ç»†ä¿¡æ¯è¯·é˜…è¯» &lt;a href="https://github.com/kubernetes/kubernetes/blob/master/CHANGELOG-1.14.md#changelog-since-v1141">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="istio-117-å‘å¸ƒ">Istio 1.1.7 å‘å¸ƒ&lt;/h2>
&lt;p>å¸¸è§„ bugfix ç‰ˆæœ¬ï¼Œè¯¦ç»†å†…å®¹å¯é˜…è¯» &lt;a href="https://istio.io/about/notes/1.1.7/">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="knative-serving-v060-æ­£å¼å‘å¸ƒ">Knative Serving v0.6.0 æ­£å¼å‘å¸ƒ&lt;/h2>
&lt;p>Knative æ˜¯ä¸€ä¸ªåŸºäº Kubernetes å’Œ Istio æ”¯æŒéƒ¨ç½² serverless å¹³å°ã€‚æœ¬æ¬¡çš„å‘å¸ƒå¢åŠ äº† &lt;code>v1beta1&lt;/code> ç‰ˆæœ¬çš„ APIï¼Œè¿™å…¶å®ä¹Ÿæ˜¯é¡¹ç›®è¶‹å‘ç¨³å®šçš„ä¸€ä¸ªä¿¡å·ã€‚å…³äºå…¶å…·ä½“ä»‹ç»å¯å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼Œå†™çš„æ¯”è¾ƒè¯¦ç»†äº† &lt;a href="https://knative.dev/docs/serving/">knative/serving&lt;/a>&lt;/p>
&lt;p>æœ¬æ¬¡ç‰ˆæœ¬ï¼Œæ— è®ºæ˜¯æ ¸å¿ƒ API æˆ–è€…æ˜¯è‡ªåŠ¨æ‰©å®¹ç­‰å˜åŒ–éƒ½ç®—æ˜¯æ¯”è¾ƒå¤§ï¼Œå…·ä½“å†…å®¹è¯·å‚è€ƒ &lt;a href="https://github.com/knative/serving/releases/tag/v0.6.0">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="æ¨èé˜…è¯»linkerd-vs-istio-æ€§èƒ½è¯„æµ‹">æ¨èé˜…è¯»ï¼šLinkerd vs Istio æ€§èƒ½è¯„æµ‹&lt;/h2>
&lt;p>è¿™æ˜¯ä¸€ä¸ªç”± Kinvolk å‘å¸ƒçš„æ€§èƒ½æµ‹è¯•ï¼Œç®—æ˜¯æ¯”è¾ƒä¸­ç«‹çš„ä¸€ä¸ªå¯¹æ¯”ã€‚æˆ‘è¿™é‡Œè´´å‡ºä¸€ä¸ªå»¶è¿Ÿçš„å¯¹æ¯”å›¾ï¼š&lt;/p>
&lt;p>&lt;img src="https://kinvolk.io/media/500rps-latency.png" alt="">&lt;/p>
&lt;p>æ„Ÿå…´è¶£çš„æœ‹å‹å»ºè®®é˜…è¯»åŸæ–‡ &lt;a href="https://kinvolk.io/blog/2019/05/performance-benchmark-analysis-of-istio-and-linkerd/">Performance Benchmark Analysis of Istio and Linkerd&lt;/a>&lt;/p>
&lt;hr>
&lt;p>å¯ä»¥é€šè¿‡ä¸‹é¢äºŒç»´ç è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>åˆè¯• Helm 3</title><link>https://moelove.info/2019/05/16/%E5%88%9D%E8%AF%95-Helm-3/</link><guid isPermaLink="true">https://moelove.info/2019/05/16/%E5%88%9D%E8%AF%95-Helm-3/</guid><pubDate>Thu, 16 May 2019 21:30:00 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ç»è¿‡äº†é•¿æ—¶é—´çš„å¼€å‘ï¼Œ&lt;a href="https://v3.helm.sh/">Helm 3&lt;/a> ç»ˆäºåœ¨ä»Šå¤©å‘å¸ƒäº†&lt;a href="https://github.com/helm/helm/releases/tag/v3.0.0-alpha.1">ç¬¬ä¸€ä¸ª alpha ç‰ˆæœ¬&lt;/a>ã€‚æœ¬æ–‡å°†ç®€å•ä»‹ç» Helm 3 æ–°ç‰¹æ€§ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="ç§»é™¤-tiller">ç§»é™¤ Tiller&lt;/h2>
&lt;p>Helm 2 æ˜¯ C/S æ¶æ„ï¼Œä¸»è¦åˆ†ä¸ºå®¢æˆ·ç«¯ &lt;code>helm&lt;/code> å’ŒæœåŠ¡ç«¯ &lt;code>Tiller&lt;/code>; ä¸ä¹‹å‰ç‰ˆæœ¬ç›¸åŒï¼ŒHelm 3 åŒæ ·åœ¨ &lt;a href="https://github.com/helm/helm/releases">Release&lt;/a> é¡µé¢æä¾›äº†é¢„ç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚å·®åˆ«åœ¨äºåŸå…ˆçš„äºŒè¿›åˆ¶åŒ…ä¸‹è½½ä¸‹æ¥ä½ ä¼šçœ‹åˆ° &lt;code>helm&lt;/code> å’Œ &lt;code>tiller&lt;/code> ã€‚è€Œ Helm 3 åˆ™åªæœ‰ &lt;code>helm&lt;/code> çš„å­˜åœ¨äº†ã€‚&lt;/p>
&lt;p>&lt;code>Tiller&lt;/code> ä¸»è¦ç”¨äºåœ¨ Kubernetes é›†ç¾¤ä¸­ç®¡ç†å„ç§åº”ç”¨å‘å¸ƒçš„ç‰ˆæœ¬ï¼Œåœ¨ Helm 3 ä¸­ç§»é™¤äº† &lt;code>Tiller&lt;/code>, ç‰ˆæœ¬ç›¸å…³çš„æ•°æ®ç›´æ¥å­˜å‚¨åœ¨äº† Kubernetes ä¸­ã€‚&lt;/p>
&lt;p>ç°åœ¨æˆ‘ä»¬ç›´æ¥åœ¨ä¸€ä¸ªæ–°åˆ›å»ºçš„é›†ç¾¤ä¸Šæ¥ä½¿ç”¨ Helmã€‚æµ‹è¯•é›†ç¾¤çš„åˆ›å»ºå¯ä»¥å‚è€ƒæˆ‘ä¹‹å‰çš„æ–‡ç«  &lt;a href="https://zhuanlan.zhihu.com/p/60464867">ä½¿ç”¨ Kind æ­å»ºä½ çš„æœ¬åœ° Kubernetes é›†ç¾¤&lt;/a>ã€‚&lt;/p>
&lt;p>ä¸ä¹‹å‰ç‰ˆæœ¬ç›¸åŒï¼Œæˆ‘ä»¬éœ€è¦å…ˆæ‰§è¡Œ &lt;code>helm init&lt;/code> æ¥è¿›è¡Œåˆå§‹åŒ–ã€‚ä½†ç°åœ¨çš„åˆå§‹åŒ–å°±ç®€å•äº†å¾ˆå¤šï¼Œä¸å†éœ€è¦ç»™é›†ç¾¤ä¸­éƒ¨ç½² &lt;code>Tiller&lt;/code> äº†&lt;/p>
&lt;pre>&lt;code>(MoeLove) âœ ~ export HELM_HOME=/tmp/helm3
(MoeLove) âœ ~ helm3 init
Creating /tmp/helm3/repository
Creating /tmp/helm3/repository/cache
Creating /tmp/helm3/plugins
Creating /tmp/helm3/starters
Creating /tmp/helm3/cache/archive
Creating /tmp/helm3/repository/repositories.yaml
Adding stable repo with URL: https://kubernetes-charts.storage.googleapis.com
$HELM_HOME has been configured at /tmp/helm3.
Happy Helming!
&lt;/code>&lt;/pre>&lt;p>åŸå…ˆï¼Œç”±äºæœ‰ RBAC çš„å­˜åœ¨ï¼Œæˆ‘ä»¬åœ¨å¼€å§‹ä½¿ç”¨æ—¶ï¼Œå¿…é¡»å…ˆåˆ›å»ºä¸€ä¸ª ServiceAccount è€Œç°åœ¨ Helm çš„æƒé™ä¸å½“å‰çš„ &lt;code>KUBECONFIG&lt;/code> ä¸­é…ç½®ç”¨æˆ·çš„æƒé™ç›¸åŒï¼Œéå¸¸å®¹æ˜“è¿›è¡Œæ§åˆ¶ã€‚&lt;/p>
&lt;p>è¿™æ ·ä¹Ÿå¤§å¤§å¢å¼ºäº†ä½¿ç”¨ Helm çš„å®‰å…¨æ€§ã€‚&lt;/p>
&lt;h2 id="release-åç§°å¯åœ¨ä¸åŒ-ns-é—´é‡ç”¨">Release åç§°å¯åœ¨ä¸åŒ ns é—´é‡ç”¨&lt;/h2>
&lt;p>è¿™æ˜¯ Helm Release ä¸­æåˆ°çš„åŠŸèƒ½ã€‚ &lt;strong>ä½†æ­¤åŠŸèƒ½ç›®å‰å¹¶ä¸ç›´æ¥å¯ç”¨&lt;/strong> ç›¸å…³ issue ä¹Ÿå·²ç»åˆ›å»ºã€‚&lt;/p>
&lt;pre>&lt;code>(MoeLove) âœ ~ helm3 list
NAME NAMESPACE REVISION UPDATED STATUS CHART
redis1 default 1 2019-05-17 00:21:06.686127031 +0800 CST deployed redis-7.1.0
redis default 1 2019-05-17 00:19:28.234013017 +0800 CST deployed redis-7.1.0
(MoeLove) âœ ~ helm3 -n moelove install redis1 stable/redis
Error: cannot re-use a name that is still in use
&lt;/code>&lt;/pre>&lt;p>æ ¹æºåœ¨äº &lt;code>namespace&lt;/code> å‚æ•°çš„è·å–å®ç°ä¸Šã€‚&lt;/p>
&lt;p>å¯¹åº”ä»£ç ä¸ºï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="kd">func&lt;/span> &lt;span class="nf">getNamespace&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="kt">string&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">ns&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">_&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nf">kubeConfig&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="nf">ToRawKubeConfigLoader&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="nf">Namespace&lt;/span>&lt;span class="p">();&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="nx">ns&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="s">&amp;#34;default&amp;#34;&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç›´æ¥ä½¿ç”¨ Kubeconfig ä¸­çš„ Namespace äº†ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥åšä»¥ä¸‹æ“ä½œä»¥ä½¿ç”¨æ­¤ç‰¹æ€§ã€‚&lt;/p>
&lt;pre>&lt;code>(MoeLove) âœ ~ kubectl config current-context
kubernetes-admin@moelove
(MoeLove) âœ ~ kubectl config set-context kubernetes-admin@moelove --namespace moelove
Context &amp;quot;kubernetes-admin@moelove&amp;quot; modified.
(MoeLove) âœ ~ helm3 -n moelove install redis stable/redis
...# çœç•¥è¾“å‡º
(MoeLove) âœ ~ helm3 list
NAME NAMESPACE REVISION UPDATED STATUS CHART
redis moelove 1 2019-05-17 00:26:44.572578745 +0800 CST deployed redis-7.1.0
&lt;/code>&lt;/pre>&lt;p>å¯ä»¥çœ‹åˆ°ï¼Œ&lt;code>redis&lt;/code> è¿™ä¸ª release åç§°å¯ä»¥åœ¨ &lt;code>moelove&lt;/code> è¿™ä¸ª Namespace ä¸­é‡å¤ä½¿ç”¨äº†ã€‚&lt;/p>
&lt;h2 id="å¿…é¡»æŒ‡å®š-release-åç§°">å¿…é¡»æŒ‡å®š release åç§°&lt;/h2>
&lt;p>åœ¨ Helm 2 ä¸­ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®š release çš„åç§°ï¼Œåˆ™ä¼šè‡ªåŠ¨éšæœºç”Ÿæˆä¸€ä¸ªåç§°ã€‚ä½†æ˜¯åœ¨ Helm 3 ä¸­ï¼Œåˆ™å¿…é¡»ä¸»åŠ¨æŒ‡å®šåç§°ï¼Œæˆ–è€…å¢åŠ  &lt;code>--generate-name&lt;/code> çš„å‚æ•°ã€‚æ¯”å¦‚ï¼š&lt;/p>
&lt;pre>&lt;code>(MoeLove) âœ ~ helm3 install stable/redis
Error: must either provide a name or specify --generate-name
(MoeLove) âœ ~ helm3 install stable/redis --generate-name
...# çœç•¥è¾“å‡º
(MoeLove) âœ ~ helm3 list
NAME NAMESPACE REVISION UPDATED STATUS CHART
redis1 default 1 2019-05-17 00:21:06.686127031 +0800 CST deployed redis-7.1.0
redis-1558024567 default 1 2019-05-17 00:36:09.294632336 +0800 CST deployed redis-7.1.0
redis default 1 2019-05-17 00:19:28.234013017 +0800 CST deployed redis-7.1.0
&lt;/code>&lt;/pre>&lt;h2 id="æ”¯æŒå°†-chart-æ¨é€è‡³-docker-é•œåƒä»“åº“ä¸­">æ”¯æŒå°† Chart æ¨é€è‡³ Docker é•œåƒä»“åº“ä¸­&lt;/h2>
&lt;p>ç®€è€Œè¨€ä¹‹å°±æ˜¯ä½¿ç”¨é•œåƒä»“åº“åŒæ—¶å­˜å‚¨ Docker é•œåƒå’Œ Helm 3 Chart ä¸è¿‡è¿™ä¸ªåŠŸèƒ½æˆ‘æš‚æ—¶è¿˜æ²¡éªŒè¯ã€‚ä¹‹åæœ‰ç©ºå†éªŒè¯ã€‚&lt;/p>
&lt;h2 id="ç§»é™¤æ‰äº†-helm-serve">ç§»é™¤æ‰äº† &lt;code>helm serve&lt;/code>&lt;/h2>
&lt;p>åœ¨ Helm 2 ä¸­ï¼Œå¯ä»¥ç®€å•çš„é€šè¿‡ &lt;code>helm serve&lt;/code> æ¥å¯åŠ¨ä¸€ä¸ªæœ¬åœ°ç®€å•çš„ HTTP æœåŠ¡ï¼Œç”¨äºæ‰˜ç®¡æœ¬åœ° local repo ä¸­çš„ Chart ä¿¡æ¯ã€‚&lt;/p>
&lt;p>ä¸è¿‡è¿™ä¸ªåŠŸèƒ½åœ¨ Helm 3 ä¸­è¢«ç§»é™¤äº†ã€‚å¯èƒ½æ˜¯ä½¿ç”¨åœºæ™¯æœ‰é™ã€‚&lt;/p>
&lt;h2 id="æ€»ç»“">æ€»ç»“&lt;/h2>
&lt;p>Helm 3 çš„æ”¹åŠ¨è¿˜æ˜¯æ¯”è¾ƒå¤§çš„ï¼Œä½†æ˜¯å»é™¤æ‰ &lt;code>Tiller&lt;/code> çš„é€‰æ‹©æ˜¯éå¸¸æ­£ç¡®çš„ï¼Œè¿™è®©é›†ç¾¤æƒé™çš„ç®¡ç†æ›´åŠ ç®€å•æ¸…æ™°ã€‚æ›´å¤šå…³äº Helm 3 çš„ä¿¡æ¯è¯·å…³æ³¨ &lt;a href="https://github.com/helm/helm/releases/tag/v3.0.0-alpha.1">ReleaseNote&lt;/a>&lt;/p>
&lt;hr>
&lt;p>å¯ä»¥é€šè¿‡ä¸‹é¢äºŒç»´ç è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category><category domain="https://moelove.info/tags/Helm/">Helm</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| 2019-05-06~2019-05-12</title><link>https://moelove.info/2019/05/12/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-2019-05-06~2019-05-12/</link><guid isPermaLink="true">https://moelove.info/2019/05/12/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-2019-05-06~2019-05-12/</guid><pubDate>Sun, 12 May 2019 20:47:02 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ &lt;a href="https://zhuanlan.zhihu.com/container">ã€Œk8sç”Ÿæ€ã€&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="alpine-linux-docker-é•œåƒæ¼æ´-cve-2019-5021">Alpine Linux Docker é•œåƒæ¼æ´ CVE-2019-5021&lt;/h2>
&lt;p>æœ¬å‘¨æ¯”è¾ƒå“äººçš„æ˜¯ &lt;a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-5021">CVE-2019-5021&lt;/a>, æ ¹æ®æ¼æ´æŠ¥å‘Šï¼Œè‡ª Alpine Linux 3.3 ç‰ˆæœ¬å¼€å§‹çš„æ‰€æœ‰ Docker é•œåƒä¸­ï¼Œroot ç”¨æˆ·åŒ…å«ä¸€ä¸ªç©ºå¯†ç ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´æ”»å‡»è€…è·å¾— root æƒé™ï¼Œä»Šå„¿é€ æˆæ”»å‡»ã€‚&lt;/p>
&lt;p>&lt;strong>æŠ¥å‘Šä¸­ç§°ï¼šå—å½±å“èŒƒå›´æ˜¯ Alpine Linux Docker é•œåƒ 3.3ã€3.4ã€3.5ã€3.6ã€3.7ã€3.8ã€3.9ã€edge ç­‰å…¨éƒ¨ç‰ˆæœ¬ã€‚&lt;/strong>&lt;/p>
&lt;p>è¦çŸ¥é“ç”±äº Alpine Linux é•œåƒä½“ç§¯è¾ƒå°ï¼Œæ‰€ä»¥åœ¨æ„å»º Docker é•œåƒæ—¶ï¼Œå¾ˆå¤šäººéƒ½ä¼šæ¨èä½¿ç”¨ Alpine Linux ä½œä¸ºåŸºç¡€é•œåƒï¼›åŒ…æ‹¬å¾ˆå¤š Docker å®˜æ–¹é•œåƒä¹ŸåŸºæœ¬ä¸Šéƒ½æä¾›äº†åŸºäº Alpine Linux çš„é•œåƒï¼Œç”šè‡³åƒ Docker é•œåƒç­‰æ˜¯åªæä¾›äº†ä½¿ç”¨ Alpine Linux ä½œä¸ºåŸºç¡€é•œåƒçš„ç‰ˆæœ¬ã€‚&lt;/p>
&lt;p>å½“å‰æ¼æ´å·²ç»ä¿®å¤ï¼Œæ›´å¤šå†…å®¹è¯·é˜…è¯» &lt;a href="https://zhuanlan.zhihu.com/p/65513733">å…³äº Alpine Docker é•œåƒæ¼æ´ CVE-2019-5021&lt;/a> ã€‚&lt;/p>
&lt;h2 id="istio-operator-å‘å¸ƒ-0112-ç‰ˆæœ¬">istio-operator å‘å¸ƒ 0.1.12 ç‰ˆæœ¬&lt;/h2>
&lt;p>&lt;a href="https://github.com/banzaicloud/istio-operator">banzaicloud/istio-operator&lt;/a> å‘å¸ƒ &lt;a href="https://github.com/banzaicloud/istio-operator/releases/tag/0.1.12">0.1.12&lt;/a> ç‰ˆæœ¬ï¼Œé»˜è®¤å·²æ”¯æŒ &lt;a href="https://istio.io">istio&lt;/a> 1.1.5 ã€‚ï¼ˆè™½ç„¶æˆªè‡³ç›®å‰ istio å‘å¸ƒäº† 1.1.6 ç‰ˆæœ¬ï¼Œè§ä¸‹æ¡ï¼‰&lt;/p>
&lt;p>&lt;img src="https://github.com/banzaicloud/istio-operator/blob/release-1.1/docs/img/operator.png" alt="">&lt;/p>
&lt;h2 id="istio-å‘å¸ƒ-116-ç‰ˆæœ¬">istio å‘å¸ƒ 1.1.6 ç‰ˆæœ¬&lt;/h2>
&lt;p>å¸¸è§„ç‰ˆæœ¬ï¼Œä¸»è¦åœ¨ Helm Chart çš„ fix ä¸Šã€‚æ›´å¤šä¿¡æ¯è¯·å‚è€ƒ &lt;a href="https://github.com/istio/istio.io/blob/a913ce8bdea28f754163b6c2c1d603fd331e50ea/content/boilerplates/notes/1.1.6.md">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="envoy-æ”¯æŒ-kafka-äº†">Envoy æ”¯æŒ Kafka äº†&lt;/h2>
&lt;p>è¿™æ˜¯ä¸€ä¸ªé•¿è¾¾åŠå¹´ä¹‹ä¹…çš„ PRï¼Œ åœ¨ä¹‹å‰ Envoy ä» CNCF æ¯•ä¸šæ—¶ï¼Œå…¶ä½œè€…å°±æåˆ°è¿‡åœ¨ 2019 å¹´ä¼šå¢åŠ æ›´å¤šåè®®ï¼Œå…¶ä¸­ä¾¿åŒ…æ‹¬å¯¹ Kafka çš„æ”¯æŒã€‚&lt;/p>
&lt;p>å¯¹æ­¤å†…å®¹æ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥å‚è€ƒ &lt;a href="https://github.com/envoyproxy/envoy/pull/4950">PR å†…å®¹&lt;/a>.&lt;/p>
&lt;h2 id="cni-plugins-v080-æ­£å¼å‘å¸ƒ">CNI plugins v0.8.0 æ­£å¼å‘å¸ƒ&lt;/h2>
&lt;p>è¿™æ˜¯ä¸€ä¸ª major release ä¸»è¦æ”¯æŒäº† CNI spec v0.4.0ï¼Œå¢åŠ äº† CHECK çš„æ”¯æŒ, å¹¶ä¸”æ·»åŠ äº† 6 ä¸ªæ–°æ’ä»¶ã€‚&lt;/p>
&lt;p>CHECK æ”¯æŒå…è®¸å®¹å™¨è¿è¡Œæ—¶éªŒè¯å®¹å™¨çš„ç½‘ç»œæ˜¯å¦æ­£å¸¸è¿è¡Œï¼Œæ‰€æœ‰çš„å®˜æ–¹æ’ä»¶éƒ½æ”¯æŒ CHECKã€‚&lt;/p>
&lt;p>æ–°çš„æ’ä»¶åŒ…æ‹¬ï¼š&lt;/p>
&lt;ul>
&lt;li>bandwidth - é™åˆ¶è¿›å‡ºæµé‡.&lt;/li>
&lt;li>firewall - æ·»åŠ å®¹å™¨åˆ°é˜²ç«å¢™è§„åˆ™.&lt;/li>
&lt;li>sbr - å°†å®¹å™¨è·¯ç”±è½¬æ¢ä¸ºåŸºäºæºçš„è·¯ç”±.&lt;/li>
&lt;li>static - åˆ†é…å›ºå®šçš„ IP åœ°å€.&lt;/li>
&lt;li>win-bridge, win-overlay: Windows æ’ä»¶.&lt;/li>
&lt;/ul>
&lt;p>æ›´å¤šå†…å®¹ï¼Œè¯·å‚è€ƒ &lt;a href="https://github.com/containernetworking/plugins/releases/tag/v0.8.0">ReleaseNote&lt;/a>&lt;/p>
&lt;hr>
&lt;p>å¯ä»¥é€šè¿‡ä¸‹é¢äºŒç»´ç è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>å…³äº Alpine Docker é•œåƒæ¼æ´ CVE-2019-5021</title><link>https://moelove.info/2019/05/11/%E5%85%B3%E4%BA%8E-Alpine-Docker-%E9%95%9C%E5%83%8F%E6%BC%8F%E6%B4%9E-CVE-2019-5021/</link><guid isPermaLink="true">https://moelove.info/2019/05/11/%E5%85%B3%E4%BA%8E-Alpine-Docker-%E9%95%9C%E5%83%8F%E6%BC%8F%E6%B4%9E-CVE-2019-5021/</guid><pubDate>Sat, 11 May 2019 21:07:10 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>å…³äº CVE-2019-5021 å¸¦æ¥çš„ä¸€ç‚¹æ€è€ƒã€‚&lt;/p>
&lt;/blockquote>
&lt;p>æœ¬å‘¨æ¯”è¾ƒå“äººçš„æ˜¯ &lt;a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-5021">CVE-2019-5021&lt;/a>, æ ¹æ®æ¼æ´æŠ¥å‘Šï¼Œè‡ª Alpine Linux 3.3 ç‰ˆæœ¬å¼€å§‹çš„æ‰€æœ‰ Docker é•œåƒä¸­ï¼Œroot ç”¨æˆ·åŒ…å«ä¸€ä¸ªç©ºå¯†ç ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´æ”»å‡»è€…è·å¾— root æƒé™ï¼Œè¿›è€Œé€ æˆæ”»å‡»ã€‚&lt;/p>
&lt;p>&lt;strong>æŠ¥å‘Šä¸­ç§°ï¼šå—å½±å“èŒƒå›´æ˜¯ Alpine Linux Docker é•œåƒ 3.3ã€3.4ã€3.5ã€3.6ã€3.7ã€3.8ã€3.9ã€edge ç­‰å…¨éƒ¨ç‰ˆæœ¬ã€‚&lt;/strong>&lt;/p>
&lt;p>è¦çŸ¥é“ç”±äº Alpine Linux é•œåƒä½“ç§¯è¾ƒå°ï¼Œæ‰€ä»¥åœ¨æ„å»º Docker é•œåƒæ—¶ï¼Œå¾ˆå¤šäººéƒ½ä¼šæ¨èä½¿ç”¨ Alpine Linux ä½œä¸ºåŸºç¡€é•œåƒï¼›åŒ…æ‹¬å¾ˆå¤š Docker å®˜æ–¹é•œåƒä¹ŸåŸºæœ¬ä¸Šéƒ½æä¾›äº†åŸºäº Alpine Linux çš„é•œåƒï¼Œç”šè‡³åƒ Docker é•œåƒç­‰ï¼Œæ˜¯åªæä¾›äº†ä½¿ç”¨ Alpine Linux ä½œä¸ºåŸºç¡€é•œåƒçš„ç‰ˆæœ¬ã€‚&lt;/p>
&lt;p>æŠ¥å‘Šä¸€å‡ºï¼Œç¬é—´è¿™ä¸ªæ¶ˆæ¯å°±è¢«ä¼ æ’­æˆäº† â€œAlpine Linux Docker é•œåƒä¸å®‰å…¨â€/â€œä¸è¦å†ä½¿ç”¨ Alpine Linux äº†â€ã€‚å½“ç„¶ Google çš„å¼€å‘è€…ä¹Ÿé¡ºä¾¿æ¨äº†ä¸€æ¬¡è‡ªå®¶çš„ distroless é•œåƒã€‚&lt;/p>
&lt;p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ CVE-2019-5021 åˆ°åº•æ˜¯ä»€ä¹ˆä»¥åŠå¦‚ä½•å¤ç°å§ã€‚&lt;/p>
&lt;h2 id="cve-2019-5021">CVE-2019-5021&lt;/h2>
&lt;pre>&lt;code>(MoeLove) âœ ~ docker run --rm -it alpine:3.9
/ # grep root /etc/passwd
root:x:0:0:root:/root:/bin/ash
operator:x:11:0:operator:/root:/bin/sh
/ # grep root /etc/shadow
root:::0:::::
/ #
&lt;/code>&lt;/pre>&lt;p>ä»¥ä¸Šæ˜¯ä¸€ä¸ª &lt;code>alpine:3.9&lt;/code> çš„é•œåƒï¼Œæˆ‘ä»¬åˆ†åˆ«æ¥çœ‹å®ƒçš„ &lt;code>/etc/passwd&lt;/code> å’Œ &lt;code>/etc/shadow&lt;/code> æ–‡ä»¶ï¼Œå¾ˆæ˜æ˜¾ï¼Œæ­¤åˆ» &lt;code>root&lt;/code> ç”¨æˆ·æ˜¯ä¸€ä¸ªç©ºå¯†ç ï¼›å¹¶ä¸ç¬¦åˆé¢„æœŸã€‚è¿™æ ·ä¹Ÿå°±å¯¼è‡´äº†è¢«æ”»å‡»çš„å¯èƒ½æ€§ã€‚æˆ‘ä»¬æ¥çœ‹ä¸‹å¦‚ä½•å¤ç°æ”»å‡»ä»¥åŠä¿®å¤ã€‚&lt;/p>
&lt;h2 id="å¤ç°">å¤ç°&lt;/h2>
&lt;p>å…ˆæ¥çœ‹ä¸‹å¦‚ä½•å¤ç°, ç¼–å†™å¦‚ä¸‹çš„ &lt;code>Dockerfile&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-Dockerfile" data-lang="Dockerfile">&lt;span class="k">FROM&lt;/span>&lt;span class="s"> alpine:3.9&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="k">RUN&lt;/span> apk add --no-cache shadow&lt;span class="err">
&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="k">RUN&lt;/span> adduser -S moelove&lt;span class="err">
&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="k">USER&lt;/span>&lt;span class="s"> moelove&lt;/span>&lt;span class="err">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç”¨ &lt;code>docker build -t local/alpine:cve .&lt;/code> æ„å»ºé•œåƒï¼Œæ¥ä¸‹æ¥å¤ç°ï¼š&lt;/p>
&lt;pre>&lt;code>(MoeLove) âœ cve docker run --rm -it local/alpine:cve
/ $ id
uid=100(moelove) gid=65533(nogroup) groups=65533(nogroup)
/ $ whoami
moelove
/ $ su -
4a5cc376be74:~#
4a5cc376be74:~# whoami
root
4a5cc376be74:~# grep root /etc/passwd /etc/shadow
/etc/passwd:root:x:0:0:root:/root:/bin/ash
/etc/passwd:operator:x:11:0:operator:/root:/bin/sh
/etc/shadow:root:::0:::::
&lt;/code>&lt;/pre>&lt;p>å¯ä»¥çœ‹åˆ°æˆåŠŸä½¿ç”¨æ™®é€šç”¨æˆ·è·å–çš„ &lt;code>root&lt;/code> æƒé™ã€‚&lt;/p>
&lt;h2 id="ä¿®å¤">ä¿®å¤&lt;/h2>
&lt;p>&lt;strong>å½“å‰å®˜æ–¹é•œåƒå·²ç»ä¿®å¤ï¼Œå¯ç›´æ¥æ›´æ–°å¯¹åº”é•œåƒ&lt;/strong>&lt;/p>
&lt;p>æˆ–æ˜¯&lt;/p>
&lt;p>åœ¨ Dockerfile ä¸­å¢åŠ ä¸‹é¢è¿™è¡Œï¼š&lt;/p>
&lt;pre>&lt;code>RUN sed -ie 's/^root::/root:!:/' &amp;quot;$rootfs/etc/shadow&amp;quot;
&lt;/code>&lt;/pre>&lt;p>å¯¹åº”äºåˆšæ‰å®¹å™¨å†…çš„æ“ä½œä¾¿æ˜¯ï¼š&lt;/p>
&lt;pre>&lt;code>4a5cc376be74:~# sed -ie 's/^root::/root:!:/' /etc/shadow
4a5cc376be74:~# grep root /etc/passwd /etc/shadow
/etc/passwd:root:x:0:0:root:/root:/bin/ash
/etc/passwd:operator:x:11:0:operator:/root:/bin/sh
/etc/shadow:root:!::0:::::
4a5cc376be74:~# / $ su -
Password:
su: Authentication failure
/ $ whoami
moelove
&lt;/code>&lt;/pre>&lt;h2 id="æ€è€ƒ">æ€è€ƒ&lt;/h2>
&lt;p>è¿™ä¸ªâ€œæ¼æ´â€ (å§‘ä¸”ç§°ä¹‹ä¸ºæ¼æ´å§)ï¼Œæ˜¯åœ¨ 5 æœˆ 9 æ—¥è¢«å…¬å¸ƒï¼Œç½‘ä¸Šçš„è®¨è®ºå…¶å®æœ‰äº›è¨€è¿‡å…¶å®ã€‚&lt;/p>
&lt;p>æœ¬èº«è¿™ä¸ªé—®é¢˜å¦‚æœæƒ³è¦æˆä¸ºæ”»å‡»ç‚¹ï¼Œå…¶ä¸­ä¸€ç§æ–¹å¼æ˜¯éœ€è¦å®‰è£… &lt;code>shadow&lt;/code> å’Œ &lt;code>linux-pam&lt;/code> æ›¿ä»£ Alpine Linux é»˜è®¤çš„ BusyBox å·¥å…·é“¾ã€‚è€Œåœ¨ Docker é•œåƒä¸­å®‰è£… &lt;code>shadow&lt;/code> çš„å¯èƒ½æ€§å…¶å®å¾ˆå°ï¼ˆæœ€èµ·ç æˆ‘æš‚æ—¶æ²¡æƒ³åˆ°æˆ‘ä¼šä¸»åŠ¨åœ¨é•œåƒä¸­å®‰è£… shadow çš„æƒ…å†µï¼‰ã€‚&lt;/p>
&lt;p>åœ¨æˆ‘çœ‹æ¥ï¼Œè¿™ä¸ªé—®é¢˜æ˜¯å¯¹äºé»˜è®¤é•œåƒæ¥è¯´ï¼Œé—®é¢˜å­˜åœ¨ï¼Œä½†æ˜¯å‡ ä¹æ²¡æœ‰è§¦å‘çš„å¯èƒ½, å¿…é¡»è¦å…·å¤‡ä¸Šé¢æåˆ°çš„ç‰¹å®šæ¡ä»¶ã€‚(å½“ç„¶ä¹Ÿè¿˜æœ‰å¦ä¸€ç§å¯èƒ½ï¼Œè¿™é‡Œä¸èµ˜è¿°äº†)&lt;/p>
&lt;p>å¦å¤–ï¼Œå—å½±å“çš„é•œåƒï¼Œå¤§å¤šå…¶å®å·²ç» EOL ä¸å†è¿›è¡Œç»´æŠ¤äº†ã€‚è¿™ä¹ŸåŒæ—¶æé†’æˆ‘ä»¬åŠæ—¶å‡çº§ä¾èµ–éå¸¸é‡è¦ã€‚&lt;/p>
&lt;p>æ­¤å¤–ï¼Œå…³äºè¿™æ˜¯ä¸æ˜¯ä¸€ä¸ªæ¼æ´çš„è®¨è®ºå…¶å®å¾ˆå¤šï¼Œå…³æ³¨ç‚¹åœ¨äºè¯´è¿™äº›æ¼æ´è§¦å‘éƒ½æ˜¯äººä¸ºæ“ä½œ/æ‰©å±•æ¥é€ æˆçš„ï¼Œè¿™ä¸ªäº‹æƒ…æˆ‘ä¸æƒ³èŠå¤ªå¤šï¼Œå› ä¸ºå³ä½¿å¯¹äºå…¶ä»–çš„ Linux å‘è¡Œç‰ˆæ¥è¯´ï¼Œä¹Ÿæœ‰å¾ˆå¤šæ–¹å¼èƒ½é€ æˆè¢«æ”»å‡»ä¹‹ç±»çš„ï¼Œé‚£è¿™ç§æƒ…å†µç®—æ˜¯ Linux æ¼æ´ è¿˜æ˜¯ç®—å…¶ä»–çš„å‘¢ï¼Ÿ&lt;/p>
&lt;p>å°±å…ˆèŠåˆ°è¿™å„¿å§ã€‚è¯·åŠæ—¶æ›´æ–°/ä¿®å¤ Alpine ç›¸å…³é•œåƒã€‚&lt;/p>
&lt;hr>
&lt;p>å¯ä»¥é€šè¿‡ä¸‹é¢äºŒç»´ç è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Docker/">Docker</category><category domain="https://moelove.info/tags/Container/">Container</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| 2019-04-28~2019-05-05</title><link>https://moelove.info/2019/05/05/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-2019-04-28~2019-05-05/</link><guid isPermaLink="true">https://moelove.info/2019/05/05/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-2019-04-28~2019-05-05/</guid><pubDate>Sun, 05 May 2019 21:59:07 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ ã€Œk8sç”Ÿæ€ã€ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="docker-hub-åªè¯»ç»´æŠ¤">Docker Hub åªè¯»ç»´æŠ¤&lt;/h2>
&lt;p>åœ¨&lt;a href="https://zhuanlan.zhihu.com/p/64157368">ä¸Šå‘¨çš„æ¨é€&lt;/a>ä¸­ï¼Œæœ‰å†™åˆ° Docker Hub ç”¨æˆ·éšç§æ•°æ®æ³„æ¼ã€‚å—æ­¤äº‹ä»¶å½±å“ï¼Œ5 æœˆ 4 æ—¥ Docker Hub è¿›è¡Œå‡çº§ç»´æŠ¤ï¼Œåœ¨æ­¤æœŸé—´ Docker Hub æœ‰ä¸€æ®µæ—¶é—´å¤„äºåªè¯»æ¨¡å¼ï¼ŒåŒ…æ‹¬è‡ªåŠ¨æ„å»ºç­‰æœåŠ¡ä¸å¯ç”¨ï¼›åœ¨æœ€åæœ‰å°äº 15 åˆ†é’Ÿçš„å®Œå…¨å®•æœºæ—¶é—´ï¼ŒæœåŠ¡å®Œå…¨ä¸å¯ç”¨ã€‚&lt;/p>
&lt;p>å¦‚æœåªæ˜¯çœ‹äº‹æƒ…è¡¨é¢çš„è¯ï¼Œå¯èƒ½è¿™å°±æ˜¯ä¸€ä¸ªç”±äºå‘ç°â€œå®‰å…¨é—®é¢˜â€è€Œè¿›è¡Œçš„å‡çº§/ç»´æŠ¤ï¼›ä½†å¦‚æœä»”ç»†è€ƒè™‘ä¸‹ï¼Œä½œä¸ºäº‘åŸç”ŸæœåŠ¡ï¼Œå‡çº§ä¸ºä½•ä¼šæœ‰å®•æœºçš„æƒ…å†µï¼Œä¸ºä½•ä¼šæœ‰æœåŠ¡å®Œå…¨ä¸å¯ç”¨çš„æ—¶å€™ï¼Ÿ&lt;/p>
&lt;p>æ‘˜å½•ä¸€æ®µæ¥è‡ªæœ¬æ¬¡ç»´æŠ¤çš„å…¬å‘Šå†…å®¹ï¼š&lt;/p>
&lt;blockquote>
&lt;p>Q: Is this maintenance related to recent Docker Hub data breach?&lt;/p>
&lt;/blockquote>
&lt;blockquote>
&lt;p>A: While we discovered unauthorized access to a single Hub database storing a subset of non-financial user data last week, which has since been remediated, we are always looking at ways to improve and enhance our security practices to protect our customers and their data. The planned maintenance for Docker Hub on Saturday May 4 is a proactive step we are taking to provide the best possible customer experience and highest level of security&lt;/p>
&lt;/blockquote>
&lt;p>æœ¬æ¬¡çš„ç»´æŠ¤ä¸ä¸Šå‘¨ç”¨æˆ·æ•°æ®æ³„æ¼æœ‰å¾ˆå¤§å…³ç³»ï¼Œè€ŒæœåŠ¡åªè¯»å’Œæœ‰å®•æœºæƒ…å†µå¯èƒ½ä¸»è¦æ˜¯ç”±äºæ•°æ®åº“çš„åŸå› ï¼Œæ¯•ç«Ÿè¿™æ ·å¤„ç†å¯ä»¥é¿å…å¾ˆå¤šéº»çƒ¦å’Œæä¾›æ›´å¤šçš„ä¿éšœã€‚&lt;/p>
&lt;p>å†è€…ï¼Œæœ¬æ¬¡çš„é€šçŸ¥æ˜¯åœ¨æ“ä½œå‰ 24 å°æ—¶å·¦å³å‘å¸ƒçš„ï¼Œè€Œä¸”å¹¶æ²¡æœ‰æŠ«éœ²ç»†èŠ‚ï¼Œå¯èƒ½æ˜¯ä¸ºäº†é¿å…å†æ¬¡è¢«æ”»å‡»ï¼Œæˆ–è€…æ˜¯åœ¨ä¸Šæ¬¡å‘ç°é—®é¢˜ï¼Œç»è¿‡æ’æŸ¥ä¹‹åå‘ç°äº†å…¶ä»–çš„é—®é¢˜ä¹‹ç±»çš„ï¼Œéœ€è¦åŠæ—¶ä¿®æ­£ï¼ˆä¸è¿‡åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæ²¡æœ‰ä»»ä½•ç»†èŠ‚æŠ«éœ²ï¼‰ã€‚&lt;/p>
&lt;p>å»ºè®®å¯¹äºé‡è¦çš„é•œåƒæˆ–è€…æœåŠ¡ï¼Œå°½é‡ç»´æŠ¤ä¸€ä¸ªç§æœ‰é•œåƒæºï¼Œä»¥å…åœ¨è¿™ç§å®•æœºæƒ…å†µä¸‹ï¼Œæ— æ³•è¿›è¡Œæ­£å¸¸çš„ä½¿ç”¨ã€‚&lt;/p>
&lt;p>æ›´å¤šå†…å®¹è¯·é˜…è¯» &lt;a href="https://success.docker.com/article/docker-hub-maintenance">Docker Hub Maintenance - May 2019&lt;/a>&lt;/p>
&lt;h2 id="docker-ce-v18096-rc1-å‘å¸ƒ">Docker CE v18.09.6-rc1 å‘å¸ƒ&lt;/h2>
&lt;p>ä¸€ä¸ªå¸¸è§„çš„ bugfix ç‰ˆæœ¬ï¼ŒåŒ…å«äº†ä¸€ä¸ªä½¿ç”¨ buildkit æ—¶ï¼Œ&lt;code>COPY&lt;/code> å’Œ &lt;code>ADD&lt;/code> ä½¿ç”¨äº†ç¼“å­˜çš„ bug ã€‚&lt;/p>
&lt;p>æ›´å¤šç»†èŠ‚å¯ä»¥æŸ¥çœ‹ &lt;a href="https://github.com/docker/docker-ce/releases/tag/v18.09.6-rc1">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="docker-enterprise-30-å‘å¸ƒ">Docker Enterprise 3.0 å‘å¸ƒ&lt;/h2>
&lt;p>åœ¨ DockerCon ä¸Šï¼ŒDocker å…¬å¸æ­£å¼å®£å¸ƒäº† Docker Enterprise 3.0 è¿™æ˜¯å”¯ä¸€ä¸€ä¸ªæ¡Œé¢åˆ°äº‘çš„ä¼ä¸šçº§å®¹å™¨å¹³å°ï¼Œæ”¯æŒç»„ç»‡æ„å»ºå’Œåˆ†å‘åº”ç”¨ï¼Œå¹¶ä¸”å®‰å…¨çš„è¿è¡Œåº”ç”¨ï¼Œä»æ··åˆäº‘åˆ°è¾¹ç¼˜è®¡ç®—éƒ½å¯ä»¥ã€‚&lt;/p>
&lt;p>åœ¨å›½å†…ç”¨ Docker ä¼ä¸šç‰ˆçš„å…¬å¸è²Œä¼¼å¾ˆå°‘ï¼Œä½†æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡æ­¤ç‰ˆæœ¬æ¥äº†è§£ä¸‹ä¼ä¸šçº§å®¹å™¨å¹³å°æ‰€å…³æ³¨çš„ä¸€äº›é‡ç‚¹ï¼š&lt;/p>
&lt;ul>
&lt;li>åŸºäºæ¨¡æ¿æ¥æ›´æ–¹ä¾¿çš„åˆ›å»ºå®¹å™¨åŒ–åº”ç”¨çš„å·¥ä½œæµï¼Œåœ¨ä¼ä¸šæ¨åŠ¨åº”ç”¨å®¹å™¨åŒ–çš„è¿‡ç¨‹ä¸­ï¼Œæ¨¡æ¿åŒ–å·¥ä½œæµå¯ä»¥é™ä½é—¨æ§›ï¼Œæ›´å®¹æ˜“æ¨åŠ¨åº”ç”¨æ”¹é€ ï¼›&lt;/li>
&lt;li>å¯ç«‹å³åœ¨æœ¬åœ°ç¯å¢ƒå¤åˆ¶çº¿ä¸Šç¯å¢ƒçš„é…ç½®ï¼Œå®¹å™¨æŠ€æœ¯çš„å…´èµ·ï¼Œä¸»è¦æ˜¯ç”±äºå®ƒå¯ä»¥å±è”½æ‰ä¸€äº›ç¯å¢ƒå·®å¼‚æ‰€å¸¦æ¥çš„é—®é¢˜ï¼Œå‡å°‘è¿ç»´/å¼€å‘è´Ÿæ‹…ï¼Œä½†ç”±äºä½¿ç”¨å§¿åŠ¿çš„ä¸åŒï¼Œç°åœ¨å¾ˆå¯èƒ½é¢ä¸´è¿‡å»çš„ â€œåœ¨æˆ‘æœ¬åœ°è·‘çš„å¥½å¥½çš„â€ è¿™ç§é—®é¢˜ï¼Œè¿™äº›ä¸»è¦æ˜¯ç”±äºé…ç½®å’Œç¯å¢ƒçš„å·®å¼‚é€ æˆçš„ï¼Œåº”å°½é‡é¿å…ï¼Œä»¥åŠè§„èŒƒä½¿ç”¨å§¿åŠ¿ï¼›&lt;/li>
&lt;li>Docker Kubernetes Service (DKS) : Docker Enterprise 3.0 åŒ…å«äº† Kubernetes 1.14 ï¼Œå¹¶ä¸”åŒ…å«äº†å¯¹ CSI çš„å…¨åŠŸèƒ½æ”¯æŒï¼›&lt;/li>
&lt;li>æä¾›äº†åŸºäºè¯ä¹¦çš„è®¤è¯ï¼›&lt;/li>
&lt;/ul>
&lt;p>æ›´å¤šç»†èŠ‚è¯·å‚è€ƒ &lt;a href="https://blog.docker.com/2019/04/announcing-docker-enterprise-3-0/">Announcing Docker Enterprise 3.0: Delivering High-Velocity Application Innovation&lt;/a>&lt;/p>
&lt;hr>
&lt;p>å¯ä»¥é€šè¿‡ä¸‹é¢äºŒç»´ç è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| 2019-04-22~2019-04-28</title><link>https://moelove.info/2019/04/29/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-2019-04-22~2019-04-28/</link><guid isPermaLink="true">https://moelove.info/2019/04/29/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-2019-04-22~2019-04-28/</guid><pubDate>Mon, 29 Apr 2019 00:36:25 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ ã€Œk8sç”Ÿæ€ã€ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="docker-hub-ç”¨æˆ·éšç§æ•°æ®æ³„æ¼">Docker Hub ç”¨æˆ·éšç§æ•°æ®æ³„æ¼&lt;/h2>
&lt;p>&lt;strong>2019 å¹´ 4 æœˆ 25 æ—¥ï¼ŒDocker Hub å›¢é˜Ÿå‘ç°äº†å¯¹å­˜å‚¨éè´¢åŠ¡ç”¨æˆ·æ•°æ®å­é›†çš„å•ä¸ª Hub æ•°æ®åº“çš„æœªæˆæƒè®¿é—®ã€‚&lt;/strong> åœ¨å‘ç°å¼‚å¸¸åå®˜æ–¹å›¢é˜Ÿè¿…é€Ÿé‡‡å–è¡ŒåŠ¨å¹¶ä¿æŠ¤ç½‘ç«™å…å—æ”»å‡»ã€‚&lt;/p>
&lt;p>ç»è¿‡å®˜æ–¹å›¢é˜Ÿçš„è°ƒæŸ¥ï¼Œç›®å‰å¤§æ¦‚æœ‰ 190000 å¸å·çš„æ•æ„Ÿä¿¡æ¯ï¼ˆå°äºæ€»ç”¨æˆ·æ•°çš„ 5% ï¼‰åŒ…æ‹¬ç”¨æˆ·åå’Œå“ˆå¸Œåçš„ç”¨æˆ·å¯†ç ï¼Œå½“ç„¶ä¹ŸåŒ…æ‹¬ GitHub åŠ Bitbucket ç­‰çš„ç”¨äºè‡ªåŠ¨æ„å»ºçš„ Token ã€‚&lt;/p>
&lt;p>å½“å‰çš„ä¸»è¦æªæ–½æ˜¯å¯¹å¯èƒ½è¢«æ³„æ¼ä¿¡æ¯çš„ç”¨æˆ·å‘é€äº†é‚®ä»¶é€šçŸ¥ï¼Œå¯¹äºå¯èƒ½æ³„æ¼å“ˆå¸Œå¯†ç çš„ç”¨æˆ·å‘é€äº†é‡ç½®å¯†ç çš„é‚®ä»¶ï¼Œå¹¶ä¸” &lt;strong>ä¸»åŠ¨&lt;/strong> å°†å¯†ç å¤±æ•ˆï¼Œä»¥åŠè‡ªåŠ¨æ„å»ºçš„ Token ä¹Ÿéƒ½è¢«å¤±æ•ˆã€‚( &lt;strong>æ‰€ä»¥å¦‚æœä½ æ”¶åˆ°äº† Docker Hub å›¢é˜Ÿå…³äºæ­¤æ¬¡äº‹ä»¶çš„ç›´æ¥æŠ¥å‘Šé‚®ä»¶ï¼Œå¾ˆå¤§æ¦‚ç‡æ˜¯å› ä¸ºä½ çš„ä¿¡æ¯å·²ç»è¢«æ³„æ¼äº†&lt;/strong> )&lt;/p>
&lt;p>é™„ä¸Šå®˜æ–¹å£°æ˜ä¸­å…³äºæ­¤æ¬¡äº‹ä»¶çš„å¤„ç†å£°æ˜ï¼š&lt;/p>
&lt;blockquote>
&lt;p>During a brief period of unauthorized access to a Docker Hub database, sensitive data from approximately 190,000 accounts may have been exposed (less than 5% of Hub users). Data includes usernames and hashed passwords for a small percentage of these users, as well as GitHub and Bitbucket tokens for Docker autobuilds.&lt;/p>
&lt;/blockquote>
&lt;blockquote>
&lt;ul>
&lt;li>We are asking users to change their password on Docker Hub and any other accounts that shared this password.&lt;/li>
&lt;li>For users with autobuilds that may have been impacted, we have revoked GitHub tokens and access keys. This means your autobuilds will fail, and we ask that you reconnect to your repositories and check security logs to see if any unexpected actions have taken place.&lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;ul>
&lt;li>You may view security actions on your GitHub or BitBucket accounts to verify if any unexpected access has occurred - see &lt;a href="https://help.github.com/en/articles/reviewing-your-security-log">https://help.github.com/en/articles/reviewing-your-security-log&lt;/a> and &lt;a href="https://bitbucket.org/blog/new-audit-logs-give-you-the-who-what-when-and-where">https://bitbucket.org/blog/new-audit-logs-give-you-the-who-what-when-and-where&lt;/a>&lt;/li>
&lt;li>You may need to unlink and then relink your GitHub and Bitbucket source provider as described in &lt;a href="https://docs.docker.com/docker-hub/builds/link-source/">https://docs.docker.com/docker-hub/builds/link-source/&lt;/a>&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;/blockquote>
&lt;blockquote>
&lt;p>We are enhancing our overall security processes and reviewing our policies. Additional monitoring tools are now in place.&lt;/p>
&lt;/blockquote>
&lt;h2 id="runc-10-rc8-æ­£å¼å‘å¸ƒ">runc 1.0-rc8 æ­£å¼å‘å¸ƒ&lt;/h2>
&lt;p>æˆ‘åœ¨ &lt;a href="https://zhuanlan.zhihu.com/p/50923312">ã€Šrunc 1.0-rc6 å‘å¸ƒä¹‹é™…ã€‹&lt;/a> å’Œ &lt;a href="https://zhuanlan.zhihu.com/p/60981504">ã€Šrunc 1.0-rc7 å‘å¸ƒä¹‹é™…ã€‹&lt;/a> è¿™ä¸¤ç¯‡æ–‡ç« ä¸­ï¼Œåˆ†åˆ«ä»‹ç»äº† runc çš„åŸºç¡€å†…å®¹ä»¥åŠä¸ºä½• runc è¿Ÿè¿Ÿæœªå‘å¸ƒ 1.0 æ­£å¼ç‰ˆæœ¬çš„åŸå› ï¼›ä»¥åŠ rc6 å’Œ rc7 å‡ºç°çš„åŸå› å’Œå¯¹ç”¨æˆ·çš„å½±å“ã€‚&lt;/p>
&lt;p>æœ¬æ¬¡ runc 1.0-rc8 æ²¡æœ‰ä¸“é—¨å†™æ–‡ç« è¯´æ˜ï¼Œä¸»è¦æ˜¯å› ä¸ºæ­¤ç‰ˆæœ¬ä¸»è¦æ˜¯ä½œä¸ºä¸€ä¸ª hot-fix ç‰ˆæœ¬ï¼Œä¸»è¦ä¿®å¤ä¸€ä¸ªæ—§å†…æ ¸ä¸Šçš„å›å½’çš„æƒ…å†µã€‚è¿™ä¸ªæƒ…å†µæ˜¯åœ¨ runc 1.0-rc7 æ—¶å¼•å…¥çš„ï¼Œä½†æ˜¯å› ä¸ºè¿™ä¸ªé—®é¢˜ï¼Œä¹Ÿé˜»ç¢äº†éƒ¨åˆ†ç”¨æˆ·å‡çº§ï¼Œä»¥è§£å†³ CVE-2019-5736ã€‚&lt;/p>
&lt;p>ç›®å‰è·ç¦» 1.0 æ­£å¼å‘å¸ƒï¼Œæœ€ä¸»è¦çš„å†…å®¹å°±æ˜¯è®¨è®ºä¸€äº› OCI hooks ä»¥åŠå’Œç°æœ‰çš„ NVIDIA runtime hooks é›†æˆçš„é—®é¢˜ï¼ˆæ¯•ç«Ÿç°åœ¨æœºå™¨å­¦ä¹ ä½¿ç”¨ Docker æ—¶ï¼Œç”¨çš„æœ€å¤šçš„ä¾¿æ˜¯ NVIDIA runtimeï¼‰ã€‚&lt;/p>
&lt;p>æœŸå¾…èƒ½æ—©æ—¥è§£å†³ç›¸å…³é—®é¢˜ï¼Œå¹¶è¿æ¥ 1.0 çš„æ­£å¼å‘å¸ƒã€‚&lt;/p>
&lt;p>æ›´å¤šå†…å®¹æ¨èé˜…è¯» &lt;a href="https://github.com/opencontainers/runc/releases/tag/v1.0.0-rc8">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="docker-å’Œ-arm-å®£å¸ƒæ–°çš„åˆä½œ">Docker å’Œ Arm å®£å¸ƒæ–°çš„åˆä½œ&lt;/h2>
&lt;p>Docker å’Œ Arm å®£å¸ƒä¸€é¡¹æ–°çš„åˆä½œï¼Œå°†ä¸º Docker çš„å·¥å…·é“¾æä¾› Arm å¹³å°çš„æ”¯æŒã€‚ä¸»è¦çš„æƒ³æ³•å…¶å®æ˜¯æƒ³è®© Docker å˜å¾—æ›´ç®€å•ï¼Œ &lt;strong>ä½¿å¼€å‘äººå‘˜å¯ä»¥åœ¨è‡ªå·±çš„æ¡Œé¢ç”µè„‘ä¸Šå°±å¯ä»¥ç›´æ¥æ„å»ºå‡º Arm å¹³å°çš„åº”ç”¨ç¨‹åº&lt;/strong> ç„¶åå°†å…¶éƒ¨ç½²è‡³ Cloud, ç‰©è”ç½‘è®¾å¤‡, æˆ–è€…è¾¹ç¼˜ç½‘ç»œä¸Šã€‚å¹¶ä¸”ä¹Ÿå¯ç›´æ¥æ„å»º Arm çš„é•œåƒè€Œæ— éœ€ä»»ä½•äº¤å‰ç¼–è¯‘ç­‰ã€‚&lt;/p>
&lt;p>è¿™æ ·çš„ä¸»è¦å¥½å¤„æ˜¯ï¼Œç°æœ‰çš„å·²ç»æŒæ¡ Docker æŠ€æœ¯çš„å¼€å‘è€…ï¼Œå¯ä»¥æœ‰èƒ½åŠ›ç›´æ¥è½¬èº«æˆä¸º Arm å¹³å°çš„å¼€å‘è€…ï¼Œè€Œæ— éœ€æ›´å¤šé¢å¤–çš„æ¡ä»¶ã€‚&lt;/p>
&lt;p>è¿™äº›åŠŸèƒ½é€‚ç”¨äº JavaScript / Node.jsï¼ŒPythonï¼ŒJavaï¼ŒC++ï¼ŒRubyï¼Œ.NET Coreï¼ŒGoï¼ŒRust å’Œ PHP ç¼–å†™çš„åº”ç”¨ç¨‹åºç­‰ï¼Œå¹¶å°†åœ¨ä¸‹å‘¨æ”¾å‡ºæŠ€æœ¯é¢„è§ˆç‰ˆæœ¬ã€‚&lt;/p>
&lt;p>æ›´å¤šå†…å®¹æ¨èé˜…è¯» &lt;a href="https://techcrunch.com/2019/04/24/docker-partners-with-arm/">TC æŠ¥é“&lt;/a>&lt;/p>
&lt;hr>
&lt;p>å¯ä»¥é€šè¿‡ä¸‹é¢äºŒç»´ç è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| 2019-04-15~2019-04-21</title><link>https://moelove.info/2019/04/21/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-2019-04-15~2019-04-21/</link><guid isPermaLink="true">https://moelove.info/2019/04/21/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-2019-04-15~2019-04-21/</guid><pubDate>Sun, 21 Apr 2019 21:46:02 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ ã€Œk8sç”Ÿæ€ã€ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="prometheus-v290-æ­£å¼å‘å¸ƒ">Prometheus v2.9.0 æ­£å¼å‘å¸ƒ&lt;/h2>
&lt;p>&lt;a href="https://github.com/prometheus/prometheus">Prometheus&lt;/a> æ˜¯ CNCF æ¯•ä¸šé¡¹ç›®ï¼Œå¯ç”¨äºç›‘æ§ç³»ç»ŸåŠæœåŠ¡çŠ¶æ€ã€‚å®ƒæ•´ä½“æ˜¯ä½¿ç”¨ Pull çš„æ¨¡å¼ï¼Œåœ¨å‘¨æœŸæ—¶é—´å†…é‡‡é›†ç›®æ ‡çš„ metrics ï¼Œå¹¶ä¸”æä¾›äº† PromQL çš„æŸ¥è¯¢è¯­è¨€ï¼Œä»¥ä¾›å¯¹ç›‘æ§æ•°æ®è¿›è¡ŒæŸ¥è¯¢è¿‡æ»¤ç­‰æ“ä½œã€‚å¹¶ä¸”å¯ä»¥é€šè¿‡é…ç½®è§„åˆ™æ¥è§¦å‘æŠ¥è­¦ç­‰ã€‚æˆ‘é¦–æ¬¡æ¥è§¦ Prometheus å¤§æ¦‚æ˜¯åœ¨ 2015 å¹´ 0.15.0 ç‰ˆæœ¬å·¦å³ï¼Œå½“æ—¶ Prometheus è¿˜å¤„äºæ¯”è¾ƒæ—©æœŸçš„é˜¶æ®µï¼Œä¸è¿‡åœ¨è¿›å…¥ CNCF åï¼ŒPrometheus åŸºæœ¬å°±æˆä¸ºäº† K8S ç›‘æ§çš„å®æ–½æ ‡å‡†äº†ï¼Œå¹¶ä¸”å¤šæ•°è½¯ä»¶ä¹Ÿéƒ½å¢åŠ äº†å¯¹ Prometheus metrics çš„æ”¯æŒã€‚&lt;/p>
&lt;p>&lt;a href="https://github.com/prometheus/prometheus/releases/tag/v2.9.0">v2.9.0&lt;/a> çš„ä¸»è¦æ›´æ–°ï¼š&lt;/p>
&lt;ul>
&lt;li>ä» 2.8 å¼€å§‹å¼•å…¥äº†çš„ä» WAL è¯»å–è¿›è¡Œ remote write æœ‰æ—¶å€™ä¼šä¸¢æ•°æ®çš„é—®é¢˜å·²ç»å¾—åˆ°ä¿®å¤ï¼›&lt;/li>
&lt;li>Kubernetes å’Œ OpenStack åœ¨æœåŠ¡å‘ç°æ—¶å€™å¢åŠ äº†æ›´å¤šå…ƒæ•°æ®ï¼›&lt;/li>
&lt;li>Consul ç°åœ¨æ”¯æŒå¤š tagï¼›&lt;/li>
&lt;li>æ·»åŠ äº†ä¸€ä¸ª &lt;code>honor_timestamps&lt;/code> çš„é€‰é¡¹ï¼›&lt;/li>
&lt;li>TLS è¯ä¹¦ä¼šè‡ªåŠ¨ä»ç£ç›˜åŠ è½½ï¼›&lt;/li>
&lt;li>æ—¥å¿—ä¹Ÿå˜çš„æ›´æ˜“è¯»ï¼›&lt;/li>
&lt;/ul>
&lt;p>å…¶ä»–æ›´æ–°è¯·é˜…è¯» &lt;a href="https://github.com/prometheus/prometheus/releases/tag/v2.9.0">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="linkerd-23-æ­£å¼å‘å¸ƒ">Linkerd 2.3 æ­£å¼å‘å¸ƒ&lt;/h2>
&lt;p>Linkerd æ˜¯ä¸€ä¸ª service mesh æ—¨åœ¨æä¾›å¹³å°èŒƒå›´çš„å¯è§‚å¯Ÿæ€§ï¼Œå¯é æ€§å’Œå®‰å…¨æ€§ï¼Œè€Œæ— éœ€ç”¨æˆ·æ›´æ”¹ä»£ç ã€‚åœ¨æœ¬æœˆåˆçš„&lt;a href="https://moelove.info/2019/04/07/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-2019.04.01~2019.04.07/#%E6%8E%A8%E8%8D%90%E9%98%85%E8%AF%BB-linkerd-v2-%E4%BB%8E%E4%BA%A7%E5%93%81%E4%B8%AD%E5%90%B8%E5%8F%96%E7%9A%84%E6%95%99%E8%AE%AD">å‘¨æŠ¥æ¨é€&lt;/a>ä¸­ï¼Œæ¨èäº†ä¸€ç¯‡å…³äº Linkerd v2 ä»äº§å“ä¸­å¸å–çš„æ•™è‚²å’Œç»éªŒçš„æ–‡ç« ï¼ŒLinkerd v2 ä½¿ç”¨ Go å’Œ Rust è¿›è¡Œäº†é‡å†™ï¼Œå¹¶å› æ­¤è·å¾—äº†å·¨å¤§çš„æ”¶ç›Šã€‚&lt;/p>
&lt;p>2.3 çš„ä¸»è¦æ›´æ–°ï¼š&lt;/p>
&lt;ul>
&lt;li>æä¾›äº†ä¸€ç§å…¨æ–°çš„åŸºäº TLS çš„æœåŠ¡éªŒè¯æœºåˆ¶ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¼šåœ¨æœåŠ¡ç½‘æ ¼ä¸­è¿›è¡Œç»è¿‡èº«ä»½è®¤è¯çš„ä¿å¯†é€šä¿¡ï¼›&lt;/li>
&lt;li>æ§åˆ¶å¹³é¢é™„å¸¦è¯ä¹¦é¢å‘æœºæ„ï¼›&lt;/li>
&lt;li>æ•°æ®å¹³é¢ä»£ç†æ¥æ”¶ TLS è¯ä¹¦å¹¶ä¸ K8S çš„ SA è¿›è¡Œç»‘å®šï¼Œ24 å°æ—¶è½®è½¬ä¸€æ¬¡ï¼›&lt;/li>
&lt;/ul>
&lt;p>è¿™é‡Œä»…åˆ—å‡ºäº†æ¯”è¾ƒå…³é”®çš„æ›´æ–°ï¼Œäº‹å®ä¸Šæœ¬æ¬¡çš„æ›´æ–°ç‰¹åˆ«å¤šã€‚2.3 ç‰ˆæœ¬ä¹Ÿæ˜¯ Linkerd åœ¨å®‰å…¨è·¯çº¿ä¸­çš„é‡è¦ä¸€æ­¥ã€‚æ›´å¤šå†…å®¹è¯·é˜…è¯» &lt;a href="https://github.com/linkerd/linkerd2/releases/tag/stable-2.3.0">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="docker-ce-19030-beta2-å‘å¸ƒ">Docker CE 19.03.0-beta2 å‘å¸ƒ&lt;/h2>
&lt;p>è¿™æ˜¯ Docker CE 19.03 ç‰ˆæœ¬æ­£å¼å‘å¸ƒå‰çš„å¸¸è§„å‘å¸ƒï¼Œç°åœ¨çš„ä¸»è¦å˜æ›´åŸºæœ¬éƒ½æ˜¯ä¸ºæ­£å¼å‘å¸ƒå‰åšå‡†å¤‡ï¼Œé›†ä¸­äºä¾èµ–çš„æ›´æ–°å’Œä¸€äº› bugfix ï¼Œè¿™ä¸ªç‰ˆæœ¬æš‚æ—¶ä¸å»ºè®®ä½¿ç”¨/æ›´æ–°ï¼Œç›®å‰åœ¨ SELinux å¼€å¯çš„æœºå™¨å¯èƒ½ä¼šæœ‰ç‚¹å°é—®é¢˜ï¼Œè¿˜åœ¨æµ‹è¯•åŠé—®é¢˜å®šä½ä¸­ã€‚&lt;/p>
&lt;p>æ›´å¤šä¿¡æ¯è¯·é˜…è¯» &lt;a href="https://github.com/docker/docker-ce/releases/tag/v19.03.0-beta2">ReleasesNote&lt;/a>&lt;/p>
&lt;h2 id="æ¨èé˜…è¯»é…ç½®-kubernetes-network-policy">æ¨èé˜…è¯»ï¼šé…ç½® Kubernetes Network Policy&lt;/h2>
&lt;p>éšç€ Kubernetes ç”Ÿæ€çš„å‘å±•ï¼Œå¾ˆå¤šå…¬å¸å’Œå›¢é˜Ÿä¹Ÿæ„ˆå‘çš„æ³¨é‡ Kubernetes å’Œå…¶ä¸­éƒ¨ç½²çš„åº”ç”¨çš„å®‰å…¨æ€§ï¼Œ&lt;a href="https://www.cncf.io/blog/2019/04/19/setting-up-kubernetes-network-policies-a-detailed-guide/">è¿™ç¯‡æ–‡ç«  - Setting up Kubernetes Network Policies â€“ A Detailed Guide&lt;/a> é€šè¿‡ç¤ºä¾‹ä»‹ç»äº†å¦‚ä½•åœ¨ Kubernetes ä¸­é…ç½® Network Policy ï¼Œå¸Œæœ›èƒ½å¯¹ä½ æœ‰æ‰€å¯å‘ã€‚&lt;/p>
&lt;hr>
&lt;p>å¯ä»¥é€šè¿‡ä¸‹é¢äºŒç»´ç è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| 2019.04.08~2019.04.14</title><link>https://moelove.info/2019/04/14/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-2019.04.08~2019.04.14/</link><guid isPermaLink="true">https://moelove.info/2019/04/14/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-2019.04.08~2019.04.14/</guid><pubDate>Sun, 14 Apr 2019 22:53:09 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ ã€Œk8sç”Ÿæ€ã€ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="cri-o-æˆä¸º-cncf-æ‰˜ç®¡é¡¹ç›®">CRI-O æˆä¸º CNCF æ‰˜ç®¡é¡¹ç›®&lt;/h2>
&lt;p>&lt;a href="https://github.com/cri-o/cri-o">CRI-O&lt;/a> æ˜¯åŸºäº OCI çš„ Kubernetes CRI å®ç°ï¼Œæ—¨åœ¨æä¾›ç¬¦åˆ OCI è¿è¡Œæ—¶å’Œ kubelet ä¹‹é—´çš„é›†æˆã€‚ç®€å•æ¥è¯´å°±æ˜¯å®Œå…¨ç¬¦åˆ OCI æ ‡å‡†çš„ CRI å®ç°ã€‚ï¼ˆæ¯”å¦‚ä¹‹å‰ä»‹ç»çš„ runc ä¾¿æ˜¯ OCI æ ‡å‡†çš„å‚è€ƒå®ç°ï¼‰&lt;/p>
&lt;p>åœ¨ 2016 å¹´çš„æ—¶å€™ Kubernetes å°±æ¨å‡ºäº†å®¹å™¨è¿è¡Œæ—¶æ¥å£ï¼ˆCRIï¼‰ï¼Œè¿™ç»™äº† kubelet ä¸€ç§ä½¿ç”¨å„ç§ä¸åŒå®¹å™¨è¿è¡Œæ—¶çš„èƒ½åŠ›ï¼Œç°åœ¨æœ€å¸¸ç”¨çš„å½“ç„¶è¿˜æ˜¯ Dockerï¼Œå½“ç„¶ä¹Ÿæœ‰äººä½¿ç”¨ containerdã€runcã€CRI-O ç­‰å„ç±»è¿è¡Œæ—¶ã€‚&lt;/p>
&lt;p>CRI-O æœ€åˆç”± Red Hat å’Œ Google å¼€å‘ï¼Œç°åœ¨å·²è¾¾åˆ°ç¨³å®šçŠ¶æ€ï¼Œä¸”å·²æœ‰å¤§é‡çš„è´¡çŒ®è€…ï¼Œæœ¬æ¬¡æˆä¸º CNCF æ‰˜ç®¡é¡¹ç›®ï¼Œä¹Ÿç®—æ˜¯ç»™å®¹å™¨è¿è¡Œæ—¶æä¾›ä¸€ä¸ªæ›´å¤§çš„å¯èƒ½ã€‚&lt;/p>
&lt;p>é™„ä¸€å¼ å®˜æ–¹å›¾ï¼š&lt;/p>
&lt;p>&lt;img src="https://www.cncf.io/wp-content/uploads/2019/04/CRIO-768x461.png" alt="CRI-O-https://moelove.info">&lt;/p>
&lt;p>è¯¦ç»†ä¿¡æ¯è¯·é˜…è¯» &lt;a href="https://www.cncf.io/blog/2019/04/08/cncf-to-host-cri-o/">CNCF å®˜æ–¹æ–°é—»&lt;/a>&lt;/p>
&lt;h2 id="helm-å­é¡¹ç›®-chart-testing-å‘å¸ƒ-v230-ç‰ˆæœ¬">Helm å­é¡¹ç›® chart-testing å‘å¸ƒ v2.3.0 ç‰ˆæœ¬&lt;/h2>
&lt;p>&lt;a href="https://github.com/helm/chart-testing">chart-testing&lt;/a> v2.3.0 ç‰ˆæœ¬æ­£å¼å‘å¸ƒï¼Œè¯¥é¡¹ç›®çš„ä¸»è¦ç›®æ ‡æ˜¯ç”¨äº Helm Chart çš„æµ‹è¯•ï¼Œä½¿ç”¨è¯¥é¡¹ç›®å¯æ›´æ–¹ä¾¿çš„æ£€æŸ¥ Chart ä¸­æ˜¯å¦æœ‰é”™è¯¯ï¼Œä»¥åŠå®šä½é”™è¯¯ä½ç½®ç­‰ã€‚&lt;/p>
&lt;p>æœ¬æ¬¡å‘å¸ƒä¸»è¦åœ¨äºè¦†ç›–æ›´å¤šå¼‚å¸¸æƒ…å†µï¼Œè¯¦ç»†å†…å®¹å»ºè®®é˜…è¯» &lt;a href="https://github.com/helm/chart-testing/releases/tag/v2.3.0">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="coredns-v150-ç‰ˆæœ¬å‘å¸ƒ">CoreDNS v1.5.0 ç‰ˆæœ¬å‘å¸ƒ&lt;/h2>
&lt;p>CoreDNS æ˜¯ä¸€ä¸ª CNCF æ¯•ä¸šçš„çµæ´»ä¸”å¿«é€Ÿçš„ DNS server é¡¹ç›®ï¼ŒåŒ…å«äº†ä¼—å¤šæ’ä»¶ã€‚&lt;/p>
&lt;p>1.5.0 çš„ä¸»è¦æ›´æ–°ï¼š&lt;/p>
&lt;ul>
&lt;li>å¢åŠ äº†ä¸¤ä¸ª plugin: &lt;strong>grpc&lt;/strong> å’Œ &lt;strong>ready&lt;/strong>;&lt;/li>
&lt;li>ä½¿ç”¨ grpc æ’ä»¶å¯è½¬å‘ gRPC;&lt;/li>
&lt;li>ä½¿ç”¨ ready æ’ä»¶ï¼Œå¯ä¸ºæ¯ä¸ªåç«¯é…ç½®ä¸€ä¸ª ready æ¢é’ˆï¼Œç±»ä¼¼äº Kubernetes ä¸­çš„ Readiness æ¢é’ˆçš„ä½œç”¨ï¼›&lt;/li>
&lt;/ul>
&lt;p>å…¶ä»–æ›´æ–°è¯·é˜…è¯» &lt;a href="https://coredns.io/2019/04/06/coredns-1.5.0-release/">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="docker-ce-v18095-å‘å¸ƒ">Docker CE v18.09.5 å‘å¸ƒ&lt;/h2>
&lt;p>v18.09.5 çš„ä¸»è¦æ›´æ–°ï¼š&lt;/p>
&lt;ul>
&lt;li>ä¿®å¤äº†ä¸€ä¸ªå½“ &lt;code>systemd-resolve&lt;/code> ä¸”ä½¿ç”¨ä¸»æœºç½‘ç»œï¼ˆnetwork=hostï¼‰æ—¶ï¼Œ&lt;code>resolv.conf&lt;/code> ä½¿ç”¨é”™è¯¯çš„é—®é¢˜ï¼ˆä¹‹å‰éƒ½é»˜è®¤ä½¿ç”¨ &lt;code>/etc/resolv.conf&lt;/code>ï¼‰ï¼›&lt;/li>
&lt;/ul>
&lt;p>å…¶ä»–ä¿®å¤å’Œæ›´æ–°è¯·é˜…è¯» &lt;a href="https://github.com/docker/docker-ce/releases/tag/v18.09.5">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="fluentd-ä»-cncf-æ¯•ä¸š">fluentd ä» CNCF æ¯•ä¸š&lt;/h2>
&lt;p>fluentd æ˜¯ CNCF ä¸­æ¯•ä¸šçš„ç¬¬ 6 ä¸ªé¡¹ç›®ï¼Œåœ¨ Kubernetes ç”Ÿæ€ä¸­ï¼Œfluentd è¢«å¹¿æ³›ç”¨äºæ—¥å¿—é‡‡é›†ï¼Œè€Œä¸”é¡¹ç›®ç»è¿‡ CNCF å­µåŒ–ï¼Œä¹Ÿå‘å±•è¿…é€Ÿã€‚&lt;/p>
&lt;p>è¯¦ç»†ä¿¡æ¯è¯·é˜…è¯» &lt;a href="https://zhuanlan.zhihu.com/p/62156473">æ­å–œ fluentd æ¯•ä¸š&lt;/a>&lt;/p>
&lt;h2 id="dockerhub-å°†å®Œå…¨ç¦ç”¨-v1-api">DockerHub å°†å®Œå…¨ç¦ç”¨ v1 API&lt;/h2>
&lt;p>DockerHub å°†åœ¨ä»Šå¹´ 6 æœˆä»½ç¦æ­¢é€šè¿‡ v1 API è¿›è¡Œ Pull æ“ä½œï¼Œå®é™…ä¸Šæˆ‘ä»¬ç°åœ¨ç”¨åˆ°çš„æ¥å£åŸºæœ¬éƒ½æ˜¯ v2 APIï¼Œè€Œæ—©åœ¨ 2015 å¹´ 11 æœˆ DockerHub å°±å·²ç»ç¦æ­¢äº†é€šè¿‡ v1 API è¿›è¡Œ Push æ“ä½œäº†ã€‚&lt;/p>
&lt;p>å¦‚æœä½ è¿˜åœ¨ä½¿ç”¨ç‰¹åˆ«è€æ—§çš„å®¢æˆ·ç«¯ï¼Œè¯·æ³¨æ„å‡çº§ï¼Œå¦åˆ™ 6 æœˆä¹‹åå°±æ— æ³•æ­£å¸¸é€šè¿‡ DockerHub Pull é•œåƒä½¿ç”¨äº†ã€‚&lt;/p>
&lt;p>è¯¦æƒ…è¯·é˜…è¯» &lt;a href="https://engineering.docker.com/2019/03/registry-v1-api-deprecation/">Registry v1 API Deprecation&lt;/a>&lt;/p>
&lt;hr>
&lt;p>å¯ä»¥é€šè¿‡ä¸‹é¢äºŒç»´ç è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>æ­å–œ Fluentd ä» CNCF æ¯•ä¸š</title><link>https://moelove.info/2019/04/12/%E6%81%AD%E5%96%9C-Fluentd-%E4%BB%8E-CNCF-%E6%AF%95%E4%B8%9A/</link><guid isPermaLink="true">https://moelove.info/2019/04/12/%E6%81%AD%E5%96%9C-Fluentd-%E4%BB%8E-CNCF-%E6%AF%95%E4%B8%9A/</guid><pubDate>Fri, 12 Apr 2019 07:23:14 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ä»Šå¹´æ–°é—»ä¸æ–­ï¼Œå¤šæ•°æ—©æœŸè¿›å…¥ CNCF çš„é¡¹ç›®éƒ½ç›¸ç»§å®£å¸ƒæ¯•ä¸šã€‚&lt;/p>
&lt;/blockquote>
&lt;p>CNCFï¼ˆäº‘åŸç”Ÿè®¡ç®—åŸºé‡‘ä¼šï¼‰åœ¨ç¾å›½æ—¶é—´ 2019 å¹´ 4 æœˆ 11 æ—¥å®£å¸ƒ &lt;a href="https://www.fluentd.org/">fluentd&lt;/a> ä»Šå¤©æ­£å¼æ¯•ä¸šäº†ã€‚&lt;/p>
&lt;p>è¿™æ˜¯ CNCF ä¸­æ¯•ä¸šçš„ç¬¬ 6 ä¸ªé¡¹ç›®ï¼Œä¹‹å‰å·²ç»æ¯•ä¸šçš„é¡¹ç›®ä¸º &lt;a href="https://github.com/kubernetes">Kubernetes&lt;/a>ã€&lt;a href="https://github.com/prometheus">Prometheus&lt;/a>ã€&lt;a href="https://github.com/envoyproxy/envoy">Envoy&lt;/a> ã€&lt;a href="https://github.com/coredns/coredns">CoreDNS&lt;/a> å’Œ &lt;a href="https://github.com/containerd/containerd/">containerd&lt;/a> ã€‚&lt;/p>
&lt;p>fluentd è‡ª 2011 å¹´ç”± Treasure Data å…¬å¸çš„è”åˆåˆ›å§‹äºº Sadayuki â€œSadaâ€ Furuhashi åˆ›å»ºï¼Œä½œä¸ºæ„å»ºç»Ÿä¸€è®°å½•å±‚çš„å¼€æºæ•°æ®æ”¶é›†å™¨ï¼Œç»Ÿä¸€è®°å½•å±‚ç»Ÿä¸€æ”¶é›†é‡‡é›†å’Œæ¶ˆè´¹ï¼Œä»¥ä¾¿æ›´å¥½çš„ä½¿ç”¨å’Œç†è§£æ•°æ®ã€‚åœ¨ 2016 å¹´ 11 æœˆï¼Œfluentd ä¹Ÿæ˜¯ç¬¬ 6 ä¸ªæˆä¸º CNCF æ‰˜ç®¡é¡¹ç›®çš„ã€‚&lt;/p>
&lt;p>fluentd å¯ä»¥ä»å¤šç§æ•°æ®æºé‡‡é›†äº‹ä»¶ï¼Œå¹¶å°†å®ƒå†™å…¥æ–‡ä»¶, RDBMS, NoSQL, IaaS, SaaS, Hadoopç­‰ç­‰å„ç±»çš„ç›®æ ‡åœ°å€ã€‚æˆªè‡³ç›®å‰ï¼Œfluentd åœ¨ GitHub ä¸Šæœ‰ 7629 ä¸ª star ï¼Œ895 ä¸ª forkï¼Œä»¥åŠ 166 ä½è´¡çŒ®è€…ï¼Œè¶…è¿‡ 4k+ commit ã€‚&lt;/p>
&lt;p>åšæ—¥å¿—ç›¸å…³çš„å°ä¼™ä¼´åŸºæœ¬éƒ½ç©è¿‡ ELK ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“åœ¨å¤§è§„æ¨¡ä½¿ç”¨ Logstash æ—¶çš„ç—›è‹¦ï¼ˆè¿˜è®°å¾—è¢« Logstash é…ç½®æ–‡ä»¶æ”¯é…çš„ææƒ§å—ï¼Ÿ 2333ï¼‰ è€Œ fluentd çš„äº‹ä»¶è·¯ç”±æ˜¯é€šè¿‡ tag æ¥åšï¼Œç›¸æ¯” Logstash ä½¿ç”¨ç®¡é“å°†æ‰€æœ‰æ•°æ®è·¯ç”±åˆ°å•ä¸ªæµé‡Œå†é€šè¿‡é…ç½®å°†å®ƒå‘é€åˆ°å¯¹åº”çš„ç›®æ ‡è€Œè¨€è¿™å°†å¤§å¤§ç®€åŒ–é…ç½®çš„å¤æ‚åº¦ã€‚(æ˜¯çš„ï¼Œè¿™é‡Œæ˜¯åæ§½)&lt;/p>
&lt;p>å†ä¸€ä¸ªï¼Œä¾¿æ˜¯éœ€è¦è€ƒè™‘éƒ¨ç½²å’Œæ’ä»¶ç”Ÿæ€ï¼Œé¦–å…ˆæ¥è¯´éƒ¨ç½²ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>fluentd ä½¿ç”¨ C + Ruby ç¼–å†™ï¼ˆRuby å†™èµ·æ¥è›®èˆ’æœçš„ï¼Œæ—©å…ˆå†™è¿‡ä¸€æ®µæ—¶é—´ï¼‰ï¼Œåªè¦æœ‰ Ruby çš„ç¯å¢ƒï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„è¿›è¡Œéƒ¨ç½²ã€‚è€Œå¤§å¤šæ•°çš„ Linux å‘è¡Œç‰ˆæ˜¯é»˜è®¤å¸¦ç€ Ruby ç¯å¢ƒçš„ï¼Œè¿™ä¹Ÿéå¸¸æ–¹ä¾¿ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Logstash ä½¿ç”¨ JRuby ç¼–å†™ï¼ˆJRuby å°±æ˜¯ä½¿ç”¨ Java å®ç°çš„ Ruby è§£é‡Šå™¨ï¼‰ï¼Œéƒ¨ç½²æ—¶éœ€è¦æœ‰ JDK å’Œ JRuby çš„ç¯å¢ƒã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>è¿™é‡Œåªåšé™ˆè¿°ï¼Œä¸å†å±•å¼€ã€‚&lt;/p>
&lt;p>å›åˆ°æ’ä»¶ç”Ÿæ€ä¸Šï¼š&lt;/p>
&lt;p>ä¸¤è€…éƒ½æœ‰ä¸°å¯Œçš„æ’ä»¶ï¼Œå¹¶ä¸”ç¼–å†™æ’ä»¶ä¹Ÿå¾ˆç®€å•ã€‚ä¸è¿‡æ’ä»¶è¿™ç§ä¸œè¥¿ï¼ŒæŒ‰éœ€ä½¿ç”¨ï¼Œæ—¥å¸¸éœ€è¦çš„åŸºæœ¬éƒ½èƒ½æ‰¾çš„åˆ°ã€‚å”¯ä¸€éœ€è¦æ³¨æ„çš„å°±æ˜¯é€‰æ‹©æ’ä»¶æ—¶ï¼Œéœ€è¦ä»”ç»†ç”„åˆ«ã€‚&lt;/p>
&lt;blockquote>
&lt;p>â€œFluentd has earned its place as the industry standard for log collection and shipping, and I am excited to see it as a graduated CNCF project,â€ said Gabe Monroy, Lead Program Manager for Containers, Microsoft Azure. â€œAt Microsoft, we are proud to use Fluentd to power our cloud native logging subsystems and we look forward to working with the growing the open source community around Fluentd.â€&lt;/p>
&lt;/blockquote>
&lt;p>å¼•ç”¨ä¸€æ®µè¯ï¼Œfluentd æ˜¯å¦æˆä¸ºæ•´ä¸ªæ—¥å¿—æ”¶é›†çš„è¡Œä¸šæ ‡å‡†ï¼Œè¿™ä¸ªæˆ‘ä¸ç¡®å®šï¼Œ ä½†åœ¨å®ƒæ‰˜ç®¡è‡³ CNCF åï¼Œåœ¨äº‘åŸç”Ÿé¢†åŸŸå®ƒç¡®å®å‘å±•è¿…é€Ÿï¼Œå¤šæ•°å…¬å¸éƒ½ä¼šé‡‡ç”¨ EFK çš„æ–¹å¼è¿›è¡Œäº‘åŸç”Ÿæ—¶ä»£ä¸‹çš„æ—¥å¿—æ–¹æ¡ˆã€‚&lt;/p>
&lt;p>é™„ä¸€å¼  fluentd çš„å›¾ï¼Œæœ‰ç©ºä¼šå†™ä¸‹ fluentd çš„ä½¿ç”¨å§¿åŠ¿ ï¼ˆflag++ï¼‰&lt;/p>
&lt;p>&lt;img src="https://camo.githubusercontent.com/a3dc75aaf0277efbbbc698a80b4c620f969969bd/68747470733a2f2f646f63732e666c75656e74642e6f72672f696d616765732f666c75656e74642d6172636869746563747572652e706e67" alt="fluentd - https://moelove.info">&lt;/p>
&lt;p>å†æ¬¡æ­å–œ fluentd æ¯•ä¸šã€‚&lt;/p>
&lt;hr>
&lt;p>å¯ä»¥é€šè¿‡ä¸‹é¢äºŒç»´ç è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Container/">Container</category><category domain="https://moelove.info/tags/Docker/">Docker</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| 2019.04.01~2019.04.07</title><link>https://moelove.info/2019/04/07/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-2019.04.01~2019.04.07/</link><guid isPermaLink="true">https://moelove.info/2019/04/07/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-2019.04.01~2019.04.07/</guid><pubDate>Sun, 07 Apr 2019 10:03:13 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ ã€Œk8sç”Ÿæ€ã€ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="kubernetes-client-go-v1100-æ­£å¼å‘å¸ƒ">Kubernetes client-go v11.0.0 æ­£å¼å‘å¸ƒ&lt;/h2>
&lt;p>è¿™æ˜¯æœ€åä¸€ä¸ªä½¿ç”¨ &lt;code>dep&lt;/code> ä½œä¸ºä¾èµ–ç®¡ç†çš„ç‰ˆæœ¬ï¼Œåç»­ç‰ˆæœ¬å°†è½¬å‘ä½¿ç”¨ &lt;code>go modules&lt;/code>.&lt;/p>
&lt;p>Kubernetes ç”Ÿæ€ä¸­çš„ç›¸å…³é¡¹ç›®å¤§å¤šéƒ½å·²è½¬å‘æˆ–æ­£åœ¨è½¬å‘ä½¿ç”¨ &lt;code>go modules&lt;/code> äº†ï¼Œè¿™ä¹Ÿæ˜¯ä¸€ä¸ªæŠ€æœ¯é£å‘ï¼Œç†æ€§é€‰æ‹©ã€‚&lt;/p>
&lt;p>&lt;a href="https://github.com/kubernetes/client-go/releases/tag/v11.0.0">Release&lt;/a>&lt;/p>
&lt;h2 id="containerd-126-æ­£å¼å‘å¸ƒ">containerd 1.2.6 æ­£å¼å‘å¸ƒ&lt;/h2>
&lt;p>è¿™æ˜¯ containerd 1.2 çš„ç¬¬ 6 ä¸ª patch ç‰ˆæœ¬ï¼Œä¸»è¦æ›´æ–°ï¼š&lt;/p>
&lt;ul>
&lt;li>åœ¨é»˜è®¤çš„ seccomp profile ç™½åå•å¢åŠ äº† &lt;code>io_pgetevents&lt;/code> å’Œ &lt;code>statx&lt;/code> è¿™ä¸¤ä¸ªç³»ç»Ÿè°ƒç”¨;&lt;/li>
&lt;li>ä¿®å¤äº†åœ¨ 1.2.5 ä¸­è‡ªå®šä¹‰ cgroup path æ— æ³•å·¥ä½œçš„ bugï¼›&lt;/li>
&lt;li>æ›´æ–° CNI æ’ä»¶åˆ° v0.7.5 ä»¥ä¿®å¤ &lt;a href="https://nvd.nist.gov/vuln/detail/CVE-2019-9946">CVE-2019-9946&lt;/a>;&lt;/li>
&lt;li>æ›´æ–° runc ç‰ˆæœ¬ï¼Œä¿®å¤åœ¨æ—  SELinux ç³»ç»Ÿä¸‹çš„å¤±è´¥æƒ…å†µï¼›&lt;/li>
&lt;/ul>
&lt;p>å½“ç„¶è¿˜æœ‰ä¸€äº›å…¶ä»–çš„æ”¹è¿›å’Œä¿®å¤ï¼Œæ¯”å¦‚ä¿®å¤äº† pod çš„ UTS namespace ç­‰ï¼Œå»ºè®®é˜…è¯» &lt;a href="https://github.com/containerd/containerd/releases/tag/v1.2.6">ReleaseNote&lt;/a>ã€‚&lt;/p>
&lt;h2 id="docker-ce-19030-beta1-ç‰ˆæœ¬å‘å¸ƒ">Docker CE 19.03.0-beta1 ç‰ˆæœ¬å‘å¸ƒ&lt;/h2>
&lt;p>è¿™æ˜¯ Docker CE ä¿®æ”¹å‘å¸ƒå‘¨æœŸåï¼Œç¬¬äºŒä¸ªå‘å¸ƒçš„ç‰ˆæœ¬ï¼Œä¸Šä¸ªç‰ˆæœ¬æ˜¯ Docker CE 18.09 ã€‚ä»å‘å¸ƒå‘¨æœŸæ¥çœ‹ï¼Œç”±åŸå…ˆçš„å­£åº¦å‘å¸ƒæ”¹æˆåŠå¹´å‘å¸ƒï¼Œä¹Ÿæ„å‘³ç€ Docker çš„æ—¥æ¸æˆç†Ÿã€‚&lt;/p>
&lt;p>æ­£å¼ç‰ˆä¼°è®¡ä¼šåœ¨ 5 æœˆå‘å¸ƒï¼Œä» beta ç‰ˆä¸­èƒ½çœ‹åˆ°ä¸€äº›ä¸»è¦æ›´æ–°ï¼š&lt;/p>
&lt;ul>
&lt;li>API æ›´æ–°è‡³ v1.40;&lt;/li>
&lt;li>å…è®¸ä»¥é root ç”¨æˆ·è¿è¡Œ dockerd ï¼ˆRootless modeï¼‰ï¼Œè¿™å°†æ›´æœ‰åˆ©äºå®¹å™¨å®‰å…¨ï¼ˆè¿™ä¹Ÿæ˜¯æˆ‘æœ€æœŸå¾…çš„ä¸€ä¸ªç‰¹æ€§ï¼‰ï¼›&lt;/li>
&lt;li>ç§»é™¤ v1 manifest æ”¯æŒï¼›&lt;/li>
&lt;li>ç§»é™¤ AuFS å­˜å‚¨é©±åŠ¨æ”¯æŒï¼Œä¼šæœ‰æç¤ºä¿¡æ¯ï¼ˆå½“å‰æ˜¯åºŸå¼ƒï¼Œè¿˜æœªå®Œå…¨ç§»é™¤ï¼Œåœ¨ä¸Šä¸ªç‰ˆæœ¬ä¸­ &lt;code>devicemapper&lt;/code> ä¹Ÿå·²è¢«æ ‡è®°ä¸ºåºŸå¼ƒï¼‰;&lt;/li>
&lt;li>å®éªŒæ€§çš„å¯¹ compose å’Œ Kubernetes æä¾›ä¸€äº›é¢å¤–æ”¯æŒï¼Œæ¯”å¦‚ &lt;code>x-pull-secret&lt;/code> å’Œ &lt;code>x-pull-policy&lt;/code>;&lt;/li>
&lt;li>å®éªŒæ€§çš„å¯¹ Windows å’Œ LCOW æä¾›ä¸€äº›æ”¯æŒï¼šæ¯”å¦‚æä¾›å¯¹ cpu å’Œ å†…å­˜çš„é™åˆ¶ï¼›&lt;/li>
&lt;/ul>
&lt;p>é™¤æ­¤ä¹‹å¤–ï¼Œåœ¨ builder å’Œ API æ–¹é¢ä¹Ÿéƒ½æœ‰ä¸€äº›ä¿®å¤å’Œæ”¹è¿›ï¼Œå»ºè®®é˜…è¯» &lt;a href="https://github.com/docker/docker-ce/releases/tag/v19.03.0-beta1">ReleaseNote&lt;/a>ã€‚&lt;/p>
&lt;h2 id="æ¨èé˜…è¯»-linkerd-v2-ä»äº§å“ä¸­å¸å–çš„æ•™è®­">æ¨èé˜…è¯»ï¼š Linkerd v2 ä»äº§å“ä¸­å¸å–çš„æ•™è®­&lt;/h2>
&lt;p>Linkerd v2 ä½¿ç”¨ Go å’Œ Rust è¿›è¡Œäº†é‡å†™ï¼Œè¿™ç¯‡æ–‡ç« æ˜¯åœ¨ Linkerd v2 å‘å¸ƒ 6 ä¸ªæœˆä¹‹åå†™çš„ï¼Œè¯¥å›¢é˜Ÿè®¤ä¸ºä½¿ç”¨ Go å’Œ Rust é‡å†™æ˜¯éå¸¸å€¼å¾—çš„ï¼Œå¹¶ä¸”ä¹Ÿå·²ç»åœ¨ç”Ÿäº§ä¸­å¾—åˆ°äº†éªŒè¯ã€‚&lt;/p>
&lt;p>æ–‡ç« å†…å®¹ä¸é”™ï¼Œæ¨èé˜…è¯»ã€‚æ–‡ç« åœ°å€ &lt;a href="https://www.infoq.com/articles/linkerd-v2-production-adoption">Linkerd v2: How Lessons from Production Adoption Resulted in a Rewrite of the Service Mesh&lt;/a>ã€‚&lt;/p>
&lt;hr>
&lt;p>å¯ä»¥é€šè¿‡ä¸‹é¢äºŒç»´ç è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| 2019.03.25~2019.03.31</title><link>https://moelove.info/2019/03/31/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-2019.03.25~2019.03.31/</link><guid isPermaLink="true">https://moelove.info/2019/03/31/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-2019.03.25~2019.03.31/</guid><pubDate>Sun, 31 Mar 2019 21:52:01 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚æ¬¢è¿è®¢é˜…çŸ¥ä¹ä¸“æ ã€Œk8sç”Ÿæ€ã€ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="kubernetes-114-æ­£å¼å‘å¸ƒ">Kubernetes 1.14 æ­£å¼å‘å¸ƒ&lt;/h2>
&lt;p>1.14 çš„ä¸»è¦æ›´æ–°ï¼š&lt;/p>
&lt;ul>
&lt;li>å¯¹ Windows Node å’Œ container çš„æ”¯æŒè¾¾åˆ°ç”Ÿäº§çº§åˆ«ï¼Œæ”¯æŒ Windows Server 2019ï¼›&lt;/li>
&lt;li>æœ¬åœ°æŒä¹…åŒ–æ•°æ®å·æ­£å¼å¯ç”¨ï¼Œè¿™å¯ä»¥æ–¹ä¾¿ä½¿ç”¨æœ¬åœ° SSD ä¹‹ç±»çš„å­˜å‚¨ï¼Œä½†æ³¨æ„è¿™ä¸ªç‰¹æ€§å®¹é”™æ€§è¾ƒå·®ï¼›&lt;/li>
&lt;li>Pod ä¼˜å…ˆçº§å’ŒæŠ¢å æœºåˆ¶æ­£å¼å¯ç”¨ï¼Œ(å»ºè®®æ…é‡ä½¿ç”¨)ï¼›&lt;/li>
&lt;li>Pod Ready++ (Pod Readiness Gates) è¾¾åˆ°ç¨³å®šï¼Œå¯ä»¥æ›´å¥½çš„åˆ¤æ–­ Pod åŠå…¶éœ€è¦çš„èµ„æºæ˜¯å¦å‡å·²å°±ç»ªï¼›&lt;/li>
&lt;/ul>
&lt;p>å½“ç„¶è¿˜æœ‰å¾ˆå¤šçš„æ”¹è¿›å’Œå¾ˆå¤šè¢«åºŸå¼ƒçš„åŠŸèƒ½ç‰¹æ€§ç­‰ï¼Œå»ºè®®é˜…è¯» &lt;a href="https://github.com/kubernetes/kubernetes/blob/master/CHANGELOG-1.14.md">ReleaseNote&lt;/a>ã€‚&lt;/p>
&lt;h2 id="minikube-100-æ­£å¼å‘å¸ƒ">Minikube 1.0.0 æ­£å¼å‘å¸ƒ&lt;/h2>
&lt;p>Minikube æ˜¯ä¸€ä¸ªç”¨äºæœ¬åœ°æ­å»º Kubernetes ç¯å¢ƒçš„å·¥å…·ï¼Œä½¿ç”¨æ–¹æ³•å¯å‚è€ƒ &lt;a href="https://juejin.im/book/5b9b2dc86fb9a05d0f16c8ac/section/5b9b81735188255c8b6edc28">ä½¿ç”¨ Minikube æ­å»ºæœ¬åœ° Kubernetes ç¯å¢ƒ&lt;/a>ã€‚&lt;/p>
&lt;p>1.0.0 çš„ä¸»è¦æ›´æ–°ï¼š&lt;/p>
&lt;ul>
&lt;li>é»˜è®¤ Kubernetes ç‰ˆæœ¬æ›´æ–°è‡³ 1.14.0;&lt;/li>
&lt;li>æ–°å¢ &lt;code>--image-repository&lt;/code> å‚æ•°ï¼Œæ–¹ä¾¿å›½å†…ç”¨æˆ·ä½¿ç”¨é•œåƒè§£å†³ç½‘ç»œé—®é¢˜ï¼›&lt;/li>
&lt;/ul>
&lt;p>å…¶ä»–ç‰¹æ€§è¯·é˜…è¯» &lt;a href="https://github.com/kubernetes/minikube/blob/v1.0.0/CHANGELOG.md">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="runc-10-rc7-å‘å¸ƒ">runc 1.0-rc7 å‘å¸ƒ&lt;/h2>
&lt;p>&lt;strong>æ³¨æ„ï¼Œä½ç‰ˆæœ¬å†…æ ¸(å°¤å…¶æ˜¯ 3.x)çš„ç³»ç»Ÿï¼Œè¯·ä¸è¦å‡çº§è‡³æ­¤ç‰ˆæœ¬&lt;/strong>&lt;/p>
&lt;p>è¿™ä¸ªç‰ˆæœ¬ä¸»è¦ä¸ºè§£å†³ä¹‹å‰çš„æ¼æ´åŠä¿®æ­£ä¸€äº›è§„èŒƒç­‰ï¼Œç‰ˆæœ¬è¯´æ˜è¯·å‚è€ƒ &lt;a href="https://zhuanlan.zhihu.com/p/60981504">runc 1.0-rc7 å‘å¸ƒä¹‹é™…&lt;/a>ã€‚&lt;/p>
&lt;p>å…¶ä»–ç‰¹æ€§è¯·é˜…è¯» &lt;a href="https://github.com/opencontainers/runc/releases/tag/v1.0.0-rc7">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="brigade-10-æ­£å¼å‘å¸ƒ">Brigade 1.0 æ­£å¼å‘å¸ƒ&lt;/h2>
&lt;p>Brigade æ˜¯ä¸€ä¸ªä½¿ç”¨ JavaScript æ¥ä¸º Kubernetes æ„å»º pipeline çš„å·¥å…·ï¼Œç°åœ¨æ˜¯ CNCF çš„ sandbox é¡¹ç›®ã€‚&lt;/p>
&lt;p>è¯¦ç»†å†…å®¹è¯·é˜…è¯» &lt;a href="https://github.com/brigadecore/brigade/releases/tag/v1.0.0">ReleaseNote&lt;/a>&lt;/p>
&lt;h2 id="kind-021-å‘å¸ƒ">Kind 0.2.1 å‘å¸ƒ&lt;/h2>
&lt;p>Kind æ˜¯ Kubernetes In Docker çš„ç¼©å†™ï¼Œæ˜¯ä¸€æ¬¾ä¾¿äºåœ¨æœ¬åœ°å’Œ CI ç¯å¢ƒä¸­è¿›è¡Œ Kubernetes ç¯å¢ƒæ­å»ºçš„å·¥å…·ï¼Œå…·ä½“ç”¨æ³•è¯·å‚è€ƒ &lt;a href="https://zhuanlan.zhihu.com/p/60464867">ä½¿ç”¨ Kind æ­å»ºä½ çš„æœ¬åœ° Kubernetes é›†ç¾¤&lt;/a>&lt;/p>
&lt;p>0.2.1 æ˜¯ kind çš„é¦–ä¸ª patch ç‰ˆæœ¬ï¼Œä¸»è¦ä¸ºäº†ä¿®å¤ä¸€ä¸ªå¶å‘çš„ panic , å»ºè®®å°½å¿«å‡çº§ã€‚&lt;/p>
&lt;hr>
&lt;p>å¯ä»¥é€šè¿‡ä¸‹é¢äºŒç»´ç è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>runc 1.0-rc7 å‘å¸ƒä¹‹é™…</title><link>https://moelove.info/2019/03/29/runc-1.0-rc7-%E5%8F%91%E5%B8%83%E4%B9%8B%E9%99%85/</link><guid isPermaLink="true">https://moelove.info/2019/03/29/runc-1.0-rc7-%E5%8F%91%E5%B8%83%E4%B9%8B%E9%99%85/</guid><pubDate>Fri, 29 Mar 2019 10:42:25 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;p>åœ¨ 18 å¹´ 11 æœˆåº•æ—¶ï¼Œæˆ‘å†™äº†ä¸€ç¯‡æ–‡ç«  &lt;a href="https://moelove.info/2018/11/23/runc-1.0-rc6-%E5%8F%91%E5%B8%83%E4%B9%8B%E9%99%85/">ã€Šrunc 1.0-rc6 å‘å¸ƒä¹‹é™…ã€‹&lt;/a> ã€‚å¦‚æœä½ è¿˜ä¸äº†è§£ runc æ˜¯ä»€ä¹ˆï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨å®ƒï¼Œè¯·å‚è€ƒæˆ‘é‚£ç¯‡æ–‡ç« ã€‚æœ¬æ–‡ä¸­ï¼Œä¸å†å¯¹å…¶æ¦‚å¿µå’Œç”¨æ³•ç­‰è¿›è¡Œè¯´æ˜ã€‚&lt;/p>
&lt;p>åœ¨ runc 1.0-rc6 å‘å¸ƒä¹‹æ—¶ï¼Œç»™ç‰ˆæœ¬çš„åˆ«åä¸º &lt;strong>&amp;quot;For Real This Time&amp;quot;&lt;/strong>ï¼Œå½“æ—¶æˆ‘ä»¬åŸå®šè®¡åˆ’æ˜¯å‘å¸ƒ 1.0 çš„ï¼Œä½†æ˜¯ä½œä¸ºåŸºç¡€ä¾èµ–è½¯ä»¶ï¼Œæˆ‘ä»¬è®¤ä¸ºå½“æ—¶çš„ç‰ˆæœ¬è¿˜æœ‰å‡ ä¸ªé—®é¢˜ï¼š&lt;/p>
&lt;ul>
&lt;li>ä¸å¤Ÿè§„èŒƒï¼›&lt;/li>
&lt;li>å‘å¸ƒå‘¨æœŸä¸æ˜ç¡®;&lt;/li>
&lt;/ul>
&lt;p>ä¸ºäº†ç»™ç›¸å…³çš„ runtime è¶³å¤Ÿçš„æ—¶é—´è¿›è¡Œä¿®æ­£/å‡çº§ï¼Œä»¥åŠè§„èŒƒç‰ˆæœ¬ç”Ÿå‘½å‘¨æœŸç­‰ï¼Œæœ€ç»ˆå†³å®šäº†å‘å¸ƒ &lt;code>runc 1.0-rc6&lt;/code>ã€‚&lt;/p>
&lt;h2 id="ä¸ºä½•æœ‰-runc-10-rc7-å­˜åœ¨">ä¸ºä½•æœ‰ &lt;code>runc 1.0-rc7&lt;/code> å­˜åœ¨&lt;/h2>
&lt;p>å‰é¢å·²ç»åŸºæœ¬ä»‹ç»äº†ç›¸å…³èƒŒæ™¯ï¼Œå¹¶ä¸”ä¹ŸåŸºæœ¬æ˜ç¡®äº† rc6 å°±æ˜¯åœ¨ 1.0 æ­£å¼å‘å¸ƒä¹‹å‰çš„æœ€åä¸€ä¸ªç‰ˆæœ¬ï¼Œé‚£ rc7 ä¸ºä»€ä¹ˆä¼šå‡ºç°å‘¢ï¼Ÿ&lt;/p>
&lt;h3 id="cve-2019-5736">CVE-2019-5736&lt;/h3>
&lt;p>æˆ‘ä»¬é¦–å…ˆè¦ä»‹ç»ä»Šå¹´ runc çš„ä¸€ä¸ªææƒæ¼æ´ &lt;strong>&lt;a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-5736">&lt;code>CVE-2019-5736&lt;/code>&lt;/a>&lt;/strong> ã€‚&lt;/p>
&lt;p>2019 å¹´ 2 æœˆ 11 æ—¥åœ¨&lt;a href="https://seclists.org/oss-sec/2019/q1/119"> oss-security é‚®ä»¶ç»„&lt;/a>æ­£å¼æ‰¹éœ²è¯¥æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ¶æ„å®¹å™¨è¦†ç›–ä¸»æœºä¸Šçš„ runc æ–‡ä»¶ï¼Œä»è€Œè¾¾åˆ°æ”»å‡»çš„ç›®çš„ï¼›ï¼ˆå…·ä½“çš„æ”»å‡»æ–¹å¼æ­¤å¤„ç•¥è¿‡ï¼‰ï¼Œæ³¨æ„ä¸è¦è½»æ˜“ä½¿ç”¨æ¥æºä¸å¯ä¿¡çš„é•œåƒåˆ›å»ºå®¹å™¨ä¾¿å¯æœ‰æ•ˆé¿å…è¢«æ”»å‡»çš„å¯èƒ½ã€‚&lt;/p>
&lt;p>ç®€å•è¡¥å……ä¸‹å¯èƒ½è¢«æ”»å‡»çš„æ–¹å¼ï¼š&lt;/p>
&lt;ul>
&lt;li>è¿è¡Œæ¶æ„çš„ Docker é•œåƒ&lt;/li>
&lt;li>åœ¨ä¸»æœºä¸Šæ‰§è¡Œ &lt;code>docker exec&lt;/code> è¿›å…¥å®¹å™¨å†…&lt;/li>
&lt;/ul>
&lt;p>å…³äºå®¹å™¨å®‰å…¨æˆ–è€…å®¹å™¨çš„è¿è¡Œæœºåˆ¶ï¼Œå…¶å®æ¶‰åŠçš„ç‚¹å¾ˆå¤šï¼Œæˆ‘åœ¨å»å¹´çš„ä¸€æ¬¡çº¿ä¸Šåˆ†äº« &lt;a href="https://moelove.info/2018/08/05/%E5%9F%BA%E4%BA%8E-GitLab-%E7%9A%84-CI-%E5%AE%9E%E8%B7%B5/#%E8%AF%A6%E8%A7%A3-docker-in-docker">ã€ŠåŸºäº GitLab çš„ CI å®è·µã€‹&lt;/a> æœ‰æåˆ°è¿‡ Linux Security Modulesï¼ˆLSMï¼‰ç­‰ç›¸å…³çš„å†…å®¹ï¼Œå¯¹å®¹å™¨å®‰å…¨æ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥å¯¹ LSM å¤šäº†è§£ä¸‹ã€‚&lt;/p>
&lt;p>ä¸è¿‡æœ¬æ–‡ä¸»è¦çœ‹çš„æ˜¯ runc å¦‚ä½•ä¿®å¤è¯¥æ¼æ´çš„ï¼Œä»¥åŠåç»­äº§ç”Ÿçš„å½±å“ã€‚&lt;/p>
&lt;h3 id="ä¿®å¤æ–¹å¼">ä¿®å¤æ–¹å¼&lt;/h3>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-c" data-lang="c">&lt;span class="c1">// å¯¹ memfd_create ç³»ç»Ÿè°ƒç”¨åšäº†ä¸ªå°è£… çœç•¥éƒ¨åˆ†ä»£ç 
&lt;/span>&lt;span class="c1">&lt;/span>&lt;span class="cp">#if !defined(SYS_memfd_create) &amp;amp;&amp;amp; defined(__NR_memfd_create)
&lt;/span>&lt;span class="cp"># define SYS_memfd_create __NR_memfd_create
&lt;/span>&lt;span class="cp">#endif
&lt;/span>&lt;span class="cp">#ifdef SYS_memfd_create
&lt;/span>&lt;span class="cp"># define HAVE_MEMFD_CREATE
&lt;/span>&lt;span class="cp"># ifndef MFD_CLOEXEC
&lt;/span>&lt;span class="cp"># define MFD_CLOEXEC 0x0001U
&lt;/span>&lt;span class="cp"># define MFD_ALLOW_SEALING 0x0002U
&lt;/span>&lt;span class="cp"># endif
&lt;/span>&lt;span class="cp">&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="nf">memfd_create&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">const&lt;/span> &lt;span class="kt">char&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kt">unsigned&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">flags&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">{&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="n">syscall&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">SYS_memfd_create&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">name&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">flags&lt;/span>&lt;span class="p">);&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="c1">// ä¸€ä¸ªç®€å•çš„åªè¯»ç¼“å­˜åŒº
&lt;/span>&lt;span class="c1">&lt;/span>&lt;span class="k">static&lt;/span> &lt;span class="kt">char&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nf">read_file&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">char&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">size_t&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">length&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">{&lt;/span>
&lt;span class="kt">int&lt;/span> &lt;span class="n">fd&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="kt">char&lt;/span> &lt;span class="n">buf&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">4096&lt;/span>&lt;span class="p">],&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">copy&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">NULL&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="n">length&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="nb">NULL&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="n">fd&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">open&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">O_RDONLY&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">O_CLOEXEC&lt;/span>&lt;span class="p">);&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">fd&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="nb">NULL&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="o">*&lt;/span>&lt;span class="n">length&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="k">for&lt;/span> &lt;span class="p">(;;)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="kt">int&lt;/span> &lt;span class="n">n&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="n">n&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">read&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">fd&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">buf&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="k">sizeof&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">buf&lt;/span>&lt;span class="p">));&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">n&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">goto&lt;/span> &lt;span class="n">error&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">break&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="n">copy&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">must_realloc&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">copy&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="n">length&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">n&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="k">sizeof&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="n">copy&lt;/span>&lt;span class="p">));&lt;/span>
&lt;span class="n">memcpy&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">copy&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">length&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">buf&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">n&lt;/span>&lt;span class="p">);&lt;/span>
&lt;span class="o">*&lt;/span>&lt;span class="n">length&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="n">n&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="n">close&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">fd&lt;/span>&lt;span class="p">);&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="n">copy&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="nl">error&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="n">close&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">fd&lt;/span>&lt;span class="p">);&lt;/span>
&lt;span class="n">free&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">copy&lt;/span>&lt;span class="p">);&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="nb">NULL&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="c1">// å°†å¤åˆ¶åçš„ fd é‡èµ‹å€¼/æ‰§è¡Œ
&lt;/span>&lt;span class="c1">&lt;/span>&lt;span class="k">static&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="nf">clone_binary&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">{&lt;/span>
&lt;span class="kt">int&lt;/span> &lt;span class="n">binfd&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">memfd&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="n">ssize_t&lt;/span> &lt;span class="n">sent&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="cp">#ifdef HAVE_MEMFD_CREATE
&lt;/span>&lt;span class="cp">&lt;/span> &lt;span class="n">memfd&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">memfd_create&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">RUNC_MEMFD_COMMENT&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">MFD_CLOEXEC&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">MFD_ALLOW_SEALING&lt;/span>&lt;span class="p">);&lt;/span>
&lt;span class="cp">#else
&lt;/span>&lt;span class="cp">&lt;/span> &lt;span class="n">memfd&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">open&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;/tmp&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">O_TMPFILE&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">O_EXCL&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">O_RDWR&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">O_CLOEXEC&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mo">0711&lt;/span>&lt;span class="p">);&lt;/span>
&lt;span class="cp">#endif
&lt;/span>&lt;span class="cp">&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">memfd&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">ENOTRECOVERABLE&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="n">binfd&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">open&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;/proc/self/exe&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">O_RDONLY&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">O_CLOEXEC&lt;/span>&lt;span class="p">);&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">binfd&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">goto&lt;/span> &lt;span class="n">error&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="n">sent&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">sendfile&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">memfd&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">binfd&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nb">NULL&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">RUNC_SENDFILE_MAX&lt;/span>&lt;span class="p">);&lt;/span>
&lt;span class="n">close&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">binfd&lt;/span>&lt;span class="p">);&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">sent&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">goto&lt;/span> &lt;span class="n">error&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="cp">#ifdef HAVE_MEMFD_CREATE
&lt;/span>&lt;span class="cp">&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">err&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">fcntl&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">memfd&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">F_ADD_SEALS&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">RUNC_MEMFD_SEALS&lt;/span>&lt;span class="p">);&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">err&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">goto&lt;/span> &lt;span class="n">error&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="cp">#else
&lt;/span>&lt;span class="cp">&lt;/span>
&lt;span class="kt">int&lt;/span> &lt;span class="n">newfd&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="kt">char&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">fdpath&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">NULL&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">asprintf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">fdpath&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;/proc/self/fd/%d&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">memfd&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">goto&lt;/span> &lt;span class="n">error&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="n">newfd&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">open&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">fdpath&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">O_RDONLY&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">O_CLOEXEC&lt;/span>&lt;span class="p">);&lt;/span>
&lt;span class="n">free&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">fdpath&lt;/span>&lt;span class="p">);&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">newfd&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">goto&lt;/span> &lt;span class="n">error&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="n">close&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">memfd&lt;/span>&lt;span class="p">);&lt;/span>
&lt;span class="n">memfd&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">newfd&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="cp">#endif
&lt;/span>&lt;span class="cp">&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="n">memfd&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="nl">error&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="n">close&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">memfd&lt;/span>&lt;span class="p">);&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">EIO&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="kt">int&lt;/span> &lt;span class="nf">ensure_cloned_binary&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">{&lt;/span>
&lt;span class="kt">int&lt;/span> &lt;span class="n">execfd&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="kt">char&lt;/span> &lt;span class="o">**&lt;/span>&lt;span class="n">argv&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">NULL&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">**&lt;/span>&lt;span class="n">envp&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">NULL&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="kt">int&lt;/span> &lt;span class="n">cloned&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">is_self_cloned&lt;/span>&lt;span class="p">();&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">cloned&lt;/span> &lt;span class="o">&amp;gt;&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="o">||&lt;/span> &lt;span class="n">cloned&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">ENOTRECOVERABLE&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="n">cloned&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">fetchve&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">argv&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">envp&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">EINVAL&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="n">execfd&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">clone_binary&lt;/span>&lt;span class="p">();&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">execfd&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">EIO&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="n">fexecve&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">execfd&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">argv&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">envp&lt;/span>&lt;span class="p">);&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">ENOEXEC&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>çœç•¥æ‰äº†éƒ¨åˆ†ä»£ç ï¼Œå®Œæ•´ä»£ç å¯ç›´æ¥å‚è€ƒ &lt;a href="https://github.com/opencontainers/runc">runc ä»£ç ä»“åº“&lt;/a> ã€‚&lt;/p>
&lt;p>æ•´ä¸ªçš„ä¿®å¤é€»è¾‘æˆ‘åœ¨ä¸Šé¢çš„ä»£ç ä¸­åŠ äº†å¤‡æ³¨ï¼Œæ€»ç»“æ¥è®²å…¶å®å°±æ˜¯ï¼š&lt;/p>
&lt;ul>
&lt;li>åˆ›å»ºäº†ä¸€ä¸ªåªå­˜åœ¨äºå†…å­˜ä¸­çš„ memfd ï¼›&lt;/li>
&lt;li>å°†åŸæœ¬çš„ runc æ‹·è´è‡³è¿™ä¸ª memfd ï¼›&lt;/li>
&lt;li>åœ¨è¿›å…¥ namespace å‰ï¼Œé€šè¿‡è¿™ä¸ª memfd é‡æ–°æ‰§è¡Œ runc ; (è¿™æ˜¯ä¸ºäº†ç¡®ä¿ä¹‹åå³ä½¿è¢«æ”»å‡»/æ›¿æ¢ä¹Ÿæ“ä½œçš„è¿˜æ˜¯å†…å­˜ä¸­çš„è¿™ä¸ªåªè¯»çš„ runc)&lt;/li>
&lt;/ul>
&lt;p>ç»è¿‡ä»¥ä¸Šçš„æ“ä½œï¼Œå°±åŸºæœ¬ä¿®å¤äº† CVE-2019-5736 ã€‚&lt;/p>
&lt;h3 id="å½±å“">å½±å“&lt;/h3>
&lt;h4 id="å†…æ ¸ç›¸å…³">å†…æ ¸ç›¸å…³&lt;/h4>
&lt;p>åœ¨ä¸Šé¢è®²å®Œä¿®å¤æ–¹å¼åï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹ä¼šäº§ç”Ÿå“ªäº›å½±å“ã€‚&lt;/p>
&lt;ul>
&lt;li>æ¶‰åŠåˆ°äº†ç³»ç»Ÿè°ƒç”¨ &lt;strong>&lt;code>memfd_create(2)&lt;/code>&lt;/strong> å’Œ &lt;strong>&lt;code>fcntl(2)&lt;/code>&lt;/strong>&lt;/li>
&lt;/ul>
&lt;p>å¢åŠ äº†ç³»ç»Ÿè°ƒç”¨ï¼Œé‚£è‡ªç„¶å°±è¦çœ‹å†…æ ¸æ˜¯å¦æ”¯æŒäº†ã€‚å®é™…ä¸Šï¼Œè¿™äº›å‡½æ•°æ˜¯åœ¨ 2015 å¹´ 2 æœˆï¼ˆè·è¿™æ¬¡ä¿®å¤æ•´æ•´ 4 å¹´ï¼Œä¹ŸæŒºæœ‰è¶£ï¼‰è¢«åŠ å…¥åˆ° Linux 3.17 å†…æ ¸ä¸­çš„ã€‚&lt;/p>
&lt;p>æ¢å¥è¯è¯´å°±æ˜¯ &lt;strong>å‡¡æ˜¯åœ¨æ­¤å†…æ ¸ç‰ˆæœ¬ä¹‹å‰çš„ç³»ç»Ÿï¼Œå‡æ— æ³•æ­£å¸¸ä½¿ç”¨è¯¥åŠŸèƒ½&lt;/strong>ï¼Œå¯¹æˆ‘ä»¬çš„å½±å“å°±æ˜¯ï¼Œ&lt;strong>å¦‚æœä½ åœ¨æ­¤ç‰ˆæœ¬å†…æ ¸ä¹‹å‰çš„æœºå™¨ä¸Šä½¿ç”¨äº†åŒ…å«ä¸Šè¿°ä¿®å¤ä»£ç çš„ runc æˆ–æ„å»ºåœ¨å…¶ä¹‹ä¸Šçš„ containerdã€ Docker ç­‰éƒ½æ— æ³•æ­£å¸¸å·¥ä½œ&lt;/strong> ã€‚&lt;/p>
&lt;p>ä»¥ Docker ä¸¾ä¾‹ï¼šå®‰è£… docker-ce-18.09.2 æˆ– docker-ce-18.06.3 å¯é¿å…å— CVE-2019-5736 å½±å“ï¼Œä½†å¦‚æœå†…æ ¸ç‰ˆæœ¬è¾ƒä½ï¼Œåœ¨è¿è¡Œå®¹å™¨æ—¶å¯èƒ½ä¼šæœ‰å¦‚ä¸‹æƒ…å†µå‡ºç°: ï¼ˆä¸åŒç‰ˆæœ¬/å†…æ ¸å¯èƒ½å‡ºç°å…¶ä»–æƒ…å†µï¼‰&lt;/p>
&lt;pre>&lt;code>[tao@moelove ~]# docker run --rm my-registry/os/debian echo Hello
docker: Error response from daemon: OCI runtime create failed: container_linux.go:344: starting container
process caused &amp;quot;process_linux.go:293: copying bootstrap data to pipe caused \&amp;quot;write init-p: broken pipe\&amp;quot;&amp;quot;: unknown.
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>
&lt;p>&lt;strong>è§£å†³åŠæ³•&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>å‡çº§å†…æ ¸ï¼›è¿™æ˜¯æœ€ç›´æ¥çš„åŠæ³•ï¼Œè€Œä¸”ä½¿ç”¨ä¸€ä¸ªæ–°ç‰ˆæœ¬çš„å†…æ ¸ä¹Ÿèƒ½çœå»å¾ˆå¤šä¸å¿…è¦çš„éº»çƒ¦:)&lt;/li>
&lt;li>rancher æä¾›äº†ä¸€ä¸ª &lt;a href="https://github.com/rancher/runc-cve">runc-cve&lt;/a> çš„ patchï¼Œå¯å…¼å®¹éƒ¨åˆ† 3.x å†…æ ¸çš„ç³»ç»Ÿï¼ˆæˆ‘æ²¡æœ‰æµ‹è¯•è¿‡ï¼‰&lt;/li>
&lt;li>å¦‚æœä½ ä¸å‡çº§ runc/containerd/Docker ç­‰ç‰ˆæœ¬çš„è¯ï¼Œé‚£å»ºè®®ä½  1. å°† runc å¯æ‰§è¡Œç¨‹åºæ”¾åˆ°åªè¯»æ–‡ä»¶ç³»ç»Ÿä¸Šï¼Œå¯é¿å…è¢«è¦†ç›–ï¼›2. å¯åŠ¨å®¹å™¨æ—¶ï¼Œå¯ç”¨ &lt;code>SELinux&lt;/code>; 3. åœ¨å®¹å™¨å†…ä½¿ç”¨ä½æƒé™ç”¨æˆ·æˆ–è€…é‡‡ç”¨æ˜ å°„çš„æ–¹å¼ï¼Œä½†ä¿è¯ç”¨æˆ·å¯¹ä¸»æœºä¸Šçš„ runc ç¨‹åºæ— å†™æƒé™ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>æ³¨æ„&lt;/strong>:&lt;/p>
&lt;p>&lt;code>memfd_create&lt;/code> ç­‰ç›¸å…³ç³»ç»Ÿè°ƒç”¨ï¼Œä¹Ÿè¢«åŠ å…¥åˆ°äº† Debian 3.16 å’Œ Ubuntu 14.04 updates ä¸­ï¼Œå½“ç„¶ä¹Ÿè¢«åå‘ç§»æ¤åˆ°äº† CentOS 7.3 å†…æ ¸ &lt;code>3.10.0-514&lt;/code> ç‰ˆæœ¬ä¹‹åã€‚ (Red Hat ç»™ CentOS 7.x çš„ 3.10 å†…æ ¸ä¸Šåå‘ç§»æ¤äº†å¾ˆå¤šç‰¹æ€§)&lt;/p>
&lt;h4 id="å†…å­˜ç›¸å…³">å†…å­˜ç›¸å…³&lt;/h4>
&lt;p>ä»ä¸Šé¢çš„è¯´æ˜ä¸­ï¼Œä¹Ÿå¾ˆå®¹æ˜“å¯ä»¥çœ‹åˆ°, å†…å­˜çš„ä½¿ç”¨ä¸Šä¼šæœ‰æ‰€å¢åŠ ï¼Œä¸è¿‡ä¹‹åå·²åšäº†ä¿®å¤ã€‚è¿™é‡Œä¸å†è¿›è¡Œå±•å¼€ã€‚&lt;/p>
&lt;h4 id="å…¶ä»–">å…¶ä»–&lt;/h4>
&lt;p>å¶å°”å¯èƒ½è§¦å‘ä¸€äº›å†…æ ¸ bug ä¹‹ç±»çš„ï¼ˆæ€»ä¹‹å»ºè®®å‡çº§ :)&lt;/p>
&lt;h2 id="ç­‰å¾…-rc8-å‘å¸ƒ">ç­‰å¾… rc8 å‘å¸ƒ&lt;/h2>
&lt;p>ä¸Šé¢å·²ç»ä»‹ç»äº† 1.0-rc7 å‡ºç°çš„ä¸»è¦åŸå›  CVE-2019-5736ï¼›å½“ç„¶è¿™ä¸ªç‰ˆæœ¬ä¸­ä¹Ÿæœ‰ä¸€äº›æ–°ç‰¹æ€§å’Œä¸€äº› bugfix ä¸è¿‡ä¸æ˜¯æœ¬æ–‡çš„ä¸»è¦å†…å®¹ï¼Œä¸å†èµ˜è¿°ã€‚&lt;/p>
&lt;p>å€¼å¾—ä¸€æçš„æ˜¯è¿™æ¬¡çš„ç‰ˆæœ¬å‘½åï¼š&lt;code>runc 1.0-rc7 -- &amp;quot;The Eleventh Hour&amp;quot;&lt;/code> åé¢è¿™ä¸ªåˆ«åå…¶å®æ¥è‡ªäºä¸€éƒ¨è‹±å‰§ï¼Œæ„Ÿå…´è¶£ä¹Ÿå¯ä»¥å»çœ‹çœ‹ã€‚&lt;/p>
&lt;p>è‡³äºä¸‹ä¸ªç‰ˆæœ¬æ˜¯ä¸æ˜¯ä¼šæ˜¯ 1.0 æ­£å¼ç‰ˆå‘¢ï¼Ÿç›®å‰æ¥çœ‹åº”è¯¥ä¸æ˜¯ï¼Œæœ‰æå¤§å¯èƒ½ä¼šå‘å¸ƒ &lt;code>runc 1.0-rc8&lt;/code> åšä¸€äº› bugfixï¼Œè®©æˆ‘ä»¬æ‹­ç›®ä»¥å¾…ã€‚&lt;/p>
&lt;hr>
&lt;p>å¯ä»¥é€šè¿‡ä¸‹é¢äºŒç»´ç è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Docker/">Docker</category><category domain="https://moelove.info/tags/Container/">Container</category><category domain="https://moelove.info/tags/runc/">runc</category></item><item><title>ä½¿ç”¨ Kind æ­å»ºä½ çš„æœ¬åœ° Kubernetes é›†ç¾¤</title><link>https://moelove.info/2019/03/25/%E4%BD%BF%E7%94%A8-Kind-%E6%90%AD%E5%BB%BA%E4%BD%A0%E7%9A%84%E6%9C%AC%E5%9C%B0-Kubernetes-%E9%9B%86%E7%BE%A4/</link><guid isPermaLink="true">https://moelove.info/2019/03/25/%E4%BD%BF%E7%94%A8-Kind-%E6%90%AD%E5%BB%BA%E4%BD%A0%E7%9A%84%E6%9C%AC%E5%9C%B0-Kubernetes-%E9%9B%86%E7%BE%A4/</guid><pubDate>Mon, 25 Mar 2019 21:30:24 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>&lt;a href="https://github.com/kubernetes-sigs/kind">Kind&lt;/a> æ˜¯æˆ‘å¾ˆå–œæ¬¢ä¹Ÿä¸€ç›´åœ¨å‚ä¸çš„é¡¹ç›®ï¼Œæˆ‘è®¡åˆ’å°† Kind ç›¸å…³çš„æ–‡ç« å†™æˆä¸€ä¸ªç³»åˆ—ã€‚ï¼ˆflag++ï¼‰ è¿™æ˜¯ç¬¬ä¸€ç¯‡ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="kind-ä»‹ç»">Kind ä»‹ç»&lt;/h2>
&lt;p>Kind æ˜¯ Kubernetes In Docker çš„ç¼©å†™ï¼Œé¡¾åæ€ä¹‰æ˜¯ä½¿ç”¨ Docker å®¹å™¨ä½œä¸º Node å¹¶å°† Kubernetes éƒ¨ç½²è‡³å…¶ä¸­çš„ä¸€ä¸ªå·¥å…·ã€‚&lt;a href="https://kubernetes.io/docs/setup/pick-right-solution/#community-supported-tools">å®˜æ–¹æ–‡æ¡£&lt;/a>ä¸­ä¹ŸæŠŠ Kind ä½œä¸ºä¸€ç§æœ¬åœ°é›†ç¾¤æ­å»ºçš„å·¥å…·è¿›è¡Œæ¨èã€‚&lt;/p>
&lt;h2 id="å®‰è£…">å®‰è£…&lt;/h2>
&lt;h3 id="äºŒè¿›åˆ¶å®‰è£…">äºŒè¿›åˆ¶å®‰è£…&lt;/h3>
&lt;p>Kind ä½¿ç”¨ Golang è¿›è¡Œå¼€å‘ï¼Œåœ¨&lt;a href="https://github.com/kubernetes-sigs/kind/releases">ä»“åº“çš„ Release&lt;/a> é¡µé¢ï¼Œå·²ç»ä¸Šä¼ äº†æ„å»ºå¥½çš„äºŒè¿›åˆ¶ï¼Œæ”¯æŒå¤šç§æ“ä½œç³»ç»Ÿï¼Œå¯ç›´æ¥æŒ‰éœ€ä¸‹è½½è¿›è¡Œä½¿ç”¨ã€‚&lt;/p>
&lt;p>e.g.&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="c1"># ä¸‹è½½æœ€æ–°çš„ 0.2.0 ç‰ˆæœ¬&lt;/span>
wget -O /usr/local/bin/kind https://github.com/kubernetes-sigs/kind/releases/download/0.2.0/kind-linux-amd64 &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> chmod +x /usr/local/bin/kind
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="é€šè¿‡æºç å®‰è£…">é€šè¿‡æºç å®‰è£…&lt;/h3>
&lt;p>å¦‚æœä½ æœ¬åœ°å·²ç»é…ç½®å¥½äº† &lt;a href="https://golang.org/doc/install">Golang çš„å¼€å‘ç¯å¢ƒ&lt;/a>ï¼Œé‚£ä½ å¯ä»¥ç›´æ¥é€šè¿‡æºç è¿›è¡Œå®‰è£…ã€‚&lt;/p>
&lt;p>e.g.&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">go get -u sigs.k8s.io/kind
&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿è¡Œå®Œä¸Šè¿°å‘½ä»¤åï¼Œä¼šå°† &lt;code>kind&lt;/code> çš„å¯æ‰§è¡Œæ–‡ä»¶æ”¾åˆ° &lt;code>$(go env GOPATH)/bin&lt;/code> æ–‡ä»¶å¤¹å†…ï¼Œä½ å¯èƒ½éœ€è¦å°†æ­¤ç›®å½•åŠ å…¥åˆ° &lt;code>$PATH&lt;/code> ä¸­ã€‚&lt;/p>
&lt;p>æˆ–è€…ä¹Ÿå¯ä»¥å…ˆ clone æºä»£ç å†é€šè¿‡ &lt;code>go build&lt;/code> è¿›è¡Œæ„å»ºã€‚&lt;/p>
&lt;h3 id="ä¾èµ–">ä¾èµ–&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>Kind çš„ä¸»è¦åŠŸèƒ½ç›®å‰éœ€è¦æœ‰ Docker ç¯å¢ƒçš„æ”¯æŒï¼Œå¯å‚è€ƒ &lt;a href="https://docs.docker.com/install/">Docker å®˜æ–¹æ–‡æ¡£&lt;/a>è¿›è¡Œå®‰è£…ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¦‚æœéœ€è¦æ“ä½œé›†ç¾¤ï¼Œåˆ™éœ€è¦å®‰è£… &lt;code>kubectl&lt;/code> å‘½ä»¤è¡Œã€‚å®‰è£…æ–¹æ³•å¯å‚è€ƒ&lt;a href="https://kubernetes.io/docs/tasks/tools/install-kubectl/#install-kubectl">å®˜æ–¹æ–‡æ¡£&lt;/a>&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="æ­å»ºå•èŠ‚ç‚¹é›†ç¾¤">æ­å»ºå•èŠ‚ç‚¹é›†ç¾¤&lt;/h2>
&lt;p>ä»¥ä¸‹çš„æ¼”ç¤ºå‡ä½¿ç”¨æœ€æ–°çš„ä»£ç (å³é€šè¿‡æºç å®‰è£…)ã€‚&lt;/p>
&lt;h3 id="åŸºç¡€ç”¨æ³•">åŸºç¡€ç”¨æ³•&lt;/h3>
&lt;p>æ­å»ºå•èŠ‚ç‚¹é›†ç¾¤æ˜¯ Kind æœ€åŸºç¡€çš„åŠŸèƒ½ã€‚&lt;/p>
&lt;p>e.g.&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">master $ kind create cluster --name moelove
Creating cluster &lt;span class="s2">&amp;#34;moelove&amp;#34;&lt;/span> ...
âœ“ Ensuring node image &lt;span class="o">(&lt;/span>kindest/node:v1.13.4&lt;span class="o">)&lt;/span> ğŸ–¼
âœ“ Preparing nodes ğŸ“¦
âœ“ Creating kubeadm config ğŸ“œ
âœ“ Starting control-plane ğŸ•¹ï¸
Cluster creation complete. You can now use the cluster with:
&lt;span class="nb">export&lt;/span> &lt;span class="nv">KUBECONFIG&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="k">$(&lt;/span>kind get kubeconfig-path --name&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;moelove&amp;#34;&lt;/span>&lt;span class="k">)&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
kubectl cluster-info
&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä»¥ä¸Šå‘½ä»¤ä¸­ï¼Œ &lt;code>--name&lt;/code> æ˜¯å¯é€‰å‚æ•°ï¼Œå¦‚ä¸æŒ‡å®šï¼Œé»˜è®¤åˆ›å»ºå‡ºæ¥çš„é›†ç¾¤åå­—ä¸º &lt;code>kind&lt;/code>ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬æ ¹æ®å‘½ä»¤æ‰§è¡Œå®Œçš„è¾“å‡ºè¿›è¡Œæ“ä½œï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">master $ &lt;span class="nb">export&lt;/span> &lt;span class="nv">KUBECONFIG&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="k">$(&lt;/span>kind get kubeconfig-path --name&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;moelove&amp;#34;&lt;/span>&lt;span class="k">)&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
master $ kubectl cluster-info
Kubernetes master is running at https://localhost:34458
KubeDNS is running at https://localhost:34458/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy
To further debug and diagnose cluster problems, use &lt;span class="s1">&amp;#39;kubectl cluster-info dump&amp;#39;&lt;/span>.
master $ kubectl get nodes
NAME STATUS ROLES AGE VERSION
moelove-control-plane Ready master 2m v1.13.4
&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä»¥ä¸Šå‘½ä»¤ä¸­ï¼Œ&lt;code>kind get kubeconfig-path --name=&amp;quot;moelove&amp;quot;&lt;/code> ä¼šè¿”å›è¯¥æŒ‡å®šé›†ç¾¤é…ç½®æ–‡ä»¶æ‰€åœ¨çš„è·¯å¾„ã€‚&lt;/p>
&lt;p>å¯ä»¥çœ‹åˆ°å•èŠ‚ç‚¹çš„ Kubernetes å·²ç»æ­å»ºæˆåŠŸã€‚&lt;/p>
&lt;h3 id="æ³¨æ„">æ³¨æ„&lt;/h3>
&lt;ul>
&lt;li>é»˜è®¤æƒ…å†µä¸‹ï¼ŒKind ä¼šå…ˆä¸‹è½½ &lt;code>kindest/node:v1.13.4&lt;/code> é•œåƒï¼Œè¯¥é•œåƒç›®å‰æ‰˜ç®¡äº Docker Hub ä¸Šï¼Œä¸‹è½½æ—¶é—´å–å†³äºç½‘ç»œçŠ¶å†µã€‚&lt;/li>
&lt;li>Kind å®é™…ä½¿ç”¨ &lt;code>kubeadm&lt;/code> è¿›è¡Œé›†ç¾¤çš„åˆ›å»ºï¼Œå¯¹ &lt;code>kubeadm&lt;/code> æœ‰æ‰€äº†è§£çš„äººéƒ½çŸ¥é“å®ƒé»˜è®¤ä½¿ç”¨çš„é•œåƒåœ¨å›½å†…ä¸‹è½½ä¸åˆ°ï¼Œæ‰€ä»¥éœ€è¦è‡ªå·±è§£å†³ç½‘ç»œé—®é¢˜ã€‚æˆ–è€…å‚è€ƒä¸‹é¢çš„æ–¹å¼:&lt;/li>
&lt;/ul>
&lt;p>Kind åœ¨åˆ›å»ºé›†ç¾¤çš„æ—¶å€™ï¼Œæ”¯æŒé€šè¿‡ &lt;code>--config&lt;/code> çš„å‚æ•°ä¼ é€’é…ç½®æ–‡ä»¶ç»™ Kindï¼Œåœ¨å›½å†…ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨å›½å†…é•œåƒæºçš„æ–¹å¼æ¥åŠ é€Ÿé›†ç¾¤çš„åˆ›å»ºã€‚ï¼ˆè¿™ä¸ªæ–¹æ³•ä¹Ÿé€‚ç”¨äºç›´æ¥é€šè¿‡ kubeadm æ­å»º Kubernetes é›†ç¾¤ï¼‰&lt;/p>
&lt;p>æˆ‘ä»¬å…ˆé€šè¿‡ä»¥ä¸‹å‘½ä»¤åˆ é™¤åˆšæ‰æ­å»ºçš„é›†ç¾¤ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">master $ kind delete cluster --name moelove
Deleting cluster &lt;span class="s2">&amp;#34;moelove&amp;#34;&lt;/span> ...
&lt;span class="nv">$KUBECONFIG&lt;/span> is still &lt;span class="nb">set&lt;/span> to use /root/.kube/kind-config-moelove even though that file has been deleted, remember to &lt;span class="nb">unset&lt;/span> it
&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ¥ä¸‹æ¥ï¼Œå°†ä¸‹é¢çš„é…ç½®å†…å®¹ä¿å­˜è‡³ä¸€ä¸ª YAML æ–‡ä»¶ä¸­ï¼Œæ¯”å¦‚åä¸º &lt;code>kind-config.yaml&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Cluster&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">kind.sigs.k8s.io/v1alpha3&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">kubeadmConfigPatches&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>- &lt;span class="p">|&lt;/span>&lt;span class="sd">
&lt;/span>&lt;span class="sd"> apiVersion: kubeadm.k8s.io/v1beta1
&lt;/span>&lt;span class="sd"> kind: ClusterConfiguration
&lt;/span>&lt;span class="sd"> metadata:
&lt;/span>&lt;span class="sd"> name: config
&lt;/span>&lt;span class="sd"> networking:
&lt;/span>&lt;span class="sd"> serviceSubnet: 10.0.0.0/16
&lt;/span>&lt;span class="sd"> imageRepository: registry.aliyuncs.com/google_containers
&lt;/span>&lt;span class="sd"> nodeRegistration:
&lt;/span>&lt;span class="sd"> kubeletExtraArgs:
&lt;/span>&lt;span class="sd"> pod-infra-container-image: registry.aliyuncs.com/google_containers/pause:3.1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>- &lt;span class="p">|&lt;/span>&lt;span class="sd">
&lt;/span>&lt;span class="sd"> apiVersion: kubeadm.k8s.io/v1beta1
&lt;/span>&lt;span class="sd"> kind: InitConfiguration
&lt;/span>&lt;span class="sd"> metadata:
&lt;/span>&lt;span class="sd"> name: config
&lt;/span>&lt;span class="sd"> networking:
&lt;/span>&lt;span class="sd"> serviceSubnet: 10.0.0.0/16
&lt;/span>&lt;span class="sd"> imageRepository: registry.aliyuncs.com/google_containers&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">nodes&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>- &lt;span class="nt">role&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">control-plane&lt;/span>&lt;span class="w">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æˆ‘ä»¬ä½¿ç”¨è¯¥é…ç½®æ–‡ä»¶æ­å»ºé›†ç¾¤ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">master $ kind create cluster --name moelove --config kind.yaml
Creating cluster &lt;span class="s2">&amp;#34;moelove&amp;#34;&lt;/span> ...
âœ“ Ensuring node image &lt;span class="o">(&lt;/span>kindest/node:v1.13.4&lt;span class="o">)&lt;/span> ğŸ–¼
âœ“ Preparing nodes ğŸ“¦
âœ“ Creating kubeadm config ğŸ“œ
âœ“ Starting control-plane ğŸ•¹ï¸
Cluster creation complete. You can now use the cluster with:
&lt;span class="nb">export&lt;/span> &lt;span class="nv">KUBECONFIG&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="k">$(&lt;/span>kind get kubeconfig-path --name&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;moelove&amp;#34;&lt;/span>&lt;span class="k">)&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
kubectl cluster-info
&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¸Šé¢é€šè¿‡ &lt;code>--config&lt;/code> å°†æˆ‘ä»¬çš„é…ç½®æ–‡ä»¶ä¼ é€’ç»™ Kind ç”¨äºæ­å»ºé›†ç¾¤ï¼Œ&lt;strong>æ¨èå›½å†…ç”¨æˆ·ä½¿ç”¨è¿™ç§æ–¹å¼&lt;/strong>ã€‚&lt;/p>
&lt;h2 id="æ­å»ºé«˜å¯ç”¨é›†ç¾¤">æ­å»ºé«˜å¯ç”¨é›†ç¾¤&lt;/h2>
&lt;p>Kind ä¹Ÿæ”¯æŒæ­å»ºé«˜å¯ç”¨çš„ K8S é›†ç¾¤ï¼Œä¸è¿‡åªèƒ½é€šè¿‡é…ç½®æ–‡ä»¶æ¥å®ç°ã€‚å¯ä»¥ç›´æ¥å°†ä¸‹é¢çš„å†…å®¹ä¿å­˜è‡³æ–‡ä»¶ä¸­ï¼Œå†å°†é…ç½®æ–‡ä»¶ä¼ é€’ç»™ Kind å³å¯ã€‚&lt;/p>
&lt;p>e.g.&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Cluster&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">kind.sigs.k8s.io/v1alpha3&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">kubeadmConfigPatches&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>- &lt;span class="p">|&lt;/span>&lt;span class="sd">
&lt;/span>&lt;span class="sd"> apiVersion: kubeadm.k8s.io/v1beta1
&lt;/span>&lt;span class="sd"> kind: ClusterConfiguration
&lt;/span>&lt;span class="sd"> metadata:
&lt;/span>&lt;span class="sd"> name: config
&lt;/span>&lt;span class="sd"> networking:
&lt;/span>&lt;span class="sd"> serviceSubnet: 10.0.0.0/16
&lt;/span>&lt;span class="sd"> imageRepository: registry.aliyuncs.com/google_containers
&lt;/span>&lt;span class="sd"> nodeRegistration:
&lt;/span>&lt;span class="sd"> kubeletExtraArgs:
&lt;/span>&lt;span class="sd"> pod-infra-container-image: registry.aliyuncs.com/google_containers/pause:3.1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>- &lt;span class="p">|&lt;/span>&lt;span class="sd">
&lt;/span>&lt;span class="sd"> apiVersion: kubeadm.k8s.io/v1beta1
&lt;/span>&lt;span class="sd"> kind: InitConfiguration
&lt;/span>&lt;span class="sd"> metadata:
&lt;/span>&lt;span class="sd"> name: config
&lt;/span>&lt;span class="sd"> networking:
&lt;/span>&lt;span class="sd"> serviceSubnet: 10.0.0.0/16
&lt;/span>&lt;span class="sd"> imageRepository: registry.aliyuncs.com/google_containers&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">nodes&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>- &lt;span class="nt">role&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">control-plane&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>- &lt;span class="nt">role&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">control-plane&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>- &lt;span class="nt">role&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">control-plane&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>- &lt;span class="nt">role&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">worker&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>- &lt;span class="nt">role&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">worker&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>- &lt;span class="nt">role&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">worker&lt;/span>&lt;span class="w">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹çš„å‘½ä»¤æ¥æ­å»ºé«˜å¯ç”¨çš„ Kubernetes é›†ç¾¤ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">master $ kind create cluster --name moelove-ha --config kind-ha-config.yaml
Creating cluster &lt;span class="s2">&amp;#34;moelove-ha&amp;#34;&lt;/span> ...
âœ“ Ensuring node image &lt;span class="o">(&lt;/span>kindest/node:v1.13.4&lt;span class="o">)&lt;/span> ğŸ–¼
âœ“ Preparing nodes ğŸ“¦ğŸ“¦ğŸ“¦ğŸ“¦ğŸ“¦ğŸ“¦ğŸ“¦
âœ“ Starting the external load balancer âš–ï¸
âœ“ Creating kubeadm config ğŸ“œ
âœ“ Starting control-plane ğŸ•¹ï¸
âœ“ Joining more control-plane nodes ğŸ®
âœ“ Joining worker nodes ğŸšœ
Cluster creation complete. You can now use the cluster with:
&lt;span class="nb">export&lt;/span> &lt;span class="nv">KUBECONFIG&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="k">$(&lt;/span>kind get kubeconfig-path --name&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;moelove-ha&amp;#34;&lt;/span>&lt;span class="k">)&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
kubectl cluster-info
master $ &lt;span class="nb">export&lt;/span> &lt;span class="nv">KUBECONFIG&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="k">$(&lt;/span>kind get kubeconfig-path --name&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;moelove-ha&amp;#34;&lt;/span>&lt;span class="k">)&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
master $ kubectl cluster-info
Kubernetes master is running at https://localhost:44019
KubeDNS is running at https://localhost:44019/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy
To further debug and diagnose cluster problems, use &lt;span class="s1">&amp;#39;kubectl cluster-info dump&amp;#39;&lt;/span>.
&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¯ä»¥åšä¸‹ç®€å•çš„éªŒè¯ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">master $ kubectl get nodes
NAME STATUS ROLES AGE VERSION
moelove-ha-control-plane Ready master 3m42s v1.13.4
moelove-ha-control-plane2 Ready master 3m24s v1.13.4
moelove-ha-control-plane3 Ready master 2m13s v1.13.4
moelove-ha-worker Ready &amp;lt;none&amp;gt; 96s v1.13.4
moelove-ha-worker2 Ready &amp;lt;none&amp;gt; 98s v1.13.4
moelove-ha-worker3 Ready &amp;lt;none&amp;gt; 95s v1.13.4
&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¯ä»¥çœ‹åˆ°å·²ç»æˆåŠŸåˆ›å»ºäº†å¤š master çš„ Kubernetes é›†ç¾¤ã€‚&lt;/p>
&lt;h2 id="æ€»ç»“">æ€»ç»“&lt;/h2>
&lt;p>è¿™æ˜¯ä½¿ç”¨ Kind æ­å»ºæœ¬åœ° Kubernetes é›†ç¾¤çš„ç¬¬ä¸€ç¯‡ï¼ŒåŒæ—¶æœ¬ç¯‡çš„å†…å®¹ä¹Ÿæ˜¯&lt;a href="https://juejin.im/book/5b9b2dc86fb9a05d0f16c8ac">ã€ŠKubernetes ä»ä¸Šæ‰‹åˆ°å®è·µã€‹&lt;/a>ç¬¬ 4 èŠ‚å†…å®¹çš„è¡¥å……ï¼Œæ­é…é£Ÿç”¨æ•ˆæœæ›´ä½³ :)&lt;/p>
&lt;hr>
&lt;p>å¯ä»¥é€šè¿‡ä¸‹é¢äºŒç»´ç è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category><category domain="https://moelove.info/tags/Kind/">Kind</category></item><item><title>K8S ç”Ÿæ€å‘¨æŠ¥| 2019.03.18~2019.03.24</title><link>https://moelove.info/2019/03/25/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-2019.03.18~2019.03.24/</link><guid isPermaLink="true">https://moelove.info/2019/03/25/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-2019.03.18~2019.03.24/</guid><pubDate>Mon, 25 Mar 2019 20:49:06 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>æˆ‘å°†ä»æœ¬ç¯‡å¼€å§‹ç»´æŠ¤ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€å†…å®¹ä¸»è¦åŒ…å«æˆ‘æ‰€æ¥è§¦åˆ°çš„ K8S ç”Ÿæ€ç›¸å…³çš„æ¯å‘¨å€¼å¾—æ¨èçš„ä¸€äº›ä¿¡æ¯ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="docker-6-å²å•¦">Docker 6 å²å•¦&lt;/h2>
&lt;p>Docker ä» 2013 å¹´é¦–æ¬¡äº®ç›¸ï¼Œè‡³ä»Šå·² 6 å¹´ä¹‹ä¹…ï¼Œè€Œ Docker ä¹Ÿå·²ä¸€åº¦æˆä¸ºå®¹å™¨æŠ€æœ¯çš„ä»£åè¯ï¼Œå¾ˆåº†å¹¸èƒ½æŠ•èº« Docker ç›¸å…³çš„é¢†åŸŸã€‚&lt;a href="https://blog.docker.com/2019/02/22757/">å®˜æ–¹åšå®¢&lt;/a>&lt;/p>
&lt;h2 id="kind-kubernetes-in-docker-å‘å¸ƒ-020-ç‰ˆæœ¬">Kind (Kubernetes In Docker) å‘å¸ƒ 0.2.0 ç‰ˆæœ¬&lt;/h2>
&lt;p>&lt;a href="https://github.com/kubernetes-sigs/kind/">Kind&lt;/a> æ˜¯ä¸€ä¸ªåˆ©ç”¨å®¹å™¨æŠ€æœ¯å¿«é€Ÿéƒ¨ç½²æœ¬åœ° Kubernetes çš„å·¥å…·ï¼Œä¸»è¦æ˜¯ç”¨äºå¯¹ Kubernetes 1.11+ ç‰ˆæœ¬çš„æµ‹è¯•ã€‚ç°åœ¨å‘å¸ƒçš„ &lt;a href="https://github.com/kubernetes-sigs/kind/releases/tag/0.2.0">0.2.0&lt;/a> ç‰ˆæœ¬æ”¯æŒæœ€æ–° Kubernetes v1.13.4 åŠ Docker 18.06.3 ä¸”é€šè¿‡äº† CNCF çš„ä¸€è‡´æ€§è®¤è¯ã€‚&lt;/p>
&lt;h2 id="rancher-å‘å¸ƒ-k8s-æœ€ä½³å®‰å…¨å®è·µæ–‡ç« ">Rancher å‘å¸ƒ K8S æœ€ä½³å®‰å…¨å®è·µæ–‡ç« &lt;/h2>
&lt;p>Rancher åœ¨ CNCF æœ€è¿‘å‘å¸ƒçš„ &lt;a href="https://www.cncf.io/blog/2019/01/14/9-kubernetes-security-best-practices-everyone-must-follow/">9 ä¸ª Kubernetes æœ€ä½³å®‰å…¨å®è·µ&lt;/a>çš„åŸºç¡€ä¸Šå‘å¸ƒäº†ä¸€ç¯‡&lt;a href="https://rancher.com/blog/2019/2019-01-17-101-more-kubernetes-security-best-practices/?utm_sq=g0sd44tdr3">æ›´å®‰å…¨çš„æœ€ä½³å®è·µ&lt;/a>ï¼Œè¿™ä¸¤ç¯‡æ–‡ç« éƒ½å€¼å¾—ä¸€çœ‹ã€‚&lt;/p>
&lt;hr>
&lt;p>å¯ä»¥é€šè¿‡ä¸‹é¢äºŒç»´ç è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Weekly/">Weekly</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>æ­å–œ containerd æ¯•ä¸š</title><link>https://moelove.info/2019/03/01/%E6%81%AD%E5%96%9C-containerd-%E6%AF%95%E4%B8%9A/</link><guid isPermaLink="true">https://moelove.info/2019/03/01/%E6%81%AD%E5%96%9C-containerd-%E6%AF%95%E4%B8%9A/</guid><pubDate>Fri, 01 Mar 2019 10:18:20 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ä»Šå¹´çš„ç¬¬ä¸€ç¯‡æ–‡ç« æ›´æ–°ï¼Œå¸¦æ¥ä¸€ä¸ªé‡å¤§çš„æ¶ˆæ¯ã€‚&lt;/p>
&lt;/blockquote>
&lt;p>CNCFï¼ˆäº‘åŸç”Ÿè®¡ç®—åŸºé‡‘ä¼šï¼‰åœ¨ç¾å›½æ—¶é—´ 2019 å¹´ 2 æœˆ 28 æ—¥å®£å¸ƒ &lt;a href="https://github.com/containerd/containerd/">containerd&lt;/a> ä»Šå¤©æ­£å¼æ¯•ä¸šäº†ã€‚&lt;/p>
&lt;p>è¿™æ˜¯ CNCF ä¸­æ¯•ä¸šçš„ç¬¬ 5 ä¸ªé¡¹ç›®ï¼Œä¹‹å‰å·²ç»æ¯•ä¸šçš„é¡¹ç›®ä¸º &lt;a href="https://github.com/kubernetes">Kubernetes&lt;/a>ã€&lt;a href="https://github.com/prometheus">Prometheus&lt;/a>ã€&lt;a href="https://github.com/envoyproxy/envoy">Envoy&lt;/a> å’Œ &lt;a href="https://github.com/coredns/coredns">CoreDNS&lt;/a> ã€‚&lt;/p>
&lt;p>containerd 2014 å¹´ä» Docker å­µåŒ–å‡ºæ¥ï¼Œæœ€åˆæ˜¯ä½œä¸º Docker å¼•æ“çš„åº•å±‚ç®¡ç†å™¨ï¼›åœ¨ 2017 å¹´ 3 æœˆè¢« CNCF æ¥å—åï¼Œcontainerd å‡ ä¹æˆä¸ºäº†è¡Œä¸šå®¹å™¨è¿è¡Œå¼•æ“çš„æ ‡å‡†ï¼Œå®ƒä¸“æ³¨äºç®€å•ï¼Œå¥å£®å’Œå¯ç§»æ¤æ€§ï¼Œä»»ä½•äººéƒ½å¯ä»¥ä½¿ç”¨å®ƒæ¥æ„å»ºè‡ªå·±çš„å®¹å™¨å¼•æ“/å¹³å°ã€‚&lt;/p>
&lt;blockquote>
&lt;p>â€œWhen Docker contributed containerd to the community, our goal was to share a robust and extensible runtime that millions of users and tens of thousands of organizations have already standardized on as part of Docker Engine,â€ said Michael Crosby, containerd maintainer and Docker engineer.&lt;/p>
&lt;/blockquote>
&lt;p>æˆªè‡³ç›®å‰ï¼Œcontainerd çš„ GitHub é¡¹ç›®æœ‰ 3533 ä¸ª Star ï¼›221 ä¸ª Watch å’Œ 726 ä¸ª Forkï¼Œè´¡çŒ®è€…è¶…è¿‡äº† 166 ä½ã€‚ç›¸ä¿¡åœ¨ä¹‹åä¹Ÿä¼šå‘å±•çš„æ›´å¥½ã€‚&lt;/p>
&lt;p>ä¸‹é¢é™„ä¸Š containerd çš„æ¶æ„å›¾ï¼Œä»¥åä¼šæ›´æ–°å…³äº containerd ç›¸å…³åŸç†çš„æ–‡ç« ã€‚&lt;/p>
&lt;p>&lt;img src="https://containerd.io/img/architecture.png" alt="containerd architecture - https://moelove.info">&lt;/p>
&lt;p>å†æ¬¡æ­å–œ containerd æ¯•ä¸šã€‚&lt;/p>
&lt;hr>
&lt;p>å¯ä»¥é€šè¿‡ä¸‹é¢äºŒç»´ç è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Container/">Container</category><category domain="https://moelove.info/tags/Docker/">Docker</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>2018 å°å›é¡¾</title><link>https://moelove.info/2018/12/29/2018-%E5%B0%8F%E5%9B%9E%E9%A1%BE/</link><guid isPermaLink="true">https://moelove.info/2018/12/29/2018-%E5%B0%8F%E5%9B%9E%E9%A1%BE/</guid><pubDate>Sat, 29 Dec 2018 20:43:00 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;p>å¹´åº•äº†ï¼Œæƒ¯ä¾‹åšä¸ªå°å›é¡¾ï¼Œå¯¹è¿™ä¸€å¹´åšä¸ªæ€»ç»“ï¼Œä¹Ÿå¯¹ä¸‹ä¸€å¹´å¤§è‡´åšä¸ªè§„åˆ’ã€‚&lt;/p>
&lt;p>ä¸è¿‡ä»Šå„¿ä¸å¾€å¹´ä¸åŒçš„æ˜¯æ˜¨æ™šçªç„¶å‘é«˜çƒ§ï¼Œä»Šå„¿éƒ½æ²¡èƒ½å»ä¸Šç­ï¼Œæ„Ÿè°¢æˆ‘çš„å°å¯çˆ±åœ¨ç…§é¡¾æˆ‘ã€‚è¿™ç¯‡æ–‡ç« ä¹Ÿæ˜¯èººåœ¨åºŠä¸Šç”¨æ‰‹æœºç¼–è¾‘çš„ã€‚&lt;/p>
&lt;p>è¿˜æ˜¯æŒ‰ç…§æƒ¯ä¾‹ä»å·¥ä½œï¼Œç”Ÿæ´»ä¸¤æ–¹é¢æ¥è¯´ã€‚å…ˆèŠèŠå·¥ä½œã€‚&lt;/p>
&lt;h2 id="å·¥ä½œ">å·¥ä½œ&lt;/h2>
&lt;p>ç°åœ¨åœ¨ç½‘æ˜“æœ‰é“è´Ÿè´£ DevOPS å®è·µè½åœ°åŠ k8s å®¹å™¨åŒ–å¹³å°å’Œè‡ªåŠ¨åŒ–å¹³å°çš„è§„åˆ’å»ºè®¾ç­‰ã€‚&lt;/p>
&lt;p>æ€»ä½“æ¥è¯´ï¼Œç°åœ¨çš„å·¥ä½œå¾ˆå¼€å¿ƒï¼Œæ›´èƒ½å‘æŒ¥æˆ‘çš„æ‰€é•¿ï¼Œä¹Ÿé‡åˆ°äº†ä¸é”™çš„å›¢é˜Ÿã€‚&lt;/p>
&lt;p>è¯´åˆ°ç°åœ¨è´Ÿè´£çš„å·¥ä½œï¼Œå¦‚æœå¤§è‡´æœ‰äº›äº†è§£çš„å°±ä¼šçŸ¥é“è¿™ä¸ªè¿‡ç¨‹æ¯”è¾ƒæ¼«é•¿ï¼Œæ¨è¿›èµ·æ¥ä¹Ÿä¼šæœ‰å„ç§é˜»åŠ›ã€‚æ¯•ç«Ÿè¦æ”¹å˜å¾ˆå¤šäººçš„æ€æƒ³å’Œä¹ æƒ¯ï¼Œæˆ‘ä¹Ÿåœ¨å°½é‡è®©è¿™ä¸€è¿‡ç¨‹å˜çš„æ›´åŠ å¹³æ»‘ã€‚&lt;/p>
&lt;p>åŒæ—¶ä¹Ÿåœ¨ push ä¸€äº›ç†å¿µåˆ°è¡Œä¸šå†…ï¼Œåˆ°ç¤¾åŒºä¸­ï¼Œä¸æ–­çš„è¿›è¡Œäº¤æµç¢°æ’æ€»ç»“ã€‚&lt;/p>
&lt;h3 id="ç¤¾åŒºè´¡çŒ®">ç¤¾åŒºè´¡çŒ®&lt;/h3>
&lt;p>ä»Šå¹´ä¸‹åŠå¹´çš„è´¡çŒ®å’Œåˆ†äº«ç›¸æ¯”å»å¹´æ›´å¤šä¸€äº›ã€‚ä¸»è¦çš„åˆ†äº«æœ‰:&lt;/p>
&lt;ul>
&lt;li>GITC - ã€Šäº‘åŸç”Ÿæ—¶ä»£ä¸‹çš„ CI/CD å®è·µã€‹&lt;/li>
&lt;li>PyCon China - ã€ŠåŸºäº Docker çš„ CI/CD å®è·µã€‹&lt;/li>
&lt;li>DockerOne ç¤¾åŒº - ã€ŠåŸºäº GitLab çš„ CI å®è·µã€‹&lt;/li>
&lt;li>Tech Talk Time - ã€ŠDocker å®æˆ˜å’ŒåŸºç¡€æ¶æ„ã€‹&lt;/li>
&lt;/ul>
&lt;p>åˆ†äº«çš„ä¸»é¢˜åŸºæœ¬éƒ½å›´ç»•åœ¨å®¹å™¨åŒ–å’Œ CI/CD æ–¹é¢ï¼Œä½†æ¯æ¬¡åˆ†äº«å†…å®¹å´éƒ½ä¸ä¸€æ ·ã€‚
æ„Ÿè°¢æˆ‘çš„å°å¯çˆ±ï¼Œä¹Ÿæ„Ÿè°¢æ‰€æœ‰æ”¯æŒçš„æœ‹å‹ä»¬ã€‚&lt;/p>
&lt;p>ç¤¾åŒºä¸­ä¸»è¦æ´»è·ƒåœ¨ Docker å’Œ Kubernetes ç”Ÿæ€æ–¹å‘ã€‚ç»´æŠ¤ä¸€äº›å®˜æ–¹é•œåƒï¼Œåšæµ‹è¯•ï¼Œè§£å†³é—®é¢˜ï¼Œæäº¤ä»£ç ä¹‹ç±»çš„ï¼Œæ˜å¹´å¸Œæœ›åšçš„æ›´å¤šã€‚&lt;/p>
&lt;ul>
&lt;li>å¼€äº†ä¸€ä¸ªçŸ¥ä¹ä¸“æ  &lt;a href="https://zhuanlan.zhihu.com/container">ã€k8sç”Ÿæ€ã€&lt;/a> æ˜å¹´ä¼šèŠ±æ›´å¤šæ—¶é—´è¿›è¡Œå»ºè®¾ã€‚&lt;/li>
&lt;li>å†™äº†ä¸€æœ¬æ˜é‡‘å°å†Œ&lt;a href="https://juejin.im/book/5b9b2dc86fb9a05d0f16c8ac">ã€ŠKubernetes ä»ä¸Šæ‰‹åˆ°å®è·µã€‹&lt;/a>ã€‚ å…¶å®è¿™ä¸ªåå­—å¹¶ä¸èƒ½å¾ˆå¥½çš„æ¦‚æ‹¬å°å†Œé‡Œé¢çš„å†…å®¹ï¼Œå…¶ä¸­ä¹Ÿæœ‰æºç åˆ†æä¹‹ç±»çš„ã€‚è¦å†æ¬¡æ„Ÿè°¢å°å¯çˆ±ï¼Œæ„Ÿè°¢ç¼–è¾‘ Linmi ï¼Œæ„Ÿè°¢é©¬è¾¾è€æ¿å’Œä½•ä¸–å‹è€æ¿å†™çš„æ¨èè¯­ã€‚ä¹Ÿæ„Ÿè°¢æ‰€æœ‰äººçš„æ”¯æŒï¼Œå¸Œæœ›è¿™æœ¬å°å†Œèƒ½å¯¹å¤§å®¶æœ‰æ‰€å¸®åŠ©ã€‚&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/k8s-book-info.jpg" alt="">&lt;/p>
&lt;p>å†™å°å†Œçš„è¿‡ç¨‹å…¶å®ä¹Ÿè›®è¾›è‹¦çš„ï¼Œä¸€èˆ¬è¦ä¹ˆæ™šä¸Šå†™ï¼Œå†™åˆ°å‡Œæ™¨ 2~3 ç‚¹ï¼Œè¦ä¹ˆæ—©ä¸Š 5~6 ç‚¹é’Ÿå·¦å³èµ·åºŠï¼Œå†™åˆ°å»ä¸Šç­ã€‚å°¤å…¶è¦æ„Ÿè°¢å°å¯çˆ±ï¼Œç»™äº†æˆ‘å¾ˆå¤šæ”¯æŒã€‚&lt;/p>
&lt;h2 id="ç”Ÿæ´»">ç”Ÿæ´»&lt;/h2>
&lt;p>æ€»çš„æ¥è¯´æ˜¯ä¸°å¯Œå¤šå½©çš„ä¸€å¹´ã€‚å¹´åˆ(å…¶å®æ˜¯17å¹´åº•ï¼Œå»HKæ˜¯ä¸ºäº†è·¨å¹´)å’Œå°å¯çˆ±ä¸€èµ·å»äº†é¦™æ¸¯ï¼Œçœ‹äº†åœºæ¨åƒå¬…çš„æ¼”å”±ä¼šï¼Œå›æ¥åå¥¹å†™äº†å‡ ç¯‡æ¸¸è®°ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;a href="https://mp.weixin.qq.com/s?__biz=MzUxOTMxMDg0Mw==&amp;amp;mid=2247483867&amp;amp;idx=1&amp;amp;sn=c4b84bade488948a76f423bda2a6cac8&amp;amp;chksm=f9fadd4fce8d5459ac87610a04f981d2b8135916946a30826c713a57db1e62c5e532f283b93c&amp;amp;mpshare=1&amp;amp;scene=1&amp;amp;srcid=1229z381NQEOwyIQSiqP5jqa&amp;amp;pass_ticket=sHR2YqA1CHLTyHoIQilemxv7Gu2axSZTRF7czMh1mHUJxlnxo1fn32Olk397Okml#rd">HKæ¸¸è®°ï¼ˆä¸€ï¼‰&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a href="https://mp.weixin.qq.com/s?__biz=MzUxOTMxMDg0Mw==&amp;amp;mid=2247483883&amp;amp;idx=1&amp;amp;sn=9c528890defc11196d5fd36cc5182ac4&amp;amp;chksm=f9fadd7fce8d5469cc76f1b388f5711e978c7a302a8efd96de8a796bd69298c775aa93a7ce0b&amp;amp;mpshare=1&amp;amp;scene=1&amp;amp;srcid=1229R8ZXEwjmUqltORxjHn5F&amp;amp;pass_ticket=sHR2YqA1CHLTyHoIQilemxv7Gu2axSZTRF7czMh1mHUJxlnxo1fn32Olk397Okml#rd">HKæ¸¸è®°ï¼ˆäºŒï¼‰&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a href="https://mp.weixin.qq.com/s?__biz=MzUxOTMxMDg0Mw==&amp;amp;mid=2247483894&amp;amp;idx=1&amp;amp;sn=20fa1e71ee22f7c847425f3347efd1ac&amp;amp;chksm=f9fadd62ce8d54746ab686b37e2ef1a2f1c9138ebcf4ed05fa35aa4b665baadc3b373f6c7fc3&amp;amp;mpshare=1&amp;amp;scene=1&amp;amp;srcid=1229t5d4Ei9aVCPH0hbxABpl&amp;amp;pass_ticket=sHR2YqA1CHLTyHoIQilemxv7Gu2axSZTRF7czMh1mHUJxlnxo1fn32Olk397Okml#rd">HKæ¸¸è®°ï¼ˆä¸‰ï¼‰&lt;/a>&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>æ¥ä¸‹æ¥å»äº†æˆéƒ½ï¼Œé‡åº†ï¼Œæ­å·ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;a href="https://mp.weixin.qq.com/s?__biz=MzUxOTMxMDg0Mw==&amp;amp;mid=2247483977&amp;amp;idx=1&amp;amp;sn=9df9aaf0e7ce2d8216f808738297f194&amp;amp;chksm=f9fadeddce8d57cb16c0301f200269cd908af0bc297e6fb98e400d9336405337c2e4392a1131&amp;amp;mpshare=1&amp;amp;scene=1&amp;amp;srcid=1229x7UrfShAwPRecCX4noft&amp;amp;pass_ticket=sHR2YqA1CHLTyHoIQilemxv7Gu2axSZTRF7czMh1mHUJxlnxo1fn32Olk397Okml#rd">èƒ–çš„è¿™å‡ ä¸ªæœˆä¸æˆéƒ½ã€é‡åº†ã€æ­å·ï¼ˆä¸€ï¼‰&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a href="https://mp.weixin.qq.com/s?__biz=MzUxOTMxMDg0Mw==&amp;amp;mid=2247484013&amp;amp;idx=1&amp;amp;sn=116a65d4848ff3211b40a8f184d55622&amp;amp;chksm=f9fadef9ce8d57efc31900570855c024054c8c431ba4f5d4e3492bad62c022f64184b350a596&amp;amp;mpshare=1&amp;amp;scene=1&amp;amp;srcid=1229K9lDnsp1n1Gz4rvguxk0&amp;amp;pass_ticket=sHR2YqA1CHLTyHoIQilemxv7Gu2axSZTRF7czMh1mHUJxlnxo1fn32Olk397Okml#rd">èƒ–çš„è¿™å‡ ä¸ªæœˆä¸æˆéƒ½ã€é‡åº†ã€æ­å·ï¼ˆäºŒï¼‰&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a href="https://mp.weixin.qq.com/s?__biz=MzUxOTMxMDg0Mw==&amp;amp;mid=2247484100&amp;amp;idx=1&amp;amp;sn=0bd00d6e132f9c50db4141871f2821cd&amp;amp;chksm=f9fade50ce8d57465e5c0400557d90ecb668eaac4a192cd054ef4d6751c55bbecb3decac3932&amp;amp;mpshare=1&amp;amp;scene=1&amp;amp;srcid=1229sM8QeWMcEyq4vn0HFYvK&amp;amp;pass_ticket=sHR2YqA1CHLTyHoIQilemxv7Gu2axSZTRF7czMh1mHUJxlnxo1fn32Olk397Okml#rd">èƒ–çš„è¿™å‡ ä¸ªæœˆä¸æˆéƒ½ã€é‡åº†ã€æ­å·ï¼ˆä¸‰ï¼‰&lt;/a>&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>ä¹‹åæˆ‘ä¿©è¿˜å»äº†è‹å·å’Œå—äº¬ï¼Œè·Ÿä¸‰ä¹é¢åŸºäº†ä¸‹ã€‚&lt;/p>
&lt;p>å†ç„¶åå°å¯çˆ±çš„çˆ¸å¦ˆæ¥åŒ—äº¬ï¼Œæˆ‘ä»¬ä¸€èµ·é€›äº†æ•…å®«ï¼Œç‹åºœäº•ä¹‹ç±»çš„åœ°å„¿ã€‚&lt;/p>
&lt;p>åœ¨è¿™ä¸€å¹´é‡Œå°å¯çˆ±çš„å¨è‰ºè¶Šæ¥è¶Šæ£’ï¼Œç¾æ»‹æ»‹ï¼Œå˜¿å˜¿ã€‚ï¼ˆå½“ç„¶æˆ‘ä¹Ÿè¶Šæ¥è¶Šèƒ–ï¼‰&lt;/p>
&lt;p>æœ€åï¼Œå¸Œæœ›æ˜å¹´èƒ½è¶Šæ¥è¶Šå¥½ï¼Œå®ç°ç»§ç»­åœ¨äº‘åŸç”Ÿé¢†åŸŸçš„æ·±è€•ï¼›èƒ½è·Ÿå°å¯çˆ±è¶Šæ¥è¶Šå¹¸ç¦ã€‚&lt;/p>
&lt;p>PSï¼šä»Šå¹´æ¯”è¾ƒå†·ï¼Œå„ä½æ³¨æ„é˜²å¯’ä¿æš–ï¼Œå…çš„åƒæˆ‘ä¸€æ ·ç”Ÿç—…äº†ï¼Œèº«ä½“å¾ˆé‡è¦ã€‚&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category><category domain="https://moelove.info/tags/Life/">Life</category></item><item><title>ã€ŠKubernetesä»ä¸Šæ‰‹åˆ°å®è·µã€‹æ­£å¼ä¸Šçº¿</title><link>https://moelove.info/2018/12/27/Kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5%E6%AD%A3%E5%BC%8F%E4%B8%8A%E7%BA%BF/</link><guid isPermaLink="true">https://moelove.info/2018/12/27/Kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5%E6%AD%A3%E5%BC%8F%E4%B8%8A%E7%BA%BF/</guid><pubDate>Thu, 27 Dec 2018 11:16:21 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;p>æ—¶é—´é£é€ï¼Œè½¬çœ¼å·²ç»åˆ°äº†åœ£è¯èŠ‚ï¼Œä»Šå¹´åˆè¦ç»“æŸäº†ã€‚æ„Ÿè°¢è¿˜åœ¨å…³æ³¨çš„å°ä¼™ä¼´ï¼Œä»Šå¹´ç¡®å®æ›´æ–°å¾ˆå°‘ï¼Œèƒ½ä¸å–å…³çš„éƒ½æ˜¯çœŸçˆ±...&lt;/p>
&lt;p>ä»Šå¹´å‘ç”Ÿäº†å¾ˆå¤šäº‹æƒ…ï¼Œç•™ç€è¿‡å‡ å¤©å¹´ç»ˆæ€»ç»“çš„æ—¶å€™å†è¯´ã€‚æœ‰å¾ˆå¤§ä¸€éƒ¨åˆ†çš„ä¼‘æ¯æ—¶é—´éƒ½ç”¨æ¥å®Œæˆäº†&lt;a href="https://juejin.im/book/5b9b2dc86fb9a05d0f16c8ac">æˆ‘çš„ç¬¬ä¸€æœ¬æ˜é‡‘å°å†Œ ã€ŠKubernetes ä»ä¸Šæ‰‹åˆ°å®è·µã€‹&lt;/a>&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/k8s-book.jpg" alt="">&lt;/p>
&lt;p>å°å†Œå·²ç»æ­£å¼ä¸Šçº¿ï¼Œç‰¹æ„é€ä¸Šå„ä½å°ä¼™ä¼´ä¸€ä»½ç¤¼ç‰©ï¼Œå°å†Œ 8 æŠ˜ä¼˜æƒ ã€‚ç›´æ¥æ‰«ç  &lt;strong>æˆ–è€…&lt;a href="https://juejin.im/book/5b9b2dc86fb9a05d0f16c8ac?referrer=570eef23ebcb7d0055844663">ç‚¹å‡»æ­¤é“¾æ¥&lt;/a>å³å¯&lt;/strong>ã€‚&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/k8s-book-info.jpg" alt="">&lt;/p>
&lt;p>ä»¥ä¸‹æ˜¯å…³äºå°å†Œçš„ä¸€äº›ä»‹ç»ï¼š&lt;/p>
&lt;p>éšç€å®¹å™¨åŒ–åŠå¾®æœåŠ¡ç­‰æ¦‚å¿µçš„æ™®åŠï¼Œå„ä¸ªå…¬å¸éƒ½åœ¨å›´ç»•ç€å¦‚ä½•æ‰“é€ ç”Ÿäº§ç¯å¢ƒå¯ç”¨çš„ï¼Œé«˜æ•ˆçš„å®¹å™¨è°ƒåº¦å¹³å°ï¼Œåº”ç”¨å¿«é€Ÿéƒ¨ç½²ï¼Œæ‰©å®¹ç­‰å¹³å°è¿›è¡Œæ¢ç´¢ã€‚Kubernetes æ˜¯ Google åœ¨ 2014 å¹´åŸºäºå…¶å¤šå¹´åœ¨ Borg ç³»ç»Ÿå®è·µæ€»ç»“å‡ºçš„ç»éªŒè€Œå¼€æºå‡ºçš„ä¸€å¥—æ ‡å‡†åŒ–ï¼Œå¯æ‰©å±•çš„ç³»ç»Ÿã€‚&lt;/p>
&lt;p>è€Œå‘å±•è‡³ç°åœ¨ï¼ˆ2018å¹´ï¼‰Kubernetes å·²ç»åŸºæœ¬æˆä¸ºäº†å®¹å™¨ç¼–æ’é¢†åŸŸäº‹å®ä¸Šçš„æ ‡å‡†ï¼Œå¹¶ä¸”å¤§é‡çš„å…¬å¸éƒ½å·²åœ¨ç”Ÿäº§ä¸­ä½¿ç”¨ï¼Œæ— è®ºæ˜¯å›½å¤–çš„ Googleï¼Œ Amazon, GitHub ç­‰ï¼Œè¿˜æ˜¯å›½å†…çš„é˜¿é‡Œï¼Œè…¾è®¯ï¼Œäº¬ä¸œï¼Œæ»´æ»´åŠå…¶ä»–ä¸­å°å…¬å¸éƒ½åœ¨è¿›è¡Œç€å¤§é‡çš„æ¢ç´¢åŠå®è·µã€‚&lt;/p>
&lt;p>ä¹‹å‰åœ¨å®¹å™¨åŒ–å°šæœªå¤§é‡æ¨è¿›çš„æ—¶å€™ï¼Œå¼€å‘å·¥ç¨‹å¸ˆåªéœ€è¦å…³æ³¨è‡ªå·±ä¸šåŠ¡ä»£ç çš„å®ç°ï¼Œè€Œè¿ç»´å·¥ç¨‹å¸ˆåœ¨åå¤çš„ä¸ºéƒ¨ç½²ï¼Œæ‰©å®¹æ‰€éœ€çš„ç¯å¢ƒè€Œè´¹æ—¶è´¹åŠ›ã€‚&lt;/p>
&lt;p>ä¸ºäº†è§£å†³ç¯å¢ƒä¸€è‡´æ€§çš„é—®é¢˜ï¼Œä¹Ÿä¸ºäº†èƒ½å¤Ÿæé«˜èµ„æºçš„åˆ©ç”¨ç‡ï¼Œå®¹å™¨åŒ–å¼€å§‹é€æ­¥æ¨è¿›ï¼Œå¼€å‘å·¥ç¨‹å¸ˆçš„äº¤ä»˜ç”±åŸå…ˆçš„äº¤ä»˜ä»£ç å˜æˆäº†äº¤ä»˜é•œåƒï¼Œè¿ç»´å·¥ç¨‹å¸ˆå¯ä»¥å°†ç²¾åŠ›é›†ä¸­äºä¿éšœæœåŠ¡çš„å¯é«˜ç”¨ä¸Šã€‚&lt;/p>
&lt;p>ä½†ä¸ºäº†èƒ½å¤Ÿå¿«é€Ÿçš„å‘ç‰ˆéªŒè¯åŠŸèƒ½ï¼Œä¸å†å—å•ä½“åŒ–æ¶æ„çš„æ‹–ç´¯ï¼Œå¾®æœåŠ¡çš„æ¦‚å¿µä¹Ÿåœ¨å®è·µä¸­é€æ­¥æ¨è¿›ï¼Œä»åŸå…ˆçš„å•ä½“é›†ä¸­å¼çš„æœåŠ¡ï¼Œæ‹†åˆ†ä¸ºå¤šä¸ªæ¾è€¦åˆçš„å¾®æœåŠ¡ã€‚åˆ°äº†è¿™æ—¶ï¼Œå¾®æœåŠ¡ + å®¹å™¨åŒ–å·²ç»å¤§åŠ¿æ‰€è¶‹ï¼Œç”Ÿäº§ä¸­è¦å¤§é‡ä½¿ç”¨ï¼Œåˆ™å®¹å™¨ç¼–æ’å˜çš„æ„ˆå‘é‡è¦ã€‚Kubernetes åœ¨å®¹å™¨ç¼–æ’é¢†åŸŸç›®å‰å·²æˆä¸ºäº‹å®ä¸Šçš„æ ‡å‡†ï¼Œå¤§é‡å…¬å¸å‡å·²åœ¨ç”Ÿäº§ä¸­æ¨è¿›ï¼Œæ­¤æ—¶ï¼Œæ— è®ºæ˜¯å¼€å‘å·¥ç¨‹å¸ˆè¿˜æ˜¯è¿ç»´å·¥ç¨‹å¸ˆï¼Œçš†éœ€è¦äº†è§£å¹¶æŒæ¡ Kubernetes çš„åŸºç¡€æŠ€èƒ½ï¼Œæ‰ä¸è‡³äºä¸¢å¤±è‡ªå·±çš„ç«äº‰åŠ›ã€‚&lt;/p>
&lt;p>Kubernetes æ‰€æ¶‰åŠçš„çŸ¥è¯†ç‚¹å¾ˆå¤š, å¹¶ä¸”ç‰ˆæœ¬è¿­ä»£ä¹Ÿå¾ˆå¿«ï¼Œæœ¬å°å†Œå°†é›†ä¸­äº Kubernetes çš„åŸºç¡€æŠ€èƒ½ï¼Œä»¥æœ€å¸¸è§ Case å…¥æ‰‹ï¼Œå¸®åŠ©å¤§å®¶æ›´å¿«çš„æŒæ¡ç›¸å…³çŸ¥è¯†å¹¶å°†å…¶ç”¨äºç”Ÿäº§å®è·µä¸­ã€‚åŒæ—¶åœ¨æ­¤è¿‡ç¨‹ä¸­ï¼Œä¹Ÿä¼šæ·±å…¥è‡³ Kubernetes å¿…è¦çš„åŸç†ä¸­ï¼ŒåŒæ—¶ä¹Ÿä¼šæä¾›ç›¸å…³æ¶‰åŠåˆ°çš„ Docker åŠ Linux å†…æ ¸çŸ¥è¯†çš„è¡¥å……ï¼Œä»¥ä¾¿è®©å¤§å®¶ä¸ä»…çŸ¥å…¶ç„¶ï¼Œè€Œä¸”çŸ¥å…¶æ‰€ä»¥ç„¶ã€‚&lt;/p>
&lt;h2 id="ä½ ä¼šå­¦åˆ°ä»€ä¹ˆ">ä½ ä¼šå­¦åˆ°ä»€ä¹ˆï¼Ÿ&lt;/h2>
&lt;ul>
&lt;li>Kubernetes åŸºç¡€æ¶æ„&lt;/li>
&lt;li>Kubernetes çš„åŸºç¡€æŠ€èƒ½, è¦†ç›–å¸¸è§ Case&lt;/li>
&lt;li>ä»é›¶æ­å»º Kubernetes é›†ç¾¤&lt;/li>
&lt;li>ä¸ Kubernetes ç›¸å…³çš„ Docker å’Œ Linux å†…æ ¸çŸ¥è¯†è¡¥å……&lt;/li>
&lt;li>æ·±å…¥ Kubernetes ç»„ä»¶çš„åŸç†å’Œæºç è§£æ&lt;/li>
&lt;li>äº†è§£ Kubernetes è¿›é˜¶ç›¸å…³çŸ¥è¯†ä½“ç³»&lt;/li>
&lt;/ul>
&lt;h2 id="é€‚å®œäººç¾¤">é€‚å®œäººç¾¤&lt;/h2>
&lt;ul>
&lt;li>äº†è§£ Dockerï¼Œå¸Œæœ›èƒ½è¿›å…¥ K8S é¢†åŸŸçš„å„é¢†åŸŸå·¥ç¨‹å¸ˆï¼›&lt;/li>
&lt;li>æ­£åœ¨æˆ–å³å°†åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ K8S çš„åç«¯å·¥ç¨‹å¸ˆï¼›&lt;/li>
&lt;li>éœ€è¦ç»´æŠ¤æˆ–åœ¨å…¬å¸è½åœ° K8S çš„è¿ç»´å·¥ç¨‹å¸ˆï¼›&lt;/li>
&lt;li>æƒ³è¦èµ°åœ¨æŠ€æœ¯å‰æ²¿çš„å‰ç«¯/åç«¯/è¿ç»´å·¥ç¨‹å¸ˆï¼›&lt;/li>
&lt;li>å‡†å¤‡æŸ¥ç¼ºè¡¥æ¼çš„å®¹å™¨ç›¸å…³å¼€å‘å·¥ç¨‹å¸ˆï¼›&lt;/li>
&lt;/ul></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Container/">Container</category><category domain="https://moelove.info/tags/Docker/">Docker</category><category domain="https://moelove.info/tags/Kubernetes/">Kubernetes</category></item><item><title>runc 1.0-rc6 å‘å¸ƒä¹‹é™…</title><link>https://moelove.info/2018/11/23/runc-1.0-rc6-%E5%8F%91%E5%B8%83%E4%B9%8B%E9%99%85/</link><guid isPermaLink="true">https://moelove.info/2018/11/23/runc-1.0-rc6-%E5%8F%91%E5%B8%83%E4%B9%8B%E9%99%85/</guid><pubDate>Fri, 23 Nov 2018 04:28:20 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;p>å¦‚æœä½ åœ¨ç”¨ &lt;a href="http://docker.com">Docker&lt;/a> æˆ–è€… &lt;a href="https://kubernetes.io">Kubernetes&lt;/a> æƒ³å¿…ä½ å¯¹ &lt;strong>å®¹å™¨è¿è¡Œæ—¶&lt;/strong> è¿™ä¸ªæ¦‚å¿µåº”è¯¥ä¸ä¼šå¤ªé™Œç”Ÿã€‚&lt;/p>
&lt;p>åœ¨ &lt;code>Docker&lt;/code> ä¸­ï¼Œå½“ä½ ä½¿ç”¨ &lt;code>docker info&lt;/code> å³å¯æŸ¥çœ‹å½“å‰æ‰€ä½¿ç”¨çš„ runtimeã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">âœ ~ docker info
...
Server Version: 18.06.1-ce
Storage Driver: overlay2
Backing Filesystem: extfs
Supports d_type: &lt;span class="nb">true&lt;/span>
Native Overlay Diff: &lt;span class="nb">true&lt;/span>
Logging Driver: json-file
Cgroup Driver: cgroupfs
...
Swarm: inactive
Runtimes: nvidia runc
Default Runtime: runc
Init Binary: docker-init
containerd version: 468a545b9edcd5932818eb9de8e72413e616e86e
runc version: 69663f0bd4b60df09991c08812a60108003fa340
init version: fec3683
Security Options:
seccomp
Profile: default
...
&lt;/code>&lt;/pre>&lt;/div>&lt;p>åŒæ—¶ï¼Œä½ è¿˜å¯ä»¥è‡ªå·±åœ¨ &lt;code>/etc/docker/daemon.json&lt;/code> ä¸­å¢åŠ æ”¯æŒçš„ runtime ï¼Œ ä»¥åŠåœ¨ &lt;code>docker run&lt;/code> çš„æ—¶å€™ï¼Œé€šè¿‡ &lt;code>--runtime&lt;/code> å‚æ•°é…ç½®æ‰€ä½¿ç”¨çš„ runtime ã€‚&lt;/p>
&lt;h2 id="ä»€ä¹ˆæ˜¯-runc">ä»€ä¹ˆæ˜¯ &lt;code>runc&lt;/code>&lt;/h2>
&lt;p>ç®€å•æ¥è¯´ï¼Œå®ƒæ˜¯ &lt;code>OCI&lt;/code> æ ‡å‡†çš„ä¸€ç§å®ç°ã€‚ &lt;code>OCI&lt;/code> æ ‡å‡†åŒ…å« &lt;strong>è¿è¡Œæ—¶æ ‡å‡†&lt;/strong> å’Œ &lt;strong>é•œåƒæ ‡å‡†&lt;/strong> ä¸¤ä¸ªéƒ¨åˆ†ï¼Œè€Œ &lt;code>OCI&lt;/code> è¿™ä¸ªç»„ç»‡åˆ™æ˜¯ç”± Docker, CoreOS å’Œå…¶ä»–çš„ä¸€äº›å…¬å¸å…±åŒå‘èµ·åˆ›å»ºçš„ï¼Œè‡´åŠ›äºå°†å®¹å™¨è¿è¡Œæ—¶å’Œæ ¼å¼æ ‡å‡†åŒ–ã€‚&lt;/p>
&lt;p>å³ï¼šå‡¡æ˜¯éµå®ˆæ­¤æ ‡å‡†çš„å®ç°ï¼Œæ— è®ºæ˜¯ &lt;code>Docker&lt;/code> è¿˜æ˜¯ &lt;code>rkt&lt;/code> æˆ–è€…å…¶ä»–çš„è¿è¡Œæ—¶å®ç°ï¼Œå‡å¯ä»¥é€šè¿‡æ ‡å‡†çš„é•œåƒå¯åŠ¨å®¹å™¨ã€‚&lt;/p>
&lt;p>&lt;code>runc&lt;/code> åˆ™æ˜¯åœ¨ &lt;code>OCI&lt;/code> æˆç«‹åï¼Œ&lt;code>Docker&lt;/code> å°†å…¶å®¹å™¨è¿è¡Œæ—¶ &lt;code>libcontainer&lt;/code> è´¡çŒ®å‡ºæ¥åï¼Œå¹¶åŠ ä»¥æ”¹é€ è€Œæˆçš„ã€‚è€Œ &lt;code>libcontainer&lt;/code> ä¹Ÿæ˜¯åœ¨ &lt;code>Docker&lt;/code> 0.9 ç‰ˆæœ¬å¼€å§‹åŠ å…¥ï¼Œæˆ‘ä¹Ÿæ˜¯ä»è¿™ä¸ªç‰ˆæœ¬å¼€å§‹ä½¿ç”¨å®ƒã€‚&lt;/p>
&lt;p>å½“ç„¶ &lt;code>libcontainer&lt;/code> å‡ºç°çš„æœ¬æ„ä¸ä»…æ˜¯æ›¿æ¢å½“æ—¶çš„ &lt;code>LXC&lt;/code> ä¾èµ–ï¼ŒåŒæ—¶ä¹Ÿå¸Œæœ›èƒ½ä»¥æ­¤ä½œä¸ºè§„èŒƒï¼ˆè®©å…¶ä»–çš„é¡¹ç›®ä½¿ç”¨ï¼‰æœ€ç»ˆï¼Œç›®æ ‡è¾¾æˆã€‚&lt;/p>
&lt;h2 id="runc-å¦‚ä½•ä½¿ç”¨">&lt;code>runc&lt;/code> å¦‚ä½•ä½¿ç”¨&lt;/h2>
&lt;p>&lt;code>runc&lt;/code> çš„ä½¿ç”¨æœ¬ä¸æ˜¯æœ¬ç¯‡çš„é‡ç‚¹ï¼Œç¨å¾®å¸¦è¿‡ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">âœ ~ docker &lt;span class="nb">export&lt;/span> -o debian.tar &lt;span class="sb">`&lt;/span>docker create debian&lt;span class="sb">`&lt;/span>
âœ ~ ls
debian.tar
âœ ~ tar -C rootfs -xf debian.tar
âœ ~ ls
debian.tar rootfs
âœ ~ tree -L &lt;span class="m">1&lt;/span> -a rootfs
rootfs
â”œâ”€â”€ bin
â”œâ”€â”€ boot
â”œâ”€â”€ dev
â”œâ”€â”€ .dockerenv
â”œâ”€â”€ etc
â”œâ”€â”€ home
â”œâ”€â”€ lib
â”œâ”€â”€ lib64
â”œâ”€â”€ media
â”œâ”€â”€ mnt
â”œâ”€â”€ opt
â”œâ”€â”€ proc
â”œâ”€â”€ root
â”œâ”€â”€ run
â”œâ”€â”€ sbin
â”œâ”€â”€ srv
â”œâ”€â”€ sys
â”œâ”€â”€ tmp
â”œâ”€â”€ usr
â””â”€â”€ var
&lt;span class="m">19&lt;/span> directories, &lt;span class="m">1&lt;/span> file
&lt;/code>&lt;/pre>&lt;/div>&lt;p>é€šè¿‡ä»¥ä¸Šæ“ä½œï¼Œå¾—åˆ°äº†è¿è¡Œä¸€ä¸ªå®¹å™¨æ‰€å¿…é¡»çš„ &lt;code>rootfs&lt;/code>ï¼Œå½“ç„¶ï¼Œä¸Šé¢çœ‹åˆ°æˆ‘æ˜¯é€šè¿‡ &lt;code>docker&lt;/code> æ¥è·å¾—è¿™ä¸ªæ–‡ä»¶çš„ï¼Œä½†å…¶å®è¿™åªæ˜¯ä¸ºäº†æ–¹ä¾¿ç½¢äº†ï¼Œ&lt;code>docker&lt;/code> å¹¶ä¸æ˜¯å¿…é¡»çš„ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">âœ ~ runc spec
âœ ~ ls
config.json debian.tar rootfs
&lt;/code>&lt;/pre>&lt;/div>&lt;p>é€šè¿‡ä¸Šé¢çš„æ“ä½œï¼Œä¼šå¾—åˆ°ä¸€ä¸ªåŸºæœ¬çš„ &lt;code>config.json&lt;/code> çš„é…ç½®æ–‡ä»¶ï¼Œè¿™é‡Œé¢åŒ…å«ç€è¿è¡Œä¸€ä¸ªå®¹å™¨æ‰€éœ€è¦çš„ä¸€äº›é…ç½®ã€‚å…¶ä¸­ä¼šåŒ…å«ç€ä¸€äº›ä¾‹å¦‚ï¼š&lt;/p>
&lt;pre>&lt;code>&amp;quot;ociVersion&amp;quot;: &amp;quot;1.0.1-dev&amp;quot;
&lt;/code>&lt;/pre>&lt;p>è¿™ç§ç”¨äºæ ‡è¯†è§„èŒƒç‰ˆæœ¬å·çš„ä¿¡æ¯ã€‚&lt;/p>
&lt;p>æ¥ä¸‹æ¥ç¨å¾®å¯¹ &lt;code>config.json&lt;/code> æ–‡ä»¶è¿›è¡ŒæŸ¥çœ‹ï¼Œä¾¿å¯ä»¥çœ‹åˆ°æœªé€šè¿‡ &lt;code>user&lt;/code> Namespace è¿›è¡Œéš”ç¦»ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä»¥ &lt;code>root&lt;/code> æƒé™è¿è¡Œæˆ‘ä»¬çš„å®¹å™¨ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">âœ ~ sudo runc run debian
&lt;span class="c1"># ls &lt;/span>
bin boot dev etc home lib lib64 media mnt opt proc root run sbin srv sys tmp usr var
&lt;span class="c1"># hostname &lt;/span>
runc
&lt;span class="c1"># cat /etc/os-release&lt;/span>
&lt;span class="nv">PRETTY_NAME&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;Debian GNU/Linux 9 (stretch)&amp;#34;&lt;/span>
&lt;span class="nv">NAME&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;Debian GNU/Linux&amp;#34;&lt;/span>
&lt;span class="nv">VERSION_ID&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;9&amp;#34;&lt;/span>
&lt;span class="nv">VERSION&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;9 (stretch)&amp;#34;&lt;/span>
&lt;span class="nv">ID&lt;/span>&lt;span class="o">=&lt;/span>debian
&lt;span class="nv">HOME_URL&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;https://www.debian.org/&amp;#34;&lt;/span>
&lt;span class="nv">SUPPORT_URL&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;https://www.debian.org/support&amp;#34;&lt;/span>
&lt;span class="nv">BUG_REPORT_URL&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;https://bugs.debian.org/&amp;#34;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¯ä»¥çœ‹åˆ°å®¹å™¨å·²ç»è¿è¡ŒæˆåŠŸã€‚å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä¸é€šè¿‡ &lt;code>root&lt;/code> æƒé™è¿è¡Œå®¹å™¨ï¼Œåªè¦ç®€å•çš„é€šè¿‡ &lt;code>user&lt;/code> Namespace è¿›è¡Œéš”ç¦»ï¼Œå¹¶æ·»åŠ  &lt;code>user&lt;/code> å’Œ &lt;code>group&lt;/code> çš„æ˜ å°„ä¹‹ç±»çš„ä¾¿å¯ä»¥äº†ã€‚æ­¤å¤„ä¸åšèµ˜è¿°ã€‚&lt;/p>
&lt;h2 id="ä¸ºä½•æœ‰-runc-10-rc6-å­˜åœ¨">ä¸ºä½•æœ‰ &lt;code>runc 1.0-rc6&lt;/code> å­˜åœ¨&lt;/h2>
&lt;p>æˆ‘ä»¬çŸ¥é“ï¼Œ&lt;code>OCI&lt;/code> åœ¨ 2015 å¹´æˆç«‹ï¼Œåœ¨ 2017 å¹´ 7 æœˆçš„æ—¶å€™æ­£å¼å®£å¸ƒ &lt;code>OCI&lt;/code> v1.0.0 release ã€‚å…¶å®åœ¨ 2017 å¹´çš„ 11 æœˆè¿˜ release äº† v1.0.1 ç‰ˆæœ¬ã€‚&lt;/p>
&lt;p>å‰é¢å·²ç»æè¿‡ &lt;code>runc&lt;/code> æ˜¯ &lt;code>OCI&lt;/code> çš„å®˜æ–¹å®ç°ï¼Œé‚£ä¸ºä½•æ—¶è¿‡ä¸€å¹´è¿˜æœªæ­£å¼ release 1.0 å‘¢ï¼Ÿè¿™é‡Œé¢åŸå› å…¶å®è¯´æ¥ä¹Ÿå¤æ‚ï¼Œè¿™ä¹Ÿæ˜¯è¿™ç¯‡æ–‡ç« æƒ³èŠçš„éƒ¨åˆ†ã€‚&lt;/p>
&lt;p>é¦–å…ˆï¼š&lt;code>runc&lt;/code> 1.0 æˆ‘ä»¬æƒ³æ­£å¼ relase ä¹ˆï¼Ÿ ç­”æ¡ˆæ˜¯ æƒ³ã€‚å…¶å®æ—©åœ¨ 2017 å¹´ 8 æœˆä»½çš„æ—¶å€™ &lt;code>runc 1.0-rc4&lt;/code> å°±å·²ç»æ”¯æŒ &lt;code>OCI&lt;/code> v1.0.0 äº†ã€‚ä½†å½“æ—¶å¹¶æ²¡æœ‰è¿›è¡Œæ­£å¼ç‰ˆå‘å¸ƒï¼Œè½¬è€Œä¸‰ä¸ªæœˆåï¼Œ &lt;code>OCI&lt;/code> ç¨åšäº†æ›´æ–°ã€‚&lt;/p>
&lt;p>åˆ° 2018 å¹´ 2 æœˆä»½çš„æ—¶å€™ï¼Œå‘å¸ƒäº† &lt;code>runc 1.0-rc5 -- &amp;quot;The Final Stretch&amp;quot;&lt;/code> è¿™ä¸ªç‰ˆæœ¬å–åå…¶å®å·²ç»å¾ˆæ˜ç¡®äº† &lt;code>The Final Stretch&lt;/code> å·²ç»å°†è¿™ä¸ªç‰ˆæœ¬ä½œä¸ºæ­£å¼ç‰ˆæœ¬å‰çš„æœ€åä¸€ä¸ªç‰ˆæœ¬è¿›è¡Œå‘å¸ƒäº†ã€‚&lt;/p>
&lt;p>ä½†æ˜¯ï¼Œæç¬”å‰åˆå‘äº†æ–°ç‰ˆæœ¬ &lt;code>runc 1.0-rc6 -- &amp;quot;For Real This Time&amp;quot;&lt;/code> ï¼Œè¿™ä¸ªç‰ˆæœ¬åœ¨é¢„æœŸä¸­å…¶å®æ˜¯æƒ³å‘å¸ƒ 1.0 çš„ã€‚æˆ‘ä»¬è®¨è®ºåæ€»ç»“çš„ç»“è®ºä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ä¸å¤Ÿè§„èŒƒã€‚ä¸€æ–¹é¢æ˜¯ &lt;code>runc&lt;/code> åœ¨æŒç»­çš„è¿­ä»£æ”¹è¿›ï¼Œå¦ä¸€æ–¹é¢æ˜¯ç›®å‰å¾ˆå¤šå…¶ä»–çš„è¿è¡Œæ—¶å®ç°çš„ä¸€äº› hooks ä¾èµ–äºå½“å‰çš„ä¸€äº›å®ç°ï¼Œè€Œè¿™äº›å®ç°ï¼Œå¹¶ä¸å®Œå…¨ç¬¦åˆè§„èŒƒã€‚è¿™å°±é€ æˆäº†ä¸€æ—¦ä¿®æ­£äº†è¿™äº› â€œé”™è¯¯â€ åŠ¿å¿…é€ æˆå…¶ä»–è¿è¡Œæ—¶çš„ä¸ç¨³å®šå’Œé”™è¯¯ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å‘å¸ƒå‘¨æœŸä¸æ˜ç¡®ã€‚ç›®å‰å®¹å™¨ç›¸å…³ç”Ÿæ€ä¸­è¾ƒä¸ºæ ¸å¿ƒçš„é¡¹ç›®ï¼Œä¼°è®¡å°± &lt;code>runc&lt;/code> çš„å‘å¸ƒå‘¨æœŸæ¯”è¾ƒ â€œä½›ç³»â€ äº†ï¼Œæˆ‘ä»¬ç”šè‡³æ²¡æœ‰ä¸€ä¸ªæ˜ç¡®çš„å‘å¸ƒå‘¨æœŸã€‚è¿™æ¬¡çš„æ€»ç»“ä¸­ï¼Œæˆ‘ä»¥ Kubernetes çš„å‘å¸ƒåšäº†ä¾‹å­ï¼š&lt;/p>
&lt;/li>
&lt;/ul>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align:center">Kubernetes Release&lt;/th>
&lt;th style="text-align:center">Date&lt;/th>
&lt;th style="text-align:center">Cadence&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align:center">Christening of 1.0&lt;/td>
&lt;td style="text-align:center">10th July 2015&lt;/td>
&lt;td style="text-align:center">~one year from inception&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">From 1.0 to 1.1&lt;/td>
&lt;td style="text-align:center">9th November 2015&lt;/td>
&lt;td style="text-align:center">122 days&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">From 1.1 to 1.2&lt;/td>
&lt;td style="text-align:center">16th March 2016&lt;/td>
&lt;td style="text-align:center">128 days&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">From 1.2 to 1.3&lt;/td>
&lt;td style="text-align:center">1st July 2016&lt;/td>
&lt;td style="text-align:center">107 days&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">From 1.3 to 1.4&lt;/td>
&lt;td style="text-align:center">26th September 2016&lt;/td>
&lt;td style="text-align:center">87 days&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">From 1.4 to 1.5&lt;/td>
&lt;td style="text-align:center">12th December 2016&lt;/td>
&lt;td style="text-align:center">77 days&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">From 1.5 to 1.6&lt;/td>
&lt;td style="text-align:center">28th March 2017&lt;/td>
&lt;td style="text-align:center">106 days&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">From 1.6 to 1.7&lt;/td>
&lt;td style="text-align:center">30th June 2017&lt;/td>
&lt;td style="text-align:center">94 days&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">From 1.7 to 1.8&lt;/td>
&lt;td style="text-align:center">28th September 2017&lt;/td>
&lt;td style="text-align:center">90 days&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">From 1.8 to 1.9&lt;/td>
&lt;td style="text-align:center">15th December 2017&lt;/td>
&lt;td style="text-align:center">78 days&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">From 1.9 to 1.10&lt;/td>
&lt;td style="text-align:center">28th March 2018&lt;/td>
&lt;td style="text-align:center">103 days&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">From 1.10 to 1.11&lt;/td>
&lt;td style="text-align:center">3rd July 2018&lt;/td>
&lt;td style="text-align:center">97 days&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">From 1.11 to 1.12&lt;/td>
&lt;td style="text-align:center">ETA 25th September 2018&lt;/td>
&lt;td style="text-align:center">84 days&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>ä»¥è¿™ä¸ªå‘å¸ƒè®°å½•æ¥çœ‹çš„è¯ï¼Œæ¯ä¸‰ä¸ªæœˆä½œä¸ºä»¥æ­¤å‘å¸ƒç›¸å¯¹åˆé€‚ï¼Œä¹Ÿæ¯”è¾ƒé€šç”¨ã€‚&lt;/p>
&lt;p>è‡³äºè¿™æ¬¡ï¼Œ&lt;code>runc 1.0-rc6&lt;/code> çš„å‘å¸ƒï¼Œå°†ä½œä¸ºç‰¹æ€§å†»ç»“å‘å¸ƒï¼Œç›´åˆ°ä¸‹æ¬¡å‘å¸ƒå‰ï¼Œé‡ç‚¹éƒ½å°†æ”¾åœ¨ â€œç¬¦åˆè§„èŒƒâ€ ä¸Šé¢ï¼ŒåŒæ—¶ä¹Ÿç»™å…¶ä»–çš„è¿è¡Œæ—¶å®ç°å……è¶³çš„æ—¶é—´ï¼Œç”¨äºåšå¥½å…¼å®¹ä¹‹ç±»çš„ã€‚&lt;/p>
&lt;h2 id="æ€»ç»“">æ€»ç»“&lt;/h2>
&lt;p>ä»¥ä¸Šå°±æ˜¯æœ¬æ¬¡å…³äº &lt;code>runc 1.0-rc6&lt;/code> å‘å¸ƒæ—¶çš„ä¸€äº›ç¢ç¢å¿µï¼Œå¯¹è¿™ç§æƒ…å†µé¢‡æœ‰æ„Ÿæ…¨ï¼Œâ€œç¬¦åˆè§„èŒƒâ€ å¹¶æ²¡æœ‰é‚£ä¹ˆå¥½åšï¼Œå°¤å…¶æ˜¯åšåŸºç¡€æ”¯æ’‘çš„æ—¶å€™ã€‚&lt;/p>
&lt;hr>
&lt;p>å¯ä»¥é€šè¿‡ä¸‹é¢äºŒç»´ç è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Docker/">Docker</category><category domain="https://moelove.info/tags/Container/">Container</category><category domain="https://moelove.info/tags/runc/">runc</category></item><item><title>Docker æ·±å…¥ç¯‡ä¹‹ Build åŸç†</title><link>https://moelove.info/2018/09/04/Docker-%E6%B7%B1%E5%85%A5%E7%AF%87%E4%B9%8B-Build-%E5%8E%9F%E7%90%86/</link><guid isPermaLink="true">https://moelove.info/2018/09/04/Docker-%E6%B7%B1%E5%85%A5%E7%AF%87%E4%B9%8B-Build-%E5%8E%9F%E7%90%86/</guid><pubDate>Tue, 04 Sep 2018 22:21:46 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;p>ä½¿ç”¨ Docker æ—¶ï¼Œæœ€å¸¸ç”¨çš„å‘½ä»¤æ— éæ˜¯ &lt;code>docker container&lt;/code> å’Œ &lt;code>docker image&lt;/code> ç›¸å…³çš„å­å‘½ä»¤ï¼Œå½“ç„¶æœ€åˆæ²¡æœ‰ç®¡ç†ç±»å‘½ä»¤ï¼ˆæˆ–è€…è¯´åˆ†ç»„ï¼‰çš„æ—¶å€™ï¼Œæœ€å¸¸ä½¿ç”¨çš„å‘½ä»¤ä¹Ÿæ— éæ˜¯ &lt;code>docker run&lt;/code> &lt;code>docker commit&lt;/code> &lt;code>docker build&lt;/code> å’Œ &lt;code>docker images&lt;/code> è¿™äº›ã€‚&lt;/p>
&lt;p>ä»Šå¤©æ¥èŠä¸€ä¸‹å’Œ Docker ä¸­æ ¸å¿ƒæ¦‚å¿µ &lt;code>image&lt;/code> ç›¸å…³çš„é‡è¦å‘½ä»¤ï¼Œ &lt;code>docker build&lt;/code> æˆ–è€…è¯´ &lt;code>docker image build&lt;/code> ä¸ºäº†ç®€ä¾¿èµ·è§ï¼Œä¸‹æ–‡çš„å‘½ä»¤å…¨éƒ¨ä½¿ç”¨ &lt;code>docker build&lt;/code> ã€‚&lt;/p>
&lt;h1 id="docker-image">Docker Image&lt;/h1>
&lt;p>å…ˆç®€å•ä»‹ç»ä¸‹ Docker Imageï¼Œ é€šå¸¸æƒ…å†µä¸‹æˆ‘ä»¬å°†å…¶ç§°ä¹‹ä¸ºé•œåƒï¼Œé•œåƒæ˜¯ç”±å¤šä¸ªå±‚ç»„æˆçš„æ–‡ä»¶ï¼Œè¿™äº›å±‚ç”¨äºåœ¨å®¹å™¨å†…æ‰§è¡Œä»£ç ï¼ˆå‘½ä»¤ï¼‰ç­‰ã€‚æ¯ä¸ªé•œåƒåŸºæœ¬ä¸Šéƒ½æ˜¯æ ¹æ®åº”ç”¨ç¨‹åºå®Œæ•´çš„å¯æ‰§è¡Œç‰ˆæœ¬è¿›è¡Œæ„å»ºçš„ï¼Œå¹¶ä¸”éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå®ƒä¼šä¾èµ–äºä¸»æœºçš„ç³»ç»Ÿå†…æ ¸ã€‚å½“ç”¨æˆ·åœ¨è¿è¡Œé•œåƒæ—¶ï¼Œè¿™å°†ä¼šåˆ›å»ºä¸€ä¸ªæˆ–è€…å¤šä¸ªå®¹å™¨å®ä¾‹ã€‚&lt;/p>
&lt;h1 id="dockerd">Dockerd&lt;/h1>
&lt;p>Dockerd æ˜¯ Docker çš„æœåŠ¡ç«¯ï¼Œé»˜è®¤æƒ…å†µä¸‹æä¾› Unix Domain Socket è¿æ¥ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ç›‘å¬æŸä¸ªç«¯å£ï¼Œç”¨äºå¯¹å¤–æä¾›æœåŠ¡ã€‚ æ‰€ä»¥æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨æœåŠ¡å™¨ä¸Šçš„ Docker daemon æ¥æä¾›æœåŠ¡ï¼Œä»¥åŠ å¿«æ„å»ºé€Ÿåº¦åŠè§£å†³ä¸€äº›ç½‘ç»œé—®é¢˜ä¹‹ç±»çš„ã€‚&lt;/p>
&lt;p>å¥½çš„ï¼ŒåŸºç¡€æ¦‚å¿µäº†è§£äº†ï¼Œ é‚£æˆ‘ä»¬å¼€å§‹è¿›å…¥æ­£é¢˜ã€‚&lt;/p>
&lt;h1 id="ä½¿ç”¨-dockerfile">ä½¿ç”¨ Dockerfile&lt;/h1>
&lt;p>æˆ‘ä»¬çŸ¥é“æ„å»ºé•œåƒçš„æ–¹æ³•æœ‰å¤šç§ï¼Œæœ¬æ–‡ä¸­æˆ‘ä»¬åªä»‹ç»ä½¿ç”¨ Dockerfile é€šè¿‡ &lt;code>docker build&lt;/code> çš„æ–¹å¼æ„å»ºé•œåƒã€‚&lt;/p>
&lt;p>ä¸ºäº†ç®€ä¾¿ï¼Œæˆ‘ä»¬ä»¥ä¸€ä¸ªç®€å•çš„ Dockerfile å¼€å§‹ã€‚æ„å»ºä¸€ä¸ªå®¹å™¨å†…ä½¿ç”¨çš„ kubectl å·¥å…· (å½“ç„¶é€‰æ‹©å®ƒçš„åŸå› åœ¨äº kubectl è¶³å¤Ÿå¤§ï¼Œå¹¶&lt;strong>ä¸è€ƒè™‘å¯ç”¨æ€§&lt;/strong>ï¼Œè¿™ä¸ªç¨åè§£é‡Š)&lt;/p>
&lt;pre>&lt;code>FROM scratch
LABEL maintainer='Jintao Zhang &amp;lt;moelove.info&amp;gt;'
ADD kubectl /kubectl
ENTRYPOINT [ &amp;quot;/kubectl&amp;quot; ]
&lt;/code>&lt;/pre>&lt;p>Dockerfile è¶³å¤Ÿç®€å•ï¼Œåªæ˜¯å°† kubectl çš„äºŒè¿›åˆ¶æ–‡ä»¶æ‹·è´è¿›å»ï¼Œå¹¶å°† Entrypoint è®¾ç½®ä¸º kubectl ã€‚&lt;/p>
&lt;h1 id="dockerd-in-docker">Dockerd in Docker&lt;/h1>
&lt;p>æˆ‘ä¸ªäººä¸€èˆ¬ä¸ºäº†é¿å…ç¯å¢ƒçš„æ±¡æŸ“ï¼Œå¤§å¤šæ•°çš„äº‹æƒ…éƒ½åœ¨å®¹å™¨å†…å®Œæˆã€‚åŒ…æ‹¬ dockerd æˆ‘ä¹Ÿå¯åœ¨å®¹å™¨å†…ã€‚å…¶ä¸­çš„åŸç†ä¸å†ä»‹ç»ï¼Œå¯ä»¥å‚è€ƒæˆ‘ä¹‹å‰çš„æ–‡ç« æˆ–åˆ†äº«ã€‚ä½¿ç”¨èµ·æ¥å¾ˆç®€å•ï¼š&lt;/p>
&lt;pre>&lt;code>docker run --privileged -d -P docker:stable-dind
&lt;/code>&lt;/pre>&lt;p>æ³¨æ„è¿™é‡Œä½¿ç”¨äº† &lt;code>-P&lt;/code> æ‰€ä»¥æœ¬åœ°ä¼šéšæœºæ˜ å°„ä¸€ä¸ªç«¯å£ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥ç›´æ¥æŒ‡å®šæ˜ å°„åˆ°å®¹å™¨å†…çš„ 2375 ç«¯å£ã€‚&lt;/p>
&lt;pre>&lt;code>(Tao) âœ build git:(master) docker ps
CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES
b56f6483614d docker:stable-dind &amp;quot;dockerd-entrypoint.â€¦&amp;quot; 9 hours ago Up 9 hours 0.0.0.0:32769-&amp;gt;2375/tcp trusting_babbage
&lt;/code>&lt;/pre>&lt;h1 id="æ„å»º">æ„å»º&lt;/h1>
&lt;p>æˆ‘ä»¬ç›´æ¥ä½¿ç”¨å¯åŠ¨åœ¨å®¹å™¨å†…çš„ dockerd è¿›è¡Œæ„å»ºï¼Œé€šè¿‡ä¸Šé¢çš„ &lt;code>docker ps&lt;/code> å‘½ä»¤å¯ä»¥çœ‹åˆ°æ˜¯æ˜ å°„åˆ°äº†æœ¬åœ°çš„ 32769 ç«¯å£ã€‚æ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿›è¡Œæ„å»ºï¼š&lt;/p>
&lt;pre>&lt;code>(Tao) âœ kubectl git:(master) docker -H 0.0.0.0:32769 images
REPOSITORY TAG IMAGE ID CREATED SIZE
(Tao) âœ kubectl git:(master) docker -H 0.0.0.0:32769 build -t local/kubectl .
Sending build context to Docker daemon 55.09MB
Step 1/4 : FROM scratch
---&amp;gt;
Step 2/4 : LABEL maintainer='Jintao Zhang &amp;lt;moelove.info&amp;gt;'
---&amp;gt; Running in ebcf44071bf0
Removing intermediate container ebcf44071bf0
---&amp;gt; eb4ea1725ff2
Step 3/4 : ADD kubectl /kubectl
---&amp;gt; 1aad06c4dbb4
Step 4/4 : ENTRYPOINT [ &amp;quot;/kubectl&amp;quot; ]
---&amp;gt; Running in 2fc78fe974e3
Removing intermediate container 2fc78fe974e3
---&amp;gt; 457802d4bf3e
Successfully built 457802d4bf3e
Successfully tagged local/kubectl:latest
(Tao) âœ kubectl git:(master) docker -H 0.0.0.0:32769 images
REPOSITORY TAG IMAGE ID CREATED SIZE
local/kubectl latest 457802d4bf3e 3 seconds ago 55.1MB
&lt;/code>&lt;/pre>&lt;p>çœ‹æ—¥å¿—åŠç»“æœï¼Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬å·²ç»æˆåŠŸçš„æ„å»ºäº†æˆ‘ä»¬æ‰€éœ€çš„é•œåƒã€‚è¯´äº†è¿™ä¹ˆå¤šï¼Œå…¶å®æˆ‘ä»¬ä»Šå¤©çš„å†…å®¹æ‰åˆšåˆšå¼€å§‹ã€‚&lt;/p>
&lt;h1 id="æ·±å…¥åŸç†">æ·±å…¥åŸç†&lt;/h1>
&lt;h2 id="dockerd-æœåŠ¡">Dockerd æœåŠ¡&lt;/h2>
&lt;p>åœ¨æœ¬æ–‡ä¸€å¼€å§‹ï¼Œæˆ‘å·²ç»æè¿‡ Dockerd æ˜¯ Docker çš„åç«¯æœåŠ¡ï¼Œé€šè¿‡ä¸Šé¢çš„&lt;/p>
&lt;pre>&lt;code>docker -H 0.0.0.0:32769 images
&lt;/code>&lt;/pre>&lt;p>è¿™æ¡å‘½ä»¤å¯ä»¥çœ‹åˆ°æˆ‘ä»¬é€šè¿‡ &lt;code>-H&lt;/code> æŒ‡å®šäº†æœ¬åœ° 32679 ç«¯å£çš„ dockerd æœåŠ¡ï¼Œè¿™å…¶å®æ˜¯ä¸ª HTTP æœåŠ¡ï¼Œæˆ‘ä»¬æ¥éªŒè¯ä¸‹ã€‚&lt;/p>
&lt;pre>&lt;code>(Tao) âœ kubectl git:(master) curl -i 0.0.0.0:32769/_ping
HTTP/1.1 200 OK
Api-Version: 1.37
Docker-Experimental: false
Ostype: linux
Server: Docker/18.03.1-ce (linux)
Date: Tue, 04 Sep 2018 17:20:51 GMT
Content-Length: 2
Content-Type: text/plain; charset=utf-8
OK%
&lt;/code>&lt;/pre>&lt;p>å¯ä»¥çœ‹åˆ°å‡ æ¡å…³é”®çš„ä¿¡æ¯ Api-Version: 1.37 è¿™ä¸ªè¡¨æ˜äº†å½“å‰ä½¿ç”¨çš„ API ç‰ˆæœ¬ï¼Œæœ¬æ–‡çš„å†…å®¹ä¹Ÿæ˜¯ä»¥ 1.37 ä¸ºä¾‹è¿›è¡Œä»‹ç»ï¼Œè¿™æ˜¯å½“å‰çš„ç¨³å®šç‰ˆæœ¬ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ &lt;code>docker version&lt;/code> è¿›è¡ŒæŸ¥çœ‹ã€‚&lt;/p>
&lt;pre>&lt;code>(Tao) âœ kubectl git:(master) docker -H 0.0.0.0:32769 version
Client:
Version: 18.06.0-ce
API version: 1.37 (downgraded from 1.38)
Go version: go1.10.3
Git commit: 0ffa825
Built: Wed Jul 18 19:11:45 2018
OS/Arch: linux/amd64
Experimental: false
Server:
Engine:
Version: 18.03.1-ce
API version: 1.37 (minimum version 1.12)
Go version: go1.9.5
Git commit: 9ee9f40
Built: Thu Apr 26 07:23:03 2018
OS/Arch: linux/amd64
Experimental: false
&lt;/code>&lt;/pre>&lt;p>å¯ä»¥çœ‹åˆ°æˆ‘æœ¬åœ°åœ¨ç”¨çš„ docker cli ç‰ˆæœ¬è¾ƒé«˜ï¼Œå½“è¿æ¥åˆ°ä½ç‰ˆæœ¬çš„ dockerd æ—¶ï¼ŒAPI ç‰ˆæœ¬é™çº§è‡³ä¸ dockerd ç‰ˆæœ¬ä¿æŒä¸€è‡´ã€‚&lt;/p>
&lt;p>å½“ç„¶ï¼Œä½ å¯èƒ½ä¼šé—®ï¼Œå¦‚æœæ˜¯ dockerd ç‰ˆæœ¬é«˜ä¼šå¦‚ä½•å‘¢ï¼Ÿå…¶å®æˆ‘æ—¥å¸¸ä¸­çš„å¼€å‘ç¯å¢ƒå°±æ˜¯è¿™æ ·ï¼Œå¤§å¤šæ•° API éƒ½æ²¡ä»€ä¹ˆå½±å“, ä¸è¿‡è¿™å¹¶ä¸æ˜¯ä»Šå¤©çš„é‡ç‚¹ã€‚&lt;/p>
&lt;pre>&lt;code>root@bdcdac73ee20:/# docker version
Client:
Version: 17.06.0-ce
API version: 1.30
Go version: go1.8.3
Git commit: 02c1d87
Built: Fri Jun 23 21:15:15 2017
OS/Arch: linux/amd64
Server:
Version: dev
API version: 1.39 (minimum version 1.12)
Go version: go1.10.3
Git commit: e8cc5a0b3
Built: Tue Sep 4 10:00:36 2018
OS/Arch: linux/amd64
Experimental: false
&lt;/code>&lt;/pre>&lt;h2 id="build-context">build context&lt;/h2>
&lt;p>å›åˆ°æˆ‘ä»¬ä¸Šé¢çš„æ„å»ºè¿‡ç¨‹ä¸­ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ—¥å¿—å†…å®¹çš„ç¬¬ä¸€è¡Œï¼š&lt;/p>
&lt;pre>&lt;code>...
Sending build context to Docker daemon 55.09MB
&lt;/code>&lt;/pre>&lt;p>ä»è¿™æ¡æ—¥å¿—ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°ä¸¤ä¸ªä¿¡æ¯ï¼š&lt;/p>
&lt;ul>
&lt;li>æ„å»ºçš„è¿‡ç¨‹æ˜¯å°† build context å‘é€ç»™ dockerd , å®é™…çš„æ„å»ºå‹åŠ›åœ¨ dockerd ä¸Š&lt;/li>
&lt;li>å‘é€äº† 55.09 MB&lt;/li>
&lt;/ul>
&lt;p>ç¬¬ä¸€æ¡ç»“è®ºï¼Œæˆ‘ä»¬åœ¨ä¸Šä¸€å°èŠ‚å·²ç»è®¨è®ºè¿‡äº†ï¼Œæˆ‘ä»¬æ¥é‡ç‚¹çœ‹ä¸‹ç¬¬äºŒæ¡ç»“è®ºã€‚&lt;/p>
&lt;pre>&lt;code>(Tao) âœ kubectl git:(master) ls -al
æ€»ç”¨é‡ 53808
drwxrwxr-x. 2 tao tao 4096 9æœˆ 5 01:00 .
drwxrwxr-x. 3 tao tao 4096 9æœˆ 5 00:57 ..
-rw-rw-r--. 1 tao tao 109 9æœˆ 5 01:00 Dockerfile
-rwxrwxr-x. 1 tao tao 55084063 9æœˆ 5 00:53 kubectl
(Tao) âœ kubectl git:(master) du -sh .
53M .
(Tao) âœ kubectl git:(master) du -sh kubectl Dockerfile
53M kubectl
4.0K Dockerfile
&lt;/code>&lt;/pre>&lt;p>æŒ‰ç…§æˆ‘ä»¬ Dockerfile çš„å†…å®¹ï¼Œæˆ‘ä»¬éœ€è¦å°† kubectl çš„äºŒè¿›åˆ¶åŒ…æ”¾å…¥é•œåƒå†…ï¼Œæ‰€ä»¥ build context è™½ç„¶æ¯”äºŒè¿›åˆ¶æ–‡ä»¶å¤šå‡ºæ¥ 2M å·¦å³çš„å¤§å°ä½ ä¹Ÿä¸ä¼šå¾ˆæ„å¤–ã€‚&lt;/p>
&lt;p>ä½†æˆ‘è¿™é‡Œåšäº†å¦ä¸€ä¸ªä¾‹å­ï¼Œä¸å¤šèµ˜è¿°ï¼Œä»£ç å¯ä»¥åœ¨æˆ‘çš„ &lt;a href="">GitHub&lt;/a> ä¸­æ‰¾åˆ°ã€‚è¿™é‡Œè´´å‡ºæ¥ç»“æœï¼š&lt;/p>
&lt;pre>&lt;code>(Tao) âœ text git:(master) ls -al
æ€»ç”¨é‡ 16
drwxrwxr-x. 2 tao tao 4096 9æœˆ 5 01:45 .
drwxrwxr-x. 4 tao tao 4096 9æœˆ 5 01:44 ..
-rw-rw-r--. 1 tao tao 77 9æœˆ 5 01:45 Dockerfile
-rw-rw-r--. 1 tao tao 61 9æœˆ 5 01:45 file
(Tao) âœ text git:(master) du -b Dockerfile file
77 Dockerfile
61 file
(Tao) âœ text git:(master) docker -H 0.0.0.0:32769 build --no-cache=true -t local/file .
Sending build context to Docker daemon 3.072kB
...
&lt;/code>&lt;/pre>&lt;p>ç›¸ä¿¡ä½ çœ‹åˆ°è¿™ä¸ªç»“æœå·²ç»æ˜ç™½æˆ‘æƒ³è¡¨è¾¾çš„æ„æ€ï¼Œæˆ‘ä»¬ç»§ç»­æ¢ç´¢ä¸‹è¿™ä¸ªè¿‡ç¨‹ã€‚&lt;/p>
&lt;h2 id="build-è¯·æ±‚">/build è¯·æ±‚&lt;/h2>
&lt;p>å‰é¢æˆ‘ä»¬å·²ç»è¯´è¿‡ï¼Œè¿™å°±æ˜¯ä¸ªæ™®é€šçš„ HTTP è¯·æ±‚ï¼Œæ‰€ä»¥æˆ‘ä»¬å½“ç„¶å¯ä»¥ç›´æ¥æŠ“åŒ…æ¥çœ‹çœ‹åˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ&lt;/p>
&lt;p>å¾ˆç®€å•ï¼Œé€šè¿‡ dockerd çš„åœ°å€ï¼Œä½¿ç”¨ &lt;code>POST&lt;/code> æ–¹æ³•ï¼Œè®¿é—® &lt;code>/build&lt;/code> æ¥å£, å½“ç„¶å®é™…æƒ…å†µæ˜¯ä¼šå¢åŠ å‰ç¼€ï¼Œå³æˆ‘åœ¨ä¸Šé¢æåˆ°çš„ç‰ˆæœ¬å·ï¼Œåœ¨ç›®å‰çš„ç¯å¢ƒä¸­ä½¿ç”¨çš„æ˜¯ &lt;code>/v1.37/build&lt;/code> è¿™ä¸ªæ¥å£ã€‚&lt;/p>
&lt;p>è€Œè¿™ä¸ªè¯·æ±‚æºå¸¦äº†ä¸€äº›å¾ˆæœ‰ç”¨çš„å‚æ•°ï¼Œå’Œå¤´ä¿¡æ¯ã€‚è¿™é‡Œæˆ‘æ¥ç®€å•è¯´ä¸‹ï¼š&lt;/p>
&lt;h3 id="header">Header&lt;/h3>
&lt;p>build è¯·æ±‚çš„å¤´éƒ¨ï¼Œä¸»è¦æœ‰ä»¥ä¸‹ä¸¤ä¸ª&lt;/p>
&lt;ul>
&lt;li>&lt;code>Content-Type&lt;/code> é»˜è®¤å€¼ä¸º &lt;code>application/x-tar&lt;/code>ï¼Œè¡¨æ˜è‡ªå·±æ˜¯ä¸€ä¸ªå½’æ¡£ã€‚&lt;/li>
&lt;li>&lt;code>X-Registry-Config&lt;/code> è¿™ä¸ªå¤´éƒ¨ä¿¡æ¯ä¸­åŒ…å«ç€ registry çš„åœ°å€åŠè®¤è¯ä¿¡æ¯ï¼Œå¹¶ä¸”ä»¥ base64 è¿›è¡Œç¼–ç ã€‚å¯¹ docker ç†Ÿæ‚‰çš„æœ‹å‹æˆ–è€…çœ‹è¿‡æˆ‘ä¹‹å‰æ–‡ç« çš„æœ‹å‹åº”è¯¥çŸ¥é“ï¼Œ Docker cli åœ¨ login æˆåŠŸåï¼Œä¼šå°†è®¤è¯ä¿¡æ¯ä¿å­˜è‡³æœ¬åœ°ï¼Œå¯†ç åš base64 ä¿å­˜ã€‚è€Œ build çš„æ—¶å€™åˆ™ä¼šå°†æ­¤ä¿¡æ¯å†æ¬¡ base64 è¿›è¡Œç¼–ç ã€‚é€šè¿‡è¿™é‡Œä¹Ÿå¯ä»¥çœ‹å‡ºæ¥ï¼Œåœ¨ä½¿ç”¨è¿œç«¯ Dockerd çš„æ—¶å€™ï¼Œ åº”è¯¥å°½é‡é…ç½® TLS ä»¥é˜²æ­¢ä¸­é—´äººæ”»å‡»ï¼Œé€ æˆå¯†ç æ³„æ¼ç­‰æƒ…å†µã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="parameters">Parameters&lt;/h3>
&lt;p>è¯·æ±‚å‚æ•°ä¸­ï¼Œåˆ—å‡ ä¸ªæ¯”è¾ƒæœ‰æ„ä¹‰çš„ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;code>t&lt;/code> è¿™å…¶å®å°±æ˜¯æˆ‘ä»¬ &lt;code>docker build -t&lt;/code> æ—¶å€™æŒ‡å®šçš„å‚æ•°ï¼Œå¹¶ä¸”ï¼Œæˆ‘ä»¬å¯ä»¥åŒæ—¶æŒ‡å®šå¤šä¸ª &lt;code>-t&lt;/code> åŒæ—¶æ„å»ºå¤šä¸ªä¸åŒåç§°çš„é•œåƒã€‚&lt;/li>
&lt;li>&lt;code>memory&lt;/code> &lt;code>cpusetcpus&lt;/code> è¿™äº›ä¸»è¦ç”¨äºèµ„æºé™åˆ¶&lt;/li>
&lt;li>&lt;code>buildargs&lt;/code> å¦‚æœæƒ³è¦äº†è§£è¿™ä¸ªå‚æ•°ï¼Œå¯ä»¥å›å¿†ä¸‹ Dockerfile ä¸­çš„ &lt;code>ARG&lt;/code> æŒ‡ä»¤çš„ç”¨æ³•&lt;/li>
&lt;/ul>
&lt;p>å½“ç„¶ï¼Œæˆ‘ä»¬æƒ³è¦æ¢ç´¢çš„è¿‡ç¨‹å…¶å®é‡ç‚¹å°±åœ¨äºè¯·æ±‚å¤´éƒ¨äº†ï¼Œ æ•´ä¸ªè¯·æ±‚çš„è¾“å…¥æµï¼Œå¿…é¡»æ˜¯ä¸€ä¸ª &lt;code>tar&lt;/code> å‹ç¼©åŒ…ï¼Œå¹¶ä¸”æ”¯æŒ &lt;code>identity&lt;/code> (ä¸å‹ç¼©), &lt;code>gzip&lt;/code>, &lt;code>bzip2&lt;/code>, &lt;code>xz&lt;/code> ç­‰å‹ç¼©ç®—æ³•ã€‚&lt;/p>
&lt;h2 id="å®ç°">å®ç°&lt;/h2>
&lt;p>æˆ‘ä»¬æ¥çœ‹ä¸‹åŸºæœ¬çš„å®ç°ï¼š&lt;/p>
&lt;pre>&lt;code>func (cli *Client) ImageBuild(ctx context.Context, buildContext io.Reader, options types.ImageBuildOptions) (types.ImageBuildResponse, error) {
query, err := cli.imageBuildOptionsToQuery(options)
if err != nil {
return types.ImageBuildResponse{}, err
}
headers := http.Header(make(map[string][]string))
buf, err := json.Marshal(options.AuthConfigs)
if err != nil {
return types.ImageBuildResponse{}, err
}
headers.Add(&amp;quot;X-Registry-Config&amp;quot;, base64.URLEncoding.EncodeToString(buf))
headers.Set(&amp;quot;Content-Type&amp;quot;, &amp;quot;application/x-tar&amp;quot;)
serverResp, err := cli.postRaw(ctx, &amp;quot;/build&amp;quot;, query, buildContext, headers)
if err != nil {
return types.ImageBuildResponse{}, err
}
osType := getDockerOS(serverResp.header.Get(&amp;quot;Server&amp;quot;))
return types.ImageBuildResponse{
Body: serverResp.body,
OSType: osType,
}, nil
}
&lt;/code>&lt;/pre>&lt;h1 id="æ€»ç»“">æ€»ç»“&lt;/h1>
&lt;p>è¿™ç¯‡ä¸»è¦å†…å®¹é›†ä¸­åœ¨ docker build çš„è¿‡ç¨‹åŠå…¶åŸç†ä¸Šï¼Œä¸ºä»€ä¹ˆé¦–å…ˆè¦å†™è¿™ç¯‡ï¼Œä¸»è¦æ˜¯å› ä¸ºé•œåƒå’Œæˆ‘ä»¬æ¯æ¯ç›¸å…³ï¼Œ å¹¶ä¸”ä¹Ÿæ˜¯æˆ‘ä»¬ä½¿ç”¨çš„ç¬¬ä¸€æ­¥ã€‚è€Œå¾ˆå¤šæƒ…å†µä¸‹ï¼Œæ¨è¿›ä¸šåŠ¡å®¹å™¨åŒ–ä¹Ÿéƒ½è¦é¢ä¸´ç€æ€§èƒ½ä¼˜åŒ–åŠå…¶ä»–è§„èŒƒä¹‹ç±»çš„ã€‚&lt;/p>
&lt;p>å…¶å®å…³äº build çš„ç»†èŠ‚è¿˜æœ‰å¾ˆå¤šï¼Œå¦‚æœæœ‰ç©ºï¼Œæˆ‘å°±å†æ›´æ–°ä¸‹ä¸€ç¯‡ã€‚&lt;/p>
&lt;hr>
&lt;p>å¯ä»¥é€šè¿‡ä¸‹é¢äºŒç»´ç è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Docker/">Docker</category></item><item><title>GitLab CI ä½¿ç”¨ InsecureRegistry</title><link>https://moelove.info/2018/08/06/GitLab-CI-%E4%BD%BF%E7%94%A8-InsecureRegistry/</link><guid isPermaLink="true">https://moelove.info/2018/08/06/GitLab-CI-%E4%BD%BF%E7%94%A8-InsecureRegistry/</guid><pubDate>Mon, 06 Aug 2018 08:12:03 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;p>ç»§ä¸Šæ¬¡åˆ†äº«åï¼Œæœ‰è¯»è€…ç•™è¨€é—® dind ä½¿ç”¨ insecure-registry ç›¸å…³çš„é—®é¢˜ã€‚&lt;/p>
&lt;blockquote>
&lt;p>è¯·æ•™ä¸ªé—®é¢˜ï¼ŒåŸºäºgitlab CIåšjavaé¡¹ç›®æŒç»­é›†æˆï¼Œç”¨åˆ°äº†docker in dockerï¼Œ docker buildä½¿ç”¨çš„Dockerfileä¸­ä½¿ç”¨äº†ä¸€ä¸ªinsecure registryï¼Œåœ¨dindçš„å®¹å™¨ä¸­å¦‚ä½•é…ç½®insecure registry&lt;/p>
&lt;/blockquote>
&lt;p>æˆ‘çš„å›å¤æ˜¯ï¼š&lt;/p>
&lt;p>é¦–å…ˆ, ä¸æ¨èä½¿ç”¨ insecure registry æ¯•ç«Ÿæœ‰å…¶å›ºæœ‰é™åˆ¶ï¼Œ å¦‚æœä¸€å®šè¦ç”¨çš„è¯ï¼Œ å…¶å®åœ¨ services å±‚é…ç½®ä¸€ä¸ª command å°±å¯ä»¥ï¼Œè¿™ä¹Ÿæ˜¯æœ€ç®€å•çš„ï¼Œ ä¾‹å¦‚ï¼š&lt;/p>
&lt;pre>&lt;code>services:
- name: docker:dind
command: [&amp;quot;--insecure-registry=myregistry:5000&amp;quot;]
&lt;/code>&lt;/pre>&lt;p>ç”±äºç•™è¨€å­—æ•°çš„é™åˆ¶ï¼Œå°±å•ç‹¬å†™ä¸ªå°æ–‡æ¥å›å¤ä¸‹ã€‚&lt;/p>
&lt;p>è¿™ä¸ªåšæ³•å®é™…æ•ˆæœå¦‚ä¸‹ï¼š&lt;/p>
&lt;pre>&lt;code>(Tao) âœ kubernetes git:(master) âœ— sudo docker run -d --privileged --name dind docker:dind --insecure-registry=&amp;quot;myregistry:5000&amp;quot;
8fb68865638ebc65255bb568fbe1fd6b4ed4fca771075d8e55ebbbbdf0aef6d2
(Tao) âœ kubernetes git:(master) âœ— sudo docker top dind
UID PID PPID C STIME TTY TIME CMD
root 18270 18252 1 11:27 ? 00:00:00 dockerd --host=unix:///var/run/docker.sock --host=tcp://0.0.0.0:2375 --insecure-registry=myregistry:5000
root 18328 18270 0 11:27 ? 00:00:00 docker-containerd --config /var/run/docker/containerd/containerd.toml
&lt;/code>&lt;/pre>&lt;p>å½“ç„¶è¿™æ ·åšæ˜¯å¯ä»¥è§£å†³é—®é¢˜ï¼Œä½†è¿˜æ˜¯å»ºè®®ä¸è¦ä½¿ç”¨ &lt;code>insecure-registry&lt;/code> æ¯•ç«Ÿè¿™ä¸æ˜¯ä¸ªå®‰å…¨çš„åšæ³•è€Œä¸”ä¹Ÿæœ‰å…¶é™åˆ¶ã€‚é™åˆ¶çš„éƒ¨åˆ†ä¸æ˜¯è¿™æ¬¡çš„é‡ç‚¹ï¼Œä¹Ÿå°±ä¸å¤šåšè§£é‡Šäº†ã€‚&lt;/p>
&lt;hr>
&lt;p>å¯ä»¥é€šè¿‡ä¸‹é¢äºŒç»´ç è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/DevOps/">DevOps</category><category domain="https://moelove.info/tags/CI/">CI</category><category domain="https://moelove.info/tags/GitLab/">GitLab</category></item><item><title>åŸºäº GitLab çš„ CI å®è·µ</title><link>https://moelove.info/2018/08/05/%E5%9F%BA%E4%BA%8E-GitLab-%E7%9A%84-CI-%E5%AE%9E%E8%B7%B5/</link><guid isPermaLink="true">https://moelove.info/2018/08/05/%E5%9F%BA%E4%BA%8E-GitLab-%E7%9A%84-CI-%E5%AE%9E%E8%B7%B5/</guid><pubDate>Sun, 05 Aug 2018 14:54:59 +0800</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ä¸Šä¸ªæœˆå— DockOne ç¤¾åŒºé‚€è¯·ï¼Œåšäº†ä¸€æ¬¡ CI å®è·µæ–¹é¢çš„çº¿ä¸Šåˆ†äº«ï¼Œåœ¨æ­¤è®°å½•ä¸‹ã€‚
æœ¬æ–‡è®²è¿° GitLab CI çš„æ¶æ„åŠå…¶èƒ½åŠ›ç‰¹æ€§ï¼Œåˆ†æå®ƒåœ¨ DevOps å®è·µä¸­çš„ä½œç”¨ã€‚ é€šè¿‡åˆ†æ Docker In Docker çš„æŠ€æœ¯ç»†èŠ‚ï¼Œè¯¦ç»†è®²è¿° CI å®è·µä»¥åŠåœ¨ç”Ÿäº§ç¯å¢ƒä¸­çš„æ‰€åšçš„ä¼˜åŒ–ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºé•œåƒä»“åº“ç­‰ï¼Œä»¥è¾¾åˆ°æ•°å€çš„æ€§èƒ½æå‡ã€‚
æœ¬æ¬¡åˆ†äº«å†…å®¹ä»¥ GitLab Community Edition 11.0.4 edb037c ä¸ºä¾‹ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="ä¸ºä½•é€‰æ‹©-gitlab-ci">ä¸ºä½•é€‰æ‹© GitLab CI&lt;/h2>
&lt;h3 id="è®¤è¯†-gitlab-ci">è®¤è¯† GitLab CI&lt;/h3>
&lt;h4 id="ä»€ä¹ˆæ˜¯-gitlab-ci">ä»€ä¹ˆæ˜¯ GitLab CI&lt;/h4>
&lt;p>GitLab CI æ˜¯ GitLab ä¸ºäº†æå‡å…¶åœ¨è½¯ä»¶å¼€å‘å·¥ç¨‹ä¸­ä½œç”¨ï¼Œå®Œå–„ DevOPS ç†å¿µæ‰€åŠ å…¥çš„ CI/CD åŸºç¡€åŠŸèƒ½ã€‚å¯ä»¥ä¾¿æ·çš„èå…¥è½¯ä»¶å¼€å‘ç¯èŠ‚ä¸­ã€‚é€šè¿‡ GitLab CI å¯ä»¥å®šä¹‰å®Œå–„çš„ CI/CD Pipelineã€‚&lt;/p>
&lt;h4 id="ä¼˜åŠ¿">ä¼˜åŠ¿&lt;/h4>
&lt;ul>
&lt;li>GitLab CI æ˜¯é»˜è®¤åŒ…å«åœ¨ GitLab ä¸­çš„ï¼Œæˆ‘ä»¬çš„ä»£ç ä½¿ç”¨ GitLab è¿›è¡Œæ‰˜ç®¡ï¼Œè¿™æ ·å¯ä»¥å¾ˆå®¹æ˜“çš„è¿›è¡Œé›†æˆ&lt;/li>
&lt;li>GitLab CI çš„å‰ç«¯ç•Œé¢æ¯”è¾ƒç¾è§‚ï¼Œå®¹æ˜“è¢«äººæ¥å—&lt;/li>
&lt;li>åŒ…å«å®æ—¶æ„å»ºæ—¥å¿—ï¼Œå®¹æ˜“è¿½è¸ª&lt;/li>
&lt;li>é‡‡ç”¨ C/S çš„æ¶æ„ï¼Œå¯æ–¹é¢çš„è¿›è¡Œæ¨ªå‘æ‰©å±•ï¼Œæ€§èƒ½ä¸Šä¸ä¼šæœ‰å½±å“&lt;/li>
&lt;li>ä½¿ç”¨ YAML è¿›è¡Œé…ç½®ï¼Œä»»ä½•äººéƒ½å¯ä»¥å¾ˆæ–¹ä¾¿çš„ä½¿ç”¨ã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="é‡ç‚¹æ¦‚å¿µ">é‡ç‚¹æ¦‚å¿µ&lt;/h3>
&lt;h4 id="pipeline">Pipeline&lt;/h4>
&lt;p>Pipeline ç›¸å½“äºä¸€ä¸ªæ„å»ºä»»åŠ¡ï¼Œé‡Œé¢å¯ä»¥åŒ…å«å¤šä¸ªæµç¨‹ï¼Œå¦‚ä¾èµ–å®‰è£…ã€ç¼–è¯‘ã€æµ‹è¯•ã€éƒ¨ç½²ç­‰ã€‚
ä»»ä½•æäº¤æˆ–è€… Merge Request çš„åˆå¹¶éƒ½å¯ä»¥è§¦å‘ Pipeline&lt;/p>
&lt;h4 id="stages">Stages&lt;/h4>
&lt;p>Stage è¡¨ç¤ºæ„å»ºçš„é˜¶æ®µï¼Œå³ä¸Šé¢æåˆ°çš„æµç¨‹.&lt;/p>
&lt;ul>
&lt;li>æ‰€æœ‰ Stages æŒ‰é¡ºåºæ‰§è¡Œï¼Œå³å½“ä¸€ä¸ª Stage å®Œæˆåï¼Œä¸‹ä¸€ä¸ª Stage æ‰ä¼šå¼€å§‹&lt;/li>
&lt;li>ä»»ä¸€ Stage å¤±è´¥ï¼Œåé¢çš„ Stages å°†æ°¸ä¸ä¼šæ‰§è¡Œï¼ŒPipeline å¤±è´¥&lt;/li>
&lt;li>åªæœ‰å½“æ‰€æœ‰ Stages å®Œæˆåï¼ŒPipeline æ‰ä¼šæˆåŠŸ&lt;/li>
&lt;/ul>
&lt;h4 id="jobs">Jobs&lt;/h4>
&lt;p>Job æ˜¯ Stage ä¸­çš„ä»»åŠ¡.&lt;/p>
&lt;ul>
&lt;li>ç›¸åŒ Stage ä¸­çš„ Jobs ä¼šå¹¶è¡Œæ‰§è¡Œ&lt;/li>
&lt;li>ä»»ä¸€ Job å¤±è´¥ï¼Œé‚£ä¹ˆ Stage å¤±è´¥ï¼ŒPipeline å¤±è´¥&lt;/li>
&lt;li>ç›¸åŒ Stage ä¸­çš„ Jobs éƒ½æ‰§è¡ŒæˆåŠŸæ—¶ï¼Œè¯¥ Stage æˆåŠŸ&lt;/li>
&lt;/ul>
&lt;p>å¥½çš„ï¼ŒåŸºæœ¬çš„æ¦‚å¿µå·²ç»å’Œå¤§å®¶ä»‹ç»äº†ï¼Œ å¤§å®¶å¯ä»¥å‘ç°ï¼Œä¸Šé¢è¯´çš„æ¦‚å¿µï¼Œæ²¡æœ‰æåˆ°ä»»åŠ¡çš„å®é™…æ‰§è¡Œè€…. é‚£ä»»åŠ¡åœ¨å“ªé‡Œæ‰§è¡Œå‘¢ï¼Ÿ&lt;/p>
&lt;h3 id="gitlab-runner">GitLab runner&lt;/h3>
&lt;p>Runner æ˜¯ä»»åŠ¡çš„å®é™…æ‰§è¡Œè€…ï¼Œ å¯ä»¥åœ¨ MacOS/Linux/Windows ç­‰ç³»ç»Ÿä¸Šè¿è¡Œã€‚ä½¿ç”¨ golang è¿›è¡Œå¼€å‘ã€‚ åŒæ—¶ä¹Ÿå¯éƒ¨ç½²åœ¨ k8s ä¸Š&lt;/p>
&lt;h4 id="æ³¨å†Œ">æ³¨å†Œ&lt;/h4>
&lt;pre>&lt;code>docker run --rm -t -i -v /path/to/config:/etc/gitlab-runner --name gitlab-runner gitlab/gitlab-runner register \
--executor &amp;quot;docker&amp;quot; \
--docker-image alpine:3 \
--url &amp;quot;https://gitlab.com/&amp;quot; \
--registration-token &amp;quot;PROJECT_REGISTRATION_TOKEN&amp;quot; \
--description &amp;quot;docker-runner&amp;quot; \
--tag-list &amp;quot;dev&amp;quot; \
--run-untagged \
--locked=&amp;quot;true&amp;quot;
&lt;/code>&lt;/pre>&lt;p>ä¸Šé¢çš„ç¤ºä¾‹ä¸ºå°† runner æ³¨å†Œä¸ºä¸€ä¸ªå®¹å™¨ï¼Œ å½“ç„¶ å¤§å®¶ä¹Ÿå¯ä»¥ç›´æ¥åœ¨ç‰©ç†æœºä¸Šæ‰§è¡Œã€‚ åœ¨ç‰©ç†æœºä¸Šçš„æ³¨å†Œæ–¹å¼ä¸æ³¨å†Œä¸ºå®¹å™¨å¤§è‡´ç›¸åŒ&lt;/p>
&lt;pre>&lt;code>sudo gitlab-runner register \
--non-interactive \
--url &amp;quot;https://gitlab.com/&amp;quot; \
--registration-token &amp;quot;PROJECT_REGISTRATION_TOKEN&amp;quot; \
--executor &amp;quot;docker&amp;quot; \
--docker-image alpine:3 \
--description &amp;quot;docker-runner&amp;quot; \
--tag-list &amp;quot;docker,aws&amp;quot; \
--run-untagged \
--locked=&amp;quot;false&amp;quot; \
# ï¼ˆè¿™æ®µä»£ç æ¥è‡ªå®˜æ–¹æ–‡æ¡£ï¼‰
&lt;/code>&lt;/pre>&lt;p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹ runner çš„ç±»å‹ï¼Œ ä»¥ä¾¿åœ¨ä½¿ç”¨æ—¶è¿›è¡ŒåŒºåˆ†ã€‚&lt;/p>
&lt;h4 id="ç±»å‹">ç±»å‹&lt;/h4>
&lt;ul>
&lt;li>Shared - Runner runs jobs from all unassigned projects&lt;/li>
&lt;li>Group - Runner runs jobs from all unassigned projects in its group&lt;/li>
&lt;li>Specific - Runner runs jobs from assigned projects&lt;/li>
&lt;li>Locked - Runner cannot be assigned to other projects&lt;/li>
&lt;li>Paused - Runner will not receive any new jobs&lt;/li>
&lt;/ul>
&lt;h4 id="é…ç½®">é…ç½®&lt;/h4>
&lt;p>é¦–å…ˆæœ€å¤–å±‚çš„æ˜¯å…¨å±€é…ç½®ï¼Œ é»˜è®¤ä¼šæœ‰&lt;/p>
&lt;pre>&lt;code>concurrent = 1
check_interval = 0
&lt;/code>&lt;/pre>&lt;p>è¿™ä¸¤ä¸ªã€‚ æ¯”è¾ƒéœ€è¦å…³æ³¨çš„æ˜¯ä¸‹é¢å‡ ä¸ª&lt;/p>
&lt;h5 id="å…¨å±€é…ç½®">å…¨å±€é…ç½®&lt;/h5>
&lt;ul>
&lt;li>concurrent: å¹¶å‘æ•°, 0 ä¸ºæ— é™åˆ¶&lt;/li>
&lt;li>sentry_dsnï¼šä¸ Sentry è”åŠ¨ï¼Œå¯ä»¥å°†å¼‚å¸¸ç­‰æ”¶é›†è‡³ Sentry ä¸­ã€‚&lt;/li>
&lt;li>listen_address: æš´éœ²å‡º metrics ä¾› Prometheus ç›‘æ§&lt;/li>
&lt;/ul>
&lt;h4 id="executor">Executor&lt;/h4>
&lt;ul>
&lt;li>Shell&lt;/li>
&lt;li>Docker (æœ¬æ¬¡çš„åˆ†äº«å†…å®¹)&lt;/li>
&lt;li>Docker Machine and Docker Machine SSH (autoscaling)&lt;/li>
&lt;li>Parallels&lt;/li>
&lt;li>VirtualBox&lt;/li>
&lt;li>SSH&lt;/li>
&lt;li>Kubernetes (æ¨è)&lt;/li>
&lt;/ul>
&lt;h2 id="è¯¦è§£-docker-in-docker">è¯¦è§£ Docker In Docker&lt;/h2>
&lt;h3 id="æ¦‚è¿°">æ¦‚è¿°&lt;/h3>
&lt;p>Docker In Docker ç®€ç§° dindï¼Œåœ¨ GitLab CI çš„ä½¿ç”¨ä¸­ï¼Œå¯èƒ½ä¼šå¸¸è¢«ç”¨äº service çš„éƒ¨åˆ†ã€‚ dind è¡¨ç¤ºåœ¨ Docker ä¸­å®é™…è¿è¡Œäº†ä¸€ä¸ª Docker å®¹å™¨, æˆ– Docker daemonã€‚&lt;/p>
&lt;p>å…¶å®å¦‚æœåªæ˜¯åœ¨ Docker ä¸­æ‰§è¡Œ docker å‘½ä»¤ï¼Œ é‚£è£…ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶å³å¯ã€‚ ä½†æ˜¯å¦‚æœæƒ³è¦è¿è¡Œ Docker daemon (æ¯”å¦‚éœ€è¦æ‰§è¡Œ docker info)æˆ–è€…è®¿é—®ä»»æ„çš„è®¾å¤‡éƒ½æ˜¯ä¸å…è®¸çš„ã€‚&lt;/p>
&lt;p>Docker åœ¨ run å‘½ä»¤ä¸­æä¾›äº†ä¸¤ä¸ªå¾ˆé‡è¦çš„é€‰é¡¹ &lt;code>--privileged&lt;/code> å’Œ &lt;code>--device&lt;/code> ï¼Œ å¦å¤–çš„é€‰é¡¹æ¯”å¦‚ &lt;code>--cap-add&lt;/code> å’Œ &lt;code>--cap-drop&lt;/code> è·Ÿæƒé™ä¹Ÿå¾ˆç›¸å…³ï¼Œä¸è¿‡ä¸æ˜¯ä»Šå¤©çš„é‡ç‚¹ï¼ŒæŒ‰ä¸‹ä¸è¡¨ã€‚&lt;/p>
&lt;p>&lt;code>--device&lt;/code> é€‰é¡¹å¯ä»¥ä¾›æˆ‘ä»¬åœ¨ä¸ä½¿ç”¨ &lt;code>--privileged&lt;/code> é€‰é¡¹æ—¶ï¼Œè®¿é—®åˆ°æŒ‡å®šè®¾å¤‡, æ¯”å¦‚ &lt;code>docker run --device=/dev/sda:/dev/xvdc --rm -it ubuntu fdisk /dev/xvdc&lt;/code> ä½†æ˜¯è¿™ä¹Ÿåªæ˜¯æœ‰é™çš„æƒé™ï¼Œ æˆ‘ä»¬çŸ¥é“ docker çš„æŠ€æœ¯å®ç°å…¶å®æ˜¯åŸºäº cgroup çš„èµ„æºéš”ç¦»ï¼Œè€Œ &lt;code>--device&lt;/code> å´ä¸è¶³äºè®©æˆ‘ä»¬åœ¨å®¹å™¨å†…æœ‰è¶³å¤Ÿçš„æƒé™æ¥å®Œæˆ docker daemon çš„å¯åŠ¨ã€‚&lt;/p>
&lt;p>åœ¨ 2013å¹´ å·¦å³ï¼Œ --privileged é€‰é¡¹è¢«åŠ å…¥ dockerï¼Œ è¿™è®©æˆ‘ä»¬åœ¨å®¹å™¨å†…å¯åŠ¨å®¹å™¨å˜æˆäº†å¯èƒ½ã€‚ è™½ç„¶ --privileged çš„åˆå§‹æƒ³æ³•æ˜¯ä¸ºäº†èƒ½è®©å®¹å™¨å¼€å‘æ›´åŠ ä¾¿åˆ©ï¼Œä¸è¿‡æœ‰äº›äººåœ¨ä½¿ç”¨çš„æ—¶å€™ï¼Œå…¶å®å¯èƒ½æœ‰äº›è¯¯è§£ã€‚&lt;/p>
&lt;p>æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬å¯èƒ½åªæ˜¯æƒ³è¦èƒ½å¤Ÿåœ¨å®¹å™¨å†…æ­£å¸¸çš„build é•œåƒï¼Œæˆ–è€…æ˜¯ä¸ Docker daemon è¿›è¡Œäº¤äº’ï¼Œä¾‹å¦‚ docker images ç­‰å‘½ä»¤ã€‚ é‚£ä¹ˆï¼Œæˆ‘ä»¬å…¶å®ä¸éœ€è¦ dindï¼Œ æˆ‘ä»¬éœ€è¦çš„æ˜¯ Docker Out Of Dockerï¼Œå³ doodï¼Œåœ¨ä½¿ç”¨çš„æ—¶å€™ï¼Œå…¶å®æ˜¯å°† docker.sock æŒ‚è½½å…¥å®¹å™¨å†…&lt;/p>
&lt;p>ä¾‹å¦‚ï¼Œ ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š &lt;code>sudo docker run --rm -ti -v /var/run/docker.sock:/var/run/docker.sock taobeier/docker /bin/sh&lt;/code> åœ¨å®¹å™¨å†…å¯è¿›è¡Œæ­£å¸¸çš„docker images ç­‰æ“ä½œï¼Œ åŒæ—¶éœ€è¦æ³¨æ„ï¼Œåœ¨å®¹å™¨å†…çš„åŠ¨ä½œï¼Œå°†å½±å“åˆ°å®¿ä¸»æœºä¸Šçš„ docker daemonã€‚&lt;/p>
&lt;h3 id="å¦‚ä½•å®ç°">å¦‚ä½•å®ç°&lt;/h3>
&lt;ul>
&lt;li>åˆ›å»ºç»„å’Œç”¨æˆ·ï¼Œå¹¶å°†ç”¨æˆ·åŠ å…¥è¯¥ç»„ã€‚ ä½¿ç”¨ groupadd å’Œ useradd å‘½ä»¤&lt;/li>
&lt;li>æ›´æ–° subuid å’Œ subgid æ–‡ä»¶ï¼Œ å°†æ–°ç”¨æˆ·å’Œç»„é…ç½®åˆ° /etc/subgid å’Œ /etc/subuid æ–‡ä»¶ä¸­ã€‚ subuid å’Œ subgid è§„å®šäº†å…è®¸ç”¨æˆ·ä½¿ç”¨çš„ä»å±id&lt;/li>
&lt;li>æ¥ä¸‹æ¥éœ€è¦æŒ‚è½½ /sys/kernel/security ä¸º securityfs ç±»å‹å¯ä»¥ä½¿ç”¨ mountpoint å‘½ä»¤è¿›è¡Œæµ‹è¯• &lt;code>mountpoint /sys/kernel/security&lt;/code> å¦‚æœä¸æ˜¯ä¸€ä¸ªæŒ‚è½½ç‚¹ï¼Œ é‚£ä¹ˆä½¿ç”¨ &lt;code>mount -t securityfs none /sys/kernel/security&lt;/code> è¿›è¡ŒæŒ‚è½½ã€‚å¦‚æœæ²¡æœ‰æŒ‚è½½æˆåŠŸçš„è¯ï¼Œ å¯ä»¥æ£€æŸ¥æ˜¯å¦æ˜¯ SELinux æˆ–è€… AppArmor é˜»æ­¢äº†è¿™ä¸ªè¡Œä¸ºã€‚è¿™é‡Œè¯¦ç»†çš„å®‰å…¨é—®é¢˜ï¼Œå¯ä»¥å‚è€ƒ Linux Security Modules (LSM)&lt;/li>
&lt;li>æ¥ä¸‹æ¥å…è®¸ dockerd å‘½ä»¤å¯åŠ¨ daemon å³å¯ï¼Œ &lt;code>dockerd --host=unix:///var/run/docker.sock --host=tcp://0.0.0.0:2375&lt;/code> å³å¯å°†docker daemon ç›‘å¬è‡³ 2375 ç«¯å£&lt;/li>
&lt;/ul>
&lt;h3 id="ç®€å•åšæ³•">ç®€å•åšæ³•&lt;/h3>
&lt;p>å¯ä»¥ç›´æ¥ä½¿ç”¨ Docker å®˜æ–¹é•œåƒä»“åº“ä¸­çš„ docker:dind é•œåƒ, ä½†æ˜¯åœ¨è¿è¡Œæ—¶ï¼Œ éœ€è¦æŒ‡å®š &lt;code>--privileged&lt;/code> é€‰é¡¹&lt;/p>
&lt;h2 id="ci-å®è·µ">CI å®è·µ&lt;/h2>
&lt;h3 id="runner-å®è·µ">runner å®è·µ&lt;/h3>
&lt;p>çœ‹ runner éƒ¨åˆ†çš„é…ç½®&lt;/p>
&lt;pre>&lt;code>[[runners]]
name = &amp;quot;docker&amp;quot;
url = &amp;quot;https://gitlab.example.com/&amp;quot;
token = &amp;quot;TOKEN&amp;quot;
limit = 0
executor = &amp;quot;docker&amp;quot;
builds_dir = &amp;quot;&amp;quot;
shell = &amp;quot;&amp;quot;
environment = [&amp;quot;ENV=value&amp;quot;, &amp;quot;LC_ALL=en_US.UTF-8&amp;quot;]
clone_url = &amp;quot;http://172.17.0.4&amp;quot;
&lt;/code>&lt;/pre>&lt;p>ç”±äºç½‘ç»œåŸå› ï¼Œ clone_url å¯ä»¥é…ç½®ä¸ºå¯è®¿é—®çš„åœ°å€ï¼Œè¿™æ ·ä»£ç  clone çš„æ—¶å€™ï¼Œå°†ä¼šä½¿ç”¨é…ç½®çš„è¿™ä¸ªåœ°å€ã€‚å®é™…è¯·æ±‚ä¸º &lt;code>http://gitlab-ci-token:TOKEN@172.17.0.4/namespace/project.git&lt;/code>&lt;/p>
&lt;ul>
&lt;li>å†çœ‹ä¸€ä¸‹ runners.docker çš„é…ç½®ï¼Œè¿™éƒ¨åˆ†å°†å½±å“ docker çš„å®é™…è¿è¡Œ&lt;/li>
&lt;/ul>
&lt;pre>&lt;code>[runners.docker]
host = &amp;quot;&amp;quot;
hostname = &amp;quot;&amp;quot;
tls_cert_path = &amp;quot;/home/tao/certs&amp;quot;
image = &amp;quot;docker&amp;quot;
dns = [&amp;quot;8.8.8.8&amp;quot;]
privileged = false
userns_mode = &amp;quot;host&amp;quot;
devices = [&amp;quot;/dev/net/tun&amp;quot;]
disable_cache = false
wait_for_services_timeout = 30
cache_dir = &amp;quot;&amp;quot;
volumes = [&amp;quot;/data&amp;quot;, &amp;quot;/home/project/cache&amp;quot;]
extra_hosts = [&amp;quot;other-host:127.0.0.1&amp;quot;]
services = [&amp;quot;mongo&amp;quot;, &amp;quot;redis:3&amp;quot;]
allowed_images = [&amp;quot;go:*&amp;quot;, &amp;quot;python:*&amp;quot;, &amp;quot;java:*&amp;quot;]
&lt;/code>&lt;/pre>&lt;p>dns, privileged, extra_hosts, services æ¯”è¾ƒå…³é”®ï¼Œ å°¤å…¶æ˜¯åœ¨ç”Ÿäº§ä¸­ç½‘ç»œæƒ…å†µå¤šç§å¤šæ ·ï¼Œ éœ€è¦æ ¼å¤–å…³æ³¨ã€‚ è‡³äº devices é…ç½® ï¼Œåœ¨ä»Šå„¿åˆ†äº«çš„ä¸€å¼€å§‹å·²ç»è®²è¿‡äº†ï¼Œ allowed_images çš„è¯ï¼Œ æ˜¯åšäº†ä¸ªé™åˆ¶ã€‚&lt;/p>
&lt;p>ä¸Šé¢å‡ ä¸ªé…ç½®é¡¹ï¼Œ ç”¨è¿‡ docker çš„åŒå­¦ï¼Œåº”è¯¥å¾ˆå®¹æ˜“ç†è§£ã€‚ æˆ‘ä»¬æ¥çœ‹ä¸‹ services è¿™ä¸ªé…ç½®é¡¹&lt;/p>
&lt;pre>&lt;code>image: registry.docker-cn.com/taobeier/docker
variables:
DOCKER_DRIVER: overlay2 # overlay2 is best bug need kernel &amp;gt;= 4.2
services:
- name: registry.docker-cn.com/taobeier/docker:stable-dind
alias: docker
stages:
- build
- deploy
build_and_test:
stage: build
tags:
- build
script:
# change repo
#- sed -i 's/dl-cdn.alpinelinux.org/mirrors.ustc.edu.cn/g' /etc/apk/repositories
# ä½¿ç”¨é»˜è®¤å®˜æ–¹æº apk è€—æ—¶ 7min 30s. ä¿®æ”¹å è€—æ—¶ 18s
- ping -c 1 docker
- ping -c 1 registry.docker-cn.com__taobeier__docker
- ipaddr
- apk add --no-cache py-pip
# ä½¿ç”¨é»˜è®¤è€—æ—¶ 1 min 15s. ä¿®æ”¹åè€—æ—¶ 43s
- pip install -i https://mirrors.ustc.edu.cn/pypi/web/simple docker-compose
- docker-compose up -d
- docker-compose run --rm web pytest -s -v tests/test_session.py
deploy:
image: &amp;quot;registry.docker-cn.com/library/centos&amp;quot;
stage: deploy
tags:
- deploy
script:
# install ssh client
- 'ssh-agent || (yum install -y openssh-clients)'
# run ssh-agent
- eval $(ssh-agent -s)
- echo &amp;quot;$SSH_PRIVATE_KEY&amp;quot; | tr -d '\r' | ssh-add - &amp;gt; /dev/null
# create ssh dir
- mkdir -p ~/.ssh
- chmod 700 ~/.ssh
# use ssh-keyscan to get key
- ssh-keyscan -p $SSH_PORT $DEPLOY_HOST &amp;gt;&amp;gt; ~/.ssh/known_hosts
- chmod 644 ~/.ssh/known_hosts
# - ssh -p $SSH_PORT $DEPLOY_USER@$DEPLOY_HOST ls
- rm -rf .git
- scp -r -P $SSH_PORT . $DEPLOY_USER@$DEPLOY_HOST:~/we/
&lt;/code>&lt;/pre>&lt;p>services çš„æœ¬è´¨å…¶å®æ˜¯ä½¿ç”¨äº† docker çš„ --link ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹å®ƒå¦‚ä½•å·¥ä½œ&lt;/p>
&lt;h3 id="docker-executor-å¦‚ä½•å·¥ä½œ">Docker Executor å¦‚ä½•å·¥ä½œ&lt;/h3>
&lt;ul>
&lt;li>åˆ›å»º service å®¹å™¨ (å·²ç»é…ç½®åœ¨ service ä¸­çš„é•œåƒ)&lt;/li>
&lt;li>åˆ›å»º cache å®¹å™¨ (å­˜å‚¨å·²ç»é…ç½®åœ¨ config.toml çš„å·å’Œæ„å»ºé•œåƒçš„ Dockerfile)&lt;/li>
&lt;li>åˆ›å»º build å®¹å™¨ å¹¶ä¸” link æ‰€æœ‰çš„ service å®¹å™¨.&lt;/li>
&lt;li>å¯åŠ¨ build å®¹å™¨ å¹¶ä¸”å‘é€ job è„šæœ¬åˆ°è¯¥å®¹å™¨ä¸­.&lt;/li>
&lt;li>æ‰§è¡Œ job çš„è„šæœ¬.&lt;/li>
&lt;li>æ£€å‡ºä»£ç : /builds/group-name/project-name/.&lt;/li>
&lt;li>æ‰§è¡Œ .gitlab-ci.yml ä¸­å®šä¹‰çš„æ­¥éª¤.&lt;/li>
&lt;li>æ£€æŸ¥è„šæœ¬æ‰§è¡Œåçš„çŠ¶æ€ç ï¼Œå¦‚æœé 0 åˆ™æ„å»ºå¤±è´¥.&lt;/li>
&lt;li>ç§»é™¤ build å’Œ service å®¹å™¨.&lt;/li>
&lt;/ul>
&lt;h3 id="ç§æœ‰é•œåƒæº">ç§æœ‰é•œåƒæº&lt;/h3>
&lt;p>ç”¨æˆ·è®¤è¯éœ€è¦ GitLab Runner 1.8 æˆ–æ›´é«˜ç‰ˆæœ¬ï¼Œåœ¨ 0.6 ~ 1.8 ç‰ˆæœ¬ä¹‹é—´çš„ Runner éœ€è¦è‡ªè¡Œå» Runner çš„æœºå™¨ä¸Šæ‰‹åŠ¨æ‰§è¡Œã€‚&lt;/p>
&lt;p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœè®¿é—®çš„é•œåƒä»“åº“éœ€è¦è®¤çœŸçš„è¯ï¼Œ GitLab Runner ä¼šä½¿ç”¨ DOCKER_AUTH_CONFIG å˜é‡çš„ä½œä¸ºè®¤è¯çš„å‡­è¯ã€‚&lt;/p>
&lt;p>æ³¨æ„ï¼šDOCKER_AUTH_CONFIG æ˜¯å®Œæˆçš„ docker auth å‡­è¯ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒåº”è¯¥å’Œæˆ‘ä»¬ ~/.docker/config.json ä¸­çš„å†…å®¹ä¸€è‡´ï¼Œä¾‹å¦‚ï¼š&lt;/p>
&lt;pre>&lt;code>{
&amp;quot;auths&amp;quot;: {
&amp;quot;registry.example.com&amp;quot;: {
&amp;quot;auth&amp;quot;: &amp;quot;5oiR5piv5byg5pmL5rab&amp;quot;
}
}
}
&lt;/code>&lt;/pre>&lt;p>ç®€å•çš„åšæ³•å°±æ˜¯ï¼Œæˆ‘ä»¬åœ¨æœ¬åœ°/æœåŠ¡å™¨ä¸Šæ‰§è¡Œ &lt;code>docker login ç§æœ‰é•œåƒæº&lt;/code> ç™»å½•æˆåŠŸåï¼Œå°† ~/.docker/config.json çš„æ–‡ä»¶å†…å®¹ç›´æ¥å¤åˆ¶ï¼Œä½œä¸ºæˆ‘ä»¬çš„å˜é‡çš„å€¼, æˆ–è€…æ˜¯ &lt;code>echo -n 'ç”¨æˆ·å:å¯†ç ' | base64&lt;/code> ä»¥è¿™æ ·çš„æ–¹å¼æ¥è·å¾— auth çš„å†…å®¹ï¼Œç»„è£…æˆå¯¹åº”çš„æ ¼å¼ï¼Œå†™å…¥ GitLab çš„ value é…ç½®ä¸­ã€‚&lt;/p>
&lt;h2 id="ç”Ÿäº§ç¯å¢ƒä¸­çš„-ci-æ€§èƒ½ä¼˜åŒ–">ç”Ÿäº§ç¯å¢ƒä¸­çš„ CI æ€§èƒ½ä¼˜åŒ–&lt;/h2>
&lt;ol>
&lt;li>
&lt;p>ä½¿ç”¨å›½å†…æºå¯¹å®¹å™¨é•œåƒè¿›è¡ŒåŠ é€Ÿ ä¾‹å¦‚ï¼šä½¿ç”¨ Docker ä¸­å›½å®˜æ–¹é•œåƒåŠ é€ŸæœåŠ¡ &lt;a href="https://registry.docker-cn.com">https://registry.docker-cn.com&lt;/a> å½“ç„¶å„å®¶å…¬å¸å…¶å®ä¹Ÿæœ‰æä¾›é•œåƒåŠ é€Ÿçš„æœåŠ¡ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä½¿ç”¨ç§æœ‰é•œåƒä»“åº“ã€‚ä¾‹å¦‚ Docker Registry, æˆ–è€… Harbor, æˆ‘ä»¬æ˜¯åœ¨ä½¿ç”¨ Harbor ä½œä¸ºç§æœ‰é•œåƒä»“åº“çš„ã€‚&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>å› ä¸ºç½‘ç»œçš„åŸå› ï¼Œ å¦‚æœé»˜è®¤ä½¿ç”¨å®˜æ–¹é•œåƒï¼Œ 1. å®˜æ–¹é•œåƒæ‹‰ä¸ä¸‹æ¥ï¼›2. åœ¨å®˜æ–¹é•œåƒä¸­å®‰è£…åŒ…è€—æ—¶é•¿ï¼›3. å¦‚æœæ¢æºï¼Œéœ€è¦æ¯ä¸ª Dockerfile éƒ½è¦åšç›¸åŒçš„äº‹æƒ…ã€‚ è¿™æˆ‘ä»¬å½“ç„¶æ˜¯ä¸èƒ½åŒæ„çš„ã€‚ æ‰€ä»¥ï¼Œæˆ‘ä»¬æ„å»ºäº†è‡ªå·±çš„ç§æœ‰é•œåƒã€‚ ä» BusyBox å¼€å§‹, æ„å»º Alpine Linux ä½¿ç”¨ç§æœ‰æºï¼Œ ä»¥æ­¤ä¸ºåŸºç¡€ æ„å»ºæˆ‘ä»¬æ‰€éœ€è¦çš„å…¶ä»–é•œåƒã€‚ ç”¨æˆ·ä¸å†éœ€è¦è‡ªè¡Œæ¢æºã€‚&lt;/p>
&lt;p>è¿™ä¸ªæ“ä½œå®Œæˆåï¼Œ åŸå…ˆæˆ‘ä»¬éœ€è¦åœ¨ CI æ‰§è¡Œçš„è¿‡ç¨‹ä¸­å®‰è£… py-pipï¼ˆä¸ºäº†å®‰è£… docker-compose å’Œæˆ‘ä»¬çš„æœåŠ¡ä¾èµ–ï¼‰è€—æ—¶ä» 3min30s å‡å°‘åˆ°äº† 18sã€‚&lt;/p>
&lt;p>è¿™é‡Œï¼Œéœ€è¦è¯´ä¸‹ä¸ºä½•æˆ‘ä»¬æ˜¯ä»å¤´å¼€å§‹æ„å»ºé•œåƒï¼Œè€Œä¸æ˜¯åŸºäºå®˜æ–¹é•œåƒã€‚ ä¸»è¦æ˜¯ä¸ºäº†å‡å°‘é•œåƒä½“ç§¯ ä»¥åŠä¸ºäº†æ›´å¿«çš„é€‚ç”¨äºæˆ‘ä»¬çš„éœ€æ±‚ã€‚&lt;/p>
&lt;p>åŒæ ·çš„ï¼Œæˆ‘ä»¬æ„å»ºäº†åŸºç¡€çš„ Docker é•œåƒï¼ŒPython/Maven ç­‰é•œåƒï¼Œéƒ½æ˜¯é»˜è®¤ä½¿ç”¨äº†æˆ‘ä»¬çš„ç§æœ‰æºï¼Œå¹¶ä¸”ï¼Œç”¨æˆ·åœ¨ä½¿ç”¨æ—¶ï¼Œ å¹¶ä¸éœ€è¦å…³æ³¨æ¢æºçš„äº‹æƒ…ï¼Œ å‡å°‘ç”¨æˆ·çš„å¿ƒæ™ºè´Ÿæ‹…ã€‚&lt;/p>
&lt;ol start="3">
&lt;li>
&lt;p>è§„èŒƒ Dockerfileï¼Œ å‡å°‘ä¸å¿…è¦çš„ä¾èµ–å®‰è£…, å‡å°‘é•œåƒä½“ç§¯ã€‚å…¶å®ç»“åˆä¸Šé¢çš„éƒ¨åˆ†ï¼Œæˆ‘ä»¬åšçš„äº‹æƒ…æ˜¯ç›´æ¥æ„å»ºäº†æˆ‘ä»¬çš„åŸºç¡€é•œåƒ docker/alpine/mavenä¹‹ç±»çš„åŸºç¡€é•œåƒï¼Œé»˜è®¤ç›´æ¥éƒ½æ¢äº†æºã€‚è¿™æ ·æ—¢æ–¹ä¾¿ä½¿ç”¨ï¼Œè¿˜å¯ä»¥å‡å°‘é•œåƒå±‚æ•°ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æ‹†åˆ† jobï¼Œ é€šè¿‡ tag çš„æ–¹å¼å¯æŒ‡å®šrunnerï¼Œ ç”±ä¸åŒçš„ runner æ¥å¹¶è¡Œæ‰§è¡Œæ— å¼ºä¾èµ–çš„ä¸€äº›åŠ¨ä½œã€‚ ä¾¿äºåˆ†æ‘Šå‹åŠ›ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä½¿ç”¨ Cache, CI çš„æ„å»ºä¸­ï¼Œå¤§å¤šæ•°çš„é•œåƒï¼Œå…¶å®å˜åŒ–ä¸å¤§ï¼Œæ‰€ä»¥ä½¿ç”¨cache å¯ä»¥æˆå€çš„æå‡ CI çš„é€Ÿåº¦ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¯èƒ½é‡åˆ°çš„å‘&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>å‰é¢æåˆ°äº† service ä¸­å¯ä»¥ä½¿ç”¨å„ç§å„æ ·çš„æœåŠ¡ï¼Œ æ— è®ºæ˜¯ dind è¿˜æ˜¯ mysql redis ç­‰ã€‚ ä½†æ˜¯ å¦‚æœæˆ‘ä»¬å…¨éƒ¨åšåˆ°äº†ä¼˜åŒ–ï¼Œéƒ½ä½¿ç”¨æˆ‘ä»¬çš„ç§æœ‰æºï¼Œ é‚£ä¾¿ä¼šå‘ç°é—®é¢˜ã€‚&lt;/p>
&lt;p>å› ä¸º gitlab ci é»˜è®¤å¯¹äº &lt;code>docker:dind&lt;/code> çš„ service å…¶å®ä¼šé€‰æ‹©è¿åä¸º docker çš„ host ï¼Œä»¥åŠ 2375 ç«¯å£ã€‚ å½“ä½¿ç”¨ç§æœ‰é•œåƒæºçš„æ—¶å€™ï¼Œ æ¯”å¦‚&lt;/p>
&lt;pre>&lt;code>services:
- name: registry.docker-cn.com/taobeier/docker:stable-dind
&lt;/code>&lt;/pre>&lt;p>é‚£è¿™ä¸ª service çš„ host æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ&lt;/p>
&lt;p>è¿™ä¸ª service çš„ host å…¶å®æ˜¯ä¼šå˜æˆ &lt;code>registry.docker-cn.com__taobeier__docker&lt;/code> ï¼Œç„¶å gitlab runner ä¾¿ä¼šæ‰¾ä¸åˆ°ï¼Œ job å°±ä¼šæ‰§è¡Œå¤±è´¥&lt;/p>
&lt;p>æœ‰ä¸¤ç§è§£å†³åŠæ³•ã€‚ ä¸€ç§æ˜¯åŠ ä¸€ä¸ªå˜é‡&lt;/p>
&lt;pre>&lt;code>variables:
DOCKER_HOST: &amp;quot;tcp://registry.docker-cn.com__taobeier__docker:2375&amp;quot;
&lt;/code>&lt;/pre>&lt;p>ä½†æ˜¯ è¿™ç§æ–¹å¼ å¾ˆéº»çƒ¦ï¼Œ æ²¡æœ‰äººèƒ½å®Œå…¨è®°ä½ é‡åˆ° / ä¼šè½¬æ¢ä¸º _ éš¾å…ä¼šæœ‰é—®é¢˜ã€‚ é‚£ä¹ˆå°±æœ‰äº†ç¬¬äºŒç§åŠæ³•ï¼š&lt;/p>
&lt;pre>&lt;code>services:
- name: registry.docker-cn.com/taobeier/docker:stable-dind
- alias: docker
&lt;/code>&lt;/pre>&lt;p>åŠ ä¸€ä¸ª alias ã€‚ è¿™ä¸ªæ–¹æ³•ç›®å‰å¾ˆå°‘äººåœ¨ç”¨ï¼Œ æ¯•ç«Ÿç½‘ç»œä¸ŠæŸ¥åˆ°çš„éƒ½æ˜¯ç¬¬ä¸€ç§ ï¼Œä½†æ˜¯è¿™ä¸ªæ–¹å¼å´æ˜¯æœ€ç®€å•çš„ã€‚&lt;/p>
&lt;h2 id="qa">Q&amp;amp;A&lt;/h2>
&lt;p>Qï¼šæ‚¨æåˆ°æŠŠå„ç§ä¾èµ–éƒ½ä»¥ Service çš„æä¾›ï¼Œè¯·é—®æ˜¯ä»¥å“ªç§æ–¹å¼å‘¢ï¼Ÿ æ¯”å¦‚Pythonçš„ä¾èµ–ï¼Œæ€ä¹ˆåšæˆServiceå‘¢ï¼Ÿ&lt;/p>
&lt;p>Aï¼šService åŒ–çš„ä¾èµ–ï¼Œä¸»è¦æ˜¯æŒ‡ç±»ä¼¼ DB / MySQL/ Reids ä¹‹ç±»çš„ã€‚ æˆ–è€…æ˜¯ dind å…¶å®å®ƒæä¾›çš„æ˜¯ 2375 ç«¯å£çš„TCPæœåŠ¡ã€‚ Python çš„ä¾èµ–ï¼Œæˆ‘æ¨èçš„åšæ³•æ˜¯ï¼Œ æ„å»ºä¸€ä¸ªæ¢äº†æºçš„ Python é•œåƒã€‚ å®‰è£…ä¾èµ–çš„æ—¶å€™ï¼Œè€—æ—¶ä¼šå°‘å¾ˆå¤šã€‚ æˆ–è€…è¯´ï¼Œ å¯ä»¥åœ¨å®šä¹‰ Pipeline çš„æ—¶å€™ï¼Œ å°†è™šæ‹Ÿç¯å¢ƒçš„ venv æ–‡ä»¶å¤¹ä½œä¸º cache ï¼Œä¹‹åçš„å®‰è£…ä¹Ÿä¼šæ£€æŸ¥è¿™ä¸ªï¼Œé¿å…ä¸å¿…è¦çš„å®‰è£…ã€‚&lt;/p>
&lt;p>Qï¼šè¯·é—®ï¼Œä½ ä»¬ä¸ºä»€ä¹ˆä¸ç”¨Jenkins Pipelineï¼Œè€Œä½¿ç”¨GitLab CIï¼Ÿ&lt;/p>
&lt;p>Aï¼šä¸»è¦åŸå› æ˜¯æˆ‘æåˆ°çš„é‚£å‡ ä¸ªæ–¹é¢ã€‚ é›†æˆè¾ƒå¥½ï¼Œ ç•Œé¢ç¾è§‚ä¼˜é›…ï¼Œ ä½¿ç”¨ç®€å•ï¼ˆæ‰€æœ‰æœ‰ä»“åº“å†™æƒé™çš„äºº éƒ½å¯ä»¥ä½¿ç”¨ï¼Œ åªè¦åˆ›å»º .gitlab-ci.yml å¹¶ä¸”é…ç½®äº† Runner å³å¯ä½¿ç”¨ï¼‰ ã€‚æ¢ä¸ªè§’åº¦ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹ä½¿ç”¨Jenkins çš„é—®é¢˜ï¼Œ Jenkins å¯¹äºé¡¹ç›®çš„é…ç½®å…¶å®å’Œ GitLab çš„ä»£ç æ˜¯åˆ†ç¦»çš„ï¼Œ ä¸¤éƒ¨åˆ†çš„ï¼Œ ç”¨æˆ·ï¼ˆæˆ–è€…è¯´æˆ‘ä»¬çš„å¼€å‘è€…ï¼‰åœ¨ä½¿ç”¨çš„æ—¶å€™ï¼Œ éœ€è¦æœ‰ä¸¤ä¸ªå¹³å°ï¼Œ å¹¶ä¸”ï¼Œå¤§å¤šæ•°æ—¶å€™ï¼Œ Jenkins çš„æƒé™æ˜¯ä¸æ”¾å¼€çš„ã€‚ å¯¹ç”¨æˆ·æ¥è®²ï¼Œ é‚£ç›¸å½“äºæ˜¯ä¸ªé»‘ç›’ã€‚ é‚£å¯èƒ½çš„é—®é¢˜æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ é‡åˆ°æ„å»ºå¤±è´¥äº†ï¼Œ ä½†æ˜¯åªæœ‰è¿ç»´çŸ¥é“å‘ç”Ÿäº†ä»€ä¹ˆï¼Œä½†æ˜¯ç ”å‘æ— èƒ½ä¸ºåŠ›ï¼Œå› ä¸ºæ²¡æœ‰æƒé™ã€‚ ä½¿ç”¨GItLabçš„å¥½å¤„ï¼Œè¿™ä¸ªæ—¶å€™å°±æ›´åŠ çªå‡ºäº†ï¼Œ é…ç½®å°±åœ¨ä»£ç ä»“åº“é‡Œé¢ï¼Œå¹¶ä¸”ä½¿ç”¨ YAML çš„é…ç½®ï¼Œå¾ˆç®€å•ã€‚ æœ‰å•¥é—®é¢˜ï¼Œç›´æ¥æŸ¥ï¼Œç›´æ¥æ”¹ã€‚&lt;/p>
&lt;p>Qï¼šå…³äº Runner çš„æ¸…ç†çš„é—®é¢˜ï¼Œåœ¨é•¿æ—¶é—´ä½¿ç”¨åï¼ŒRunner æœºå™¨ä¸Šå›äº§ç”Ÿå¾ˆå¤šçš„ Cache å®¹å™¨ï¼Œå¦‚ä½•æ¸…ç†å‘¢ã€‚èƒ½å¤Ÿåœ¨ä»»åŠ¡ä¸­è‡ªåŠ¨æ¸…é™¤å—ï¼Ÿ&lt;/p>
&lt;p>Aï¼šè¿™ä¸ªå°±ç›¸å¯¹ç®€å•äº†ï¼Œé¦–å…ˆï¼Œ å¦‚æœä½ çš„ Cache å®¹å™¨ç¡®è®¤æ²¡ç”¨äº†ï¼Œ æ¯ä¸ª Cache å®¹å™¨å…¶å®éƒ½æœ‰åå­—çš„ï¼Œ ç›´æ¥æŒ‰ Cache çš„åå­—è¿‡ç•¥ï¼Œ æ‰¹é‡åˆ æ‰ã€‚ å¦‚æœä½ ä¸ç¡®å®šå®ƒæ˜¯å¦æœ‰ç”¨ï¼Œé‚£ä½ ç›´æ¥åˆ æ‰ä¹Ÿæ˜¯ä¸å½±å“çš„ï¼Œ å› ä¸º Docker Excutor çš„æ‰§è¡Œæœºåˆ¶æ˜¯åˆ›å»ºå®Œ Service å®¹å™¨åï¼Œ åˆ›å»º Cache å®¹å™¨ã€‚ è¦æ˜¯åˆ æ‰äº†ï¼Œå®ƒåªæ˜¯ä¼šå†åˆ›å»ºä¸€æ¬¡ã€‚ å¦‚æœä½ æƒ³åœ¨ä»»åŠ¡ä¸­æ¸…é™¤ï¼Œ ç›®å‰è¿˜æ²¡åšç›¸å…³çš„å®è·µï¼Œå¾…æˆ‘å®è·µåï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰å¾ˆä¼˜é›…çš„æ–¹å¼ã€‚&lt;/p>
&lt;p>Qï¼šè¯·é—®ä¸‹Mavençš„settings.xmlæ€ä¹ˆå¤„ç†ï¼Ÿæœ¬åœ°Mavenä»“åº“å‘¢ï¼Ÿ&lt;/p>
&lt;p>Aï¼šæˆ‘ä»¬æ„å»ºäº†ç§æœ‰çš„ Maven é•œåƒï¼Œ ç§æœ‰é•œåƒä¸­æ˜¯é»˜è®¤ä½¿ç”¨äº†æˆ‘ä»¬çš„ç§æœ‰æºã€‚ å¯¹äºé¡¹ç›®ä¸­ç”¨æˆ·æ— éœ€å…³æ³¨ settings.xml ä¸­æ˜¯å¦é…ç½®repoã€‚&lt;/p>
&lt;p>Qï¼šåœ¨GitLabçš„CDæ–¹æ¡ˆä¸­ï¼Œåœ¨éƒ¨ç½²çš„æ—¶å€™ï¼Œéœ€è¦åœ¨å˜é‡ä¸­é…ç½®è·³æ¿æœºçš„ç§é’¥ï¼Œå¦‚æœè¿™ä¸ªé¡¹ç›®æ˜¯å¯¹å…¬å¸æ•´éƒ¨é—¨å¼€å‘ï¼Œé‚£ä¹ˆå¦‚ä½•ä¿æŠ¤è¿™ä¸ªç§é’¥å‘¢ï¼Ÿ&lt;/p>
&lt;p>Aï¼šå¯ä»¥ä½¿ç”¨ secret variable å°†ç§é’¥å†™å…¥å…¶ä¸­ï¼Œ ï¼ˆä½†æ˜¯é¡¹ç›®çš„ç®¡ç†å‘˜ï¼Œå…·å¤‡æŸ¥çœ‹è¯¥ variable çš„æƒé™ï¼‰å¼€å‘ä¸€ä¸ª web server ï¼ˆå…¶å®åªè¦æš´éœ² IP ç«¯å£ä¹‹ç±»çš„å°±å¯ä»¥ï¼‰ åœ¨ CI æ‰§è¡Œçš„è¿‡ç¨‹ä¸­å»è¯·æ±‚ï¼Œ server å¯¹æ¥æºåšåˆ¤æ–­ ï¼ˆæ¯”å¦‚ æ‰§è¡ŒCI çš„æ—¶å€™ï¼Œä¼šæœ‰ä¸€äº›ç‰¹å®šçš„å˜é‡ï¼Œä»¥æ­¤æ¥åˆ¤æ–­ï¼Œæ˜¯å¦çœŸçš„æ˜¯ CI åœ¨è¯·æ±‚ï¼‰ç„¶åè¿”å›ç§é’¥ã€‚&lt;/p>
&lt;p>Qï¼šGitLab CIé€‚åˆä»€ä¹ˆç±»å‹çš„é¡¹ç›®å‘¢ï¼Ÿå›½å†…ç›®å‰è¿˜æ¯”è¾ƒå°ä¼—å§ï¼Ÿ&lt;/p>
&lt;p>Aï¼šå›½å†…ç›®å‰è¿˜è¾ƒä¸ºå°ä¼—ï¼ˆç›¸æ¯” Jenkins æ¥è¯´ï¼‰å…¶å®åªè¦éœ€è¦ CI çš„é¡¹ç›®ï¼Œå®ƒéƒ½é€‚åˆã€‚&lt;/p>
&lt;hr>
&lt;p>å¯ä»¥é€šè¿‡ä¸‹é¢äºŒç»´ç è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/DevOps/">DevOps</category><category domain="https://moelove.info/tags/CI/">CI</category><category domain="https://moelove.info/tags/GitLab/">GitLab</category></item><item><title>Install-Python3.6-on-CentOS7</title><link>https://moelove.info/2017/06/30/Install-Python3.6-on-CentOS7/</link><guid isPermaLink="true">https://moelove.info/2017/06/30/Install-Python3.6-on-CentOS7/</guid><pubDate>Fri, 30 Jun 2017 00:13:16 +0000</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>æ‹–äº†å¾ˆä¹…æ²¡æœ‰æ›´æ–°ï¼ŒæŠ±æ­‰å•¦~ ä»Šå¤©å—é‚€å†™ç¯‡å¦‚ä½•åœ¨ CentOS 7 ä¸Šé…ç½® Python 3 ç¯å¢ƒçš„æ–‡ç« ã€‚å¾€å¸¸æˆ‘éƒ½é€‰æ‹©ç›´æ¥æŠŠæˆ‘æ—©å¹´å†™çš„ä¸€ç¯‡æ–‡ç« &lt;a href="http://moelove.info/2015/09/13/%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91MongoDB/">æºç ç¼–è¯‘MongoDB&lt;/a>ä¸¢è¿‡å»ï¼Œè®©ä»–ä»¬çœ‹å…¶ä¸­çš„æºç ç¼–è¯‘ Python é‚£ä¸€èŠ‚ï¼Œä¸è¿‡é‚£èŠ‚å†™çš„å…¶å®ä¸å¤ªè¯¦ç»†ï¼Œè€Œä¸”æœ€è¿‘è¢«å¾ˆå¤šäººå‚¬ï¼Œæ‰€ä»¥è¿˜æ˜¯å•ç‹¬å†™ä¸€ç¯‡å¥½äº†ã€‚&lt;/p>
&lt;/blockquote>
&lt;p>å½“å‰æœ€æ–°çš„ CentOS 7.3 é»˜è®¤å®‰è£…çš„æ˜¯ Python 2 ï¼Œå¹¶ä¸”é»˜è®¤çš„å®˜æ–¹ &lt;code>yum&lt;/code> æºä¸­ä¸æä¾› Python 3 çš„å®‰è£…åŒ…ã€‚æœ‰äº›ç”¨æˆ·æƒ³è¦å‡çº§ä½¿ç”¨ Python 3 ä½†å®é™…å¯èƒ½æœ‰å„ç§å„æ ·çš„é—®é¢˜ï¼Œå¯¼è‡´å‡ºé”™ï¼Œåè§‚ä¸€ä¸‹æ¿€è¿›çš„ Fedora ç¤¾åŒºï¼Œåœ¨23çš„æ—¶å€™ï¼Œå°±å°†é»˜è®¤çš„ç‰ˆæœ¬ä¿®æ”¹æˆäº† Python3 ï¼ˆå¦‚æœæˆ‘æ²¡è®°é”™çš„è¯ï¼‰ã€‚&lt;/p>
&lt;p>å…ˆè¯´ä¸‹æˆ‘æ‰€ä½¿ç”¨çš„ç³»ç»Ÿç¯å¢ƒï¼Œ ä¸€ä¸ªæ–°åˆ›å»ºçš„ Docker å®¹å™¨ã€‚ ä½¿ç”¨ &lt;code>cat /etc/redhat-release&lt;/code> å¯ä»¥çœ‹åˆ°è¿è¡Œçš„æ˜¯ CentOS 7.3 ç‰ˆæœ¬ã€‚&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/systemInfo.png" alt="systeminfo">&lt;/p>
&lt;p>åœ¨çº¯å‡€çš„ CentOS ç³»ç»Ÿä¸Šå®‰è£… Python ç¯å¢ƒä¸»è¦æœ‰ä¸¤ç§åŠæ³•ã€‚ ä¸€ç§æ˜¯é€šè¿‡æºç ç¼–è¯‘å®‰è£…ï¼Œå¦å¤–ä¸€ç§å°±æ˜¯å®‰è£…å·²ç»æ‰“å¥½çš„ RPM åŒ…ã€‚ä¾ç…§ä¸ªäººä¹ æƒ¯ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹å¦‚ä½•é€šè¿‡æºç ç¼–è¯‘çš„æ–¹å¼å®‰è£… Python 3.6 å¹¶ä¸”é…ç½®è™šæ‹Ÿç¯å¢ƒã€‚&lt;/p>
&lt;h1 id="ä½¿ç”¨æºç è¿›è¡Œç¼–è¯‘å®‰è£…">ä½¿ç”¨æºç è¿›è¡Œç¼–è¯‘å®‰è£…&lt;/h1>
&lt;h2 id="åŸºç¡€ç¯å¢ƒ">åŸºç¡€ç¯å¢ƒ&lt;/h2>
&lt;ul>
&lt;li>å…ˆå®‰è£…å®‰è£…å‡ ä¸ªå¿…é¡»çš„åŒ…ï¼Œä»¥æ–¹ä¾¿åç»­çš„æ“ä½œ&lt;/li>
&lt;/ul>
&lt;pre>&lt;code>âœ yum install wget gcc make
âœ # wget ç”¨äºä¸‹è½½æºç åŒ…
âœ # gcc å’Œ make ç”¨äºç¼–è¯‘
&lt;/code>&lt;/pre>&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/install_gcc_wget.png" alt="install_gcc_wget">&lt;/p>
&lt;ul>
&lt;li>ä¸Š &lt;a href="https://www.python.org/">Pythonçš„å®˜ç½‘&lt;/a> ä¸‹è½½æºç åŒ…&lt;/li>
&lt;/ul>
&lt;pre>&lt;code>âœ wget https://www.python.org/ftp/python/3.6.1/Python-3.6.1.tar.xz
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>è§£åŒ…ï¼Œè§£å‹ç¼©&lt;/li>
&lt;/ul>
&lt;pre>&lt;code>âœ xz -d Python-3.6.1.tar.xz
âœ tar -xvf Python-3.6.1.tar
&lt;/code>&lt;/pre>&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/decompress_archives.png" alt="decompress_archives">&lt;/p>
&lt;ul>
&lt;li>ç¼–è¯‘&lt;/li>
&lt;/ul>
&lt;pre>&lt;code>âœ cd Python-3.6.1
âœ ./configure --prefix=/usr/local/python3.6 --enable-optimizations
âœ
&lt;/code>&lt;/pre>&lt;p>å…ˆè§£é‡Šä¸‹ä¸Šé¢çš„å‚æ•°ï¼Œ&lt;code>--prefix&lt;/code> æ˜¯é¢„æœŸå®‰è£…ç›®å½•ï¼Œ&lt;code>--enable-optimizations&lt;/code> æ˜¯ä¼˜åŒ–é€‰é¡¹ï¼ˆLTOï¼ŒPGO ç­‰ï¼‰åŠ ä¸Šè¿™ä¸ª flag ç¼–è¯‘åï¼Œæ€§èƒ½æœ‰ 10% å·¦å³çš„ä¼˜åŒ–ï¼ˆå¦‚æœæ²¡è®°é”™çš„è¯ï¼‰ï¼Œä½†æ˜¯è¿™ä¼šæ˜æ˜¾çš„å¢åŠ ç¼–è¯‘æ—¶é—´ã€‚ä¸è¿‡å…³äº LTO å’Œ PGO å…¶å®ä¸åœ¨ä»Šå¤©æ–‡ç« çš„è®¨è®ºèŒƒå›´å†…ï¼Œå»ºè®®æ„Ÿå…´è¶£çš„å¯ä»¥çœ‹çœ‹ &lt;a href="https://gcc.gnu.org/onlinedocs/gccint/LTO-Overview.html">GCC ä¸­ LTO çš„å…·ä½“å®ç°&lt;/a>ã€‚æˆ‘åº”è¯¥ä¸å¤ªå¯èƒ½å»å†™ç›¸å…³çš„æ–‡ç«  å“ˆå“ˆå“ˆ æ¯•ç«Ÿå†™èµ·æ¥å°±ä¼šåœä¸ä¸‹æ¥ã€‚&lt;/p>
&lt;p>æ¥ä¸‹æ¥&lt;/p>
&lt;pre>&lt;code>âœ make
âœ make install
&lt;/code>&lt;/pre>&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/make_error.png" alt="make_error">&lt;/p>
&lt;p>å¦‚å›¾ï¼Œä¼šçœ‹åˆ°å‡ºé”™äº†ï¼Œæç¤º &lt;code>zlib not available&lt;/code> æ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦è£…ä¸€ä¸‹ä¾èµ–&lt;/p>
&lt;pre>&lt;code>âœ yum install zlib-devel
&lt;/code>&lt;/pre>&lt;p>é‚£ä¸ºä»€ä¹ˆéœ€è¦è¿™ä¸ªä¾èµ–åŒ…å‘¢ï¼Œ å…¶å®æ˜¯å› ä¸º Python æœ‰ä¸ªå¾ˆé‡è¦çš„å†…å»ºæ¨¡å— &lt;code>zipimport&lt;/code> ç”¨äºä» Zip å‹ç¼©åŒ…ä¸­å¯¼å…¥æ¨¡å—ã€‚ è€Œå¦‚æœæ²¡æœ‰ zlib çš„åŒ…ï¼Œé‚£ä¹ˆå°±æ— æ³•è¿›è¡Œè§£å‹ç¼©äº†ï¼Œä¹Ÿè‡ªç„¶è¯¥æ¨¡å—å°±ä¸èƒ½ä½¿ç”¨äº†ã€‚&lt;/p>
&lt;p>å½“æˆ‘ä»¬çš„ä¾èµ–å®‰è£…å¥½ä¹‹åï¼Œé‡æ–°æ‰§è¡Œä¸Šé¢çš„ç¼–è¯‘å®‰è£…çš„æ­¥éª¤ï¼Œå‘ç°æ‰§è¡ŒæˆåŠŸã€‚&lt;/p>
&lt;pre>&lt;code>âœ /usr/local/python3.6/bin/python3 --version
Python 3.6.1
&lt;/code>&lt;/pre>&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/install_success.png" alt="install_success">&lt;/p>
&lt;p>æ­¤åˆ»ï¼Œæˆ‘ä»¬çš„ Python 3 ä¹Ÿå°±å®‰è£…æˆåŠŸäº†ã€‚&lt;/p>
&lt;ul>
&lt;li>æ£€æŸ¥&lt;/li>
&lt;/ul>
&lt;p>ç¼–è¯‘å®‰è£…å®Œè¿˜è¿œè¿œä¸å¤Ÿï¼Œæˆ‘ä»¬æ¥åšäº›æ£€æŸ¥ã€‚&lt;/p>
&lt;p>å½“æˆ‘ä»¬è¿è¡Œ Python ç»ˆç«¯ï¼Œè¾“å…¥ &lt;code>import bz2&lt;/code> çš„æ—¶å€™ï¼Œä¼šå‘ç°æ²¡æœ‰è¿™ä¸ªæ¨¡å—ã€‚å¦‚æœä½ å¯¹è¿™ä¸ªæ¨¡å—ä¸ç†Ÿæ‚‰ï¼Œé‚£ä¹Ÿæ²¡å…³ç³»ã€‚æˆ‘ä»¬è¾“å…¥ &lt;code>import sqlite3&lt;/code>ç†Ÿæ‚‰ Python çš„åŒå­¦åº”è¯¥å¯¹ sqlite3 ä¸ä¼šå¤ªé™Œç”Ÿï¼Œä½†å¦‚æœä½ è¿˜æ˜¯ä¸ç†Ÿæ‚‰çš„è¯ï¼Œé‚£ä½ æŒ‰æ–¹å‘é”®è¯•è¯•çœ‹ã€‚æœ‰æ²¡æœ‰å‘ç°ï¼Œè¾“å‡ºå˜æˆäº†&lt;code>^[[D^[[A&lt;/code> ç±»ä¼¼è¿™æ ·çš„å†…å®¹ï¼Ÿ&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/arrow_keys_problem.png" alt="arrow_keys_problem">&lt;/p>
&lt;p>ç†Ÿæ‚‰ Python æºç çš„åŒå­¦ï¼Œè‚¯å®šçŸ¥é“æˆ‘è¦è¯´ä»€ä¹ˆäº†ã€‚ä½†æ˜¯å‡å¦‚ä½ ä¸ç†Ÿæ‚‰ï¼Œæ²¡å…³ç³»ï¼Œæˆ‘æ¥å‘Šè¯‰ä½ ã€‚æ­£å¸¸æ¥è®²ï¼Œåœ¨ç»ˆç«¯ä¸‹æˆ‘ä»¬é¢„æœŸå½“è¾“å…¥ä¸Šæ–¹å‘é”®ï¼Œä¼šæ˜¾ç¤ºä¸Šä¸€æ¡å‘½ä»¤ï¼Œè¾“å…¥å·¦æ–¹å‘é”®ï¼Œå¯ä»¥å°†å…‰æ ‡ç§»åŠ¨åˆ°å·¦ä¾§ã€‚ä½†ç°å®å’Œæˆ‘ä»¬çš„é¢„æœŸä¸åŒï¼Œä»€ä¹ˆåŸå› ï¼Ÿ&lt;/p>
&lt;p>è¿™é‡Œæ¶‰åŠåˆ°äº†ä¸€ç‚¹ç‚¹å…³äºè¾“å…¥è®¾å¤‡çš„å†å²åŸå› ï¼Œç®€å•æ¥è¯´å°±æ˜¯éœ€è¦æœ‰ä¸ªæ¨¡å—æ¥å¯¹ç”¨æˆ·çš„è¾“å…¥è¿›è¡Œè½¬ä¹‰ã€‚å›åˆ°æœ¬æ–‡çš„é‡ç‚¹ï¼Œå°±æ˜¯æˆ‘ä»¬ç¼–è¯‘å®‰è£…çš„æ—¶å€™ç¼ºå°‘äº† &lt;code>readline&lt;/code> è¿™ä¸ªæ¨¡å—ã€‚æ—¢ç„¶å·²ç»å‘ç°äº†é—®é¢˜ï¼Œé‚£è§£å†³çš„åŠæ³•å…¶å®å¾ˆç®€å•&lt;/p>
&lt;pre>&lt;code>âœ yum install readline-devel
&lt;/code>&lt;/pre>&lt;p>å®‰è£…å®Œæˆåï¼Œé‡å¤ä¸Šé¢çš„æ­¥éª¤ï¼Œç¼–è¯‘&amp;amp;&amp;amp;å®‰è£…å³å¯ã€‚&lt;/p>
&lt;ul>
&lt;li>å†æ£€æŸ¥&lt;/li>
&lt;/ul>
&lt;p>å‰é¢åªæ˜¯è§£å†³äº†æ–¹å‘é”®è¾“å…¥çš„é—®é¢˜ï¼Œä½†æ˜¯æˆ‘æåˆ°çš„é‚£ä¸¤ä¸ªæ¨¡å—è¿˜æ˜¯ import ä¸è¿›æ¥ï¼Œé‚£æˆ‘ä»¬ä»”ç»†çš„çœ‹çœ‹æˆ‘ä»¬çš„ç¼–è¯‘è¿‡ç¨‹çš„è¾“å‡ºã€‚å…¶ä¸­æœ‰è¿™æ ·çš„ä¸€æ®µï¼ˆä¾æ®ç³»ç»Ÿç¯å¢ƒçš„ä¸åŒï¼Œè¾“å‡ºå¯èƒ½ä¹Ÿæ˜¯ä¸ä¸€è‡´çš„ï¼‰&lt;/p>
&lt;pre>&lt;code>Python build finished successfully!
The necessary bits to build these optional modules were not found:
_curses bz2 _dbm
_gdbm _lzma _sqlite3
_tkinter readline
To find the necessary bits, look in setup.py in detect_modules() for the module's name.
&lt;/code>&lt;/pre>&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/some_optional_modules_were_not_found.png" alt="some_optional_modules_were_not_found">&lt;/p>
&lt;p>æŒ‰ç…§ä¸Šé¢çš„æç¤ºï¼Œå¾ˆæ˜æ˜¾ï¼Œæˆ‘ä»¬ç¼ºå°‘äº†ä¸€äº›ï¼ˆå¯é€‰çš„ï¼‰æ¨¡å—ï¼Œè¿™äº›æ¨¡å—å‡å¦‚ä½ è§‰å¾—è‡ªå·±ä¸ä¼šç”¨åˆ°ï¼Œé‚£ä¹Ÿå¯ä»¥ä¸ç†ä¼šå®ƒã€‚è¿™äº›æ¨¡å—ï¼Œæˆ‘ç”¨åˆ°çš„ä¼šå¤šä¸€äº›ï¼Œç”šè‡³æ˜¯é‚£ä¸ªä¸€èˆ¬äººéƒ½ä¸ä¼šç¢°çš„ TK æ¨¡å— å“ˆå“ˆå“ˆã€‚è§£å†³æ–¹å¼å°±åªæ˜¯è£…ä¸€ä¸‹å¯¹åº”çš„æ¨¡å—å³å¯ã€‚&lt;/p>
&lt;pre>&lt;code>âœ # è§£å†³ import bz2 æŠ¥é”™
âœ yum install bzip2-devel
âœ # è§£å†³ import curses æŠ¥é”™
âœ yum install ncurses-devel
âœ # è§£å†³ import sqlite3 æŠ¥é”™
âœ yum install sqlite-devel
âœ # è§£å†³ _dbm _gdbm ç¼ºå¤±æé†’
âœ yum install gdbm-devel
âœ # è§£å†³ _lzma ç¼ºå¤±æé†’
âœ yum install xz-devel
âœ # è§£å†³ _tkinter ç¼ºå¤±æé†’
âœ yum install tk-devel
âœ # è§£å†³ readline ç¼ºå¤±æé†’åŠæ–¹å‘é”®è¡Œä¸ºéé¢„æœŸçš„é—®é¢˜
âœ yum install readline-devel
&lt;/code>&lt;/pre>&lt;p>å½“è¿™äº›æ¨¡å—éƒ½è£…å®Œï¼Œé‡æ–°ç¼–è¯‘ä¼šå‘ç°æé†’å·²ç»æ¶ˆå¤±ï¼Œå®‰è£…å³å¯ã€‚&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/all_modules_were_found.png" alt="all_modules_were_found">&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/import_successful.png" alt="import_successful">&lt;/p>
&lt;h1 id="ä½¿ç”¨-rpm-åŒ…è¿›è¡Œå®‰è£…">ä½¿ç”¨ rpm åŒ…è¿›è¡Œå®‰è£…&lt;/h1>
&lt;p>å…ˆæ¥ä»‹ç»ä¸€ä¸‹ &lt;a href="https://ius.io/">IUS&lt;/a> è¿™ä¸ªç¤¾åŒºï¼Œåå­—çš„å…¨å†™æ˜¯ã€Inline with Upstream Stableã€‘å–é¦–å­—æ¯ï¼Œå®ƒä¸»è¦æ˜¯ä¸€ä¸ªæä¾›æ–°ç‰ˆæœ¬RPMåŒ…çš„ç¤¾åŒºã€‚å…·ä½“ä½¿ç”¨å¯ä»¥æŸ¥çœ‹&lt;a href="https://ius.io/GettingStarted/#install-via-automation">å®˜æ–¹æ–‡æ¡£&lt;/a> ç®€å•è¯´æ¥å°±åªè¦æŒ‰ä¸‹é¢çš„å‘½ä»¤æ“ä½œå³å¯ã€‚&lt;/p>
&lt;pre>&lt;code>âœ yum -y install https://centos7.iuscommunity.org/ius-release.rpm
&lt;/code>&lt;/pre>&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/yum_install_ius.png" alt="yum_install_ius">&lt;/p>
&lt;p>æ·»åŠ  IUS ä¹‹åï¼Œå…ˆåˆ›å»ºç¼“å­˜å…ƒæ•°æ®ï¼Œå†è¿›è¡Œå®‰è£…å³å¯&lt;/p>
&lt;pre>&lt;code>âœ yum makecache
âœ yum install python36u
âœ yum -y install python36u-pip
âœ yum -y install python36u-devel
&lt;/code>&lt;/pre>&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/yum_install_python36u.png" alt="yum_install_python36u">&lt;/p>
&lt;p>å®Œæˆåç›´æ¥ç»ˆç«¯è¾“å…¥ &lt;code>python3&lt;/code> å³å¯ã€‚&lt;/p>
&lt;h1 id="ç¯å¢ƒé…ç½®">ç¯å¢ƒé…ç½®&lt;/h1>
&lt;p>ä¸Šé¢åªæ˜¯å†™äº† Python çš„å®‰è£…ï¼Œå¦‚æœæ˜¯ä½¿ç”¨ RPM çš„æ–¹å¼å®‰è£…çš„è¯ï¼Œé‚£ç›´æ¥æ˜¯å¯ç”¨çš„ã€‚ä½†å¦‚æœæ˜¯æºç ç¼–è¯‘çš„ï¼Œæ€»ä¸è‡³äºæ¯æ¬¡éƒ½è¾“å…¥ä¸€å¤§ä¸²è·¯å¾„å§ã€‚æ‰€ä»¥è§£å†³æ–¹æ³•å¾ˆç®€å•ï¼ŒåŠ ä¸ªé“¾æ¥å³å¯ã€‚&lt;/p>
&lt;pre>&lt;code>âœ ln -s /usr/local/python3.6/bin/python3 /usr/bin/python3
&lt;/code>&lt;/pre>&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/ln.png" alt="ln">&lt;/p>
&lt;p>å¦å¤–ï¼Œå½“ç³»ç»Ÿä¸­å­˜åœ¨å¤šä¸ª Python ç‰ˆæœ¬çš„æ—¶å€™ï¼Œå°½é‡å»é¿å…ç¯å¢ƒæ±¡æŸ“ã€‚æˆ‘ä¸ªäººæ¯”è¾ƒæ¨èä½¿ç”¨ &lt;code>virtualenv&lt;/code> åˆ›å»ºç‹¬ç«‹çš„è™šæ‹Ÿç¯å¢ƒï¼Œæˆ‘æ—¥å¸¸ä¸­ä¹Ÿæ˜¯è¿™æ ·ç”¨çš„ã€‚ä¸è¿‡ï¼Œå½“æˆ‘ä»¬å®‰è£…å®Œ Python 3.6 åï¼Œå¯ä»¥ç›´æ¥æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤è¿›è¡Œè™šæ‹Ÿç¯å¢ƒçš„åˆ›å»ºã€‚&lt;/p>
&lt;pre>&lt;code>âœ python3 -m venv py3
âœ source py3/bin/activate
(py3) âœ python -V
Python 3.6.1
&lt;/code>&lt;/pre>&lt;h1 id="æ€»ç»“">æ€»ç»“&lt;/h1>
&lt;p>CentOS 7 ä¸Šå®‰è£…Python 3.6 ä¸»è¦æœ‰ä¸¤ç§æ–¹å¼ï¼Œæºç ç¼–è¯‘å’Œå®‰è£… RPM åŒ…ã€‚&lt;/p>
&lt;p>å¯¹äºæƒ³å¿«é€Ÿä½¿ç”¨æºç é…ç½®ç¯å¢ƒä½†å¹¶ä¸æƒ³å…³å¿ƒå…·ä½“åŸå› çš„è¯»è€…ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨æˆ‘GitHubä¸Šæä¾›çš„è¿™ä¸ªè„šæœ¬è¿›è¡Œå®‰è£… &lt;a href="https://raw.githubusercontent.com/tao12345666333/dotfiles/master/env/install_Python36_on_CentOS7.sh">https://raw.githubusercontent.com/tao12345666333/dotfiles/master/env/install_Python36_on_CentOS7.sh&lt;/a>&lt;/p>
&lt;p>å¦å¤–Python 3.6 å¯ç›´æ¥ä½¿ç”¨ &lt;code>python3 -m venv venv_name&lt;/code> åˆ›å»ºè™šæ‹Ÿç¯å¢ƒã€‚&lt;/p>
&lt;hr>
&lt;p>å¯ä»¥é€šè¿‡ä¸‹é¢äºŒç»´ç è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="TheMoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Python/">Python</category><category domain="https://moelove.info/tags/Linux/">Linux</category></item><item><title>ç†è§£ Redis çš„ RESP åè®®</title><link>https://moelove.info/2017/03/05/%E7%90%86%E8%A7%A3-Redis-%E7%9A%84-RESP-%E5%8D%8F%E8%AE%AE/</link><guid isPermaLink="true">https://moelove.info/2017/03/05/%E7%90%86%E8%A7%A3-Redis-%E7%9A%84-RESP-%E5%8D%8F%E8%AE%AE/</guid><pubDate>Sun, 05 Mar 2017 21:45:07 +0000</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;h1 id="ç®€ä»‹">ç®€ä»‹&lt;/h1>
&lt;p>Redis çš„å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¹‹é—´é‡‡å–äº†ä¸€ç§ç‹¬ç«‹åä¸º RESP(REdis Serialization Protocol) çš„åè®®ï¼Œä½œè€…ä¸»è¦è€ƒè™‘äº†ä»¥ä¸‹å‡ ä¸ªç‚¹ï¼š&lt;/p>
&lt;ul>
&lt;li>å®¹æ˜“å®ç°&lt;/li>
&lt;li>è§£æå¿«&lt;/li>
&lt;li>äººç±»å¯è¯»&lt;/li>
&lt;/ul>
&lt;p>æ³¨æ„ï¼šRESP è™½ç„¶æ˜¯ä¸º Redis è®¾è®¡çš„ï¼Œä½†æ˜¯åŒæ ·ä¹Ÿå¯ä»¥ç”¨äºå…¶ä»– C/S çš„è½¯ä»¶ã€‚&lt;/p>
&lt;h1 id="æ•°æ®ç±»å‹åŠç¤ºä¾‹">æ•°æ®ç±»å‹åŠç¤ºä¾‹&lt;/h1>
&lt;p>RESP ä¸»è¦å¯ä»¥åºåˆ—åŒ–ä»¥ä¸‹å‡ ç§ç±»å‹ï¼šæ•´æ•°ï¼Œå•è¡Œå›å¤(ç®€å•å­—ç¬¦ä¸²)ï¼Œæ•°ç»„ï¼Œé”™è¯¯ä¿¡æ¯ï¼Œå¤šè¡Œå­—ç¬¦ä¸²ã€‚Redis å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€çš„æ˜¯ä¸€ç»„ç”±æ‰§è¡Œçš„å‘½ä»¤ç»„æˆçš„å­—ç¬¦ä¸²æ•°ç»„ï¼ŒæœåŠ¡ç«¯æ ¹æ®ä¸åŒçš„å‘½ä»¤å›å¤ä¸åŒç±»å‹çš„æ•°æ®ï¼Œä½†åè®®çš„æ¯éƒ¨åˆ†éƒ½æ˜¯ä»¥ &amp;quot;\r\n&amp;quot; (CRLF) ç»“å°¾çš„ã€‚å¦å¤– RESP æ˜¯äºŒè¿›åˆ¶å®‰å…¨çš„ï¼Œä¸éœ€è¦å¤„ç†ä»ä¸€ä¸ªè¿›ç¨‹åˆ°å¦ä¸€ä¸ªè¿›ç¨‹çš„ä¼ è¾“ï¼Œå› ä¸ºå®ƒä½¿ç”¨äº†å‰ç¼€é•¿åº¦è¿›è¡Œä¼ è¾“ã€‚&lt;/p>
&lt;p>åœ¨ RESP ä¸­, ä¸€äº›æ•°æ®çš„ç±»å‹é€šè¿‡å®ƒçš„ç¬¬ä¸€ä¸ªå­—èŠ‚è¿›è¡Œåˆ¤æ–­ï¼š&lt;/p>
&lt;ul>
&lt;li>å•è¡Œå›å¤ï¼šå›å¤çš„ç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯ &amp;quot;+&amp;quot;&lt;/li>
&lt;li>é”™è¯¯ä¿¡æ¯ï¼šå›å¤çš„ç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯ &amp;quot;-&amp;quot;&lt;/li>
&lt;li>æ•´å½¢æ•°å­—ï¼šå›å¤çš„ç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯ &amp;quot;:&amp;quot;&lt;/li>
&lt;li>å¤šè¡Œå­—ç¬¦ä¸²ï¼šå›å¤çš„ç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯ &amp;quot;$&amp;quot;&lt;/li>
&lt;li>æ•°ç»„ï¼šå›å¤çš„ç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯ &amp;quot;*&amp;quot;&lt;/li>
&lt;/ul>
&lt;h2 id="å•è¡Œå›å¤">å•è¡Œå›å¤&lt;/h2>
&lt;p>ä»¥ &amp;quot;+&amp;quot; å¼€å¤´ï¼Œä»¥ &amp;quot;\r\n&amp;quot; ç»“å°¾çš„å­—ç¬¦ä¸²å½¢å¼ã€‚e.g.&lt;/p>
&lt;pre>&lt;code>+OK\r\n
&lt;/code>&lt;/pre>&lt;p>å“åº”çš„å®¢æˆ·ç«¯åº“ï¼Œåº”è¯¥è¿”å›é™¤ &amp;quot;+&amp;quot; å’Œ CRLF ä»¥å¤–çš„å†…å®¹ï¼Œä¾‹å¦‚ä¸Šé¢çš„å†…å®¹ï¼Œåˆ™è¿”å› &amp;quot;OK&amp;quot;. e.g.&lt;/p>
&lt;pre>&lt;code>127.0.0.1:6379&amp;gt; set name JintaoZhang
+OK\r\n # æœåŠ¡ç«¯å®é™…è¿”å›
---
OK # redis-cli å®¢æˆ·ç«¯æ˜¾ç¤º
&lt;/code>&lt;/pre>&lt;h2 id="é”™è¯¯ä¿¡æ¯">é”™è¯¯ä¿¡æ¯&lt;/h2>
&lt;p>é”™è¯¯ä¿¡æ¯å’Œå•è¡Œå›å¤å¾ˆåƒï¼Œä¸è¿‡æ˜¯æŠŠ &amp;quot;+&amp;quot; æ›¿æ¢æˆäº† &amp;quot;-&amp;quot;ã€‚è€Œè¿™ä¸¤è€…ä¹‹é—´çœŸæ­£çš„åŒºåˆ«æ˜¯ï¼Œé”™è¯¯ä¿¡æ¯ä¼šè¢«å®¢æˆ·ç«¯è§†ä¸ºå¼‚å¸¸ï¼Œå¹¶ä¸”ç»„æˆé”™è¯¯ç±»å‹çš„æ˜¯é”™è¯¯æ¶ˆæ¯æœ¬èº«ã€‚e.g.&lt;/p>
&lt;pre>&lt;code>-Error message\r\n
&lt;/code>&lt;/pre>&lt;p>é”™è¯¯ä¿¡æ¯åªåœ¨æœ‰é”™è¯¯å‘ç”Ÿçš„æ—¶å€™æ‰ä¼šå‘é€ï¼Œæ¯”å¦‚æ•°æ®ç±»å‹é”™è¯¯ï¼Œè¯­æ³•é”™è¯¯ï¼Œæˆ–è€…å‘½ä»¤ä¸å­˜åœ¨ä¹‹ç±»çš„ã€‚è€Œå½“æ¥æ”¶åˆ°é”™è¯¯ä¿¡æ¯çš„æ—¶å€™ï¼Œå®¢æˆ·ç«¯åº“åº”è¯¥æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ã€‚e.g.&lt;/p>
&lt;pre>&lt;code>127.0.0.1:6379&amp;gt; JintaoZhang
-ERR unknown command 'JintaoZhang'\r\n # æœåŠ¡ç«¯å®é™…è¿”å›, ä¸‹åŒ
---
(error) ERR unknown command 'JintaoZhang' # redis-cli å®¢æˆ·ç«¯æ˜¾ç¤º, ä¸‹åŒ
127.0.0.1:6379&amp;gt; set name JintaoZhang moelove
-ERR syntax error\r\n
---
(error) ERR syntax error
&lt;/code>&lt;/pre>&lt;h2 id="æ•´æ•°">æ•´æ•°&lt;/h2>
&lt;p>è¿™ç§ç±»å‹åªæ˜¯åªæ˜¯ä½¿ç”¨ä»¥ &amp;quot;:&amp;quot; ä½œä¸ºå‰ç¼€ï¼Œä»¥CRLFä½œä¸ºç»“å°¾çš„å­—ç¬¦ä¸²æ¥è¡¨ç¤ºæ•´æ•°ã€‚e.g. &amp;quot;:666\r\n&amp;quot; æˆ–è€… &amp;quot;:999\r\n&amp;quot; è¿™ç§çš„éƒ½æ˜¯æ•´æ•°å›å¤ã€‚å¾ˆå¤šå‘½ä»¤éƒ½ä¼šè¿”å›æ•´æ•°å›å¤ï¼Œä¾‹å¦‚ &lt;code>INCR&lt;/code> &lt;code>LLEN&lt;/code> &lt;code>LPUSH&lt;/code> ä¹‹ç±»çš„å‘½ä»¤ã€‚ä½†æ˜¯å¤šæ•°æƒ…å†µä¸‹ï¼Œè¿”å›çš„æ•´æ•°å›å¤å¹¶æ²¡æœ‰è¿‡å¤šå®é™…å«ä¹‰ï¼Œä¾‹å¦‚ &lt;code>LPUSH&lt;/code> å°±åªæ˜¯ä¸ºäº†è¡¨ç¤ºæ’å…¥äº†å‡ ä¸ªå€¼ï¼Œä½†ä¹Ÿæœ‰ä¾‹å¦‚ &lt;code>EXISTS&lt;/code> å‘½ä»¤æ˜¯å½“ç»“æœä¸º true çš„æ—¶å€™è¿”å› 1ï¼Œfalse è¿”å› 0 . e.g.&lt;/p>
&lt;pre>&lt;code>127.0.0.1:6379&amp;gt; LPUSH info JintaoZhang MoeLove
:2\r\n # æœåŠ¡ç«¯å®é™…è¿”å›, ä¸‹åŒ
---
(integer) 2 # redis-cli å®¢æˆ·ç«¯æ˜¾ç¤º, ä¸‹åŒ
127.0.0.1:6379&amp;gt; LLEN info
:2\r\n
---
(integer) 2
127.0.0.1:6379&amp;gt; EXISTS info
:1\r\n
---
(integer) 1
127.0.0.1:6379&amp;gt; DEL info
:1\r\n
---
(integer) 1
127.0.0.1:6379&amp;gt; EXISTS info
:0\r\n
---
(integer) 0
&lt;/code>&lt;/pre>&lt;h2 id="å¤šè¡Œå­—ç¬¦ä¸²">å¤šè¡Œå­—ç¬¦ä¸²&lt;/h2>
&lt;p>å¤šè¡Œå­—ç¬¦ä¸²è¢«æœåŠ¡ç«¯ç”¨æ¥è¿”å›é•¿åº¦æœ€å¤§ä¸º 512MB çš„å•ä¸ªäºŒè¿›åˆ¶å®‰å…¨çš„å­—ç¬¦ä¸²ã€‚ä»¥ &amp;quot;$&amp;quot; å¼€å¤´, åè·Ÿå®é™…è¦å‘é€çš„å­—èŠ‚æ•°ï¼Œéšåæ˜¯ CRLFï¼Œç„¶åæ˜¯å®é™…çš„å­—ç¬¦ä¸²æ•°æ®ï¼Œæœ€åä»¥ CRLF ç»“æŸã€‚æ‰€ä»¥ï¼Œä¾‹å¦‚æˆ‘ä»¬è¦å‘é€ä¸€ä¸ª &amp;quot;moelove.info&amp;quot; çš„å­—ç¬¦ä¸²ï¼Œé‚£å®ƒå®é™…å°±è¢«ç¼–ç ä¸º &amp;quot;$12\r\nmoelove.info\r\n&amp;quot;ã€‚è€Œå¦‚æœä¸€ä¸ªè¦å‘é€ä¸€ä¸ªç©ºå­—ç¬¦ä¸²ï¼Œåˆ™ä¼šç¼–ç ä¸º &amp;quot;$0\r\n\r\n&amp;quot; ã€‚æŸäº›æƒ…å†µä¸‹ï¼Œå½“è¦è¡¨ç¤ºä¸å­˜åœ¨çš„å€¼æ—¶å€™ï¼Œåˆ™ä»¥ &amp;quot;$-1\r\n&amp;quot; è¿”å›ï¼Œè¿™è¢«å«åšç©ºå¤šè¡Œå­—ç¬¦ä¸²ï¼Œå½“å®¢æˆ·ç«¯åº“æ¥æ”¶åˆ°è¿™ä¸ªå“åº”çš„æ—¶å€™ï¼ŒåŒæ ·åº”è¯¥è¿”å›ä¸€ä¸ªç©ºå€¼ï¼ˆä¾‹å¦‚ &lt;code>nil&lt;/code>ï¼‰è€Œä¸æ˜¯ä¸€ä¸ªç©ºå­—ç¬¦ä¸²ã€‚e.g.&lt;/p>
&lt;pre>&lt;code>127.0.0.1:6379&amp;gt; set site moelove.info
+OK\r\n # æœåŠ¡ç«¯å®é™…è¿”å›, ä¸‹åŒ
---
OK # redis-cli å®¢æˆ·ç«¯æ˜¾ç¤º, ä¸‹åŒ
127.0.0.1:6379&amp;gt; get site
$12\r\nmoelove.info\r\n
---
&amp;quot;moelove.info&amp;quot;
127.0.0.1:6379&amp;gt; del site
:1\r\n
---
(integer) 1
127.0.0.1:6379&amp;gt; get site
$-1\r\n
---
(nil)
127.0.0.1:6379&amp;gt; set site ''
+OK\r\n
---
OK
127.0.0.1:6379&amp;gt; get site
$0\r\n\r\n
---
&amp;quot;&amp;quot;
&lt;/code>&lt;/pre>&lt;h2 id="æ•°ç»„">æ•°ç»„&lt;/h2>
&lt;p>æ•°ç»„ç±»å‹å¯ç”¨äºå®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€å‘½ä»¤ï¼ŒåŒæ ·çš„å½“æŸäº›å‘½ä»¤å°†å…ƒç´ ç»“åˆè¿”å›ç»™å®¢æˆ·ç«¯çš„æ—¶å€™ï¼Œä¹Ÿæ˜¯ä½¿ç”¨æ•°ç»„ç±»å‹ä½œä¸ºå›å¤ç±»å‹çš„ã€‚å®ƒä»¥ &amp;quot;*&amp;quot; å¼€å¤´ï¼Œåé¢è·Ÿç€è¿”å›å…ƒç´ çš„ä¸ªæ•°ï¼Œéšåæ˜¯ CRLF, å†ç„¶åå°±æ˜¯æ•°ç»„ä¸­å„å…ƒç´ è‡ªå·±çš„ç±»å‹äº†ã€‚æœ€å…¸å‹çš„æ˜¯ &lt;code>LRRANGE&lt;/code> å‘½ä»¤ï¼Œè¿”å›ä¸€ä¸ªåˆ—è¡¨ä¸­çš„å…ƒç´ ã€‚e.g.&lt;/p>
&lt;pre>&lt;code>127.0.0.1:6379&amp;gt; LPUSH info JintaoZhang moelove.info
:2\r\n # æœåŠ¡ç«¯å®é™…è¿”å›, ä¸‹åŒ
---
(integer) 2 # redis-cli å®¢æˆ·ç«¯æ˜¾ç¤º, ä¸‹åŒ
127.0.0.1:6379&amp;gt; LRANGE info 0 -1
*2\r\n$12\r\nmoelove.info\r\n$8\r\nJintaoZhang\r\n
---
1) &amp;quot;moelove.info&amp;quot;
2) &amp;quot;JintaoZhang&amp;quot;
127.0.0.1:6379&amp;gt; LPOP info
$12\r\nmoelove.info\r\n
---
&amp;quot;moelove.info&amp;quot;
127.0.0.1:6379&amp;gt; LPOP info
$8\r\nJintaoZhang\r\n
---
&amp;quot;JintaoZhang&amp;quot;
127.0.0.1:6379&amp;gt; LRANGE info 0 -1
*0\r\n
---
(empty list or set)
&lt;/code>&lt;/pre>&lt;h1 id="æ€»ç»“">æ€»ç»“&lt;/h1>
&lt;p>RESP åè®®è¿˜æ˜¯ç›¸å¯¹æ˜“äºç†è§£çš„ï¼Œå¦å¤–ç†è§£äº†åè®®ä¹Ÿæ–¹ä¾¿å¯¹ Redis ä¸€äº›é—®é¢˜çš„å®šä½åŠå®¢æˆ·ç«¯çš„å®ç°ã€‚&lt;/p>
&lt;p>å‚è€ƒï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://redis.io/topics/protocol">Redis Protocol specification&lt;/a>&lt;/li>
&lt;/ul>
&lt;hr>
&lt;p>å¯ä»¥é€šè¿‡ä¸‹é¢äºŒç»´ç è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Redis/">Redis</category></item><item><title>2016 å°å›é¡¾</title><link>https://moelove.info/2017/01/01/2016-%E5%B0%8F%E5%9B%9E%E9%A1%BE/</link><guid isPermaLink="true">https://moelove.info/2017/01/01/2016-%E5%B0%8F%E5%9B%9E%E9%A1%BE/</guid><pubDate>Sun, 01 Jan 2017 01:00:51 +0000</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/1043453-ce357ac3c236b6de.png" alt="github-2016.png">&lt;/p>
&lt;p>æ—¶é—´å¾ˆå¿«ï¼Œ å·²ç»èµ°åˆ°äº† 2016 çš„æœ«å°¾ï¼Œ æƒ¯ä¾‹çš„åšä¸ªå°å›é¡¾ã€‚ï¼ˆæ³¨ï¼šè¿™ç¯‡èµ·ç¬”çš„æ—¶é—´æ˜¯åœ£è¯èŠ‚TATï¼‰&lt;/p>
&lt;p>å¹´åˆå®šçš„ç›®æ ‡é™¤äº†æ²¡æœ‰èƒ½åˆç†å®‰æ’è¿½ç•ªæ—¶é—´ï¼Œ å…¶ä»–çš„éƒ½åŸºæœ¬å®Œæˆäº†ï¼ï¼ˆè¯è¯´ä»Šå¹´è¿½ç•ªçš„æ—¶é—´ç®€ç›´å°‘çš„å¯æ€œQAQï¼‰&lt;/p>
&lt;p>2016 å¹´å‘ç”Ÿäº†å¤ªå¤šçš„äº‹æƒ…ï¼Œè¦å›é¡¾çš„äº‹æƒ…å¾ˆå¤šï¼Œç´¢æ€§å°±ä¸å†™é‚£ä¹ˆå¤šäº†, åªæŒ‰æ—¶é—´åºç¨å¾®åˆ—å‡ ä»¶æœ‰è¶£çš„äº‹æƒ…ã€‚&lt;/p>
&lt;ul>
&lt;li>å•è¡¨äº¿çº§æ•°æ®é‡çš„ MongoDB åšåœ¨çº¿å®æ—¶çš„æ•°æ®æ‹†åˆ†&lt;/li>
&lt;li>åœ¨ä¹‹å‰åšçš„ä¸€äº›åº”ç”¨æ€§èƒ½åˆ†æçš„æ–¹æ¡ˆä¸Šåšäº†ä¸€äº›é¢å¤–çš„è®¾è®¡å’Œå¼€å‘ï¼ˆæ˜å¹´ä¿®æ”¹ä¸‹å¼€æºå‡ºæ¥ï¼‰&lt;/li>
&lt;li>PyCon China 2016&lt;/li>
&lt;li>ä¸€äº›é¢„æœŸçš„è®¡åˆ’é¡ºåˆ©æ¨è¿›ã€è½åœ°ï¼Œäº§å‡ºäº†ä¸€äº›ç³»ç»Ÿ&lt;/li>
&lt;li>çœ‹äº†å¾ˆå¤šæºç ï¼ŒæŠ˜è…¾äº†å¾ˆå¤šä¸œè¥¿ï¼Œå¦‚æœä»¥åæœ‰ç©ºå°±å†™ç‚¹ä¸œè¥¿å‡ºæ¥ï¼ˆæˆ‘åˆåœ¨ç»™è‡ªå·±æŒ–å‘äº†ï¼‰&lt;/li>
&lt;li>è®¤è¯†äº†å¾ˆå¤šæœ‰è¶£çš„å°ä¼™ä¼´~&lt;/li>
&lt;/ul>
&lt;p>å…¨å¹´çš„çŠ¶æ€åŸºæœ¬å’Œä¸Šé¢çš„æˆªå›¾æ˜¯ä¸€è‡´çš„ï¼Œ å…¨å¹´éƒ½åœ¨ coding ï¼ˆæˆªå›¾ä»…é™ GitHubä¸Šçš„è®°å½•ï¼‰å€’ä¹Ÿæ¯”è¾ƒå¼€å¿ƒï¼Œ å¦å¤–å°±æ˜¯ç°åœ¨çœ‹åˆ°è‡ªå·±é¡¹ç›®çš„ star/fork æ•°ï¼Œæ–‡ç« çš„é˜…è¯»/æ”¶è—/è½¬å‘æ•°ä¹‹ç±»çš„ï¼Œä¹Ÿå·²ç»ä¸åƒä»¥å‰çœ‹åˆ° star æ•°åˆšä¸Šç™¾æ—¶å€™ä¼šæœ‰é‚£ç§å–œæ‚¦äº†ï¼Œå¤§æ¦‚è¿™ä¹Ÿæ˜¯å¦ä¸€ç§æˆç†Ÿï¼Ÿ å“ˆå“ˆå“ˆ&lt;/p>
&lt;p>å¦å¤–å†™ä¸€ä¸‹ä»Šå¹´å¯¹æˆ‘æ¯”è¾ƒé‡è¦çš„å‡ ä¸ªæ•°å­—ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;strong>1354&lt;/strong>&lt;/li>
&lt;li>&lt;strong>376&lt;/strong>&lt;/li>
&lt;li>&lt;strong>105&lt;/strong>&lt;/li>
&lt;/ul>
&lt;p>å¯¹è¿™äº›æ•°å­—çš„è§£é‡Š, æ”¾åœ¨ä»¥åå§ :-)&lt;/p>
&lt;p>&lt;strong>2017 å¹´ï¼Œå¸Œæœ›æƒ³åšçš„äº‹æƒ…éƒ½èƒ½åŸºæœ¬å®Œæˆï¼ŒæŒ–çš„å‘æ…¢æ…¢å¡«ã€‚ æ„Ÿè°¢ä¸€è·¯ä¸Šé™ªæˆ‘èµ°è¿‡çš„å„ä½ï¼&lt;/strong>&lt;/p>
&lt;hr>
&lt;p>å¯ä»¥é€šè¿‡ä¸‹é¢äºŒç»´ç è®¢é˜…æˆ‘çš„æ–‡ç« å…¬ä¼—å·ã€MoeLoveã€‘&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/tao12345666333/collection/master/images/my_qrcode.jpg" alt="MoeLove">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Life/">Life</category></item><item><title>å…³äº webpack ä½ å¯èƒ½å¿½ç•¥çš„ç»†èŠ‚ï¼ˆé™„æºç åˆ†æï¼‰</title><link>https://moelove.info/2016/12/26/%E5%85%B3%E4%BA%8E-webpack-%E4%BD%A0%E5%8F%AF%E8%83%BD%E5%BF%BD%E7%95%A5%E7%9A%84%E7%BB%86%E8%8A%82%E9%99%84%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/</link><guid isPermaLink="true">https://moelove.info/2016/12/26/%E5%85%B3%E4%BA%8E-webpack-%E4%BD%A0%E5%8F%AF%E8%83%BD%E5%BF%BD%E7%95%A5%E7%9A%84%E7%BB%86%E8%8A%82%E9%99%84%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/</guid><pubDate>Mon, 26 Dec 2016 00:43:02 +0000</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>æ³¨ï¼šæœ¬ç¯‡ä¸æ˜¯å…¥é—¨æ•™ç¨‹ï¼Œå…¥é—¨è¯·ç›´æ¥æŸ¥çœ‹&lt;a href="http://webpack.github.io/docs/">å®˜æ–¹æ–‡æ¡£&lt;/a>ã€‚æœ¬ç¯‡çš„ä¸»è¦ç›®æ ‡æ˜¯é€šè¿‡å®é™…é—®é¢˜æ¥ä»‹ç» webpack ä¸­å®¹æ˜“è¢«äººå¿½ç•¥çš„ç»†èŠ‚, ä»¥åŠæºç åˆ†æ(&lt;strong>ä»¥æœ€æ–°å‘å¸ƒçš„ release ç‰ˆæœ¬1.14.0çš„æºç ä¸ºä¾‹&lt;/strong>), å¹¶ä¸”æä¾›å‡ ç§è§£å†³æ–¹æ¡ˆã€‚&lt;/p>
&lt;/blockquote>
&lt;p>&lt;img src="http://moelove.qiniudn.com/webpack.png" alt="webpack from the official website">&lt;/p>
&lt;p>éšç€å‰ç«¯æŠ€æœ¯çš„ç«çƒ­å‘å±•ï¼Œå·¥ç¨‹åŒ–ï¼Œæ¨¡å—åŒ–å’Œç»„ä»¶åŒ–çš„æ€æƒ³å·²é€æ­¥æˆä¸ºä¸»æµï¼Œä¸ä¹‹ç›¸åº”çš„ï¼Œå°±éœ€è¦æœ‰ä¸€æ•´å¥—å·¥å…·æµå¯ä»¥æ”¯æ’‘èµ·å®ƒã€‚&lt;/p>
&lt;p>ç°åœ¨æ¯”è¾ƒçƒ­é—¨çš„å‰ç«¯èµ„æºæ¨¡å—åŒ–ç®¡ç†å’Œæ‰“åŒ…å·¥å…·åº”è¯¥é &lt;a href="https://github.com/webpack/webpack">Webpack&lt;/a> è«å±äº†ã€‚&lt;/p>
&lt;h1 id="webpack-æ˜¯ä»€ä¹ˆ">Webpack æ˜¯ä»€ä¹ˆ&lt;/h1>
&lt;blockquote>
&lt;p>å®ƒå¯ä»¥å°†è®¸å¤šæ¾æ•£çš„æ¨¡å—æŒ‰ç…§ä¾èµ–å’Œè§„åˆ™æ‰“åŒ…æˆç¬¦åˆç”Ÿäº§ç¯å¢ƒéƒ¨ç½²çš„å‰ç«¯èµ„æºã€‚è¿˜å¯ä»¥å°†æŒ‰éœ€åŠ è½½çš„æ¨¡å—è¿›è¡Œä»£ç åˆ†éš”ï¼Œç­‰åˆ°å®é™…éœ€è¦çš„æ—¶å€™å†å¼‚æ­¥åŠ è½½ã€‚é€šè¿‡Â loader çš„è½¬æ¢ï¼Œä»»ä½•å½¢å¼çš„èµ„æºéƒ½å¯ä»¥è§†ä½œæ¨¡å—ï¼Œæ¯”å¦‚ CommonJs æ¨¡å—ã€ AMD æ¨¡å—ã€ ES6 æ¨¡å—ã€CSSã€å›¾ç‰‡ã€ JSONã€Coffeescriptã€ LESS ç­‰ã€‚
--å¼•è‡ª Webpack ä¸­æ–‡æŒ‡å—&lt;/p>
&lt;/blockquote>
&lt;h1 id="ä½¿ç”¨ä¸¾ä¾‹">ä½¿ç”¨ä¸¾ä¾‹&lt;/h1>
&lt;p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å®˜æ–¹æ–‡æ¡£ä¸­çš„æœ€å°ç”¨ä¾‹ï¼Œæ–°å»ºå¹¶å†™å…¥ä»¥ä¸‹å†…å®¹åˆ°è¿™ä¸¤ä¸ªæ–‡ä»¶ï¼š&lt;/p>
&lt;p>&lt;strong>cats.js&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-javascript" data-lang="javascript">&lt;span class="kd">var&lt;/span> &lt;span class="nx">cats&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;dave&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;henry&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;martha&amp;#39;&lt;/span>&lt;span class="p">];&lt;/span>
&lt;span class="nx">module&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">exports&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">cats&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>app.js (Entry Point)&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-javascript" data-lang="javascript">&lt;span class="nx">cats&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">require&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;./cats.js&amp;#39;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;span class="nx">console&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">cats&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™ä¸ªæ—¶å€™ï¼Œå°±å¯ä»¥ä½¿ç”¨ &lt;code>webpack&lt;/code> è¿›è¡Œæ‰“åŒ…äº†ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">webpack ./app.js app.bundle.js
&lt;/code>&lt;/pre>&lt;/div>&lt;p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å‘ç”Ÿäº†ä»€ä¹ˆï¼Œ ç›®å½•ä¸‹ç”Ÿæˆäº†ä¸€ä¸ªæ‰“åŒ…åçš„æ–‡ä»¶ &lt;code>app.bundle.js&lt;/code> ï¼Œè¿™å°±æ˜¯æœ€åŸºç¡€çš„æ‰“åŒ…è¿‡ç¨‹ã€‚&lt;/p>
&lt;h1 id="æå‡ºé—®é¢˜">æå‡ºé—®é¢˜&lt;/h1>
&lt;p>&lt;strong>å¦‚ä½•åˆ¤æ–­æ‰“åŒ…æ˜¯å¦æˆåŠŸï¼Ÿ&lt;/strong>&lt;/p>
&lt;h2 id="é€šç”¨æ–¹æ¡ˆ">é€šç”¨æ–¹æ¡ˆ&lt;/h2>
&lt;p>ä¸‹é¢æ˜¯æˆ‘ä»¬å¸¸ç”¨çš„ä¸¤ç§åˆ¤æ–­ä»»åŠ¡æ˜¯å¦æ‰§è¡ŒæˆåŠŸçš„æ–¹æ¡ˆ&lt;/p>
&lt;h4 id="é€šè¿‡-return-code">é€šè¿‡ return code&lt;/h4>
&lt;p>é€šè¿‡å‘½ä»¤æ‰§è¡Œåçš„ &lt;code>return code&lt;/code> æ¥åˆ¤æ–­ï¼ˆåœ¨ &lt;code>shell&lt;/code> ä¸­ä½¿ç”¨ &lt;code>$?&lt;/code> è·å¾—ï¼‰ã€‚ å¹¶ä¸”é€šå¸¸æƒ…å†µä¸‹ &lt;code>0&lt;/code> æ˜¯æ‰§è¡ŒæˆåŠŸï¼Œ é 0 æ˜¯æœªæˆåŠŸã€‚ æˆ‘ä»¬ä»¥ä¸Šé¢çš„ä¾‹å­æ¥æµ‹è¯•ä¸€ä¸‹ï¼š&lt;/p>
&lt;p>&lt;img src="http://moelove.qiniudn.com/webpack-c.png" alt="webpack-demo.png">&lt;/p>
&lt;p>å¯ä»¥çœ‹åˆ° &lt;code>$?&lt;/code> çš„å€¼ä¸º &lt;code>0&lt;/code> , ä¸”æ‰“åŒ…åçš„æ–‡ä»¶è¿è¡Œæ­£å¸¸ã€‚&lt;/p>
&lt;p>é‚£ä¹ˆæˆ‘ä»¬æ¥ä¿®æ”¹ä¸€ä¸‹ &lt;code>app.js&lt;/code> æ–‡ä»¶çš„å†…å®¹ï¼Œ å°† &lt;code>require&lt;/code> å¼•å…¥çš„æ¨¡å—è·¯å¾„æ•…æ„å†™é”™ï¼Œæ¥æµ‹è¯•ä¸€ä¸‹ï¼š&lt;/p>
&lt;p>&lt;img src="http://moelove.qiniudn.com/webpack-error.png" alt="webpack-error.png">&lt;/p>
&lt;p>&lt;strong>æ³¨æ„ï¼šç®­å¤´å¤„ &lt;code>$?&lt;/code> çš„å€¼ä»ç„¶ä¸º &lt;code>0&lt;/code>, ä¸”ç”Ÿæˆçš„æ‰“åŒ…åçš„æ–‡ä»¶è¿è¡Œå‡ºé”™ã€‚&lt;/strong>&lt;/p>
&lt;p>è¿™å°±è¯´æ˜ï¼Œæ ¹æ® &lt;code>return code&lt;/code> çš„å€¼åˆ¤æ–­ä»»åŠ¡æ˜¯å¦æ‰§è¡ŒæˆåŠŸï¼Œ ä¸å¯è¡Œï¼&lt;/p>
&lt;h4 id="é€šè¿‡æ ‡å‡†é”™è¯¯è¾“å‡º">é€šè¿‡æ ‡å‡†é”™è¯¯è¾“å‡º&lt;/h4>
&lt;p>æˆ‘ä»¬ä¹Ÿä¼šé€šè¿‡&lt;strong>æ ‡å‡†é”™è¯¯è¾“å‡º&lt;/strong>ï¼ˆ&lt;code>stderr&lt;/code>ï¼‰æ¥åˆ¤æ–­ä¸€ä¸ªä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­æ˜¯å¦æœ‰é”™è¯¯è¾“å‡ºã€‚è¿˜æ˜¯ä½¿ç”¨ä¸Šé¢çš„ä¾‹å­åšç¤ºèŒƒï¼š&lt;/p>
&lt;p>&lt;img src="http://moelove.qiniudn.com/webpack-stderr.png" alt="webpack-stderr.png">&lt;/p>
&lt;p>æ ¹æ®è¿™ä¸ªä¾‹å­ï¼Œå¯ä»¥çœ‹åˆ° webpack å¹¶æ²¡æœ‰æ ‡å‡†é”™è¯¯è¾“å‡ºï¼æ‰€ä»¥è¿™ä¸ªæ–¹æ³•ä¹Ÿä¸å¯è¡Œã€‚&lt;/p>
&lt;h1 id="æ¢ç©¶åŸå› åŠæºç åˆ†æ">æ¢ç©¶åŸå› åŠæºç åˆ†æ&lt;/h1>
&lt;p>è¿™é‡Œä»¥æœ€æ–°å‘å¸ƒçš„ release ç‰ˆæœ¬ 1.14.0 çš„æºç ä½œä¸ºåˆ†æã€‚ åœ¨ &lt;a href="https://github.com/webpack/webpack/blob/v1.14.0/lib/Compilation.js#L194-L204">lib/Compilation.js&lt;/a> ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™æ ·ä¸€æ®µä»£ç ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-javascript" data-lang="javascript">&lt;span class="kd">var&lt;/span> &lt;span class="nx">errorAndCallback&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kd">function&lt;/span> &lt;span class="nx">errorAndCallback&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">err&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">err&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">dependencies&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">dependencies&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="nx">err&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">origin&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">module&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="nx">module&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">dependenciesErrors&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">push&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">err&lt;/span>&lt;span class="p">);&lt;/span>
&lt;span class="mi">_&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">errors&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">push&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">err&lt;/span>&lt;span class="p">);&lt;/span>
&lt;span class="k">if&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">bail&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">callback&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">err&lt;/span>&lt;span class="p">);&lt;/span>
&lt;span class="p">}&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">callback&lt;/span>&lt;span class="p">();&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="p">};&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>åœ¨æºç ä¸­å¯ä»¥çœ‹åˆ°è¿™ä¸ªå‡½æ•°å…¶å®è¢«è°ƒç”¨çš„è¿˜æ¯”è¾ƒå¤šï¼Œ ä¾‹å¦‚ï¼šåœ¨æ¨¡å—ä¸ºå¯é€‰çš„æ—¶å€™ï¼Œ ä¼šåˆ¤æ–­åªæ˜¯æŠ›å‡ºè­¦å‘Šè¿˜æ˜¯å¤„ç†é”™è¯¯ï¼Œ è€Œä¸Šé¢è¿™æ®µä»£ç è‡ªç„¶ä¹Ÿä¸å¿…å¤šæ•°ï¼Œ å…³é”®ç‚¹åœ¨äº &lt;code>bail&lt;/code> çš„å€¼ï¼Œ è€Œæˆ‘ä»¬ç»§ç»­æ‰¾ï¼Œ å¯ä»¥çœ‹åˆ°åœ¨ &lt;code>bin/config-optimist.js&lt;/code> ä¸­æœ‰å¯¹ &lt;code>bail&lt;/code> å‚æ•°çš„è§£æï¼Œ è¿™æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ã€‚è€Œå› ä¸ºæ²¡æœ‰å¤ªå¤šæè¿°ï¼Œ æ‰€ä»¥è¿™ä¸ªå‚æ•°å°±ç»å¸¸å®¹æ˜“è¢«å¿½ç•¥ã€‚&lt;/p>
&lt;h1 id="è§£å†³æ–¹æ¡ˆ">è§£å†³æ–¹æ¡ˆ&lt;/h1>
&lt;h3 id="1-åŠ -bail-å‚æ•°">1. åŠ  &lt;strong>bail&lt;/strong> å‚æ•°&lt;/h3>
&lt;p>åŸºäºä¸Šé¢ç®€è¦çš„åˆ†æï¼Œ æˆ‘ä»¬æ¥å°è¯•ä¸‹ &lt;code>bail&lt;/code> å‚æ•°çš„ä½œç”¨ã€‚ ä»ç„¶ä½¿ç”¨ä¸Šé¢çš„ä¾‹å­ï¼š&lt;/p>
&lt;p>æˆ‘ä»¬ä½¿ç”¨ &lt;code>webpack --bail true app.js app.bundle.js&lt;/code> è¿›è¡Œæµ‹è¯•&lt;/p>
&lt;p>&lt;img src="http://moelove.qiniudn.com/webpack-bail.png" alt="webpack-bail.png">&lt;/p>
&lt;p>å¯ä»¥çœ‹åˆ°ï¼Œ ä½¿ç”¨ &lt;code>bail&lt;/code> å‚æ•°å¹¶ä¼ é€’ &lt;code>true&lt;/code> è¿›å»ï¼Œ åœ¨é‡åˆ°é”™è¯¯çš„æ—¶å€™ï¼Œæ‰“åŒ…è¿‡ç¨‹å°†ä¼šé€€å‡ºï¼Œ &lt;code>return code&lt;/code> ä¸º &lt;code>1&lt;/code> ä¸”æŠŠé”™è¯¯ä¿¡æ¯æ‰“å°åˆ° &lt;code>stderr&lt;/code> .&lt;/p>
&lt;h3 id="2-ä½¿ç”¨-webpack-fail-plugin">2. ä½¿ç”¨ webpack-fail-plugin&lt;/h3>
&lt;p>&lt;a href="https://www.npmjs.com/package/webpack-fail-plugin">webpack-fail-plugin&lt;/a> æ˜¯ä¸“ä¸ºè§£å†³è¿™ä¸ªé—®é¢˜è€Œç”Ÿçš„ï¼Œå®ƒä¼šåœ¨é”™è¯¯å‘ç”Ÿçš„æ—¶å€™ &lt;code>return 1&lt;/code>. ä½¿ç”¨æ–¹æ³•ä¹Ÿå¾ˆç®€å•ï¼š&lt;/p>
&lt;p>å®‰è£…ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">npm install webpack-fail-plugin
&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä½¿ç”¨ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-javascript" data-lang="javascript">&lt;span class="kd">var&lt;/span>Â &lt;span class="nx">failPlugin&lt;/span>Â &lt;span class="o">=&lt;/span>Â &lt;span class="nx">require&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;webpack-fail-plugin&amp;#39;&lt;/span>&lt;span class="p">);&lt;/span>
Â 
&lt;span class="nx">module&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">exports&lt;/span>Â &lt;span class="o">=&lt;/span>Â &lt;span class="p">{&lt;/span>
Â Â Â Â &lt;span class="c1">//configÂ 
&lt;/span>&lt;span class="c1">&lt;/span>Â Â Â Â &lt;span class="nx">plugins&lt;/span>&lt;span class="o">:&lt;/span>Â &lt;span class="p">[&lt;/span>
Â Â Â Â Â Â Â Â &lt;span class="nx">failPlugin&lt;/span>
Â Â Â Â &lt;span class="p">]&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="3ä½¿ç”¨-done-plugin">3.ä½¿ç”¨ done plugin&lt;/h3>
&lt;p>å…·ä½“ç”¨æ³•å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-javascript" data-lang="javascript">&lt;span class="c1">// ...
&lt;/span>&lt;span class="c1">&lt;/span>&lt;span class="nx">plugins&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;span class="c1">// ...
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="kd">function&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">plugin&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;done&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kd">function&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">stats&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">stats&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">compilation&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">errors&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="nx">stats&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">compilation&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">errors&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">length&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">console&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">stats&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">compilation&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">errors&lt;/span>&lt;span class="p">);&lt;/span>
&lt;span class="nx">process&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">exit&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">);&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="c1">// ...
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="p">});&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="c1">// ...
&lt;/span>&lt;span class="c1">&lt;/span>&lt;span class="p">],&lt;/span>
&lt;span class="c1">// ...
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="4-ä½¿ç”¨-webpack-2">4. ä½¿ç”¨ webpack 2&lt;/h3>
&lt;p>ä¸è¿‡ webpack 2 ç°åœ¨è¿˜åœ¨ beta é˜¶æ®µï¼Œå¯ä»¥æœŸå¾…ä¸‹ã€‚ ï¼ˆwebpack 2 ä¹Ÿä»ç„¶æ˜¯ä½¿ç”¨ bail å‚æ•°ï¼‰&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Webpack/">Webpack</category><category domain="https://moelove.info/tags/Tool/">Tool</category><category domain="https://moelove.info/tags/%E5%89%8D%E7%AB%AF/">å‰ç«¯</category></item><item><title>Composer ä½¿ç”¨æŠ€å·§ç®€è¿°</title><link>https://moelove.info/2016/12/16/Composer-%E4%BD%BF%E7%94%A8%E6%8A%80%E5%B7%A7%E7%AE%80%E8%BF%B0/</link><guid isPermaLink="true">https://moelove.info/2016/12/16/Composer-%E4%BD%BF%E7%94%A8%E6%8A%80%E5%B7%A7%E7%AE%80%E8%BF%B0/</guid><pubDate>Fri, 16 Dec 2016 00:49:11 +0000</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>æœ€è¿‘ä½¿ç”¨äº†ä¸–ç•Œæœ€å¥½çš„è¯­è¨€ PHP ç”¨æ¥ç®¡ç†ä¾èµ–å…³ç³»çš„å·¥å…· &lt;code>Composer&lt;/code>. ç¨å¾®åšç‚¹è®°å½•, ä»¥åšå¤‡å¿˜. å¦‚æœ‰é”™è¯¯è¿˜æœ›æŒ‡å‡º.&lt;/p>
&lt;/blockquote>
&lt;h1 id="å®‰è£…">å®‰è£…&lt;/h1>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">php -r &lt;span class="s2">&amp;#34;copy(&amp;#39;https://getcomposer.org/installer&amp;#39;, &amp;#39;composer-setup.php&amp;#39;);&amp;#34;&lt;/span>
php -r &lt;span class="s2">&amp;#34;if (hash_file(&amp;#39;SHA384&amp;#39;, &amp;#39;composer-setup.php&amp;#39;) === &amp;#39;aa96f26c2b67226a324c27919f1eb05f21c248b987e6195cad9690d5c1ff713d53020a02ac8c217dbf90a7eacc9d141d&amp;#39;) { echo &amp;#39;Installer verified&amp;#39;; } else { echo &amp;#39;Installer corrupt&amp;#39;; unlink(&amp;#39;composer-setup.php&amp;#39;); } echo PHP_EOL;&amp;#34;&lt;/span>
php composer-setup.php
php -r &lt;span class="s2">&amp;#34;unlink(&amp;#39;composer-setup.php&amp;#39;);&amp;#34;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¸Šè¿°ä»£ç æ¥è‡ª&lt;a href="https://getcomposer.org/download/">å®˜ç½‘&lt;/a>.&lt;/p>
&lt;h2 id="å±€éƒ¨å®‰è£…">å±€éƒ¨å®‰è£…&lt;/h2>
&lt;p>ä¸Šè¿°ä»£ç æ‰§è¡Œå®Œæˆå, åªæ˜¯ä¸‹è½½åˆ°äº† &lt;code>composer.phar&lt;/code> æ–‡ä»¶, å¯ä»¥é€šè¿‡ &lt;code>php composer.phar&lt;/code> åœ¨ä»»æ„ä½ç½®æ‰§è¡Œ.&lt;/p>
&lt;h2 id="å…¨å±€å®‰è£…">å…¨å±€å®‰è£…&lt;/h2>
&lt;p>å…¨å±€å®‰è£…åªæ˜¯æŠŠ &lt;code>composer.phar&lt;/code> å®‰è£…åˆ° PATH ä¸‹å³å¯. å¯ä»¥åƒä¸‹é¢è¿™æ ·:&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">sudo mv composer.phar /usr/local/bin/composer
&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="å›½å†…é•œåƒåŠ é€Ÿ">å›½å†…é•œåƒåŠ é€Ÿ&lt;/h1>
&lt;p>ä½¿ç”¨&lt;a href="http://pkg.phpcomposer.com/">Composerä¸­æ–‡ç½‘&lt;/a>æä¾›çš„ä¸­å›½å…¨é‡é•œåƒè¿›è¡ŒåŠ é€Ÿ.&lt;/p>
&lt;h2 id="å•é¡¹ç›®åŠ é€Ÿ">å•é¡¹ç›®åŠ é€Ÿ&lt;/h2>
&lt;p>è¿›å…¥é¡¹ç›®ç›®å½•(å³ &lt;code>composer.json&lt;/code> æ–‡ä»¶æ‰€åœ¨ç›®å½•) æ‰§è¡Œ:&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">composer config repo.packagist composer https://packagist.phpcomposer.com
&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™æ¡å‘½ä»¤å°†åœ¨ &lt;code>composer.json&lt;/code> æ–‡ä»¶çš„æœ«å°¾æ·»åŠ é•œåƒåŠ é€Ÿé…ç½®:&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-json" data-lang="json">
&lt;span class="s2">&amp;#34;repositories&amp;#34;&lt;/span>&lt;span class="err">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nt">&amp;#34;packagist&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nt">&amp;#34;type&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;composer&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="nt">&amp;#34;url&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;https://packagist.phpcomposer.com&amp;#34;&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="å…¨å±€åŠ é€Ÿ">å…¨å±€åŠ é€Ÿ&lt;/h2>
&lt;p>å¯ä»¥ç›´æ¥æ‰§è¡Œ:&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">composer config --global repo.packagist composer https://packagist.phpcomposer.com
&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="é…ç½®">é…ç½®&lt;/h1>
&lt;p>å‚è€ƒ &lt;a href="https://getcomposer.org/doc/06-config.md">å®˜æ–¹é…ç½®æ–‡æ¡£&lt;/a>.&lt;/p>
&lt;p>å› ä¸º &lt;code>composer&lt;/code> é»˜è®¤æƒ…å†µä¸‹, ä¼šåœ¨ä½¿ç”¨çš„ç”¨æˆ·çš„å®¶ç›®å½•ä¸‹ç”Ÿæˆ &lt;code>.composer&lt;/code> æ–‡ä»¶å¤¹, å­˜æ”¾é…ç½®ç›¸å…³, æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å¯¹è¿™äº›éƒ¨åˆ†è¿›è¡Œé…ç½®.&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">composer config --global data-dir /www/.composer
composer config --global cache-dir /www/.composer
&lt;span class="c1"># cache-files-maxsize ä¹Ÿå¯ä»¥ç¨å¾®å¤§ä¸€ç‚¹, è¿˜æœ‰ç¼“å­˜æ—¶é—´&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="auth-ç›¸å…³">Auth ç›¸å…³&lt;/h1>
&lt;p>Gitlab token å¯ä»¥æŸ¥çœ‹ &lt;a href="https://docs.gitlab.com/ee/api/README.html#oauth-2-tokens">https://docs.gitlab.com/ee/api/README.html#oauth-2-tokens&lt;/a>&lt;/p>
&lt;h1 id="æ³¨æ„äº‹é¡¹">æ³¨æ„äº‹é¡¹&lt;/h1>
&lt;p>å½“ &lt;code>type&lt;/code> é…ç½®ä¸º &lt;code>gitlab&lt;/code>, &lt;code>github&lt;/code> ç­‰æ—¶, ä¼šä¼˜å…ˆé€šè¿‡ &lt;code>.composer/auth.json&lt;/code> æ–‡ä»¶ä¸­çš„é…ç½®æ¥é€‰æ‹©è®¤è¯ä¿¡æ¯è¿›è¡ŒéªŒè¯. å¦‚æœæ²¡æœ‰è§£å†³ Auth è®¤è¯ç›¸å…³é—®é¢˜, å¯ä»¥ä½¿ç”¨æ™®é€šçš„ &lt;code>vcs&lt;/code> ä¾‹å¦‚ &lt;code>git&lt;/code> æ¥ä½¿ç”¨.&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/PHP/">PHP</category><category domain="https://moelove.info/tags/Tool/">Tool</category></item><item><title>Git workflow è¯¦è°ˆ</title><link>https://moelove.info/2016/12/05/Git-workflow-%E8%AF%A6%E8%B0%88/</link><guid isPermaLink="true">https://moelove.info/2016/12/05/Git-workflow-%E8%AF%A6%E8%B0%88/</guid><pubDate>Mon, 05 Dec 2016 22:40:41 +0000</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;p>ä½œä¸ºä¸€åå·¥ç¨‹å¸ˆï¼Œ &lt;code>Git&lt;/code> åœ¨æ—¥å¸¸å¼€å‘ä¸­æ˜¯ä¸å¯æˆ–ç¼ºçš„å·¥å…·ã€‚
è¿™é‡Œè¯¦ç»†ä»‹ç»å‡ ç§æ¯”è¾ƒå¸¸ç”¨çš„åŸºäº Git çš„å·¥ä½œæµæ¨¡å‹, ä»¥ä¾¿äºå›¢é˜Ÿåä½œçš„è§„èŒƒåŒ–å’Œæ•ˆç‡æå‡ã€‚&lt;/p>
&lt;h1 id="ä¸­å¿ƒåŒ–å·¥ä½œæµ">ä¸­å¿ƒåŒ–å·¥ä½œæµ&lt;/h1>
&lt;p>ä½¿ç”¨è¿‡SVNçš„åº”è¯¥éƒ½çŸ¥é“ï¼Œ SVNä½¿ç”¨çš„æ˜¯é›†ä¸­å¼ç®¡ç†æµç¨‹ï¼Œ å¦‚æœä½ åˆšä»SVN åˆ‡æ¢åˆ° Git ï¼Œ ä½ å¯ä»¥å°è¯•ä½¿ç”¨ä¸­å¿ƒåŒ–å·¥ä½œæµçš„æ–¹å¼ã€‚è¿™æ ·ï¼Œä½ å‡ ä¹ä¸éœ€è¦å˜æ›´ä¹‹å‰çš„å·¥ä½œæ–¹å¼ï¼Œ å°±å¯ä»¥å®Œæˆå¹³æ»‘çš„è¿‡æ¸¡äº†ã€‚ è€Œä¸”åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­è¿˜å¯ä»¥çœ‹åˆ° Git ä¼˜äº SVN çš„åœ°æ–¹ï¼š
ç¬¬ä¸€ï¼Œæ¯ä¸ªæˆå‘˜éƒ½å¯ä»¥åœ¨æœ¬åœ°æ‹¥æœ‰ä¸€ä»½å®Œæ•´çš„é¡¹ç›®ä»£ç ä»“åº“ï¼Œè€Œä¸åªæ˜¯ä¸€ä¸ªå·¥ä½œåŒºçš„å‰¯æœ¬ï¼Œä»»ä½•äººéƒ½å¯ä»¥åœ¨æœ¬åœ°æ‰§è¡Œ &lt;code>add&lt;/code> å’Œ &lt;code>commit&lt;/code> ï¼Œè€Œä¸éœ€è¦è€ƒè™‘è¿œç«¯ä»“åº“æ˜¯å¦æœ‰å˜æ›´ï¼Œç›´åˆ°éœ€è¦çš„æ—¶å€™å†å»æäº¤å³å¯ã€‚
ç¬¬äºŒï¼ŒGit çš„å·¥ä½œåŒºã€æš‚å­˜åŒºã€å¼•ç”¨æ›´æ–°ç­‰è®¾è®¡ï¼Œå¯ä»¥ç»™å¼€å‘è€…æ›´å¤šè‡ªç”±æ¥åˆ‡æ¢å½“å‰å·¥ä½œï¼Œä¸”ä¸ä¼šé€ æˆä»£ç ä¸¢å¤±ã€‚&lt;/p>
&lt;h2 id="å·¥ä½œç»†èŠ‚">å·¥ä½œç»†èŠ‚&lt;/h2>
&lt;p>ä¸­å¿ƒåŒ–å·¥ä½œæµçš„æ–¹å¼æ˜¯ï¼šåœ¨è¿œç«¯ï¼ˆè¿œç«¯å¯ä»¥æ˜¯æœåŠ¡å™¨ç«¯ï¼Œä¹Ÿå¯ä»¥æ˜¯æœ¬åœ°çš„ä»»æ„ç›®å½•ï¼‰æ–°å»ºä¸€ä¸ªä»“åº“ï¼Œé»˜è®¤æ˜¯ master åˆ†æ”¯ï¼Œä½œä¸ºå”¯ä¸€çš„ä¸­å¿ƒä»“åº“ã€‚ æ‰€æœ‰äººéƒ½ &lt;code>clone&lt;/code> è¿™ä¸ªä»“åº“ä½œä¸ºæœ¬åœ°ä»“åº“ï¼Œå¹¶åœ¨æœ¬åœ°ä»“åº“è¿›è¡Œå¼€å‘ã€‚æœ¬åœ°çš„æäº¤æ˜¯å’Œè¿œç«¯ä»“åº“æ— å…³çš„ï¼Œç­‰éœ€è¦çš„æ—¶å€™å† &lt;code>push&lt;/code> è¿›ä¸»ä»“åº“çš„ master åˆ†æ”¯å³å¯ã€‚&lt;/p>
&lt;p>åœ¨è¿™ç§æ–¹å¼ä¸‹ï¼Œ è¿œç«¯æ˜¯å”¯ä¸€ç¡®å®šçš„ä¸­å¿ƒä»“åº“ï¼Œ æ‰€æœ‰äººéƒ½è¦ä»¥è¿™ä¸ªä»“åº“ä¸ºå‡†ã€‚ æ‰€ä»¥ï¼Œåœ¨æäº¤ä¹‹å‰è¦å…ˆ &lt;code>fetch&lt;/code> æœ€æ–°æäº¤ï¼Œåœ¨è¿™äº›æäº¤ä¹‹ä¸Šä½œå‡ºè‡ªå·±çš„æ›´æ”¹(ä¸€èˆ¬æˆ‘ä»¬ä½¿ç”¨ &lt;code>rebase&lt;/code>æ¥å®Œæˆ)ã€‚&lt;/p>
&lt;p>å¦‚æœæœ¬åœ°çš„ä¿®æ”¹å’Œè¿œç«¯ä»“åº“ä¸­çš„å˜æ›´å‘ç”Ÿäº†å†²çªï¼Œé‚£ä¹ˆ Git ä¼šæš‚åœ &lt;code>rebase&lt;/code> ï¼Œå¹¶è®©ä½ æ¥è§£å†³è¿™äº›å†²çªã€‚æˆ‘ä»¬å¯ä»¥å¾ˆç®€å•çš„ä½¿ç”¨ &lt;code>git status&lt;/code> å’Œ &lt;code>git add&lt;/code> ç­‰å‘½ä»¤å®Œæˆå†²çªçš„åˆå¹¶ã€‚ å¦å¤–, å¦‚æœæˆ‘ä»¬è§£å†³ä¸äº†å†²çª, æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ &lt;code>git rebase --abort&lt;/code> å¾ˆå®¹æ˜“çš„é€€å‡º &lt;code>rebase&lt;/code> çš„è¿‡ç¨‹ã€‚&lt;/p>
&lt;p>è¿™æ ·æ¯å¤©çš„å·¥ä½œæ–¹å¼å°±å˜æˆäº†ï¼Œä»ä¸­å¿ƒä»“åº“æ‹‰å–æœ€æ–°ä»£ç ï¼Œ ç„¶åå¼€å§‹ä¸€å¤©çš„å·¥ä½œï¼Œ å¼€å‘å®Œæˆåï¼Œæ‹‰å–ä¸­å¿ƒä»“åº“çš„æ›´æ–°ï¼Œ åˆå¹¶ä»£ç åï¼Œ å†æäº¤è‡³ä¸­å¿ƒä»“åº“ï¼Œ ç»“æŸä¸€å¤©çš„å·¥ä½œã€‚ è¿™æ ·çš„å¥½å¤„å°±æ˜¯ä¸éœ€è¦å˜æ›´åŸå…ˆï¼ˆä½¿ç”¨SVNï¼‰çš„å·¥ä½œæ–¹å¼ã€‚å½“ç„¶å¼Šç«¯ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œä½ å¹¶ä¸çŸ¥é“ä¸­å¿ƒä»“åº“çš„ä»£ç æ˜¯å¦æ˜¯ç¨³å®šçš„ï¼Œæˆ–è€…è¯´å¹¶ä¸èƒ½ç¡®å®šå½“ä½ çš„ä»£ç å’Œä¸­å¿ƒä»“åº“ä»£ç åˆå¹¶åï¼Œæ˜¯å¦æ˜¯ç¨³å®šçš„ï¼Œå¸¦æ¥çš„é—®é¢˜å°±æ˜¯å¼€å‘è¿›åº¦å’Œå›æ»šä¸é‚£ä¹ˆæ–¹ä¾¿æ§åˆ¶ã€‚&lt;/p>
&lt;h2 id="ç¤ºä¾‹">ç¤ºä¾‹&lt;/h2>
&lt;p>æˆ‘ä»¬æœ‰ä¸¤ä½ç¨‹åºå‘˜, A å’Œ B, ä¸¤äººåŒæ—¶åœ¨å¯¹ä¸€ä¸ªé¡¹ç›®åšå¼€å‘, å¹¶ä¸”ä½¿ç”¨ Git çš„ä¸­å¿ƒåŒ–å·¥ä½œæµæ–¹å¼ã€‚&lt;/p>
&lt;p>&lt;strong>1.åˆ›å»ºè¿œç«¯ä¸­å¿ƒä»“åº“&lt;/strong>&lt;/p>
&lt;p>è¿™é‡Œæˆ‘ä»¬æœ‰ä¸¤ç§æ–¹å¼ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>å€ŸåŠ©äºå·²ç»æ­å»ºå¥½çš„å¹³å° GitHub/GitLab ä¹‹ç±»çš„ï¼Œç‚¹å‡» &lt;code>create repo&lt;/code> å³å¯ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>åœ¨è¿œç«¯(è¿™é‡Œåªæ˜¯ä¸ºäº†åŒºåˆ«æœ¬åœ°ä»“åº“ï¼Œäº‹å®ä¸Šï¼Œä½¿ç”¨ä»»ä½•ä¸€ä¸ªå…¶ä»–äººå¯ä»¥è¿é€šçš„æœºå™¨éƒ½å¯ä»¥,åŒ…æ‹¬è‡ªå·±æœ¬åœ°å…¶ä»–ç›®å½•) åˆ›å»ºä¸€ä¸ª &lt;strong>è£¸ä»“åº“&lt;/strong> ï¼Œåˆ›å»ºè£¸ä»“åº“å’Œæˆ‘ä»¬å¹³æ—¶åˆ›å»ºæœ¬åœ°ä»“åº“çš„åŒºåˆ«ï¼Œå¯ä»¥å‚è€ƒæˆ‘å¦ä¸€ç¯‡æ–‡ç«  &lt;a href="http://www.jianshu.com/p/9a4e8750aea6">Git æœ¬åœ°ä»“åº“å’Œè£¸ä»“åº“&lt;/a> ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>è¿™é‡Œä»¥ç¬¬äºŒç§æ–¹å¼ä¸ºä¾‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="c1"># --bare å‚æ•°å¿…é¡»æœ‰&lt;/span>
git init --bare /the/repo/path.git
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>2.æ‰€æœ‰äººéƒ½ clone ä¸­å¿ƒä»“åº“åˆ°æœ¬åœ°ä½œä¸ºæœ¬åœ°ä»“åº“&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">git clone /the/repo/path.git
&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ³¨æ„ä»“åº“åœ°å€å¿…é¡»æ˜¯æ­£ç¡®çš„ï¼Œ ä¸”æœ‰æƒé™è®¿é—®æ‰èƒ½ &lt;code>clone&lt;/code> æˆåŠŸã€‚&lt;/p>
&lt;p>&lt;strong>3.ç¨‹åºå‘˜ A åœ¨ä»–çš„æœ¬åœ°ä»“åº“è¿›è¡ŒåŠŸèƒ½å¼€å‘å¹¶è¿›è¡Œå‘å¸ƒ&lt;/strong>&lt;/p>
&lt;p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬é€šè¿‡ &lt;code>git status&lt;/code> çœ‹çœ‹å½“å‰çŠ¶æ€ï¼Œå¹¶é€šè¿‡ &lt;code>git add &lt;/code> å’Œ &lt;code>git commit&lt;/code> ç­‰å‘½ä»¤å®Œæˆæœ¬åœ°ä»“åº“çš„æäº¤ã€‚ å½“ç„¶è¿™ä¸ªæäº¤å½±å“çš„ä¹Ÿåªæ˜¯æœ¬åœ°ä»“åº“è€Œå·²ï¼Œå¹¶æ²¡æœ‰å¯¹ä¸­å¿ƒä»“åº“äº§ç”Ÿä»»ä½•å½±å“ï¼Œæ‰€ä»¥æˆ‘ä»¬æ—¢ä¸éœ€è¦å…³å¿ƒåˆ«äººæœ‰ä»€ä¹ˆæäº¤ï¼Œä¹Ÿä¸ç”¨æ‹…å¿ƒæˆ‘ä»¬å½“å‰çš„æäº¤æ˜¯å¦å¯¹åˆ«äººé€ æˆäº†å½±å“ã€‚å½“ A è®¤ä¸ºè‡ªå·±æ‰€å¼€å‘çš„åŠŸèƒ½å·²ç»å®Œæˆï¼Œ é‚£ä»–å°†æ‰§è¡Œ &lt;code>git push origin master&lt;/code> è¿™æ ·çš„æ“ä½œï¼Œå°†è‡ªå·±æœ¬åœ°ä»“åº“æ‰€æœ‰ä¸å­˜åœ¨äºä¸­å¿ƒä»“åº“çš„æäº¤éƒ½ &lt;code>push&lt;/code> åˆ°è¿œç«¯çš„ä¸­å¿ƒä»“åº“ä¸Šã€‚&lt;/p>
&lt;p>&lt;strong>4.ç¨‹åºå‘˜ B åœ¨ä»–æœ¬åœ°ä»“åº“è¿›è¡ŒåŠŸèƒ½å¼€å‘&lt;/strong>&lt;/p>
&lt;p>B åœ¨ &lt;code>clone&lt;/code> ä¸­å¿ƒä»“åº“åæ‰€åšçš„æ“ä½œå’Œ A ä¸€æ ·ï¼Œåœ¨æœ¬åœ°ä»“åº“è¿›è¡Œé¡¹ç›®å¼€å‘ï¼Œå¹¶åœ¨æœ¬åœ°ä»“åº“è¿›è¡Œæäº¤ï¼Œä»–ä¸éœ€è¦çŸ¥é“ä¸­å¿ƒä»“åº“å‘ç”Ÿäº†ä»€ä¹ˆæ ·çš„å˜åŒ–ã€‚&lt;/p>
&lt;p>&lt;strong>5.ç¨‹åºå‘˜ B å°†è‡ªå·±å¼€å‘çš„åŠŸèƒ½å¹¶è¿›è¡Œå‘å¸ƒ&lt;/strong>&lt;/p>
&lt;p>B åœ¨ç¡®è®¤è‡ªå·±å¼€å‘çš„åŠŸèƒ½å·²ç»å®Œæˆåï¼Œæƒ³è¦å°†è‡ªå·±çš„ä»£ç é€šè¿‡ &lt;code>git push origin master&lt;/code> è¿™æ ·çš„æ“ä½œå‘å¸ƒè‡³ä¸­å¿ƒä»“åº“ï¼Œä½†æ˜¯å´è¢«ä¸­å¿ƒä»“åº“æç¤ºä»–çš„ä¿®æ”¹å·²ç»å’Œä¸­å¿ƒä»“åº“æœ‰äº†åˆ†å‰ï¼Œ éœ€è¦ä»–å…ˆæ‰§è¡Œ &lt;code>git pull&lt;/code> ä¹‹ç±»çš„æ“ä½œï¼Œ å°†ä¸­å¿ƒä»“åº“ä¸Š A çš„æäº¤ä¸ B æœ¬åœ°çš„æäº¤è¿›è¡Œåˆå¹¶æ‰å…è®¸ä»–å¹¶å…¥ä¸­å¿ƒä»“åº“ã€‚æ‰€ä»¥ï¼Œä»–æ‰§è¡Œäº† &lt;code>git pull --rebase origin master&lt;/code> æ¥å°†ä¸­å¿ƒä»“åº“çš„ä¿®æ”¹å¹¶å…¥ä»–çš„æœ¬åœ°ä»“åº“ã€‚ä½¿ç”¨ &lt;code>--rebase&lt;/code> å‚æ•°çš„æ„ä¹‰åœ¨äº &lt;code>fetch&lt;/code> æ‰§è¡Œå®Œæˆåï¼Œå°†æŠŠ B çš„æ‰€æœ‰æäº¤ç§»è‡³ &lt;code>master&lt;/code> é¡¶ç«¯ã€‚&lt;/p>
&lt;p>å½“ç„¶è¿™é‡Œä¸ä½¿ç”¨ &lt;code>--rebase&lt;/code> å‚æ•°ä¹Ÿä¼šæˆåŠŸï¼Œåªä¸è¿‡æ˜¯ä¼šç”Ÿæˆä¸€ä¸ªåˆå¹¶æäº¤ï¼Œæœ‰äº›æƒ…å†µä¸‹ä½¿ç”¨ &lt;code>--ff&lt;/code> å‚æ•°ä¹Ÿå¯ä»¥é¿å…äº§ç”Ÿåˆå¹¶æäº¤ã€‚åœ¨è¿™é‡Œä½¿ç”¨ &lt;code>--rebase&lt;/code> åªæ˜¯ä¸€ä¸ªå»ºè®®æ“ä½œã€‚&lt;/p>
&lt;p>å¦‚æœ A å’Œ B ä¿®æ”¹çš„æ–‡ä»¶æ²¡æœ‰å…³è”ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ä¼šç›´æ¥å®Œæˆåˆå¹¶ï¼Œå¦‚æœå‘ç”Ÿå†²çªï¼ŒGit å°†ä¼šæš‚åœ &lt;code>rebase&lt;/code> çš„è¿‡ç¨‹ï¼Œå¹¶åˆ—å‡ºå½“å‰å†²çªçš„æ–‡ä»¶ï¼Œä½ å¯ä»¥ç®€å•çš„ä½¿ç”¨ &lt;code>git status&lt;/code> å’Œ &lt;code>git add&lt;/code> ç­‰å‘½ä»¤è¿›è¡Œåˆå¹¶ï¼Œåˆå¹¶åä½¿ç”¨ &lt;code>git rebase --continue&lt;/code> ç»§ç»­ rebase çš„è¿‡ç¨‹ã€‚æˆ–è€…ä½¿ç”¨ &lt;code>git rebase --abort&lt;/code> é€€å‡º rebase è¿‡ç¨‹ã€‚&lt;/p>
&lt;p>åœ¨ B åˆå¹¶å®Œæˆåï¼Œå¯ä»¥æ‰§è¡Œ &lt;code>git push origin master&lt;/code> å°†è‡ªå·±å¼€å‘çš„åŠŸèƒ½å‘å¸ƒè‡³ä¸­å¿ƒä»“åº“ã€‚&lt;/p>
&lt;p>è‡³æ­¤ï¼ŒåŸºç¡€çš„ä¸­å¿ƒåŒ–å·¥ä½œæµæ–¹å¼å°±ä»‹ç»å®Œäº†ï¼Œä½†æ˜¯è¿™é‡Œä¹Ÿå¾ˆå®¹æ˜“çœ‹å‡ºæ¥å…¶ä¸­çš„é—®é¢˜ï¼Œé™¤äº†å‰é¢è¯´åˆ°è¿‡çš„ä»¥å¤–ï¼Œè¿˜æœ‰å°±æ˜¯æ•ˆç‡ä½ä¸‹ï¼Œå¦‚æœå¾ˆå¤šäººéƒ½åœ¨æŒç»­è¿›è¡Œæäº¤ï¼Œé‚£å¾ˆå½±å“æ–°åŠŸèƒ½çš„æäº¤ï¼ˆå¤šäººæŒç»­æ€§è¿›è¡Œæäº¤ï¼‰ã€‚ ä¸€ä¸ªæ¯”è¾ƒå®¹æ˜“æå‡æ•ˆç‡çš„æ–¹å¼å°±æ˜¯åˆ‡æ¢åˆ°&lt;strong>ç‰¹æ€§åˆ†æ”¯å·¥ä½œæµ&lt;/strong>çš„æ–¹å¼ã€‚&lt;/p>
&lt;h1 id="ç‰¹æ€§åˆ†æ”¯å·¥ä½œæµ">ç‰¹æ€§åˆ†æ”¯å·¥ä½œæµ&lt;/h1>
&lt;p>åŸºäºç‰¹æ€§çš„åˆ†æ”¯å·¥ä½œæµï¼Œå¯ä»¥ä¸ºæ¯ä¸ªç‰¹æ€§åšéš”ç¦»ï¼Œé¿å…å¯¹ä¸­å¿ƒä»“åº“ä¸»å¹²ä»£ç é€ æˆå½±å“ã€‚&lt;/p>
&lt;h2 id="å·¥ä½œç»†èŠ‚-1">å·¥ä½œç»†èŠ‚&lt;/h2>
&lt;p>é¡¾åæ€ä¹‰ï¼Œ å°±æ˜¯æ ¹æ®æ¯ä¸ªç‰¹æ€§éƒ½ä¼šå¼€ä¸€ä¸ªæ–°çš„åˆ†æ”¯ï¼Œæ¯ä¸ªåˆ†æ”¯éƒ½åº”è¯¥åŒ…å«ç€æè¿°æ€§çš„åç§°ï¼Œæ— è®ºæ˜¯ä¸€ä¸ªäººå¼€å‘ï¼Œè¿˜æ˜¯å¤šäººååŒï¼Œè¯¥ç‰¹æ€§çš„å…¨éƒ¨å¼€å‘å·¥ä½œéƒ½åœ¨è¿™ä¸ªåˆ†æ”¯ä¸Šè¿›è¡Œã€‚å¾…è¯¥ç‰¹æ€§å¼€å‘å®Œæˆåï¼Œ å¹¶å…¥ä¸»åˆ†æ”¯ï¼Œç„¶ååˆ é™¤åˆ†æ”¯ï¼Œä»£ç ä¸Šçº¿ã€‚&lt;/p>
&lt;p>è¿™ç§æƒ…å†µä¸‹ï¼Œ æœ€å¤§çš„ä¼˜åŠ¿åœ¨äºï¼Œ æ‰€æœ‰çš„ç‰¹æ€§å¼€å‘éƒ½å¯ä»¥å¹¶è¡Œå¤„ç†ã€‚ ä¸å¿…è¦åƒä¸­å¿ƒåŒ–å·¥ä½œæµæ–¹å¼ï¼Œ æ¯ä¸ªäººçš„å˜åŠ¨éƒ½å¯èƒ½å¼•èµ·å…¶ä»–çš„äººçš„ä»£ç åˆå¹¶ï¼Œ å¹¶ä¸”æ‰€æœ‰åŠŸèƒ½éƒ½æ‚ç³…åœ¨ä¸€èµ·ï¼Œ ä»æµ‹è¯•å’Œå›æ»šéƒ½ä¼šå˜å¾—å¾ˆç¹çã€‚ å¦å¤–çš„ä¸€ä¸ªå¥½å¤„å°±æ˜¯ç‰¹æ€§åˆ†æ”¯å¯ä»¥æ¨é€åˆ°ä¸­å¿ƒä»“åº“ï¼Œè¿™æ ·ä¹Ÿä¾¿äºå•ç‹¬æµ‹è¯•ã€‚&lt;/p>
&lt;p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç‰¹æ€§åˆ†æ”¯å¾€ä¸»åˆ†æ”¯åˆå¹¶çš„æ—¶æœºï¼Œåº”è¯¥æ˜¯è¯¥ç‰¹æ€§å¼€å‘å®Œæˆï¼Œå¹¶æµ‹è¯•é€šè¿‡ï¼Œé¿å…å¯¹ä¸»å¹²ä»£ç é€ æˆæ±¡æŸ“ã€‚&lt;/p>
&lt;p>åœ¨è¿›è¡Œåˆ†æ”¯éš”ç¦»åï¼Œæˆ‘ä»¬å‘ç°ï¼Œæˆ‘ä»¬å½“å‰åªå¤„ç†äº†å¼€å‘æ¨¡å¼ï¼Œä½†å¹¶æ²¡æœ‰æ¶µç›–ä¸€ä¸ªå¾ˆå®Œå¤‡çš„äº§å“ç”Ÿå‘½å‘¨æœŸï¼Œ å¼€å‘ã€å‘å¸ƒã€ç»´æŠ¤ç­‰è¿‡ç¨‹ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬æœ‰äº† Gitflow å·¥ä½œæµã€‚&lt;/p>
&lt;h1 id="gitflow-å·¥ä½œæµ">Gitflow å·¥ä½œæµ&lt;/h1>
&lt;p>åŸºäºGitflow çš„å·¥ä½œæµæ–¹å¼ï¼Œ è¿™ç§å·¥ä½œæµæ–¹å¼ï¼Œ ä¸»è¦æ˜¯ç®¡ç†ç€æ–°åŠŸèƒ½å¼€å‘ï¼Œå‘å¸ƒåŠç»´æŠ¤ç­‰æ¨¡å¼ï¼Œæ ¹æ®ä¸åŒç±»å‹çš„å·¥ä½œå¯¹åˆ†æ”¯è¿›è¡Œå®šä¹‰ï¼Œ åˆ†ä¸º &lt;strong>ç‰¹æ€§åˆ†æ”¯&lt;/strong> ï¼Œ&lt;strong>ä¿®å¤åˆ†æ”¯&lt;/strong>ï¼Œ&lt;strong>release åˆ†æ”¯&lt;/strong>ï¼Œ&lt;strong>å¼€å‘åˆ†æ”¯&lt;/strong> å’Œ &lt;strong>ä¸»åˆ†æ”¯&lt;/strong> ã€‚&lt;/p>
&lt;p>ä¸»åˆ†æ”¯ï¼šä¸­å¿ƒä»“åº“å»ºç«‹åçš„é»˜è®¤ master åˆ†æ”¯ï¼ˆå½“ç„¶ä½¿ç”¨å…¶ä»–åˆ†æ”¯ä¹Ÿå¯ä»¥ï¼Œä½†è¦ä¿è¯è¯¥åˆ†æ”¯æ˜¯å—ä¿æŠ¤çš„ï¼‰ã€‚ä¸»åˆ†æ”¯éšæ—¶ä¿æŒä»£ç æ˜¯ç¨³å®šçš„ï¼Œå¹¶ä¸”æœ‰æ˜ç¡®çš„ç‰ˆæœ¬æ ‡ç­¾ï¼Œåç»­ä»£ç å›æ»šç­‰æ“ä½œéƒ½å°†ä»ä¸»åˆ†æ”¯è¿›è¡Œã€‚&lt;/p>
&lt;p>å¼€å‘åˆ†æ”¯ï¼šä¸­å¿ƒä»“åº“å»ºç«‹åï¼Œä» master åˆ†æ”¯åˆ‡å‡ºæ¥ï¼Œæ­¤æ—¶ä¸ master åˆ†æ”¯ä¿æŒä¸€è‡´ã€‚åç»­æ¼”è¿›ä¸­ï¼Œå¼€å‘åˆ†æ”¯éšæ—¶ä¿æŒä»£ç æœ€æ–°ï¼Œä½†å´ä¸ä¸€å®šæ˜¯çº¿ä¸Šå®é™…è¿è¡Œçš„ä»£ç ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">git checkout -b develop
&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç‰¹æ€§åˆ†æ”¯ï¼šåº”è¯¥ä»å¼€å‘åˆ†æ”¯åˆ‡å‡ºï¼Œå¼€å‘å®Œæˆåï¼Œ å†åˆå¹¶è¿›å…¥å¼€å‘åˆ†æ”¯ï¼Œ å¦‚æœè¾¾åˆ°äº†å‘å¸ƒæ ‡å‡†ï¼Œ åˆ™ä»å¼€å‘åˆ†æ”¯åˆ‡å‡º release åˆ†æ”¯ï¼Œ åˆ‡å‡ºæ¥çš„è¿™ä¸ªåˆ†æ”¯ï¼Œåªåšè¯¥ç‰ˆæœ¬å†…çš„ä»£ç ä¿®å¤ï¼Œ ä¸å†åŠ å…¥æ–°åŠŸèƒ½ï¼Œ è¿™æ—¶æ­¤åˆ†æ”¯å¤„äºé”å®šçš„çŠ¶æ€ã€‚&lt;/p>
&lt;p>ä¿®å¤åˆ†æ”¯ï¼Œ ç”¨äºå¯¹çº¿ä¸Šä¸»åˆ†æ”¯ä»£ç çš„åŠæ—¶ä¿®å¤ï¼Œ å¾…ä¿®å¤å®Œæˆåï¼Œ åˆå¹¶è¿›å…¥ä¸»åˆ†æ”¯ï¼Œ å†å¹¶å…¥å¼€å‘åˆ†æ”¯ã€‚ ä¿®å¤åˆ†æ”¯åªèƒ½ä»ä¸»åˆ†æ”¯åˆ‡å‡ºã€‚&lt;/p>
&lt;p>å‘ç‰ˆåˆ†æ”¯ï¼Œ ä¸€èˆ¬å‘½åä¸º &lt;code>release-xxx&lt;/code> è¿™ä¸ªåˆ†æ”¯åªèƒ½ä»å¼€å‘åˆ†æ”¯åˆ‡å‡ºï¼Œ æœ€åå¹¶å…¥ä¸»åˆ†æ”¯ï¼Œæ‰“ä¸Šç‰ˆæœ¬å·çš„æ ‡ç­¾ï¼Œå®ƒä¹Ÿåº”è¯¥å¹¶å…¥å¼€å‘åˆ†æ”¯ï¼Œå¦‚æœä¸­é—´æœ‰å…¶ä»–ä¿®å¤çš„è¯ã€‚&lt;/p>
&lt;h1 id="fork-å·¥ä½œæµ">fork å·¥ä½œæµ&lt;/h1>
&lt;p>fork åˆ†æ”¯æµå’Œä¸Šé¢ä»‹ç»çš„æ‰€æœ‰å·¥ä½œæµéƒ½ä¸å¤ªä¸€æ ·ã€‚å®ƒçš„ä¸Šæ¸¸æœ‰ä¸€ä¸ªå”¯ä¸€ä»“åº“ï¼Œ æ‰€æœ‰äººéƒ½æ˜¯ fork è¿™ä¸ªä»“åº“ï¼Œ åœ¨è‡ªå·±çš„è¿œç«¯å’Œè‡ªå·±çš„æœ¬åœ°å„ç»´æŠ¤ä¸€ä¸ªä»“åº“ï¼Œå¾…å¼€å‘å®Œæˆåæ¨å…¥è‡ªå·±çš„è¿œç«¯ä»“åº“ï¼Œå¹¶ç»“åˆ GitHub/GitLabç­‰æäº¤ Pull Requestï¼Œè¿›å…¥äº† review é˜¶æ®µï¼Œå¾…é€šè¿‡åï¼Œå°†ä¼šè¢«åˆå¹¶å…¥ä¸Šæ¸¸å”¯ä¸€çš„ä»“åº“ã€‚è¿™ç§æ–¹å¼æ¯”è¾ƒé€‚åˆ GitHub ä¸­çš„å¤§å‹å¼€æºé¡¹ç›®ï¼Œ å¯¹äºå°å›¢é˜Ÿçš„å†…éƒ¨é¡¹ç›®ï¼Œ è¿™ç§æ–¹å¼å¯èƒ½æœªå¿…åˆé€‚ã€‚
è€Œä¸” fork å·¥ä½œæµï¼Œ ä¼šå ç”¨æ›´å¤šçš„èµ„æºï¼ˆæ¯•ç«Ÿæ¯ä¸ªäººéƒ½ç»´æŠ¤ä¸€ä»½è¿œç«¯ä»“åº“ï¼‰ã€‚ è€Œä¸”æ¯ä¸ªäººéƒ½çœ‹ä¸åˆ°å…¶ä»–äººçš„åŠ¨æ€ï¼Œåªæœ‰å½“æäº¤ Pull Request çš„æ—¶å€™ï¼Œ æ‰çŸ¥é“æ¯ä¸ªäººå‘ç”Ÿäº†ä»€ä¹ˆã€‚&lt;/p>
&lt;h1 id="æ€»ç»“">æ€»ç»“&lt;/h1>
&lt;p>æˆ‘ä¸ªäººæ¯”è¾ƒæ¨èçš„æ˜¯ Gitflow çš„å¼€å‘å·¥ä½œæµï¼Œ è¿™ç§æ–¹å¼ä¸‹ï¼Œä¸€åˆ‡éƒ½æ˜¯å¯æ§çš„ï¼Œ æ¯ä¸ªåˆ†æ”¯éƒ½æœ‰å„è‡ªç‹¬ç«‹çš„åŠŸèƒ½ï¼Œç›®çš„æ€§å¾ˆæ˜ç¡®ï¼Œ åŒæ—¶ï¼Œåœ¨åšä»£ç å›æ»šä¹‹ç±»çš„æ“ä½œä¹Ÿæ˜¯å¯ä»¥ç›´æ¥å‰”é™¤ã€‚ å¦å¤–ï¼Œ åœ¨è¿™ç§å·¥ä½œæµæ–¹å¼ä¸‹ï¼Œ å›¢é˜Ÿä¸­çš„æ¯ä¸ªäººéƒ½èƒ½å¾ˆè½»æ˜“çš„çŸ¥é“å…¶ä»–äººåœ¨åšä»€ä¹ˆï¼Œ åšå‡ºäº†ä»€ä¹ˆæ ·çš„æ”¹å˜ï¼Œ å¯¹äºå›¢é˜Ÿåä½œï¼Œ æˆ–è®¸æ›´åŠ åˆé€‚ã€‚&lt;/p>
&lt;p>å½“ç„¶æ‰€æœ‰çš„å·¥ä½œæµå¹¶ä¸ä¸€å®šèƒ½å®Œå…¨å¥—ç”¨ï¼Œ å¯ä»¥å¸å–ä¸€äº›è§„èŒƒï¼Œ åˆå¹¶å…¥è‡ªå·±çš„æ—¥å¸¸å·¥ä½œï¼Œ å°†ä»£ç ä»“åº“çš„åˆä½œæµç¨‹æ ‡å‡†åŒ–å’Œè§„èŒƒåŒ–ï¼Œ è¿™ä¹Ÿæ˜¯ä¸€åˆ‡è‡ªåŠ¨åŒ–çš„åŸºç¡€ã€‚&lt;/p>
&lt;p>&amp;lt;å…¨æ–‡å®Œ&amp;gt;&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Git/">Git</category><category domain="https://moelove.info/tags/Tool/">Tool</category></item><item><title>Git æœ¬åœ°ä»“åº“å’Œè£¸ä»“åº“</title><link>https://moelove.info/2016/12/04/Git-%E6%9C%AC%E5%9C%B0%E4%BB%93%E5%BA%93%E5%92%8C%E8%A3%B8%E4%BB%93%E5%BA%93/</link><guid isPermaLink="true">https://moelove.info/2016/12/04/Git-%E6%9C%AC%E5%9C%B0%E4%BB%93%E5%BA%93%E5%92%8C%E8%A3%B8%E4%BB%93%E5%BA%93/</guid><pubDate>Sun, 04 Dec 2016 01:37:39 +0000</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;p>é€šå¸¸æˆ‘ä»¬ä¼šç”¨ &lt;code>git init&lt;/code> å‘½ä»¤æ¥å°†æˆ‘ä»¬æ‰€åœ¨çš„ç›®å½•è½¬æ¢ä¸ºä¸€ä¸ª Git æœ¬åœ°ä»“åº“æˆ–è€…åˆå§‹åŒ–ä¸€ä¸ªæ–°çš„ç©ºä»“åº“ã€‚&lt;/p>
&lt;h2 id="ç”¨æ³•">ç”¨æ³•&lt;/h2>
&lt;ul>
&lt;li>å°†å½“å‰ç›®å½•è½¬æ¢ä¸ºä¸€ä¸ªæœ¬åœ°ä»“åº“&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">git init
&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™ä¸ªå‘½ä»¤æ‰§è¡Œåä¼šåœ¨æœ¬åœ°ç”Ÿæˆä¸€ä¸ª &lt;code>.git&lt;/code> çš„æ–‡ä»¶å¤¹ï¼Œç”¨æ¥è¿½è¸ªä»“åº“çš„æ‰€æœ‰å˜æ›´ã€‚æ•ˆæœå¦‚ä¸‹ï¼š&lt;/p>
&lt;p>&lt;img src="https://moelove.info/img/gitinit.png" alt="git init">&lt;/p>
&lt;ul>
&lt;li>æŒ‡å®šæŸä¸ªç›®å½•æˆä¸ºæœ¬åœ°ä»“åº“&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">git init &amp;lt;repo&amp;gt;
&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™ä¸ªå‘½ä»¤æ‰§è¡Œåï¼Œ å°†åˆ›å»ºä¸€ä¸ªåä¸ºrepoä¸”åªåŒ…å« &lt;code>.git&lt;/code> å­æ–‡ä»¶å¤¹çš„ç©ºç›®å½•ã€‚æ•ˆæœå¦‚ä¸‹ï¼š&lt;/p>
&lt;p>&lt;img src="https://moelove.info/img/git-init-repo.png" alt="git init repo">&lt;/p>
&lt;ul>
&lt;li>æŒ‡å®šæŸä¸ªç›®å½•æˆä¸ºä¸­å¿ƒä»“åº“ï¼ˆè£¸ä»“åº“ï¼‰&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">git init --bare &amp;lt;repo&amp;gt;
&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™ä¸ªå‘½ä»¤æ‰§è¡Œåï¼Œå°†åœ¨æœ¬åœ°åˆ›å»ºä¸€ä¸ªåä¸º repo çš„æ–‡ä»¶å¤¹ï¼Œ é‡Œé¢åŒ…å«ç€ Git çš„åŸºæœ¬ç›®å½•ï¼Œ æˆ‘ä»¬ä¸€èˆ¬ä¼šå°†è¿™ä¸ªæ–‡ä»¶å¤¹å‘½åä¸ºåé¢åŠ  &lt;code>.git&lt;/code> çš„å½¢å¼ï¼Œå¦‚ &lt;code>repo.git&lt;/code> ï¼ˆè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬ä» GitHub clone ä»“åº“çš„æ—¶å€™ï¼Œåœ°å€éƒ½æ˜¯ xxx.git è¿™æ ·çš„å½¢å¼çš„åŸå› ï¼‰ã€‚æ•ˆæœå¦‚ä¸‹ï¼š&lt;/p>
&lt;p>&lt;img src="https://moelove.info/img/git-init-bare-repo.png" alt="git init --bare repo.git">&lt;/p>
&lt;p>è¯¦ç»†è¯´ä¸€ä¸‹ä½¿ç”¨ &lt;code>--bare&lt;/code> å‚æ•°çš„å«ä¹‰ï¼Œä½¿ç”¨ &lt;code>--bare&lt;/code> å‚æ•°åˆå§‹åŒ–çš„ä»“åº“ï¼Œæˆ‘ä»¬ä¸€èˆ¬ç§°ä¹‹ä¸ºè£¸ä»“åº“ï¼Œ å› ä¸ºè¿™æ ·åˆ›å»ºçš„ä»“åº“å¹¶ä¸åŒ…å« &lt;code>å·¥ä½œåŒº&lt;/code> ï¼Œ ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å¹¶ä¸èƒ½åœ¨è¿™ä¸ªç›®å½•ä¸‹æ‰§è¡Œæˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨çš„ Git å‘½ä»¤ã€‚&lt;/p>
&lt;h2 id="å¯¹æ¯”">å¯¹æ¯”&lt;/h2>
&lt;p>æˆ‘ä»¬æ¥å¯¹æ¯”ä¸€ä¸‹ç›´æ¥ä½¿ç”¨ &lt;code>git init&lt;/code> åˆ›å»ºçš„ä»“åº“å’ŒåŠ äº† &lt;code>--bare&lt;/code> å‚æ•°çš„ä¸¤ä¸ªä»“åº“ã€‚ æˆ‘ä»¬ç›´æ¥çœ‹ä¸¤ä¸ªä»“åº“çš„çš„ &lt;code>config&lt;/code> æ–‡ä»¶ä¸­çš„å†…å®¹ï¼š&lt;/p>
&lt;ul>
&lt;li>ç›´æ¥ &lt;code>git init&lt;/code> åˆ›å»ºçš„ä»“åº“:&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="o">[&lt;/span>core&lt;span class="o">]&lt;/span>
&lt;span class="nv">repositoryformatversion&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="m">0&lt;/span>
&lt;span class="nv">filemode&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">true&lt;/span>
&lt;span class="nv">bare&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">false&lt;/span>
&lt;span class="nv">logallrefupdates&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">true&lt;/span>
&lt;span class="nv">ignorecase&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">true&lt;/span>
&lt;span class="nv">precomposeunicode&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">true&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>åŠ äº† &lt;code>--bare&lt;/code> åˆ›å»ºçš„è£¸ä»“åº“:&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="o">[&lt;/span>core&lt;span class="o">]&lt;/span>
&lt;span class="nv">repositoryformatversion&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="m">0&lt;/span>
&lt;span class="nv">filemode&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">true&lt;/span>
&lt;span class="nv">bare&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">true&lt;/span>
&lt;span class="nv">ignorecase&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">true&lt;/span>
&lt;span class="nv">precomposeunicode&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">true&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¯ä»¥çœ‹åˆ°æœ€ç›´è§‚çš„å·®å¼‚åœ¨äº &lt;code>bare&lt;/code> é…ç½®é¡¹æ˜¯å¦ä¸º &lt;code>true&lt;/code> ï¼Œ æ­¤å¤–ä¸åŠ  &lt;code>--bare&lt;/code> åˆ›å»ºçš„æœ¬åœ°ä»“åº“é…ç½®ä¸­æœ‰ä¸€é¡¹ &lt;code>logallrefupdates = true&lt;/code> , ä½œç”¨æ ¹æ®åå­—å°±å¯ä»¥çœ‹å‡ºæ¥ï¼Œ è®°å½•æ‰€æœ‰çš„ &lt;code>ref&lt;/code> (å¼•ç”¨) æ›´æ–°ï¼Œ å…³äº ref çš„éƒ¨åˆ†ä¹‹åæœ‰æ—¶é—´å¯ä»¥å†å†™ï¼Œè¿™ä¸ªé…ç½®å¯ä»¥ç†è§£ä¸ºæ˜¯ Git çš„ä¸€é“é˜²çº¿ã€‚&lt;/p>
&lt;h2 id="åŠŸèƒ½å·®å¼‚">åŠŸèƒ½å·®å¼‚&lt;/h2>
&lt;p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æœ€ç®€å•çš„ä¾‹å­æ¼”ç¤ºä¸€ä¸‹ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">
&lt;span class="c1"># ç›´æ¥åˆ›å»ºæœ¬åœ°ä»“åº“&lt;/span>
&lt;span class="o">(&lt;/span>Tao&lt;span class="o">)&lt;/span> âœ git init repo
&lt;span class="c1"># åˆ›å»ºè£¸ä»“åº“&lt;/span>
&lt;span class="o">(&lt;/span>Tao&lt;span class="o">)&lt;/span> âœ git init --bare repo.git
&lt;span class="c1"># åˆ†åˆ« clone ä¸¤ä¸ªä»“åº“&lt;/span>
&lt;span class="o">(&lt;/span>Tao&lt;span class="o">)&lt;/span> âœ git clone repo c1
Cloning into &lt;span class="s1">&amp;#39;c1&amp;#39;&lt;/span>...
warning: You appear to have cloned an empty repository.
&lt;span class="k">done&lt;/span>.
&lt;span class="o">(&lt;/span>Tao&lt;span class="o">)&lt;/span> âœ git clone repo.git c2
Cloning into &lt;span class="s1">&amp;#39;c2&amp;#39;&lt;/span>...
warning: You appear to have cloned an empty repository.
&lt;span class="k">done&lt;/span>.
&lt;span class="c1"># è¿›å…¥ c1 ä»“åº“&lt;/span>
&lt;span class="o">(&lt;/span>Tao&lt;span class="o">)&lt;/span> âœ &lt;span class="nb">cd&lt;/span> c1
&lt;span class="o">(&lt;/span>Tao&lt;span class="o">)&lt;/span> âœ c1 git:&lt;span class="o">(&lt;/span>master&lt;span class="o">)&lt;/span> touch &lt;span class="nb">test&lt;/span>
&lt;span class="o">(&lt;/span>Tao&lt;span class="o">)&lt;/span> âœ c1 git:&lt;span class="o">(&lt;/span>master&lt;span class="o">)&lt;/span> âœ— g add -A
&lt;span class="o">(&lt;/span>Tao&lt;span class="o">)&lt;/span> âœ c1 git:&lt;span class="o">(&lt;/span>master&lt;span class="o">)&lt;/span> âœ— g commit -m &lt;span class="s2">&amp;#34;test commit&amp;#34;&lt;/span>
&lt;span class="o">[&lt;/span>master &lt;span class="o">(&lt;/span>root-commit&lt;span class="o">)&lt;/span> b1e32ad&lt;span class="o">]&lt;/span> &lt;span class="nb">test&lt;/span> commit
&lt;span class="m">1&lt;/span> file changed, &lt;span class="m">0&lt;/span> insertions&lt;span class="o">(&lt;/span>+&lt;span class="o">)&lt;/span>, &lt;span class="m">0&lt;/span> deletions&lt;span class="o">(&lt;/span>-&lt;span class="o">)&lt;/span>
create mode &lt;span class="m">100644&lt;/span> &lt;span class="nb">test&lt;/span>
&lt;span class="o">(&lt;/span>Tao&lt;span class="o">)&lt;/span> âœ c1 git:&lt;span class="o">(&lt;/span>master&lt;span class="o">)&lt;/span> git push origin master
Counting objects: 3, &lt;span class="k">done&lt;/span>.
Writing objects: 100% &lt;span class="o">(&lt;/span>3/3&lt;span class="o">)&lt;/span>, &lt;span class="m">200&lt;/span> bytes &lt;span class="p">|&lt;/span> &lt;span class="m">0&lt;/span> bytes/s, &lt;span class="k">done&lt;/span>.
Total &lt;span class="m">3&lt;/span> &lt;span class="o">(&lt;/span>delta 0&lt;span class="o">)&lt;/span>, reused &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>delta 0&lt;span class="o">)&lt;/span>
remote: error: refusing to update checked out branch: refs/heads/master
remote: error: By default, updating the current branch in a non-bare repository
remote: error: is denied, because it will make the index and work tree inconsistent
remote: error: with what you pushed, and will require &lt;span class="s1">&amp;#39;git reset --hard&amp;#39;&lt;/span> to match
remote: error: the work tree to HEAD.
remote: error:
remote: error: You can &lt;span class="nb">set&lt;/span> &lt;span class="s1">&amp;#39;receive.denyCurrentBranch&amp;#39;&lt;/span> configuration variable to
remote: error: &lt;span class="s1">&amp;#39;ignore&amp;#39;&lt;/span> or &lt;span class="s1">&amp;#39;warn&amp;#39;&lt;/span> in the remote repository to allow pushing into
remote: error: its current branch&lt;span class="p">;&lt;/span> however, this is not recommended unless you
remote: error: arranged to update its work tree to match what you pushed in some
remote: error: other way.
remote: error:
remote: error: To squelch this message and still keep the default behaviour, &lt;span class="nb">set&lt;/span>
remote: error: &lt;span class="s1">&amp;#39;receive.denyCurrentBranch&amp;#39;&lt;/span> configuration variable to &lt;span class="s1">&amp;#39;refuse&amp;#39;&lt;/span>.
To /Users/tao/repo
! &lt;span class="o">[&lt;/span>remote rejected&lt;span class="o">]&lt;/span> master -&amp;gt; master &lt;span class="o">(&lt;/span>branch is currently checked out&lt;span class="o">)&lt;/span>
error: failed to push some refs to &lt;span class="s1">&amp;#39;/Users/tao/repo&amp;#39;&lt;/span>
&lt;span class="c1"># è¿›å…¥ c2 ä»“åº“é‡å¤æ‰§è¡Œ&lt;/span>
&lt;span class="o">(&lt;/span>Tao&lt;span class="o">)&lt;/span> âœ c1 git:&lt;span class="o">(&lt;/span>master&lt;span class="o">)&lt;/span> &lt;span class="nb">cd&lt;/span> ../c2
&lt;span class="o">(&lt;/span>Tao&lt;span class="o">)&lt;/span> âœ c2 git:&lt;span class="o">(&lt;/span>master&lt;span class="o">)&lt;/span> touch &lt;span class="nb">test&lt;/span>
&lt;span class="o">(&lt;/span>Tao&lt;span class="o">)&lt;/span> âœ c2 git:&lt;span class="o">(&lt;/span>master&lt;span class="o">)&lt;/span> âœ— git add -A
&lt;span class="o">(&lt;/span>Tao&lt;span class="o">)&lt;/span> âœ c2 git:&lt;span class="o">(&lt;/span>master&lt;span class="o">)&lt;/span> âœ— git commit -m &lt;span class="s2">&amp;#34;test commit&amp;#34;&lt;/span>
&lt;span class="o">[&lt;/span>master &lt;span class="o">(&lt;/span>root-commit&lt;span class="o">)&lt;/span> 7aacc58&lt;span class="o">]&lt;/span> &lt;span class="nb">test&lt;/span> commit
&lt;span class="m">1&lt;/span> file changed, &lt;span class="m">0&lt;/span> insertions&lt;span class="o">(&lt;/span>+&lt;span class="o">)&lt;/span>, &lt;span class="m">0&lt;/span> deletions&lt;span class="o">(&lt;/span>-&lt;span class="o">)&lt;/span>
create mode &lt;span class="m">100644&lt;/span> &lt;span class="nb">test&lt;/span>
&lt;span class="o">(&lt;/span>Tao&lt;span class="o">)&lt;/span> âœ c2 git:&lt;span class="o">(&lt;/span>master&lt;span class="o">)&lt;/span> git push origin master
Counting objects: 3, &lt;span class="k">done&lt;/span>.
Writing objects: 100% &lt;span class="o">(&lt;/span>3/3&lt;span class="o">)&lt;/span>, &lt;span class="m">201&lt;/span> bytes &lt;span class="p">|&lt;/span> &lt;span class="m">0&lt;/span> bytes/s, &lt;span class="k">done&lt;/span>.
Total &lt;span class="m">3&lt;/span> &lt;span class="o">(&lt;/span>delta 0&lt;span class="o">)&lt;/span>, reused &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>delta 0&lt;span class="o">)&lt;/span>
To /Users/tao/repo.git
* &lt;span class="o">[&lt;/span>new branch&lt;span class="o">]&lt;/span> master -&amp;gt; master
&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä»è£¸ä»“åº“ clone ä¸‹æ¥çš„æœ¬åœ°ä»“åº“å¯ä»¥è¿›è¡Œæ­£å¸¸çš„ &lt;code>push&lt;/code> æ“ä½œï¼Œ ä½†æ˜¯ä»ä¸€èˆ¬ä»“åº“ clone ä¸‹æ¥çš„æœ¬åœ°ä»“åº“å´ä¸è¡Œã€‚ è¿™ä¹Ÿæ­£æ˜¯è£¸ä»“åº“å­˜åœ¨çš„æ„ä¹‰ã€‚ è£¸ä»“åº“ä¸€èˆ¬æƒ…å†µä¸‹æ˜¯ä½œä¸ºè¿œç«¯çš„ä¸­å¿ƒä»“åº“è€Œå­˜åœ¨çš„ã€‚&lt;/p>
&lt;h2 id="æ€»ç»“">æ€»ç»“&lt;/h2>
&lt;p>ä½¿ç”¨ &lt;code>git init --bare &amp;lt;repo&amp;gt;&lt;/code> å¯ä»¥åˆ›å»ºä¸€ä¸ªè£¸ä»“åº“ï¼Œå¹¶ä¸”è¿™ä¸ªä»“åº“æ˜¯å¯ä»¥è¢«æ­£å¸¸ &lt;code>clone&lt;/code> å’Œ &lt;code>push&lt;/code> æ›´æ–°çš„ï¼Œ è£¸ä»“åº“ä¸åŒ…å«å·¥ä½œåŒºï¼Œæ‰€ä»¥å¹¶ä¸ä¼šå­˜åœ¨åœ¨è£¸ä»“åº“ä¸Šç›´æ¥æäº¤å˜æ›´çš„æƒ…å†µã€‚&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Git/">Git</category><category domain="https://moelove.info/tags/Tool/">Tool</category></item><item><title>æºç ç¼–è¯‘Vim 8</title><link>https://moelove.info/2016/09/24/%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91Vim-8/</link><guid isPermaLink="true">https://moelove.info/2016/09/24/%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91Vim-8/</guid><pubDate>Sat, 24 Sep 2016 19:46:47 +0000</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>Vim 8.0 åœ¨2016.09.12å‘å¸ƒäº†, åœ¨å„ Linux å‘è¡Œç‰ˆè¿˜æ²¡æ›´æ–°åŒ…çš„æ—¶å€™å°±æºç ç¼–è¯‘æ¥ä½¿ç”¨å§! ä»¥ Debian ç¼–è¯‘ Vim ä¸ºä¾‹.&lt;/p>
&lt;/blockquote>
&lt;p>&lt;img src="http://moelove.qiniudn.com/Vim-8-simple-version.png" alt="ç®€å•ç¼–è¯‘æˆªå›¾">&lt;/p>
&lt;h1 id="ä¸‹è½½vim-æºç ">ä¸‹è½½Vim æºç &lt;/h1>
&lt;p>å¯ä»¥åœ¨&lt;a href="http://www.vim.org/">Vim å®˜ç½‘&lt;/a>ä¸‹è½½&lt;a href="ftp://ftp.vim.org/pub/vim/unix/vim-8.0.tar.bz2">æ‰“åŒ…å¥½çš„æºä»£ç &lt;/a>.
æˆ–è€…ä½¿ç”¨ Git:&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">git clone https://github.com/vim/vim.git
&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="ç¼–è¯‘">ç¼–è¯‘&lt;/h1>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="nb">cd&lt;/span> vim/src
./configure --with-compiledby&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;Jintao Zhang&amp;#34;&lt;/span> --with-features&lt;span class="o">=&lt;/span>huge --enable-pythoninterp&lt;span class="o">=&lt;/span>yes --with-python-config-dir&lt;span class="o">=&lt;/span>/usr/lib/python2.7/config-x86_64-linux-gnu --enable-cscope --enable-perlinterp&lt;span class="o">=&lt;/span>yes --enable-rubyinterp&lt;span class="o">=&lt;/span>yes --with-luajit --enable-luainterp&lt;span class="o">=&lt;/span>yes --with-lua-prefix&lt;span class="o">=&lt;/span>/usr/include/lua5.1 --enable-multibyte --with-x --enable-fail-if-missing
&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¸Šé¢çš„å‚æ•°ä½¿ç”¨ &lt;code>./configure --help&lt;/code> éƒ½å¯ä»¥çœ‹åˆ°å¯¹åº”ç”¨é€”. ä¸Šé¢ä½¿ç”¨çš„å‚æ•°æ˜¯å¢åŠ äº†å¯¹ Python, Ruby, Perl, ä»¥åŠX windowçš„æ”¯æŒ.&lt;/p>
&lt;p>å»ºè®®åŠ ä¸Š &lt;code>--enable-fail-if-missing&lt;/code> å‚æ•°, ä»¥æ–¹ä¾¿å®šä½åˆ°å“ªé‡Œä¾èµ–ç¼ºå¤±.&lt;/p>
&lt;h1 id="ä¾èµ–">ä¾èµ–&lt;/h1>
&lt;p>è¿™é‡Œæ£€æŸ¥å¯èƒ½é€šä¸è¿‡, é¦–å…ˆæ˜¯ &lt;code>lua&lt;/code> å’Œ &lt;code>luajit&lt;/code>. éœ€è¦æ‰§è¡Œ&lt;/p>
&lt;p>&lt;code>sudo apt-get install lua5.1 liblua5.1-0 luajit libluajit-5.1-dev&lt;/code>&lt;/p>
&lt;p>å…¶æ¬¡æ³¨æ„ &lt;code>Python&lt;/code> çš„ config ä½ç½®.&lt;/p>
&lt;p>æœ€åå°±æ˜¯ &lt;code>Perl&lt;/code> éœ€è¦ &lt;code>sudo apt-get install libperl-dev&lt;/code>.&lt;/p>
&lt;h1 id="æœ€ç»ˆ">æœ€ç»ˆ&lt;/h1>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">make &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> sudo make install
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="æœ€ç»ˆç»“æœ">æœ€ç»ˆç»“æœ&lt;/h2>
&lt;p>&lt;img src="http://moelove.qiniudn.com/Vim-8-full-version.png" alt="å®Œæ•´ç¼–è¯‘æˆªå›¾">&lt;/p>
&lt;p>PS: å…¶å®æˆ‘ä¸€å¼€å§‹æ˜¯æƒ³ä»‹ç» Vim 8 çš„, ç„¶åç¢°å·§åœ¨ GitHub ä¸Šæœ‰äººé—®å¦‚ä½•ç¼–è¯‘ä¹‹ç±»çš„, å°±å…ˆå†™äº†è¿™ç¯‡.&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Vim/">Vim</category><category domain="https://moelove.info/tags/Tool/">Tool</category></item><item><title>åˆ©å™¨ç³»åˆ—-æ›´é«˜æ•ˆçš„Vim</title><link>https://moelove.info/2016/09/16/%E5%88%A9%E5%99%A8%E7%B3%BB%E5%88%97-%E6%9B%B4%E9%AB%98%E6%95%88%E7%9A%84Vim/</link><guid isPermaLink="true">https://moelove.info/2016/09/16/%E5%88%A9%E5%99%A8%E7%B3%BB%E5%88%97-%E6%9B%B4%E9%AB%98%E6%95%88%E7%9A%84Vim/</guid><pubDate>Fri, 16 Sep 2016 16:55:44 +0000</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>è¿™æ˜¯åˆ©å™¨ç³»åˆ—ç¬¬0ç¯‡, å½“ç„¶è¦ä»¥æ¯å¤©æˆ‘ä½¿ç”¨ç‡æœ€é«˜çš„Vimæ¥å¼€å§‹å•¦!&lt;/p>
&lt;/blockquote>
&lt;h2 id="æˆªå›¾">æˆªå›¾&lt;/h2>
&lt;p>&lt;img src="http://moelove.qiniudn.com/vim.png" alt="screenshot.png">&lt;/p>
&lt;h2 id="å®‰è£…">å®‰è£…&lt;/h2>
&lt;p>(ä½ éœ€è¦ä¸€ä¸ªæœ‰Pythonæ”¯æŒçš„Vimç‰ˆæœ¬. è¯·ä½¿ç”¨ &lt;code>vim --version | grep +python&lt;/code> æ¥æ£€æŸ¥)&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;strong>ä¾èµ–&lt;/strong>(Debian/Ubuntu å¹³å°)&lt;/p>
&lt;p>&lt;code>sudo apt-get install python vim exuberant-ctags git&lt;/code>&lt;/p>
&lt;p>&lt;code>sudo pip install dbgp vim-debug pep8 flake8 pyflakes isort&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>ä¾èµ–&lt;/strong>(RedHat/CentOS å¹³å°)&lt;/p>
&lt;p>CentOS 6.7çš„yumæºè‡ªå¸¦çš„Pythonç‰ˆæœ¬è¾ƒæ—§ï¼Œæ¨èè‡ªè¡Œå®‰è£…Python2.7.&lt;/p>
&lt;p>&lt;code>sudo yum install python vim ctags git&lt;/code>&lt;/p>
&lt;p>&lt;code>sudo pip install dbgp vim-debug pep8 flake8 pyflakes isort&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>ä¾èµ–&lt;/strong>(Mac OS å¹³å°)&lt;/p>
&lt;p>&lt;code>brew install python vim git&lt;/code>&lt;/p>
&lt;p>&lt;code>wget http://tenet.dl.sourceforge.net/project/ctags/ctags/5.8/ctags-5.8.tar.gz &amp;amp;&amp;amp; tar -zxvf ctags-5.8.tar.gz &amp;amp;&amp;amp; cd ctags-5.8 &amp;amp;&amp;amp; ./configure &amp;amp;&amp;amp; make &amp;amp;&amp;amp; sudo make install&lt;/code>&lt;/p>
&lt;p>&lt;code>sudo pip install dbgp vim-debug pep8 flake8 pyflakes isort&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>ä¸‹è½½vimrc æ–‡ä»¶åˆ°ç”¨æˆ·ä¸»ç›®å½•&lt;/strong>&lt;/p>
&lt;p>&lt;code>wget https://raw.githubusercontent.com/tao12345666333/vim/master/vimrc -O $HOME/.vimrc&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>æ‰“å¼€ Vim&lt;/strong>&lt;/p>
&lt;p>æ‰“å¼€Vim, å®ƒå°†ä¼šè‡ªåŠ¨å®‰è£…æ’ä»¶. è¯·è€å¿ƒç­‰å¾…å®ƒå®Œæˆ. æˆ–è€…ä½ å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ¥è‡ªè¡Œå®‰è£….&lt;/p>
&lt;p>&lt;code>vim -E -u $HOME/.vimrc +qall&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>äº«å—ä½ çš„Vimå¹¶ä¸ªæ€§åŒ–å®ƒå§!&lt;/strong>&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="æ”¯æŒç‰¹æ€§">æ”¯æŒç‰¹æ€§&lt;/h2>
&lt;h3 id="æ’ä»¶ç®¡ç†vundle">æ’ä»¶ç®¡ç†ï¼ˆVundleï¼‰&lt;/h3>
&lt;p>åœ¨è¿™ä»½é…ç½®ä¸­ï¼Œä½¿ç”¨äº†&lt;a href="https://github.com/VundleVim/Vundle.vim">&lt;strong>Vundle&lt;/strong>&lt;/a>ä½œä¸ºæ’ä»¶ç®¡ç†å™¨. Vundleä¼šè‡ªåŠ¨æ¥ç®¡ &lt;code>.vim&lt;/code> æ–‡ä»¶å¤¹ï¼Œæ‰€æœ‰é…ç½®å¥½çš„æ’ä»¶å°†é»˜è®¤ä¸‹è½½è‡³&lt;code>~/.vim/bundle/&lt;/code>ï¼Œ åœ¨ä½¿ç”¨ä¹‹å‰è¯·ç¡®ä¿&lt;code>.vim&lt;/code>æ–‡ä»¶å¤¹å¹²å‡€. Vundleçš„æ’ä»¶å®‰è£…éœ€è¦è§¦å‘ &lt;code>git clone&lt;/code> æ“ä½œï¼Œæœç´¢éœ€è¦ &lt;code>curl&lt;/code> æ”¯æŒ.&lt;/p>
&lt;h4 id="é…ç½®æˆªå–äº†éƒ¨åˆ†">é…ç½®(æˆªå–äº†éƒ¨åˆ†)&lt;/h4>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-vim" data-lang="vim">&lt;span class="c">&amp;#34; let Vundle manage Vundle&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="nx">Bundle&lt;/span> &lt;span class="s1">&amp;#39;gmarik/vundle&amp;#39;&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="c">
&lt;/span>&lt;span class="c">&amp;#34; ============================================================================&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="c">&amp;#34; Active plugins&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="c">&amp;#34; You can disable or add new ones here:&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="c">
&lt;/span>&lt;span class="c">&amp;#34; Plugins from github repos:&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="c">
&lt;/span>&lt;span class="c">&amp;#34; Python and PHP Debugger&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="nx">Bundle&lt;/span> &lt;span class="s1">&amp;#39;fisadev/vim-debug.vim&amp;#39;&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="c">&amp;#34; Better file browser&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="nx">Bundle&lt;/span> &lt;span class="s1">&amp;#39;scrooloose/nerdtree&amp;#39;&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="c">&amp;#34; Code commenter&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="nx">Bundle&lt;/span> &lt;span class="s1">&amp;#39;scrooloose/nerdcommenter&amp;#39;&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="c">&amp;#34; Class/module browser&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="nx">Bundle&lt;/span> &lt;span class="s1">&amp;#39;majutsushi/tagbar&amp;#39;&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="c">&amp;#34; Code and files fuzzy finder&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="nx">Bundle&lt;/span> &lt;span class="s1">&amp;#39;kien/ctrlp.vim&amp;#39;&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="c">&amp;#34; Extension to ctrlp, for fuzzy command finder&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="nx">Bundle&lt;/span> &lt;span class="s1">&amp;#39;fisadev/vim-ctrlp-cmdpalette&amp;#39;&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="c">&amp;#34; Zen coding&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="nx">Bundle&lt;/span> &lt;span class="s1">&amp;#39;mattn/emmet-vim&amp;#39;&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="c">&amp;#34; Git integration&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="nx">Bundle&lt;/span> &lt;span class="s1">&amp;#39;motemen/git-vim&amp;#39;&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="c">&amp;#34; Tab list panel&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="nx">Bundle&lt;/span> &lt;span class="s1">&amp;#39;kien/tabman.vim&amp;#39;&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="æ”¯æŒæ“ä½œ">æ”¯æŒæ“ä½œ&lt;/h4>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>å‘½ä»¤&lt;/th>
&lt;th style="text-align:center">è§£é‡Š&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>:PluginList&lt;/td>
&lt;td style="text-align:center">åˆ—å‡ºæ‰€æœ‰Plugin&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>:PluginInstall(!)&lt;/td>
&lt;td style="text-align:center">å®‰è£…/æ›´æ–°Plugin&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>:PluginSearch(!) foo&lt;/td>
&lt;td style="text-align:center">æœç´¢fooç›¸å…³çš„Plugin&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>:PluginClean(!)&lt;/td>
&lt;td style="text-align:center">æ¸…ç†æœªä½¿ç”¨çš„Plugin&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>:PluginUpdate&lt;/td>
&lt;td style="text-align:center">æ›´æ–°æ’ä»¶&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="å·¥ç¨‹æ–‡ä»¶æµè§ˆnerdtree">å·¥ç¨‹æ–‡ä»¶æµè§ˆï¼ˆNERDTreeï¼‰&lt;/h3>
&lt;p>åœ¨è¿™ä»½é…ç½®ä¸­, ä½¿ç”¨äº†&lt;a href="https://github.com/scrooloose/nerdtree">&lt;strong>NERDTree&lt;/strong>&lt;/a>æŸ¥çœ‹æ–‡ä»¶åˆ—è¡¨. ä½ å¯ä»¥åœ¨NERDTreeä¸­æµè§ˆå’Œæ‰“å¼€ä½ æ–‡ä»¶ç³»ç»Ÿä¸­çš„ç›®å½•æˆ–æ–‡ä»¶. è¿˜å¯ä»¥è¿›è¡Œæ–‡ä»¶éšè—å’Œè¿‡æ»¤, è®¾ç½®æ·»åŠ ä¹¦ç­¾ç­‰. åœ¨NERDTreeçª—å£è¾“å…¥&lt;code>?&lt;/code>å¯è·å¾—æ“ä½œæŒ‡å—. è¿™ä»½é…ç½®ä¸­é»˜è®¤è¿‡æ»¤æ‰äº†&lt;code>.pyc&lt;/code>, &lt;code>.git&lt;/code>, &lt;code>.hg&lt;/code>, &lt;code>.svn&lt;/code>ç­‰æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹çš„æ˜¾ç¤º.&lt;/p>
&lt;h4 id="é…ç½®">é…ç½®&lt;/h4>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-vim" data-lang="vim">&lt;span class="c">&amp;#34; auto open or close NERDTree&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="nx">autocmd&lt;/span> &lt;span class="nx">vimenter&lt;/span> * &lt;span class="k">if&lt;/span> &lt;span class="p">!&lt;/span>&lt;span class="nx">argc&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">|&lt;/span> &lt;span class="nx">NERDTree&lt;/span> &lt;span class="p">|&lt;/span> &lt;span class="k">endif&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="nx">autocmd&lt;/span> &lt;span class="nx">bufenter&lt;/span> * &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">winnr&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;$&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">==&lt;/span> &lt;span class="m">1&lt;/span> &amp;amp;&amp;amp; &lt;span class="nx">exists&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;b:NERDTreeType&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &amp;amp;&amp;amp; &lt;span class="nx">b&lt;/span>:&lt;span class="nx">NERDTreeType&lt;/span> &lt;span class="p">==&lt;/span> &lt;span class="s2">&amp;#34;primary&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">|&lt;/span> &lt;span class="nx">q&lt;/span> &lt;span class="p">|&lt;/span> &lt;span class="k">endif&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="c">
&lt;/span>&lt;span class="c">&amp;#34; NERDTree -----------------------------&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="c">
&lt;/span>&lt;span class="c">&amp;#34; toggle nerdtree display&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="nx">map&lt;/span> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nx">F3&lt;/span>&lt;span class="p">&amp;gt;&lt;/span> :&lt;span class="nx">NERDTreeToggle&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nx">CR&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="c">&amp;#34; open nerdtree with the current file selected&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="nx">nmap&lt;/span> &lt;span class="p">,&lt;/span>&lt;span class="nx">t&lt;/span> :&lt;span class="nx">NERDTreeFind&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nx">CR&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="c">&amp;#34; don;t show these file types&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="k">let&lt;/span> &lt;span class="nx">NERDTreeIgnore&lt;/span> &lt;span class="p">=&lt;/span> [&lt;span class="s1">&amp;#39;\.pyc$&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;\.pyo$&amp;#39;&lt;/span>]&lt;span class="err">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="æ”¯æŒæ“ä½œ-1">æ”¯æŒæ“ä½œ&lt;/h4>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>å¿«æ·é”®&lt;/th>
&lt;th style="text-align:center">è§£é‡Š&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>F3&lt;/td>
&lt;td style="text-align:center">æ‰“å¼€/å…³é—­NERDTree&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>,t&lt;/td>
&lt;td style="text-align:center">æ‰“å¼€NERDTreeå¹¶é€‰ä¸­å½“å‰æ–‡ä»¶&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="è¯­æ³•æ£€æŸ¥">è¯­æ³•æ£€æŸ¥&lt;/h3>
&lt;p>åœ¨è¿™ä»½é…ç½®ä¸­ï¼Œ ä½¿ç”¨&lt;a href="https://github.com/scrooloose/syntastic">&lt;strong>Syntastic&lt;/strong>&lt;/a>æ’ä»¶è¿›è¡Œè¯­æ³•é™æ€æ£€æŸ¥. åŒ…æ‹¬ä½†ä¸é™äº&lt;code>C/C++/Go/Python/Haskell/Ruby/JavaScript&lt;/code>ç­‰. åœ¨æœ¬é…ç½®ä¸­å¯¹JavaScriptçš„é™æ€æ£€æŸ¥ä½¿ç”¨&lt;code>eslint&lt;/code>,å¯ä»¥æ”¯æŒES6åŠJSXç­‰, ç»†èŠ‚å¯ä»¥å‚è€ƒ&lt;a href="http://moelove.info/2015/11/28/JSLint-JSHint-ESLint%E5%AF%B9%E6%AF%94%E5%92%8CVim%E9%85%8D%E7%BD%AE/">JSLint, JSHintå’ŒESLintçš„å¯¹æ¯”åŠVimé…ç½®&lt;/a>, æƒ³è¦åˆ‡æ¢æ£€æŸ¥å·¥å…·åªè¦ä¿®æ”¹å¯¹åº”ä½ç½®å³å¯.&lt;/p>
&lt;h4 id="é…ç½®-1">é…ç½®&lt;/h4>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-vim" data-lang="vim">&lt;span class="c">&amp;#34; Syntastic ------------------------------&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="c">
&lt;/span>&lt;span class="c">&amp;#34; show list of errors and warnings on the current file&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="nx">nmap&lt;/span> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nx">leader&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>&lt;span class="nx">e&lt;/span> :&lt;span class="nx">Errors&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nx">CR&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="c">&amp;#34; turn to next or previous errors, after open errors list&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="nx">nmap&lt;/span> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nx">leader&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>&lt;span class="nx">n&lt;/span> :&lt;span class="nx">lnext&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nx">CR&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="nx">nmap&lt;/span> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nx">leader&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>&lt;span class="nx">p&lt;/span> :&lt;span class="nx">lprevious&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nx">CR&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="c">&amp;#34; check also when just opened the file&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="k">let&lt;/span> &lt;span class="nx">g&lt;/span>:&lt;span class="nx">syntastic_check_on_open&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">1&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="c">&amp;#34; syntastic checker for javascript.&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="c">&amp;#34; eslint is the only tool support JSX.&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="c">&amp;#34; If you don&amp;#39;t need write JSX, you can use jshint.&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="c">&amp;#34; And eslint is slow, but not a hindrance&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="c">&amp;#34; let g:syntastic_javascript_checkers = [&amp;#39;jshint&amp;#39;]&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="k">let&lt;/span> &lt;span class="nx">g&lt;/span>:&lt;span class="nx">syntastic_javascript_checkers&lt;/span> &lt;span class="p">=&lt;/span> [&lt;span class="s1">&amp;#39;eslint&amp;#39;&lt;/span>]&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="c">&amp;#34; don&amp;#39;t put icons on the sign column (it hides the vcs status icons of signify)&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="k">let&lt;/span> &lt;span class="nx">g&lt;/span>:&lt;span class="nx">syntastic_enable_signs&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">0&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="c">&amp;#34; custom icons (enable them if you use a patched font, and enable the previous &lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="c">&amp;#34; setting)&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="k">let&lt;/span> &lt;span class="nx">g&lt;/span>:&lt;span class="nx">syntastic_error_symbol&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s1">&amp;#39;âœ—&amp;#39;&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="k">let&lt;/span> &lt;span class="nx">g&lt;/span>:&lt;span class="nx">syntastic_warning_symbol&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s1">&amp;#39;âš &amp;#39;&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="k">let&lt;/span> &lt;span class="nx">g&lt;/span>:&lt;span class="nx">syntastic_style_error_symbol&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s1">&amp;#39;âœ—&amp;#39;&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="k">let&lt;/span> &lt;span class="nx">g&lt;/span>:&lt;span class="nx">syntastic_style_warning_symbol&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s1">&amp;#39;âš &amp;#39;&lt;/span>&lt;span class="err">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="ç‰¹æ€§">ç‰¹æ€§&lt;/h4>
&lt;p>ä¿å­˜æ—¶è‡ªåŠ¨è¿›è¡Œè¯­æ³•é™æ€æ£€æŸ¥ï¼Œæ–¹ä¾¿çš„é”™è¯¯æç¤ºåŠçµæ´»çš„å¯æ‰©å±•æ€§.&lt;/p>
&lt;h4 id="æ”¯æŒæ“ä½œ-2">æ”¯æŒæ“ä½œ&lt;/h4>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>å¿«æ·é”®&lt;/th>
&lt;th style="text-align:center">è§£é‡Š&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;code>\e&lt;/code>&lt;/td>
&lt;td style="text-align:center">æ‰“å¼€é”™è¯¯åˆ—è¡¨&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>\n&lt;/code>&lt;/td>
&lt;td style="text-align:center">ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªé”™è¯¯ä½ç½®&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>\p&lt;/code>&lt;/td>
&lt;td style="text-align:center">ç§»åŠ¨åˆ°ä¸Šä¸€ä¸ªé”™è¯¯ä½ç½®&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="gitæ”¯æŒ">Gitæ”¯æŒ&lt;/h3>
&lt;p>åœ¨è¿™ä»½é…ç½®ä¸­, ä½¿ç”¨&lt;a href="https://github.com/tpope/vim-fugitive">&lt;strong>vim-fugitive&lt;/strong>&lt;/a>å’Œ&lt;a href="https://github.com/mhinz/vim-signify">&lt;strong>vim-signify&lt;/strong>&lt;/a>åšGitæ–¹é¢çš„æ”¯æŒ. å¯ä»¥è¿›è¡Œå¸¸ç”¨çš„gitæ“ä½œåŠä¼˜é›…çš„çŠ¶æ€æç¤ºç­‰(ç›®å‰æ”¯æŒ&lt;code>git&lt;/code>å’Œ&lt;code>hg&lt;/code>).&lt;/p>
&lt;h4 id="é…ç½®-2">é…ç½®&lt;/h4>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-vim" data-lang="vim">&lt;span class="c">&amp;#34; Signify ------------------------------&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="c">
&lt;/span>&lt;span class="c">&amp;#34; this first setting decides in which order try to guess your current vcs&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="c">&amp;#34; UPDATE it to reflect your preferences, it will speed up opening files&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="k">let&lt;/span> &lt;span class="nx">g&lt;/span>:&lt;span class="nx">signify_vcs_list&lt;/span> &lt;span class="p">=&lt;/span> [ &lt;span class="s1">&amp;#39;git&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;hg&amp;#39;&lt;/span> ]&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="c">&amp;#34; mappings to jump to changed blocks&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="nx">nmap&lt;/span> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nx">leader&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>&lt;span class="nx">sn&lt;/span> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nx">plug&lt;/span>&lt;span class="p">&amp;gt;(&lt;/span>&lt;span class="nx">signify&lt;/span>&lt;span class="p">-&lt;/span>&lt;span class="nx">next&lt;/span>&lt;span class="p">-&lt;/span>&lt;span class="nx">hunk&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="nx">nmap&lt;/span> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nx">leader&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>&lt;span class="nx">sp&lt;/span> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nx">plug&lt;/span>&lt;span class="p">&amp;gt;(&lt;/span>&lt;span class="nx">signify&lt;/span>&lt;span class="p">-&lt;/span>&lt;span class="nx">prev&lt;/span>&lt;span class="p">-&lt;/span>&lt;span class="nx">hunk&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="c">&amp;#34; nicer colors&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="nx">highlight&lt;/span> &lt;span class="nx">DiffAdd&lt;/span> &lt;span class="nx">cterm&lt;/span>&lt;span class="p">=&lt;/span>&lt;span class="nb">bold&lt;/span> &lt;span class="nx">ctermbg&lt;/span>&lt;span class="p">=&lt;/span>&lt;span class="nx">none&lt;/span> &lt;span class="nx">ctermfg&lt;/span>&lt;span class="p">=&lt;/span>&lt;span class="m">119&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="nx">highlight&lt;/span> &lt;span class="nx">DiffDelete&lt;/span> &lt;span class="nx">cterm&lt;/span>&lt;span class="p">=&lt;/span>&lt;span class="nb">bold&lt;/span> &lt;span class="nx">ctermbg&lt;/span>&lt;span class="p">=&lt;/span>&lt;span class="nx">none&lt;/span> &lt;span class="nx">ctermfg&lt;/span>&lt;span class="p">=&lt;/span>&lt;span class="m">167&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="nx">highlight&lt;/span> &lt;span class="nx">DiffChange&lt;/span> &lt;span class="nx">cterm&lt;/span>&lt;span class="p">=&lt;/span>&lt;span class="nb">bold&lt;/span> &lt;span class="nx">ctermbg&lt;/span>&lt;span class="p">=&lt;/span>&lt;span class="nx">none&lt;/span> &lt;span class="nx">ctermfg&lt;/span>&lt;span class="p">=&lt;/span>&lt;span class="m">227&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="nx">highlight&lt;/span> &lt;span class="nx">SignifySignAdd&lt;/span> &lt;span class="nx">cterm&lt;/span>&lt;span class="p">=&lt;/span>&lt;span class="nb">bold&lt;/span> &lt;span class="nx">ctermbg&lt;/span>&lt;span class="p">=&lt;/span>&lt;span class="m">237&lt;/span> &lt;span class="nx">ctermfg&lt;/span>&lt;span class="p">=&lt;/span>&lt;span class="m">119&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="nx">highlight&lt;/span> &lt;span class="nx">SignifySignDelete&lt;/span> &lt;span class="nx">cterm&lt;/span>&lt;span class="p">=&lt;/span>&lt;span class="nb">bold&lt;/span> &lt;span class="nx">ctermbg&lt;/span>&lt;span class="p">=&lt;/span>&lt;span class="m">237&lt;/span> &lt;span class="nx">ctermfg&lt;/span>&lt;span class="p">=&lt;/span>&lt;span class="m">167&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="nx">highlight&lt;/span> &lt;span class="nx">SignifySignChange&lt;/span> &lt;span class="nx">cterm&lt;/span>&lt;span class="p">=&lt;/span>&lt;span class="nb">bold&lt;/span> &lt;span class="nx">ctermbg&lt;/span>&lt;span class="p">=&lt;/span>&lt;span class="m">237&lt;/span> &lt;span class="nx">ctermfg&lt;/span>&lt;span class="p">=&lt;/span>&lt;span class="m">227&lt;/span>&lt;span class="err">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="æ”¯æŒæ“ä½œ-3">æ”¯æŒæ“ä½œ&lt;/h4>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>å¿«æ·é”®&lt;/th>
&lt;th style="text-align:center">è§£é‡Š&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>:Git [args]&lt;/td>
&lt;td style="text-align:center">ç±»ä¼¼æ‰§è¡Œ&lt;code>git&lt;/code>å‘½ä»¤ä¸€æ ·&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>:Gstatus&lt;/td>
&lt;td style="text-align:center">ç±»ä¼¼&lt;code>git status&lt;/code>.åœ¨åˆ—è¡¨ä¸­ä½¿ç”¨&lt;code>-&lt;/code>æ·»åŠ /ç§»é™¤æ–‡ä»¶&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>:Gcommit [args]&lt;/td>
&lt;td style="text-align:center">ç±»ä¼¼ &lt;code>git commit&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>:Gmerge [args]&lt;/td>
&lt;td style="text-align:center">ç±»ä¼¼ &lt;code>git merge&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>:Gpull [args]&lt;/td>
&lt;td style="text-align:center">ç±»ä¼¼ &lt;code>git pull&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>:Gpush [args]&lt;/td>
&lt;td style="text-align:center">ç±»ä¼¼ &lt;code>git push&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>:Gvdiff [revision]&lt;/td>
&lt;td style="text-align:center">ç±»ä¼¼ &lt;code>git push&lt;/code> ä½†æ˜¯ä¼šåˆ‡åˆ†çª—å£&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>æ›´å¤šè¯¦ç»†çš„æ“ä½œå¯ä»¥ä½¿ç”¨ &lt;code>:help fugitive&lt;/code>&lt;/p>
&lt;h3 id="tagæ”¯æŒ">Tagæ”¯æŒ&lt;/h3>
&lt;p>åœ¨è¿™ä»½é…ç½®ä¸­ï¼Œä½¿ç”¨äº†&lt;a href="http://github.com/godlygeek/tagbar">&lt;strong>Tagbar&lt;/strong>&lt;/a>åšTagæ”¯æŒï¼Œå¯ä»¥æ˜¾ç¤ºå½“å‰æ–‡ä»¶ä¸­å®šä¹‰çš„ç±»/å˜é‡ç­‰.&lt;/p>
&lt;h4 id="é…ç½®-3">é…ç½®&lt;/h4>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-vim" data-lang="vim">&lt;span class="c">&amp;#34; Tagbar -----------------------------&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="c">
&lt;/span>&lt;span class="c">&amp;#34; toggle tagbar display&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="nx">map&lt;/span> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nx">F4&lt;/span>&lt;span class="p">&amp;gt;&lt;/span> :&lt;span class="nx">TagbarToggle&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nx">CR&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="c">&amp;#34; autofocus on tagbar open&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="k">let&lt;/span> &lt;span class="nx">g&lt;/span>:&lt;span class="nx">tagbar_autofocus&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">1&lt;/span>&lt;span class="err">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="æ”¯æŒæ“ä½œ-4">æ”¯æŒæ“ä½œ&lt;/h4>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>å¿«æ·é”®&lt;/th>
&lt;th style="text-align:center">è§£é‡Š&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>F4&lt;/td>
&lt;td style="text-align:center">æ‰“å¼€Tagåˆ—è¡¨&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="è¶…å…¨è‡ªåŠ¨è¡¥å…¨">è¶…å…¨è‡ªåŠ¨è¡¥å…¨&lt;/h3>
&lt;p>åœ¨è¿™ä»½é…ç½®ä¸­, ä½¿ç”¨äº†&lt;a href="https://github.com/Shougo/neocomplcache.vim">&lt;strong>Neocomplcache&lt;/strong>&lt;/a>ä½œä¸ºä¸»è¦çš„è‡ªåŠ¨è¡¥å…¨æ’ä»¶.&lt;/p>
&lt;h4 id="é…ç½®-4">é…ç½®&lt;/h4>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-vim" data-lang="vim">&lt;span class="c">&amp;#34; NeoComplCache ------------------------------&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="c">
&lt;/span>&lt;span class="c">&amp;#34; most of them not documented because I&amp;#39;m not sure how they work&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="c">&amp;#34; (docs aren&amp;#39;t good, had to do a lot of trial and error to make &lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="c">&amp;#34; it play nice)&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="c">
&lt;/span>&lt;span class="c">&amp;#34; Disable AutoComplPop.&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="k">let&lt;/span> &lt;span class="nx">g&lt;/span>:&lt;span class="nx">acp_enableAtStartup&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">0&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="c">&amp;#34; Use neocomplcache.&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="k">let&lt;/span> &lt;span class="nx">g&lt;/span>:&lt;span class="nx">neocomplcache_enable_at_startup&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">1&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="k">let&lt;/span> &lt;span class="nx">g&lt;/span>:&lt;span class="nx">neocomplcache_enable_ignore_case&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">1&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="c">&amp;#34; Use smartcase.&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="k">let&lt;/span> &lt;span class="nx">g&lt;/span>:&lt;span class="nx">neocomplcache_enable_smart_case&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">1&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="k">let&lt;/span> &lt;span class="nx">g&lt;/span>:&lt;span class="nx">neocomplcache_enable_auto_select&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">1&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="k">let&lt;/span> &lt;span class="nx">g&lt;/span>:&lt;span class="nx">neocomplcache_enable_fuzzy_completion&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">1&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="k">let&lt;/span> &lt;span class="nx">g&lt;/span>:&lt;span class="nx">neocomplcache_enable_camel_case_completion&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">1&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="k">let&lt;/span> &lt;span class="nx">g&lt;/span>:&lt;span class="nx">neocomplcache_enable_underbar_completion&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">1&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="k">let&lt;/span> &lt;span class="nx">g&lt;/span>:&lt;span class="nx">neocomplcache_fuzzy_completion_start_length&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">1&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="k">let&lt;/span> &lt;span class="nx">g&lt;/span>:&lt;span class="nx">neocomplcache_auto_completion_start_length&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">1&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="k">let&lt;/span> &lt;span class="nx">g&lt;/span>:&lt;span class="nx">neocomplcache_manual_completion_start_length&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">1&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="c">&amp;#34; Set minimum syntax keyword length.&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="k">let&lt;/span> &lt;span class="nx">g&lt;/span>:&lt;span class="nx">neocomplcache_min_keyword_length&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">1&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="k">let&lt;/span> &lt;span class="nx">g&lt;/span>:&lt;span class="nx">neocomplcache_min_syntax_length&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">1&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="k">let&lt;/span> &lt;span class="nx">g&lt;/span>:&lt;span class="nx">neocomplcache_lock_buffer_name_pattern&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s1">&amp;#39;\*ku\*&amp;#39;&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="c">&amp;#34; complete with workds from any opened file&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="k">let&lt;/span> &lt;span class="nx">g&lt;/span>:&lt;span class="nx">neocomplcache_same_filetype_lists&lt;/span> &lt;span class="p">=&lt;/span> {}&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="k">let&lt;/span> &lt;span class="nx">g&lt;/span>:&lt;span class="nx">neocomplcache_same_filetype_lists&lt;/span>.&lt;span class="nx">_&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s1">&amp;#39;_&amp;#39;&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="c">&amp;#34; &amp;lt;TAB&amp;gt;: completion.&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="nx">inoremap&lt;/span> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nx">expr&lt;/span>&lt;span class="p">&amp;gt;&amp;lt;&lt;/span>&lt;span class="nx">TAB&lt;/span>&lt;span class="p">&amp;gt;&lt;/span> &lt;span class="nx">pumvisible&lt;/span>&lt;span class="p">()&lt;/span> ? &lt;span class="s2">&amp;#34;\&amp;lt;C-n&amp;gt;&amp;#34;&lt;/span> : &lt;span class="s2">&amp;#34;\&amp;lt;TAB&amp;gt;&amp;#34;&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="c">&amp;#34; Define keyword.&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="k">if&lt;/span> &lt;span class="p">!&lt;/span>&lt;span class="nx">exists&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;g:neocomplcache_keyword_patterns&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span> &lt;span class="k">let&lt;/span> &lt;span class="nx">g&lt;/span>:&lt;span class="nx">neocomplcache_keyword_patterns&lt;/span> &lt;span class="p">=&lt;/span> {}&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="k">endif&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="k">let&lt;/span> &lt;span class="nx">g&lt;/span>:&lt;span class="nx">neocomplcache_keyword_patterns&lt;/span>[&lt;span class="s1">&amp;#39;default&amp;#39;&lt;/span>] &lt;span class="p">=&lt;/span> &lt;span class="s1">&amp;#39;\h\w*&amp;#39;&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="c">&amp;#34; Plugin key-mappings.&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="nx">inoremap&lt;/span> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nx">expr&lt;/span>&lt;span class="p">&amp;gt;&amp;lt;&lt;/span>&lt;span class="nx">C&lt;/span>&lt;span class="p">-&lt;/span>&lt;span class="nx">g&lt;/span>&lt;span class="p">&amp;gt;&lt;/span> &lt;span class="nx">neocomplcache&lt;/span>#&lt;span class="nx">undo_completion&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="nx">inoremap&lt;/span> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nx">expr&lt;/span>&lt;span class="p">&amp;gt;&amp;lt;&lt;/span>&lt;span class="nx">C&lt;/span>&lt;span class="p">-&lt;/span>&lt;span class="nx">l&lt;/span>&lt;span class="p">&amp;gt;&lt;/span> &lt;span class="nx">neocomplcache&lt;/span>#&lt;span class="nx">complete_common_string&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="c">&amp;#34; &amp;lt;C-h&amp;gt;, &amp;lt;BS&amp;gt;: close popup and delete backword char.&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="nx">inoremap&lt;/span> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nx">expr&lt;/span>&lt;span class="p">&amp;gt;&amp;lt;&lt;/span>&lt;span class="nx">C&lt;/span>&lt;span class="p">-&lt;/span>&lt;span class="nx">h&lt;/span>&lt;span class="p">&amp;gt;&lt;/span> &lt;span class="nx">neocomplcache&lt;/span>#&lt;span class="nx">smart_close_popup&lt;/span>&lt;span class="p">()&lt;/span>.&lt;span class="s2">&amp;#34;\&amp;lt;C-h&amp;gt;&amp;#34;&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="nx">inoremap&lt;/span> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nx">expr&lt;/span>&lt;span class="p">&amp;gt;&amp;lt;&lt;/span>&lt;span class="nx">BS&lt;/span>&lt;span class="p">&amp;gt;&lt;/span> &lt;span class="nx">neocomplcache&lt;/span>#&lt;span class="nx">smart_close_popup&lt;/span>&lt;span class="p">()&lt;/span>.&lt;span class="s2">&amp;#34;\&amp;lt;C-h&amp;gt;&amp;#34;&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="nx">inoremap&lt;/span> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nx">expr&lt;/span>&lt;span class="p">&amp;gt;&amp;lt;&lt;/span>&lt;span class="nx">C&lt;/span>&lt;span class="p">-&lt;/span>&lt;span class="nx">y&lt;/span>&lt;span class="p">&amp;gt;&lt;/span> &lt;span class="nx">neocomplcache&lt;/span>#&lt;span class="nx">close_popup&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="nx">inoremap&lt;/span> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nx">expr&lt;/span>&lt;span class="p">&amp;gt;&amp;lt;&lt;/span>&lt;span class="nx">C&lt;/span>&lt;span class="p">-&lt;/span>&lt;span class="nx">e&lt;/span>&lt;span class="p">&amp;gt;&lt;/span> &lt;span class="nx">neocomplcache&lt;/span>#&lt;span class="nx">cancel_popup&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="err">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="æ”¯æŒæ“ä½œ-5">æ”¯æŒæ“ä½œ&lt;/h4>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>å¿«æ·é”®&lt;/th>
&lt;th style="text-align:center">è§£é‡Š&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&amp;lt;Tab&amp;gt;&lt;/td>
&lt;td style="text-align:center">ä½¿ç”¨Tabé”®è¿›è¡Œå¾…æç¤ºé¡¹ç›®é€‰æ‹©&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&amp;lt;C-g&amp;gt;&lt;/td>
&lt;td style="text-align:center">å–æ¶ˆè¡¥å…¨&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&amp;lt;C-l&amp;gt;&lt;/td>
&lt;td style="text-align:center">å®Œæˆå¾…è¡¥å…¨é¡¹ä¸­å…±åŒçš„å­—ç¬¦ä¸²&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&amp;lt;C-h&amp;gt;&lt;/td>
&lt;td style="text-align:center">å…³é—­å¾…é€‰é¡¹&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&amp;lt;C-y&amp;gt;&lt;/td>
&lt;td style="text-align:center">å…³é—­å¾…é€‰é¡¹&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&amp;lt;C-e&amp;gt;&lt;/td>
&lt;td style="text-align:center">é€€å‡ºå¾…é€‰é¡¹&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&amp;lt;BS&amp;gt;&lt;/td>
&lt;td style="text-align:center">å…³é—­å¾…é€‰é¡¹&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="ç±»tmuxçš„çª—å£é€‰æ‹©">ç±»Tmuxçš„çª—å£é€‰æ‹©&lt;/h3>
&lt;p>åœ¨è¿™ä»½é…ç½®ä¸­ï¼Œä½¿ç”¨äº†&lt;a href="https://github.com/t9md/vim-choosewin">&lt;strong>vim-choosewin&lt;/strong>&lt;/a>è¿›è¡Œçª—å£ç®¡ç†å™¨. æ”¯æŒç±»Tmuxçš„æ“ä½œ.&lt;/p>
&lt;h4 id="é…ç½®-5">é…ç½®&lt;/h4>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-vim" data-lang="vim">&lt;span class="c">&amp;#34; Window Chooser ------------------------------&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="c">
&lt;/span>&lt;span class="c">&amp;#34; mapping&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="nx">nmap&lt;/span> &lt;span class="p">-&lt;/span> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nx">Plug&lt;/span>&lt;span class="p">&amp;gt;(&lt;/span>&lt;span class="nx">choosewin&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="c">&amp;#34; show big letters&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="k">let&lt;/span> &lt;span class="nx">g&lt;/span>:&lt;span class="nx">choosewin_overlay_enable&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">1&lt;/span>&lt;span class="err">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="æ”¯æŒæ“ä½œ-6">æ”¯æŒæ“ä½œ&lt;/h4>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>å¿«æ·é”®&lt;/th>
&lt;th style="text-align:center">è§£é‡Š&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>-&lt;/td>
&lt;td style="text-align:center">å¼€å¯çª—å£é€‰æ‹©&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>- [&lt;/td>
&lt;td style="text-align:center">é€‰æ‹©ä¸Šä¸€ä¸ªtabçš„çª—å£&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>- ]&lt;/td>
&lt;td style="text-align:center">é€‰æ‹©ä¸‹ä¸€ä¸ªtabçš„çª—å£&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>æ›´å¤šæ“ä½œå¯ä»¥ä½¿ç”¨ &lt;code>:help choosewin&lt;/code>&lt;/p>
&lt;h3 id="çµæ´»çš„tabç®¡ç†">çµæ´»çš„Tabç®¡ç†&lt;/h3>
&lt;p>åœ¨è¿™ä»½é…ç½®ä¸­ä½¿ç”¨äº†&lt;a href="https://github.com/kien/tabman.vim">TabMan&lt;/a>è¿›è¡ŒTabç®¡ç†,å¯ä»¥è¿›è¡Œçµæ´»åˆ‡æ¢ä¸ç®¡ç†&lt;/p>
&lt;h4 id="é…ç½®-6">é…ç½®&lt;/h4>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-vim" data-lang="vim">&lt;span class="c">&amp;#34; TabMan ------------------------------&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="c">
&lt;/span>&lt;span class="c">&amp;#34; mappings to toggle display, and to focus on it&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="k">let&lt;/span> &lt;span class="nx">g&lt;/span>:&lt;span class="nx">tabman_toggle&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s1">&amp;#39;tl&amp;#39;&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="k">let&lt;/span> &lt;span class="nx">g&lt;/span>:&lt;span class="nx">tabman_focus&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s1">&amp;#39;tf&amp;#39;&lt;/span>&lt;span class="err">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="æ”¯æŒæ“ä½œ-7">æ”¯æŒæ“ä½œ&lt;/h4>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>å¿«æ·é”®&lt;/th>
&lt;th style="text-align:center">è§£é‡Š&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>tl&lt;/td>
&lt;td style="text-align:center">å¼€å¯/å…³é—­tabç®¡ç†&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>tf&lt;/td>
&lt;td style="text-align:center">å°†å…‰æ ‡ç§»åŠ¨åˆ°tabç®¡ç†çª—å£&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="ä¼˜é›…çš„çŠ¶æ€æ ">ä¼˜é›…çš„çŠ¶æ€æ &lt;/h3>
&lt;p>åœ¨è¿™ä»½é…ç½®ä¸­ï¼Œä½¿ç”¨äº†&lt;a href="https://github.com/vim-airline/vim-airline">&lt;strong>Airline&lt;/strong>&lt;/a>æä¾›æ›´å¤šçŠ¶æ€æ æ”¯æŒ.&lt;/p>
&lt;h4 id="é…ç½®-7">é…ç½®&lt;/h4>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-vim" data-lang="vim">&lt;span class="c">&amp;#34; Airline ------------------------------&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="k">let&lt;/span> &lt;span class="nx">g&lt;/span>:&lt;span class="nx">airline_powerline_fonts&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">1&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="k">let&lt;/span> &lt;span class="nx">g&lt;/span>:&lt;span class="nx">airline_theme&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s1">&amp;#39;bubblegum&amp;#39;&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="c">&amp;#34;let g:airline#extensions#tabline#enabled = 1&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="c">&amp;#34;let g:airline#extensions#tabline#left_sep = &amp;#39; &amp;#39;&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="c">&amp;#34;let g:airline#extensions#tabline#left_alt_sep = &amp;#39;|&amp;#39;&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="k">let&lt;/span> &lt;span class="nx">g&lt;/span>:&lt;span class="nx">airline&lt;/span>#&lt;span class="nx">extensions&lt;/span>#&lt;span class="nx">whitespace&lt;/span>#&lt;span class="nx">enabled&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">1&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="c">
&lt;/span>&lt;span class="c">&amp;#34; to use fancy symbols for airline, uncomment the following lines and use a&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="c">&amp;#34; patched font (more info on the README.rst)&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="k">if&lt;/span> &lt;span class="p">!&lt;/span>&lt;span class="nx">exists&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;g:airline_symbols&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span> &lt;span class="k">let&lt;/span> &lt;span class="nx">g&lt;/span>:&lt;span class="nx">airline_symbols&lt;/span> &lt;span class="p">=&lt;/span> {}&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="k">endif&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="k">let&lt;/span> &lt;span class="nx">g&lt;/span>:&lt;span class="nx">airline_left_sep&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s1">&amp;#39;î‚°&amp;#39;&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="k">let&lt;/span> &lt;span class="nx">g&lt;/span>:&lt;span class="nx">airline_left_alt_sep&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s1">&amp;#39;î‚±&amp;#39;&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="k">let&lt;/span> &lt;span class="nx">g&lt;/span>:&lt;span class="nx">airline_right_sep&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s1">&amp;#39;î‚²&amp;#39;&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="k">let&lt;/span> &lt;span class="nx">g&lt;/span>:&lt;span class="nx">airline_right_alt_sep&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s1">&amp;#39;î‚³&amp;#39;&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="k">let&lt;/span> &lt;span class="nx">g&lt;/span>:&lt;span class="nx">airline_symbols&lt;/span>.&lt;span class="nx">branch&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s1">&amp;#39;î‚ &amp;#39;&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="k">let&lt;/span> &lt;span class="nx">g&lt;/span>:&lt;span class="nx">airline_symbols&lt;/span>.&lt;span class="nx">readonly&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s1">&amp;#39;î‚¢&amp;#39;&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="k">let&lt;/span> &lt;span class="nx">g&lt;/span>:&lt;span class="nx">airline_symbols&lt;/span>.&lt;span class="nx">linenr&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s1">&amp;#39;î‚¡&amp;#39;&lt;/span>&lt;span class="err">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="æ”¯æŒç‰¹æ€§-1">æ”¯æŒç‰¹æ€§&lt;/h4>
&lt;p>å¯ä»¥æ˜¾ç¤ºåˆ†æ”¯ï¼Œè¯­æ³•é™æ€æ£€æŸ¥ç»“æœç­‰.&lt;/p>
&lt;h3 id="è‡ªåŠ¨æ’å…¥å¤´éƒ¨">è‡ªåŠ¨æ’å…¥å¤´éƒ¨&lt;/h3>
&lt;p>åœ¨è¿™ä»½é…ç½®ä¸­å†™äº†ä¸ªå°å‡½æ•°æ ¹æ®æ–°å»ºçš„ä¸åŒç±»å‹çš„æ–‡ä»¶ï¼Œè‡ªåŠ¨æ’å…¥å¤´éƒ¨ï¼Œæ”¯æŒ&lt;code>python&lt;/code>, &lt;code>ruby&lt;/code>, &lt;code>bash&lt;/code>ç­‰.&lt;/p>
&lt;h3 id="markdownå®æ—¶é¢„è§ˆ">Markdownå®æ—¶é¢„è§ˆ&lt;/h3>
&lt;p>åœ¨è¿™ä»½é…ç½®ä¸­, ä½¿ç”¨äº†&lt;a href="https://github.com/suan/vim-instant-markdown">&lt;strong>vim-instant-markdown&lt;/strong>&lt;/a>å’Œ&lt;a href="https://github.com/plasticboy/vim-markdown">vim-markdown&lt;/a>åšMarkdownæ ¼å¼çš„æ”¯æŒï¼Œå¯ä»¥æ”¯æŒå®æ—¶é¢„è§ˆç­‰ç‰¹æ€§.&lt;/p>
&lt;p>æ­¤åŠŸèƒ½éœ€è¦æœ‰nodeç¯å¢ƒæ”¯æŒï¼Œå¯ä»¥æ‰§è¡Œ &lt;code>npm -g install instant-markdown-d&lt;/code> è¿›è¡Œå®‰è£….&lt;/p>
&lt;h4 id="é…ç½®-8">é…ç½®&lt;/h4>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-vim" data-lang="vim">&lt;span class="c">&amp;#34; Vim-markdown ------------------------------&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="c">
&lt;/span>&lt;span class="c">&amp;#34; Disabled automatically folding&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="k">let&lt;/span> &lt;span class="nx">g&lt;/span>:&lt;span class="nx">vim_markdown_folding_disabled&lt;/span>&lt;span class="p">=&lt;/span>&lt;span class="m">1&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="c">&amp;#34; LeTeX math&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="k">let&lt;/span> &lt;span class="nx">g&lt;/span>:&lt;span class="nx">vim_markdown_math&lt;/span>&lt;span class="p">=&lt;/span>&lt;span class="m">1&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="c">&amp;#34; Highlight YAML frontmatter&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="k">let&lt;/span> &lt;span class="nx">g&lt;/span>:&lt;span class="nx">vim_markdown_frontmatter&lt;/span>&lt;span class="p">=&lt;/span>&lt;span class="m">1&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="c">
&lt;/span>&lt;span class="c">&amp;#34; Vim-instant-markdown -----------------&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="c">
&lt;/span>&lt;span class="c">&amp;#34; If it takes your system too much, you can specify&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="c">&amp;#34; let g:instant_markdown_slow = 1&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="c">&amp;#34; if you don&amp;#39;t want to manually control it&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="c">&amp;#34; you can open this setting&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="c">&amp;#34; and when you open this, you can manually trigger preview&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="c">&amp;#34; via the command :InstantMarkdownPreview&lt;/span>&lt;span class="err">
&lt;/span>&lt;span class="err">&lt;/span>&lt;span class="k">let&lt;/span> &lt;span class="nx">g&lt;/span>:&lt;span class="nx">instant_markdown_autostart&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">0&lt;/span>&lt;span class="err">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="æ”¯æŒæ“ä½œ-8">æ”¯æŒæ“ä½œ&lt;/h4>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>å¿«æ·é”®&lt;/th>
&lt;th style="text-align:center">è§£é‡Š&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>:InstantMarkdownPreview&lt;/td>
&lt;td style="text-align:center">æ‰‹åŠ¨è§¦å‘markdownæ–‡ä»¶çš„é¢„è§ˆ&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="å¤šæ¸¸æ ‡é€‰æ‹©ç¼–è¾‘ç­‰">å¤šæ¸¸æ ‡é€‰æ‹©ã€ç¼–è¾‘ç­‰&lt;/h3>
&lt;p>åœ¨è¿™ä»½é…ç½®ä¸­, å¯ä»¥åœ¨é«˜äº®æŸå•è¯æ—¶, é€šè¿‡ä½¿ç”¨ &lt;code>Ctrl-n&lt;/code> æˆ–è€… &lt;code>Ctrl-p&lt;/code> è¿›è¡Œå¤šæ¸¸æ ‡é€‰æ‹©, ç„¶åè¿›è¡Œç¼–è¾‘æˆ–ä¿®æ”¹ç­‰æ“ä½œ.&lt;/p>
&lt;h3 id="å¿«é€Ÿæ–‡ä»¶æŸ¥æ‰¾">å¿«é€Ÿæ–‡ä»¶æŸ¥æ‰¾&lt;/h3>
&lt;p>åœ¨è¿™ä»½é…ç½®ä¸­, å¯ä»¥é€šè¿‡ä½¿ç”¨&lt;code>,R&lt;/code>è¿›è¡Œå…¨æ–‡æŸ¥æ‰¾æˆ–è€…&lt;code>,r&lt;/code>è¿›è¡Œå¿«é€ŸæŸ¥æ‰¾, æˆ–è€…åœ¨å½“å‰å­—ç¬¦ä¸²ä¸Šä½¿ç”¨&lt;code>,wR&lt;/code>ä»¥åŠ&lt;code>,wr&lt;/code>æ¥è¿›è¡Œå…¨æ–‡æŸ¥æ‰¾æˆ–è€…å¿«é€ŸæŸ¥æ‰¾.&lt;/p>
&lt;h3 id="å¿«é€Ÿæ³¨é‡Š">å¿«é€Ÿæ³¨é‡Š&lt;/h3>
&lt;p>ä½¿ç”¨&lt;a href="https://github.com/scrooloose/nerdcommenter">&lt;strong>NERDCommenter&lt;/strong>&lt;/a>æ’ä»¶å®Œæˆå¿«é€Ÿæ³¨é‡Š, å¯ä»¥é€šè¿‡&lt;code>\ci&lt;/code>è¿›è¡Œå¿«é€Ÿæ³¨é‡Š.&lt;/p>
&lt;h4 id="python-æ”¯æŒ">Python æ”¯æŒ&lt;/h4>
&lt;p>å®Œå¤‡çš„Pythonæ”¯æŒ, å¯ä»¥è‡ªåŠ¨è¯†åˆ«å½“å‰æ˜¯ç³»ç»Ÿç¯å¢ƒæˆ–è™šæ‹Ÿç¯å¢ƒ, ä½¿ç”¨&lt;code>:Isort&lt;/code>å¯æ™ºèƒ½å¯¹å¯¼å…¥åŒ…è¿›è¡Œæ’åº, ä½¿ç”¨&lt;code>:PymodeLintAuto&lt;/code>å¯è‡ªåŠ¨æ ¼å¼åŒ–.&lt;/p>
&lt;p>&lt;strong>é™¤äº†ä¸Šè¿°åˆ—å‡ºçš„åŠŸèƒ½ä»¥å¤–, è¿˜æœ‰å¾ˆå¤šæ–¹ä¾¿çš„ç‰¹æ€§ï¼Œå¯ä»¥å¤§å¤§æå‡æ•ˆç‡ï¼Œåœ¨ä½¿ç”¨ä¸­æ…¢æ…¢ä½“ä¼šå§ï¼æœ‰é—®é¢˜å¯ä»¥åœ¨&lt;a href="https://github.com/tao12345666333/vim">tao12345666333/vim&lt;/a> on github æissue&lt;/strong>&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Vim/">Vim</category><category domain="https://moelove.info/tags/Tool/">Tool</category></item><item><title>Pythonæ€§èƒ½ä¼˜åŒ–ä¹‹å·¥å…·ç¯‡</title><link>https://moelove.info/2016/05/14/Python%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E4%B9%8B%E5%B7%A5%E5%85%B7%E7%AF%87/</link><guid isPermaLink="true">https://moelove.info/2016/05/14/Python%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E4%B9%8B%E5%B7%A5%E5%85%B7%E7%AF%87/</guid><pubDate>Sat, 14 May 2016 00:14:54 +0000</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ä¹‹å‰å¯¹å…¬å¸çš„ä¸€ä¸ªåç«¯é¡¹ç›®åšäº†äº›æ€§èƒ½ä¼˜åŒ–, å­¦åˆ°ä¸€äº›å€¼å¾—è®°å½•çš„ä¸œè¥¿, è¿™ç¯‡ä¸»è¦æ˜¯ä»‹ç»åœ¨åšæ€§èƒ½åˆ†ææ—¶æ‰€ç”¨åˆ°çš„å·¥å…·, è‡³äºå¦‚ä½•ä¼˜åŒ–åŸºæœ¬å°±æ˜¯æ™ºè€…è§æ™ºå§, å¦‚æœæœ‰æ—¶é—´å¯èƒ½ä¼šå†™çš„.&lt;/p>
&lt;/blockquote>
&lt;h1 id="python-webåº”ç”¨ç¨‹åºçš„å¸¸è§æ€§èƒ½æŒ‡æ ‡">Python webåº”ç”¨ç¨‹åºçš„å¸¸è§æ€§èƒ½æŒ‡æ ‡&lt;/h1>
&lt;pre>&lt;code>æ­¤å¤„å¿½ç•¥å¤–éƒ¨DNSè§£æç­‰æ–¹é¢çš„æ€§èƒ½
&lt;/code>&lt;/pre>
&lt;ul>
&lt;li>å“åº”æ—¶é—´&lt;/li>
&lt;li>é”™è¯¯ç‡&lt;/li>
&lt;li>ååç‡&lt;/li>
&lt;li>æ‰§è¡Œæ—¶é—´&lt;/li>
&lt;li>å†…å­˜å ç”¨&lt;/li>
&lt;/ul>
&lt;h1 id="python-æ€§èƒ½åˆ†æå·¥å…·">Python æ€§èƒ½åˆ†æå·¥å…·&lt;/h1>
&lt;p>##TODO&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Python/">Python</category><category domain="https://moelove.info/tags/Performance/">Performance</category></item><item><title>æƒ³ä»äºŒæ¬¡å…ƒç¾¤ä½“æ‰‹é‡Œèµšé’±ï¼Ÿä½ çœŸçš„æ‡‚äºŒæ¬¡å…ƒå—!</title><link>https://moelove.info/2016/04/16/%E6%83%B3%E4%BB%8E%E4%BA%8C%E6%AC%A1%E5%85%83%E7%BE%A4%E4%BD%93%E6%89%8B%E9%87%8C%E8%B5%9A%E9%92%B1%E4%BD%A0%E7%9C%9F%E7%9A%84%E6%87%82%E4%BA%8C%E6%AC%A1%E5%85%83%E5%90%97/</link><guid isPermaLink="true">https://moelove.info/2016/04/16/%E6%83%B3%E4%BB%8E%E4%BA%8C%E6%AC%A1%E5%85%83%E7%BE%A4%E4%BD%93%E6%89%8B%E9%87%8C%E8%B5%9A%E9%92%B1%E4%BD%A0%E7%9C%9F%E7%9A%84%E6%87%82%E4%BA%8C%E6%AC%A1%E5%85%83%E5%90%97/</guid><pubDate>Sat, 16 Apr 2016 10:36:04 +0000</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>â€œèŠ‚æ“â€ï¼Œâ€œé¬¼ç•œâ€ï¼Œâ€œèŒâ€, &amp;quot;äºŒæ¬¡å…ƒ&amp;quot;è¿™äº›è¯æ˜¯ä¸æ˜¯é€æ¸çš„èå…¥äº†ä½ çš„æ—¥å¸¸ï¼Ÿ è¿™äº›è¯å…¶å®éƒ½æ˜¯äºŒæ¬¡å…ƒäº§ç‰©ã€‚è¶Šæ¥è¶Šå¤šçš„äººå°†å…³æ³¨ç‚¹æ”¾åˆ°äº†â€œäºŒæ¬¡å…ƒç¾¤ä½“â€ä¸Šï¼Œä½†æ˜¯è¿™é‡Œçš„ä»·å€¼å’Œå®ƒçœŸæ­£çš„å«ä¹‰ä½ æ‡‚äº†å—ï¼Ÿ&lt;/p>
&lt;/blockquote>
&lt;h2 id="ä»€ä¹ˆæ˜¯åŸæœ¬çš„äºŒæ¬¡å…ƒ">ä»€ä¹ˆæ˜¯åŸæœ¬çš„äºŒæ¬¡å…ƒ&lt;/h2>
&lt;p>å¾ˆå¤šäººè®¤ä¸ºäºŒæ¬¡å…ƒå°±æ˜¯æŒ‡â€œäºŒç»´å¹³é¢â€ï¼Œâ€œå¹³é¢ä¸–ç•Œâ€ï¼Œä¹Ÿæœ‰äººè®¤ä¸ºæ˜¯ACGNï¼Œä½†è¿™ä¸ªè§‚ç‚¹å…¶å®æ˜¯å¸¦æœ‰è¯¯åŒºçš„ã€‚&lt;/p>
&lt;p>ä¸ºä»€ä¹ˆè¿™æ ·è¯´å‘¢ï¼Ÿæˆ‘ä»¬ä¸€èµ·æ¥è¿½æº¯ä¸€ä¸‹â€œäºŒæ¬¡å…ƒâ€è¿™ä¸ªè¯æ˜¯ä»€ä¹ˆæ—¶å€™å‡ºç°çš„ï¼Œæœ‰éƒ¨å’Œæˆ‘å¹´é¾„ç›¸ä»¿çš„åŠ¨ç”»ç‰‡ã€ŠæœºåŠ¨æˆ˜èˆ°ã€‹(æš´éœ²å¹´é¾„ç³»åˆ—,æˆ‘ä¸‹ä¸€ç¯‡å°±å†™è¿™ä¸ª)ï¼Œå…¶ä¸­çš„åæ´¾ä»¬è¶…çº§å´‡æ‹œä¸€éƒ¨å«ã€Šæ¿€é’¢äºº3ã€‹çš„åŠ¨ç”»ç‰‡ï¼Œç”šè‡³è¿™éƒ¨åŠ¨ç”»ç‰‡å·²ç»æˆä¸ºåæ´¾å†›ä¸­çš„åœ£å…¸ï¼ˆé™¤äº†å¾ˆçƒ­è¡€å¾ˆå¥½çœ‹å¤–ï¼Œå…¶å®æ˜¯å› ä¸ºä»–ä»¬é€ƒäº¡çš„æ—¶å€™å°±åªå¸¦äº†è¿™ä¸€éƒ¨åŠ¨ç”»ç‰‡å§ï¼Œå……åˆ†è¯´æ˜åšèµ„æºå…šæ˜¯æœ‰å¥½å¤„çš„ï¼ï¼‰ï¼Œå½“ç„¶å‰§ä¸­çš„ä¸»è§’ä¹Ÿæ˜¯å¾ˆå–œæ¬¢è¿™éƒ¨åŠ¨ç”»ç‰‡çš„ã€‚åŠ¨ç”»ï¼ˆæœºåŠ¨æˆ˜èˆ°ï¼‰ä¸­çš„åæ´¾éå¸¸å–œæ¬¢æ¿€é’¢äºº3ä¸­çš„å¥³ä¸»èœèœå­ï¼Œä½†æ˜¯æ¯•ç«Ÿç°å®å’ŒåŠ¨ç”»æ˜¯ä¸å¯é€¾è¶Šçš„ï¼ˆæ˜æ˜éƒ½æ˜¯åœ¨åŠ¨ç”»é‡Œé¢ï¼ï¼‰ï¼Œå¤„äºä¼¤æ„Ÿä¸­çš„åæ´¾ä»¬ç›¸äº’å®‰æ…°ï¼šâ€œ&lt;strong>èœèœå­å†å¥½ï¼Œä½†å¥¹æ¯•ç«Ÿåªæ˜¯äºŒæ¬¡å…ƒçš„å¥³å­å•Šï¼&lt;/strong>â€ï¼Œè¿™å¥è¯å¼•èµ·äº†å¾ˆå¤šACGçˆ±å¥½è€…çš„å…±é¸£ï¼Œæ‰€ä»¥é€æ­¥çš„å€Ÿç”¨äº†å…¶ä¸­çš„â€œäºŒæ¬¡å…ƒâ€æ¥æè¿°è‡ªå·±æ‰€å–œçˆ±çš„ç”±ACGåˆ›é€ å‡ºæ¥çš„ä¸–ç•Œäº†ã€‚&lt;/p>
&lt;h2 id="ä»€ä¹ˆæ˜¯ç°åœ¨çš„äºŒæ¬¡å…ƒ">ä»€ä¹ˆæ˜¯ç°åœ¨çš„äºŒæ¬¡å…ƒ&lt;/h2>
&lt;p>å¾ˆå¤šäººè¯´ç°åœ¨çš„äºŒæ¬¡å…ƒæ˜¯â€œæ³›äºŒæ¬¡å…ƒâ€ï¼Œå¯è¿™ä¸ªâ€æ³›â€œåˆ°åº•æ˜¯æ³›åˆ°äº†ä»€ä¹ˆç¨‹åº¦å‘¢ï¼Ÿè¿™å°±å¥½åƒä»15å¹´å¼€å§‹ï¼Œâ€IPâ€œåœ¨åœˆå­é‡Œåµå¾—ç«çƒ­ï¼Œä½†åˆ°åº•ä»€ä¹ˆæ˜¯IPï¼Ÿå¾ˆå¤šäººåªæ˜¯çŸ¥é“ä¸€ä¸ªåè¯æˆ–è€…ä¸€ä¸ªæ¨¡ç³Šçš„æ¦‚å¿µç½¢äº†ã€‚
æœ‰å¤šå°‘çœŸæ­£çˆ†æ¬¾çš„IPäº§ç”Ÿå‘¢ï¼Ÿ&lt;/p>
&lt;p>ç°åœ¨ä¸€èˆ¬æŒ‡çš„äºŒæ¬¡å…ƒç¡®å®æ˜¯â€æ³›äºŒæ¬¡å…ƒâ€œï¼Œä¸ä»…åŒ…å«ç€ACGNï¼Œè¿˜åŒ…å«ç€å…¶ç›¸å…³çš„è¡ç”Ÿäº§ç‰©ï¼ˆè¿™ä¸æ˜¯åºŸè¯å—ï¼Ÿï¼‰ã€‚ä¹Ÿå°±æ˜¯è¿™ç§æ¨¡æ£±ä¸¤å¯çš„æ¦‚å¿µè®©ç»å¤§å¤šæ•°äººèº«å¤„æ¬¡å…ƒå£å¤–ï¼Œä¸å¾—å…¶é—¨è€Œå…¥ã€‚&lt;/p>
&lt;p>ä¸ºäº†é¿å…æ¦‚å¿µæ··æ·†ï¼Œæœ¬ç¯‡ä¸å…·ä½“è§£é‡Šâ€œæ ¸å¿ƒäºŒæ¬¡å…ƒæ–‡åŒ–â€å’Œâ€œæ³›äºŒæ¬¡å…ƒæ–‡åŒ–â€ï¼ˆæ”¾åˆ°ä¸‹ç¯‡æ¥å†™ï¼‰ï¼Œè°ˆè°ˆç°åœ¨çš„äºŒæ¬¡å…ƒç¾¤ä½“å³â€œæ³›äºŒæ¬¡å…ƒâ€ç¾¤ä½“ã€‚&lt;/p>
&lt;h3 id="å®…">&amp;quot;å®…&amp;quot;&lt;/h3>
&lt;p>å¤§å¤šæ•°æƒ…å†µä¸‹ï¼ŒACGçˆ±å¥½è€…è¢«å† ä¸Šäº†â€œå®…â€çš„æ ‡ç­¾ï¼Œå¤–ç•Œä¸€èˆ¬è¿™æ ·çœ‹æˆ‘ä»¬â€œä¸çˆ±å‡ºé—¨â€ï¼Œâ€œå°±çŸ¥é“çœ‹åŠ¨æ¼«â€ï¼Œâ€œæ²‰è¿·äºè™šæ‹Ÿä¸–ç•Œâ€ç­‰ç­‰ã€‚å®é™…ä¸Šâ€œå®…â€ä¹Ÿåˆ†äº†å¾ˆå¤šç§ï¼Œâ€œå¾¡å®…æ—â€åº”è¯¥æ˜¯ç›¸å¯¹è¾ƒæ—©çš„ç§°å‘¼äº†ï¼Œç°åœ¨å¤§å¤šä½¿ç”¨â€œå®…ç”·/å®…å¥³â€æ¥å½¢å®¹è¿™éƒ¨åˆ†äººå’Œé•¿æœŸå¾…åœ¨å®¶é‡Œä¸å‡ºå»çš„äººã€‚å¹¶ä¸”åŸºäºå½“å‰ç¯å¢ƒå’Œèˆ†è®ºç­‰ï¼Œâ€œå®…â€ä¸€åº¦è¢«åŠ ä¸Šäº†å˜å¼‚çš„è‰²å½©ã€‚&lt;/p>
&lt;p>ä½†æ˜¯å½“äºŒæ¬¡å…ƒç¾¤ä½“ä»¥â€œå®…â€è‡ªç§°æˆ–ç§°å‘¼åˆ«äººçš„æ—¶å€™ï¼Œä¸€èˆ¬æ˜¯æŒ‡å¯¹äºæŸç§å…´è¶£çˆ±å¥½çš„ç—´è¿·ï¼Œæœ‰æ—¶å€™ä¹ŸæŒ‡å¤§è§¦ï¼ˆæŸæ–¹é¢å¾ˆå‰å®³çš„äººï¼‰ã€‚è¿™ç§å€¾æ³¨äº†æƒ…æ„Ÿçš„ç—´è¿·ï¼Œä¸ä»…æ”¯æ’‘ç€æˆ‘ä»¬å¯ä»¥é•¿æ—¶é—´å®…åœ¨å®¶ï¼Œè¿˜å¯ä»¥ä¸æ–­çš„åˆ©ç”¨ç°æœ‰èµ„æºï¼Œå‘å±•è‡ªå·±çš„åœˆå­å’ŒæŠ€èƒ½ï¼Œç»“è¯†åŒå¥½ï¼Œåˆ†äº«å…´è¶£ï¼Œä¸€èµ·åšå¾ˆå¤šå¥½ç©çš„äº‹æƒ…ã€‚ä¸€èˆ¬ä¼šè¢«ç§°ä¸ºâ€œåŠ¨æ¼«å®…â€ï¼Œâ€œå¶åƒå®…â€ï¼Œâ€œæŠ€æœ¯å®…â€ç­‰ï¼Œä¹Ÿä¼šç§°ä¸ºâ€œæ¸¸æˆç‹—â€ï¼Œâ€œå•èº«æ±ªâ€ä¹‹ç±»çš„ã€‚ï¼ˆä½†æ˜¯æˆ‘ä»¬éƒ½æœ‰ç€åšç°å……çš„è§‰æ‚Ÿçš„ï¼ï¼‰&lt;/p>
&lt;h3 id="è…">â€œè…â€&lt;/h3>
&lt;p>è¿™ä¸ªç¾¤ä½“ä¸­å¥³æ€§ç›¸æ¯”ç”·æ€§æ›´å¤šä¸€äº›ï¼ˆç›®å‰è¡¨ç°å‡ºæ¥çš„æ˜¯è¿™æ ·ï¼‰ï¼Œè¿™ä¸ªç¾¤ä½“å¤šè¡¨ç°ä¸ºå¯¹â€œBLâ€ï¼ˆboyâ€™s loveï¼‰ï¼Œâ€œGLâ€ï¼ˆgirlâ€™s loveï¼‰ç­‰çš„å–œçˆ±ã€‚â€œè…â€å’Œâ€œå®…â€å¹¶ä¸èƒ½å®Œå…¨éš”ç¦»å¼€ï¼Œä¼šæœ‰é‡åˆï¼Œä¸è¿‡â€œå®…â€ç¾¤ä½“ä¸€èˆ¬æ›´å¤šçš„å…³æ³¨ç‚¹åœ¨äºè™šæ‹Ÿä¸–ç•Œä¸­ï¼Œè€Œå¾ˆå¯èƒ½ä¸€ä¸ªå¹¶ä¸å®…çš„å¦¹å­æœ‰å¤©ä½ çªç„¶å‘ç°å¥¹å…¶å®æ˜¯è…çš„ï¼Œå¹¶ä¸”é•¿æœŸYYä½ å’Œå…¶ä»–ç”·åŒäº‹ï¼ˆorzï¼‰ã€‚&lt;/p>
&lt;h3 id="coserloå¨˜èˆè§">â€œCoserâ€ï¼Œâ€œloå¨˜â€ï¼Œâ€œèˆè§â€&lt;/h3>
&lt;p>ä½œä¸ºä¸€æšé‡ç”ŸåæœŸï¼Œå¯¹è¿™éƒ¨åˆ†ç¾¤ä½“å’Œæˆ‘æ¥ä¸‹æ¥è¦è°ˆçš„â€œå”±è§â€ç­‰äº†è§£ä¹Ÿç›¸å¯¹å¤šäº†ä¸€äº›ã€‚Coserï¼ˆç©Cosplay çš„äººï¼‰ï¼Œloå¨˜ï¼ˆå–œæ¬¢Lolitaç©¿è¡£é£æ ¼çš„äººï¼‰ï¼Œèˆè§ï¼ˆä¸€èˆ¬æŒ‡å®…èˆçš„èˆè€…ï¼‰éƒ½é€æ¸å˜å¤šï¼Œè¿™ä¹Ÿå’Œå¤§ä¼—å¯¹è¿™ä¸ªç¾¤ä½“çš„æ¥å—åº¦é€æ¸å˜é«˜äº†æœ‰å…³ã€‚è¿™ä¸ªç¾¤ä½“ç›¸å¯¹çš„è¦è¾›è‹¦ä¸€äº›ï¼Œå–œæ¬¢æŸäº›ä¸œè¥¿ï¼Œå–œæ¬¢åˆ°äº†ä¸æ»¡è¶³äºçœ‹ï¼Œè€Œæƒ³è‡ªå·±äº²è‡ªå»å°è¯•ã€‚&lt;/p>
&lt;p>Coseréœ€è¦ç»è¿‡æœè£…ï¼Œé“å…·ï¼ŒåŒ–å¦†ç­‰å·¥åºæ‰“ç£¨ï¼Œè€Œä¸€èˆ¬åœ¨ç½‘ä¸Šç›´æ¥ä¹°çš„è¡£æœå¯èƒ½ä¸åˆé€‚è¿˜éœ€è¦è‡ªè¡Œä¿®æ”¹ã€‚è¿™ä¸‰ç±»äººéƒ½å¾ˆå®¹æ˜“è¢«å¤–ç•Œçš„äººæŠ•ä»¥å¦ç±»çš„ç›®å…‰ï¼Œä½†æ˜¯ä¹Ÿæ¯”è¾ƒå®¹æ˜“é€šè¿‡æ´»åŠ¨æˆ–è€…äº¤æµæ‰¾åˆ°åŒå¥½ã€‚æ¯•ç«Ÿè¿™äº›éƒ½æ˜¯æ—¢çœ‹è„¸åˆèµ°å¿ƒçš„å½¢å¼ï¼Œæ—¢ä¼ è¾¾è‡ªå·±å¯¹åŸä½œçš„æ„Ÿæƒ…åˆèƒ½å°†è‡ªå·±ç¾å¥½çš„ä¸€é¢ç¤ºäººã€‚&lt;/p>
&lt;h3 id="å”±è§">&amp;quot;å”±è§&amp;quot;&lt;/h3>
&lt;p>â€œå”±è§â€ï¼ˆæŠ•ç¨¿ç¿»å”±æ­Œæ›²çš„ä¸šä½™æ­Œæ‰‹ï¼‰ä¹Ÿè¶Šæ¥è¶Šå¤šï¼Œè€Œä¸”å¾ˆå¤šä¹Ÿå”±çš„éå¸¸æ£’ï¼ä»¥åŠ¨æ¼«çš„OPï¼ŒEDæŠ•ç¨¿è¾ƒå¤šï¼Œç›®å‰æœ‰å¾ˆå¤šçš„åº”ç”¨æˆ–ç½‘ç«™éƒ½æä¾›äº†æ–¹ä¾¿çš„éŸ³é¢‘å‘å¸ƒï¼Œç”µå°ä¹‹ç±»çš„åŠŸèƒ½ï¼Œæ¯”è¾ƒå®¹æ˜“è·å¾—ç²‰ä¸ã€‚&lt;/p>
&lt;h3 id="ç½‘é…">&amp;quot;ç½‘é…&amp;quot;&lt;/h3>
&lt;p>â€œç½‘é…â€ï¼ˆç½‘ç»œé…éŸ³ï¼‰å¤§å¤šæ˜¯åŸºäºç½‘é…æ–‡æˆ–æŸäº›å°è¯´è¿›è¡ŒPIAæˆï¼Œä¹Ÿæœ‰ä¸€éƒ¨åˆ†äººä¼šé€‰æ‹©åˆ¶ä½œå¹¿æ’­å‰§ä¹‹ç±»çš„ã€‚&lt;/p>
&lt;h3 id="å…¶ä»–">å…¶ä»–&lt;/h3>
&lt;p>å…¶ä»–å°±æ˜¯ä¸€éƒ¨åˆ†æˆ‘ä¸å¸¸æ¥è§¦æˆ–è€…äººæ•°ç›¸å¯¹è¾ƒå°‘çš„ç¾¤ä½“äº†ã€‚&lt;/p>
&lt;h2 id="ä¸ºä»€ä¹ˆæ˜¯äºŒæ¬¡å…ƒç¾¤ä½“">ä¸ºä»€ä¹ˆæ˜¯äºŒæ¬¡å…ƒç¾¤ä½“&lt;/h2>
&lt;p>åœ¨å¤§è‡´äº†è§£äº†å½“å‰äºŒæ¬¡å…ƒç¾¤ä½“ä¹‹åï¼Œæˆ‘ä»¬æ¥è°ˆè°ˆä¸ºä»€ä¹ˆä»äºŒæ¬¡å…ƒç¾¤ä½“å…¥æ‰‹&lt;/p>
&lt;ol>
&lt;li>ç¾¤ä½“åŸºæ•°å¤§ï¼Œè¦†ç›–é¢å¹¿ã€‚åœ¨ä¸Šé¢æˆ‘å·²ç»å¤§è‡´è¯´è¿‡äº†ï¼Œçœ‹çœ‹è‡ªå·±çš„å‘¨å›´ï¼Œéšä¾¿ä¸Šå¾®åšã€è´´å§ä¹‹ç±»çš„çœ‹çœ‹ï¼Œå¤§æŠµå°±çŸ¥é“äº†;&lt;/li>
&lt;li>å¢é•¿è¿…é€Ÿã€‚çœ‹çœ‹å½“å‰Aã€Bç«™ï¼Œè…¾è®¯åŠ¨æ¼«ç­‰çš„ç”¨æˆ·å¢é•¿é‡ä¹Ÿå¯çª¥ä¸€æ–‘;&lt;/li>
&lt;li>ä»˜è´¹èƒ½åŠ›å¼ºã€‚åªè¦æˆ³ä¸­äº†äºŒæ¬¡å…ƒç¾¤ä½“çš„Gç‚¹ï¼Œä»˜è´¹èƒ½åŠ›éå¸¸å¼ºï¼Œä»¥Coserå’Œloå¨˜ä¸ºä¾‹ï¼Œä¸€èˆ¬éƒ½ä¼šèŠ±ä¸Šä¸‡å—åœ¨æœè£…ä¸Š;&lt;/li>
&lt;li>è‡ªæˆ‘ä¼ æ’­èƒ½åŠ›è¾ƒå¼ºã€‚äºŒæ¬¡å…ƒç¾¤ä½“å¤§å¤šæ´»è·ƒåœ¨æ‰‹Qï¼Œå¾®åšï¼Œè´´å§ç­‰å¹³å°ä¸Šï¼Œä¸”æœ‰è‡ªå·±çš„åœˆå­ï¼Œè‡ªæˆ‘ä¼ æ’­èƒ½åŠ›ç›¸å¯¹æ›´å¼º;&lt;/li>
&lt;li>ç”¨æˆ·ç›¸å¯¹å¿ å®ã€‚ç”±äºäºŒæ¬¡å…ƒæ–‡åŒ–ä½œä¸ºä¸€ä¸ªç‹¬ç‰¹çš„äºšæ–‡åŒ–å‘å±•èµ·æ¥ï¼Œå½“å‰å æ®ä¸»ä½“çš„è¿˜æ˜¯90åï¼Œ00åï¼Œç¢ç‰‡åŒ–æ—¶é—´ç›¸å¯¹è¾ƒå¤šï¼Œä¸”æ›´å®¹æ˜“åœ¨åº”ç”¨/ç½‘ç«™ä¸­å½¢æˆå…³ç³»é“¾;&lt;/li>
&lt;li>äºŒæ¬¡å…ƒä½œå“ç›¸å¯¹å¯æ‰©å±•çš„é¢æ›´å¹¿ï¼Œæ›´å®¹æ˜“æ‰¾åˆ°å¢é•¿ç‚¹ã€‚&lt;/li>
&lt;/ol>
&lt;h2 id="å¯èƒ½å‘å±•çš„æ–¹å‘">å¯èƒ½å‘å±•çš„æ–¹å‘&lt;/h2>
&lt;h3 id="èµ„æºå¹³å°">èµ„æºå¹³å°&lt;/h3>
&lt;p>äºŒæ¬¡å…ƒç¾¤ä½“æœ¬å°±å¯¹èµ„æºæœ‰éå¸¸é«˜çš„æ¸´æœ›å’ŒæœŸå¾…ï¼Œå½“ç„¶ä¹Ÿå¾ˆæŒ‘å‰”ï¼Œæœ‰ç€å¾ˆå®Œæ•´çš„é€‰æ‹©è¦æ±‚ï¼Œç”¨èµ„æºå¸å¼•åˆ°ç”¨æˆ·ï¼Œæ‰æ˜¯è§£å†³äº†ç”¨æˆ·çš„éœ€æ±‚ã€‚&lt;/p>
&lt;h3 id="å‘¨è¾¹äº§ä¸š">å‘¨è¾¹äº§ä¸š&lt;/h3>
&lt;p>äºŒæ¬¡å…ƒç¾¤ä½“å¯¹äºæ­£ç‰ˆå‘¨è¾¹äº§ç‰©æ˜¯æœ‰ç€å¼ºçƒˆéœ€æ±‚çš„ï¼Œä½†æ˜¯ç›®å‰æ— è®ºæ˜¯å¸‚åœºè¿˜æ˜¯ä»·æ ¼ä¸Šéƒ½ä¸æ˜¯å¾ˆå¥½ã€‚&lt;/p>
&lt;h3 id="åŒäºº">åŒäºº&lt;/h3>
&lt;p>åŒäººèµ„æºå¯¹äºŒæ¬¡å…ƒæ–‡åŒ–çš„å‘å±•æ˜¯æœ‰ç€ç›¸å½“å¤§å½±å“çš„ï¼Œè‹¥èƒ½å¸å¼•åˆ°ç”¨æˆ·ï¼Œå°†å¯èƒ½è¿æ¥çˆ†å‘å¼çš„å¢é•¿ã€‚&lt;/p>
&lt;p>ä»¥ä¸Šéƒ½æ˜¯æˆ‘ä¸€æœ¬æ­£ç»çš„èƒ¡è¯´å…«é“ï¼Œå°å¿ƒè¯¯å…¥æ­§é€” 2333&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/ACG/">ACG</category></item><item><title>2015å°å›é¡¾</title><link>https://moelove.info/2015/12/31/2015%E5%B0%8F%E5%9B%9E%E9%A1%BE/</link><guid isPermaLink="true">https://moelove.info/2015/12/31/2015%E5%B0%8F%E5%9B%9E%E9%A1%BE/</guid><pubDate>Thu, 31 Dec 2015 00:00:00 +0000</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;p>æ—¶é—´è¿‡å¾—å¾ˆå¿«2015å¹´æœ€åä¸€å¤©ã€‚ è¿˜æ˜¯ç»§ç»­ç»™è‡ªå·±åšä¸ªæ€»ç»“å§ã€‚ å»å¹´ä¹Ÿæœ‰åšæ€»ç»“ï¼Œä¸è¿‡æ²¡æœ‰å‘å¸ƒåˆ°Blogç½¢äº†ã€‚&lt;/p>
&lt;p>2015å¹´åˆåœ¨å…¬å¸å®šäº†ä¸¤ä¸ªä¸»è¦ç›®æ ‡:&lt;/p>
&lt;ul>
&lt;li>å¯¹å·¥å…·çš„æ‰“ç£¨&lt;/li>
&lt;li>è®¡ç®—æœºå›¾å½¢å­¦&lt;/li>
&lt;/ul>
&lt;p>ç¬¬ä¸€ä¸ªç›®æ ‡ç®—æ˜¯åŸºæœ¬å®Œæˆï¼Œç°åœ¨åœ¨ç”¨çš„å·¥å…·éƒ½å¾ˆé¡ºæ‰‹ï¼Œæ•ˆç‡èƒ½æå‡å¾ˆå¤šï¼Œè€Œä¸”ç”¨èµ·æ¥ä¹Ÿå¾ˆçˆ½ï¼ç°åœ¨ä¹Ÿè¿˜ä¼šå†å°è¯•ä¸€äº›å…¶ä»–çš„å·¥å…·ï¼Œæˆ–è€…æå‡ç°åœ¨ä½¿ç”¨çš„å·¥å…·çš„ä¾¿åˆ©æ€§ã€‚æœ‰æ—¶é—´çš„è¯å¯ä»¥å†™ç¯‡æ–‡ç« ä»‹ç»ä¸€ä¸‹ã€‚ç¬¬äºŒä¸ªç›®æ ‡ç›®å‰æ²¡æœ‰ä»€ä¹ˆè¿›å±•ï¼Œå¯ä»¥è€ƒè™‘æ˜¯ä¸æ˜¯è¦ç•™åˆ°ä»Šå¹´äº†XDï¼Œå½“ç„¶è¿˜æœ‰ä¸€äº›å…¶ä»–è‡ªå·±å®šçš„ç›®æ ‡åŸºæœ¬å®Œæˆï¼Œå¤§è‡´å†™å†™è‡ªå·±çš„æ”¶è·å¥½äº†ã€‚&lt;/p>
&lt;h2 id="æ”¶è·">æ”¶è·&lt;/h2>
&lt;p>(å¤§è‡´æŒ‰ç…§æ—¶é—´æ¥å†™å§)&lt;/p>
&lt;ul>
&lt;li>è¯»äº†ä¸€éƒ¨åˆ† &lt;code>Nginx&lt;/code> çš„æºç ï¼Œç®—æ˜¯å¯¹Nginxæœ‰äº†æ¯”ä»¥å‰æ›´æ·±å…¥çš„è®¤è¯†ï¼Œä½†æ˜¯ç°åœ¨å›è¿‡å¤´æ¥å†é‡æ–°å®¡è§†çš„è¯ï¼Œå‘ç°å¯¹å®ƒçš„ç†è§£è¿˜è¿œè¿œä¸å¤Ÿï¼Œè¿˜éœ€è¦ç»§ç»­æ·±å…¥ã€‚&lt;/li>
&lt;li>å­¦ä¹ äº† &lt;code>Haskell&lt;/code>, Haskellæˆ‘è§‰å¾—æ˜¯ä¸€é—¨éå¸¸æ£’çš„è¯­è¨€ï¼Œéå¸¸å€¼å¾—å­¦ä¹ ï¼Œé€šè¿‡å¯¹è¿™é—¨è¯­è¨€çš„å­¦ä¹ ï¼Œæ”¹å˜äº†æˆ‘çš„ä¸€äº›æ€ç»´æ–¹å¼ã€‚é™¤äº†ç”¨å®ƒå†™è¿‡ä¸€äº›å°ç¨‹åºä»¥å¤–ï¼Œè¿˜æ²¡èƒ½åœ¨å·¥ç¨‹ä¸­å¤§é‡ä½¿ç”¨ï¼Œä»Šåç»§ç»­åŠ æ²¹ï¼Œå°½é‡å¼•å…¥åˆ°å·¥ç¨‹ä¸­ï½&lt;/li>
&lt;li>å­¦ä¹ äº† &lt;code>Node.js&lt;/code>, åŒæ ·çš„è¿˜ç¼ºä¹å·¥ç¨‹ä¸­çš„å®è·µ&lt;/li>
&lt;li>å­¦ä¹ äº† &lt;code>Backbone.js&lt;/code>,&lt;code>AngularJS&lt;/code> å’Œ &lt;code>ReactJS&lt;/code>. Backboneè®°å¿†ä¸­åº”è¯¥æ˜¯5æœˆä»½å·¦å³å­¦ä¹ çš„ï¼ŒReactJSè¦æ™šå¾ˆå¤šã€‚å†™Backboneçš„æ—¶å€™æƒ³èµ·æ¥äº†ä¹‹å‰ç”¨è¿‡çš„&lt;code>Riot&lt;/code>, è½»é‡ï¼Œéšæ„ï¼Œä½†æ˜¯è¦å†™å®Œæ•´çš„åº”ç”¨ç›¸æ¯”AngularJSä¹‹ç±»çš„è¦å†™å¾ˆå¤šä»£ç ã€‚&lt;/li>
&lt;li>å¼€æºäº†&lt;a href="https://pypi.python.org/pypi/qyweixin">qyweixin&lt;/a>å’Œä¸€ä¸ª&lt;a href="https://pypi.python.org/pypi/httpmultipart">HTTPmultipart&lt;/a>çš„åº“ï¼Œä¸‹è½½é‡å„è‡ªä¹Ÿéƒ½å·²ç»å‡ åƒäº†ï¼Œä¸Šæ¬¡åœ¨è¯„è®ºä¸­ä¹Ÿçœ‹åˆ°ç¡®å®æœ‰äººåœ¨ä½¿ç”¨ï½ è¿˜æ˜¯è›®å¼€å¿ƒçš„å•¦ï¼&lt;/li>
&lt;li>å­¦ä¼šäº†ä½¿ç”¨ &lt;code>Docker&lt;/code>ï¼Œä¹Ÿå‡†å¤‡å­¦ä¹ ä¸€äº›å†…éƒ¨æœºåˆ¶ä¹‹ç±»çš„ä¸œè¥¿ã€‚&lt;/li>
&lt;li>è¿˜åœ¨ç¿»è¯‘ä¸­çš„&lt;a href="https://tornado-zh.readthedocs.org/">Tornado 4.3æ–‡æ¡£&lt;/a>ä¹Ÿä¼šå°½å¿«æŠ½æ—¶é—´ç¿»è¯‘å®Œæˆçš„.&lt;/li>
&lt;li>æ­¤å¤–è¿˜æœ‰å­¦ä¹ äº†&lt;code>Lua&lt;/code>å’Œæ­£åœ¨æ·±å…¥å­¦ä¹ çš„&lt;code>Shell&lt;/code>ï¼Œè¿˜æœ‰ä¸€ç³»åˆ—çš„æ¡†æ¶å’Œåº“, æ­£åœ¨ç”¨æ¥å†™ä¸€äº›è‡ªå·±çš„å°ä¸œè¥¿ã€‚&lt;/li>
&lt;li>1383 Contributions.&lt;/li>
&lt;li>è¿è¥äº†å…¬ä¼—å· &lt;code>TheMoeLove&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>è¿˜æœ‰ä¸€äº›ç›®å‰è¿˜æ— æ³•æ”¾å…¥&lt;em>æ”¶è·&lt;/em>è¿™ä¸€é¡¹ä¸­çš„ä¸œè¥¿ï¼Œåœ¨2016å¹´å°½é‡éƒ½å†å¤šç§¯ç´¯ä¸€äº›ã€‚&lt;/p>
&lt;p>å¦å¤–ï¼Œä¸‹é¢è¿™éƒ¨åˆ†ä¹Ÿéå¸¸çš„é‡è¦ï¼&lt;/p>
&lt;ul>
&lt;li>è®¤è¯†äº†å¾ˆå¤šå¥½ç©çš„å°ä¼™ä¼´ï¼Œä»ä»–ä»¬é‚£é‡Œä¹Ÿå­¦åˆ°äº†å¾ˆå¤šä¸œè¥¿&lt;/li>
&lt;li>å·¥ä½œä¸­åŒäº‹ä»¬éƒ½å¾ˆå¥½ï¼Œæ„Ÿè°¢ç»™äºˆçš„å¸®åŠ©ï½&lt;/li>
&lt;/ul>
&lt;h2 id="æ€»ç»“">æ€»ç»“&lt;/h2>
&lt;ul>
&lt;li>å­¦ä¼šæ‹’ç»ã€‚ä¸€äº›äº‹æƒ…æ˜¯å¯ä»¥å®¹å¿çš„ï¼Œä½†æ˜¯è¦éµå®ˆåŸåˆ™ï¼Œä¹Ÿè¦è€ƒè™‘æ—¶é—´æˆæœ¬å’Œæ•ˆç‡é—®é¢˜ã€‚&lt;/li>
&lt;li>å­¦ä¹ å’Œæ€è€ƒã€‚è¿™ä¸€å¹´ä¹‹é—´å…¶å®å­¦åˆ°çš„ä¸œè¥¿ä¹Ÿè›®å¤šçš„ï¼Œåªä¸è¿‡æœ‰äº›ä¸œè¥¿æ²¡èƒ½åœ¨å·¥ç¨‹å®è·µä¸­åº”ç”¨ï¼Œæ•ˆæœä¸æ˜¯å¾ˆæ˜æ˜¾ã€‚å¤šæ€è€ƒï¼Œåšä¸ªé è°±çš„äººï¼Œå°½é‡ä¸åœ¨ç›¸åŒçš„åœ°æ–¹æ‘”å€’ä¸¤æ¬¡ã€‚&lt;/li>
&lt;li>å¤šè¯»ä¹¦&lt;/li>
&lt;li>å°è¯•æ–°ä¸œè¥¿&lt;/li>
&lt;li>å¤šæ·±å…¥ä¸€äº›ã€‚æµ…å°è¾„æ­¢ä¸æ˜¯åº”è¯¥æœ‰çš„çŠ¶æ€ã€‚&lt;/li>
&lt;li>åˆç†å®‰æ’è¿½ç•ªæ—¶é—´ 2333&lt;/li>
&lt;/ul></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Life/">Life</category></item><item><title>JSLint,JSHint,ESLintå¯¹æ¯”å’ŒVimé…ç½®</title><link>https://moelove.info/2015/11/28/JSLintJSHintESLint%E5%AF%B9%E6%AF%94%E5%92%8CVim%E9%85%8D%E7%BD%AE/</link><guid isPermaLink="true">https://moelove.info/2015/11/28/JSLintJSHintESLint%E5%AF%B9%E6%AF%94%E5%92%8CVim%E9%85%8D%E7%BD%AE/</guid><pubDate>Sat, 28 Nov 2015 23:43:49 +0000</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;p>æœ€è¿‘åœ¨ç”¨&lt;code>React&lt;/code>å†™é¡¹ç›®ï¼Œä½†æ˜¯&lt;a href="https://github.com/tao12345666333/vim">æˆ‘çš„Vimé…ç½®&lt;/a>ä¹‹å‰å¹¶æ²¡æœ‰é…ç½®å¯¹&lt;code>JSX&lt;/code>å’Œ&lt;code>ES6&lt;/code>çš„æ”¯æŒï¼Œç„¶åçœ‹ç€é‚£å †æŠ¥é”™å„ç§ä¸çˆ½äº†ï¼Œäºæ˜¯è¿˜æ˜¯è¦ç»§ç»­æŠ˜è…¾ï¼Œé¡ºä¾¿ä¹Ÿå¢åŠ äº†ç‚¹çŸ¥è¯†ï¼Œè®°å½•ä¸€ä¸‹ã€‚&lt;/p>
&lt;h1 id="ä¸»æµçš„js-lintå·¥å…·åŠä»‹ç»">ä¸»æµçš„JS Lintå·¥å…·åŠä»‹ç»&lt;/h1>
&lt;p>&lt;a href="https://en.wikipedia.org/wiki/JavaScript">JavaScript&lt;/a>å·²ç»å‘å±•è›®é•¿æ—¶é—´äº†ï¼Œå¯¹åº”çš„Lintå·¥å…·ä¹Ÿæ˜¯å±‚å‡ºä¸ç©·ï¼Œä¸‹é¢ä»‹ç»ä¸€ä¸‹æ¯”è¾ƒä¸»æµçš„å‡ ä¸ªLintå·¥å…·(å…¶å®æ˜¯æˆ‘ç”¨è¿‡çš„å‡ ä¸ªXD)&lt;/p>
&lt;h2 id="jslint">JSLint&lt;/h2>
&lt;p>&lt;a href="https://en.wikipedia.org/wiki/JSLint">JSLint&lt;/a>æ˜¯ç”±&lt;a href="https://en.wikipedia.org/wiki/Douglas_Crockford">Douglas Crockford&lt;/a>å¼€å‘çš„ï¼Œå¯èƒ½æ˜¯æœ€æ—©çš„JavaScript Lintå·¥å…·äº†å§ï¼Œå®ƒçš„åå­—æ¥æºäºè‘—åçš„&lt;code>C&lt;/code>è¯­è¨€å·¥å…·&lt;code>Lint&lt;/code>ã€‚è€é“æŠŠä»–è®¤ä¸ºçš„é&lt;code>Good Parts&lt;/code>çš„éƒ¨åˆ†éƒ½æŠ¥äº†warningï¼Œè€Œä¸”åœ¨å®ƒçš„&lt;a href="http://www.jslint.com/help.html">æ–‡æ¡£&lt;/a>ä¸­ä¹Ÿæåˆ°äº†ä½ åº”è¯¥æ¬£ç„¶æ¥å—æ‰€æœ‰çš„&lt;code>JSLint&lt;/code>çš„å»ºè®®ã€‚æœ€è¿‘çœ‹äº†ä¸‹ï¼Œè€é“è¿˜åœ¨æŒç»­æ›´æ–°ç€&lt;a href="https://github.com/douglascrockford/JSLint">è¿™ä¸ªé¡¹ç›®&lt;/a>ï¼Œè€Œä¸”&lt;a href="http://www.jslint.com/">å®˜ç½‘&lt;/a>ä¸Šä¹Ÿæœ‰ç€ä¸€ä¸ªåœ¨çº¿çš„ä½“éªŒå·¥å…·ï¼Œå¯ä»¥å°è¯•ä¸€ä¸‹ã€‚å¯¹äº†ï¼Œå¦‚æœæƒ³è¦ä½¿ç”¨è¿™ä¸ªå·¥å…·ï¼Œå»ºè®®çœ‹çœ‹è€é“åœ¨&lt;a href="https://www.youtube.com/watch?v=taaEzHI9xyY">YouTube&lt;/a>ä¸Šå…³äºJavaScriptç¼–ç¨‹é£æ ¼çš„è§†é¢‘ï¼Œè®²çš„è¿˜æ˜¯å¾ˆå¹½é»˜çš„ã€‚&lt;/p>
&lt;h2 id="jshint">JSHint&lt;/h2>
&lt;p>&lt;a href="https://en.wikipedia.org/wiki/JSHint">JSHint&lt;/a>æ˜¯ç”±&lt;a href="http://anton.kovalyov.net/">Anton Kovalyov&lt;/a>&lt;strong>åŸºäº&lt;/strong>&lt;code>JSLint&lt;/code>çš„ä»£ç å®ç°çš„å¼€æºé¡¹ç›®ï¼Œç”±äºJSLintæ—¶æœŸå¤§å¤šæ•°äººéƒ½åœ¨å—JSLintå‹è¿«ï¼ŒJSHintç›¸æ¯”è¾ƒä¹‹ä¸‹ï¼Œæ›´å‹å¥½ï¼Œä¹Ÿæ›´å®¹æ˜“é…ç½®ï¼Œæ‰€ä»¥å¾ˆå¿«å°±å‘å±•äº†èµ·æ¥ï¼Œä¹Ÿå¾—åˆ°äº†ä¼—å¤šIDEå’Œç¼–è¾‘å™¨çš„&lt;a href="http://jshint.com/install/">æ”¯æŒ&lt;/a>ã€‚ä½†æ˜¯ï¼Œç”±äºå®ƒæ˜¯åŸºäºJSLintå¼€å‘çš„ï¼Œè‡ªç„¶åŸæœ‰çš„ä¸€äº›é—®é¢˜å®ƒä¹Ÿç»§æ‰¿ä¸‹æ¥äº†ï¼Œæ¯”å¦‚ä¸æ˜“æ‰©å±•ï¼Œä¸å®¹æ˜“ç›´æ¥æ ¹æ®æŠ¥é”™å®šä½åˆ°å…·ä½“çš„è§„åˆ™é…ç½®ç­‰ï¼Œè™½ç„¶ä¹‹å‰å¥½åƒæ˜¯æœ‰è¿‡ç›¸å…³çš„è®¨è®ºï¼Œä½†æ˜¯ç°åœ¨ä»ç„¶æ²¡æœ‰ä»€ä¹ˆå¥½çš„è§£å†³åŠæ³•ã€‚å¥½åœ¨å®ƒå‘å±•çš„ä¸é”™ï¼Œå¾ˆå¤šæ—¶å€™é‡åˆ°çš„é—®é¢˜éƒ½å¯ä»¥åœ¨ç½‘ä¸Šæ‰¾åˆ°ç›¸å…³çš„è§£å†³æ–¹æ¡ˆï¼Œè€Œä¸”æ–‡æ¡£ä¹Ÿæ˜¯éå¸¸ä¸é”™çš„ã€‚&lt;/p>
&lt;h2 id="eslint">ESLint&lt;/h2>
&lt;p>&lt;a href="http://eslint.org/">ESLint&lt;/a>æ˜¯ç”±&lt;a href="https://www.nczonline.net/">Nicholas C. Zakas&lt;/a>åœ¨2013å¹´å¼€å§‹å¼€å‘çš„ï¼Œå®ƒçš„åˆè¡·å°±æ˜¯ä¸ºäº†èƒ½è®©å¼€å‘è€…èƒ½è‡ªå®šä¹‰è‡ªå·±çš„&lt;code>linting rules&lt;/code>ï¼Œè€Œä¸”å®ƒæä¾›äº†ä¸€å¥—ç›¸å½“å®Œå–„çš„æ’ä»¶æœºåˆ¶ï¼Œå¯ä»¥è‡ªç”±çš„æ‰©å±•ï¼ŒåŠ¨æ€åŠ è½½é…ç½®è§„åˆ™ï¼ŒåŒæ—¶å¯ä»¥æ–¹ä¾¿çš„æ ¹æ®æŠ¥é”™å®šä½åˆ°å…·ä½“çš„è§„åˆ™é…ç½®ã€‚è€Œä¸”æˆ‘æ¯”è¾ƒå–œæ¬¢å®ƒçš„ä¸€ç‚¹æ˜¯&lt;a href="http://eslint.org/docs/user-guide/configuring">æ–‡æ¡£&lt;/a>éå¸¸è¯¦ç»†ï¼Œå¯èƒ½è¿™ä¹Ÿæ˜¯çµæ´»æ‰€å¿…é¡»çš„å§ã€‚åœ¨è¿™é‡Œè¿˜è¦æä¸€ç‚¹ï¼Œ&lt;code>ESLint&lt;/code>æœ€åˆå¹¶ä¸æ˜¯ä¸ºäº†é€ ä¸€ä¸ªé‡å¤çš„è½®å­ï¼Œè€Œæ˜¯ä½œè€…åœ¨å®é™…ä½¿ç”¨ä¸­çš„éœ€æ±‚&lt;a href="https://github.com/eslint/eslint#why-dont-you-like-jshint">æ²¡æœ‰èƒ½å¾—åˆ°JSHintå›¢é˜Ÿçš„å›åº”&lt;/a>ï¼Œæ‰€ä»¥ä»–å°±ç»“åˆå½“æ—¶çš„&lt;code>JSHint&lt;/code>å’Œå¦ä¸€ä¸ªä»£ç é£æ ¼çš„æ£€æŸ¥å·¥å…·&lt;code>JSCS&lt;/code>å†™å‡ºæ¥äº†ç°åœ¨å…·å¤‡&lt;strong>ä»£ç é£æ ¼æ£€æŸ¥&lt;/strong>ï¼Œ&lt;strong>è‡ªå®šä¹‰æ’ä»¶æ‰©å±•&lt;/strong>åŠŸèƒ½çš„&lt;code>ESLint&lt;/code>äº†ã€‚&lt;/p>
&lt;h1 id="jslintjshintå’Œeslintçš„å¯¹æ¯”">JSLintï¼ŒJSHintå’ŒESLintçš„å¯¹æ¯”&lt;/h1>
&lt;p>è¿™ä¸‰ä¸ªå·¥å…·å„æœ‰ç‰¹è‰²ï¼Œæˆ‘åªæ˜¯åšä¸€ä¸‹å¯¹æ¯”ï¼Œé€‰æ‹©çš„è¯ï¼Œçœ‹ä¸ªäººéœ€æ±‚å°±å¥½äº†ã€‚&lt;/p>
&lt;h2 id="jslint-1">JSLint&lt;/h2>
&lt;h3 id="ä¼˜ç‚¹">ä¼˜ç‚¹&lt;/h3>
&lt;ul>
&lt;li>é…ç½®æ˜¯è€é“å·²ç»å®šå¥½çš„ï¼Œå¼€ç®±å³ç”¨ã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="ä¸è¶³">ä¸è¶³&lt;/h3>
&lt;ul>
&lt;li>æœ‰é™çš„é…ç½®é€‰é¡¹ï¼Œå¾ˆå¤šè§„åˆ™ä¸èƒ½ç¦ç”¨&lt;/li>
&lt;li>è§„èŒƒä¸¥æ ¼ï¼Œå‡¡æ˜¯ä¸ç¬¦åˆè€é“æ‰€è®¤ä¸ºçš„å¥½çš„é£æ ¼çš„ï¼Œéƒ½ä¼šæœ‰è­¦å‘Š(è¿™ä¸€é¡¹å°±çœ‹ä½ æ˜¯å¦å®Œå…¨è®¤åŒè€é“äº†)&lt;/li>
&lt;li>æ‰©å±•æ€§å·®&lt;/li>
&lt;li>æ— æ³•æ ¹æ®é”™è¯¯å®šä½åˆ°å¯¹åº”çš„è§„åˆ™&lt;/li>
&lt;/ul>
&lt;h2 id="jshint-1">JSHint&lt;/h2>
&lt;h3 id="ä¼˜ç‚¹-1">ä¼˜ç‚¹&lt;/h3>
&lt;ul>
&lt;li>æœ‰äº†å¾ˆå¤šå‚æ•°å¯ä»¥é…ç½®&lt;/li>
&lt;li>æ”¯æŒé…ç½®æ–‡ä»¶ï¼Œæ–¹ä¾¿ä½¿ç”¨&lt;/li>
&lt;li>æ”¯æŒäº†ä¸€äº›å¸¸ç”¨ç±»åº“&lt;/li>
&lt;li>æ”¯æŒäº†åŸºæœ¬çš„&lt;code>ES6&lt;/code>&lt;/li>
&lt;/ul>
&lt;h3 id="ä¸è¶³-1">ä¸è¶³&lt;/h3>
&lt;ul>
&lt;li>ä¸æ”¯æŒè‡ªå®šä¹‰è§„åˆ™&lt;/li>
&lt;li>æ— æ³•æ ¹æ®é”™è¯¯å®šä½åˆ°å¯¹åº”çš„è§„åˆ™&lt;/li>
&lt;/ul>
&lt;h2 id="eslint-1">ESLint&lt;/h2>
&lt;h3 id="ä¼˜ç‚¹-2">ä¼˜ç‚¹&lt;/h3>
&lt;ul>
&lt;li>é»˜è®¤è§„åˆ™é‡Œé¢åŒ…å«äº†&lt;code>JSLint&lt;/code>å’Œ&lt;code>JSHint&lt;/code>çš„è§„åˆ™ï¼Œæ˜“äºè¿ç§»(è¿™è‚¯å®šæ˜¯æ•…æ„çš„XD)&lt;/li>
&lt;li>å¯é…ç½®ä¸º&lt;code>è­¦å‘Š&lt;/code>å’Œ&lt;code>é”™è¯¯&lt;/code>ä¸¤ä¸ªç­‰çº§ï¼Œæˆ–è€…ç›´æ¥ç¦ç”¨æ‰&lt;/li>
&lt;li>æ”¯æŒæ’ä»¶æ‰©å±•&lt;/li>
&lt;li>å¯ä»¥è‡ªå®šä¹‰è§„åˆ™&lt;/li>
&lt;li>å¯ä»¥æ ¹æ®é”™è¯¯å®šä½åˆ°å¯¹åº”çš„è§„åˆ™&lt;/li>
&lt;li>æ”¯æŒ&lt;code>ES6&lt;/code>&lt;/li>
&lt;li>å”¯ä¸€ä¸€ä¸ªæ”¯æŒ&lt;code>JSX&lt;/code>çš„å·¥å…·&lt;/li>
&lt;/ul>
&lt;h3 id="ä¸è¶³-2">ä¸è¶³&lt;/h3>
&lt;ul>
&lt;li>éœ€è¦è¿›è¡Œä¸€äº›è‡ªå®šä¹‰é…ç½®(å› ä¸ºå¤ªçµæ´»äº†å˜›ï¼Œä¸è¿‡æ–‡æ¡£æ˜¯å¾ˆè¯¦ç»†çš„)&lt;/li>
&lt;li>&lt;strong>æ…¢&lt;/strong> (å®ƒæ¯”å…¶ä»–ä¸¤ä¸ªéƒ½è¦æ…¢)&lt;/li>
&lt;/ul>
&lt;h1 id="vimæ”¯æŒ">Vimæ”¯æŒ&lt;/h1>
&lt;p>æˆ‘ä»¬éƒ½ä½¿ç”¨&lt;a href="https://github.com/scrooloose/syntastic">&lt;code>Syntastic&lt;/code>&lt;/a>æ¥é…ç½®&lt;/p>
&lt;h2 id="jslintçš„vimé…ç½®">JSLintçš„Vimé…ç½®&lt;/h2>
&lt;p>æœ‰ä¸€ä¸ª&lt;a href="https://github.com/hallettj/jslint.vim">jslint.vim&lt;/a>å½“ç„¶ç‰ˆæœ¬å¤ªè€äº†ã€‚ã€‚æˆ‘ä»¬ä¸ç”¨è¿™ç§æ–¹å¼åšã€‚&lt;/p>
&lt;ul>
&lt;li>å®‰è£…&lt;code>jslint&lt;/code>&lt;/li>
&lt;/ul>
&lt;pre>&lt;code>sudo npm install jslint -g
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>åœ¨&lt;code>vimrc&lt;/code>ä¸­æ·»åŠ å¦‚ä¸‹é…ç½®&lt;/li>
&lt;/ul>
&lt;pre>&lt;code>let g:syntastic_javascript_checkers = ['jslint']
&lt;/code>&lt;/pre>&lt;h2 id="jshintçš„vimé…ç½®">JSHintçš„Vimé…ç½®&lt;/h2>
&lt;ul>
&lt;li>å®‰è£…&lt;code>jshint&lt;/code>&lt;/li>
&lt;/ul>
&lt;pre>&lt;code>sudo npm install jshint -g
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>åœ¨&lt;code>vimrc&lt;/code>ä¸­æ·»åŠ å¦‚ä¸‹é…ç½®&lt;/li>
&lt;/ul>
&lt;pre>&lt;code>let g:syntastic_javascript_checkers = ['jshint']
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>ä¹Ÿå¯ä»¥ä½¿ç”¨ç‹¬ç«‹æ’ä»¶&lt;a href="https://github.com/wookiehangover/jshint.vim">jshint.vim&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="eslintçš„vimé…ç½®">ESLintçš„Vimé…ç½®&lt;/h2>
&lt;pre>&lt;code>sudo npm install eslint -g
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>åœ¨&lt;code>vimrc&lt;/code>ä¸­æ·»åŠ å¦‚ä¸‹é…ç½®&lt;/li>
&lt;/ul>
&lt;pre>&lt;code>let g:syntastic_javascript_checkers = ['eslint']
&lt;/code>&lt;/pre>&lt;p>&lt;strong>è¿™é‡Œæœ‰ä¸ªå¾ˆé‡è¦çš„é—®é¢˜ï¼Œè®°å¾—è¦åœ¨æ·»åŠ ä¸€ä»½é…ç½®æ–‡ä»¶ï¼Œåœ¨å®˜ç½‘æˆ–è€…åœ¨æˆ‘vimé…ç½®çš„ä»“åº“å¯ä»¥æ‰¾åˆ°&lt;/strong>&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Vim/">Vim</category><category domain="https://moelove.info/tags/React/">React</category></item><item><title>ç”¨æ­£ç¡®çš„å§¿åŠ¿å¼€æºPythoné¡¹ç›®</title><link>https://moelove.info/2015/10/26/%E7%94%A8%E6%AD%A3%E7%A1%AE%E7%9A%84%E5%A7%BF%E5%8A%BF%E5%BC%80%E6%BA%90Python%E9%A1%B9%E7%9B%AE/</link><guid isPermaLink="true">https://moelove.info/2015/10/26/%E7%94%A8%E6%AD%A3%E7%A1%AE%E7%9A%84%E5%A7%BF%E5%8A%BF%E5%BC%80%E6%BA%90Python%E9%A1%B9%E7%9B%AE/</guid><pubDate>Mon, 26 Oct 2015 22:17:36 +0000</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>åšä¸ªå¤‡å¿˜ï¼Œä¹Ÿå¸Œæœ›å¯ä»¥å¸®åˆ°åˆ«äººã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="ç›®å½•ç»“æ„åˆå§‹åŒ–">ç›®å½•ç»“æ„ï¼ˆåˆå§‹åŒ–ï¼‰&lt;/h2>
&lt;p>ä¸€èˆ¬æˆ‘ä»¬éƒ½ä¼šé€‰æ‹©åœ¨é¡¹ç›®çš„é¡¶å±‚åŒ…å«è¾ƒåŸºç¡€çš„æ–‡ä»¶ï¼Œæ¯”å¦‚&lt;code>setup.py&lt;/code>ï¼Œ&lt;code>requirements&lt;/code>ï¼Œ&lt;code>README&lt;/code>ç­‰æ–‡ä»¶ã€‚
ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸€ä¸ªé¢„å‘å¸ƒçš„Pythoné¡¹ç›®ä¸­åº”è¯¥åŒ…å«ä»¥ä¸‹å‡ ç±»æ–‡ä»¶ï¼š&lt;/p>
&lt;ul>
&lt;li>projects (é¡¹ç›®çš„ä¸»ä½“æ–‡ä»¶)&lt;/li>
&lt;li>setup.py&lt;/li>
&lt;li>requirements&lt;/li>
&lt;li>Readme (é¡¹ç›®è¯´æ˜)&lt;/li>
&lt;li>docs (é¡¹ç›®æ–‡æ¡£)&lt;/li>
&lt;li>test&lt;/li>
&lt;/ul>
&lt;p>å…¶ä¸­ï¼Œ&lt;code>projects&lt;/code>æ–‡ä»¶å¤¹è¦ä»¥é¡¹ç›®å‘½åï¼Œå­˜æ”¾å®é™…çš„Python Package.
è¿™é‡Œæ”¾ä¸€ä¸ª&lt;a href="https://github.com/tao12345666333/httpmultipart">æˆ‘çš„é¡¹ç›®çš„ç›®å½•&lt;/a>ä½œä¸ºä¾‹å­ã€‚&lt;/p>
&lt;pre>&lt;code>âœ httpmultipart git:(master) tree -L 2
.
â”œâ”€â”€ build
â”‚Â Â  â”œâ”€â”€ bdist.linux-x86_64
â”‚Â Â  â””â”€â”€ lib.linux-x86_64-2.7
â”œâ”€â”€ dist
â”‚Â Â  â”œâ”€â”€ httpmultipart-0.1.0-py2.py3-none-any.whl
â”‚Â Â  â””â”€â”€ httpmultipart-0.1.0.tar.gz
â”œâ”€â”€ docs
â”‚Â Â  â”œâ”€â”€ _build
â”‚Â Â  â”œâ”€â”€ conf.py
â”‚Â Â  â”œâ”€â”€ index.rst
â”‚Â Â  â”œâ”€â”€ Makefile
â”‚Â Â  â”œâ”€â”€ userguide
â”‚Â Â  â””â”€â”€ userguide.rst
â”œâ”€â”€ env
â”‚Â Â  â”œâ”€â”€ bin
â”‚Â Â  â”œâ”€â”€ include
â”‚Â Â  â”œâ”€â”€ lib
â”‚Â Â  â””â”€â”€ local
â”œâ”€â”€ httpmultipart
â”‚Â Â  â”œâ”€â”€ __init__.py
â”‚Â Â  â”œâ”€â”€ __init__.pyc
â”‚Â Â  â”œâ”€â”€ main.py
â”‚Â Â  â””â”€â”€ main.pyc
â”œâ”€â”€ httpmultipart.egg-info
â”‚Â Â  â”œâ”€â”€ dependency_links.txt
â”‚Â Â  â”œâ”€â”€ not-zip-safe
â”‚Â Â  â”œâ”€â”€ PKG-INFO
â”‚Â Â  â”œâ”€â”€ SOURCES.txt
â”‚Â Â  â””â”€â”€ top_level.txt
â”œâ”€â”€ LICENSE
â”œâ”€â”€ MANIFEST.in
â”œâ”€â”€ README.rst
â”œâ”€â”€ setup.cfg
â”œâ”€â”€ setup.py
â””â”€â”€ test_httpmultipart.py
14 directories, 21 files
&lt;/code>&lt;/pre>&lt;p>è¿™ä¸ªç›®å½•ä¸­åŒ…å«äº†æˆ‘çš„&lt;code>virtual enviroment&lt;/code> å’Œæ‰“åŒ…æ„å»ºæ—¶å€™ç”Ÿæˆçš„æ–‡ä»¶å¤¹ã€‚
è¿™äº›ä¸œè¥¿åœ¨ä¸‹é¢ä¼šæåˆ°ã€‚&lt;/p>
&lt;h2 id="æ–‡æ¡£">æ–‡æ¡£&lt;/h2>
&lt;p>æ–‡æ¡£çš„è¯ï¼Œå¹¶æ²¡æœ‰ä¸¥æ ¼è¦æ±‚å¿…é¡»ä½¿ç”¨ä»€ä¹ˆæ ·çš„å·¥å…·è¿›è¡Œæ„å»ºï¼Œä¹Ÿæ²¡æœ‰å¾ˆä¸¥æ ¼çš„æ ¼å¼è¦æ±‚ã€‚ä¸è¿‡æˆ‘æ¨èä½¿ç”¨&lt;a href="http://sphinx-doc.org/">&lt;code>SPHINX&lt;/code>&lt;/a>,å®ƒæ˜¯ç”¨Pythonå†™çš„å·¥å…·ï¼Œä½¿ç”¨äº†ä¸€ç§å«åš&lt;code>reStructuredText&lt;/code>çš„è¯­æ³•ç¼–è¾‘ï¼Œå¯ä»¥å¯¹å¤šä¸ªæ–‡æœ¬æ–‡ä»¶é‡ç¼–ï¼Œå¯ä»¥è¾“å‡ºæˆHTMLæˆ–è€…PDFç­‰æ ¼å¼ã€‚&lt;/p>
&lt;p>è¿™é‡Œç¨å¾®ä»‹ç»ä¸‹ä½¿ç”¨ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>å®‰è£…&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-Bash" data-lang="Bash">$ pip install sphinx
&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>åˆå§‹åŒ–&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-Bash" data-lang="Bash">$ &lt;span class="nb">cd&lt;/span> docs
$ sphinx-quickstart
...#&lt;span class="o">(&lt;/span>è¿™é‡Œæœ‰ä¸€ç³»åˆ—çš„æé—®ï¼Œè¿›è¡Œåˆå§‹åŒ–&lt;span class="o">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>ç¼–è¯‘&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-Bash" data-lang="Bash">$ make html &lt;span class="c1">#(å¦‚æœæŒ‰ç…§é»˜è®¤é…ç½®ç”Ÿæˆçš„Makefileçš„è¯ï¼Œè¿™æ ·å°±å¯ä»¥ç¼–è¯‘å‡ºhtmläº†)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul>
&lt;p>Sphinxçš„ä½¿ç”¨è¿˜æœ‰å¾ˆå¤šå€¼å¾—è¯´çš„åœ°æ–¹ï¼Œæ¨èä¸¤ä¸ªèµ„æ–™ï¼š&lt;/p>
&lt;ul>
&lt;li>è‹±æ–‡çš„&lt;a href="http://sphinx-doc.org/contents.html">Sphinx çš„å®˜æ–¹æ–‡æ¡£&lt;/a>&lt;/li>
&lt;li>ä¸­æ–‡çš„&lt;a href="http://www.amazon.cn/%E5%9B%BE%E7%81%B5%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E4%B8%9B%E4%B9%A6-Python%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98-%E6%97%A5%E6%9C%ACBePROUD%E8%82%A1%E4%BB%BD%E6%9C%89%E9%99%90%E5%85%AC%E5%8F%B8/dp/B00KGQ4NRO/ref=sr_1_1?s=books&amp;amp;ie=UTF8&amp;amp;qid=1448116359&amp;amp;sr=1-1&amp;amp;keywords=python+%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98">Python å¼€å‘å®æˆ˜&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>å®˜æ–¹æ–‡æ¡£å†™çš„éå¸¸è¯¦ç»†ï¼Œé‚£æœ¬ä¹¦åå‘äºå®æˆ˜ï¼Œæ˜¯å¾ˆä¸é”™çš„ä¹¦ã€‚
è¿˜æœ‰å¾ˆå…³é”®çš„ä¸€ç‚¹æ˜¯Sphinxæœ‰&lt;code>autodoc&lt;/code>å’Œ&lt;code>automodule&lt;/code>çš„æ‰©å±•ï¼Œ
å¯ä»¥ä»ä»£ç ä¸­æå–å‡ºæ–‡æ¡£ï¼Œä¸ä»£ç ç›´æ¥è¿›è¡Œå…³è”ã€‚æä¾›ä¸€ä¸ª&lt;a href="https://tornado-zh.readthedocs.org/zh/latest/ioloop.html#running-an-ioloop">ä¾‹å­&lt;/a>å¯ä»¥æ–¹ä¾¿çš„åœ¨æ–‡æ¡£å’Œæºç ä¸­è¿›è¡Œè·³è½¬ã€‚&lt;/p>
&lt;h2 id="read-the-docs-æŒç»­æ–‡æ¡£é›†æˆ">Read the Docs æŒç»­æ–‡æ¡£é›†æˆ&lt;/h2>
&lt;p>è¯´å®Œå†™æ–‡æ¡£å°±ä¸å¾—ä¸æåˆ°&lt;a href="https://readthedocs.org/">&lt;code>Read the Dosc&lt;/code>&lt;/a>äº†,è¿™æ˜¯ä¸€ä¸ªç¬¬ä¸‰æ–¹çš„æ–‡æ¡£æ‰˜ç®¡å¹³å°,ä½¿ç”¨&lt;code>Django&lt;/code>å¼€å‘ï¼Œå®ƒå¯ä»¥å¾ˆè½»æ¾çš„å’ŒGithubä¸Šçš„é¡¹ç›®è¿›è¡Œé›†æˆï¼Œåœ¨æ¯æ¬¡ä»£ç æäº¤çš„æ—¶å€™ä¼šè‡ªåŠ¨è¿›è¡Œæ–‡æ¡£æ„å»ºï¼Œæˆ‘ä»¬å¯ä»¥çœ‹çœ‹&lt;a href="https://tornado-zh.readthedocs.org/">ç”Ÿæˆæ–‡æ¡£çš„æ•ˆæœ&lt;/a>ã€‚ç°åœ¨æœ‰å¾ˆå¤šå¼€æºé¡¹ç›®çš„æ–‡æ¡£éƒ½æ˜¯æ‰˜ç®¡åœ¨è¿™é‡Œçš„ï¼Œå…·ä½“çš„é…ç½®å¯ä»¥å‚è€ƒ&lt;a href="https://read-the-docs.readthedocs.org/en/latest/getting_started.html">å®˜æ–¹æ–‡æ¡£&lt;/a>ã€‚&lt;/p>
&lt;h2 id="travisci-æŒç»­é›†æˆ">TravisCI æŒç»­é›†æˆ&lt;/h2>
&lt;p>&lt;a href="https://travis-ci.org/">&lt;code>Travisci&lt;/code>&lt;/a>å¯ä»¥ä¸Githubéå¸¸å¥½çš„ç»“åˆï¼Œå¯ä»¥æ‰‹åŠ¨å¯¼å…¥&lt;code>repo&lt;/code>ï¼Œå¹¶è®¾ç½®&lt;code>Webhooks &amp;amp; services&lt;/code>,åœ¨æ¯æ¬¡æäº¤çš„æ—¶å€™éƒ½ä¼šæµ‹è¯•è¿è¡Œæ¥å‘ç°æ˜¯å¦å­˜åœ¨å¼‚å¸¸ã€‚åœ¨ä½¿ç”¨ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆåšä¸€äº›åˆå§‹åŒ–çš„æ“ä½œï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>åˆ›å»º&lt;code>.travis.yml&lt;/code>æ–‡ä»¶&lt;/p>
&lt;p>æˆ‘ä»¬éœ€è¦å‘Šè¯‰å®ƒä¸€äº›åŸºæœ¬çš„ä¿¡æ¯ï¼š&lt;/p>
&lt;ul>
&lt;li>æˆ‘ä»¬é¡¹ç›®ä½¿ç”¨çš„è¯­è¨€&lt;/li>
&lt;li>é¡¹ç›®ä½¿ç”¨çš„è¯­è¨€ç‰ˆæœ¬&lt;/li>
&lt;li>ç¯å¢ƒçš„ä¾èµ–&lt;/li>
&lt;li>æ˜¯å¦éœ€è¦&lt;code>sudo&lt;/code>æƒé™è¿è¡Œ&lt;/li>
&lt;li>ä½¿ç”¨ä»€ä¹ˆå‘½ä»¤æ¥å®‰è£…&lt;/li>
&lt;li>ä½¿ç”¨ä»€ä¹ˆå‘½ä»¤è¿è¡Œæµ‹è¯•&lt;/li>
&lt;/ul>
&lt;p>ä¸‹é¢æä¾›ä¸€ä¸ªä¾‹å­ï¼š&lt;/p>
&lt;pre>&lt;code> ```YML
language: python
python:
- 2.7
env:
- DEPS=true
- DEPS=false
sudo: false
install:
- travis_retry python setup.py install
- travis_retry pip install coveralls
- coverage run test_httpmultipart.py
- coverage report
script:
- python test_httpmultipart.py
after_success:
coveralls
```
&lt;/code>&lt;/pre>
&lt;/li>
&lt;/ul>
&lt;p>PSï¼š åœ¨&lt;code>install&lt;/code>è¿™ä¸€é¡¹é…ç½®ä¸­è¦æ³¨æ„ï¼Œå¦‚æœé¡¹ç›®å­˜åœ¨ä¾èµ–ï¼Œä¸€å®šè¦è¿›è¡Œå®‰è£…ï¼Œè¿˜æœ‰&lt;code>Travisci&lt;/code>æä¾›äº†å¤šé¡¹é…ç½®ï¼ŒåŒ…æ‹¬å‡ºé”™é‡è¯•ç­‰ï¼Œå…·ä½“é…ç½®å¯ä»¥å‚è€ƒ&lt;a href="http://docs.travis-ci.com/">å®˜æ–¹æ–‡æ¡£&lt;/a>ï¼Œè¦ç‰¹åˆ«æ³¨æ„&lt;code>travis_retry&lt;/code>ç­‰å‘½ä»¤çš„ä½¿ç”¨ï¼Œéå¸¸å®¹æ˜“å‡ºç°å‘ã€‚&lt;/p>
&lt;h2 id="æµ‹è¯•">æµ‹è¯•&lt;/h2>
&lt;p>Pythonæœ‰å†…ç½®çš„&lt;code>unittest&lt;/code>æµ‹è¯•åº“ï¼Œæ”¯æŒæ–­è¨€;å½“ç„¶è¿˜æœ‰å…¶ä»–çš„ä¸€äº›æµ‹è¯•æ¡†æ¶ï¼Œçœ‹ä¸ªäººå–œå¥½å’Œé¡¹ç›®éœ€æ±‚ã€‚åœ¨é¡¹ç›®ä¸­åº”è¯¥åŒ…å«æµ‹è¯•æ–‡ä»¶æˆ–è€…æµ‹è¯•ç›®å½•ï¼Œæµ‹è¯•æ–‡ä»¶ä¸€èˆ¬ä»¥&lt;code>test_projects_name.py&lt;/code>å‘½åã€‚æˆ‘é€‰æ‹©ä½¿ç”¨&lt;code>coverage&lt;/code>ä½œä¸ºæµ‹è¯•è¦†ç›–ç‡çš„æ£€æŸ¥ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªè¿è¡Œç¤ºä¾‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-Bash" data-lang="Bash">âœ httpmultipart git:&lt;span class="o">(&lt;/span>master&lt;span class="o">)&lt;/span> coverage run test_httpmultipart.py
....
----------------------------------------------------------------------
Ran &lt;span class="m">4&lt;/span> tests in 36.125s
OK
âœ httpmultipart git:&lt;span class="o">(&lt;/span>master&lt;span class="o">)&lt;/span> coverage report
Name Stmts Miss Branch BrPart Cover
-------------------------------------------------------------
httpmultipart/__init__.py &lt;span class="m">10&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="m">0&lt;/span> 100%
httpmultipart/main.py &lt;span class="m">37&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="m">4&lt;/span> &lt;span class="m">0&lt;/span> 100%
-------------------------------------------------------------
TOTAL &lt;span class="m">47&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="m">4&lt;/span> &lt;span class="m">0&lt;/span> 100%
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="coveralls-æµ‹è¯•è¦†ç›–ç‡æ£€æŸ¥">Coveralls æµ‹è¯•è¦†ç›–ç‡æ£€æŸ¥&lt;/h2>
&lt;p>&lt;a href="https://coveralls.io">Coveralls&lt;/a>å¯ä»¥å¾ˆå‹å¥½çš„æ”¯æŒGithubå’ŒBitbucketä»“åº“çš„å¯¼å…¥ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥å¾ˆå¥½çš„å’Œ&lt;code>Travisci&lt;/code>é›†æˆï¼Œåœ¨ä¸Šé¢æˆ‘ä»¬çš„&lt;code>.travis.yml&lt;/code>æ–‡ä»¶ä¸­ï¼Œåœ¨æœ€åä¸€é¡¹&lt;code>after_success&lt;/code>ä¸­ï¼Œæˆ‘ä»¬å°±é…ç½®äº†å¯¹&lt;code>Coveralls&lt;/code>çš„æ”¯æŒã€‚&lt;/p>
&lt;h2 id="å‘å¸ƒåŒ…åˆ°pypi">å‘å¸ƒåŒ…åˆ°PyPI&lt;/h2>
&lt;p>&lt;a href="https://pypi.python.org/pypi">PyPI - the Python Package Index&lt;/a>
æ˜¯Pythonçš„åŒ…ä»“åº“ï¼Œå®ƒå…è®¸æˆ‘ä»¬å°†è‡ªå·±å†™çš„åŒ…ä¸Šä¼ ä¸Šå»ï¼Œè¿™æ ·å°±å¯ä»¥ä½¿ç”¨&lt;code>pip&lt;/code>å’Œ&lt;code>easy_install&lt;/code>è¿›è¡Œå®‰è£…äº†ã€‚è¿™é‡Œè¯´ä¸€ä¸ªå¾ˆé‡è¦çš„äº‹æƒ…ï¼š
&lt;strong>è¯·åœ¨å‘å¸ƒè‡ªå·±é¡¹ç›®ä¹‹å‰åšå¥½æµ‹è¯•ï¼Œç¡®è®¤è‡ªå·±ä¸Šä¼ çš„æ˜¯ä¸€ä¸ªå¯ç”¨ï¼Œæ— å®³çš„åŒ…&lt;/strong>
å½“ä½ å·²ç»å®Œæˆä¸Šé¢çš„æ­¥éª¤ä¹‹åï¼Œé‚£ä¹ˆä½ åªéœ€è¦ä»¥ä¸‹å‡ æ­¥å°±å¯ä»¥å®Œæˆäº†ã€‚ä»¥æˆ‘çš„é¡¹ç›®ä¸ºä¾‹å­:&lt;/p>
&lt;ul>
&lt;li>é…ç½®&lt;code>setup.py&lt;/code>:&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-Python" data-lang="Python">&lt;span class="ch">#!/usr/bin/env python&lt;/span>
&lt;span class="kn">import&lt;/span> &lt;span class="nn">os&lt;/span>
&lt;span class="kn">import&lt;/span> &lt;span class="nn">re&lt;/span>
&lt;span class="kn">import&lt;/span> &lt;span class="nn">sys&lt;/span>
&lt;span class="kn">from&lt;/span> &lt;span class="nn">codecs&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="nb">open&lt;/span>
&lt;span class="k">try&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="kn">from&lt;/span> &lt;span class="nn">setuptools&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">setup&lt;/span>
&lt;span class="k">except&lt;/span> &lt;span class="ne">ImportError&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="kn">from&lt;/span> &lt;span class="nn">distutils.core&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">setup&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="n">sys&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">argv&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s1">&amp;#39;publish&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">system&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;python setup.py sdist upload&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="n">sys&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">exit&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="n">packages&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[&lt;/span>
&lt;span class="s1">&amp;#39;httpmultipart&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="p">]&lt;/span>
&lt;span class="n">requires&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[]&lt;/span>
&lt;span class="n">version&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>
&lt;span class="k">with&lt;/span> &lt;span class="nb">open&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;httpmultipart/__init__.py&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;r&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="n">fd&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="n">version&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">re&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">search&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sa">r&lt;/span>&lt;span class="s1">&amp;#39;^__version__\s*=\s*[&lt;/span>&lt;span class="se">\&amp;#39;&lt;/span>&lt;span class="s1">&amp;#34;]([^&lt;/span>&lt;span class="se">\&amp;#39;&lt;/span>&lt;span class="s1">&amp;#34;]*)[&lt;/span>&lt;span class="se">\&amp;#39;&lt;/span>&lt;span class="s1">&amp;#34;]&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="n">fd&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">read&lt;/span>&lt;span class="p">(),&lt;/span> &lt;span class="n">re&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">MULTILINE&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">group&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="n">version&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="k">raise&lt;/span> &lt;span class="ne">RuntimeError&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;Cannot find version information&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">with&lt;/span> &lt;span class="nb">open&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;README.rst&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;r&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;utf-8&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="n">f&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="n">readme&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">f&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">read&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="n">setup&lt;/span>&lt;span class="p">(&lt;/span>
&lt;span class="n">name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;httpmultipart&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="n">version&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">version&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="n">description&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;A httpmultipart post handler&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="n">long_description&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">readme&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="se">\n\n&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="n">author&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;Jintao Zhang&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="n">author_email&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;zhangjintao9020@gmail.com&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="n">url&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;https://github.com/tao12345666333/httpmultipart&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="n">packages&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">packages&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="n">package_data&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;LICENSE&amp;#39;&lt;/span>&lt;span class="p">]},&lt;/span>
&lt;span class="n">package_dir&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="s1">&amp;#39;httpmultipart&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;httpmultipart&amp;#39;&lt;/span>&lt;span class="p">},&lt;/span>
&lt;span class="n">include_package_data&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="bp">True&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="n">install_requires&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">requires&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="n">license&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;MIT&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="n">zip_safe&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="bp">False&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="n">platforms&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;any&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="n">classifiers&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">(&lt;/span>
&lt;span class="s1">&amp;#39;Development Status :: 5 - Production/Stable&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="s1">&amp;#39;Intended Audience :: Developers&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="s1">&amp;#39;Natural Language :: English&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="s1">&amp;#39;License :: OSI Approved :: MIT License&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="s1">&amp;#39;Programming Language :: Python&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="s1">&amp;#39;Programming Language :: Python :: 2.7&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="s1">&amp;#39;Topic :: Software Development :: Libraries&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="s1">&amp;#39;Topic :: Software Development :: Libraries :: Python Modules&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="p">),&lt;/span>
&lt;span class="p">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>å½“ç„¶å¤§éƒ¨åˆ†æ—¶å€™ä¹Ÿä¸éœ€è¦è¿™ä¹ˆéº»çƒ¦ï¼Œç®€åŒ–çš„é…ç½®å¯ä»¥å‚è€ƒå®˜æ–¹çš„æ–‡æ¡£ã€‚æ³¨æ„æœ€ä¸‹é¢é‚£éƒ¨åˆ†&lt;code>classifiers&lt;/code>æ˜¯æŒ‰ç…§&lt;a href="https://pypi.python.org/pypi?:action=list_classifiers">PyPIå®˜æ–¹çš„åˆ—è¡¨å¡«å†™&lt;/a>çš„ã€‚è¿˜æœ‰ï¼Œå¦‚æœæœ‰äº›æ–‡ä»¶æƒ³è¦é¢å¤–æ‰“åŒ…è¿›å»ï¼Œé‚£ä¹ˆéœ€è¦åœ¨æ ¹ç›®å½•æ·»åŠ &lt;code>MANIFEST.in&lt;/code>æ–‡ä»¶ã€‚&lt;/p>
&lt;ul>
&lt;li>æ‰“åŒ…ä»£ç &lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-Bash" data-lang="Bash">$ python setup.py sdist &lt;span class="c1"># ç”Ÿæˆpipæ”¯æŒçš„å®‰è£…åŒ…&lt;/span>
$ python setup.py bdist_wheel &lt;span class="c1"># ç”Ÿæˆæ”¯æŒeasy_installçš„å®‰è£…åŒ…&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>
&lt;p>å‘å¸ƒåˆ°PyPIä¸Š&lt;/p>
&lt;p>é¦–å…ˆåœ¨&lt;a href="https://pypi.python.org/pypi">PyPI&lt;/a>ä¸Š&lt;a href="https://pypi.python.org/pypi?%3Aaction=register_form">æ³¨å†Œ&lt;/a>ä¸€ä¸ªå¸å·ï¼Œç„¶åè¿›è¡Œä¸‹é¢ä¸¤æ­¥ï¼š&lt;/p>
&lt;ul>
&lt;li>æ³¨å†Œpackage
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">$ python setup.py register
$ &lt;span class="c1"># åœ¨è¿™ä¸€æ­¥ä¼šæœ‰ä¸€äº›æç¤ºï¼ŒæŒ‰ç…§æç¤ºé€‰æ‹©ï¼Œè¾“å…¥è‡ªå·±å¸å·å¯†ç ç›¸å…³çš„ä¿¡æ¯å³å¯&lt;/span>
$ &lt;span class="c1"># åœ¨æç¤ºä½ è¦ä¸è¦ä¿å­˜å¸å·ä¿¡æ¯çš„æ—¶å€™ï¼Œ&lt;/span>
$ &lt;span class="c1"># ä½ é€‰æ‹©äº†â€˜yâ€™ï¼Œ&lt;/span>
$ &lt;span class="c1"># åˆ™ä¼šåœ¨ä½ çš„ç”¨æˆ·ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ª .pypirc çš„æ–‡ä»¶ï¼Œ&lt;/span>
$ &lt;span class="c1"># å…¶ä¸­æ˜æ–‡ä¿å­˜ç€ä½ çš„å¸å·å’Œå¯†ç ã€‚&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>è¿™é‡Œç¨å¾®å†æä¸€ç‚¹ï¼Œå¦‚æœåœ¨æç¤ºæ˜¯å¦ä¿å­˜è´¦æˆ·ä¿¡æ¯çš„æ—¶å€™ï¼Œé€‰æ‹©äº†â€˜nâ€™ï¼Œæƒ³åæ‚”äº†ä¹Ÿæ²¡å…³ç³»ï¼Œæˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨åˆ›å»ºä¸€ä¸ª&lt;code>~/.pypirc&lt;/code>æ–‡ä»¶ã€‚æ ¼å¼å¦‚ä¸‹ï¼š
```
[distutils]
index-servers=pypi&lt;/p>
&lt;pre>&lt;code> [pypi]
repository = https://pypi.python.org/pypi
username = your username
password = your password
```
&lt;/code>&lt;/pre>
&lt;ul>
&lt;li>ä¸Šä¼ package
&lt;code>bash $ python setup.py sdist bdist_wheel upload&lt;/code>
åœ¨ä¸Šä¼ å®Œæˆæç¤º&lt;code>200&lt;/code>å“åº”çš„æ—¶å€™ï¼Œä½ å°±ä¸Šä¼ æˆåŠŸäº†ï¼Œå»PyPIä¸Šçœ‹çœ‹æœ‰æ²¡æœ‰ä¸Šä¼ æˆåŠŸçš„åŒ…ï¼Œå¹¶ä¸”è¯•ç€ç”¨&lt;code>pip&lt;/code>è¿›è¡Œå®‰è£…å§ï¼&lt;/li>
&lt;/ul>
&lt;p>è¿™é‡Œæˆ‘çœç•¥äº†ä¸€æ­¥ï¼Œå°±æ˜¯å‘å¸ƒå‰çš„æµ‹è¯•ï¼Œä½ å¯ä»¥ä½¿ç”¨&lt;a href="https://testpypi.python.org/pypi">PyPIçš„æµ‹è¯•æœåŠ¡å™¨&lt;/a>è¿›è¡Œæµ‹è¯•å‘å¸ƒï¼Œå‘å¸ƒåˆ°è¿™é‡Œçš„åŒ…å¹¶ä¸ä¼šå¯¹ä½ æ­£å¼å‘å¸ƒæœ‰ä»»ä½•å½±å“ã€‚&lt;/p>
&lt;h2 id="é¡¹ç›®æ‰˜ç®¡åœ¨githubä¸Š">é¡¹ç›®æ‰˜ç®¡åœ¨Githubä¸Š&lt;/h2>
&lt;p>å¼€æºåˆ°Githubä¸Šåï¼Œå°±æ˜¯ç»§ç»­ç»´æŠ¤å’Œå¼€å‘ï¼Œè¿™ç‚¹å°±ä¸å¤šè¯´äº†ã€‚&lt;/p>
&lt;h2 id="å¼€å‘ç›¸å…³">å¼€å‘ç›¸å…³&lt;/h2>
&lt;p>å»ºè®®ä½¿ç”¨&lt;code>virtualenv&lt;/code>ä¹‹ç±»çš„å·¥å…·æ„å»ºçº¯å‡€çš„ç¯å¢ƒï¼Œé‡å¤çš„åŠ¨ä½œäº¤ç»™&lt;code>Make&lt;/code>ä¹‹ç±»çš„å·¥å…·ã€‚&lt;/p>
&lt;p>è¿™ç¯‡ç®—æ˜¯ä¸€ä¸ªå°å°çš„æ€»ç»“åŠ å¤‡å¿˜å§ï¼Œç»éªŒå°šç¼ºï¼Œè¿˜æœ›æŒ‡æ­£ã€‚&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/pip/">pip</category><category domain="https://moelove.info/tags/Git/">Git</category></item><item><title>å¯¹ç›‘æ§ç³»ç»Ÿçš„æ€è€ƒ</title><link>https://moelove.info/2015/10/16/%E5%AF%B9%E7%9B%91%E6%8E%A7%E7%B3%BB%E7%BB%9F%E7%9A%84%E6%80%9D%E8%80%83/</link><guid isPermaLink="true">https://moelove.info/2015/10/16/%E5%AF%B9%E7%9B%91%E6%8E%A7%E7%B3%BB%E7%BB%9F%E7%9A%84%E6%80%9D%E8%80%83/</guid><pubDate>Fri, 16 Oct 2015 00:59:01 +0000</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>è¿‘æœŸåœ¨åšè¿ç»´ç›‘æ§æ–¹é¢çš„äº‹æƒ…ï¼Œä¹Ÿç ”ç©¶äº†ä¸€ä¸‹å…¶ä»–äººæ˜¯å¦‚ä½•åšçš„ã€‚æŠŠè‡ªå·±çš„æƒ³æ³•åšä¸ªæ€»ç»“è®°å½•ä¸€ä¸‹å§ã€‚&lt;/p>
&lt;/blockquote>
&lt;h3 id="ç›‘æ§æœŸæœ›çš„ç›®æ ‡">ç›‘æ§æœŸæœ›çš„ç›®æ ‡&lt;/h3>
&lt;ul>
&lt;li>åŠæ—¶å‘ç°&lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;p>éœ€è¦çš„æ˜¯å³æ—¶ç›‘æ§å¹¶æŠ¥è­¦&lt;/p>
&lt;/blockquote>
&lt;ul>
&lt;li>åŠæ—¶å®šä½&lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;p>å®šä½é—®é¢˜è¦åˆ†å¼€è®²&lt;/p>
&lt;/blockquote>
&lt;blockquote>
&lt;ul>
&lt;li>è¿ç»´å±‚é¢&lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;p>æ˜¯æœºå™¨ç¡¬ä»¶é—®é¢˜è¿˜æ˜¯ä¸Šé¢è¿è¡Œçš„åŸºç¡€æœåŠ¡çš„é—®é¢˜ï¼Œæˆ–è€…æ˜¯æ–°ä¸Šçº¿ä»£ç çš„é—®é¢˜ï¼Œéœ€è¦å›æ»šã€‚&lt;/p>
&lt;/blockquote>
&lt;/blockquote>
&lt;blockquote>
&lt;ul>
&lt;li>ä»£ç å±‚é¢&lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;p>åœ¨å‘ç”Ÿé—®é¢˜çš„æ—¶å€™ï¼Œä¼˜å…ˆè§£å†³é—®é¢˜ã€‚å®šä½ä»£ç é—®é¢˜æäº¤hotfix å¯ä»¥åœ¨è§£å†³é—®é¢˜ä¹‹ååšã€‚&lt;/p>
&lt;/blockquote>
&lt;/blockquote>
&lt;ul>
&lt;li>åŠæ—¶å¤„ç†&lt;/li>
&lt;li>æå‰é¢„æµ‹ï¼ˆå°½é‡å‡å°‘é—®é¢˜çš„å‘ç”Ÿï¼‰&lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;p>æå‰é¢„æµ‹å¯ä»¥åšçš„äº‹æƒ…æœ‰å¾ˆå¤šï¼Œæ•°æ®æŒ–æ˜/åˆ†æä¹‹ç±»çš„ã€‚å½“ç„¶æœ‰ä¸ªæ›´ç®€å•çš„æ–¹æ³•ï¼Œå°±æ˜¯å…ˆå°èŒƒå›´ä¸Šçº¿ï¼Œè¿›è¡Œç›‘æ§ã€‚å¦‚æœå‘ç°å‡ºé—®é¢˜äº†ï¼Œå°±åœæ­¢ä¸Šçº¿ï¼Œè¿›è¡Œå›æ»šã€‚ï¼ˆæˆ‘ä»¬ç°åœ¨å°±æ˜¯è¿™æ ·åšçš„ï¼Œè™½ç„¶åŸå› å¹¶ä¸æ˜¯è¿™ä¸ª 2333&lt;/p>
&lt;/blockquote>
&lt;h3 id="ç›‘æ§é‡åˆ°çš„ä¸»è¦é—®é¢˜">ç›‘æ§é‡åˆ°çš„ä¸»è¦é—®é¢˜&lt;/h3>
&lt;ul>
&lt;li>ç›‘æ§æŒ‡æ ‡å¤š&lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;p>æœåŠ¡å™¨CPU,å†…å­˜ï¼Œç½‘ç»œç­‰çš„æŒ‡æ ‡ï¼ŒåŸºç¡€æœåŠ¡Redis, MongoDBç­‰çš„è¿è¡ŒæŒ‡æ ‡ï¼Œå¯¹å¤–æœåŠ¡çš„APIæ˜¯å¦æ­£å¸¸å·¥ä½œï¼Œè¿˜æœ‰æ•°æ®æ˜¯å¦æ­£ç¡®ç­‰ã€‚&lt;/p>
&lt;/blockquote>
&lt;ul>
&lt;li>ç›‘æ§æŠ¥è­¦å¤š&lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;p>ç›‘æ§æŒ‡æ ‡å¤šçš„æ—¶å€™ï¼Œè‡ªç„¶æŠ¥è­¦ä¹Ÿä¼šç›¸åº”å¢åŠ ï¼Œä½†æ˜¯æŠ¥è­¦çš„åˆ†ç»„ä¸è½»é‡ç¼“æ€¥ä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆéº»çƒ¦çš„é—®é¢˜ã€‚è¿˜æœ‰å°±æ˜¯éƒ¨ç½²ç€ä¸åŒæœåŠ¡çš„æœºå™¨ï¼Œè§¦å‘æŠ¥è­¦æ—¶å€™çš„æŒ‡æ ‡ä¹Ÿä¸å¥½ç¡®å®šã€‚&lt;/p>
&lt;/blockquote>
&lt;ul>
&lt;li>æŠ¥è­¦å¤šè€Œä¸”æœ‰å…³è”ï¼Œå¦‚ä½•æŸ¥æ‰¾åŸå› &lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;p>å¯èƒ½åŒæ—¶ä¼šæœ‰å¤šä¸ªæŒ‡æ ‡è§¦å‘äº†æŠ¥è­¦ï¼Œä½†æ˜¯è¦å®šä½é—®é¢˜çš„æ—¶å€™ï¼Œå¦‚ä½•å¯ä»¥å¿«é€Ÿçš„å®šä½é—®é¢˜ã€‚&lt;/p>
&lt;/blockquote>
&lt;h3 id="å¤šç»´åº¦æ•°æ®ç›‘æ§">å¤šç»´åº¦æ•°æ®ç›‘æ§&lt;/h3>
&lt;blockquote>
&lt;p>è¿™ä¸ªè¯é¢˜å¤ªå¤§(è¦æ„Ÿè°¢Baiduçš„é¢œå¤§å¤§çš„æŒ‡ç‚¹ï¼‰&lt;/p>
&lt;/blockquote>
&lt;blockquote>
&lt;ul>
&lt;li>æ•°æ®ç›‘æ§ç¬¦åˆ&lt;a href="https://zh.wikipedia.org/wiki/%E5%B8%95%E9%9B%B7%E6%89%98%E6%B3%95%E5%88%99">äºŒå…«åŸåˆ™&lt;/a>,é‡è¦æ•°æ®éœ€è¦å¤šè§’åº¦è¿›è¡Œè§‚å¯Ÿï¼Œéœ€è¦æœ‰metaç®¡ç†ï¼Œéœ€è¦åŠ¨æ€ç®€å•é…ç½®ã€‚é€‰æ‹© å¥½çš„ï¼Œåˆç†çš„æ•°æ®æ¨¡å‹å¯ä»¥æœ‰æ•ˆçš„è¿›è¡Œå¤„ç†ã€‚&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;blockquote>
&lt;ul>
&lt;li>æ•°æ®é‡‡é›†éƒ¨åˆ†ï¼Œåœ¨å•æœºå™¨åšèšåˆ;å‘½åä¸Šä½¿ç”¨æ­£åˆ™æ ¼å¼åŒ–;å®Œå–„çš„é…ç½®åŠŸèƒ½ï¼Œæ”¯æŒæ•°æ®æµè‡ªå®šä¹‰ç»´åº¦ã€‚&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;ul>
&lt;li>å¯¹å¼€æºç³»ç»Ÿçš„ä½¿ç”¨ï¼Œéœ€è¦æŒ‰ç…§è‡ªå·±çš„å®é™…æƒ…å†µè¿›è¡Œé€‚é…ã€‚ä¿è¯é«˜å¯ç”¨æ€§&lt;/li>
&lt;/ul>
&lt;p>&lt;em>å…ˆå†™è¿™äº›å§ï¼Œä¹‹åæœ‰æ—¶é—´å†å†™ï¼Œè¿˜æœ‰QConä¸Šå¯¹è¿ç»´ç›‘æ§ä¸Šçš„ä¸€äº›åˆ†äº«ä¹Ÿéå¸¸å€¼å¾—æ€è€ƒ&lt;/em>&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/DevOps/">DevOps</category></item><item><title>Open-Falconç›‘æ§ç³»ç»Ÿéƒ¨ç½²</title><link>https://moelove.info/2015/10/13/Open-Falcon%E7%9B%91%E6%8E%A7%E7%B3%BB%E7%BB%9F%E9%83%A8%E7%BD%B2/</link><guid isPermaLink="true">https://moelove.info/2015/10/13/Open-Falcon%E7%9B%91%E6%8E%A7%E7%B3%BB%E7%BB%9F%E9%83%A8%E7%BD%B2/</guid><pubDate>Tue, 13 Oct 2015 21:01:00 +0000</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>æœ¬æ–‡å¹¶ä¸åˆ†æOpen-Falconçš„æ¶æ„æˆ–è€…é€‰ç”¨å®ƒçš„åŸå› ï¼Œå®˜æ–¹çš„æ–‡æ¡£åœ¨&lt;a href="http://book.open-falcon.com/zh/intro/README.html">è¿™é‡Œ&lt;/a>ï¼Œè™½ç„¶è¿˜ä¸å¤Ÿå®Œå–„ã€‚ä¸è¿‡è¿™ä¹Ÿæ˜¯æˆ‘å†™è¿™ç¯‡çš„åŸå› ï¼Œå®˜æ–¹æ–‡æ¡£å¹¶æ²¡èƒ½æŠŠæ•´ä¸ªéƒ¨ç½²è¿‡ç¨‹è¿åœ¨ä¸€èµ·ï¼Œè€Œä¸”ä¸ªåˆ«åœ°æ–¹æœ‰ç‚¹é—®é¢˜ã€‚æˆ‘åœ¨è¿™ç¯‡æ–‡ç« ä¸­å°±ä¸ä»‹ç»å„ä¸ªç»„ä»¶çš„ä½œç”¨å’ŒåŠŸèƒ½äº†ï¼Œåªæ˜¯å•çº¯çš„ä»‹ç»å¦‚ä½•ä»é›¶éƒ¨ç½²ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="å®‰è£…">å®‰è£…&lt;/h2>
&lt;h3 id="ä¸‹è½½">ä¸‹è½½&lt;/h3>
&lt;blockquote>
&lt;pre>&lt;code>&lt;/code>&lt;/pre>&lt;/blockquote>
&lt;p>wget &lt;a href="https://github.com/XiaoMi/open-falcon/releases/download/0.0.5/open-falcon-0.0.5.tar.gz">https://github.com/XiaoMi/open-falcon/releases/download/0.0.5/open-falcon-0.0.5.tar.gz&lt;/a> -O open-falcon.tar.gz&lt;/p>
&lt;pre>&lt;code>
### è§£å‹
&amp;gt; ```
mkdir tmp
tar -zxvf open-falcon.tar.gz -C ./tmp
&lt;/code>&lt;/pre>&lt;h3 id="åŸºç¡€ç¯å¢ƒ">åŸºç¡€ç¯å¢ƒ&lt;/h3>
&lt;blockquote>
&lt;pre>&lt;code>&lt;/code>&lt;/pre>&lt;/blockquote>
&lt;p>sudo apt-get install redis-server
sudo apt-get install mysql-server
pip install virtualenv&lt;/p>
&lt;h1 id="æ•°æ®åº“åˆå§‹åŒ–çš„ä»£ç æ¥æºäºå®˜æ–¹æ–‡æ¡£">æ•°æ®åº“åˆå§‹åŒ–çš„ä»£ç æ¥æºäºå®˜æ–¹æ–‡æ¡£&lt;/h1>
&lt;p>git clone &lt;a href="https://github.com/open-falcon/scripts.git">https://github.com/open-falcon/scripts.git&lt;/a>
cd scripts
mysql -h localhost -u root -p &amp;lt; db_schema/graph-db-schema.sql
mysql -h localhost -u root -p &amp;lt; db_schema/dashboard-db-schema.sql&lt;/p>
&lt;p>mysql -h localhost -u root -p &amp;lt; db_schema/portal-db-schema.sql
mysql -h localhost -u root -p &amp;lt; db_schema/links-db-schema.sql
mysql -h localhost -u root -p &amp;lt; db_schema/uic-db-schema.sql&lt;/p>
&lt;pre>&lt;code>
## é…ç½®
**æ•°æ®åº“è¿æ¥çš„é…ç½®æ ¼å¼æ˜¯:** `username:password@tcp(path:port)/xxxx`
### agent
&amp;gt; `mv cfg.example.json cfg.json &amp;amp;&amp;amp; ./control start &amp;amp;&amp;amp; ./control tail`
&amp;gt; å¼€å§‹ç›‘å¬1988ç«¯å£,æŸ¥çœ‹log.
&amp;gt; é»˜è®¤ç«¯å£æ˜¯1988, å¯ä»¥æ‰“å¼€ [http://127.0.0.1:1988](http://127.0.0.1:1988) æŸ¥çœ‹ä¸€ä¸ªæ¯”è¾ƒç®€å•çš„web dashboard. æ²¡ä»€ä¹ˆç‰¹æ®Šéœ€è¦çš„è¯, å¯ä»¥ä½¿ç”¨é»˜è®¤é…ç½®.
### hbs
&amp;gt; `mv cfg.example.json cfg.json &amp;amp;&amp;amp; ./control start &amp;amp;&amp;amp; ./control tail`
&amp;gt; å¿ƒè·³æœåŠ¡é»˜è®¤httpç«¯å£æ˜¯6030, rpc ç«¯å£ 6031
### transfer
&amp;gt; `mv cfg.example.json cfg.json &amp;amp;&amp;amp; ./control start &amp;amp;&amp;amp; ./control tail`
&amp;gt; é»˜è®¤httpç«¯å£æ˜¯6060, rpcç«¯å£8433
### judge
&amp;gt; `mv cfg.example.json cfg.json &amp;amp;&amp;amp; ./control start &amp;amp;&amp;amp; ./control tail`
&amp;gt; httpç«¯å£6081, rpcç«¯å£ 6080
&amp;gt; é…ç½®é¡¹ä¸­æ³¨æ„alarmçš„ redisé“¾æ¥ å’Œhbsçš„serveråœ°å€,å¦‚æœä¿®æ”¹è¿‡è¯·è®°å¾—å¯¹åº”.
### graph
&amp;gt; `mv cfg.example.json cfg.json &amp;amp;&amp;amp; ./control start &amp;amp;&amp;amp; ./control tail`
&amp;gt; rpcç«¯å£ 6070, httpç«¯å£ 6071
&amp;gt; æ•°æ®åº“æ–‡ä»¶å­˜å‚¨åœ¨`/home/work/data/6070` å¯åŠ¨æŠ¥é”™çš„è¯, æ¢sudo æˆ–è€… root ç”¨æˆ·å¯åŠ¨.
&amp;gt; æ³¨æ„ä¿®æ”¹æ•°æ®åº“è¿æ¥.
ä¸Šé¢çš„æœåŠ¡é…ç½®å®Œæˆæ•°æ®å°±å¼€å§‹é‡‡é›†äº†.
### dashboard
&amp;gt; ```
virtualenv env
source env/bin/activate
./env/bin/pip install -r pip_requirements.txt
# ä½¿ç”¨
./env/bin/python wsgi.py
# æˆ–è€…ç”¨
deactivate &amp;amp;&amp;amp; ./control start &amp;amp;&amp;amp; ./control tail
&lt;/code>&lt;/pre>&lt;blockquote>
&lt;p>å¯ä»¥æ›´æ”¹ä¸ºè‡ªå®šä¹‰ç«¯å£.è¿™é‡Œå¯ä»¥æŸ¥çœ‹Endpoints çš„ç›¸å…³æ•°æ®å¹¶ç»˜å›¾.&lt;/p>
&lt;/blockquote>
&lt;h3 id="query">query&lt;/h3>
&lt;blockquote>
&lt;p>&lt;code>mv cfg.example.json cfg.json &amp;amp;&amp;amp; ./control start &amp;amp;&amp;amp; ./control tail&lt;/code>
åªè¦ä¿®æ”¹cfg.json æ–‡ä»¶å³å¯, æ³¨æ„è¿˜æœ‰ &lt;code>graph_backends.txt&lt;/code> æ–‡ä»¶&lt;/p>
&lt;/blockquote>
&lt;h3 id="fe">fe&lt;/h3>
&lt;blockquote>
&lt;p>&lt;code>mv cfg.example.json cfg.json &amp;amp;&amp;amp; ./control start &amp;amp;&amp;amp; ./control tail&lt;/code>
æ³¨æ„é…ç½®é¡¹ç›®ä¸­çš„æ•°æ®åº“è¿æ¥, ä»¥åŠä¸‹é¢çš„&lt;code>shortcut&lt;/code> ä¸­éœ€è¦é…ç½®å¤–ç½‘å¯ä»¥è®¿é—®çš„åœ°å€,å¦‚æœä¸æ˜¯åœ¨æœåŠ¡å™¨éƒ¨ç½²çš„è¯,è¿™é‡Œé»˜è®¤ä¹Ÿæ²¡æœ‰å…³ç³».&lt;/p>
&lt;/blockquote>
&lt;h3 id="portal">portal&lt;/h3>
&lt;blockquote>
&lt;p>è¿™é‡Œè¦æ³¨æ„ä¸€ä¸ªå‘. å¦‚æœä½¿ç”¨&lt;code>./control start&lt;/code> å¯åŠ¨æœåŠ¡, å¹¶ä¸”æ›´æ”¹äº†é»˜è®¤ç«¯å£çš„, è¯·é…ç½® &lt;strong>gunicorn.conf&lt;/strong> ä¸­çš„&lt;strong>bind&lt;/strong>é¡¹. å¦‚æœæ˜¯ä½¿ç”¨&lt;code>python wsgi.py&lt;/code>å¯åŠ¨çš„è¯, ä¿®æ”¹&lt;strong>wsgi.py&lt;/strong>ä¸­çš„ç«¯å£å³å¯.
åŒæ—¶åœ¨é…ç½® &lt;code>frame/config.py&lt;/code> çš„æ—¶å€™, è¦æ³¨æ„æ‰€è°“&lt;strong>UIC_ADDRESS&lt;/strong> é€‰é¡¹çš„é…ç½®, å…¶å®å°±æ˜¯å¡«å†™ä¸Šé¢&lt;strong>fe&lt;/strong> æ¨¡å—çš„åœ°å€.&lt;/p>
&lt;pre>&lt;code>&lt;/code>&lt;/pre>&lt;/blockquote>
&lt;p>UIC_ADDRESS = {
'internal': 'http://127.0.0.1:port', #ä½ çš„å†…ç½‘åœ°å€
'external': 'http://your_fe_name', #å¤–ç½‘è®¿é—®çš„åœ°å€, å¦‚æœæ˜¯æœ¬åœ°éƒ¨ç½²,è¿™é‡Œå¯ä»¥å’Œå†…ç½‘åœ°å€ä¸€æ ·
}&lt;/p>
&lt;pre>&lt;code>
### alarm
&amp;gt; `mv cfg.example.json cfg.json &amp;amp;&amp;amp; ./control start &amp;amp;&amp;amp; ./control tail`
&amp;gt; éœ€è¦é…ç½®çš„å°±æ˜¯è‡ªå®šä¹‰çš„ç«¯å£ç›‘æ§åœ°å€, å’Œä¸‹é¢çš„api, å…¶ä»–éƒ¨åˆ†ä¿æŒé»˜è®¤å³å¯.
&amp;gt; åœ¨[å®ƒçš„æ–‡æ¡£](http://book.open-falcon.com/zh/install_from_src/alarm.html)ä¸­å†™ç€ä¸‹é¢è¿™æ ·çš„è¯´æ˜
&amp;gt; ```
{...
&amp;quot;api&amp;quot;: {
&amp;quot;portal&amp;quot;: &amp;quot;http://falcon.example.com&amp;quot;, # å†…ç½‘å¯è®¿é—®çš„portalçš„åœ°å€
&amp;quot;uic&amp;quot;: &amp;quot;http://uic.example.com&amp;quot;, # å†…ç½‘å¯è®¿é—®çš„uic(æˆ–fe)çš„åœ°å€
&amp;quot;links&amp;quot;: &amp;quot;http://link.example.com&amp;quot; # å¤–ç½‘å¯è®¿é—®çš„linksçš„åœ°å€
}
}
&lt;/code>&lt;/pre>&lt;blockquote>
&lt;p>ä½†æ˜¯å¦‚æœæŒ‰ç…§è¿™æ ·é…çš„è¯,æ‰€æœ‰ä¸œè¥¿å°±åªèƒ½åœ¨å†…ç½‘è®¿é—®äº†.è¿™æ˜æ˜¾æ˜¯ä¸ç¬¦åˆæˆ‘ä»¬çš„æœŸæœ›çš„. æ‰€ä»¥è¿™é‡Œè¦å…¨éƒ¨é…ç½®æˆå¤–ç½‘å¯ä»¥è®¿é—®çš„åœ°å€,&lt;strong>é˜²æ­¢è¸©å‘&lt;/strong>.&lt;/p>
&lt;/blockquote>
&lt;h3 id="sender">sender&lt;/h3>
&lt;blockquote>
&lt;p>è¿™ä¸ªç»„ä»¶ç”¨äºè°ƒç”¨è‡ªå·±æä¾›çš„çŸ­ä¿¡å’Œé‚®ä»¶æ¥å£, ç¼–è¾‘ cfg.json æ·»åŠ &lt;/p>
&lt;pre>&lt;code>&lt;/code>&lt;/pre>&lt;/blockquote>
&lt;p>{...
'api': {
'sms': 'http://your_send_sms_api',
'mail': 'http://your_send_mail_api'
}
}&lt;/p>
&lt;pre>&lt;code>&amp;gt; åœ¨è°ƒç”¨çš„æ—¶å€™, ä¼šæŠŠæ¶ˆæ¯å…ˆå†™å…¥redisé˜Ÿåˆ—ä¸­, ä¹‹åå†è°ƒç”¨æ¥å£,è¿›è¡Œæ¶ˆæ¯å‘é€.
&amp;gt; worker å‚æ•°æ˜¯å¯¹é˜Ÿåˆ—çš„é…ç½®.
### links
&amp;gt; `mv cfg.example.json cfg.json &amp;amp;&amp;amp; ./control start &amp;amp;&amp;amp; ./control tail`
&amp;gt; å‘Šè­¦åˆå¹¶ç»„ä»¶, pythonåº”ç”¨, è®°å¾—ä¿®æ”¹é»˜è®¤ç«¯å£å³å¯.
## å…¶ä»–
### task
&amp;gt; ç›‘æ§è‡ªæ£€ç¨‹åº
### gateway
&amp;gt; æ²¡æœ‰è·¨æœºæˆ¿é—®é¢˜å¯ä»¥å¿½ç•¥.(hhah
### redis-monitor.py
&amp;gt; scripts æ–‡ä»¶å¤¹ä¸­ä¸€ä¸ªå¾ˆç®€å•çš„è„šæœ¬, æŠŠredis info ä¸­çš„æ•°æ®è¯»å‡º,å†™å…¥æ•°æ®åº“, ä¾›ç›‘æ§ä½¿ç”¨.
æœ€åé™„å›¾ä¸€å¼ ï¼Œå‰å‡ å¤©æˆ‘å¯åŠ¨è¿™ä¸ªæœåŠ¡æ—¶å€™çš„ç»ˆç«¯ã€‚
![screen_shot](http://moelove.qiniudn.com/1911x1160_scrot.png)
&lt;/code>&lt;/pre></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/DevOps/">DevOps</category><category domain="https://moelove.info/tags/Open-Falcon/">Open-Falcon</category><category domain="https://moelove.info/tags/Go/">Go</category></item><item><title>æºç ç¼–è¯‘MongoDB</title><link>https://moelove.info/2015/09/13/%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91MongoDB/</link><guid isPermaLink="true">https://moelove.info/2015/09/13/%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91MongoDB/</guid><pubDate>Sun, 13 Sep 2015 21:28:43 +0000</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ä¸Šå‘¨æ”¾å‡æ­£å¥½æœ‰æ—¶é—´ï¼Œç¼–è¯‘å®‰è£…äº†MongoDBï¼Œè™½ç„¶MongoDBç”¨äº†æŒºé•¿æ—¶é—´çš„ï¼Œä½†è¿˜æ˜¯ç¬¬ä¸€æ¬¡ç”¨æºç ç¼–è¯‘ã€‚åœ¨æ­¤åšä¸ªå¤‡å¿˜ã€‚å› ä¸ºå·²ç»å®Œæ•´ç¼–è¯‘å®‰è£…è¿‡äº†ï¼Œæ‰€ä»¥å†™èµ·æ¥çš„æ—¶å€™ï¼Œå°±æŒ‰ç…§å…ˆçŸ¥è§†è§’æ¥å†™äº†ï½ 2333&lt;/p>
&lt;/blockquote>
&lt;h2 id="ä¸‹è½½mongodbæºç ">ä¸‹è½½MongoDBæºç &lt;/h2>
&lt;p>MongoDBçš„&lt;a href="https://www.mongodb.org/">å®˜ç½‘&lt;/a>ä¸Šæ˜¯æœ‰å·²ç»ç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶åŒ…çš„ï¼Œè¿™é‡Œé€‰æ‹©clone &lt;a href="https://github.com/mongodb/mongo">MongoDBåœ¨githubä¸Šçš„ä»“åº“&lt;/a>&lt;/p>
&lt;pre>&lt;code>git clone https://github.com/mongodb/mongo &amp;amp;&amp;amp; cd mongo
&lt;/code>&lt;/pre>&lt;p>åœ¨&lt;code>docs/building.md&lt;/code>ä¸­æ˜¯ç¼–è¯‘æ‰€éœ€çš„ä¾èµ–ã€‚&lt;/p>
&lt;ul>
&lt;li>A modern C++ compiler. One of the following is required.
&lt;ul>
&lt;li>GCC 4.8.2 or newer&lt;/li>
&lt;li>Clang 3.4 (or Apple XCode 5.1.1 Clang) or newer&lt;/li>
&lt;li>Visual Studio 2013 Update 2 or newer&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Python 2.7&lt;/li>
&lt;li>SCons 2.3&lt;/li>
&lt;/ul>
&lt;p>æˆ‘è¿™å°æœåŠ¡å™¨æ˜¯CentOS 6.5, ä¸Šé¢çš„gccç‰ˆæœ¬æ¯”è¾ƒä½ï¼Œè¿™é‡Œå°±å…ˆæ›´æ–°gccå’¯.&lt;/p>
&lt;pre>&lt;code>gcc --version
gcc (GCC) 4.4.7 20120313 (Red Hat 4.4.7-16)
Copyright Â© 2010 Free Software Foundation, Inc.
æœ¬ç¨‹åºæ˜¯è‡ªç”±è½¯ä»¶ï¼›è¯·å‚çœ‹æºä»£ç çš„ç‰ˆæƒå£°æ˜ã€‚
æœ¬è½¯ä»¶æ²¡æœ‰ä»»ä½•æ‹…ä¿ï¼›
åŒ…æ‹¬æ²¡æœ‰é€‚é”€æ€§å’ŒæŸä¸€ä¸“ç”¨ç›®çš„ä¸‹çš„é€‚ç”¨æ€§æ‹…ä¿ã€‚
&lt;/code>&lt;/pre>&lt;h2 id="ç¼–è¯‘å‡çº§gcc">ç¼–è¯‘å‡çº§gcc&lt;/h2>
&lt;p>åœ¨gccçš„&lt;a href="https://gcc.gnu.org/">å®˜ç½‘&lt;/a>æ‰¾åˆ°&lt;a href="https://gcc.gnu.org/install/download.html">ä¸‹è½½é¡µé¢&lt;/a>ã€‚ä½¿ç”¨&lt;a href="https://gcc.gnu.org/svn.html">svn&lt;/a>æˆ–è€…é€šè¿‡&lt;a href="https://gcc.gnu.org/mirrors.html">ftpé•œåƒç«™&lt;/a>ä¸‹è½½æºç .
æˆ‘ä½¿ç”¨äº†&lt;a href="http://ftp.tsukuba.wide.ad.jp/software/gcc/">ä¸€ä¸ªftpé•œåƒç«™&lt;/a>ä¸‹è½½çš„&lt;a href="http://ftp.tsukuba.wide.ad.jp/software/gcc/releases/gcc-5.2.0/gcc-5.2.0.tar.bz2">æºç å‹ç¼©åŒ…&lt;/a>ã€‚ ç„¶åè¿›è¡Œè§£å‹å’Œå®‰è£…ä¾èµ–ã€‚&lt;/p>
&lt;pre>&lt;code>tar -xjf gcc-5.2.0.tar.bz2 &amp;amp;&amp;amp; cd gcc-5.2.0
./contrib/download_prerequisites(ç­‰å¾…ä¾èµ–å®Œæˆ)
&lt;/code>&lt;/pre>&lt;p>ä¹‹åç¼–è¯‘&lt;/p>
&lt;pre>&lt;code>cd .. &amp;amp;&amp;amp; mkdir gcc-build-5.2.0 &amp;amp;&amp;amp; cd gcc-build-5.2.0
# ç¼–è¯‘
../gcc-5.2.0/configure --enable-checking=release --enable-languages=c,c++ --disable-multilib
&lt;/code>&lt;/pre>&lt;p>è¾“å‡ºï¼š&lt;/p>
&lt;pre>&lt;code>checking build system type... x86_64-unknown-linux-gnu
checking host system type... x86_64-unknown-linux-gnu
checking target system type... x86_64-unknown-linux-gnu
checking for a BSD-compatible install... /usr/bin/install -c
checking whether ln works... yes
checking whether ln -s works... yes
checking for a sed that does not truncate output... /bin/sed
checking for gawk... gawk
checking for libatomic support... yes
checking for libcilkrts support... yes
checking for libitm support... yes
checking for libsanitizer support... yes
checking for libvtv support... yes
checking for gcc... gcc
checking for C compiler default output file name... a.out
checking whether the C compiler works... yes
checking whether we are cross compiling... no
checking for suffix of executables...
checking for suffix of object files... o
checking whether we are using the GNU C compiler... yes
checking whether gcc accepts -g... yes
checking for gcc option to accept ISO C89... none needed
checking for g++... g++
checking whether we are using the GNU C++ compiler... yes
checking whether g++ accepts -g... yes
checking whether g++ accepts -static-libstdc++ -static-libgcc... no
checking for gnatbind... no
checking for gnatmake... no
checking whether compiler driver understands Ada... no
checking how to compare bootstrapped objects... cmp --ignore-initial=16 $$f1 $$f2
checking for objdir... .libs
configure: WARNING: using in-tree ISL, disabling version check
&lt;/code>&lt;/pre>&lt;p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œ å°±è¿™æ ·gccå°±å¯ä»¥ç¼–è¯‘å®Œæˆäº†ã€‚ ä½†æ˜¯å› ä¸ºæˆ‘è¿™å°æœºå™¨æ˜¯å•æ ¸1Gæ²¡æœ‰swapåŒºï¼Œ æ‰€ä»¥æˆ‘é‡åˆ°äº†ä¸‹é¢çš„é—®é¢˜ï¼š&lt;/p>
&lt;pre>&lt;code># æ’ç‰ˆæœ‰ç‚¹é”™ä¹±æƒ¹...
build/vec.o
build/min-insn-modes.o
build/gensupport.o
build/print-rtl.o
build/read-md.o
build/errors.o ../build-x86_64-unknown-linux-gnu/libiberty/libiberty.a
build/genattrtab ../../gcc-5.2.0/gcc/common.md ../../gcc-5.2.0/gcc/config/i
386/i386.md insn-conditions.md \
-Atmp-attrtab.c -Dtmp-dfatab.c -Ltmp-latencytab.c
make[3]: *** [s-attrtab] å·²æ€æ­»
make[3]: Leaving directory `/home/tao/gcc-build-5.0.2/gcc'
make[2]: *** [all-stage1-gcc] é”™è¯¯ 2
make[2]: Leaving directory `/home/tao/gcc-build-5.0.2'
make[1]: *** [stage1-bubble] é”™è¯¯ 2
make[1]: Leaving directory `/home/tao/gcc-build-5.0.2'
make: *** [all] é”™è¯¯ 2
&lt;/code>&lt;/pre>&lt;p>å¤§è‡´æŸ¥äº†ä¸‹ï¼Œæ˜¯å› ä¸ºæ²¡æœ‰swapåŒºçš„åŸå› ï¼Œæ ¹æ®&lt;a href="http://stackoverflow.com/questions/18389612/make-exits-with-error-2-when-trying-to-install-gcc-4-8-1#">è¿™ç¯‡&lt;/a> å¾—åˆ°çš„è§£å†³åŠæ³•æ˜¯ï¼š&lt;/p>
&lt;pre>&lt;code>SWAP=/tmp/swap
dd if=/dev/zero of=$SWAP bs=1M count=500
mkswap $SWAP
sudo swapon $SWAP
&lt;/code>&lt;/pre>&lt;p>ä¹‹åå°±æ˜¯gcc çš„ç¼–è¯‘æ—¶é—´äº†ï¼Œ è¿™ä¸ªæ—¶é—´å¯ä»¥å»å†™å†™ä»£ç è¡¥ä¸ªç•ªå•¥çš„ã€‚è¿™å°æœºå™¨åªæ˜¯å¹³æ—¶æ‹¿æ¥ç©çš„ï¼Œé…ç½®ç‚’é¸¡ä½ã€‚ç¼–è¯‘gccä»17ï¼š20å¼€å§‹ï¼Œä¸€ç›´åˆ°20ï¼š09åœæ­¢ã€‚(æœŸé—´æˆ‘å»è¡¥ç•ªå•¦ 2333)&lt;/p>
&lt;pre>&lt;code># åªä¼šæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤
make
make install
# åˆ‡æ¢gccåˆ°æ–°ç‰ˆæœ¬
update-alternatives --install /usr/bin/gcc gcc /usr/local/bin/gcc-5.0.2 66
# æˆ‘é‡æ–°sshç™»å½•åæ‰çœ‹åˆ°æ›´æ–°ç”Ÿæ•ˆçš„
gcc --version
gcc (GCC) 5.2.0
Copyright Â© 2015 Free Software Foundation, Inc.
æœ¬ç¨‹åºæ˜¯è‡ªç”±è½¯ä»¶ï¼›è¯·å‚çœ‹æºä»£ç çš„ç‰ˆæƒå£°æ˜ã€‚æœ¬è½¯ä»¶æ²¡æœ‰ä»»ä½•æ‹…ä¿ï¼›
åŒ…æ‹¬æ²¡æœ‰é€‚é”€æ€§å’ŒæŸä¸€ä¸“ç”¨ç›®çš„ä¸‹çš„é€‚ç”¨æ€§æ‹…ä¿ã€‚
&lt;/code>&lt;/pre>&lt;h2 id="å‡çº§python">å‡çº§Python&lt;/h2>
&lt;p>CentOSä¸Šé»˜è®¤çš„Pythonå¯¹äºä¹‹åè¦å®‰è£…çš„sconsæ¥è¯´ï¼Œè¿˜æ˜¯ç‰ˆæœ¬å¤ªä½ã€‚å†æ¬¡ä¸Š&lt;a href="https://www.python.org">Python å®˜ç½‘&lt;/a> (å®˜ç½‘çœŸæ˜¯ä¸ªå¥½åœ°æ–¹2333)ä¸‹è½½Python2.7çš„&lt;a href="https://www.python.org/ftp/python/2.7.10/Python-2.7.10.tar.xz">æºç &lt;/a>
ç¼–è¯‘è¿‡å¾ˆå¤šæ¬¡äº†ï¼Œ å°±åªå†™ä¸»è¦çš„ä¸œè¥¿äº†&lt;/p>
&lt;pre>&lt;code>xz -d python-2.7.10.tar.xz
tar -xvf python-2.7.10.tar &amp;amp;&amp;amp; cd python-2.7.10
# å¯¹äºè¿™æ¬¡ç¼–è¯‘MongoDBæ¥è¯´ï¼Œä¸€å®šéœ€è¦å®‰è£…çš„æ˜¯bzip2ä¾èµ–
yum install -y bzip2-devel
# ç¼–è¯‘
./configure --prefix=/usr/local/python2.7
make
make install
# æ›´æ–°
update-alternatives --install /usr/bin/python python /usr/local/bin/python 69
&lt;/code>&lt;/pre>&lt;h2 id="å®‰è£…scons">å®‰è£…scons&lt;/h2>
&lt;p>åœ¨&lt;a href="http://www.scons.org/">å®˜ç½‘&lt;/a>ä¸Šæ‰¾åˆ°&lt;a href="http://iweb.dl.sourceforge.net/project/scons/scons/2.3.6/scons-2.3.6.tar.gz">æºç åŒ…&lt;/a>ç›´æ¥å®‰è£…&lt;/p>
&lt;pre>&lt;code># ä¾èµ–è§£å†³
yum install pcre-devel python-devel
# è§£å‹å®‰è£…
tar -zxvf scons-2.3.6.tar.gz &amp;amp;&amp;amp; cd scons-2.3.6
python setup.py install
&lt;/code>&lt;/pre>&lt;h2 id="ç¼–è¯‘å®‰è£…mongodb">ç¼–è¯‘å®‰è£…MongoDB&lt;/h2>
&lt;p>æœ€åçš„å®‰è£…è¿‡ç¨‹å°±ä¸æ˜¯è¿™ç¯‡é‡Œé¢çš„é‡ç‚¹äº†ï¼Œ é‡åˆ°çš„ä¸€ä¸ªå‘æ˜¯ï¼š&lt;/p>
&lt;pre>&lt;code>Initializer* _theGlobalInitializer = &amp;amp;getGlobalInitializer();
&lt;/code>&lt;/pre>&lt;p>æœ‰è¿™æ ·çš„æŠ¥é”™ä¿¡æ¯ã€‚ æŸ¥äº†ä¸€ä¸‹ï¼Œæ ¹æ®&lt;a href="https://jira.mongodb.org/browse/SERVER-19353">è¿™ç¯‡&lt;/a>åªè¦åœ¨æ„å»ºçš„æ—¶å€™ï¼ŒåŠ ä¸Š&lt;code>--disable-warnings-as-errors&lt;/code>å°±å¯ä»¥è§£å†³äº†&lt;/p>
&lt;pre>&lt;code>scons all --disable-warnings-as-errors
# å…¶ä»–çš„è®¾ç½®å¯ä»¥æŸ¥çœ‹sconsçš„ç›¸å…³æ–‡æ¡£
&lt;/code>&lt;/pre>&lt;p>æœ¬ç¯‡çš„é‡ç‚¹æ˜¯ç¼–è¯‘çš„è¿‡ç¨‹ï¼Œåç»­MongoDBé…ç½®éƒ¨åˆ†æŠ½ç©ºå†å†™ã€‚å…¨æ–‡å®Œã€‚&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/MongoDB/">MongoDB</category></item><item><title>é‡ç½®Ghoståšå®¢çš„å¯†ç </title><link>https://moelove.info/2015/07/21/%E9%87%8D%E7%BD%AEGhost%E5%8D%9A%E5%AE%A2%E7%9A%84%E5%AF%86%E7%A0%81/</link><guid isPermaLink="true">https://moelove.info/2015/07/21/%E9%87%8D%E7%BD%AEGhost%E5%8D%9A%E5%AE%A2%E7%9A%84%E5%AF%86%E7%A0%81/</guid><pubDate>Tue, 21 Jul 2015 23:11:04 +0000</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>åœ¨æ­å»ºGhoståšå®¢çš„æ—¶å€™ï¼Œå°šæœªé…ç½®mailæœåŠ¡å™¨æ—¶ï¼Œé‡ç½®å¯†ç çš„æ–¹æ³•åšä¸ªè®°å½•&lt;/p>
&lt;/blockquote>
&lt;h3 id="æ‰“å¼€æ•°æ®åº“æŸ¥çœ‹ç”¨æˆ·ä¿¡æ¯">æ‰“å¼€æ•°æ®åº“æŸ¥çœ‹ç”¨æˆ·ä¿¡æ¯&lt;/h3>
&lt;p>å¦‚æœå…¨éƒ¨é»˜è®¤è®¾ç½®ï¼Œä½¿ç”¨ç”Ÿäº§ç¯å¢ƒçš„è¯ï¼Œåº”è¯¥æ˜¯
&lt;code>sqlite3 content/data/ghost.db&lt;/code>&lt;/p>
&lt;p>å¦‚æœæ˜¯å¼€å‘ç¯å¢ƒåº”è¯¥æ˜¯
&lt;code>sqlite3 content/date/ghost-dev.db&lt;/code>&lt;/p>
&lt;p>æŸ¥çœ‹ç”¨æˆ·ä¿¡æ¯
&lt;code>sqlite&amp;gt;SELECT * FROM users;&lt;/code>&lt;/p>
&lt;h3 id="æ›´æ–°ç”¨æˆ·å¯†ç ">æ›´æ–°ç”¨æˆ·å¯†ç &lt;/h3>
&lt;ul>
&lt;li>
&lt;p>Ghostå¯¹ç”¨æˆ·å¯†ç ç”¨çš„æ˜¯BCryptåŠ å¯†ï¼Œå¯ä»¥ä½¿ç”¨&lt;a href="http://bcrypthashgenerator.apphb.com/">BCrypt Hash Generator&lt;/a>ä¹‹ç±»çš„å·¥å…·ç”Ÿæˆä¸€ä¸ªæƒ³è¦ä¿®æ”¹çš„å¯†ç ï¼Œä¾‹å¦‚&amp;quot;mypasswd&amp;quot;ç”Ÿæˆçš„å¯†ç æ˜¯
&lt;code>$2a$10$QecJeBdw2lONRTnHJ0RoVO6DczdJWf4h4QgaUcgKsYFZlzTe1yeEK&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å‡è®¾ä¹‹å‰æŸ¥çœ‹åˆ°çš„ç”¨æˆ·ä¿¡æ¯ï¼Œé‚®ç®±æ˜¯&lt;strong>&lt;a href="mailto:admin@domain.com">admin@domain.com&lt;/a>&lt;/strong> é‚£ä¹ˆï¼Œä½¿ç”¨è¿™æ ·æ›´æ–°å¯†ç &lt;/p>
&lt;pre>&lt;code> UPDATE users SET password=&amp;quot;$2a$10$QecJeBdw2lONRTnHJ0RoVO6DczdJWf4h4QgaUcgKsYFZlzTe1yeEK&amp;quot; WHERE email=&amp;quot;admin@domain.com&amp;quot;
&lt;/code>&lt;/pre>&lt;/li>
&lt;li>
&lt;p>é€€å‡ºsqlite3
&lt;code>.exit&lt;/code>&lt;/p>
&lt;/li>
&lt;/ul></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Blog/">Blog</category><category domain="https://moelove.info/tags/sqlite/">sqlite</category></item><item><title>3.17</title><link>https://moelove.info/2015/03/17/3.17/</link><guid isPermaLink="true">https://moelove.info/2015/03/17/3.17/</guid><pubDate>Tue, 17 Mar 2015 00:34:34 +0000</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;h2 id="8å°æ—¶å†…æ±‚ç”Ÿå­˜">8å°æ—¶å†…æ±‚ç”Ÿå­˜&lt;/h2>
&lt;h2 id="8å°æ—¶å¤–æ±‚å‘å±•">8å°æ—¶å¤–æ±‚å‘å±•&lt;/h2></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Life/">Life</category></item><item><title>è¿‘å†µ</title><link>https://moelove.info/2014/10/16/%E8%BF%91%E5%86%B5/</link><guid isPermaLink="true">https://moelove.info/2014/10/16/%E8%BF%91%E5%86%B5/</guid><pubDate>Thu, 16 Oct 2014 23:34:39 +0000</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>åšå®¢å¥½é•¿æ—¶é—´æ²¡æœ‰æ›´æ–°äº†ï¼Œä»Šå¤©æŠ½ç©ºå¤§è‡´æ¥è¯´ä¸€ä¸‹è¿‘å†µå§&lt;/p>
&lt;/blockquote>
&lt;h3 id="å·¥ä½œ">å·¥ä½œ&lt;/h3>
&lt;p>ç”¨è¿™ä¸ªæ ‡é¢˜çš„è¯ï¼Œå…¶å®æ„Ÿè§‰æƒ³å†™çš„ç¡®å®å¥½å¤šï¼Œä½†æ˜¯è¿˜æ˜¯æŒ‘ä¸€äº›æ¯”è¾ƒé‡è¦çš„æ¥è¯´å§ã€‚ç°åœ¨çš„å…¬å¸è¯´å®è¯è¿˜ç¡®å®æ²¡æœ‰è®©æˆ‘å¤±æœ›ï¼Œå·¥ä½ä¸Šé…çš„æ˜¯ä¸€ä¸ª 22å¯¸çš„ AOC æ˜¾ç¤ºå™¨å’Œä¸€ä¸ª24å¯¸çš„ Dell æ˜¾ç¤ºå™¨ï¼Œ ä¸»æœºå†…å­˜ 12G ï¼ˆæˆ‘æ¯å¤©è·‘ä¸ªLinuxæ˜¯æœ‰ç‚¹æµªè´¹ï¼‰åŠå…¬åŒºæ¯å¤©æœ‰ç‰©ä¸šå®šæ—¶æ‰“æ‰«ç¥é©¬çš„ï¼Œä¸‹åˆçš„æ—¶å€™æœ‰èŒ¶æ­‡ï¼ˆèŒ¶æ°´é—´è¿˜æœ‰ä¸€å †é›¶é£Ÿï¼‰ã€‚åŒäº‹ä»¬ç›¸å¤„æ„Ÿè§‰éƒ½å¾ˆä¸é”™,æ¯å¤©ä¸­åˆä¸€èµ·å‡ºå»åƒé¥­ï¼Œå„ç§èŠå¤©è°ƒä¾ƒç¥é©¬çš„ï¼Œåªæ˜¯ä¸€å¼€å§‹ä¸å¤ªäº†è§£é¡¹ç›®ä¸­çš„é…ç½®ç¥é©¬çš„ï¼Œè®©è€å¤§è´¹å¿ƒäº†...&lt;/p>
&lt;p>è¿™æ®µæ—¶é—´è¿˜æœ‰å¾ˆå¤šæœ‰è¶£çš„äº‹æƒ… æ¯”å¦‚ï¼š å»é‡‘æµ·æ¹¾åº¦å‡æ‘å›¢å»ºä¹‹ç±»çš„ã€‚ å†è¯´ä¸€ä¸‹æœ€è¿‘çš„æ„Ÿå—å§ã€‚&lt;/p>
&lt;p>å› ä¸ºå›½åº†å‰éœ€è¦ä¸Šçº¿ï¼Œæ‰€ä»¥æ”¾å‡å‰å°±æ¯å¤©éƒ½æ˜¯åœ¨å¿™ç€å¼€å‘ç¥é©¬çš„ã€‚ä¸è¿‡é‚£ä¸¤å‘¨ä¹Ÿæ˜¯è¿‘æœŸæ„Ÿè§‰æœ€çˆ½çš„æ—¶å€™ &lt;s>å†™ä»£ç é«˜æ½®ä¸æ–­&lt;/s> è€Œä¸”ä¹Ÿç¡®å®æ„Ÿè§‰å·¥ä½œæ˜¯è›®æœ‰æŒ‘æˆ˜æ€§çš„ï¼Œç¡®å®æ˜¯æˆ‘æƒ³è¦çš„å·¥ä½œ :-) ã€‚ ä¸è¿‡æˆ‘è¿˜è®°å¾—é‚£å‘¨ä¸€ï¼Œä¸€æ‰“å¼€é‚®ç®±çœ‹åˆ°ä¸­æœ‰7ä»½æœªè¯»çš„éœ€æ±‚é‚®ä»¶ï¼Œ ç¡®å®æ˜¯ç•¥æƒŠå“ã€‚
åœ¨å¼€å‘çš„é¡¹ç›®ï¼Œå› ä¸ºæ”¹å˜äº†è®¾è®¡æ€è·¯ï¼Œæ‰€ä»¥è¿™äº›å¤©ä¸»è¦éƒ½æ˜¯åœ¨å†™å‰ç«¯ã€‚åªä¸è¿‡ä¸€å¼€å§‹çš„æ—¶å€™æ„Ÿè§‰ç•¥è™å¿ƒå•Šï¼Œ å†™Pythonæ—¶é—´é•¿äº†å·²ç»æ˜¯ä¸ä¹ æƒ¯å…¶ä»–è¯­è¨€é‚£ç§ä¹¦å†™è§„èŒƒäº† &lt;s>ä¸€å †æ‹¬å·å†™çš„å¥½çƒ¦èº&lt;/s> ä½†æ˜¯ä»è¿™ä¸¤å¤©çš„æ„Ÿè§‰æ¥çœ‹ï¼Œå¾—æ„Ÿè°¢è€å¤§çš„è¿™ç§è®¾è®¡æ€è·¯ï¼Œè¿™æ®µæ—¶é—´å­¦åˆ°çš„ç¡®å®å¾ˆå¤šã€‚ ä»æ¡†æ¶åˆ°ä¸€äº›åº“ï¼Œä¸€äº›æ’ä»¶ï¼Œ è¿˜æœ‰ç¨‹åºä¸Šä¸€äº›æ¯”è¾ƒå·§å¦™çš„ç”¨æ³• &lt;s>æ­£åœ¨åŠªåŠ›æ¶ˆåŒ–ä¸­&lt;/s>&lt;/p>
&lt;h3 id="ç”Ÿæ´»">ç”Ÿæ´»&lt;/h3>
&lt;p>&lt;s>æœ‰ç‚¹åæ‚”åŠ ä¸Šæ ‡é¢˜äº†&lt;/s> å…¶å®ä¸»è¦è¦è¯´çš„åº”è¯¥éƒ½æ”¾åœ¨è¿™é‡Œå§ã€‚
ä»æ¬å®¶ååŸºæœ¬ä¸Šæ¯å¤©ç”Ÿæ´»éƒ½å¾ˆè§„å¾‹ï¼Œç›®å‰å·®ä¸å¤šé€‚åº”äº†ã€‚&lt;s>(æ‰¾å·¥ä½œå’Œé¢è¯•ç¥é©¬çš„æˆ‘å†™åˆ°ç¢ç¢å¿µé‡Œé¢äº†ï¼Œå…·ä½“çš„ç­‰åŠå¹´æˆ–è€…ä¸€å¹´åå½“å›å¿†å½•æ¥å†™ 233)&lt;/s>å€¼å¾—åæ§½çš„å°±æ˜¯ç”µä¿¡çš„å®¢æœï¼Œç”¨çš„æ˜¯ç”µä¿¡çš„ç½‘ï¼Œå‰å‡ å¤©æ¢äº†è·¯ç”±å™¨å¿˜è®°äº†å¯†ç ï¼Œæ‰“å®¢æœé‡ç½®å¯†ç ï¼Œä½†æ˜¯ä¸€ç›´è¿æ¥ä¸æˆåŠŸï¼ˆ691é”™è¯¯ï¼Œæ˜æ˜¾å°±æ˜¯å¸å·å¯†ç çš„é—®é¢˜å˜›ï¼‰ç»“æœæœ¬æ¥æƒ³åˆ°äº†å‘¨æœ«æ”¾å‡çš„æ—¶å€™å†å¥½å¥½å¤„ç†ï¼Œç»“æœåˆ°äº†å‘¨æœ«æ‰“ç”µè¯å´ä¸€ç›´æ²¡æœ‰å®¢æœå•Š&lt;s>ç”¨è”é€šå·æ‰“ç”µä¿¡çš„å®¢æœæˆ‘ä¹Ÿæ˜¯é†‰äº†&lt;/s> æœ€ååˆ°äº†å‘¨ä¸€æ‰è®©å®¢æœåˆé‡ç½®æ‰æˆåŠŸã€‚&lt;/p>
&lt;p>å…¶å®é‚£ä¹Ÿæ˜¯å¯¼è‡´æˆ‘è¿™ä¹ˆä¹…æ²¡æœ‰æ›´æ–°åšå®¢çš„åŸå› orz ã€‚&lt;/p>
&lt;ul>
&lt;li>ä¸€ä¸ªåŸå› æ˜¯å› ä¸ºç”µè„‘é‡è£…äº†ç³»ç»Ÿï¼Œç¯å¢ƒå•¥çš„ä¸€ç›´æ²¡æœ‰é…ç½®&lt;/li>
&lt;li>å¦ä¸€ä¸ªå°±æ˜¯å› ä¸ºç½‘ç»œå‘çˆ¹ï¼Œå®åœ¨æœ‰å¿ƒæ— åŠ›&lt;/li>
&lt;/ul>
&lt;p>å†è€…å°±æ˜¯å¸éƒ½çš„å¤©æ°”è®©äººç¡®å®æœ‰ç‚¹æ— å¥ˆï¼Œæœ‰å¤©æ—©ä¸Šåˆšä¸‹æ¥¼ï¼Œæˆ‘è¿˜ä»¥ä¸ºæˆ‘è¦è¿ˆæ­¥è¿›å…¥å¯‚é™å²­äº† TAT ï¼Œæ„Ÿè§‰èƒ½å¹¸å­˜ä¸‹æ¥ç¡®å®æ˜¯å¾ˆä¸å®¹æ˜“å•Šã€‚&lt;/p>
&lt;p>æœ€åè¯´ä¸€ä¸‹æœ€è¿‘åœ¨ç½‘ç»œå¼„å¥½ä¹‹åï¼ŒæŒ–äº†ä¸€ä¸ªå‘ã€‚æ‰“ç®—ç‹¬ç«‹å¼€å‘ä¸€ä¸ªç½‘ç«™çš„è¯´ï¼Œ é‡å¤é€ è½®å­çš„åŸå› å’Œå¤§å¤šæ•°äººæ˜¯ä¸€æ ·çš„ ï¼Œç°æœ‰çš„ä¸œè¥¿æ²¡æœ‰æˆ‘æƒ³è¦çš„ &lt;s>&lt;B>æ­£å¥½æŠŠæœ€è¿‘å­¦åˆ°çš„ä¸œè¥¿éƒ½æ‹¿æ¥ç»ƒç»ƒæ‰‹&lt;/B>&lt;/s>&lt;/p>
&lt;h2 id="b-try-my-best--b">&lt;B> Try My Best ! &lt;/B>&lt;/h2></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Life/">Life</category></item><item><title>æ­£åˆ™åŒ¹é…ä¸­æ–‡åŠå­—ç¬¦ç¼–ç é—®é¢˜</title><link>https://moelove.info/2014/07/22/%E6%AD%A3%E5%88%99%E5%8C%B9%E9%85%8D%E4%B8%AD%E6%96%87%E5%8F%8A%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81%E9%97%AE%E9%A2%98/</link><guid isPermaLink="true">https://moelove.info/2014/07/22/%E6%AD%A3%E5%88%99%E5%8C%B9%E9%85%8D%E4%B8%AD%E6%96%87%E5%8F%8A%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81%E9%97%AE%E9%A2%98/</guid><pubDate>Tue, 22 Jul 2014 21:16:34 +0000</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;h2 id="åŒ¹é…ä¸­æ–‡çš„æ­£åˆ™è¡¨è¾¾å¼">åŒ¹é…ä¸­æ–‡çš„æ­£åˆ™è¡¨è¾¾å¼&lt;/h2>
&lt;p>çªå†™äº†ä¸€å°æ®µ&lt;a href="http://moelove.qiniudn.com/regex-match-Chinese.py">ä»£ç &lt;/a>ï¼ˆè™½ç„¶å†™çš„ä¸å¤ªå¥½ï¼Œä½†æ˜¯åŸºæœ¬å¯ä»¥è¡¨è¾¾æ„æ€ï¼‰&lt;/p>
&lt;!--&lt;script src="https://gist.github.com/tao12345666333/13edb463b04da758dade.js">&lt;/script>-->
&lt;pre>&lt;code>import re
nickname = raw_input('Please input your nickname &amp;gt; ')
if not re.search(u'^[\u4e00-\u9fa5a-zA-Z0-9]+$', unicode(nickname,'utf8')):
print 'Your nickname format is error, please try again !'
else:
print 'Hello %s'% nickname
&lt;/code>&lt;/pre>&lt;p>å¦‚ä½ æ‰€è§ï¼Œä¸Šé¢ç¬¬5è¡Œçš„ä»£ç ï¼Œå°±æ˜¯åŒ¹é…ä¸­æ–‡å’Œå­—æ¯ï¼Œæ•°å­—çš„æ­£åˆ™è¡¨è¾¾å¼äº†ã€‚é‡Œé¢çš„&lt;code>\u4e00-\u9fa5&lt;/code> å°±æ˜¯ä¸­æ–‡æ±‰å­—çš„&lt;code>unicode&lt;/code>ç¼–ç æ‰€åœ¨ä½ç½®ã€‚&lt;/p>
&lt;p>&lt;img src="http://moelove.qiniudn.com/2014-07-23%2023:21.png" alt="è¿è¡Œæˆªå›¾">&lt;/p>
&lt;hr>
&lt;h2 id="pythonå­—ç¬¦ä¸²çš„ç¼–ç é—®é¢˜">Pythonå­—ç¬¦ä¸²çš„ç¼–ç é—®é¢˜&lt;/h2>
&lt;p>è¿˜æ˜¯ä»¥ä¸Šé¢é‚£æ®µä»£ç æ¥è¯´ã€‚æ³¨æ„çœ‹ç¬¬5è¡Œçš„ä»£ç &lt;/p>
&lt;pre>&lt;code>if not re.search(u'^[\u4e00-\u9fa5a-zA-Z0-9]+$', unicode(nickname,'utf8')):
&lt;/code>&lt;/pre>&lt;p>å…¶å®è¿™æ ·çš„ä»£ç å¹¶ä¸ä¸¥è°¨ã€‚å› ä¸ºåœ¨Python ä¸­é»˜è®¤æ˜¯ç”¨&lt;code>unicode&lt;/code>ç¼–ç æ¥å¤„ç†å­—ç¬¦ä¸²çš„ï¼Œå› æ­¤åšç¼–ç è½¬æ¢çš„æ—¶å€™ï¼Œä¸€èˆ¬è¦ä»¥&lt;code>unicode&lt;/code>ä½œä¸ºä¸­é—´ç¼–ç ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼š
å…¶ä»–ç¼–ç æ ¼å¼çš„å­—ç¬¦ä¸²---&amp;gt;è§£ç (decode)---&amp;gt;&lt;code>unicode&lt;/code>---&amp;gt;ç¼–ç (encode)---&amp;gt;æ‰€éœ€è¦çš„ç¼–ç æ ¼å¼ã€‚&lt;/p>
&lt;p>å› æ­¤ï¼Œå¤„ç†å­—ç¬¦ä¸²ç¼–ç çš„é—®é¢˜çš„æ—¶å€™ï¼Œå…ˆè¦æ˜ç™½éœ€è¦è½¬æ¢çš„å­—ç¬¦ä¸²çš„ç¼–ç æ ¼å¼æ˜¯ä»€ä¹ˆã€‚&lt;/p>
&lt;h3 id="ä»£ç ä¸­å­—ç¬¦ä¸²çš„é»˜è®¤ç¼–ç æ ¼å¼ä¸ä»£ç æ–‡ä»¶æœ¬èº«çš„ç¼–ç æ ¼å¼æ˜¯ä¸€æ ·çš„">ä»£ç ä¸­å­—ç¬¦ä¸²çš„é»˜è®¤ç¼–ç æ ¼å¼ä¸ä»£ç æ–‡ä»¶æœ¬èº«çš„ç¼–ç æ ¼å¼æ˜¯ä¸€æ ·çš„&lt;/h3>
&lt;p>æ¯”å¦‚ï¼š s = 'æ¶›' åœ¨utf8çš„æ–‡ä»¶ä¸­ï¼Œé‚£ä¹ˆså°±æ˜¯utf8ç¼–ç çš„ï¼Œä½†æ˜¯å¦‚æœæ–‡ä»¶æ˜¯gb2312ç¼–ç ï¼Œé‚£ä¹ˆså°±æ˜¯gb2312ç¼–ç çš„ã€‚æ­¤æ—¶ï¼Œå¦‚æœæƒ³è¦å¤„ç†sè¿™ä¸ªå­—ç¬¦ä¸²å°±è¦å…ˆdecodeæˆunicodeç¼–ç äº†ã€‚&lt;/p>
&lt;p>ä¸è¿‡å¦‚æœæ˜¯é…±ç´« s = u'æ¶›'ï¼Œé‚£ä¹ˆså°±æ˜¯unicodeç¼–ç äº†ï¼Œè¿™ä¸ªæ—¶å€™sçš„ç¼–ç æ–¹å¼ä¸ä¼šè¢«æ–‡ä»¶çš„ç¼–ç æ‰€å½±å“ã€‚&lt;/p>
&lt;h3 id="å¦‚æœä¸€ä¸ªå­—ç¬¦ä¸²å·²ç»æ˜¯unicodeç¼–ç äº†å†è§£ç å°±ä¼šå‡ºé”™">å¦‚æœä¸€ä¸ªå­—ç¬¦ä¸²å·²ç»æ˜¯unicodeç¼–ç äº†ï¼Œå†è§£ç å°±ä¼šå‡ºé”™&lt;/h3>
&lt;p>å› æ­¤ä¸¥è°¨çš„æ–¹å¼å°±æ˜¯å…ˆå¯¹å­—ç¬¦ä¸²è¿›è¡Œç¼–ç æ ¼å¼çš„åˆ¤åˆ«ï¼Œæœ€ç®€å•çš„åŠæ³•å°±æ˜¯ä½¿ç”¨Python é»˜è®¤æä¾›çš„&lt;code>isinstance()&lt;/code> æ–¹æ³•.&lt;/p>
&lt;p>ä»£ç å¯ä»¥è¿™æ ·å†™
&lt;code>isinstance(s, unicode)&lt;/code> å¦‚æœä¸æ˜¯unicodeç¼–ç å°±ä¼šæŠ¥é”™ã€‚&lt;/p>
&lt;p>çªä»Šå¤©åœ¨å¤„ç†ç”¨æˆ·æ˜µç§°çš„åœ°æ–¹ï¼Œå¿˜è®°å­—ç¬¦ä¸²ä¼šç›´æ¥ä½¿ç”¨æ–‡ä»¶çš„ç¼–ç äº†ï¼Œæ‰€ä»¥å¯¹å®ƒè¿›è¡Œäº†é‡æ–°ç¼–ç orzæœæ–­å°±æŠ¥é”™äº†ã€‚ã€‚ã€‚ä»¥åè¿˜æ˜¯è¦å¥½å¥½æ³¨æ„ç»†èŠ‚çš„è¯´ã€‚&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Regex/">Regex</category></item><item><title>Bash æ˜¾ç¤º Git åˆ†æ”¯</title><link>https://moelove.info/2014/07/17/Bash-%E6%98%BE%E7%A4%BA-Git-%E5%88%86%E6%94%AF/</link><guid isPermaLink="true">https://moelove.info/2014/07/17/Bash-%E6%98%BE%E7%A4%BA-Git-%E5%88%86%E6%94%AF/</guid><pubDate>Thu, 17 Jul 2014 21:54:33 +0000</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;h3 id="è™½ç„¶ä¸€ç›´éƒ½åœ¨ç”¨gitä½†æ˜¯å¹¶æ²¡æœ‰æ³¨æ„åˆ°è¿˜æœ‰è¿™ä¸ªæ–¹ä¾¿çš„ç”¨æ³•">è™½ç„¶ä¸€ç›´éƒ½åœ¨ç”¨gitï¼Œä½†æ˜¯å¹¶æ²¡æœ‰æ³¨æ„åˆ°è¿˜æœ‰è¿™ä¸ªæ–¹ä¾¿çš„ç”¨æ³•&lt;/h3>
&lt;p>äºæ˜¯ä¹èµ¶å¿«å­¦ä¹ ä¸€ä¸‹ ï¼š-ï¼‰&lt;/p>
&lt;p>ä¸Šç½‘æŸ¥äº†ä¸€ä¸‹èµ„æ–™ï¼Œéƒ½è¯´Ubuntuä¸‹å¦‚ä½•å¦‚ä½•æ–¹ä¾¿ï¼Œå…¶ä»–çš„å‘è¡Œç‰ˆéœ€è¦å…ˆä¸‹è½½ä¸€ä¸ªæ–‡ä»¶ï¼Œç„¶åæ·»åŠ sourceï¼Œå†å¦‚ä½•å¦‚ä½•ã€‚ã€‚&lt;/p>
&lt;p>å…¶å®æŸ¥å†å¤šéƒ½ä¸å¦‚å®è·µã€‚ä»¥ä¸‹æ˜¯çªç»è¿‡æŸ¥èµ„æ–™åŠ ä¸Šå¯¹ä¸ªäººbashçš„é…è‰²åå†™å‡ºçš„é…ç½®æ–‡ä»¶ï¼ŒåŠ å…¥åˆ° &lt;code>~/.bashrc&lt;/code> ä¸­å³å¯ï¼ˆå¯¹å„ä¸ªå‘è¡Œç‰ˆé€šç”¨çš„ï¼‰&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="k">function&lt;/span> git_branch &lt;span class="o">{&lt;/span>
&lt;span class="nv">ref&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="k">$(&lt;/span>git symbolic-ref HEAD 2&amp;gt; /dev/null&lt;span class="k">)&lt;/span> &lt;span class="o">||&lt;/span> &lt;span class="k">return&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;(&amp;#34;&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">ref&lt;/span>&lt;span class="p">#refs/heads/&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">&amp;#34;) &amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="o">}&lt;/span>
&lt;span class="nv">PS1&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;[\[\e[1;35m\]\u\[\e[1;32m\]\w\[\e[0m\]] \[\e[0m\]\[\e[1;36m\]\$(git_branch)\[\e[0;33m\]\$&amp;#34;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>æˆ–è€…&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">
&lt;span class="k">function&lt;/span> git-branch-name &lt;span class="o">{&lt;/span>
git symbolic-ref HEAD 2&amp;gt;/dev/null &lt;span class="p">|&lt;/span> cut -d&lt;span class="s2">&amp;#34;/&amp;#34;&lt;/span> -f &lt;span class="m">3&lt;/span>
&lt;span class="c1">#git rev-parse --abbrev-ref HEAD&lt;/span>
&lt;span class="o">}&lt;/span>
&lt;span class="k">function&lt;/span> git-branch-prompt &lt;span class="o">{&lt;/span>
&lt;span class="nb">local&lt;/span> &lt;span class="nv">branch&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="sb">`&lt;/span>git-branch-name&lt;span class="sb">`&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="o">[&lt;/span> &lt;span class="nv">$branch&lt;/span> &lt;span class="o">]&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="k">then&lt;/span> &lt;span class="nb">printf&lt;/span> &lt;span class="s2">&amp;#34; [%s]&amp;#34;&lt;/span> &lt;span class="nv">$branch&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="k">fi&lt;/span>
&lt;span class="o">}&lt;/span>
&lt;span class="nv">PS1&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;\u@\h \[\033[0;36m\]\W\[\033[0m\]\[\033[0;32m\]\$(git-branch-prompt)\[\033[0m\] \$ &amp;#34;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;!--&lt;script src="https://gist.github.com/tao12345666333/4a81478aa5db7c30e94e.js">&lt;/script>-->
&lt;p>æŒ‰ç…§æƒ¯ä¾‹ï¼Œä¸Šä¸€å¼ å›¾
&lt;img src="http://moelove.qiniudn.com/bashrc2014-07%2022:57:55.png" alt="å±å¹•æˆªå›¾">&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Git/">Git</category></item><item><title>Grub2 rescue ä¿®å¤</title><link>https://moelove.info/2014/07/02/Grub2-rescue-%E4%BF%AE%E5%A4%8D/</link><guid isPermaLink="true">https://moelove.info/2014/07/02/Grub2-rescue-%E4%BF%AE%E5%A4%8D/</guid><pubDate>Wed, 02 Jul 2014 21:53:03 +0000</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;p>æ˜¨å¤©ä¸‹åˆçš„æ—¶å€™æƒ³è¦æŠŠåˆ†åŒºå¤„ç†ä¸€ä¸‹ï¼Œçªç„¶å‘ç°ç¡¬ç›˜é‡Œé¢æœ‰ä¸€ä¸ªæœªä½¿ç”¨çš„102Mçš„åˆ†åŒº,å¾ˆæœæ–­çš„æŠŠè¿™äº›ä¹±ä¸ƒå…«ç³Ÿçš„åˆ†åŒºéƒ½ç»™å¹²æ‰äº†ã€‚ç»“æœå‘¢ï¼Œå†æ¬¡å¼€æœºçš„æ—¶å€™å°±å‘äº†ï¼ˆè™½ç„¶é…±ç´«çš„äº‹æƒ…å¹²è¿‡å¾ˆå¤šæ¬¡äº†ï¼Œè¿™æ¬¡åšä¸ªè®°å½•å§ï¼‰å¼€æœºæ—¶æç¤ºå¦‚ä¸‹ï¼š&lt;/p>
&lt;pre>&lt;code>GRUB loading..
error: unknown filesystem.
Entering rescue mode....
grub rescue&amp;gt;
&lt;/code>&lt;/pre>&lt;h3 id="grub-rescue-æ”¯æŒçš„å‘½ä»¤">grub rescue æ”¯æŒçš„å‘½ä»¤&lt;/h3>
&lt;ul>
&lt;li>&lt;strong>ls&lt;/strong> æŸ¥çœ‹ç¡¬ç›˜çš„åˆ†åŒºæƒ…å†µï¼Œå¦‚æœä½ å·²çŸ¥è‡ªå·±çš„grubçš„å®‰è£…ä½ç½®ï¼ˆæ¯”å¦‚æˆ‘çš„åœ¨&lt;code>(hd0,msdos9)/boot/grub2&lt;/code>ï¼‰ï¼Œé‚£ä¹ˆå°±ç›´æ¥è¿›è¡Œä¸‹ä¸€æ­¥ã€‚
å¦‚æœä¸çŸ¥é“ï¼Œé‚£å°±lsæ¯ä¸ªåˆ†åŒºï¼Œæ¯”å¦‚: &lt;code>ls (hd0,msdos2)/&lt;/code>,å¦‚æœæ­£ç¡®å°±ä¼šæ˜¾ç¤ºé‡Œé¢åˆ°å†…å®¹ï¼Œç›´åˆ°æ‰¾åˆ°grub&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>è¿™é‡Œä¸€ä¸ªå¾ˆå…³é”®çš„åœ°æ–¹å°±æ˜¯åœ¨ç¡¬ç›˜ä½ç½®ååº”è¯¥åŠ å…¥&lt;code>/&lt;/code>&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>&lt;strong>set&lt;/strong> ç›´æ¥è¾“å…¥çš„è¯ï¼Œ å¯ä»¥çœ‹åˆ°root å’Œ prefix çš„è®¾ç½®ã€‚è¿™é‡Œéœ€è¦æŠŠè¿™ä¸¤ä¸ªé€‰é¡¹æ”¹æˆæˆ‘ä»¬å·²ç»æ‰¾åˆ°çš„ä½ç½®ã€‚&lt;/li>
&lt;/ul>
&lt;p>çªçš„è®¾ç½®å¦‚ä¸‹&lt;/p>
&lt;pre>&lt;code>grub rescue&amp;gt; set
grub rescue&amp;gt; prefix=(hd0,msdos9)/boot/grub2
grub rescue&amp;gt; root=hd0,msdos9
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>&lt;strong>insmod&lt;/strong> è½½å…¥æ¨¡å—ã€‚è¿™é‡ŒåŒºåˆ«æ˜¯çªè¿™æ¬¡è®°å½•çš„å…³é”®ã€‚
grub2å’Œgrubçš„ä¸€ä¸ªå¾ˆé‡è¦çš„åŒºåˆ«å°±æ˜¯æ¨¡å—çš„ä½ç½®ã€‚grub2çš„æ¨¡å—ä½ç½®åœ¨&lt;code>/boot/grub2/i386-pc/normal.mod&lt;/code>
æ‰§è¡Œå‘½ä»¤ï¼š&lt;/li>
&lt;/ul>
&lt;pre>&lt;code>grub rescue&amp;gt;insmod (hd0,msdos9)/boot/grub2/i386-pc/normal.mod
&lt;/code>&lt;/pre>&lt;p>æ‰§è¡ŒæˆåŠŸä¹‹åï¼Œæç¤ºç¬¦ä¼šå˜æˆ&lt;code>normal&lt;/code>&lt;/p>
&lt;ul>
&lt;li>&lt;strong>normal&lt;/strong> è¿›å…¥æ­£å¸¸æ¨¡å¼ï¼Œç›´æ¥è¾“å…¥å‘½ä»¤å³å¯&lt;/li>
&lt;/ul>
&lt;pre>&lt;code>grub rescue&amp;gt;normal
&lt;/code>&lt;/pre>&lt;p>è¿™ä¸ªæ—¶å€™ï¼Œå°±å¯ä»¥çœ‹åˆ°ç†Ÿæ‚‰çš„å¼•å¯¼ç•Œé¢äº†ã€‚&lt;/p>
&lt;ul>
&lt;li>&lt;strong>grub2-install&lt;/strong>
è¿›å…¥ç³»ç»Ÿåæ‰§è¡Œå‘½ä»¤&lt;/li>
&lt;/ul>
&lt;pre>&lt;code>$ sudo update-grub
$ sudo grub2-install /dev/sda
&lt;/code>&lt;/pre>&lt;p>å¦‚æœä¸æ‰§è¡Œè¿™æ ·çš„å‘½ä»¤çš„è¯ï¼Œé‡å¯ä¹‹åè¿˜ä¼šå›åˆ°ä¹‹å‰çš„ç•Œé¢orz&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/grub2/">grub2</category></item><item><title>Linuxä¸­Sublimeä¸­æ–‡è¾“å…¥</title><link>https://moelove.info/2014/06/19/Linux%E4%B8%ADSublime%E4%B8%AD%E6%96%87%E8%BE%93%E5%85%A5/</link><guid isPermaLink="true">https://moelove.info/2014/06/19/Linux%E4%B8%ADSublime%E4%B8%AD%E6%96%87%E8%BE%93%E5%85%A5/</guid><pubDate>Thu, 19 Jun 2014 23:17:31 +0000</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>è¿™ç¯‡åªæ˜¯ä¸ºäº†å¤‡å¿˜æ‰€ä»¥æŠŠä»¥å‰å†™çš„ä¸œè¥¿æ¬è¿™è¾¹äº† -.-&lt;/p>
&lt;/blockquote>
&lt;h5 id="ä»£ç æºäºç½‘ç»œæ„Ÿè°¢åˆ†äº«">ä»£ç æºäºç½‘ç»œï¼Œæ„Ÿè°¢åˆ†äº«&lt;/h5>
&lt;!-- more -->
&lt;p>è¿™é‡Œçš„å…³é”®å°±æ˜¯ä»¥ä¸‹çš„ä»£ç å’Œç¼–è¯‘&lt;/p>
&lt;!-- more -->
&lt;pre>&lt;code>/*
sublime-imfix.c
Use LD_PRELOAD to interpose some function to fix sublime input method support for linux.
By Cjacker Huang &amp;lt;jianzhong.huang at i-soft.com.cn&amp;gt;
gcc -shared -o libsublime-imfix.so sublime_imfix.c `pkg-config --libs --cflags gtk+-2.0` -fPIC
LD_PRELOAD=./libsublime-imfix.so sublime_text
*/
#include &amp;lt;gtk/gtk.h&amp;gt;
#include &amp;lt;gdk/gdkx.h&amp;gt;
typedef GdkSegment GdkRegionBox;
struct _GdkRegion
{
long size;
long numRects;
GdkRegionBox *rects;
GdkRegionBox extents;
};
GtkIMContext *local_context;
void
gdk_region_get_clipbox (const GdkRegion *region,
GdkRectangle *rectangle)
{
g_return_if_fail (region != NULL);
g_return_if_fail (rectangle != NULL);
rectangle-&amp;gt;x = region-&amp;gt;extents.x1;
rectangle-&amp;gt;y = region-&amp;gt;extents.y1;
rectangle-&amp;gt;width = region-&amp;gt;extents.x2 - region-&amp;gt;extents.x1;
rectangle-&amp;gt;height = region-&amp;gt;extents.y2 - region-&amp;gt;extents.y1;
GdkRectangle rect;
rect.x = rectangle-&amp;gt;x;
rect.y = rectangle-&amp;gt;y;
rect.width = 0;
rect.height = rectangle-&amp;gt;height;
//The caret width is 2;
//Maybe sometimes we will make a mistake, but for most of the time, it should be the caret.
if(rectangle-&amp;gt;width == 2 &amp;amp;&amp;amp; GTK_IS_IM_CONTEXT(local_context)) {
gtk_im_context_set_cursor_location(local_context, rectangle);
}
}
//this is needed, for example, if you input something in file dialog and return back the edit area
//context will lost, so here we set it again.
static GdkFilterReturn event_filter (GdkXEvent *xevent, GdkEvent *event, gpointer im_context)
{
XEvent *xev = (XEvent *)xevent;
if(xev-&amp;gt;type == KeyRelease &amp;amp;&amp;amp; GTK_IS_IM_CONTEXT(im_context)) {
GdkWindow * win = g_object_get_data(G_OBJECT(im_context),&amp;quot;window&amp;quot;);
if(GDK_IS_WINDOW(win))
gtk_im_context_set_client_window(im_context, win);
}
return GDK_FILTER_CONTINUE;
}
void gtk_im_context_set_client_window (GtkIMContext *context,
GdkWindow *window)
{
GtkIMContextClass *klass;
g_return_if_fail (GTK_IS_IM_CONTEXT (context));
klass = GTK_IM_CONTEXT_GET_CLASS (context);
if (klass-&amp;gt;set_client_window)
klass-&amp;gt;set_client_window (context, window);
if(!GDK_IS_WINDOW (window))
return;
g_object_set_data(G_OBJECT(context),&amp;quot;window&amp;quot;,window);
int width = gdk_window_get_width(window);
int height = gdk_window_get_height(window);
if(width != 0 &amp;amp;&amp;amp; height !=0) {
gtk_im_context_focus_in(context);
local_context = context;
}
gdk_window_add_filter (window, event_filter, context);
}
&lt;/code>&lt;/pre>&lt;p>è¿™æ®µä»£ç æ˜¯è¦å†™å…¥ sublime_imfix.cä¸­çš„ï¼Œ&lt;/p>
&lt;pre>&lt;code>cd /opt/sublime_text
sudo touch sublime_imfix.c
sudo vi sublime_imfix.c
#ä»¥ä¸‹è¦å®‰è£…çš„æ˜¯å¿…é¡»çš„ï¼Œå¦åˆ™ç¼–è¯‘ä¼šæŠ¥é”™çš„
sudo apt-get install build-essential libgtk2.0-dev
sudo gcc -shared -o libsublime-imfix.so sublime_imfix.c `pkg-config --libs --cflags gtk+-2.0` -fPIC
&lt;/code>&lt;/pre></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Sublime-Text/">Sublime Text</category></item><item><title>upyun-for-pelican</title><link>https://moelove.info/2014/05/16/upyun-for-pelican/</link><guid isPermaLink="true">https://moelove.info/2014/05/16/upyun-for-pelican/</guid><pubDate>Fri, 16 May 2014 21:51:41 +0000</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;p>è¿™å‡ å¤©å†™äº†ä¸€ä¸ªæ’ä»¶ï¼Œæ–¹ä¾¿æŠŠpelicanç”Ÿæˆé™æ€åšå®¢éƒ¨ç½²åˆ°åˆæ‹äº‘ä¸Šã€‚
æ•´ä½“æ€è·¯å°±æ˜¯ï¼š&lt;/p>
&lt;ul>
&lt;li>å…ˆæ ¼å¼åŒ–è·¯å¾„ï¼Œä»¥/ä¸ºæ ¹ç›®å½•&lt;/li>
&lt;/ul>
&lt;pre>&lt;code> def formatPath(path):
path = path.replace(os.sep, '/')
return path
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>å®šä¹‰ä¸¤ä¸ªåˆ—è¡¨æ¥å­˜å‚¨æ–‡ä»¶å’Œç›®å½•&lt;/li>
&lt;/ul>
&lt;p>ä¹‹åå°±æ˜¯éªŒè¯ç”¨æˆ·ï¼Œä»¥åŠbucketname ä¹‹ç±»çš„äº†ã€‚&lt;/p>
&lt;h3 id="ç®€ä»‹">ç®€ä»‹&lt;/h3>
&lt;p>&lt;a href="https://github.com/getpelican/pelican">pelican&lt;/a> æ˜¯ä¸€æ¬¾åŸºäºpythonçš„é™æ€åšå®¢ç”Ÿæˆå·¥å…·ï¼Œæœ¬ç¨‹åºå¯ä»¥æ–¹ä¾¿çš„æŠŠç”Ÿæˆçš„é™æ€åšå®¢éƒ¨ç½²åˆ°&lt;a href="https://www.upyun.com/index.html">åˆæ‹äº‘&lt;/a>ä¸Šã€‚æ¼”ç¤ºåœ°å€ï¼š&lt;a href="http://pelican-for-upyun.b0.upaiyun.com/">upyun-for-pelican &lt;/a>&lt;/p>
&lt;h3 id="ç”Ÿæˆç½‘ç«™">ç”Ÿæˆç½‘ç«™&lt;/h3>
&lt;pre>&lt;code> make html
make serve (è¿›è¡Œæœ¬åœ°é¢„è§ˆ)
&lt;/code>&lt;/pre>&lt;h3 id="è¯´æ˜">è¯´æ˜&lt;/h3>
&lt;ul>
&lt;li>ç¨‹åºä½¿ç”¨äº†åˆæ‹äº‘çš„&lt;a href="https://github.com/upyun/python-sdk">å®˜æ–¹SDK&lt;/a> éœ€è¦å…ˆå®‰è£… upyun&lt;/li>
&lt;/ul>
&lt;pre>&lt;code>pip install upyun
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>å¯ä»¥è‡ªå®šä¹‰è¦ä¸Šä¼ çš„æ–‡ä»¶ç›®å½•ã€‚åœ¨æœ€ä¸‹æ–¹çš„&lt;code>local_dir&lt;/code> ä¸­æŒ‡å®šå³å¯ã€‚Pelicané»˜è®¤çš„ä¸Šä¼ ç›®å½•æ˜¯ output ç›®å½•&lt;/li>
&lt;/ul>
&lt;h3 id="ä½¿ç”¨">ä½¿ç”¨&lt;/h3>
&lt;ol>
&lt;li>
&lt;p>å¯ä»¥åœ¨ &lt;strong>pelicanconf.py&lt;/strong> æ–‡ä»¶ä¸­ç›´æ¥è®¾ç½® &lt;code>BUCKETNAME, USERNAME, PASSWORD&lt;/code> å‚æ•°ï¼ˆè¿™äº›å‚æ•°çš„ä½¿ç”¨å¤§å†™å‘½åæ ¼å¼ä¹Ÿæ˜¯ä¸ºäº†ç¬¦åˆ&lt;em>pelicanconf.py&lt;/em>ä¸­çš„ä¹ æƒ¯ï¼‰ï¼Œä¹Ÿå¯ä»¥ç›´æ¥åœ¨ &lt;code>upyun-for-pelican.py&lt;/code>æ–‡ä»¶çš„æœ€ä¸‹æ–¹ç›´æ¥è®¾ç½®ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æ‰§è¡Œ&lt;/p>
&lt;pre>&lt;code>python upyun-for-pelican.py
&lt;/code>&lt;/pre>&lt;/li>
&lt;li>
&lt;p>ç¨‹åºåœ¨ &lt;code>Python 2.7&lt;/code> ç¯å¢ƒä¸‹æµ‹è¯•é€šè¿‡ã€‚&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h4 id="å…¶ä»–è¯´æ˜">å…¶ä»–è¯´æ˜&lt;/h4>
&lt;ul>
&lt;li>ç¨‹åºæ‰§è¡Œå¼€å§‹ä¼šæœ‰ä¸Šä¼ ç¡®è®¤æç¤ºï¼Œè¾“å…¥&lt;code>Y / y&lt;/code> éƒ½å¯ä»¥ç»§ç»­ä¸Šä¼ ã€‚&lt;/li>
&lt;li>å¯ä»¥ä½¿ç”¨é¡¹ç›®ä¸­çš„&lt;code>pelicanconf.py&lt;/code>ä½œä¸ºä¸ªäººç«™ç‚¹çš„é…ç½®æ–‡ä»¶ã€‚&lt;/li>
&lt;/ul>
&lt;h4 id="æœªå®Œå¾…ç»­">æœªå®Œå¾…ç»­...&lt;/h4></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Pelican/">Pelican</category><category domain="https://moelove.info/tags/upyun/">upyun</category></item><item><title>ä½¿ç”¨Pelicanæ­å»ºBlog</title><link>https://moelove.info/2014/05/07/%E4%BD%BF%E7%94%A8Pelican%E6%90%AD%E5%BB%BABlog/</link><guid isPermaLink="true">https://moelove.info/2014/05/07/%E4%BD%BF%E7%94%A8Pelican%E6%90%AD%E5%BB%BABlog/</guid><pubDate>Wed, 07 May 2014 21:48:59 +0000</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;h2 id="å®‰è£…é…ç½®pelican">å®‰è£…é…ç½®Pelican&lt;/h2>
&lt;hr>
&lt;h5 id="ä½¿ç”¨ç¯å¢ƒ">ä½¿ç”¨ç¯å¢ƒï¼š&lt;/h5>
&lt;pre>&lt;code> ç³»ç»Ÿ : Linux X86_64
Pelican : 3.3.0
&lt;/code>&lt;/pre>&lt;p>é¦–å…ˆè¯´ä¸€ä¸‹å®‰è£…ï¼š ç½‘ä¸Šæœ‰ä¸å°‘å»ºè®®è¯´ä½¿ç”¨è™šæ‹Ÿç¯å¢ƒ &lt;a href="https://virtualenv.pypa.io/en/latest/virtualenv.html">virtualenv&lt;/a>ï¼Œä»¥å…æ±¡æŸ“æœ¬åœ°çš„ç¯å¢ƒã€‚ä¸è¿‡ï¼Œå¦‚æœä¸æ˜¯å»æ›´æ”¹&lt;code>Python&lt;/code>çš„å…¨å±€è®¾ç½®çš„è¯ï¼Œä¹Ÿä¸è‡³äºå½±å“æœ¬åœ°ç¯å¢ƒçš„ã€‚æˆ‘æ˜¯ç›´æ¥å®‰è£…çš„ã€‚æ ¹æ® Pelican å®˜æ–¹çš„æ–‡æ¡£ï¼Œæˆ‘æ˜¯ä½¿ç”¨ &lt;code>pip&lt;/code> å®‰è£…çš„ï¼Œä¸è¿‡&lt;code>pip&lt;/code>åˆæ˜¯ä¾èµ–äº&lt;code>distribute&lt;/code> å®‰è£…çš„ã€‚æ‰€ä»¥ï¼Œæˆ‘ä½¿ç”¨çš„å‘½ä»¤å¦‚ä¸‹ï¼š&lt;/p>
&lt;pre>&lt;code> curl -O http://python-distribute.org/distribute_setup.py
sudo python distribute_setup.py
curl -O https://raw.github.com/pypa/pip/master/contrib/get-pip.py
sudo python get-pip.py
sudo pip install pelican
&lt;/code>&lt;/pre>&lt;p>è¿˜æœ‰ï¼Œå¦‚æœè¦ç”¨ &lt;a href="http://zh.wikipedia.org/zh-cn/Markdown">&lt;code>Markdown&lt;/code>&lt;/a>æ¥å†™æ–‡ç« ï¼Œä¹Ÿéœ€è¦æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š&lt;/p>
&lt;pre>&lt;code> pip install markdown
&lt;/code>&lt;/pre>&lt;p>æ–°å»ºä¸€ä¸ªç›®å½•ï¼Œç”¨æ¥å­˜æ”¾ä½ çš„åšå®¢æ–‡ä»¶ï¼ˆæˆ‘ç›´æ¥å»ºç«‹äº†&amp;quot;blog&amp;quot;æ–‡ä»¶å¤¹ï¼‰&lt;/p>
&lt;pre>&lt;code> mkdir blog
cd blog
&lt;/code>&lt;/pre>&lt;hr>
&lt;h2 id="æ–°å»ºåšå®¢">æ–°å»ºåšå®¢ï¼š&lt;/h2>
&lt;p>ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š&lt;/p>
&lt;pre>&lt;code> pelican-quickstart
&lt;/code>&lt;/pre>&lt;p>æŒ‰ç…§æç¤ºä¸€æ­¥æ­¥å³å¯å®Œæˆæ–°å»ºï¼Œ è¿™äº›é…ç½®ä¹‹åå¯ä»¥åœ¨&lt;code>pelicanconf.py&lt;/code>è¿™ä¸ªæ–‡ä»¶ä¸­ä¿®æ”¹&lt;/p>
&lt;pre>&lt;code> Where do you want to create your new web site?[.] (ä½ æƒ³åœ¨å“ªé‡Œåˆ›å»ºä½ çš„ç½‘ç«™ï¼Œé»˜è®¤ä¸ºå½“å‰ç›®å½•)
What will be the title of this web site?(ç½‘ç«™çš„æ ‡é¢˜æ˜¯ä»€ä¹ˆ)
Who will be the author of this web site?(ç½‘ç«™çš„ä½œè€…æ˜¯è°)
What will be the default language of this web site? [en] (ç½‘ç«™çš„é»˜è®¤è¯­è¨€æ˜¯),è¿™é‡Œæˆ‘ä»¬å†™'zh'ä¸­æ–‡
Do you want to specify a URL prefix? e.g., http://example.com(Y/n) (æ˜¯å¦æŒ‡å®šåŸŸå),Y
What is your URL prefix?(see above example; no trailing slash)(è¾“å…¥åŸŸåï¼Œä¸èƒ½åŒ…å«åæ–œæ '/'),http://moelove.info
Do you want to enable article pagination?(æ˜¯å¦å¯ç”¨æ–‡ç« åˆ†é¡µ)
Do you want to generate a Makefile to easily manage your website?(æ˜¯å¦ç”Ÿæˆä¸€ä¸ªMakefileæ¥ç®¡ç†ç½‘ç«™(è¿™é‡Œæˆ‘å»ºè®®ç”Ÿæˆï¼Œå› ä¸ºä¼šæ¯”è¾ƒæ–¹ä¾¿çš„))
Do you want an auto-reload &amp;amp; simpleHTTP script to assist with theme and site development?(æ˜¯å¦æƒ³æœ‰ä¸€ä¸ªè‡ªåŠ¨åŠ è½½çš„å°å‹httpè„šæœ¬ç”¨æ¥ä¿®æ”¹ä¸»é¢˜å’Œç«™ç‚¹å¼€å‘)
Do you want to upload your website using FTP?
Do you want to upload your website using SSH?
Do you want to upload your website using Dropbox?
Do you want to upload your website using S3?
&lt;/code>&lt;/pre>&lt;hr>
&lt;h2 id="æ–°å»ºåšæ–‡">æ–°å»ºåšæ–‡ï¼š&lt;/h2>
&lt;p>è¿™ä¸ªæ—¶å€™å°±å¯ä»¥å†™åšå®¢äº†ã€‚å…·ä½“çš„å†™ä½œæ–¹å¼å¯ä»¥å‚è€ƒ &lt;a href="http://docs.getpelican.com/en/latest/internals.html">Pelicançš„å®˜æ–¹æ–‡æ¡£&lt;/a>
æˆ‘ä»¥&lt;a href="http://daringfireball.net/projects/markdown/syntax">Markdown&lt;/a> ä¸ºä¾‹è¯´æ˜ä¸€ä¸‹ã€‚&lt;/p>
&lt;p>åœ¨content ç›®å½•ï¼Œæ–°å»ºä¸€ä¸ª &lt;code>hello.md&lt;/code>æ–‡ä»¶&lt;/p>
&lt;pre>&lt;code> vim content/htllo.md
Date: 2014-04-18 #æ—¥æœŸ
Title: HelloWorld #æ ‡é¢˜
Tags: hello #æ ‡ç­¾
Category: test #åˆ†ç±»
Hello World !
&lt;/code>&lt;/pre>&lt;p>ä¹‹åï¼Œæ‰§è¡Œ&lt;code>make html&lt;/code> æˆ–è€… &lt;code>pelican content&lt;/code>å³å¯å°† mdæ–‡ä»¶è½¬æ¢æˆhtmlæ–‡ä»¶ã€‚æ‰§è¡Œ &lt;code>make serve&lt;/code> å³å¯æ‰“å¼€æœ¬åœ°æµè§ˆå™¨ï¼Œ&lt;a href="http://127.0.0.1:8000/">é¢„è§ˆ&lt;/a>ã€‚&lt;/p>
&lt;blockquote>
&lt;p>&lt;strong>ç°åœ¨ä¸€ä¸ªä½¿ç”¨é»˜è®¤ä¸»é¢˜çš„åšå®¢å°±å»ºç«‹å¥½äº†ã€‚&lt;/strong>&lt;/p>
&lt;/blockquote>
&lt;hr>
&lt;h2 id="åç»­">åç»­&lt;/h2>
&lt;h4 id="æ¥ä¸‹æ¥è¯´ä¸€ä¸‹ä¿®æ”¹ä¸»é¢˜å’Œä½¿ç”¨æ’ä»¶çš„æ–¹æ³•">æ¥ä¸‹æ¥è¯´ä¸€ä¸‹ä¿®æ”¹ä¸»é¢˜å’Œä½¿ç”¨æ’ä»¶çš„æ–¹æ³•&lt;/h4>
&lt;p>Pelican é»˜è®¤æä¾›äº†å¾ˆå¤šä¸»é¢˜å¯ä»¥ github ä¸Šä¸‹è½½ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥è‡ªå·±åˆ¶ä½œã€‚&lt;/p>
&lt;pre>&lt;code> git clone git://github.com/getpelican/pelican-themes.git
&lt;/code>&lt;/pre>&lt;p>åœ¨é‡Œé¢æ‰¾åˆ°ä½ å–œæ¬¢çš„ä¸»é¢˜ï¼Œä½¿ç”¨&lt;/p>
&lt;pre>&lt;code> sudo pelican-theme -i /path/to/your/themes
&lt;/code>&lt;/pre>&lt;p>å‘½ä»¤è¿›è¡Œä¸»é¢˜çš„å®‰è£…ã€‚&lt;/p>
&lt;p>éšåå¯ä»¥ä½¿ç”¨&lt;code>pelican-themes -l -v&lt;/code> æŸ¥çœ‹å·²ç»å®‰è£…å¥½çš„ä¸»é¢˜ã€‚&lt;/p>
&lt;pre>&lt;code> /usr/lib/python2.7/site-packages/pelican/themes/simple
/usr/lib/python2.7/site-packages/pelican/themes/notmyidea
/usr/lib/python2.7/site-packages/pelican/themes/bootstrap2
&lt;/code>&lt;/pre>&lt;p>æƒ³è¦å¼€å§‹ä½¿ç”¨ä¸»é¢˜çš„è¯ï¼Œ åªéœ€è¦åœ¨&lt;code> pelicanconf.py&lt;/code>æ–‡ä»¶ä¸­æ·»åŠ  &lt;code>THEME&lt;/code>é¡¹ä¸ºä¸»é¢˜å,ä¾‹å¦‚ï¼š&lt;/p>
&lt;pre>&lt;code> THEME = &amp;quot;bootstrap2&amp;quot;
&lt;/code>&lt;/pre>&lt;p>é‡æ–° &lt;em>make html&lt;/em> å³å¯, è¿™æ—¶å€™å£°æˆçš„é¡µé¢å°±æ˜¯æ‰€è¦ä½¿ç”¨çš„ä¸»é¢˜äº†ã€‚&lt;/p>
&lt;h4 id="ä¸ºåšå®¢ä½¿ç”¨æ’ä»¶">ä¸ºåšå®¢ä½¿ç”¨æ’ä»¶&lt;/h4>
&lt;p>Pelican ä¹Ÿæä¾›äº†ä¸å°‘çš„æ’ä»¶æ¥æ–¹ä¾¿ä½¿ç”¨ï¼Œ å¯ä»¥ä»github ä¸Šé¢ä¸‹è½½åˆ°åšå®¢æ‰€åœ¨ç›®å½•ï¼š&lt;/p>
&lt;pre>&lt;code> git clone git://github.com/getpelican/pelican-plugins.git
&lt;/code>&lt;/pre>&lt;p>ç°åœ¨åšå®¢ç›®å½•å°±æ–°æ·»äº†ä¸€ä¸ª pelican-plugins ç›®å½•ï¼Œæ¥ä¸‹æ¥åœ¨ pelicanconf.py é‡Œé¢æ·»åŠ é…ç½®å³å¯(é‡Œé¢æ˜¯æˆ‘æœ€å¼€å§‹ä½¿ç”¨çš„ä¸‰ä¸ªæ’ä»¶):&lt;/p>
&lt;pre>&lt;code> PLUGIN_PATH = u&amp;quot;pelican-plugins&amp;quot;
PLUGINS = [&amp;quot;sitemap&amp;quot;, &amp;quot;summary&amp;quot;, &amp;quot;neighbors&amp;quot;]
&lt;/code>&lt;/pre>&lt;p>å†æ·»åŠ  sitemap çš„é…ç½®&lt;/p>
&lt;pre>&lt;code> SITEMAP = {
'format': 'xml',
'priorities': {
'articles': 0.5,
'indexes': 0.5,
'pages': 0.5
},
'changefreqs': {
'articles': 'weekly',
'indexes': 'daily',
'pages': 'monthly'
}
}
&lt;/code>&lt;/pre>&lt;p>ç„¶åæ‰§è¡Œ &lt;code>*make html*&lt;/code> å³å¯&lt;/p>
&lt;h4 id="æ·»åŠ å¤šè¯´è¯„è®º">æ·»åŠ å¤šè¯´è¯„è®º&lt;/h4>
&lt;p>ä¸€å¼€å§‹æ­å»ºé™æ€åšå®¢çš„æ—¶å€™ï¼Œä½¿ç”¨çš„&lt;a href="http://disqus.com/">disqus&lt;/a> å¹¶ä¸”Pelican çš„ä¸»é¢˜ä¸­é»˜è®¤æä¾›äº†æ”¯æŒï¼Œåªè¦åœ¨ pelicanconf.py çš„é‡Œé¢åŠ å…¥ disqus çš„short_name å³å¯å¼€å§‹ä½¿ç”¨äº†ã€‚ä¸è¿‡ï¼Œèº«åœ¨å¤©æœï¼Œè¿˜æ˜¯å°½é‡æœ¬åœ°åŒ–ä¸€äº›å§ï¼Œä½¿ç”¨&lt;a href="http://duoshuo.com/">å¤šè¯´&lt;/a>è¯„è®ºæ’ä»¶ã€‚
åœ¨&lt;a href="http://duoshuo.com/">å¤šè¯´&lt;/a>æ³¨å†Œä¸€ä¸ªå¸å·ï¼Œ&lt;a href="http://duoshuo.com/create-site/">æ·»åŠ ä¸€ä¸ªç«™ç‚¹&lt;/a>ï¼Œè·å–è‡ªå·±çš„ &lt;em>short_name&lt;/em> ï¼Œç‚¹å‡»å·¥å…·ä¸€æ --&amp;gt;è·å–ä»£ç &lt;/p>
&lt;pre>&lt;code>&amp;lt;!-- å¤šè¯´è¯„è®ºæ¡† start --&amp;gt;
&amp;lt;div class=&amp;quot;ds-thread&amp;quot; data-thread-key=&amp;quot;è¯·å°†æ­¤å¤„æ›¿æ¢æˆæ–‡ç« åœ¨ä½ çš„ç«™ç‚¹ä¸­çš„ID&amp;quot; data-title=&amp;quot;è¯·æ›¿æ¢æˆæ–‡ç« çš„æ ‡é¢˜&amp;quot; data-url=&amp;quot;è¯·æ›¿æ¢æˆæ–‡ç« çš„ç½‘å€&amp;quot;&amp;gt;&amp;lt;/div&amp;gt;
&amp;lt;!-- å¤šè¯´è¯„è®ºæ¡† end --&amp;gt;
&amp;lt;!-- å¤šè¯´å…¬å…±JSä»£ç  start (ä¸€ä¸ªç½‘é¡µåªéœ€æ’å…¥ä¸€æ¬¡) --&amp;gt;
&amp;lt;script type=&amp;quot;text/javascript&amp;quot;&amp;gt;
var duoshuoQuery = {short_name:&amp;quot;æ›¿æ¢æˆä½ è‡ªå·±çš„&amp;quot;};
(function() {
var ds = document.createElement('script');
ds.type = 'text/javascript';ds.async = true;
ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
ds.charset = 'UTF-8';
(document.getElementsByTagName('head')[0]
|| document.getElementsByTagName('body')[0]).appendChild(ds);
})();
&amp;lt;/script&amp;gt;
&amp;lt;!-- å¤šè¯´å…¬å…±JSä»£ç  end --&amp;gt;
&lt;/code>&lt;/pre>&lt;p>æŠŠè¿™æ®µä»£ç æ”¾åœ¨ä½ æƒ³è¦æ˜¾ç¤ºè¯„è®ºçš„åœ°æ–¹å°±å¯ä»¥äº†ã€‚å»ºè®®ç›´æ¥ä¿®æ”¹æ”¾åœ¨article.htmlæ¨¡æ¿é‡Œé¢ã€‚&lt;/p>
&lt;h4 id="æ·»åŠ å…¶ä»–åŠŸèƒ½">æ·»åŠ å…¶ä»–åŠŸèƒ½&lt;/h4>
&lt;p>è¿™é‡Œæˆ‘è¿˜åŠ å…¥äº†&lt;a href="http://share.baidu.com/code">ç™¾åº¦åˆ†äº«&lt;/a>çš„åŠŸèƒ½ã€‚ç›´æ¥å®šåˆ¶ä¸ªäººæƒ³è¦çš„ä»£ç ï¼Œ æ”¾åœ¨ä½ éœ€è¦å‡ºç°åˆ†äº«æŒ‰é’®çš„åœ°æ–¹å³å¯ï¼Œæˆ‘æ”¾åœ¨äº†æ–‡ç« çš„ä¸‹é¢ã€‚&lt;/p>
&lt;pre>&lt;code>&amp;lt;div class=&amp;quot;bdsharebuttonbox&amp;quot;&amp;gt;&amp;lt;a href=&amp;quot;#&amp;quot; class=&amp;quot;bds_more&amp;quot; data-cmd=&amp;quot;more&amp;quot;&amp;gt;&amp;lt;/a&amp;gt;&amp;lt;a href=&amp;quot;#&amp;quot; class=&amp;quot;bds_qzone&amp;quot; data-cmd=&amp;quot;qzone&amp;quot;&amp;gt;&amp;lt;/a&amp;gt;&amp;lt;a href=&amp;quot;#&amp;quot; class=&amp;quot;bds_tsina&amp;quot; data-cmd=&amp;quot;tsina&amp;quot;&amp;gt;&amp;lt;/a&amp;gt;&amp;lt;a href=&amp;quot;#&amp;quot; class=&amp;quot;bds_tqq&amp;quot; data-cmd=&amp;quot;tqq&amp;quot;&amp;gt;&amp;lt;/a&amp;gt;&amp;lt;a href=&amp;quot;#&amp;quot; class=&amp;quot;bds_renren&amp;quot; data-cmd=&amp;quot;renren&amp;quot;&amp;gt;&amp;lt;/a&amp;gt;&amp;lt;a href=&amp;quot;#&amp;quot; class=&amp;quot;bds_weixin&amp;quot; data-cmd=&amp;quot;weixin&amp;quot;&amp;gt;&amp;lt;/a&amp;gt;&amp;lt;/div&amp;gt;
&amp;lt;script&amp;gt;window._bd_share_config={&amp;quot;common&amp;quot;:{&amp;quot;bdSnsKey&amp;quot;:{},&amp;quot;bdText&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;bdMini&amp;quot;:&amp;quot;2&amp;quot;,&amp;quot;bdPic&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;bdStyle&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;bdSize&amp;quot;:&amp;quot;16&amp;quot;},&amp;quot;share&amp;quot;:{},&amp;quot;image&amp;quot;:{&amp;quot;viewList&amp;quot;:[&amp;quot;qzone&amp;quot;,&amp;quot;tsina&amp;quot;,&amp;quot;tqq&amp;quot;,&amp;quot;renren&amp;quot;,&amp;quot;weixin&amp;quot;],&amp;quot;viewText&amp;quot;:&amp;quot;åˆ†äº«åˆ°ï¼š&amp;quot;,&amp;quot;viewSize&amp;quot;:&amp;quot;16&amp;quot;},&amp;quot;selectShare&amp;quot;:{&amp;quot;bdContainerClass&amp;quot;:null,&amp;quot;bdSelectMiniList&amp;quot;:[&amp;quot;qzone&amp;quot;,&amp;quot;tsina&amp;quot;,&amp;quot;tqq&amp;quot;,&amp;quot;renren&amp;quot;,&amp;quot;weixin&amp;quot;]}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];&amp;lt;/script&amp;gt;
&lt;/code>&lt;/pre>&lt;p>è¿˜æœ‰åŠ å…¥äº† &lt;a href="http://www.google.com/analytics/">Google Analytics&lt;/a> è°·æ­Œç«™å†…æœç´¢ ä»¥åŠä¸ƒç‰›æä¾›çš„äº‘å­˜å‚¨ ç­‰ã€‚&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Pelican/">Pelican</category><category domain="https://moelove.info/tags/Blog/">Blog</category><category domain="https://moelove.info/tags/Web/">Web</category></item><item><title>Hello World !</title><link>https://moelove.info/2014/04/18/Hello-World/</link><guid isPermaLink="true">https://moelove.info/2014/04/18/Hello-World/</guid><pubDate>Fri, 18 Apr 2014 21:46:06 +0000</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>å‡ ä¹æ‰€æœ‰çš„ç¨‹åºçŒ¿çš„ç¬¬ä¸€ä¸ªæ¼”ç¤ºç¨‹åºéƒ½æ˜¯Hello World .é‚£æˆ‘ä¹Ÿå°±ä¸€æ ·å’¯ï¼Œ ä¹Ÿå†™ä¸€ä¸ªåŒæ ·çš„å§ã€‚
å…¶å®æˆ‘çš„åšå®¢ä»å¾ˆæ—©å‰å°±å·²ç»å¼€å§‹åœ¨å†™äº†ï¼Œ æ¢äº†å¾ˆå¤šçš„å¹³å°ï¼š&lt;/p>
&lt;/blockquote>
&lt;pre>&lt;code>ä»è…¾è®¯ç©ºé—´--&amp;gt; ç™¾åº¦ç©ºé—´--&amp;gt; æ–°æµªåšå®¢--&amp;gt; è‡ªå·±æ­å»ºçš„Wordpressåšå®¢--&amp;gt; ç‚¹ç‚¹ï¼ˆç‚¹ç‚¹æˆ‘å…¶å®æ˜¯ç”¨æ¥ç¢ç¢å¿µçš„ï¼‰
--&amp;gt; åšå®¢å›­ï¼ˆä¸ªäººæ„Ÿè§‰ä½“éªŒä¸æ˜¯å¾ˆå¥½çš„è¯´ï¼‰--&amp;gt; é™æ€åšå®¢
&lt;/code>&lt;/pre>
&lt;p>é€‰æ‹©äº†è¿™ä¹ˆå¤šï¼Œæˆ‘æœ€åå†³å®šè¿˜æ˜¯ä½¿ç”¨ &lt;strong>é™æ€åšå®¢&lt;/strong> æ¥åšä¸ªäººåšå®¢ã€‚&lt;/p>
&lt;blockquote>
&lt;p>åŸå› æœ‰ä»¥ä¸‹å‡ ä¸ªï¼š&lt;/p>
&lt;/blockquote>
&lt;ol>
&lt;li>ä½¿ç”¨å…¶ä»–å¹³å°æä¾›çš„åšå®¢ä¸æ˜¯å¾ˆçˆ½ï¼Œ å¯ä¸ªæ€§åŒ–çš„æ–¹é¢ä¸æ˜¯å¾ˆå¤šï¼Œ ç‚¹ç‚¹ç›¸å¯¹æ¥è¯´åšçš„è¿˜æ˜¯å¾ˆä¸é”™çš„
ä¸ä»…æä¾›ä¸ªæ€§åŒ–å®šåˆ¶è€Œä¸”è¿˜æ”¯æŒç»‘å®šä¸ªäººåŸŸåä¹‹ç±»çš„ã€‚ä½†æ˜¯å…¶ä»–ç½‘ç«™å°±ä¸æ˜¯é‚£ä¹ˆäººæ€§åŒ–äº†ã€‚&lt;/li>
&lt;li>å†™åšå®¢æ€»æ˜¯éœ€è¦è´´ä»£ç çš„ï¼Œä½†æ˜¯é™¤äº†WPå¤–ï¼Œå…¶ä»–çš„æˆ‘ä¸æ˜¯å¾ˆæ»¡æ„ã€‚&lt;/li>
&lt;li>ç”¨é™æ€åšå®¢æ–¹ä¾¿å¤‡ä»½ï¼Œè€Œä¸”æ˜¯æœ¬åœ°ç¼–è¾‘å°±å¯ä»¥äº†ï¼Œåœ¨çº¿ç¼–è¾‘çš„ï¼Œæ„Ÿè§‰ä¼šè¢«æŸç¼šå¾ˆå¤šã€‚&lt;/li>
&lt;li>æœ¬äººå±äºæŠ˜è…¾å…šï¼Œå–œæ¬¢å¯ä»¥ä¸ªäººå®šåˆ¶çš„ï¼Œ ç›´åˆ°ç¬¦åˆä¸ªäººæ»¡æ„çš„ç¨‹åº¦ä¸ºæ­¢ã€‚&lt;/li>
&lt;/ol>
&lt;blockquote>
&lt;p>æ¥ä¸‹æ¥è¯´è¯´è¿™æ¬¡åšå®¢çš„å®‰è£…ï¼š&lt;/p>
&lt;/blockquote>
&lt;ol>
&lt;li>é€‰æ‹©&lt;strong>Pelica&lt;/strong>æ˜¯å› ä¸ºæˆ‘å¯¹Python æ¯”è¾ƒç†Ÿæ‚‰ï¼Œä¹‹å‰å°è¯•è¿‡ç”¨Jekyll å’Œ Octopress æ­å»ºï¼Œéƒ½æ¯”è¾ƒæ–¹ä¾¿
å°¤å…¶æ˜¯Jekyll ç”¨æˆ·å¾ˆå¤šï¼Œæ–‡æ¡£ä»€ä¹ˆçš„éƒ½å¾ˆå¤šäº†ã€‚åªä¸è¿‡æˆ‘æ›´å–œæ¬¢Python å¤šä¸€äº›ï¼ˆè™½ç„¶æˆ‘æœ‰ç”¨RORå¼€å‘è¿‡WEBåº”ç”¨ç¨‹åºï¼‰
å› ä¸ºå¦‚æœæœ‰ä»€ä¹ˆéœ€è¦çš„è¯ï¼Œæˆ‘ä¹Ÿå¯ä»¥è‡ªå·±æ¥å¼€å‘æ’ä»¶æˆ–è€…è‡ªå·±å†å°è¯•åšä¸€ä¸ªç³»ç»Ÿã€‚&lt;/li>
&lt;li>Pelican ç›¸å¯¹æ¥è¯´é…ç½®ä¹Ÿå¾ˆæ–¹ä¾¿ï¼Œ å¾ˆç®€å•ï¼Œ è™½ç„¶ç”¨æˆ·ä¸æ˜¯å¾ˆå¤šï¼Œä½†æ˜¯åŸºæœ¬ä¸Šçš„é—®é¢˜ä¹Ÿéƒ½å¯ä»¥è§£å†³çš„&lt;/li>
&lt;li>&lt;a href="https://github.com/getpelican/pelican">Pelican&lt;/a> æ”¯æŒrestructuredTextå’ŒMarkdownå†™æ–‡ç« ï¼Œé…ç½®çµæ´»ï¼Œæ‰©å±•æ€§å¼ºã€‚æˆ‘ç”¨çš„æ˜¯3.3.0ã€‚&lt;/li>
&lt;/ol></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Pelican/">Pelican</category><category domain="https://moelove.info/tags/Blog/">Blog</category></item><item><title>Linux å®‰è£…Android é©±åŠ¨</title><link>https://moelove.info/2014/03/10/Linux-%E5%AE%89%E8%A3%85Android-%E9%A9%B1%E5%8A%A8/</link><guid isPermaLink="true">https://moelove.info/2014/03/10/Linux-%E5%AE%89%E8%A3%85Android-%E9%A9%B1%E5%8A%A8/</guid><pubDate>Mon, 10 Mar 2014 21:44:06 +0000</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;p>åœ¨Linuxä¸‹éå¸¸é€‚åˆåšä¸€äº›å¯¹Rom çš„å®šåˆ¶ä»¥åŠå…¶ä»–çš„ä¸€äº›æ“ä½œï¼Œç”šè‡³æ˜¯è‡ªå·±åˆ¶ä½œRom æˆ–è€…ä»æºç ç¼–è¯‘Rom ä¹Ÿæ˜¯OKçš„ã€‚&lt;/p>
&lt;p>ä¸è¿‡æœ€å¼€å§‹çš„åº”è¯¥å°±æ˜¯æ­å»ºå¼€å‘ç¯å¢ƒäº†ï¼Œæˆ‘å…ˆä»è£…é©±åŠ¨å¼€å§‹è¯´ï¼ˆåªæ˜¯åšä¸ªç¬”è®°è€Œå·²ï¼‰&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ä½¿ç”¨æ•°æ®çº¿è¿æ¥æ‰‹æœºï¼Œæ‰“å¼€&lt;strong>adbè°ƒè¯•æ¨¡å¼&lt;/strong>ã€‚(åœ¨Linuxä¸Šæ­å»ºå¼€å‘ç¯å¢ƒï¼Œ ä»¥åŠadb å‘½ä»¤ä¹‹ç±»çš„ï¼Œ å°±è‡ªè¡Œæœç´¢å§ï¼Œå¦‚æœå“ªå¤©æ›´æ–°äº† æˆ‘ä¼šé™„ä¸Šé“¾æ¥çš„)&lt;/p>
&lt;/li>
&lt;li>
&lt;p>è¾“å…¥&lt;code>adb devices&lt;/code> æŸ¥çœ‹è®¾å¤‡
å¦‚æœæœ‰æœºå‹çš„è¯å°±è¯´æ˜æ˜¯å·²ç»æœ‰é©±åŠ¨äº†
å¦‚æœæ²¡æœ‰æ˜¾ç¤ºçš„è¯ï¼Œ å°±æ˜¯è¯´æ˜éœ€è¦è¿›è¡Œé©±åŠ¨å®‰è£…äº†ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>è¿™ä¸ªæ—¶å€™ï¼Œ &lt;code>lsusb&lt;/code> æŸ¥çœ‹ï¼Œ ä¼šçœ‹åˆ°ä¸‹é¢è¿™æ ·çš„ä¿¡æ¯&lt;/p>
&lt;pre>&lt;code>[tao@localhost ~]$ lsusb
Bus 001 Device 002: ID 8087:0020 Intel Corp. Integrated Rate Matching Hub
Bus 002 Device 002: ID 8087:0020 Intel Corp. Integrated Rate Matching Hub
Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
Bus 002 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
Bus 002 Device 006: ID 12d1:2229 Huawei Technologies Co., Ltd.
Bus 002 Device 004: ID 04f2:b1c1 Chicony Electronics Co., Ltd
Bus 002 Device 005: ID 062a:4101 Creative Labs
&lt;/code>&lt;/pre>&lt;p>å¯ä»¥åœ¨&lt;a href="https://developer.android.com/tools/device.html">Android Developer&lt;/a> ï¼Œ çœ‹åˆ°å¯¹å…¶ä»–çš„äº§å“çš„æ”¯æŒï¼Œçªçš„æ‰‹æœºæ˜¯Huaweiçš„æ‰€ä»¥å°±æ˜¯è¦è¾“å…¥å¯¹åº”çš„ID ï¼š&lt;strong>12d1&lt;/strong> ç„¶åï¼Œå†æ–°å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œ&lt;/p>
&lt;pre>&lt;code>vim /etc/udev/rules.d/50-android.rules
å†™å…¥å†…å®¹ï¼š
SUBSYSTEM==&amp;quot;usb&amp;quot;, ATTR{idVendor}==&amp;quot;12d1&amp;quot;, ATTR{idProduct}==&amp;quot;2229&amp;quot;, MODE=&amp;quot;0600&amp;quot;, OWNER=&amp;quot;tao&amp;quot;,GROUP =&amp;quot;plugdev&amp;quot;
&lt;/code>&lt;/pre>&lt;p>50æ˜¯è¯´æ˜¯æ‰‹æœºï¼Œ å…¶ä»–çš„å‘½åä¹Ÿæœ‰å„è‡ªçš„è§£é‡Š&lt;/p>
&lt;p>ç„¶åæˆ‘ä»¬å°±å¯ä»¥æ–°å»ºè¿™ä¸ªæ–‡ä»¶ï¼Œ ä¿®æ”¹æƒé™&lt;/p>
&lt;pre>&lt;code>chmod a+x /etc/udev/rules.d/50-android.rules
&lt;/code>&lt;/pre>&lt;p>è¿™ä¸ªæ—¶å€™ å°±æˆåŠŸäº†ï¼Œæˆ‘ä»¬ä½¿ç”¨&lt;code>adb devices&lt;/code> å‘½ä»¤å°±å¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„è®¾å¤‡äº†ï¼Œ ä½¿ç”¨&lt;code>adb shell&lt;/code> å°±å¯ä»¥å¯¹æ‰‹æœºè¿›è¡Œæ“ä½œäº†&lt;/p>
&lt;p>å½“ç„¶æˆ‘åœ¨è¿™é‡Œè¿›è¡Œäº†ä¸€æ¬¡é‡å¯ï¼Œå°±å¯ä»¥ä½¿ç”¨äº†
(è¯è¯´è¿™ç¯‡æ–‡ç« è™½ç„¶ä¸€ç›´åœ¨äº‘ç«¯ç¼–è¾‘ï¼Œä½†æ˜¯ä¸€ç›´æœ¨æœ‰ç»“æŸï¼Œç°åœ¨æ‰å‘å‡ºæ¥ã€‚ã€‚ä¸€å®šè¦æé«˜æ•ˆç‡ï¼)&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Android/">Android</category></item><item><title>fedora 18 Kernel driver not installed (rc=-1908)å¤„ç†åŠæ³•</title><link>https://moelove.info/2013/12/21/fedora-18-Kernel-driver-not-installed-rc-1908%E5%A4%84%E7%90%86%E5%8A%9E%E6%B3%95/</link><guid isPermaLink="true">https://moelove.info/2013/12/21/fedora-18-Kernel-driver-not-installed-rc-1908%E5%A4%84%E7%90%86%E5%8A%9E%E6%B3%95/</guid><pubDate>Sat, 21 Dec 2013 21:42:18 +0000</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;h4 id="fedora-18-å‡çº§å†…æ ¸ä¹‹å-ä½¿ç”¨virtualbox-å¯ä»¥æ­£å¸¸æ‰“å¼€è½¯ä»¶ä½†æ˜¯ä¸èƒ½å¯åŠ¨è™šæ‹Ÿæœºç³»ç»Ÿæç¤ºä¿¡æ¯å¦‚ä¸‹">fedora 18 å‡çº§å†…æ ¸ä¹‹å ä½¿ç”¨&lt;em>VirtualBox&lt;/em> å¯ä»¥æ­£å¸¸æ‰“å¼€è½¯ä»¶,ä½†æ˜¯ä¸èƒ½å¯åŠ¨è™šæ‹Ÿæœºç³»ç»Ÿ.æç¤ºä¿¡æ¯å¦‚ä¸‹:&lt;/h4>
&lt;pre>&lt;code>Kernel driver not installed (rc=-1908)
&lt;/code>&lt;/pre>&lt;p>ç»è¿‡ä¸€ç³»åˆ—çš„çœ‹æ–‡æ¡£è¿˜æœ‰google ä¹‹å,å¾ˆå¤šåœ°æ–¹å†™ç€è¿™ä¸ªé—®é¢˜çš„å¤„ç†æ–¹æ³•æ˜¯&lt;/p>
&lt;ul>
&lt;li>ç¬¬ä¸€ç§&lt;/li>
&lt;/ul>
&lt;pre>&lt;code>sudo /etc/init.d/vboxdrv setup
&lt;/code>&lt;/pre>&lt;p>ç»è¿‡å®éªŒ,å¯¹feora 18 ä¸å¯è¡Œ&lt;/p>
&lt;ul>
&lt;li>ç¬¬äºŒç§&lt;/li>
&lt;/ul>
&lt;pre>&lt;code>sudo apt-get install dkms
sudo /etc/init.d/vboxdrv setup
&lt;/code>&lt;/pre>&lt;p>ä½†æ˜¯æƒ…å†µç»§ç»­&lt;/p>
&lt;ul>
&lt;li>ç¬¬ä¸‰ç§&lt;/li>
&lt;/ul>
&lt;pre>&lt;code>sudo aptitude update
sudo aptitude install dkms
sudo /etc/init.d/vboxdrv setup
&lt;/code>&lt;/pre>&lt;h3 id="æœ€åæ­£ç¡®çš„è§£å†³æ–¹æ³•åº”è¯¥æ˜¯é…±ç´«çš„">æœ€åæ­£ç¡®çš„è§£å†³æ–¹æ³•åº”è¯¥æ˜¯é…±ç´«çš„&lt;/h3>
&lt;ul>
&lt;li>å…ˆçœ‹çœ‹ç³»ç»Ÿçš„å†…æ ¸&lt;/li>
&lt;/ul>
&lt;pre>&lt;code>uname -r
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>æ‰¾å¯¹åº”çš„åŒ…&lt;/li>
&lt;/ul>
&lt;pre>&lt;code>sudo yum search kmod-VirtualBox
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>ç„¶åå®‰è£…å’Œä½ ç³»ç»Ÿå†…æ ¸å¯¹åº”çš„åŒ…&lt;/li>
&lt;/ul>
&lt;pre>&lt;code>sudo yum install kmod-VirtualBox-XXXX
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>è¿è¡Œ&lt;/li>
&lt;/ul>
&lt;pre>&lt;code>/etc/sysconfig/modules/VirtualBox.modules
&lt;/code>&lt;/pre>&lt;p>ä¸€åˆ‡OKäº†&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category></item><item><title>Ruby on Rails ç¯å¢ƒ</title><link>https://moelove.info/2013/09/21/Ruby-on-Rails-%E7%8E%AF%E5%A2%83/</link><guid isPermaLink="true">https://moelove.info/2013/09/21/Ruby-on-Rails-%E7%8E%AF%E5%A2%83/</guid><pubDate>Sat, 21 Sep 2013 21:39:55 +0000</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;h4 id="å°±è¿™æ¬¡çš„å°è¯•å†™ä¸€ä¸‹è‡ªå·±çš„è®°å½•">å°±è¿™æ¬¡çš„å°è¯•å†™ä¸€ä¸‹è‡ªå·±çš„è®°å½•&lt;/h4>
&lt;p>å®‰è£…ruby å’Œ ruby-devel(å®‰è£…ruby-develæ˜¯å› ä¸ºåç»­çš„å·¥ä½œå¦‚æœæ²¡æœ‰ruby-develçš„è¯ï¼Œä¼šæŠ¥é”™)&lt;/p>
&lt;pre>&lt;code>sudo yum install ruby ruby-devel rubygems sqlite -y
&lt;/code>&lt;/pre>&lt;p>éœ€è¦çš„ç¯å¢ƒæœ‰äº†ï¼Œé‚£ä¹ˆå°±å¯ä»¥å¼€å§‹æ­£å¼çš„å·¥ä½œäº†&lt;/p>
&lt;pre>&lt;code>sudo gem install rails
&lt;/code>&lt;/pre>&lt;p>æ‰¾åˆ°ä¸€ä¸ªåˆé€‚çš„ç›®å½•æ¥æ”¾è‡ªå·±çš„ä»£ç .ç„¶åæ‰§è¡Œ&lt;/p>
&lt;pre>&lt;code>$ rails new mysite
// è¿™ä¸ªæ˜¯å»ºç«‹ä¸€ä¸ªå«mysite çš„railsç¨‹å¼ ï¼Œåœ¨å½“å‰ç›®å½•ä¸‹é¢
$ cd mysite
//è¿›å…¥è¿™ä¸ªç›®å½•
$ bundle install
//å› ä¸ºåœ¨åšæµ‹è¯• æ‰€ä»¥ ä¹Ÿæ²¡æœ‰å¿…è¦å®‰è£…å…¶ä»–çš„gem
&lt;/code>&lt;/pre>&lt;p>æ¥ä¸‹æ¥çœ‹çœ‹å®ƒçš„æ•°æ®åº“ é…ç½®æ–‡ä»¶æ˜¯ &lt;code>config/database.yml&lt;/code> é»˜è®¤çš„æ”¯æŒæ˜¯æ˜¯&lt;strong>SQLite3&lt;/strong>(å½“ç„¶ä¹Ÿæ”¯æŒå…¶ä»–çš„æ¯”å¦‚mysqlä¹‹ç±»çš„)å®ƒæœ‰ä¸‰ç§æ¨¡å¼:&lt;/p>
&lt;ul>
&lt;li>development environmentå¼€å‘æ¨¡å¼ï¼Œç”¨åœ¨ä½ çš„å¼€å‘çš„æ—¶å€™&lt;/li>
&lt;li>test environmentæµ‹è¯•æ¨¡å¼ï¼Œç”¨åœ¨è‡ªåŠ¨æµ‹è¯•æ—¶&lt;/li>
&lt;li>production environmentæ­£å¼ä¸Šçº¿æ¨¡å¼ï¼Œç”¨åœ¨å®é™…çš„ä¸Šçº¿è¿ä½œç¯å¢ƒ&lt;/li>
&lt;/ul>
&lt;p>SQLiteé…ç½®å¤§è‡´æ˜¯è¿™æ ·çš„:&lt;/p>
&lt;pre>&lt;code>development:
adapter: sqlite3
database: db/development.sqlite3
pool: 5
timeout: 5000
&lt;/code>&lt;/pre>&lt;p>æ¥ä¸‹æ¥å»ºç«‹è‡ªå·±çš„æ•°æ®åº“&lt;/p>
&lt;pre>&lt;code>rake db:create
&lt;/code>&lt;/pre>&lt;p>&lt;strong>åœ¨è¿™é‡Œæˆ‘é‡åˆ°ä¸€ä¸ªé”™è¯¯&lt;/strong>&lt;/p>
&lt;pre>&lt;code>rake aborted!
Could not find a JavaScript runtime. See https://github.com/sstephenson/execjs for a list of available runtimes.
(See full trace by running task with --trace)
&lt;/code>&lt;/pre>&lt;p>æˆ‘çš„è§£å†³åŠæ³•æ˜¯&lt;/p>
&lt;pre>&lt;code>sudo yum install nodejs
&lt;/code>&lt;/pre>&lt;p>ç„¶åå¯åŠ¨æœåŠ¡å™¨&lt;/p>
&lt;pre>&lt;code>rails server
&lt;/code>&lt;/pre>&lt;p>è¦çœ‹ç»“æœå°±æ‰“å¼€&lt;a href="http://localhost:3000">http://localhost:3000&lt;/a>å°±ä¼šçœ‹è§rails çš„é»˜è®¤é¦–é¡µäº†&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Ruby/">Ruby</category><category domain="https://moelove.info/tags/Rails/">Rails</category></item><item><title>åˆ©ç”¨ç™¾åº¦BAEæ­å»ºdiscuzè®ºå›</title><link>https://moelove.info/2013/09/06/%E5%88%A9%E7%94%A8%E7%99%BE%E5%BA%A6BAE%E6%90%AD%E5%BB%BAdiscuz%E8%AE%BA%E5%9D%9B/</link><guid isPermaLink="true">https://moelove.info/2013/09/06/%E5%88%A9%E7%94%A8%E7%99%BE%E5%BA%A6BAE%E6%90%AD%E5%BB%BAdiscuz%E8%AE%BA%E5%9D%9B/</guid><pubDate>Fri, 06 Sep 2013 21:38:39 +0000</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;p>æœ€è¿‘å°è¯•äº†åˆ©ç”¨ç™¾åº¦äº‘åº”ç”¨ç®¡ç†&lt;em>BAE&lt;/em>æ­å»ºdiscuzè®ºå›ï¼Œ è¿™é‡Œåšç®€è¦è®°å½•&lt;/p>
&lt;h3 id="åˆ›å»ºåº”ç”¨">åˆ›å»ºåº”ç”¨&lt;/h3>
&lt;p>åœ¨ &lt;a href="http://developer.baidu.com/">ç™¾åº¦å¼€å‘è€…ä¸­å¿ƒ&lt;/a> åˆ›å»ºä¸€ä¸ªåº”ç”¨ï¼Œé€‰æ‹©WEBåº”ç”¨ä¸‹çš„PC &lt;strong>Iframeåº”ç”¨&lt;/strong>&lt;/p>
&lt;h3 id="æ‰˜ç®¡è®¾ç½®">æ‰˜ç®¡è®¾ç½®&lt;/h3>
&lt;p>ä¹‹åè¿›è¡Œæ‰˜ç®¡è®¾ç½®ï¼Œ ç¡®å®šåŸŸåXXX.duapp.com&lt;/p>
&lt;p>åˆ›å»ºä¸€ä¸ªç‰ˆæœ¬ï¼Œå¹¶ä¸Šä¼ PHPä»£ç åŒ…&lt;/p>
&lt;p>(BAEæœ‰äº›å‡½æ•°è§„åˆ™å‘ç”Ÿæ”¹å˜ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨ä¸ºBAEç¯å¢ƒåšè¿‡è°ƒæ•´çš„&lt;a href="http://pan.baidu.com/s/1hqsYVre">discuz for BAE&lt;/a> ç‰ˆæœ¬)&lt;/p>
&lt;p>éœ€è¦æ³¨æ„çš„æ˜¯åœ¨ä¸Šä¼ çš„ä»£ç åŒ…é‡Œé¢çš„ &lt;em>bcs/config.php&lt;/em> ä¸­çš„å†…å®¹åº”è¯¥ä¿®æ”¹ä¸º&lt;/p>
&lt;pre>&lt;code>&amp;lt;?php
define('BAIDU_BCS_BUCKET', 'åˆ›å»ºçš„bucketåç§°');
define('BAIDU_BCS_AK', getenv('HTTP_BAE_ENV_AK'));
define('BAIDU_BCS_SK', getenv('HTTP_BAE_ENV_SK'));
?&amp;gt;
&lt;/code>&lt;/pre>&lt;p>åŒæ—¶åœ¨æ•°æ®åº“ä¸­è®¾ç½®ä¸ºUTF-8,&lt;/p>
&lt;p>æ³¨æ„å¼€å¯ç¼“å­˜ cache æœ€å°‘30M(äº²æµ‹50Må®Œå…¨æ˜¯OKçš„)&lt;/p>
&lt;h3 id="å®‰è£…">å®‰è£…&lt;/h3>
&lt;p>ä¹‹åä¸Šçº¿åº”ç”¨ï¼Œè®¿é—®&lt;a href="http://%E4%BD%A0%E7%9A%84%E5%9F%9F%E5%90%8D.duapp.com/install/index.php">http://ä½ çš„åŸŸå.duapp.com/install/index.php&lt;/a>&lt;/p>
&lt;p>å³å¯å®Œæˆå®‰è£…(éœ€è¦ç”¨åˆ°åˆ›å»ºçš„æ•°æ®åº“åç§°)&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/BAE/">BAE</category></item><item><title>fedoraä¸‹å®‰è£…sublime text 2çš„æ–¹æ³•</title><link>https://moelove.info/2013/08/30/fedora%E4%B8%8B%E5%AE%89%E8%A3%85sublime-text-2%E7%9A%84%E6%96%B9%E6%B3%95/</link><guid isPermaLink="true">https://moelove.info/2013/08/30/fedora%E4%B8%8B%E5%AE%89%E8%A3%85sublime-text-2%E7%9A%84%E6%96%B9%E6%B3%95/</guid><pubDate>Fri, 30 Aug 2013 21:36:09 +0000</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;h3 id="é¦–å…ˆå»å®˜ç½‘httpwwwsublimetextcomä¸‹è½½æœ€æ–°çš„å‹ç¼©åŒ…">é¦–å…ˆå»&lt;a href="http://www.sublimetext.com/">å®˜ç½‘&lt;/a>ä¸‹è½½æœ€æ–°çš„å‹ç¼©åŒ…&lt;/h3>
&lt;ul>
&lt;li>æŠŠæ–‡ä»¶è§£å‹åˆ°$HOME/.sublime_text_2æ–‡ä»¶å¤¹ä¸­ï¼š&lt;/li>
&lt;/ul>
&lt;pre>&lt;code>tar -xf (sublimeå‹ç¼©åŒ…çš„æ–‡ä»¶å).tar.bz2
sudo mv (è§£å‹åçš„æ–‡ä»¶å¤¹) tools/Sublime_Text_2
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>åœ¨/usr/binç›®å½•ä¸‹é¢åˆ›å»ºä¸€ä¸ªé“¾æ¥&lt;/li>
&lt;/ul>
&lt;pre>&lt;code>vim sublime
&lt;/code>&lt;/pre>&lt;p>åœ¨æ–‡ä»¶ä¸­å†™å…¥è¿™äº›ä»£ç ï¼š&lt;/p>
&lt;pre>&lt;code>#!/bin/bash
export SUBLIME_HOME=&amp;quot;~/tools/Sublime_Text_2&amp;quot;
$SUBLIME_HOME/sublime_text $*
&lt;/code>&lt;/pre>&lt;p>ä¿®æ”¹æ–‡ä»¶æƒé™å¹¶ä¸”ç§»åŠ¨&lt;/p>
&lt;pre>&lt;code>chmod 555 sublime &amp;amp;&amp;amp; mv sublime /usr/bin/sublime
&lt;/code>&lt;/pre>&lt;p>è¿™æ ·å°±å¯ä»¥åœ¨ç»ˆç«¯ä¸­ç›´æ¥æ‰§è¡Œsublimeäº†&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/Sublime-Text/">Sublime Text</category></item><item><title>Vim7.3 for Windows é…ç½®</title><link>https://moelove.info/2013/08/10/Vim7.3-for-Windows-%E9%85%8D%E7%BD%AE/</link><guid isPermaLink="true">https://moelove.info/2013/08/10/Vim7.3-for-Windows-%E9%85%8D%E7%BD%AE/</guid><pubDate>Sat, 10 Aug 2013 21:34:17 +0000</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>ä¸€ç›´æ˜¯åœ¨Linuxä¸‹ç”¨Vimï¼Œä½†æ˜¯æœ‰äº›æ—¶å€™åœ¨åˆ«äººç”µè„‘æˆ–è€…æœºæˆ¿åˆä¸å¾—ä¸ç”¨windowsæ¥å†™ä»£ç ï¼Œæ‰€ä»¥ä¹Ÿå°±ä¸‹è½½äº†vim for windowsã€‚ä½†æ˜¯ä»Šå¤©æ‰“å¼€ä¸€ä¸ªæœ‹å‹å†™çš„ç½‘é¡µçš„æ—¶å€™ï¼Œå‡ºç°äº†ä¹±ç çš„é—®é¢˜ï¼Œæ‰€ä»¥æŠŠè§£å†³æ–¹æ³•è®°å½•ä¸€ä¸‹ï¼Œä¹Ÿå°±æ˜¯å’Œåœ¨linuxä¸‹é¢ä¸€æ ·ï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶å°±å¯ä»¥äº†ã€‚æ¥ä¸‹æ¥è¿›å…¥æ­£é¢˜ã€‚&lt;/p>
&lt;/blockquote>
&lt;h3 id="é€‰é¡¹æ„ä¹‰æ¦‚è¿°">é€‰é¡¹æ„ä¹‰æ¦‚è¿°&lt;/h3>
&lt;p>Vimæœ‰å››ä¸ªè·Ÿå­—ç¬¦ç¼–ç æ–¹å¼æœ‰å…³çš„é€‰é¡¹ï¼Œåˆ†åˆ«æ˜¯:&lt;code>encoding&lt;/code>ã€&lt;code>fileencoding&lt;/code>ã€&lt;code>fileencodings&lt;/code>ã€&lt;code>termencoding&lt;/code> (è¿™äº›é€‰é¡¹å¯èƒ½çš„å–å€¼å¯ä»¥å‚è€ƒ Vim çš„å¸®åŠ© :&lt;em>help encoding-names&lt;/em>)ï¼Œå®ƒä»¬å„è‡ªçš„æ„ä¹‰:&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;strong>encoding&lt;/strong>: Vim å†…éƒ¨ä½¿ç”¨çš„å­—ç¬¦ç¼–ç æ–¹å¼ï¼ŒåŒ…æ‹¬Vimçš„buffer(ç¼“å†²åŒº)ã€èœå•æ–‡æœ¬ã€æ¶ˆæ¯æ–‡æœ¬ç­‰ã€‚ç”¨æˆ·æ‰‹å†Œä¸Šå»ºè®®åªåœ¨*.vimrc*ä¸­æ”¹å˜å®ƒçš„å€¼ï¼Œäº‹å®ä¸Šä¼¼ä¹ä¹Ÿåªæœ‰åœ¨*.vimrc* ä¸­æ”¹å˜å®ƒçš„å€¼æ‰æœ‰æ„ä¹‰ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>fileencoding&lt;/strong>: Vim ä¸­å½“å‰ç¼–è¾‘çš„æ–‡ä»¶çš„å­—ç¬¦ç¼–ç æ–¹å¼ï¼ŒVim ä¿å­˜æ–‡ä»¶æ—¶ä¹Ÿä¼šå°†æ–‡ä»¶ä¿å­˜ä¸ºè¿™ç§å­—ç¬¦ç¼–ç æ–¹å¼ (ä¸ç®¡æ˜¯å¦æ–°æ–‡ä»¶éƒ½å¦‚æ­¤)ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>fileencodings&lt;/strong>: Vim å¯åŠ¨æ—¶ä¼šæŒ‰ç…§å®ƒæ‰€åˆ—å‡ºçš„å­—ç¬¦ç¼–ç æ–¹å¼é€ä¸€æ¢æµ‹å³å°†æ‰“å¼€çš„æ–‡ä»¶çš„å­—ç¬¦ç¼–ç æ–¹å¼ï¼Œå¹¶ä¸”å°† fileencoding è®¾ç½®ä¸ºæœ€ç»ˆæ¢æµ‹åˆ°çš„å­—ç¬¦ç¼–ç æ–¹å¼ã€‚å› æ­¤æœ€å¥½å°† Unicode ç¼–ç æ–¹å¼æ”¾åˆ°è¿™ä¸ªåˆ—è¡¨çš„æœ€å‰é¢ï¼Œå°†æ‹‰ä¸è¯­ç³»ç¼–ç æ–¹å¼ latin1 æ”¾åˆ°æœ€åé¢ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>termencoding&lt;/strong>: Vim æ‰€å·¥ä½œçš„ç»ˆç«¯ (æˆ–è€… Windows çš„ Console çª—å£) çš„å­—ç¬¦ç¼–ç æ–¹å¼ã€‚è¿™ä¸ªé€‰é¡¹åœ¨ Windows ä¸‹å¯¹æˆ‘ä»¬å¸¸ç”¨çš„ GUI æ¨¡å¼çš„ gVim æ— æ•ˆï¼Œè€Œå¯¹ Console æ¨¡å¼çš„ Vim è€Œè¨€å°±æ˜¯Windowsæ§åˆ¶å°çš„ä»£ç é¡µï¼Œå¹¶ä¸”é€šå¸¸æˆ‘ä»¬ä¸éœ€è¦æ”¹å˜å®ƒã€‚ï¼ˆæˆ‘å°è¯•æ”¹å˜äº†å®ƒä¸ºUTF-8ï¼Œä½†å¯¹äºconsoleæ¨¡å¼çš„ç¼–ç æ–¹å¼å´æ²¡æœ‰æ”¹å˜ï¼‰&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="é…ç½®è¯´æ˜">é…ç½®è¯´æ˜&lt;/h3>
&lt;p>ç”±äº Unicode èƒ½åŒ…å«å‡ ä¹æ‰€æœ‰çš„è¯­è¨€çš„å­—ç¬¦ï¼ŒUnicodeçš„UTF-8ç¼–ç æ–¹å¼åˆæ˜¯éå¸¸å…·æœ‰æ€§ä»·æ¯”å’Œé€šç”¨çš„ç¼–ç æ–¹å¼ï¼Œæ‰€ä»¥æŠŠ&lt;em>encoding&lt;/em>çš„å€¼è®¾ç½®ä¸º&lt;strong>utf-8&lt;/strong>ã€‚åŒæ—¶å°†encodingè®¾ç½®ä¸ºutf-8æ—¶ï¼ŒVimè‡ªåŠ¨æ¢æµ‹æ–‡ä»¶çš„ç¼–ç æ–¹å¼ä¼šæ›´å‡†ç¡®ã€‚åœ¨ä¸­æ–‡Windowsé‡Œç¼–è¾‘çš„æ–‡ä»¶ï¼Œä¸ºäº†å…¼é¡¾ä¸å…¶ä»–è½¯ä»¶çš„å…¼å®¹æ€§ï¼Œæ–‡ä»¶ç¼–ç è¿˜æ˜¯è®¾ç½®ä¸ºGB2312/GBKæ¯”è¾ƒåˆé€‚ï¼Œå› æ­¤&lt;em>fileencoding&lt;/em>å»ºè®®è®¾ç½®ä¸º&lt;strong>chinese&lt;/strong> (&lt;em>chineseæ˜¯ä¸ªåˆ«åï¼Œåœ¨Unixé‡Œè¡¨ç¤º&lt;code>gb2312&lt;/code>ï¼Œåœ¨Windowsé‡Œè¡¨ç¤º&lt;code>cp936&lt;/code>ï¼Œä¹Ÿå°±æ˜¯GBKçš„ä»£ç é¡µ&lt;/em>)ã€‚&lt;/p>
&lt;h3 id="å…·ä½“é…ç½®">å…·ä½“é…ç½®&lt;/h3>
&lt;p>æœ€åå¯¹äºæ–‡ä»¶ä¸­æ˜¾ç¤ºä¹±ç ã€èœå•ä¹±ç ã€å³é”®èœå•ä¹±ç ä»¥åŠConlseè¾“å‡ºä¹±ç é—®é¢˜çš„è§£å†³æ–¹æ¡ˆï¼Œä¿®æ”¹Vimç¼–è¾‘å™¨æ‰€å¯¹åº”çš„é…ç½®æ–‡ä»¶**_vimrc**ï¼ˆè¿™ä¸ªæ–‡ä»¶åœ¨ä½ å®‰è£…vim çš„é‚£ä¸ªç›®å½•ä¸‹ï¼‰ï¼Œæ·»åŠ å¦‚ä¸‹é…ç½®ï¼š&lt;/p>
&lt;ul>
&lt;li>å…³äºå¸¸è§„è®¾ç½®ï¼š&lt;/li>
&lt;/ul>
&lt;pre>&lt;code>&amp;quot;æ€»æ˜¯æ˜¾ç¤ºæ ‡ç­¾ã€‚0ï¼šä¸æ˜¾ç¤ºï¼›1ï¼šå¤šäº1ä¸ªæ—¶æ˜¾ç¤º&amp;quot;
set showtabline=2
&amp;quot;å¼€å¯è¡Œå·&amp;quot;
set number
&amp;quot;å¼€å¯è‡ªåŠ¨ç¼©è¿›, 7.3ä»¥ä¸Šç‰ˆæœ¬å·²è‡ªåŠ¨å¼€å¯&amp;quot;
set autoindent
&amp;quot;ç¼©è¿›å®½åº¦ä¸º4ä¸ªå­—ç¬¦&amp;quot;
set shiftwidth=4
&amp;quot;tabå®½åº¦ä¸º4ä¸ªå­—ç¬¦&amp;quot;
set tabstop=4
&amp;quot;ç¼–è¾‘æ—¶å°†æ‰€æœ‰tabæ›¿æ¢ä¸ºç©ºæ ¼&amp;quot;
set et
&amp;quot;æŒ‰ä¸€æ¬¡Backspaceå°±åˆ é™¤4ä¸ªç©ºæ ¼&amp;quot;
set smarttab
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>å…³äºè‰²å½©å’Œå­—ä½“ä¹‹ç±»çš„è®¾ç½®ï¼š&lt;/li>
&lt;/ul>
&lt;pre>&lt;code>&amp;quot;é…è‰²æ–¹æ¡ˆï¼ˆè¿™é‡Œå¯ä»¥è‡ªé€‰ï¼Œæˆ‘æ¯”è¾ƒå–œæ¬¢è¿™ä¸ªé…è‰²æ–¹æ¡ˆï¼‰&amp;quot;
colo desert
&amp;quot;å¼€å¯è¯­æ³•é«˜äº®, 7.3ç‰ˆæœ¬å·²è‡ªåŠ¨å¼€å¯&amp;quot;
syntax on
&amp;quot;å­—ä½“è®¾ç½®&amp;quot;
set guifont=courier_new:h10
&amp;quot;å…³é—­å…¼å®¹æ¨¡å¼&amp;quot;
set nocompatible
&amp;quot;ä»¥ä¸‹ä¸‰è¡Œæ¨¡æ‹ŸWindowsæ“ä½œï¼Œå¦‚Ctrl-Cå¤åˆ¶&amp;quot;
source $VIMRUNTIME/vimrc_example.vim
source $VIMRUNTIME/mswin.vim
behave mswin
&amp;quot;ä¸ç”Ÿæˆå¤‡ä»½æ–‡ä»¶ï¼Œä¸‹é¢è¿™å¥è¦å†™åœ¨behave mswinä¸‹é¢ï¼Œå¦åˆ™è¿˜æ˜¯ä¼šç”Ÿæˆå¤‡ä»½ï¼Œæƒ…å†µä¸æ˜&amp;quot;
set nobackup
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>å…³äºç¼–ç éƒ¨åˆ†çš„è®¾ç½®ï¼š&lt;/li>
&lt;/ul>
&lt;pre>&lt;code>&amp;quot;GVIMå†…éƒ¨ç¼–ç &amp;quot;
set encoding=utf-8
&amp;quot;å½“å‰ç¼–è¾‘çš„æ–‡ä»¶ç¼–ç &amp;quot;
set fileencoding=utf-8
&amp;quot;GVIMæ”¯æŒæ‰“å¼€çš„æ–‡ä»¶ç¼–ç ï¼ˆè¿™é‡Œä¹Ÿæ˜¯å‚è€ƒå¸®åŠ©æ‰‹å†Œæ¥çš„ï¼‰&amp;quot;
set fileencodings=utf-8,gbk,gb2312,big5,latin1
&amp;quot;è§£å†³èœå•åŠå³é”®èœå•ä¹±ç &amp;quot;
source $VIMRUNTIME/delmenu.vim
source $VIMRUNTIME/menu.vim
&amp;quot;è§£å†³consleè¾“å‡ºä¹±ç &amp;quot;
language messages zh_CN.utf-8
&amp;quot;é˜²æ­¢ç‰¹æ®Šç¬¦å·æ— æ³•æ­£å¸¸æ˜¾ç¤ºï¼Œå¦‚äº”è§’æ˜Ÿç­‰1&amp;quot;
set ambiwidth=double
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>ä¸»ä½“è®¾ç½®éƒ¨åˆ†ï¼š&lt;/li>
&lt;/ul>
&lt;pre>&lt;code>set diffexpr=MyDiff()
function MyDiff()
let opt = '-a --binary '
if &amp;amp;diffopt =~ 'icase' | let opt = opt . '-i ' | endif
if &amp;amp;diffopt =~ 'iwhite' | let opt = opt . '-b ' | endif
let arg1 = v:fname_in
if arg1 =~ ' ' | let arg1 = '&amp;quot;' . arg1 . '&amp;quot;' | endif
let arg2 = v:fname_new
if arg2 =~ ' ' | let arg2 = '&amp;quot;' . arg2 . '&amp;quot;' | endif
let arg3 = v:fname_out
if arg3 =~ ' ' | let arg3 = '&amp;quot;' . arg3 . '&amp;quot;' | endif
let eq = ''
if $VIMRUNTIME =~ ' '
if &amp;amp;sh =~ '\&amp;lt;cmd'
let cmd = '&amp;quot;&amp;quot;' . $VIMRUNTIME . '\diff&amp;quot;'
let eq = '&amp;quot;'
else
let cmd = substitute($VIMRUNTIME, ' ', '&amp;quot; ', '') . '\diff&amp;quot;'
endif
else
let cmd = $VIMRUNTIME . '\diff'
endif
silent execute '!' . cmd . ' ' . opt . arg1 . ' ' . arg2 . ' &amp;gt; ' . arg3 . eq
endfunction
&lt;/code>&lt;/pre>&lt;p>ä»¥ä¸Šå°±æ˜¯æˆ‘å…³äºwindowsä¸‹VIMçš„é…ç½®ä¿®æ”¹äº†ã€‚æˆ‘ä½¿ç”¨çš„é…ç½®æ–‡ä»¶å¯ä»¥åœ¨&lt;a href="https://github.com/tao12345666333/VimforWindowssetting">Vim for Windows setting&lt;/a>ä¸‹è½½å¾—åˆ°ã€‚&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Vim/">Vim</category></item><item><title>LAMPç¯å¢ƒçš„å¿«é€Ÿæ­å»º</title><link>https://moelove.info/2013/08/07/LAMP%E7%8E%AF%E5%A2%83%E7%9A%84%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BA/</link><guid isPermaLink="true">https://moelove.info/2013/08/07/LAMP%E7%8E%AF%E5%A2%83%E7%9A%84%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BA/</guid><pubDate>Wed, 07 Aug 2013 21:30:59 +0000</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>è¿™æ˜¯æˆ‘åœ¨æˆ‘çš„&lt;a href="http://tieba.baidu.com/f?kw=centos">centos å§&lt;/a>ä¸“é—¨å†™çš„æ•™ç¨‹å¸–ï¼Œç›®çš„ä¹Ÿå°±æ˜¯ä¸ºäº†è®©æ–°æ‰‹å¯ä»¥æ›´å¿«çš„æ­å»ºèµ·æ¥ç¯å¢ƒï¼Œè€Œä¸æ˜¯ä¸€ç›´åœ¨é—¨å¤–å¾˜å¾Šã€‚æ‰€ä»¥å°±æ¬è¿‡æ¥äº†ï¼Œæ—¶é—´ç¥é©¬çš„å°±æŒ‰ç…§&lt;a href="http://tieba.baidu.com/p/2514694347">åŸå¸–&lt;/a>æ¥å§ã€‚&lt;/p>
&lt;/blockquote>
&lt;h3 id="å†™åœ¨å‰é¢">å†™åœ¨å‰é¢&lt;/h3>
&lt;p>æœ¬ç¯‡æ–‡ç« æ˜¯é¢å‘linuxæ–°æ‰‹ï¼Œæ–‡ä¸­é‡‡ç”¨ç¯å¢ƒæ˜¯&lt;em>Win7+V-BOX&lt;/em>ï¼Œé…ç½®è¿‡ç¨‹ç”¨puttyè¿›è¡Œæ“ä½œï¼ˆä¸ªäººä¹ æƒ¯è€Œå·²ï¼‰ï¼Œlinuxç³»ç»Ÿä½¿ç”¨CentOS6.3ç‰ˆæœ¬ã€‚CentOSçš„å®‰è£…æ–¹æ³•åŠè™šæ‹Ÿæœºä¸­ç½‘ç»œé…ç½®è¯·å‚é˜…centoså§ç²¾å“å¸–&lt;a href="http://tieba.baidu.com/p/2068921476">ã€æ•™ç¨‹ã€‘æœ€å…¨centos å®‰è£…æ–¹æ³•åŠå†…å®¹è¯¦è§£&lt;/a>ã€‚ä¸ºäº†å°½é‡ä¸€æ¬¡æ€§å¯ä»¥è®©è¯»è€…å®ŒæˆLAMPç¯å¢ƒçš„æ­å»ºï¼Œæœ¬æ¬¡å®‰è£…è¿‡ç¨‹éƒ½é‡‡ç”¨&lt;code>yum&lt;/code>åŒ…ç®¡ç†æœºåˆ¶è¿›è¡Œå®‰è£…ã€‚å½“ç„¶ç”Ÿäº§ç¯å¢ƒä¸‹ä¸€èˆ¬éƒ½æ˜¯é‡‡ç”¨æºç ç¼–è¯‘çš„ã€‚åœ¨è¿‘æœŸæˆ‘ä¹Ÿä¼šå†å‡ºè¿è½½æ–‡ï¼Œä½¿ç”¨æºç åŒ…è¿›è¡ŒLAMPç¯å¢ƒçš„æ­å»ºï¼Œæ¬¢è¿å…³æ³¨ã€‚å¦‚æœæœ‰ä»»ä½•æ„è§æˆ–è€…å»ºè®®éƒ½å¯ä»¥åˆ°centoså§å‘å¸–è¯¢é—®ã€‚
Ps:æœ¬æ–‡LAMP = Linux + Apache + Mysql + PHP&lt;/p>
&lt;h3 id="å®‰è£…è¿‡ç¨‹å…ˆç¡®ä¿ä½ çš„ç³»ç»Ÿç½‘ç»œæ­£å¸¸æˆ–è€…æ­å»ºå¥½äº†æœ¬åœ°æº">å®‰è£…è¿‡ç¨‹ï¼ˆå…ˆç¡®ä¿ä½ çš„ç³»ç»Ÿç½‘ç»œæ­£å¸¸æˆ–è€…æ­å»ºå¥½äº†æœ¬åœ°æºï¼‰&lt;/h3>
&lt;h4 id="1-é¦–å…ˆå®‰è£…apacheä½¿ç”¨å‘½ä»¤">1. é¦–å…ˆå®‰è£…Apacheï¼Œä½¿ç”¨å‘½ä»¤ï¼š&lt;/h4>
&lt;p>&lt;code>sudo yum install httpd â€“y&lt;/code>&lt;/p>
&lt;h4 id="2-ç„¶åå®‰è£…mysqlä½¿ç”¨å‘½ä»¤">2. ç„¶åå®‰è£…Mysqlï¼Œä½¿ç”¨å‘½ä»¤&lt;/h4>
&lt;p>&lt;code>sudo yum install mysql mysql-server â€“y&lt;/code>&lt;/p>
&lt;h4 id="3-å†å®‰è£…php-ä½¿ç”¨å‘½ä»¤">3. å†å®‰è£…php ï¼Œä½¿ç”¨å‘½ä»¤&lt;/h4>
&lt;p>&lt;code>sudo yum install php â€“y&lt;/code>&lt;/p>
&lt;h4 id="4-å®‰è£…å®Œæ¯•ä¹‹åå¯åŠ¨apache-ä½¿ç”¨">4. å®‰è£…å®Œæ¯•ä¹‹åå¯åŠ¨apache. ä½¿ç”¨&lt;/h4>
&lt;p>&lt;code>sudo service httpd start&lt;/code>&lt;/p>
&lt;p>&lt;img src="http://moelove.qiniudn.com/serverstart.jpg" width="70%" />&lt;/p>
&lt;p>å¯åŠ¨æˆåŠŸäº†ï¼Œæˆ‘ä»¬è®¿é—®ä¸€ä¸‹ï¼Œåœ¨æµè§ˆå™¨çš„åœ°å€æ è¾“å…¥è™šæ‹ŸæœºIPã€‚&lt;/p>
&lt;p>&lt;img src="http://moelove.qiniudn.com/view.jpg" width="70%" />&lt;/p>
&lt;p>å¥½ï¼Œè¿™é‡Œé‡åˆ°äº†æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œ &lt;strong>æ— æ³•è®¿é—®&lt;/strong>&lt;/p>
&lt;blockquote>
&lt;ul>
&lt;li>apacheæœåŠ¡å·²ç»æ‰“å¼€ï¼Œä½†æ˜¯å´æ— æ³•è®¿é—®
è¿™é‡Œå¾ˆå¯èƒ½æ˜¯&lt;strong>iptables&lt;/strong>çš„é˜²å¾¡è§„åˆ™å¯¼è‡´çš„ã€‚&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;p>æ‰§è¡Œ&lt;code>iptables â€“L &lt;/code>æŸ¥çœ‹æ‰€æœ‰çš„iptablesçš„è§„åˆ™ã€‚&lt;/p>
&lt;p>&lt;img src="http://moelove.qiniudn.com/lampiptables.jpg" width="70%" />&lt;/p>
&lt;p>å…³äºiptablesçš„çŸ¥è¯†å¯ä»¥è‡ªè¡Œäº†è§£æˆ–è€…å…³æ³¨åç»­è®²è§£
æˆ‘ä»¬æ‰§è¡Œ &lt;code>sudo iptables â€“F&lt;/code> æ¸…é™¤æ‰€æœ‰è§„åˆ™&lt;/p>
&lt;p>&lt;img src="http://moelove.qiniudn.com/lampcleariptables.jpg" width="70%" />&lt;/p>
&lt;p>æ¥ä¸‹æ¥åœ¨æµè§ˆå™¨è¾“å…¥è™šæ‹Ÿæœºåœ°å€ ï¼Œæˆ‘ä»¬çœ‹åˆ°å¦‚ä¸‹ï¼š&lt;/p>
&lt;p>&lt;img src="http://moelove.qiniudn.com/lampsuccess.jpg" width="70%" />&lt;/p>
&lt;p>æˆ‘ä»¬å·²ç»è®¿é—®æˆåŠŸäº†ï¼&lt;/p>
&lt;blockquote>
&lt;ul>
&lt;li>&lt;s>å½“ç„¶åœ¨è¿™é‡Œçš„æ—¶å€™ä¹Ÿè®¸è¿˜æœ‰äººæ˜¯è®¿é—®ä¸äº†çš„ï¼Œ&lt;/s>å¯èƒ½æ˜¯å› ä¸ºCentOSè‡ªå¸¦çš„&lt;strong>SElinux&lt;/strong>æœºåˆ¶å½±å“çš„&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;p>æˆ‘ä»¬æ‰§è¡Œ&lt;code>getenforce&lt;/code>å‘½ä»¤æ¥æŸ¥çœ‹SElinuxçš„çŠ¶æ€ï¼Œä½¿ç”¨&lt;code>sudo setenforce 0&lt;/code>æ¥æ”¹å˜SElinuxä¸º&lt;em>permission&lt;/em>çŠ¶æ€ã€‚&lt;/p>
&lt;p>&lt;img src="http://moelove.qiniudn.com/lampSELinuxstatus.jpg" width="70%" />&lt;/p>
&lt;p>éƒ½æ‰§è¡Œå®Œæˆåï¼Œ&lt;s>åº”è¯¥&lt;/s>å°±å¯ä»¥è®¿é—®äº†ã€‚&lt;/p>
&lt;h4 id="5æµ‹è¯•æ˜¯å¦å¯ä»¥æ‰§è¡Œphpä»£ç ">5.æµ‹è¯•æ˜¯å¦å¯ä»¥æ‰§è¡Œphpä»£ç &lt;/h4>
&lt;p>æ‰§è¡Œ &lt;code>vim /var/www/html/test.php&lt;/code> å†™å…¥æµ‹è¯•ä»£ç &lt;/p>
&lt;p>&lt;img src="http://moelove.qiniudn.com/lampphpinfo.jpg" width="70%" />&lt;/p>
&lt;p>ä¿å­˜é€€å‡ºï¼Œç”¨æµè§ˆå™¨è¿›è¡Œè®¿é—®&lt;/p>
&lt;p>&lt;img src="http://moelove.qiniudn.com/lampviewstatus.jpg" width="70%" />&lt;/p>
&lt;p>æˆåŠŸï¼&lt;/p>
&lt;p>ä½†æ˜¯å‘åçœ‹ï¼Œå‘ç°ç»„æˆæ¨¡å—é‡Œé¢æ²¡æœ‰&lt;strong>mysql&lt;/strong>ã€‚è¯´æ˜ç°åœ¨è¿˜ä¸æ”¯æŒmysqlæ¨¡å—ï¼Œå› ä¸ºæˆ‘ä»¬å°‘å®‰è£…äº†ä¸€ä¸ªä¸œè¥¿ ç°åœ¨æ‰§è¡Œ&lt;/p>
&lt;pre>&lt;code>sudo yum install php-mysql
&lt;/code>&lt;/pre>&lt;p>æ·»åŠ phpå’Œmysqlçš„ä¸­é—´æ¨¡å—ï¼Œé‡å¯apacheæœåŠ¡:&lt;code>sudo service httpd restart&lt;/code> å†æ¬¡è®¿é—®ï¼Œå‘ç°ç»„æˆæ¨¡å—ä¸­æœ‰äº†mysqlçš„ä¿¡æ¯ï¼Œè¯´æ˜å¯ä»¥è®¿é—®mysqlçš„æ•°æ®åº“äº†ã€‚&lt;/p>
&lt;p>æ¥ä¸‹æ¥æ‰§è¡Œ&lt;code>sudo service mysqld start&lt;/code> å¯åŠ¨mysqlæœåŠ¡ã€‚
æ‰§è¡Œ&lt;/p>
&lt;pre>&lt;code>mysql -u root -p
&lt;/code>&lt;/pre>&lt;p>è®¿é—®mysqlæ•°æ®åº“&lt;/p>
&lt;p>&lt;img src="http://moelove.qiniudn.com/lampmysqlstatus.jpg" width="70%" />&lt;/p>
&lt;p>è¡¨ç¤ºmysqlæ•°æ®åº“ä¹Ÿæ­£å¸¸ï¼Œåˆ°æ­¤ï¼Œ&lt;strong>LAMPç¯å¢ƒåˆæ­¥å»ºæˆ&lt;/strong>ã€‚&lt;/p>
&lt;h4 id="6è®¾ç½®æœåŠ¡çš„å¼€æœºè‡ªåŠ¨å¯åŠ¨så¯ä»¥ä¸åšs">6.è®¾ç½®æœåŠ¡çš„å¼€æœºè‡ªåŠ¨å¯åŠ¨&lt;s>ï¼ˆå¯ä»¥ä¸åšï¼‰&lt;/s>&lt;/h4>
&lt;p>ä½¿ç”¨&lt;/p>
&lt;pre>&lt;code>sudo chkconfig httpd on
sudo chkconfig mysqld on
&lt;/code>&lt;/pre>&lt;h4 id="7lampç¯å¢ƒçš„é…ç½®æ–‡ä»¶">7.LAMPç¯å¢ƒçš„é…ç½®æ–‡ä»¶&lt;/h4>
&lt;pre>&lt;code>Apache: /etc/httpd/conf/httpd.conf
Php: /etc/php.ini
Mysql: /etc/my.cnf
&lt;/code>&lt;/pre>&lt;h3 id="lampç¯å¢ƒæ­å»ºå°ç»“">LAMPç¯å¢ƒæ­å»ºå°ç»“&lt;/h3>
&lt;p>é€šè¿‡ä»¥ä¸Šè¿‡ç¨‹ï¼Œä½ å°±å·²ç»æˆåŠŸçš„æ­å»ºå¥½äº†LAMPç¯å¢ƒï¼Œå‰©ä¸‹çš„é…ç½®å°±æ˜¯ä¿®æ”¹ä½ çš„é…ç½®æ–‡ä»¶ï¼Œè¿›è€Œè¾¾åˆ°æ•ˆæœã€‚ç±»ä¼¼å¯åŠ¨ç±»å‹ï¼Œæ¨¡å—ï¼Œè¶…æ—¶ï¼Œåœ°å€ï¼ŒçŠ¶æ€ä¹‹ç±»çš„ï¼Œéƒ½ä¼šåœ¨ä¸‹ç¯‡æ–‡ç« ä¸­å†™å‡ºã€‚
ä½¿ç”¨&lt;em>yum&lt;/em>å®‰è£…LAMPç¯å¢ƒæ˜¯æœ€ç®€å•çš„ï¼Œä¹Ÿæ˜¯æœ€æ–¹ä¾¿çš„ã€‚ä¸è¿‡ç”Ÿäº§ç¯å¢ƒéƒ½æ˜¯ç”¨çš„æºç åŒ…ï¼Œå› ä¸ºæºç åŒ…å¯ä»¥æ›´åŠ ä¸ªæ€§åŒ–çš„å®šä¹‰ä½ éœ€è¦çš„æ¨¡å—ã€‚&lt;/p>
&lt;p>&lt;a href="http://wenku.baidu.com/view/fd825c8551e79b8969022614.html">CentOSå®‰è£…æ–¹æ³•&lt;/a>&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category><category domain="https://moelove.info/tags/LAMP/">LAMP</category></item><item><title>cat å‘½ä»¤ç ”ç©¶</title><link>https://moelove.info/2013/03/20/cat-%E5%91%BD%E4%BB%A4%E7%A0%94%E7%A9%B6/</link><guid isPermaLink="true">https://moelove.info/2013/03/20/cat-%E5%91%BD%E4%BB%A4%E7%A0%94%E7%A9%B6/</guid><pubDate>Wed, 20 Mar 2013 21:24:20 +0000</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;blockquote>
&lt;p>æœ‰äººé—®æˆ‘å…³äºcentosé‡Œé¢ä½¿ç”¨catå‘½ä»¤çš„é—®é¢˜ï¼Œæˆ‘åœ¨è¿™é‡Œç®€å•è®°å½•ä¸€ä¸‹ã€‚
åœ¨linuxä¸‹ï¼Œcatåº”è¯¥æ˜¯ä½¿ç”¨æœ€é¢‘ç¹çš„å‘½ä»¤ä¹‹ä¸€äº†å§ã€‚&lt;/p>
&lt;/blockquote>
&lt;h3 id="catå‘½ä»¤åœ¨linuxä½œä»¥ä¸‹ç”¨é€”">catå‘½ä»¤åœ¨Linuxä½œä»¥ä¸‹ç”¨é€”ï¼š&lt;/h3>
&lt;ul>
&lt;li>åœ¨å±å¹•ä¸Šæ˜¾ç¤ºæ–‡æœ¬æ–‡ä»¶ã€‚&lt;/li>
&lt;li>å¤åˆ¶æ–‡æœ¬æ–‡ä»¶ã€‚&lt;/li>
&lt;li>åˆå¹¶æ–‡æœ¬æ–‡ä»¶ã€‚&lt;/li>
&lt;li>åˆ›å»ºæ–°çš„æ–‡æœ¬æ–‡ä»¶ã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="catå‘½ä»¤æ”¯æŒçš„è¯­æ³•å¦‚ä¸‹">catå‘½ä»¤æ”¯æŒçš„è¯­æ³•å¦‚ä¸‹ï¼š&lt;/h3>
&lt;pre>&lt;code>cat filename
cat options filename
cat file1 file2
cat file1 file2 &amp;gt; newcombinedfile
&lt;/code>&lt;/pre>&lt;h4 id="æ˜¾ç¤ºæ–‡ä»¶çš„å†…å®¹">æ˜¾ç¤ºæ–‡ä»¶çš„å†…å®¹ï¼š&lt;/h4>
&lt;pre>&lt;code>cat /tmp/test
&lt;/code>&lt;/pre>&lt;p>ä¸Šé¢çš„å‘½ä»¤å°±æ˜¯æŸ¥çœ‹æ–‡ä»¶&lt;code>/tmp/test&lt;/code>çš„å†…å®¹ï¼ŒæŠŠå†…å®¹è¾“å‡ºåˆ°å±å¹•ã€‚
ä½†æ˜¯ä¹Ÿå¯ä»¥ä½¿ç”¨&lt;/p>
&lt;pre>&lt;code>cat /tmp/test &amp;gt; /tmp/test2
&lt;/code>&lt;/pre>&lt;p>ä½¿ç”¨ä¸Šé¢çš„å‘½ä»¤ï¼Œå¯ä»¥æŠŠæ–‡ä»¶å†…å®¹**&lt;a href="http://linux-wiki.cn/wiki/zh-hans/Bash%E7%9A%84%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA%E9%87%8D%E5%AE%9A%E5%90%91">é‡å®šå‘&lt;/a>**åˆ°/tmp/test2æ–‡ä»¶ä¸­&lt;/p>
&lt;h4 id="ä¸²è”æ–‡ä»¶">ä¸²è”æ–‡ä»¶ï¼š&lt;/h4>
&lt;p>ä¸²è”æ–‡ä»¶æ˜¯æŠŠæ–‡ä»¶å†…å®¹ä¸€èµ·è¾“å‡ºï¼Œä½†æ˜¯ä¸ä¼šæ”¹å˜æºæ–‡ä»¶çš„å†…å®¹&lt;/p>
&lt;pre>&lt;code>cat /tmp/test1 /tmp/test2 /tmp/test3
&lt;/code>&lt;/pre>&lt;p>ä»¥ä¸Šå‘½ä»¤ä¼šå°†/tmp ç›®å½•ä¸‹çš„ test1 ,test2 ,test3 ä¸‰ä¸ªæ–‡ä»¶çš„å†…å®¹ä¸€èµ·è¾“å‡ºï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨é‡å®šå‘å‘½ä»¤æŸ¥çœ‹è¾“å‡ºå†…å®¹&lt;/p>
&lt;pre>&lt;code>cat /tmp/test1 /tmp/test2 /tmp/test3 &amp;gt;/tmp/testoutputs
&lt;/code>&lt;/pre>&lt;p>é‡å®šå‘è‡³/tmp ä¸‹çš„testoutputs æ–‡ä»¶ä¸­&lt;/p>
&lt;p>å½“ç„¶æŸ¥çœ‹çš„æ—¶å€™å¯ä»¥é…åˆç®¡é“å‘½ä»¤ä½¿ç”¨&lt;/p>
&lt;p>&lt;code>cat /tmp/test1 /tmp/test2 /tmp/test3 | less&lt;/code>&lt;/p></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category></item><item><title>fedoraå®‰è£…åæœ€åˆçš„äº‹æƒ…</title><link>https://moelove.info/2013/03/09/fedora%E5%AE%89%E8%A3%85%E5%90%8E%E6%9C%80%E5%88%9D%E7%9A%84%E4%BA%8B%E6%83%85/</link><guid isPermaLink="true">https://moelove.info/2013/03/09/fedora%E5%AE%89%E8%A3%85%E5%90%8E%E6%9C%80%E5%88%9D%E7%9A%84%E4%BA%8B%E6%83%85/</guid><pubDate>Sat, 09 Mar 2013 21:21:14 +0000</pubDate><author>zhangjintao9020@gmail.com (å¼ æ™‹æ¶›)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright><description>&lt;h3 id="æ›´æ–°æº">æ›´æ–°æº&lt;/h3>
&lt;pre>&lt;code>sudo yum localinstall --nogpgcheck http://mirrors.163.com/rpmfusion/free/fedora/rpmfusion-free-release-stable.noarch.rpm http://mirrors.163.com/rpmfusion/nonfree/fedora/rpmfusion-nonfree-release-stable.noarch.rpm (è¿™ä¸ªæ˜¯æ·»åŠ å›½å†…çš„è½¯ä»¶æº)
sudo yum update
&lt;/code>&lt;/pre>&lt;h3 id="ç½‘ç»œç›¸å…³">ç½‘ç»œç›¸å…³&lt;/h3>
&lt;h4 id="firefox">firefox&lt;/h4>
&lt;pre>&lt;code>sudo yum install firefox
&lt;/code>&lt;/pre>&lt;h4 id="chrome--chromium">chrome / chromium&lt;/h4>
&lt;p>æˆ‘æœ¬äººæ¯”è¾ƒä¹ æƒ¯ç”¨chromeçš„ &lt;s>ä¸è¿‡æœ€è¿‘ç½‘ç»œä¸æ˜¯å¾ˆç¨³å®š &lt;/s>å…ˆè¡¥å……chromium çš„å®‰è£…æ–¹æ³•å§&lt;/p>
&lt;ul>
&lt;li>chromiumçš„å®‰è£…
é¦–å…ˆæ·»åŠ &lt;a href="http://pan.baidu.com/s/1kTIBvUZ">chromiumçš„fedoraæº&lt;/a>,å°†ä¸‹è½½å¥½çš„ &lt;strong>.repo&lt;/strong> æ–‡ä»¶ç§»åŠ¨åˆ°&lt;code>/etc/yum.repos.d/&lt;/code>ä¸‹ï¼Œ æ‰§è¡Œ&lt;/li>
&lt;/ul>
&lt;pre>&lt;code>sudo yum install chromium
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>chromeçš„å®‰è£…
ä»&lt;a href="http://www.google.com/intl/zh-CN/chrome/">å®˜ç½‘&lt;/a>ä¸Šä¸‹è½½chrome çš„rpmåŒ…ï¼Œæˆ–è€…ä»æˆ‘çš„ç½‘ç›˜ä¸‹è½½å¯¹åº”çš„&lt;a href="http://pan.baidu.com/s/1ntmdqtz">32ä½&lt;/a> æˆ– &lt;a href="http://pan.baidu.com/s/1jGuqRdG">64ä½&lt;/a> çš„rpm åŒ…
æ‰§è¡Œ&lt;/li>
&lt;/ul>
&lt;pre>&lt;code>sudo rpm -ivh google-chrome.rpm
&lt;/code>&lt;/pre>&lt;h3 id="å®‰è£…è¯ä¹¦">å®‰è£…è¯ä¹¦&lt;/h3>
&lt;pre>&lt;code>sudo yum localinstall --nogpgcheck http://download1.rpmfusion.org/free/fedora/rpmfusion-free-release-branched.noarch.rpm http://download1.rpmfusion.org/nonfree/fedora/rpmfusion-nonfree-release-branched.noarch.rpm
&lt;/code>&lt;/pre>&lt;h3 id="å‹ç¼©è§£å‹è½¯ä»¶">å‹ç¼©/è§£å‹è½¯ä»¶&lt;/h3>
&lt;pre>&lt;code>sudo yum install unrar
sudo yum install p7zip
&lt;/code>&lt;/pre>&lt;h3 id="å½±éŸ³æ’­æ”¾">å½±éŸ³æ’­æ”¾&lt;/h3>
&lt;pre>&lt;code>sudo yum install gstreamer-plugins-good gstreamer-plugins-bad gstreamer-plugins-ugly libtunepimp-extras-freeworld xine-lib-extras-freeworld(å®‰è£…éŸ³é¢‘è§£ç å™¨)
sudo yum install ffmpeg ffmpeg-libs gstreamer-ffmpeg libmatroska xvidcore(å®‰è£…è§†é¢‘è§£ç å™¨)
&lt;/code>&lt;/pre>&lt;h3 id="ç¼–è¾‘å™¨">ç¼–è¾‘å™¨&lt;/h3>
&lt;ul>
&lt;li>vim&lt;/li>
&lt;/ul>
&lt;pre>&lt;code>sudo yum install vim
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>Sublime Text
æˆ‘ä¹Ÿå¾ˆå–œæ¬¢å› ä¸ºè¿è¡Œé€Ÿåº¦å¿«ï¼Œè€Œä¸”å…è´¹ã€‚å®‰è£…æ–¹æ³•å¯ä»¥å‚è€ƒæˆ‘çš„&lt;a href="http://moelove.info/articles/2013/08/30/fedoraxia-an-zhuang-sublime-text-2de-fang-fa/">fedoraä¸‹å®‰è£…sublime text 2&lt;/a>è¿™ç¯‡æ–‡ç« ã€‚&lt;/li>
&lt;/ul></description><category domain="https://moelove.info/post/">post</category><category domain="https://moelove.info/tags/Linux/">Linux</category></item></channel></rss>